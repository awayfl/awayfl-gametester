!function(){"use strict";var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function __extends(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var StreamingAudioChannel=function(){function t(t,e,i){var r=this;void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=1),this._isPlaying=!1,this._isLooping=!1,this._groupID=0,this._groupVolume=1,this._groupPan=0,this._startTime=0,this._groupID=t,this._groupVolume=e,this._groupPan=i,this._sourceOpenDelegate=function(t){return r._sourceOpen(t)},this._updateEndDelegate=function(t){return r._updateEnd(t)},this._audio=new Audio,this._audio.ontimeupdate=function(t){return r._onTimeUpdate(t)},this._updateSource()}return t.stopAllSounds=function(e){void 0===e&&(e=-1);var i=t._channels.length;if(e<0){for(var r=0;r<i;r++)t._channels[r].stop();t._channels.length=0}else{var n=[];for(r=0;r<i;r++)t._channels[r].groupID==e?t._channels[r].stop():n[n.length]=t._channels[r];t._channels=n}},t.setChannelGroupVolume=function(e,i){void 0===i&&(i=-1);var r=t._channels.length;if(i<0)for(var n=0;n<r;n++)t._channels[n].groupVolume=e;else for(n=0;n<r;n++)t._channels[n].groupID==i&&(t._channels[n].groupVolume=e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._audio.currentTime-this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupID",{get:function(){return this._groupID},set:function(t){this._groupID=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupVolume",{get:function(){return this._groupVolume},set:function(t){this._groupVolume!=t&&(this._groupVolume=t,this._audio.volume=this._groupVolume*this._volume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupPan",{get:function(){return this._groupPan},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume!=t&&(this._volume=t,this._audio.volume=this._volume)},enumerable:!0,configurable:!0}),t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isLooping=function(){return this._isLooping},t.prototype.isDecoding=function(){return!1},Object.defineProperty(t.prototype,"pan",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),t.prototype.play=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),this._isPlaying=!0,(this._isLooping||this._isLooping!=i)&&(this._isLooping=i,this._sourceDirty=!0),this._sourceDirty&&this._updateSource(),this._buffer=t,this._offset=e,this._audio.volume=this._groupVolume*this._volume,this._isQueuing||this._isOpening||this._queueBuffer()},t.prototype.stop=function(){this._audio.pause(),this._isPlaying=!1,this._isLooping=!1},t.prototype._sourceOpen=function(t){this._isOpening=!1,this._mediaSource.activeSourceBuffers.length?console.log("ERR: double sourceopen event called"):(this._sourceBuffer=this._mediaSource.addSourceBuffer("audio/mpeg"),this._sourceBuffer.addEventListener("updateend",this._updateEndDelegate),this._isPlaying&&this._queueBuffer())},t.prototype._queueBuffer=function(){this._isQueuing=!0,this._startTime=this._sourceBuffer.timestampOffset,this._sourceBuffer.appendBuffer(this._buffer)},t.prototype._updateEnd=function(t){this._isQueuing=!1,this._isLooping&&this._mediaSource.endOfStream(),this._duration=this._sourceBuffer.timestampOffset-this._startTime,this._audio.currentTime=this._startTime+this._offset,this._audio.play()},t.prototype._onTimeUpdate=function(t){!this._isLooping&&this._duration<this._audio.currentTime-this._startTime+.1&&this.stop()},t.prototype._updateSource=function(){this._mediaSource&&this._disposeSource(),this._isQueuing=!1,this._isOpening=!0,this._mediaSource=new MediaSource,this._mediaSource.addEventListener("sourceopen",this._sourceOpenDelegate),this._urlString=URL.createObjectURL(this._mediaSource),this._audio.src=this._urlString,this._audio.loop=this._isLooping,this._sourceDirty=!1},t.prototype._disposeSource=function(){this._isOpening||(this._sourceBuffer.timestampOffset&&this._sourceBuffer.remove(0,this._sourceBuffer.timestampOffset),this._sourceBuffer.removeEventListener("updateend",this._updateEndDelegate),this._mediaSource.removeSourceBuffer(this._sourceBuffer),delete this._sourceBuffer,this._sourceBuffer=null),this._mediaSource.removeEventListener("sourceopen",this._sourceOpenDelegate),URL.revokeObjectURL(this._urlString),delete this._mediaSource,this._mediaSource=null},t.maxChannels=4,t._channels=new Array,t}(),WebAudioChannel=function(){function t(e,i,r){var n=this;void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=1),this._isPlaying=!1,this._isLooping=!1,this._isDecoding=!1,this._volume=1,this._pan=0,this._groupID=0,this._groupVolume=1,this._groupPan=0,this._startTime=0,this._groupID=e,this._groupVolume=i,this._groupPan=r,this._audioCtx=t.getAudioContext(),this._usingNativePanner="function"==typeof this._audioCtx.createStereoPanner,this._gainNode=this._audioCtx.createGain(),this._gainNode.gain.value=this._groupVolume*this._volume,this._pannerNode=this._usingNativePanner?this._audioCtx.createStereoPanner():this._audioCtx.createPanner(),this._usingNativePanner?this._pannerNode.pan.value=this._pan:this._pannerNode.setPosition(Math.sin(this._pan*(Math.PI/2)),0,Math.cos(this._pan*(Math.PI/2))),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(this._audioCtx.destination),this._onEndedDelegate=function(t){return n._onEnded(t)}}return t.getAudioContext=function(){return t._audioCtx||!window.AudioContext&&!window.webkitAudioContext||(t._audioCtx=new(window.AudioContext||window.webkitAudioContext)),t._audioCtx&&"suspended"==t._audioCtx.state&&t._audioCtx.resume(),t._audioCtx},t.stopAllSounds=function(e){void 0===e&&(e=-1);var i=t._channels.length;if(e<0){for(var r=0;r<i;r++)t._channels[r].stop();t._channels.length=0}else{var n=[];for(r=0;r<i;r++)t._channels[r].groupID==e?t._channels[r].stop():n[n.length]=t._channels[r];t._channels=n}},t.setChannelGroupVolume=function(e,i){void 0===i&&(i=-1);var r=t._channels.length;if(i<0)for(var n=0;n<r;n++)t._channels[n].groupVolume=e;else for(n=0;n<r;n++)t._channels[n].groupID==i&&(t._channels[n].groupVolume=e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._isDecoding?this._currentTime:this._audioCtx.currentTime-this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupID",{get:function(){return this._groupID},set:function(t){this._groupID=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupVolume",{get:function(){return this._groupVolume},set:function(t){this._groupVolume!=t&&(this._groupVolume=t,this._gainNode.gain.value=this._groupVolume*this._volume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupPan",{get:function(){return this._groupPan},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume!=t&&(this._volume=t,this._gainNode.gain.value=this._groupVolume*this._volume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan!=t&&(this._pan=t,this._usingNativePanner?this._pannerNode.pan.value=this._pan:this._pannerNode.setPosition(Math.sin(this._pan*(Math.PI/2)),0,Math.cos(this._pan*(Math.PI/2))))},enumerable:!0,configurable:!0}),t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isLooping=function(){return this._isLooping},t.prototype.isDecoding=function(){return this._isDecoding},t.prototype.play=function(e,i,r,n){var o=this;void 0===i&&(i=0),void 0===r&&(r=!1),void 0===n&&(n=0),this._isPlaying=!0,this._isLooping=r,this._currentTime=i,this._id=n,this._isDecoding=!0,e=e.slice(0),t._decodeCache[n]?this._onDecodeComplete(t._decodeCache[n]):t._errorCache[n]?this.stop():this._audioCtx.decodeAudioData(e,(function(t){return o._onDecodeComplete(t)}),(function(t){return o._onError(t)}))},t.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._isLooping=!1,this._isDecoding=!1,this._source&&this._disposeSource())},t.prototype._onDecodeComplete=function(e){if(this._isPlaying){this._isDecoding=!1,t._decodeCache[this._id]=e,this._source&&this._disposeSource(),this._source=this._audioCtx.createBufferSource(),this._source.loop=this._isLooping,this._source.connect(this._gainNode),this._source.buffer=e,this._duration=e.duration,this._pan=0,this._startTime=this._audioCtx.currentTime-this._currentTime,this._source.onended=this._onEndedDelegate;try{this._gainNode.gain.value=this._groupVolume*this._volume,this._usingNativePanner?this._pannerNode.pan.value=this._pan:this._pannerNode.setPosition(Math.sin(this._pan*(Math.PI/2)),0,Math.cos(this._pan*(Math.PI/2))),this._source.start(this._audioCtx.currentTime,this._currentTime)}catch(t){console.log("Error starting audio: "+t),this._disposeSource()}}},t.prototype._onError=function(e){console.log("Error with decoding audio data"),t._errorCache[this._id]=!0,this.stop()},t.prototype._onEnded=function(t){this.onSoundComplete&&this.onSoundComplete(),this.stop()},t.prototype._disposeSource=function(){this._source.onended=null,this._source.stop(this._audioCtx.currentTime),this._source.disconnect(),this._source=null},t.maxChannels=64,t._channels=new Array,t._decodeCache=new Object,t._errorCache=new Object,t}(),audioCtx=WebAudioChannel.getAudioContext();if(audioCtx&&"suspended"===audioCtx.state){var resume=function(){audioCtx.resume();var t=audioCtx.createBuffer(1,1,22050),e=audioCtx.createBufferSource();e.buffer=t,e.connect(audioCtx.destination),e.start(),setTimeout((function(){"running"===audioCtx.state&&document.removeEventListener("mousedown",resume,!1)}),0)};document.addEventListener("mousedown",resume,!1)}var ErrorBase=function(){function t(t,e,i){void 0===t&&(t=""),void 0===e&&(e=0),this._errorID=0,this._messsage="",this._name="",this._messsage=t,this._name=name,this._errorID=e}return Object.defineProperty(t.prototype,"message",{get:function(){return this._messsage},set:function(t){this._messsage=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorID",{get:function(){return this._errorID},enumerable:!0,configurable:!0}),t}(),AbstractMethodError=function(t){function e(e,i){return void 0===e&&(e=null),void 0===i&&(i=0),t.call(this,e||"An abstract method was called! Either an instance of an abstract export class was created, or an abstract method was not overridden by the subclass.",i)||this}return __extends(e,t),e}(ErrorBase),ByteArrayBase=function(){function t(){this.position=0,this.length=0,this._mode=""}return t.prototype.writeByte=function(t){throw"Virtual method"},t.prototype.readByte=function(){throw"Virtual method"},t.prototype.writeUnsignedByte=function(t){throw"Virtual method"},t.prototype.readUnsignedByte=function(){throw"Virtual method"},t.prototype.writeUnsignedShort=function(t){throw"Virtual method"},t.prototype.readUnsignedShort=function(){throw"Virtual method"},t.prototype.writeUnsignedInt=function(t){throw"Virtual method"},t.prototype.readUnsignedInt=function(){throw"Virtual method"},t.prototype.writeFloat=function(t){throw"Virtual method"},t.prototype.toFloatBits=function(t){throw"Virtual method"},t.prototype.readFloat=function(t){throw"Virtual method"},t.prototype.fromFloatBits=function(t){throw"Virtual method"},t.prototype.getBytesAvailable=function(){throw new AbstractMethodError("ByteArrayBase, getBytesAvailable() not implemented ")},t.prototype.toString=function(){return"[ByteArray] ( "+this._mode+" ) position="+this.position+" length="+this.length},t.prototype.compareEqual=function(t,e){(null==e||e>this.length-this.position)&&(e=this.length-this.position),e>t.length-t.position&&(e=t.length-t.position);for(var i=!0;i&&e>=4;)e-=4,this.readUnsignedInt()!=t.readUnsignedInt()&&(i=!1);for(;i&&e>=1;)e--,this.readUnsignedByte()!=t.readUnsignedByte()&&(i=!1);return this.position-=void 0-e,t.position-=void 0-e,i},t.prototype.writeBase64String=function(t){for(var e=0;e<t.length;e++)t.charAt(e)},t.prototype.dumpToConsole=function(){var t=this.position;this.position=0;function e(t,e){for(var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r="",n=0;n<e;n++)r=i[t>>(n<<2)&15]+r;return r}for(var i=0;i<this.length;i+=8){for(var r=e(i,4)+":",n=0;n<8&&i+n<this.length;n++)r+=" "+e(this.readUnsignedByte(),2);console.log(r)}this.position=t},t.prototype.readBase64String=function(e){return(null==e||e>this.length-this.position)&&(e=this.length-this.position),e>0?t.internalGetBase64String(e,this.readUnsignedByte,this):""},t.internalGetBase64String=function(e,i,r){for(var n,o,s,a,l,h,c,u="",p=t.Base64Key;e>=3;)a=(n=i.apply(r))>>2,l=(3&n)<<4|(o=i.apply(r))>>4,h=(15&o)<<2|(s=i.apply(r))>>6,c=63&s,u+=p.charAt(a)+p.charAt(l)+p.charAt(h)+p.charAt(c),e-=3;return 2==e?(a=(n=i.apply(r))>>2,l=(3&n)<<4|(o=i.apply(r))>>4,h=(15&o)<<2,u+=p.charAt(a)+p.charAt(l)+p.charAt(h)+"="):1==e&&(a=(n=i.apply(r))>>2,l=(3&n)<<4,u+=p.charAt(a)+p.charAt(l)+"=="),u},t.Base64Key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t}(),ByteArray=function(t){function e(e){void 0===e&&(e=4);var i=t.call(this)||this;return i._mode="Typed array",i.maxlength=Math.max(e+255&-256,4),i.arraybytes=new ArrayBuffer(i.maxlength),i.unalignedarraybytestemp=new ArrayBuffer(16),i}return __extends(e,t),e.prototype.ensureWriteableSpace=function(t){this.ensureSpace(t+this.position)},e.prototype.setArrayBuffer=function(t){this.ensureSpace(t.byteLength),this.length=t.byteLength;var e=new Int8Array(t);new Int8Array(this.arraybytes,0,this.length).set(e),this.position=0},e.prototype.writeArrayBuffer=function(t){this.ensureWriteableSpace(t.byteLength);var e=new Int8Array(t);new Int8Array(this.arraybytes,this.length,t.byteLength).set(e),this.length+=t.byteLength,this.position=this.length},e.prototype.writeByteArray=function(t){this.ensureWriteableSpace(t.length);var e=new Int8Array(t.arraybytes,0,t.length);new Int8Array(this.arraybytes,this.length,t.length).set(e),this.length+=t.length,this.position=this.length},e.prototype.getBytesAvailable=function(){return this.length-this.position},e.prototype.ensureSpace=function(t){if(t>this.maxlength){var e=t+255&-256,i=new ArrayBuffer(e),r=new Uint8Array(this.arraybytes,0,this.length);new Uint8Array(i,0,this.length).set(r),this.arraybytes=i,this.maxlength=e}},e.prototype.writeObject=function(t){console.log("writeObject not implemented yet in core/ByteArray")},e.prototype.readObject=function(){return console.log("readObject not implemented yet in core/ByteArray"),{}},e.prototype.writeByte=function(t){this.ensureWriteableSpace(1),new Int8Array(this.arraybytes)[this.position++]=~~t,this.position>this.length&&(this.length=this.position)},e.prototype.readByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;return new Int8Array(this.arraybytes)[this.position++]},e.prototype.readBytes=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),null==i&&(i=t.length),t.ensureWriteableSpace(e+i);var r=new Int8Array(t.arraybytes),n=new Int8Array(this.arraybytes);r.set(n.subarray(this.position,this.position+i),e),this.position+=i,i+e>t.length&&(t.length+=i+e-t.length)},e.prototype.writeUnsignedByte=function(t){this.ensureWriteableSpace(1),new Uint8Array(this.arraybytes)[this.position++]=255&~~t,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;return new Uint8Array(this.arraybytes)[this.position++]},e.prototype.writeUnsignedShort=function(t){if(this.ensureWriteableSpace(2),0==(1&this.position)){new Uint16Array(this.arraybytes)[this.position>>1]=65535&~~t}else{new Uint16Array(this.unalignedarraybytestemp,0,1)[0]=65535&~~t;var e=new Uint8Array(this.arraybytes,this.position,2),i=new Uint8Array(this.unalignedarraybytestemp,0,2);e.set(i)}this.position+=2,this.position>this.length&&(this.length=this.position)},e.prototype.readUTFBytes=function(t){for(var e="",i=this.position+t,r=new DataView(this.arraybytes);this.position<i;){var n=r.getUint8(this.position++);if(n<128){if(0==n)break;e+=String.fromCharCode(n)}else if(n<224)e+=String.fromCharCode((63&n)<<6|127&r.getUint8(this.position++));else if(n<240){var o=r.getUint8(this.position++);e+=String.fromCharCode((31&n)<<12|(127&o)<<6|127&r.getUint8(this.position++))}else{o=r.getUint8(this.position++);var s=r.getUint8(this.position++);e+=String.fromCharCode((15&n)<<18|(127&o)<<12|s<<6&127|127&r.getUint8(this.position++))}}return e},e.prototype.writeUTFBytes=function(t){var e=encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt("0x"+e))}));this.ensureWriteableSpace(4+e.length),this.writeInt(e.length);for(var i=0;i<e.length;i++)this.writeUnsignedByte(e.charCodeAt(i));if(e.length%4){var r=e.length%4;for(i=0;i<r;i++)this.writeUnsignedByte(0)}return e.length},e.prototype.readInt=function(){var t=new DataView(this.arraybytes).getInt32(this.position,!0);return this.position+=4,t},e.prototype.readShort=function(){var t=new DataView(this.arraybytes).getInt16(this.position,!0);return this.position+=2,t},e.prototype.readDouble=function(){var t=new DataView(this.arraybytes).getFloat64(this.position,!0);return this.position+=8,t},e.prototype.readUnsignedShort=function(){if(this.position>this.length+2)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if(0==(1&this.position)){var t=new Uint16Array(this.arraybytes),e=this.position>>1;return this.position+=2,t[e]}t=new Uint16Array(this.unalignedarraybytestemp,0,1);var i=new Uint8Array(this.arraybytes,this.position,2);return new Uint8Array(this.unalignedarraybytestemp,0,2).set(i),this.position+=2,t[0]},e.prototype.writeUnsignedInt=function(t){if(this.ensureWriteableSpace(4),0==(3&this.position)){new Uint32Array(this.arraybytes)[this.position>>2]=4294967295&~~t}else{new Uint32Array(this.unalignedarraybytestemp,0,1)[0]=4294967295&~~t;var e=new Uint8Array(this.arraybytes,this.position,4),i=new Uint8Array(this.unalignedarraybytestemp,0,4);e.set(i)}this.position+=4,this.position>this.length&&(this.length=this.position)},e.prototype.writeInt=function(t){if(this.ensureWriteableSpace(4),0==(3&this.position)){new Int32Array(this.arraybytes)[this.position>>2]=~~t}else{new Int32Array(this.unalignedarraybytestemp,0,1)[0]=~~t;var e=new Uint8Array(this.arraybytes,this.position,4),i=new Uint8Array(this.unalignedarraybytestemp,0,4);e.set(i)}this.position+=4,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedInt=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;if(0==(3&this.position)){var t=new Uint32Array(this.arraybytes),e=this.position>>2;return this.position+=4,t[e]}t=new Uint32Array(this.unalignedarraybytestemp,0,1);var i=new Uint8Array(this.arraybytes,this.position,4);return new Uint8Array(this.unalignedarraybytestemp,0,4).set(i),this.position+=4,t[0]},e.prototype.writeFloat=function(t){if(this.ensureWriteableSpace(4),0==(3&this.position)){new Float32Array(this.arraybytes)[this.position>>2]=t}else{new Float32Array(this.unalignedarraybytestemp,0,1)[0]=t;var e=new Uint8Array(this.arraybytes,this.position,4),i=new Uint8Array(this.unalignedarraybytestemp,0,4);e.set(i)}this.position+=4,this.position>this.length&&(this.length=this.position)},e.prototype.readFloat=function(){if(this.position>this.length+4)throw"ByteArray out of bounds read. Positon="+this.position+", Length="+this.length;if(0==(3&this.position)){var t=new Float32Array(this.arraybytes),e=this.position>>2;return this.position+=4,t[e]}t=new Float32Array(this.unalignedarraybytestemp,0,1);var i=new Uint8Array(this.arraybytes,this.position,4);return new Uint8Array(this.unalignedarraybytestemp,0,4).set(i),this.position+=4,t[0]},e}(ByteArrayBase),ParserUtils=function(){function t(){}return t.arrayBufferToBase64=function(t,e){for(var i="",r=new Uint8Array(t),n=r.byteLength,o=0;o<n;o++)i+=String.fromCharCode(r[o]);return"data:"+e+";base64,"+window.btoa(i)},t.arrayBufferToAudio=function(e,i){var r=t.arrayBufferToBase64(e,"audio/"+i),n=new Audio;return n.src=r,n},t.arrayBufferToImage=function(e){var i=t.arrayBufferToBase64(e,"image/png"),r=new Image;return r.src=i,r},t.byteArrayToImage=function(e){var i=t.arrayBufferToBase64(e.arraybytes,"image/png"),r=new Image;return r.src=i,r},t.byteArrayToAudio=function(e,i){var r=t.arrayBufferToBase64(e.arraybytes,"audio/"+i),n=new Audio;return n.src=r,n},t.blobToImage=function(t){var e=(window.URL||window.webkitURL).createObjectURL(t),i=new Image;return i.src=e,i},t.blobToAudio=function(t){var e=(window.URL||window.webkitURL).createObjectURL(t),i=new Audio;return i.src=e,i},t.toByteArray=function(t){var e=new ByteArray;return e.setArrayBuffer(t),e},t.toString=function(t,e){if(void 0===e&&(e=0),"string"==typeof t){var i=t;if(null!=i.substr)return i.substr(0,i.length)}if(t instanceof ByteArray){var r=t;return r.position=0,r.readUTFBytes(Math.min(r.getBytesAvailable(),e))}return null},t}(),EventAudioChannel=function(){function t(t,e,i){var r=this;void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=1),this._isPlaying=!1,this._isLooping=!1,this._groupID=0,this._groupVolume=1,this._groupPan=0,this._startTime=0,this._groupID=t,this._groupVolume=e,this._groupPan=i,this._audio=new Audio,this._audio.ontimeupdate=function(t){return r._onTimeUpdate(t)}}return t.stopAllSounds=function(e){void 0===e&&(e=-1);var i=t._channels.length;if(e<0){for(var r=0;r<i;r++)t._channels[r].stop();t._channels.length=0}else{var n=[];for(r=0;r<i;r++)t._channels[r].groupID==e?t._channels[r].stop():n[n.length]=t._channels[r];t._channels=n}},t.setChannelGroupVolume=function(e,i){void 0===i&&(i=-1);var r=t._channels.length;if(i<0)for(var n=0;n<r;n++)t._channels[n].groupVolume=e;else for(n=0;n<r;n++)t._channels[n].groupID==i&&(t._channels[n].groupVolume=e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._audio.currentTime-this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pan",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupID",{get:function(){return this._groupID},set:function(t){this._groupID=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupVolume",{get:function(){return this._groupVolume},set:function(t){this._groupVolume!=t&&(this._groupVolume=t,this._audio.volume=this._groupVolume*this._volume)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupPan",{get:function(){return this._groupPan},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume!=t&&(this._volume=t,this._audio.volume=this._volume)},enumerable:!0,configurable:!0}),t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isLooping=function(){return this._isLooping},t.prototype.isDecoding=function(){return!1},t.prototype.play=function(e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=!1),void 0===n&&(n=0),this._isPlaying=!0,this._isLooping=r,this._audio.src=t._base64Cache[n]||(t._base64Cache[n]=ParserUtils.arrayBufferToBase64(e,"audio/mp3")),this._audio.loop=this._isLooping;var o=this._audio;this._audio.addEventListener("loadedmetadata",(function(){o.currentTime=i,o.play()}),!1),this._audio.addEventListener("error",(function(t){console.log("error in audio",t)}),!1),this._audio.addEventListener("error",(function(t){console.log("error in audio",t)}),!1),this._audio.addEventListener("canplay",(function(t){console.log("canplay in audio",t)}),!1),this._audio.addEventListener("canplaythrough",(function(t){console.log("canplaythrough in audio",t)}),!1),this._audio.addEventListener("abort",(function(t){console.log("abort in audio",t)}),!1),this._audio.addEventListener("loadstart",(function(t){console.log("loadstart in audio",t)}),!1),this._audio.addEventListener("suspend",(function(t){console.log("suspend in audio",t)}),!1)},t.prototype.stop=function(){this._audio.pause(),this._isPlaying=!1,this._isLooping=!1},t.prototype._onTimeUpdate=function(t){!this._isLooping&&this._audio.duration<this._audio.currentTime-this._startTime+.1&&(this.onSoundComplete&&this.onSoundComplete(),this.stop())},t.maxChannels=4,t._channels=new Array,t._base64Cache=new Object,t}(),AudioManager=function(){function t(){}return t.setVolume=function(e,i){if(void 0===i&&(i=-1),i<0)for(var r=t._channelGroupVolumes.length,n=0;n<r;n++)t._channelGroupVolumes[n]=e;else t._channelGroupVolumes[i]=e;WebAudioChannel.setChannelGroupVolume(e,i),StreamingAudioChannel.setChannelGroupVolume(e,i),EventAudioChannel.setChannelGroupVolume(e,i)},t.getVolume=function(e){return void 0===e&&(e=0),t._channelGroupVolumes[e]},t.setExternalSoundInterface=function(e){null!=e.startSound?null!=e.stopSound?t._externalSoundInterface=e:console.log("Could not set the externalSoundInterface, because it does not provide a 'stopSound' function"):console.log("Could not set the externalSoundInterface, because it does not provide a 'startSound' function")},t.getExternalSoundInterface=function(){return t._externalSoundInterface},t.stopAllSounds=function(){WebAudioChannel.stopAllSounds(),StreamingAudioChannel.stopAllSounds(),EventAudioChannel.stopAllSounds()},t.getChannel=function(e,i){void 0===i&&(i=0);var r=e>5e7?StreamingAudioChannel:WebAudioChannel;t.isIE&&(r=EventAudioChannel);for(var n=0;r._channels[n]&&r._channels[n].isPlaying();)n++;if(n==r.maxChannels){for(var o,s=r._channels.length,a=0;a<s;a++)if(!(o=r._channels[a]).isLooping()&&!o.isDecoding())return o.groupID=i,o.groupVolume=t._channelGroupVolumes[i],o.groupPan=t._channelGroupPanning[i],r._channels.push(r._channels.splice(a,1)[0]),o.stop(),o;return null}return r._channels[n]=new r(i,t._channelGroupVolumes[i],t._channelGroupPanning[i])},t.isIE=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g),t._externalSoundInterface=null,t._channelGroupVolumes=[1],t._channelGroupPanning=[.5],t}(),EventBase=function(){function t(t){this.type=void 0,this.target=void 0,this.type=t}return t.prototype.clone=function(){return new t(this.type)},t}(),AssetEvent=function(t){function e(e,i,r){void 0===r&&(r=null);var n=t.call(this,e)||this;return n._asset=i,n._prevName=r||n._asset.name,n}return __extends(e,t),Object.defineProperty(e.prototype,"asset",{get:function(){return this._asset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prevName",{get:function(){return this._prevName},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._asset,this._prevName)},e.INVALIDATE="invalidate",e.CLEAR="clear",e.RENAME="rename",e.ENTER_FRAME="enterFrame",e.EXIT_FRAME="exitFrame",e.ASSET_CONFLICT_RESOLVED="assetConflictResolved",e.ASSET_COMPLETE="assetComplete",e.TEXTURE_SIZE_ERROR="textureSizeError",e}(EventBase),EventDispatcher=function(){function t(t){void 0===t&&(t=null),this._listenerObjects=new Array,this._t=t||this}return t.prototype.addEventListener=function(t,e){var i=this._listenerObjects[t];void 0===i&&(i=this._listenerObjects[t]=new ListenerObject),i.addEventListener(e)},t.prototype.removeEventListener=function(t,e){var i=this._listenerObjects[t];i&&(i.removeEventListener(e),0==i.numListeners&&delete this._listenerObjects[t])},t.prototype.dispatchEvent=function(t){var e=this._listenerObjects[t.type];e&&(t.target=this._t,e.dispatchEvent(t))},t.prototype.hasEventListener=function(t,e){return void 0!==this._listenerObjects[t]&&(null!=e?-1!==this._listenerObjects[t].getEventListenerIndex(e):this._listenerObjects[t].numListeners>0)},t}(),ListenerObject=function(){function t(){this._index=0,this._listeners=new Array,this.numListeners=0}return t.prototype.addEventListener=function(t){-1===this.getEventListenerIndex(t)&&(this._listeners.push(t),this.numListeners++)},t.prototype.removeEventListener=function(t){var e=this.getEventListenerIndex(t);-1!==e&&(this._listeners.splice(e,1),e<=this._index&&this._index--,this.numListeners--)},t.prototype.dispatchEvent=function(t){var e=this.numListeners;for(this._index=0;this._index<e&&this._index<this.numListeners;this._index++)this._listeners[this._index](t)},t.prototype.getEventListenerIndex=function(t){for(var e=0;e<this.numListeners;e++)if(t==this._listeners[e])return e;return-1},t}(),AssetBase=function(t){function e(i){void 0===i&&(i=null);var r=t.call(this)||this;return r._id=e.ID_COUNT++,null==i&&(i="null"),r._name=i,r._originalName=i,r.updateFullPath(),r}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adapter",{get:function(){return this._adapter||this},set:function(t){this._adapter=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){throw new AbstractMethodError},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalName",{get:function(){return this._originalName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){var e;e=this._name,this._name=t,null==this._name&&(this._name="null"),this.updateFullPath(),this.dispatchEvent(new AssetEvent(AssetEvent.RENAME,this,e))},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){this.dispatchEvent(new AssetEvent(AssetEvent.INVALIDATE,this))},e.prototype.dispose=function(){throw new AbstractMethodError},e.prototype.clone=function(){throw new AbstractMethodError},e.prototype.clear=function(){this.dispatchEvent(new AssetEvent(AssetEvent.CLEAR,this))},Object.defineProperty(e.prototype,"assetNamespace",{get:function(){return this._namespace},set:function(t){this._namespace=t||e.DEFAULT_NAMESPACE,this.updateFullPath()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetFullPath",{get:function(){return this._full_path},enumerable:!0,configurable:!0}),e.prototype.assetPathEquals=function(t,e){return this._name==t&&(!e||this._namespace==e)},e.prototype.isAsset=function(t){return this.assetType==t.assetType},e.prototype.resetAssetPath=function(t,i,r){void 0===i&&(i=null),void 0===r&&(r=!0),this._name=t||"null",this._namespace=i||e.DEFAULT_NAMESPACE,r&&(this._originalName=this._name),this.updateFullPath()},e.prototype.updateFullPath=function(){this._full_path=[this._namespace,this._name]},e.ID_COUNT=0,e.DEFAULT_NAMESPACE="default",e}(EventDispatcher),WaveAudio=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this)||this;return r._volume=1,r._pan=0,r._audioChannels=[],r._loopsToPlay=0,r._isPlaying=!1,r._channelsPlaying=0,r._data=e,r._channelGroup=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopsToPlay",{get:function(){return this._loopsToPlay},set:function(t){var e=this;this._loopsToPlay!=t&&(this._loopsToPlay=t,this._audioChannel&&(this._audioChannel.onSoundComplete=function(){return e._soundCompleteInternal()}))},enumerable:!0,configurable:!0}),e.prototype._soundCompleteInternal=function(){this._loopsToPlay--,this._loopsToPlay>0?(this.stop(),this.play(0,!1)):(this._channelsPlaying>0&&this._channelsPlaying--,0==this._channelsPlaying&&(this._isPlaying=!1),this._onSoundComplete&&this._onSoundComplete())},Object.defineProperty(e.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan!=t&&(this._pan=t,this._audioChannel&&(this._audioChannel.pan=this._pan))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"channelGroup",{get:function(){return this._channelGroup},set:function(t){if(this._channelGroup!=t){this._channelGroup=t;for(var e=AudioManager.getVolume(t),i=0;i<this._audioChannels.length;i++)this._audioChannels[i].groupVolume=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this._volume!=t){this._volume=t,this._audioChannel&&(this._audioChannel.volume=this._volume);for(var e=0;e<this._audioChannels.length;e++)this._audioChannels[e].volume=this._volume}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._audioChannel?this._audioChannel.currentTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._audioChannel?this._audioChannel.duration:0},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._isPlaying=!1,this.stop()},e.prototype.play=function(t,e){var i=this;void 0===e&&(e=!1),this._isPlaying=!0,this._audioChannel=AudioManager.getChannel(this._data.size,this.channelGroup),this._audioChannel&&(this._channelsPlaying++,this._audioChannels.push(this._audioChannel),this._audioChannel.volume=this._volume,this._audioChannel.onSoundComplete=function(){return i._soundCompleteInternal()},this._data.play(this._audioChannel,t,e,this.id))},Object.defineProperty(e.prototype,"onSoundComplete",{set:function(t){var e=this;this._onSoundComplete=t,this._audioChannel&&(this._audioChannel.onSoundComplete=function(){return e._soundCompleteInternal()})},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._isPlaying=!1;for(var t=0;t<this._audioChannels.length;t++)this._audioChannels[t].stop(),delete this._audioChannels[t];this._channelsPlaying=0,this._audioChannels.length=0,this._audioChannel=null},e.prototype.clone=function(){var t=new e(this._data);return t.name=this.name,t},e.assetType="[asset WaveAudio]",e}(AssetBase),WaveAudioData=function(){function t(t){t instanceof Blob?this._blob=t:this._buffer=t instanceof ByteArray?t.arraybytes:t}return Object.defineProperty(t.prototype,"size",{get:function(){return this._buffer?this._buffer.byteLength:this._blob.size},enumerable:!0,configurable:!0}),t.prototype.play=function(t,e,i,r){var n=this;if(this._buffer)t.play(this._buffer,e,i,r);else if(!this._loading){this._loading=!0;var o=new FileReader;o.onload=function(o){return n._blobConverted(o,t,e,i,r)},o.readAsArrayBuffer(this._blob)}},t.prototype._blobConverted=function(t,e,i,r,n){this._buffer=t.target.result,e.play(this._buffer,i,r,n)},t}(),ColorUtils=function(){function t(){}return t.float32ColorToARGB=function(t){return[(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t.f32_RGBA_To_f32_ARGB=function(t){return(255&t)<<24|(4278190080&t)>>>24<<16|(16711680&t)>>>16<<8|(65280&t)>>>8},t.f32_RGB_To_f32_ARGB=function(t){return(255&t)<<24|(4278190080&t)>>>24<<16|(16711680&t)>>>16<<8|(65280&t)>>>8},t.prototype.getAlphaFromF32RGBA=function(t){return 255&t},t.ARGBtoFloat32=function(t,e,i,r){return t<<24|e<<16|i<<8|r},t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.RGBToHexString=function(e){return"#"+t.componentToHex(e[1])+t.componentToHex(e[2])+t.componentToHex(e[3])},t.ARGBToHexString=function(e){return"#"+t.componentToHex(e[0])+t.componentToHex(e[1])+t.componentToHex(e[2])+t.componentToHex(e[3])},t}(),ColorTransform=function(){function t(t,e,i,r,n,o,s,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),t instanceof Float32Array?this._rawData=t:(this._rawData=new Float32Array(8),this.redMultiplier=Number(t),this.greenMultiplier=e,this.blueMultiplier=i,this.alphaMultiplier=r,this.redOffset=n,this.greenOffset=o,this.blueOffset=s,this.alphaOffset=a)}return t.prototype.concat=function(t){this._rawData[0]*=t._rawData[0],this._rawData[1]*=t._rawData[1],this._rawData[2]*=t._rawData[2],this._rawData[3]*=t._rawData[3],this._rawData[4]+=t._rawData[4],this._rawData[5]+=t._rawData[5],this._rawData[6]+=t._rawData[6],this._rawData[7]+=t._rawData[7]},Object.defineProperty(t.prototype,"alphaMultiplier",{get:function(){return this._rawData[3]},set:function(t){this._rawData[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaOffset",{get:function(){return this._rawData[7]},set:function(t){this._rawData[7]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blueMultiplier",{get:function(){return this._rawData[2]},set:function(t){this._rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blueOffset",{get:function(){return this._rawData[6]},set:function(t){this._rawData[6]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"greenMultiplier",{get:function(){return this._rawData[1]},set:function(t){this._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"greenOffset",{get:function(){return this._rawData[5]},set:function(t){this._rawData[5]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"redMultiplier",{get:function(){return this._rawData[0]},set:function(t){this._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"redOffset",{get:function(){return this._rawData[4]},set:function(t){this._rawData[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._rawData[4]<<16|this._rawData[5]<<8|this._rawData[6]},set:function(t){var e=ColorUtils.float32ColorToARGB(t);this._rawData[4]=e[1],this._rawData[5]=e[2],this._rawData[6]=e[3],this._rawData[0]=1,this._rawData[1]=1,this._rawData[2]=1},enumerable:!0,configurable:!0}),t.prototype.copyRawDataFrom=function(t){var e=this._rawData;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]},t.prototype.clear=function(){this._rawData[0]=1,this._rawData[1]=1,this._rawData[2]=1,this._rawData[3]=1,this._rawData[4]=0,this._rawData[5]=0,this._rawData[6]=0,this._rawData[7]=0},t.prototype.clone=function(){var e=new t;return e.copyFrom(this),e},t.prototype.copyFrom=function(t){var e=t._rawData,i=this._rawData;i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7]},t.prototype.copyTo=function(t){t.copyFrom(this)},t.prototype.prepend=function(t){this._rawData[4]+=t._rawData[4]*this._rawData[0],this._rawData[5]+=t._rawData[5]*this._rawData[1],this._rawData[6]+=t._rawData[6]*this._rawData[2],this._rawData[7]+=t._rawData[7]*this._rawData[3],this.redMultiplier*=t.redMultiplier,this.greenMultiplier*=t.greenMultiplier,this.blueMultiplier*=t.blueMultiplier,this.alphaMultiplier*=t.alphaMultiplier},t.prototype._isRenderable=function(){return 0!=this._rawData[3]||this._rawData[7]>0},t}(),Point=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._rawData=new Float32Array(2),this._rawData[0]=t,this._rawData[1]=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._rawData[0]},set:function(t){this._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._rawData[1]},set:function(t){this._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this._rawData[0]*this._rawData[0]+this._rawData[1]*this._rawData[1])},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this._rawData[0]+e._rawData[0],this._rawData[1]+e._rawData[1])},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){this._rawData[0]=t._rawData[0],this._rawData[1]=t._rawData[1]},t.prototype.equals=function(t){return this._rawData[0]===t._rawData[0]&&this._rawData[1]==t._rawData[1]},t.prototype.normalize=function(t){void 0===t&&(t=1);var e=this.length;if((0!==this.x||0!==this.y)&&e){var i=t/e;this._rawData[0]*=i,this._rawData[1]*=i}},t.prototype.offset=function(t,e){this._rawData[0]+=t,this._rawData[1]+=e},t.prototype.setTo=function(t,e){this._rawData[0]=t,this._rawData[1]=e},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.toString=function(){return"[Point] (x="+this.x+", y="+this.y+")"},t.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return 0===i?Math.abs(r):0===r?Math.abs(i):Math.sqrt(i*i+r*r)},t.interpolate=function(e,i,r){var n=1-r,o=e._rawData,s=i._rawData;return new t(o[0]*r+s[0]*n,o[1]*r+s[1]*n)},t.polar=function(e,i){return new t(e*Math.cos(i),e*Math.sin(i))},t}(),ArgumentError=function(t){function e(e,i){return void 0===e&&(e=null),void 0===i&&(i=0),t.call(this,e||"ArgumentError",i)||this}return __extends(e,t),e}(ErrorBase),Matrix=function(){function t(t,e,i,r,n,o){if(void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),this.rawData=new Float32Array(6),t instanceof Float32Array)this.copyRawDataFrom(t);else{var s=this.rawData;s[0]=Number(t),s[1]=e,s[2]=i,s[3]=r,s[4]=n,s[5]=o}}return Object.defineProperty(t.prototype,"a",{get:function(){return this.rawData[0]},set:function(t){this.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.rawData[1]},set:function(t){this.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"c",{get:function(){return this.rawData[2]},set:function(t){this.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"d",{get:function(){return this.rawData[3]},set:function(t){this.rawData[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tx",{get:function(){return this.rawData[4]},set:function(t){this.rawData[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ty",{get:function(){return this.rawData[5]},set:function(t){this.rawData[5]=t},enumerable:!0,configurable:!0}),t.prototype.copyRawDataFrom=function(t,e){var i=this.rawData;i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5]},t.prototype.clone=function(){var e=this.rawData;return new t(e[0],e[1],e[2],e[3],e[4],e[5])},t.prototype.concat=function(t){var e=this.rawData,i=t.rawData,r=e[0]*i[0],n=0,o=0,s=e[3]*i[3],a=e[4]*i[0]+i[4],l=e[5]*i[3]+i[5];0===e[1]&&0===e[2]&&0===i[1]&&0===i[2]||(r+=e[1]*i[2],s+=e[2]*i[1],n+=e[0]*i[1]+e[1]*i[3],o+=e[2]*i[0]+e[3]*i[2],a+=e[5]*i[2],l+=e[4]*i[1]),e[0]=r,e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l},t.prototype.copyColumnFrom=function(t,e){var i=this.rawData,r=e._rawData;if(t>2)throw"Column "+t+" out of bounds (2)";0==t?(i[0]=r[0],i[1]=r[1]):1==t?(i[2]=r[0],i[3]=r[1]):(i[4]=r[0],i[5]=r[1])},t.prototype.copyColumnTo=function(t,e){var i=this.rawData,r=e._rawData;if(t>2)throw new ArgumentError("ArgumentError, Column "+t+" out of bounds [0, ..., 2]");0==t?(r[0]=i[0],r[1]=i[1],r[2]=0):1==t?(r[0]=i[2],r[1]=i[3],r[2]=0):(r[0]=i[4],r[1]=i[5],r[2]=1)},t.prototype.copyFrom=function(t){var e=this.rawData,i=t.rawData;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5]},t.prototype.copyRowFrom=function(t,e){var i=this.rawData,r=e._rawData;if(t>2)throw new ArgumentError("ArgumentError, Row "+t+" out of bounds [0, ..., 2]");0==t?(i[0]=r[0],i[2]=r[1],i[4]=r[2]):(i[1]=r[0],i[3]=r[1],i[5]=r[2])},t.prototype.copyRowTo=function(t,e){var i=this.rawData,r=e._rawData;if(t>2)throw new ArgumentError("ArgumentError, Row "+t+" out of bounds [0, ..., 2]");0==t?(r[0]=i[0],r[1]=i[2],r[2]=i[4]):1==t?(r[0]=i[1],r[1]=i[3],r[2]=i[5]):(r[0]=0,r[1]=0,r[2]=1)},t.prototype.createBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0);var o=this.rawData;if(0!==i){var s=Math.cos(i),a=Math.sin(i);o[0]=s*t,o[1]=a*e,o[2]=-a*t,o[3]=s*e}else o[0]=t,o[1]=0,o[2]=0,o[3]=e;o[4]=r,o[5]=n},t.prototype.createGradientBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this.createBox(t/1638.4,e/1638.4,i,r+t/2,n+e/2)},t.prototype.deltaTransformPoint=function(t){var e=this.rawData;return new Point(t.x*e[0]+t.y*e[2],t.x*e[1]+t.y*e[3])},t.prototype.identity=function(){var t=this.rawData;t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0},t.prototype.invert=function(){var t=this.rawData,e=t[1],i=t[2],r=t[4],n=t[5];if(0===e&&0===i){var o=t[0]=1/t[0],s=t[3]=1/t[3];return t[1]=t[2]=0,t[4]=-o*r,void(t[5]=-s*n)}var a=(o=t[0])*(s=t[3])-e*i;if(0!==a){a=1/a;var l;l=t[0]=s*a,e=t[1]=-e*a,i=t[2]=-i*a,s=t[3]=o*a,t[4]=-(l*r+i*n),t[5]=-(e*r+s*n)}else this.identity()},t.prototype.multiply=function(e){var i=new t;return i.a=this.a*e.a+this.b*e.c,i.b=this.a*e.b+this.b*e.d,i.c=this.c*e.a+this.d*e.c,i.d=this.c*e.b+this.d*e.d,i.tx=this.tx*e.a+this.ty*e.c+e.tx,i.ty=this.tx*e.b+this.ty*e.d+e.ty,i},t.prototype.rotate=function(t){if(0!==t){var e=this.rawData,i=Math.cos(t),r=Math.sin(t),n=e[0],o=e[1],s=e[2],a=e[3],l=e[4],h=e[5];e[0]=n*i-o*r,e[1]=n*r+o*i,e[2]=s*i-a*r,e[3]=s*r+a*i,e[4]=l*i-h*r,e[5]=l*r+h*i}},t.prototype.scale=function(t,e){var i=this.rawData;1!==t&&(i[0]*=t,i[1]*=t,i[4]*=t),1!==e&&(i[2]*=e,i[3]*=e,i[5]*=e)},t.prototype.setTo=function(t,e,i,r,n,o){var s=this.rawData;s[0]=t,s[2]=e,s[1]=i,s[3]=r,s[4]=n,s[5]=o},t.prototype.toString=function(){return"[Matrix] (a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},t.prototype.transformPoint=function(t){var e=this.rawData;return new Point(t.x*e[0]+t.y*e[2]+e[4],t.x*e[1]+t.y*e[3]+e[5])},t.prototype.translate=function(t,e){this.rawData[4]+=t,this.rawData[5]+=e},t}(),Vector3D=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this._rawData=new Float32Array(4);var n=this._rawData;n[0]=t,n[1]=e,n[2]=i,n[3]=r}return Object.defineProperty(t.prototype,"x",{get:function(){return this._rawData[0]},set:function(t){this._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._rawData[1]},set:function(t){this._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._rawData[2]},set:function(t){this._rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._rawData[3]},set:function(t){this._rawData[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSquared)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSquared",{get:function(){var t=this._rawData;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},enumerable:!0,configurable:!0}),t.prototype.add=function(e){var i=this._rawData,r=e._rawData;return new t(i[0]+r[0],i[1]+r[1],i[2]+r[2])},t.angleBetween=function(t,e){return Math.acos(t.dotProduct(e)/(t.length*e.length))},t.prototype.clone=function(){var e=this._rawData;return new t(e[0],e[1],e[2],e[3])},t.combine=function(e,i,r,n){var o=e._rawData,s=i._rawData;return new t(o[0]*r+s[0]*n,o[1]*r+s[1]*n,o[2]*r+s[2]*n)},t.prototype.copyFrom=function(t){var e=this._rawData,i=t._rawData;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},t.prototype.crossProduct=function(e,i){void 0===i&&(i=null),null==i&&(i=new t);var r=this._rawData,n=e._rawData,o=i._rawData;return o[0]=r[1]*n[2]-r[2]*n[1],o[1]=r[2]*n[0]-r[0]*n[2],o[2]=r[0]*n[1]-r[1]*n[0],i},t.prototype.decrementBy=function(t){var e=this._rawData,i=t._rawData;e[0]-=i[0],e[1]-=i[1],e[2]-=i[2]},t.distance=function(t,e){var i=t._rawData,r=e._rawData,n=i[0]-r[0],o=i[1]-r[1],s=i[2]-r[2];return Math.sqrt(n*n+o*o+s*s)},t.prototype.dotProduct=function(t){var e=this._rawData,i=t._rawData;return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},t.prototype.equals=function(t,e){void 0===e&&(e=!1);var i=this._rawData,r=t._rawData;return i[0]==r[0]&&i[1]==r[1]&&i[2]==r[2]&&(!e||i[3]==r[3])},t.prototype.identity=function(){var t=this._rawData;t[0]=0,t[1]=0,t[2]=0,t[3]=1},t.prototype.incrementBy=function(t){var e=this._rawData,i=t._rawData;e[0]+=i[0],e[1]+=i[1],e[2]+=i[2]},t.prototype.nearEquals=function(t,e,i){void 0===i&&(i=!0);var r=this._rawData,n=t._rawData;return Math.abs(r[0]-n[0])<e&&Math.abs(r[1]-n[1])<e&&Math.abs(r[2]-n[2])<e&&(!i||Math.abs(r[3]-n[3])<e)},t.prototype.negate=function(){var t=this._rawData;t[0]=-t[0],t[1]=-t[1],t[2]=-t[2]},t.prototype.normalize=function(t){void 0===t&&(t=1);var e=this.length;if(e){var i=this._rawData,r=t/e;i[0]*=r,i[1]*=r,i[2]*=r}return e},t.prototype.project=function(){var t=this._rawData;t[0]/=t[3],t[1]/=t[3],t[2]/=t[3]},t.prototype.scaleBy=function(t){var e=this._rawData;e[0]*=t,e[1]*=t,e[2]*=t},t.prototype.setTo=function(t,e,i,r){void 0===r&&(r=1);var n=this._rawData;n[0]=t,n[1]=e,n[2]=i,n[3]=r},t.prototype.subtract=function(e){var i=this._rawData,r=e._rawData;return new t(i[0]-r[0],i[1]-r[1],i[2]-r[2])},t.prototype.toString=function(){var t=this._rawData;return"[Vector3D] (x:"+t[0]+" ,y:"+t[1]+", z"+t[2]+", w:"+t[3]+")"},t.X_AXIS=new t(1,0,0),t.Y_AXIS=new t(0,1,0),t.Z_AXIS=new t(0,0,1),t}(),Box=function(){function t(t,e,i,r,n,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),this.x=t,this.y=e,this.z=i,this.width=r,this.height=n,this.depth=o}return Object.defineProperty(t.prototype,"back",{get:function(){return this.z+this.depth},set:function(t){this.depth=t-this.z},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRightBack",{get:function(){return null==this._bottomRightBack&&(this._bottomRightBack=new Vector3D),this._bottomRightBack.x=this.x+this.width,this._bottomRightBack.y=this.y+this.height,this._bottomRightBack.z=this.z+this.depth,this._bottomRightBack},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"front",{get:function(){return this.z},set:function(t){this.depth+=this.z-t,this.z=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return null==this._size&&(this._size=new Vector3D),this._size.x=this.width,this._size.y=this.height,this._size.z=this.depth,this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeftFront",{get:function(){return null==this._topLeftFront&&(this._topLeftFront=new Vector3D),this._topLeftFront.x=this.x,this._topLeftFront.y=this.y,this._topLeftFront.z=this.z,this._topLeftFront},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.width,this.height,this.depth)},t.prototype.contains=function(t,e,i){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e&&this.z<=i&&this.z+this.depth>=i},t.prototype.containsPoint=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y&&this.z<=t.z&&this.z+this.depth>=t.z},t.prototype.containsBox=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height&&this.z<=t.z&&this.z+this.depth>=t.z+t.depth},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.width=t.width,this.height=t.height,this.depth=t.depth},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z&&this.width==t.width&&this.height==t.height&&this.depth==t.depth},t.prototype.inflate=function(t,e,i){this.x-=t/2,this.y-=e/2,this.z-=i/2,this.width+=t/2,this.height+=e/2,this.depth+=i/2},t.prototype.inflatePoint=function(t){this.x-=t.x/2,this.y-=t.y/2,this.z-=t.z/2,this.width+=t.x/2,this.height+=t.y/2,this.depth+=t.z/2},t.prototype.intersection=function(e){if(this.intersects(e)){var i=new t;return this.x>e.x?(i.x=this.x,i.width=e.x-this.x+e.width,i.width>this.width&&(i.width=this.width)):(i.x=e.x,i.width=this.x-e.x+this.width,i.width>e.width&&(i.width=e.width)),this.y>e.y?(i.y=this.y,i.height=e.y-this.y+e.height,i.height>this.height&&(i.height=this.height)):(i.y=e.y,i.height=this.y-e.y+this.height,i.height>e.height&&(i.height=e.height)),this.z>e.z?(i.z=this.z,i.depth=e.z-this.z+e.depth,i.depth>this.depth&&(i.depth=this.depth)):(i.z=e.z,i.depth=this.z-e.z+this.depth,i.depth>e.depth&&(i.depth=e.depth)),i}return new t},t.prototype.intersects=function(t){return this.x+this.width>=t.x&&this.x<=t.x+t.width&&this.y+this.height>=t.y&&this.y<=t.y+t.height&&this.z+this.depth>=t.z&&this.z<=t.z+t.depth},t.prototype.rayIntersection=function(t,e,i){if(void 0===i&&(i=null),this.containsPoint(t))return 0;var r,n,o,s,a,l=this.width/2,h=this.height/2,c=this.depth/2,u=this.x+l,p=this.y+h,d=this.z+c,f=t.x-u,_=t.y-p,g=t.z-d,m=e.x,y=e.y,v=e.z;return m<0&&(s=(l-f)/m)>0&&(o=g+s*v,(n=_+s*y)>-h&&n<h&&o>-c&&o<c&&(i&&(i.x=1,i.y=0,i.z=0),a=!0)),!a&&m>0&&(s=(-l-f)/m)>0&&(o=g+s*v,(n=_+s*y)>-h&&n<h&&o>-c&&o<c&&(i&&(i.x=-1,i.y=0,i.z=0),a=!0)),!a&&y<0&&(s=(h-_)/y)>0&&(o=g+s*v,(r=f+s*m)>-l&&r<l&&o>-c&&o<c&&(i&&(i.x=0,i.y=1,i.z=0),a=!0)),!a&&y>0&&(s=(-h-_)/y)>0&&(o=g+s*v,(r=f+s*m)>-l&&r<l&&o>-c&&o<c&&(i&&(i.x=0,i.y=-1,i.z=0),a=!0)),!a&&v<0&&(s=(c-g)/v)>0&&(r=f+s*m,(n=_+s*y)>-h&&n<h&&r>-l&&r<l&&(i&&(i.x=0,i.y=0,i.z=1),a=!0)),!a&&v>0&&(s=(-c-g)/v)>0&&(r=f+s*m,(n=_+s*y)>-h&&n<h&&r>-l&&r<l&&(i&&(i.x=0,i.y=0,i.z=-1),a=!0)),a?s:-1},t.prototype.closestPointToPoint=function(t,e){var i;return void 0===e&&(e=null),null==e&&(e=new Vector3D),(i=t.x)<this.x&&(i=this.x),i>this.x+this.width&&(i=this.x+this.width),e.x=i,(i=t.y)<this.y+this.height&&(i=this.y+this.height),i>this.y&&(i=this.y),e.y=i,(i=t.z)<this.z&&(i=this.z),i>this.z+this.depth&&(i=this.z+this.depth),e.z=i,e},t.prototype.offset=function(t,e,i){this.x+=t,this.y+=e,this.z+=i},t.prototype.offsetPosition=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},t.prototype.identity=function(){this.x=0,this.y=0,this.z=0,this.width=0,this.height=0,this.depth=0},t.prototype.setTo=function(t,e,i,r,n,o){this.x=t,this.y=e,this.z=i,this.width=r,this.height=n,this.depth=o},t.prototype.toString=function(){return"[Box] (x="+this.x+", y="+this.y+", z="+this.z+", width="+this.width+", height="+this.height+", depth="+this.depth+")"},t.prototype.union=function(e,i){var r,n,o;return void 0===i&&(i=null),null==i&&(i=new t),null==e?(i.copyFrom(this),i):(this.x<e.x?(r=e.x-this.x+e.width,i.x=this.x,i.width=r<this.width?this.width:r):(r=this.x-e.x+this.width,i.x=e.x,i.width=r<e.width?e.width:r),this.y<e.y?(n=e.y-this.y+e.height,i.y=this.y,i.height=n<this.height?this.height:n):(n=this.y-e.y+this.height,i.y=e.y,i.height=n<e.height?e.height:n),this.z<e.z?(o=e.z-this.z+e.depth,i.z=this.z,i.depth=o<this.depth?this.depth:o):(o=this.z-e.z+this.depth,i.z=e.z,i.depth=o<e.depth?e.depth:o),i)},t}(),MathConsts=function(){function t(){}return t.RADIANS_TO_DEGREES=180/Math.PI,t.DEGREES_TO_RADIANS=Math.PI/180,t}(),Orientation3D=function(){function t(){}return t.AXIS_ANGLE="axisAngle",t.EULER_ANGLES="eulerAngles",t.QUATERNION="quaternion",t}(),Sphere=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=i,this.radius=r}return t.prototype.rayIntersection=function(t,e,i){if(this.containsPoint(t))return 0;var r,n=t.x-this.x,o=t.y-this.y,s=t.z-this.z,a=e.x,l=e.y,h=e.z,c=a*a+l*l+h*h,u=2*(n*a+o*l+s*h),p=u*u-4*c*(n*n+o*o+s*s-this.radius*this.radius);if(p>=0&&(r=(-u-Math.sqrt(p))/(2*c))>=0)return i.x=n+r*a,i.y=o+r*l,i.z=s+r*h,i.normalize(),r;return-1},t.prototype.containsPoint=function(t){var e=t.x-this.x,i=t.y-this.y,r=t.z-this.z;return Math.sqrt(e*e+i*i+r*r)<=this.radius},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.radius=t.radius},t.prototype.union=function(e,i){if(void 0===i&&(i=null),null==i&&(i=new t),null==e)return i.copyFrom(this),i;var r=e.x-this.x,n=e.y-this.y,o=e.z-this.z;return i.radius=(Math.sqrt(r*r+n*n+o*o)+e.radius+this.radius)/2,i.x=this.x+r/2,i.y=this.y+n/2,i.z=this.z+o/2,i},t.prototype.toString=function(){return"Sphere [x:"+this.x+", y:"+this.y+", z:"+this.z+", radius:"+this.radius+"]"},t}(),Matrix3D=function(){function t(t){void 0===t&&(t=null),this._position=new Vector3D,this._positionDirty=!0,null!=t?this._rawData=t:(this._rawData=new Float32Array(16),this.identity())}return t.getAxisRotationMatrix=function(e,i,r,n,o){void 0===o&&(o=null),null==o&&(o=new t);var s,a,l=o._rawData,h=n*MathConsts.DEGREES_TO_RADIANS,c=Math.cos(h),u=Math.sin(h),p=1-c;return l[0]=c+e*e*p,l[5]=c+i*i*p,l[10]=c+r*r*p,s=e*i*p,a=r*u,l[1]=s+a,l[4]=s-a,s=e*r*p,a=i*u,l[8]=s+a,l[2]=s-a,s=i*r*p,a=e*u,l[9]=s-a,l[6]=s+a,l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,o.invalidatePosition(),o},t.getPointAtMatrix=function(e,i,r,n){var o,s,a;void 0===n&&(n=null),null==n&&(n=new t);var l=n._rawData;return(o=i.clone()).normalize(),(s=r.clone()).normalize(),(a=s.crossProduct(o)).normalize(),a.length<.05&&(a.x=s.y,a.y=s.x,a.z=0,a.normalize()),s=o.crossProduct(a),l[0]=a.x,l[1]=a.y,l[2]=a.z,l[3]=0,l[4]=s.x,l[5]=s.y,l[6]=s.z,l[7]=0,l[8]=o.x,l[9]=o.y,l[10]=o.z,l[11]=0,l[12]=a.dotProduct(e),l[13]=s.dotProduct(e),l[14]=o.dotProduct(e),l[15]=1,n.invalidatePosition(),n},t.getQuaternionMatrix=function(e,i){void 0===i&&(i=null),null==i&&(i=new t);var r=i._rawData,n=e.x,o=e.y,s=e.z,a=e.w,l=n*n,h=n*o,c=n*s,u=n*a,p=o*o,d=o*s,f=o*a,_=s*s,g=s*a;return r[0]=1-2*(p+_),r[1]=2*(h+g),r[2]=2*(c-f),r[4]=2*(h-g),r[5]=1-2*(l+_),r[6]=2*(d+u),r[8]=2*(c+f),r[9]=2*(d-u),r[10]=1-2*(l+p),r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,i.invalidatePosition(),i},t.compare=function(t,e){for(var i=t._rawData,r=e._rawData,n=0;n<16;++n)if(i[n]!=r[n])return!1;return!0},Object.defineProperty(t.prototype,"determinant",{get:function(){var t=this._rawData;return(t[0]*t[5]-t[4]*t[1])*(t[10]*t[15]-t[14]*t[11])-(t[0]*t[9]-t[8]*t[1])*(t[6]*t[15]-t[14]*t[7])+(t[0]*t[13]-t[12]*t[1])*(t[6]*t[11]-t[10]*t[7])+(t[4]*t[9]-t[8]*t[5])*(t[2]*t[15]-t[14]*t[3])-(t[4]*t[13]-t[12]*t[5])*(t[2]*t[11]-t[10]*t[3])+(t[8]*t[13]-t[12]*t[9])*(t[2]*t[7]-t[6]*t[3])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._positionDirty&&(this._positionDirty=!1,this._position.x=this._rawData[12],this._position.y=this._rawData[13],this._position.z=this._rawData[14]),this._position},enumerable:!0,configurable:!0}),t.prototype.append=function(t){var e=this._rawData,i=t._rawData,r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],h=e[6],c=e[7],u=e[8],p=e[9],d=e[10],f=e[11],_=e[12],g=e[13],m=e[14],y=e[15],v=i[0],b=i[1],x=i[2],A=i[3],E=i[4],S=i[5],T=i[6],P=i[7],C=i[8],w=i[9],D=i[10],M=i[11],O=i[12],I=i[13],L=i[14],N=i[15];e[0]=r*v+n*E+o*C+s*O,e[1]=r*b+n*S+o*w+s*I,e[2]=r*x+n*T+o*D+s*L,e[3]=r*A+n*P+o*M+s*N,e[4]=a*v+l*E+h*C+c*O,e[5]=a*b+l*S+h*w+c*I,e[6]=a*x+l*T+h*D+c*L,e[7]=a*A+l*P+h*M+c*N,e[8]=u*v+p*E+d*C+f*O,e[9]=u*b+p*S+d*w+f*I,e[10]=u*x+p*T+d*D+f*L,e[11]=u*A+p*P+d*M+f*N,e[12]=_*v+g*E+m*C+y*O,e[13]=_*b+g*S+m*w+y*I,e[14]=_*x+g*T+m*D+y*L,e[15]=_*A+g*P+m*M+y*N,this._positionDirty=!0},t.prototype.appendRotation=function(e,i){this.append(t.getAxisRotationMatrix(i.x,i.y,i.z,e,t._tempMatrix))},t.prototype.appendSkew=function(e,i,r){if(0!=e||0!=i||0!=r){var n=t._tempMatrix._rawData;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=e,n[5]=1,n[6]=0,n[7]=0,n[8]=i,n[9]=r,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this.append(t._tempMatrix)}},t.prototype.appendScale=function(e,i,r){if(1!=e||1!=i||1!=r){var n=t._tempMatrix._rawData;n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this.append(t._tempMatrix)}},t.prototype.appendTranslation=function(t,e,i){var r=this._rawData,n=r[3],o=r[7],s=r[11],a=r[15];r[0]+=t*n,r[1]+=e*n,r[2]+=i*n,r[4]+=t*o,r[5]+=e*o,r[6]+=i*o,r[8]+=t*s,r[9]+=e*s,r[10]+=i*s,r[12]+=t*a,r[13]+=e*a,r[14]+=i*a,this._positionDirty=!0},t.prototype.clone=function(){var e=new t;return e.copyFrom(this),e},t.prototype.copyColumnFrom=function(t,e){if(t<0||t>3)throw new ArgumentError("ArgumentError, Column "+t+" out of bounds [0, ..., 3]");var i=this._rawData,r=e._rawData;i[t*=4]=r[0],i[t+1]=r[1],i[t+2]=r[2],i[t+3]=r[3],this._positionDirty=!0},t.prototype.copyColumnTo=function(t,e,i){if(void 0===i&&(i=!1),t<0||t>3)throw new ArgumentError("ArgumentError, Column "+t+" out of bounds [0, ..., 3]");t*=4;var r=this._rawData,n=e._rawData;i?(n[0]=-r[t],n[1]=-r[t+1],n[2]=-r[t+2],n[3]=-r[t+3]):(n[0]=r[t],n[1]=r[t+1],n[2]=r[t+2],n[3]=r[t+3])},t.prototype.copyFrom=function(t,e){void 0===e&&(e=!1);var i=t._rawData,r=this._rawData;r[0]=i[0],r[5]=i[5],r[10]=i[10],r[15]=i[15],e?(r[1]=i[4],r[2]=i[8],r[3]=i[12],r[4]=i[1],r[6]=i[9],r[7]=i[13],r[8]=i[2],r[9]=i[6],r[11]=i[14],r[12]=i[3],r[13]=i[7],r[14]=i[11]):(r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14]),this._positionDirty=!0},t.prototype.copyTo=function(t,e){void 0===e&&(e=!1),t.copyFrom(this,e)},t.prototype.copyRawDataFrom=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1);var r=this._rawData;r[0]=t[e+0],r[5]=t[e+5],r[10]=t[e+10],r[15]=t[e+15],i?(r[e+1]=t[4],r[e+2]=t[8],r[e+3]=t[12],r[e+4]=t[1],r[e+6]=t[9],r[e+7]=t[13],r[e+8]=t[2],r[e+9]=t[6],r[e+11]=t[14],r[e+12]=t[3],r[e+13]=t[7],r[e+14]=t[11]):(r[1]=t[e+1],r[2]=t[e+2],r[3]=t[e+3],r[4]=t[e+4],r[6]=t[e+6],r[7]=t[e+7],r[8]=t[e+8],r[9]=t[e+9],r[11]=t[e+11],r[12]=t[e+12],r[13]=t[e+13],r[14]=t[e+14]),this._positionDirty=!0},t.prototype.copyRawDataTo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1);var r=this._rawData;t[e]=r[0],t[e+5]=r[5],t[e+10]=r[10],t[e+15]=r[15],i?(t[e+1]=r[4],t[e+2]=r[8],t[e+3]=r[12],t[e+4]=r[1],t[e+6]=r[9],t[e+7]=r[13],t[e+8]=r[2],t[e+9]=r[6],t[e+11]=r[14],t[e+12]=r[3],t[e+13]=r[7],t[e+14]=r[11]):(t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14])},t.prototype.copyRowFrom=function(t,e){if(t<0||t>3)throw new ArgumentError("ArgumentError, Row "+t+" out of bounds [0, ..., 3]");var i=this._rawData,r=e._rawData;i[t]=r[0],i[t+4]=r[1],i[t+8]=r[2],i[t+12]=r[3],this._positionDirty=!0},t.prototype.copyRowTo=function(t,e,i){if(void 0===i&&(i=!1),t<0||t>3)throw new ArgumentError("ArgumentError, Row "+t+" out of bounds [0, ..., 3]");var r=this._rawData,n=e._rawData;i?(n[0]=-r[t],n[1]=-r[t+4],n[2]=-r[t+8],n[3]=-r[t+12]):(n[0]=r[t],n[1]=r[t+4],n[2]=r[t+8],n[3]=r[t+12])},t.prototype.decompose=function(t){void 0===t&&(t="eulerAngles"),null==this._components&&(this._components=[new Vector3D,new Vector3D,new Vector3D,new Vector3D]);var e=new Vector3D(this._rawData[0],this._rawData[1],this._rawData[2]),i=new Vector3D(this._rawData[4],this._rawData[5],this._rawData[6]),r=new Vector3D(this._rawData[8],this._rawData[9],this._rawData[10]),n=this._components[3],o=this._components[2];n.x=e.length,e.scaleBy(1/n.x),o.x=e.dotProduct(i),i=Vector3D.combine(i,e,1,-o.x),n.y=i.length,i.scaleBy(1/n.y),o.x/=n.y,o.y=e.dotProduct(r),r=Vector3D.combine(r,e,1,-o.y),o.z=i.dotProduct(r),r=Vector3D.combine(r,i,1,-o.z),n.z=r.length,r.scaleBy(1/n.z),o.y/=n.z,o.z/=n.z,e.dotProduct(i.crossProduct(r))<0&&(n.z=-n.z,r.x=-r.x,r.y=-r.y,r.z=-r.z);var s=this._components[1];switch(t){case Orientation3D.AXIS_ANGLE:s.w=Math.acos((e.x+i.y+r.z-1)/2);var a=Math.sqrt((i.z-r.y)*(i.z-r.y)+(r.x-e.z)*(r.x-e.z)+(e.y-i.x)*(e.y-i.x));s.x=(i.z-r.y)/a,s.y=(r.x-e.z)/a,s.z=(e.y-i.x)/a;break;case Orientation3D.QUATERNION:var l=e.x+i.y+r.z;l>0?(s.w=Math.sqrt(1+l)/2,s.x=(i.z-r.y)/(4*s.w),s.y=(r.x-e.z)/(4*s.w),s.z=(e.y-i.x)/(4*s.w)):e.x>i.y&&e.x>r.z?(s.x=Math.sqrt(1+e.x-i.y-r.z)/2,s.w=(i.z-r.y)/(4*s.x),s.y=(e.y+i.x)/(4*s.x),s.z=(r.x+e.z)/(4*s.x)):i.y>r.z?(s.y=Math.sqrt(1+i.y-e.x-r.z)/2,s.x=(e.y+i.x)/(4*s.y),s.w=(r.x-e.z)/(4*s.y),s.z=(i.z+r.y)/(4*s.y)):(s.z=Math.sqrt(1+r.z-e.x-i.y)/2,s.x=(r.x+e.z)/(4*s.z),s.y=(i.z+r.y)/(4*s.z),s.w=(e.y-i.x)/(4*s.z));break;case Orientation3D.EULER_ANGLES:s.y=Math.asin(-e.z),1!=e.z&&-1!=e.z?(s.x=Math.atan2(i.z,r.z),s.z=Math.atan2(e.y,e.x)):(s.z=0,s.x=Math.atan2(i.x,i.y))}return this._components[0].copyFrom(this.position),this._components},t.prototype.deltaTransformVector=function(t,e){void 0===e&&(e=null);var i=t.x,r=t.y,n=t.z;e||(e=new Vector3D);var o=this._rawData,s=e._rawData;return s[0]=i*o[0]+r*o[4]+n*o[8],s[1]=i*o[1]+r*o[5]+n*o[9],s[2]=i*o[2]+r*o[6]+n*o[10],s[3]=i*o[3]+r*o[7]+n*o[11],e},t.prototype.deltaTransformVectors=function(t,e){for(var i=this._rawData,r=i[0],n=i[1],o=i[2],s=(i[3],i[4]),a=i[5],l=i[6],h=(i[7],i[8]),c=i[9],u=i[10],p=(i[11],0),d=t.length,f=0;f<d;f+=3){var _=t[f],g=t[f+1],m=t[f+2];e[p++]=r*_+s*g+h*m,e[p++]=n*_+a*g+c*m,e[p++]=o*_+l*g+u*m}},t.prototype.identity=function(){var t=this._rawData;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this._positionDirty=!0},t.prototype.invert=function(){var t=this.determinant,e=Math.abs(t)>1e-11,i=this._rawData;if(e){t=1/t;var r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=i[5],h=i[6],c=i[7],u=i[8],p=i[9],d=i[10],f=i[11],_=i[12],g=i[13],m=i[14],y=i[15];i[0]=t*(l*(d*y-m*f)-p*(h*y-m*c)+g*(h*f-d*c)),i[1]=-t*(n*(d*y-m*f)-p*(o*y-m*s)+g*(o*f-d*s)),i[2]=t*(n*(h*y-m*c)-l*(o*y-m*s)+g*(o*c-h*s)),i[3]=-t*(n*(h*f-d*c)-l*(o*f-d*s)+p*(o*c-h*s)),i[4]=-t*(a*(d*y-m*f)-u*(h*y-m*c)+_*(h*f-d*c)),i[5]=t*(r*(d*y-m*f)-u*(o*y-m*s)+_*(o*f-d*s)),i[6]=-t*(r*(h*y-m*c)-a*(o*y-m*s)+_*(o*c-h*s)),i[7]=t*(r*(h*f-d*c)-a*(o*f-d*s)+u*(o*c-h*s)),i[8]=t*(a*(p*y-g*f)-u*(l*y-g*c)+_*(l*f-p*c)),i[9]=-t*(r*(p*y-g*f)-u*(n*y-g*s)+_*(n*f-p*s)),i[10]=t*(r*(l*y-g*c)-a*(n*y-g*s)+_*(n*c-l*s)),i[11]=-t*(r*(l*f-p*c)-a*(n*f-p*s)+u*(n*c-l*s)),i[12]=-t*(a*(p*m-g*d)-u*(l*m-g*h)+_*(l*d-p*h)),i[13]=t*(r*(p*m-g*d)-u*(n*m-g*o)+_*(n*d-p*o)),i[14]=-t*(r*(l*m-g*h)-a*(n*m-g*o)+_*(n*h-l*o)),i[15]=t*(r*(l*d-p*h)-a*(n*d-p*o)+u*(n*h-l*o))}return this._positionDirty=!0,e},t.prototype.isIdentity=function(){var t=this._rawData;return 1==t[0]&&0==t[1]&&0==t[2]&&0==t[3]&&0==t[4]&&1==t[5]&&0==t[6]&&0==t[7]&&0==t[8]&&0==t[9]&&1==t[10]&&0==t[11]&&0==t[12]&&0==t[13]&&0==t[14]&&1==t[15]},t.prototype.prepend=function(t){var e=this._rawData,i=t._rawData,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=i[5],h=i[6],c=i[7],u=i[8],p=i[9],d=i[10],f=i[11],_=i[12],g=i[13],m=i[14],y=i[15],v=e[0],b=e[1],x=e[2],A=e[3],E=e[4],S=e[5],T=e[6],P=e[7],C=e[8],w=e[9],D=e[10],M=e[11],O=e[12],I=e[13],L=e[14],N=e[15];e[0]=r*v+n*E+o*C+s*O,e[1]=r*b+n*S+o*w+s*I,e[2]=r*x+n*T+o*D+s*L,e[3]=r*A+n*P+o*M+s*N,e[4]=a*v+l*E+h*C+c*O,e[5]=a*b+l*S+h*w+c*I,e[6]=a*x+l*T+h*D+c*L,e[7]=a*A+l*P+h*M+c*N,e[8]=u*v+p*E+d*C+f*O,e[9]=u*b+p*S+d*w+f*I,e[10]=u*x+p*T+d*D+f*L,e[11]=u*A+p*P+d*M+f*N,e[12]=_*v+g*E+m*C+y*O,e[13]=_*b+g*S+m*w+y*I,e[14]=_*x+g*T+m*D+y*L,e[15]=_*A+g*P+m*M+y*N,this._positionDirty=!0},t.prototype.prependRotation=function(e,i){this.prepend(t.getAxisRotationMatrix(i.x,i.y,i.z,e,t._tempMatrix))},t.prototype.prependScale=function(e,i,r){if(1!=e||1!=i||1!=r){var n=t._tempMatrix._rawData;n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this.prepend(t._tempMatrix)}},t.prototype.prependTranslation=function(e,i,r){var n=t._tempMatrix._rawData;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=i,n[14]=r,n[15]=1,this.prepend(t._tempMatrix)},t.prototype.recompose=function(e){var i=e[0]||this.position;this.identity();var r=e[3];!r||1==r.x&&1==r.y&&1==r.z||this.appendScale(r.x,r.y,r.z);var n,o,s=e[2];!s||0==s.x&&0==s.y&&0==s.z||this.appendSkew(s.x,s.y,s.z);var a=t._tempMatrix._rawData;a[12]=0,a[13]=0,a[14]=0,a[15]=0;var l=e[1];if(l){var h=-l.x;0!=h&&(n=Math.sin(h),o=Math.cos(h),a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o,a[6]=-n,a[7]=0,a[8]=0,a[9]=n,a[10]=o,a[11]=0,this.append(t._tempMatrix)),0!=(h=-l.y)&&(n=Math.sin(h),o=Math.cos(h),a[0]=o,a[1]=0,a[2]=n,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=-n,a[9]=0,a[10]=o,a[11]=0,this.append(t._tempMatrix)),0!=(h=-l.z)&&(n=Math.sin(h),o=Math.cos(h),a[0]=o,a[1]=-n,a[2]=0,a[3]=0,a[4]=n,a[5]=o,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,this.append(t._tempMatrix))}return this._rawData[12]=i.x,this._rawData[13]=i.y,this._rawData[14]=i.z,e[0]&&(this._positionDirty=!0),this._rawData[15]=1,!0},t.prototype.reflect=function(t){var e=t.a,i=t.b,r=t.c,n=t.d,o=-2*e*i,s=-2*e*r,a=-2*i*r,l=this._rawData;l[0]=1-2*e*e,l[4]=o,l[8]=s,l[12]=-2*e*n,l[1]=o,l[5]=1-2*i*i,l[9]=a,l[13]=-2*i*n,l[2]=s,l[6]=a,l[10]=1-2*r*r,l[14]=-2*r*n,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this._positionDirty=!0},t.prototype.transformBox=function(t,e){if(void 0===e&&(e=null),null==t)throw new ArgumentError("ArgumentError, box cannot be null");t.width,t.x,t.height,t.y,t.depth,t.z,e||(e=new Box);var i=t.width/2,r=t.height/2,n=t.depth/2,o=t.x+i,s=t.y+r,a=t.z+n,l=this._rawData[0],h=this._rawData[4],c=this._rawData[8],u=this._rawData[12],p=this._rawData[1],d=this._rawData[5],f=this._rawData[9],_=this._rawData[13],g=this._rawData[2],m=this._rawData[6],y=this._rawData[10],v=o*l+s*h+a*c+u,b=o*p+s*d+a*f+_,x=o*g+s*m+a*y+this._rawData[14],A=Math.max(Math.abs(i*l+r*h+n*c),Math.abs(-i*l+r*h+n*c),Math.abs(i*l-r*h+n*c),Math.abs(i*l+r*h-n*c)),E=Math.max(Math.abs(i*p+r*d+n*f),Math.abs(-i*p+r*d+n*f),Math.abs(i*p-r*d+n*f),Math.abs(i*p+r*d-n*f)),S=Math.max(Math.abs(i*g+r*m+n*y),Math.abs(-i*g+r*m+n*y),Math.abs(i*g-r*m+n*y),Math.abs(i*g+r*m-n*y));return e.width=2*A,e.height=2*E,e.depth=2*S,e.x=v-A,e.y=b-E,e.z=x-S,e},t.prototype.transformSphere=function(t,e){if(void 0===e&&(e=null),null==t)throw new ArgumentError("ArgumentError, sphere cannot be null");var i=new Box(t.x-t.radius,t.y-t.radius,t.z-t.radius,2*t.radius,2*t.radius,2*t.radius);return this.transformBox(i,i),e||(e=new Sphere),e.x=i.x+i.width/2,e.y=i.y+i.height/2,e.z=i.z+i.depth/2,e.radius=Math.max(i.width,i.height,i.depth),e},t.prototype.transformVector=function(t,e){if(void 0===e&&(e=null),null==t)throw new ArgumentError("ArgumentError, vector cannot be null");var i=t.x,r=t.y,n=t.z,o=t.w;e||(e=new Vector3D);var s=this._rawData,a=e._rawData;return a[0]=i*s[0]+r*s[4]+n*s[8]+o*s[12],a[1]=i*s[1]+r*s[5]+n*s[9]+o*s[13],a[2]=i*s[2]+r*s[6]+n*s[10]+o*s[14],a[3]=i*s[3]+r*s[7]+n*s[11]+o*s[15],e},t.prototype.transformVectors=function(t,e){for(var i=0,r=0,n=0,o=0,s=this._rawData;i+3<=t.length;)r=t[i],n=t[i+1],o=t[i+2],e[i]=r*s[0]+n*s[4]+o*s[8]+s[12],e[i+1]=r*s[1]+n*s[5]+o*s[9]+s[13],e[i+2]=r*s[2]+n*s[6]+o*s[10]+s[14],i+=3},t.prototype.transpose=function(){var e=this._rawData,i=t._tempMatrix._rawData;this.copyRawDataTo(i,0,!0),e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],this._positionDirty=!0},t.prototype.invalidatePosition=function(){this._positionDirty=!0},t.prototype.toFixed=function(t){var e=Math.pow(10,t);return"matrix3d("+Math.round(this._rawData[0]*e)/e+","+Math.round(this._rawData[1]*e)/e+","+Math.round(this._rawData[2]*e)/e+","+Math.round(this._rawData[3]*e)/e+","+Math.round(this._rawData[4]*e)/e+","+Math.round(this._rawData[5]*e)/e+","+Math.round(this._rawData[6]*e)/e+","+Math.round(this._rawData[7]*e)/e+","+Math.round(this._rawData[8]*e)/e+","+Math.round(this._rawData[9]*e)/e+","+Math.round(this._rawData[10]*e)/e+","+Math.round(this._rawData[11]*e)/e+","+Math.round(this._rawData[12]*e)/e+","+Math.round(this._rawData[13]*e)/e+","+Math.round(this._rawData[14]*e)/e+","+Math.round(this._rawData[15]*e)/e+")"},t.prototype.toString=function(){return"matrix3d("+Math.round(1e3*this._rawData[0])/1e3+","+Math.round(1e3*this._rawData[1])/1e3+","+Math.round(1e3*this._rawData[2])/1e3+","+Math.round(1e3*this._rawData[3])/1e3+","+Math.round(1e3*this._rawData[4])/1e3+","+Math.round(1e3*this._rawData[5])/1e3+","+Math.round(1e3*this._rawData[6])/1e3+","+Math.round(1e3*this._rawData[7])/1e3+","+Math.round(1e3*this._rawData[8])/1e3+","+Math.round(1e3*this._rawData[9])/1e3+","+Math.round(1e3*this._rawData[10])/1e3+","+Math.round(1e3*this._rawData[11])/1e3+","+Math.round(1e3*this._rawData[12])/1e3+","+Math.round(1e3*this._rawData[13])/1e3+","+Math.round(1e3*this._rawData[14])/1e3+","+Math.round(1e3*this._rawData[15])/1e3+")"},t.CALCULATION_MATRIX=new t,t._tempMatrix=new t,t}(),TransformEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._transform=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._transform)},e.INVALIDATE_MATRIX3D="invalidateMatrix3D",e.INVALIDATE_CONCATENATED_MATRIX3D="invalidateConcatenatedMatrix3D",e.UPDATE_CONCATENATED_MATRIX3D="updateConcatenatedMatrix3D",e.INVALIDATE_COLOR_TRANSFORM="invalidateColorTransform",e}(EventBase),Transform=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this)||this;return r._tempVector3D=new Vector3D,r._inverseConcatenatedMatrix3D=new Matrix3D,r._rotation=new Vector3D,r._skew=new Vector3D,r._scale=new Vector3D(1,1,1),r._matrix=null,r._rawData=e||new Float32Array(24),r._matrix3D=new Matrix3D(new Float32Array(r._rawData.buffer,0,16)),r._colorTransform=new ColorTransform(new Float32Array(r._rawData.buffer,64,8)),r._concatenatedMatrix3D=i||r._matrix3D,null==e&&(r._matrix3D.identity(),r._colorTransform.clear()),r._components=new Array(4),r._components[1]=r._rotation,r._components[2]=r._skew,r._components[3]=r._scale,r.invalidateComponents(),r}return __extends(e,t),Object.defineProperty(e.prototype,"backVector",{get:function(){return this._backVector||(this._backVector=new Vector3D),this._matrix3D.copyColumnTo(2,this._backVector,!0),this._backVector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){if(t){var e=t._rawData,i=this._colorTransform._rawData;i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7]}else this._colorTransform.clear();this.invalidateColorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"concatenatedMatrix",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"concatenatedMatrix3D",{get:function(){return this._concatenatedMatrix3DDirty&&(this._concatenatedMatrix3DDirty=!1,this._concatenatedMatrix3D==this._matrix3D&&this._matrix3DDirty&&this.updateMatrix3D(),this.dispatchEvent(this._updateConcatenatedMatrix3D||(this._updateConcatenatedMatrix3D=new TransformEvent(TransformEvent.UPDATE_CONCATENATED_MATRIX3D,this)))),this._concatenatedMatrix3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseConcatenatedMatrix3D",{get:function(){return this._inverseConcatenatedMatrix3DDirty&&(this._inverseConcatenatedMatrix3DDirty=!1,this._inverseConcatenatedMatrix3D.copyFrom(this.concatenatedMatrix3D),this._inverseConcatenatedMatrix3D.invert()),this._inverseConcatenatedMatrix3D},enumerable:!0,configurable:!0}),e.prototype.append=function(t){console.log("append not implemented yet in core/Transform")},Object.defineProperty(e.prototype,"downVector",{get:function(){return this._downVector||(this._downVector=new Vector3D),this._matrix3D.copyColumnTo(1,this._downVector,!0),this._downVector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forwardVector",{get:function(){return this._forwardVector||(this._forwardVector=new Vector3D),this._matrix3D.copyColumnTo(2,this._forwardVector),this._forwardVector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftVector",{get:function(){return this._leftVector||(this._leftVector=new Vector3D),this._matrix3D.copyColumnTo(0,this._backVector,!0),this._leftVector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._matrix||(this._matrix=new Matrix(this.matrix3D._rawData[0],this.matrix3D._rawData[1],this.matrix3D._rawData[4],this.matrix3D._rawData[5],this.matrix3D._rawData[12],this.matrix3D._rawData[13])),this._matrix.a=this.matrix3D._rawData[0],this._matrix.b=this.matrix3D._rawData[1],this._matrix.c=this.matrix3D._rawData[4],this._matrix.d=this.matrix3D._rawData[5],this._matrix.tx=this.matrix3D._rawData[12],this._matrix.ty=this.matrix3D._rawData[13],this._matrix},set:function(t){this._matrix=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix3D",{get:function(){return this._matrix3DDirty&&this.updateMatrix3D(),this._matrix3D},set:function(t){var e=t._rawData,i=this._matrix3D._rawData;i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this.invalidateComponents(),this.invalidateConcatenatedMatrix3D()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelBounds",{get:function(){return this._pixelBounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._matrix3D.position},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightVector",{get:function(){return this._rightVector||(this._rightVector=new Vector3D),this._matrix3D.copyColumnTo(0,this._rightVector),this._rightVector},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._componentsDirty&&this._updateComponents(),this._rotation},enumerable:!0,configurable:!0}),e.prototype.rotateTo=function(t,e,i){this._componentsDirty&&this._updateComponents(),this._rotation.x=t,this._rotation.y=e,this._rotation.z=i,this.invalidateMatrix3D()},Object.defineProperty(e.prototype,"scale",{get:function(){return this._componentsDirty&&this._updateComponents(),this._scale},enumerable:!0,configurable:!0}),e.prototype.scaleTo=function(t,e,i){this._componentsDirty&&this._updateComponents(),this._scale.x=t,this._scale.y=e,this._scale.z=i,this.invalidateMatrix3D()},Object.defineProperty(e.prototype,"skew",{get:function(){return this._componentsDirty&&this._updateComponents(),this._skew},enumerable:!0,configurable:!0}),e.prototype.skewTo=function(t,e,i){this._componentsDirty&&this._updateComponents(),this._skew.x=t,this._skew.y=e,this._skew.z=i,this.invalidateMatrix3D()},Object.defineProperty(e.prototype,"upVector",{get:function(){return this._upVector||(this._upVector=new Vector3D),this._matrix3D.copyColumnTo(1,this._upVector),this._upVector},enumerable:!0,configurable:!0}),e.prototype.copyRawDataTo=function(t){this._matrix3DDirty&&this.updateMatrix3D();var e=t._rawData,i=this._rawData;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e[16]=i[16],e[17]=i[17],e[18]=i[18],e[19]=i[19],e[20]=i[20],e[21]=i[21],e[22]=i[22],e[23]=i[23],this.invalidateComponents(),this.invalidateColorTransform()},e.prototype.clone=function(){var t=new e;return this.copyRawDataTo(t),t},e.prototype.dispose=function(){},e.prototype.globalToLocal=function(t,e){void 0===e&&(e=null),this._tempVector3D.setTo(t.x,t.y,0);var i=this.inverseConcatenatedMatrix3D.transformVector(this._tempVector3D,this._tempVector3D);return e||(e=new Point),e.x=i.x,e.y=i.y,e},e.prototype.globalToLocal3D=function(t){return this.inverseConcatenatedMatrix3D.transformVector(t)},e.prototype.localToGlobal=function(t,e){void 0===e&&(e=null),this._tempVector3D.setTo(t.x,t.y,0);var i=this.concatenatedMatrix3D.transformVector(this._tempVector3D,this._tempVector3D);return e||(e=new Point),e.x=i.x,e.y=i.y,e},e.prototype.lookAt=function(t,e){void 0===e&&(e=null),null==e&&(e=Vector3D.Y_AXIS);var i=Matrix3D.getPointAtMatrix(new Vector3D,t.subtract(this._matrix3D.position),e,Matrix3D.CALCULATION_MATRIX).decompose()[1];this.rotateTo(i.x,i.y,i.z)},e.prototype.moveForward=function(t){this.translateLocal(Vector3D.Z_AXIS,t)},e.prototype.moveBackward=function(t){this.translateLocal(Vector3D.Z_AXIS,-t)},e.prototype.moveLeft=function(t){this.translateLocal(Vector3D.X_AXIS,-t)},e.prototype.moveRight=function(t){this.translateLocal(Vector3D.X_AXIS,t)},e.prototype.moveUp=function(t){this.translateLocal(Vector3D.Y_AXIS,t)},e.prototype.moveDown=function(t){this.translateLocal(Vector3D.Y_AXIS,-t)},e.prototype.moveTo=function(t,e,i){this._matrix3D._rawData[12]=t,this._matrix3D._rawData[13]=e,this._matrix3D._rawData[14]=i,this.invalidatePosition()},e.prototype.pitch=function(t){this.rotate(Vector3D.X_AXIS,t)},e.prototype.roll=function(t){this.rotate(Vector3D.Z_AXIS,t)},e.prototype.yaw=function(t){this.rotate(Vector3D.Y_AXIS,t)},e.prototype.rotate=function(t,e){this.matrix3D.prependRotation(e,t),this.invalidateComponents()},e.prototype.translate=function(t,e){var i=t.x,r=t.y,n=t.z,o=e/Math.sqrt(i*i+r*r+n*n);this.matrix3D.appendTranslation(i*o,r*o,n*o),this.invalidatePosition()},e.prototype.translateLocal=function(t,e){var i=t.x,r=t.y,n=t.z,o=e/Math.sqrt(i*i+r*r+n*n);this.matrix3D.prependTranslation(i*o,r*o,n*o),this.invalidatePosition()},e.prototype.clearMatrix3D=function(){this._matrix3D.identity(),this.invalidateComponents()},e.prototype.clearColorTransform=function(){this._colorTransform&&(this._colorTransform.clear(),this.invalidateColorTransform())},e.prototype.invalidateMatrix3D=function(){this._concatenatedMatrix3D==this._matrix3D&&this.invalidateConcatenatedMatrix3D(),this._matrix3DDirty||(this._matrix3DDirty=!0,this.dispatchEvent(this._invalidateMatrix3D||(this._invalidateMatrix3D=new TransformEvent(TransformEvent.INVALIDATE_MATRIX3D,this))))},e.prototype.invalidateComponents=function(){this.invalidatePosition(),this._componentsDirty=!0},e.prototype.invalidateConcatenatedMatrix3D=function(){this._concatenatedMatrix3DDirty||(this._concatenatedMatrix3DDirty=!0,this._inverseConcatenatedMatrix3DDirty=!0,this.dispatchEvent(this._invalidateConcatenatedMatrix3D||(this._invalidateConcatenatedMatrix3D=new TransformEvent(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,this))))},e.prototype.invalidatePosition=function(){this._concatenatedMatrix3D==this._matrix3D&&this.invalidateConcatenatedMatrix3D(),this._matrix3D.invalidatePosition(),this.dispatchEvent(this._invalidateMatrix3D||(this._invalidateMatrix3D=new TransformEvent(TransformEvent.INVALIDATE_MATRIX3D,this)))},e.prototype.invalidateColorTransform=function(){this.dispatchEvent(this._invalidateColorTransform||(this._invalidateColorTransform=new TransformEvent(TransformEvent.INVALIDATE_COLOR_TRANSFORM,this)))},e.prototype.updateMatrix3D=function(){this._matrix3D.recompose(this._components),this._matrix3DDirty=!1},e.prototype._updateComponents=function(){var t,e=this._matrix3D.decompose();t=e[1],this._rotation.x=t.x,this._rotation.y=t.y,this._rotation.z=t.z,t=e[2],this._skew.x=t.x,this._skew.y=t.y,this._skew.z=t.z,t=e[3],this._scale.x=t.x,this._scale.y=t.y,this._scale.z=t.z,this._componentsDirty=!1},e}(EventDispatcher),DocumentError=function(t){function e(e,i){return void 0===e&&(e="DocumentError"),void 0===i&&(i=0),t.call(this,e,i)||this}return __extends(e,t),e.DOCUMENT_DOES_NOT_EXIST="documentDoesNotExist",e}(ErrorBase),PartialImplementationError=function(t){function e(e,i){return void 0===e&&(e=""),void 0===i&&(i=0),t.call(this,"PartialImplementationError - this function is in development. Required Dependency: "+e,i)||this}return __extends(e,t),e}(ErrorBase),RangeError$1=function(t){function e(e,i){return void 0===e&&(e=null),void 0===i&&(i=0),t.call(this,e||"RangeError",i)||this}return __extends(e,t),e}(ErrorBase),LoaderEvent=function(t){function e(e,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null);var o=t.call(this,e)||this;return o._url=i,o._content=r,o._assets=n,o}return __extends(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._url,this._content,this._assets)},e.LOAD_COMPLETE="loadComplete",e}(EventBase),ParserEvent=function(t){function e(e,i){void 0===i&&(i="");var r=t.call(this,e)||this;return r._message=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._message)},e.PARSE_COMPLETE="parseComplete",e.PARSE_ERROR="parseError",e.READY_FOR_DEPENDENCIES="readyForDependencies",e}(EventBase),ProjectionEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._projection=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},enumerable:!0,configurable:!0}),e.INVALIDATE_FRUSTUM_MATRIX3D="invalidateFrustumMatrix3D",e.INVALIDATE_VIEW_MATRIX3D="invalidateViewMatrix3D",e}(EventBase),TimerEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.TIMER="timer",e.TIMER_COMPLETE="timerComplete",e}(EventBase),URLLoaderEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._urlLoader=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"urlLoader",{get:function(){return this._urlLoader},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._urlLoader)},e.HTTP_STATUS="httpStatus",e.LOAD_ERROR="loadError",e.LOAD_PROGRESS="loadProgress",e.LOAD_START="loadStart",e.LOAD_COMPLETE="loadComplete",e}(EventBase),PlaneClassification=function(){function t(){}return t.BACK=0,t.FRONT=1,t.IN=0,t.OUT=1,t.INTERSECT=2,t}(),Plane3D=function(){function t(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this.a=e,this.b=i,this.c=r,this.d=n,this._iAlignment=0==e&&0==i?t.ALIGN_XY_AXIS:0==i&&0==r?t.ALIGN_YZ_AXIS:0==e&&0==r?t.ALIGN_XZ_AXIS:t.ALIGN_ANY}return t.prototype.fromPoints=function(e,i,r){var n=i.x-e.x,o=i.y-e.y,s=i.z-e.z,a=r.x-e.x,l=r.y-e.y,h=r.z-e.z;this.a=o*h-s*l,this.b=s*a-n*h,this.c=n*l-o*a,this.d=this.a*e.x+this.b*e.y+this.c*e.z,0==this.a&&0==this.b?this._iAlignment=t.ALIGN_XY_AXIS:0==this.b&&0==this.c?this._iAlignment=t.ALIGN_YZ_AXIS:0==this.a&&0==this.c?this._iAlignment=t.ALIGN_XZ_AXIS:this._iAlignment=t.ALIGN_ANY},t.prototype.fromNormalAndPoint=function(e,i){this.a=e.x,this.b=e.y,this.c=e.z,this.d=this.a*i.x+this.b*i.y+this.c*i.z,0==this.a&&0==this.b?this._iAlignment=t.ALIGN_XY_AXIS:0==this.b&&0==this.c?this._iAlignment=t.ALIGN_YZ_AXIS:0==this.a&&0==this.c?this._iAlignment=t.ALIGN_XZ_AXIS:this._iAlignment=t.ALIGN_ANY},t.prototype.normalize=function(){var t=1/Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);return this.a*=t,this.b*=t,this.c*=t,this.d*=t,this},t.prototype.distance=function(e){return this._iAlignment==t.ALIGN_YZ_AXIS?this.a*e.x-this.d:this._iAlignment==t.ALIGN_XZ_AXIS?this.b*e.y-this.d:this._iAlignment==t.ALIGN_XY_AXIS?this.c*e.z-this.d:this.a*e.x+this.b*e.y+this.c*e.z-this.d},t.prototype.classifyPoint=function(e,i){return void 0===i&&(i=.01),this.d!=this.d?PlaneClassification.FRONT:(r=this._iAlignment==t.ALIGN_YZ_AXIS?this.a*e.x-this.d:this._iAlignment==t.ALIGN_XZ_AXIS?this.b*e.y-this.d:this._iAlignment==t.ALIGN_XY_AXIS?this.c*e.z-this.d:this.a*e.x+this.b*e.y+this.c*e.z-this.d)<-i?PlaneClassification.BACK:r>i?PlaneClassification.FRONT:PlaneClassification.INTERSECT;var r},t.prototype.toString=function(){return"Plane3D [a:"+this.a+", b:"+this.b+", c:"+this.c+", d:"+this.d+"]"},t.ALIGN_ANY=0,t.ALIGN_XY_AXIS=1,t.ALIGN_YZ_AXIS=2,t.ALIGN_XZ_AXIS=3,t}(),PoissonLookup=function(){function t(){}return t.initDistributions=function(){this._distributions=new Array,this._distributions[0]=new Array(.3082841,.4320919),this._distributions[1]=new Array(.3082841,.4320919,-.2274942,-.6640266),this._distributions[2]=new Array(.8742689,.0009265686,-.6864116,-.5536607,-.2325206,.7678371),this._distributions[3]=new Array(.3913446,-.7084417,-.7511101,-.5935929,-.2323436,.5320091,.8435315,.5035911),this._distributions[4]=new Array(.2122471,-.5771395,-.8543506,-.1763534,.5189021,.8323698,-.3616908,.5865368,.9523004,-.04948437),this._distributions[5]=new Array(.5791035,.3496495,.2959551,-.6006749,-.2419119,-.06879545,-.7403072,.6110353,-.04555973,.8059174,-.5275017,-.737129),this._distributions[6]=new Array(.06941478,.8519508,-.7441907,.2426432,.6439992,-.2405252,-.1007523,-.2327587,-.6427067,-.7248485,.8050759,.5492936,.3573822,-.8824506),this._distributions[7]=new Array(.8509863,.4452587,-.09507271,.2073005,.1706571,-.6434793,.8029777,-.2718274,-.4401725,.8196304,.2715359,.8598521,-.8121575,-.006447683,-.6486837,-.7237598),this._distributions[8]=new Array(.6951686,-.2680728,-.04933243,.3710589,.6592212,.3661054,-.01579228,-.6909603,-.3275101,-.1756866,.3811549,.9218544,-.216032,.9755028,-.7065172,.3355389,-.6579109,-.6798355),this._distributions[9]=new Array(.6181276,-.09790418,-.2537868,-.5570995,-.1964931,.3459414,.3474613,-.8885581,.5135743,.5753114,-.9549091,.1480672,-.8711916,-.4293123,-.6928071,.6190156,-.13369,.8892705,.0548224,-.1246777),this._distributions[10]=new Array(.4853027,-.5080479,-.1331675,-.506597,.139575,.01316885,.803486,-.07568797,.5240274,.4883182,-.4334005,.1207938,-.7794577,-.3985141,.1576432,-.9861221,-.3712867,.6959021,.1517378,.9847429,-.9762396,.1661073),this._distributions[11]=new Array(-.2790166,-.01252619,.3389016,.3921154,.2408341,-.313211,-.8151779,-.3898362,-.6347761,.3486495,.09471484,-.7722448,-.1385674,.6364574,.2456331,.9295807,-.3864306,-.8247881,.6111673,-.7164014,.8287669,.05466961,.837706,.5415626),this._distributions[12]=new Array(.056417,.3185693,-.8245888,.1882799,.8575996,.1136829,.1070375,.875332,.4076743,-.06000621,-.4311306,.7239349,.2677574,-.538472,-.08486642,-.2083647,-.888989,-.3906443,-.4768958,-.6664082,.09334993,-.9861541,.808736,-.455949,.5889823,.7660807),this._distributions[13]=new Array(-.2681346,-.3955857,-.1315102,-.8852947,-.5143692,.09551838,.4344836,-.546945,-.8620899,-.3813288,.1650431,.02034803,-.1543657,.3842218,-.828457,.5376903,-.6145,-.7818927,-.2639062,.8784655,.1912684,.9720125,.3135219,.5224229,.7850655,.4592297,.7465045,-.1368916),this._distributions[14]=new Array(.4241029,.695281,.150511,-.02304107,-.2482675,.9120338,.8057325,.2622084,-.2445909,.2765962,.8588713,-.1772072,.3117845,-.4385471,-.3923851,-.3298936,-.1751254,-.7405846,.6926506,-.684163,-.9304563,-.3254691,-.8533293,.1523024,.2510415,-.917345,-.6239773,-.7105472,-.6104624,.6041355),this._distributions[15]=new Array(.5844554,.06651045,.1343258,.6756578,.3799674,-.6301104,.5590436,.7940555,.09574714,.02262517,.8697868,.393301,.003945862,-.421735,.9043913,-.2432393,-.4844007,.7190998,-.3201078,.2972371,-.3852352,-.6341155,-.5413069,-.09223081,-.8468984,-.5126905,.004156174,-.8633173,-.9681889,-.03305046,-.846509,.4414353),this._distributions[16]=new Array(.4506488,.657668,.4621297,.07441051,-.2782125,.6201044,.9750003,.09110117,.1019436,.2986514,.03457398,.9631706,.542098,-.5505635,.8675668,.4938077,-.5414361,.2655292,-.7941836,.6003053,-.09847672,-.1001604,-.9316511,-.08572888,.07286467,-.611899,-.5232627,-.4082253,-.5481608,-.827938,-.1551939,-.9621193,.9220031,-.3315949),this._distributions[17]=new Array(.197908,-.4697656,-.4474689,-.3428435,.8529873,-.2228634,.6022478,-.5469642,.2545276,-.931133,-.1507547,-.7855865,-.07606658,.1011628,.3046715,.2785755,.4698432,-.1064076,.6831254,.4152522,.1374381,.8363233,-.2166121,.6682042,.5511393,.7996449,-.4278994,.28836,-.8875198,.2181732,-.8772842,-.2818254,-.7000262,.5762185,-.6062385,-.7439126),this._distributions[18]=new Array(.6645703,-.05678739,.5720971,.4533803,-.07660709,.08802763,.5163431,-.4426552,.1163455,-.3404382,-.4004807,-.5046007,.2932099,-.8201418,-.5322125,.03834766,-.1490209,-.8817304,-.8000439,-.3509448,.5260983,.8421043,.1197811,.6963812,.9498612,.3122156,-.9285746,.02120355,-.6670724,.7217396,.9155889,-.3510147,-.271941,.4727852,.318879,.1634057,-.2686755,.9253026),this._distributions[19]=new Array(.5064292,.422527,.8935515,-.06610427,.1199719,.175568,.403388,-.2003276,.1657927,.8154403,.9301245,.2929218,-.1644068,.6201534,.7113559,-.6589743,-.3364046,-.1799502,.02109996,-.392765,-.382213,.3219992,-.9201946,.1207967,-.726185,.4291916,-.7443482,-.2480059,-.5147594,.7418784,.1935272,-.7406143,-.3643523,-.5559214,-.7147766,-.6326278,-.2524151,-.9096627,.5161405,.7908453),this._distributions[20]=new Array(.7921003,-.3032096,.5992879,-.009052323,.2538549,-.1872749,.7053444,.3677175,.5417761,-.8170255,.9749611,.1210478,.1969143,-.6117041,-.1824499,-.4634196,-.1181338,-.8668742,-.3050112,-.1352596,-.4409327,-.7082354,-.03225285,.1171548,.3113096,.3250439,-.8166144,-.463995,-.01014475,.4715334,-.6868284,.05091889,-.4011163,.2717285,-.06756835,.8307694,-.7938535,.4352129,-.4663842,.7165329,.559729,.8093995),this._distributions[21]=new Array(.07832243,.426151,-.3856795,.5799953,.01970797,.06706189,.4822682,.3014512,-.1532982,.87485,-.4959527,.07888043,.260601,-.2304784,.4996209,.7167382,.585986,-.04265174,-.7679967,.5509416,-.9041753,.1802134,-.8407655,-.4442826,-.2058258,-.2636995,-.4984115,-.5928579,.2926032,-.7886473,-.06933882,-.621177,.578115,-.4813387,.8981777,-.3291056,.1942733,.9255584,.8084362,.5066984,.9920095,.03103104,-.2403206,-.9389018),this._distributions[22]=new Array(-.5691095,.1014316,-.7788262,.384012,-.8253665,-.1645582,-.1830993,.002997211,-.2555013,-.4177977,-.6640869,-.4794711,-.2351242,.5850121,.02436554,.2825883,.006061143,-.8200245,.1618791,-.3063331,-.3765897,-.7249815,.6092919,-.6769328,-.5956934,.6957655,.5383642,.4522677,-.1489165,.9125596,.4167473,.1335986,.1898309,.5874342,.2288171,.9624356,.7540846,-.07672304,.8986252,.2788797,.3555991,-.9262139,.8454325,-.4027667,.4945236,-.2935512),this._distributions[23]=new Array(-.4481403,-.3758374,-.8877251,.08739938,.05015831,-.1339983,-.4070427,-.8534173,.1019274,-.5503222,-.445998,.1997541,-.8686263,-.2788867,-.7695944,-.6033704,-.05515742,-.885711,-.7714347,.5790485,.3466263,-.8799297,.4487582,-.5321087,-.2461368,.6053771,-.05568117,.2457351,-.4668669,.8523816,.8103387,-.4255538,.4054182,-.175663,-.2802011,-.08920153,.2665959,.382935,.555679,.1621837,.105246,.8420411,.6921161,.6902903,.880946,.2483067,.9699264,-.1021767),this._distributions[24]=new Array(-.1703323,-.3119385,.2916039,-.2988263,-.008472982,-.9277695,-.7730271,-.3277904,.3440474,-.6815342,-.2910278,.03461745,-.6764899,-.657078,-.3505501,-.7311988,-.03478927,.3258755,-.6048835,.159423,.2035525,.02212214,.5116573,.2226856,.6664805,-.2500189,.7147882,-.6609634,.03030632,-.5763278,-.2516585,.6116219,-.9434413,-.0116792,.9061816,.2491155,.182867,.6076167,.286593,.9485695,-.5992439,.6970096,-.2082874,.9416641,.9880044,-.1541709,-.9122881,.331555,.7324886,.6725098),this._distributions[25]=new Array(.3869598,-.04974834,.7168844,-.0693711,-.07166742,.1725325,.4599592,.3232779,.5872094,-.4198674,.2442266,-.625667,.1254557,.4500048,-.2290154,-.1803567,.890583,.3373493,.1256081,.7853789,-.2676466,.5305805,-.7063224,.252168,-.3989835,.1189921,.09617215,-.2451447,.6302541,.6085876,.9380925,-.3234899,.5086241,-.8573482,.03576187,-.9876697,-.0876712,-.6365195,-.5276513,.823456,-.6935764,-.2240411,-.5212318,-.5383121,-.2116208,.9639363,-.9840096,.02743555,-.3991577,-.8994547,-.7830126,.614068),this._distributions[26]=new Array(-.8366601,.4464895,-.5917366,-.02073906,-.9845258,.1635625,-.3097973,.4379579,-.5478154,.7173221,-.1685888,.9261969,.01503595,.6046097,.4452421,.5449086,.0315687,.1944619,.3753404,.8688548,.4143643,.1396648,.8711032,.4304703,.7328773,.1461501,.6374492,-.3521495,.145613,-.1341466,.9040975,-.135123,-.7839059,-.5450199,-.516019,-.3320859,-.206158,-.4431106,-.9703014,-.2368356,-.2473119,-.0864351,.2130725,-.4604077,-.003726701,-.7122303,-.4072131,-.6833169,.1632999,-.9776646,.4686888,-.680495,-.2293511,-.9509777),this._distributions[27]=new Array(.107311,-.1311369,-.4194764,-.3148777,.6171439,-.2745973,.2796618,.1937153,-.09106886,.4180236,.6044006,.05577846,.02927299,-.6738263,-.2580845,.1179939,-.09023564,-.3830024,.3570953,-.5000587,.81591,-.5518309,.9300217,-.1257987,.4904627,-.8381903,-.3163182,-.8632009,.1137595,-.9875998,.8390043,.3538185,.2149114,.4993694,.5191584,.3833552,.5002763,.7061465,-.2567276,.9068756,-.5197366,.3467845,.03668867,.9734009,-.5347553,.66747,-.9028882,.1023768,-.8967977,.412834,-.5821944,.0426479,-.8032165,-.2397038,-.5597343,-.6358021),this._distributions[28]=new Array(-.6562496,-.1781036,-.9301494,.1185208,-.3861143,-.4153562,-.1560799,-.1099607,-.5587025,.395218,-.5322112,-.699701,-.5008639,.08726846,-.970524,-.1963461,-.813577,-.5185111,-.1644458,.298,-.3216791,.639982,.3315373,.3339162,.2383235,-.00105722,.1137828,.5450742,-.01899921,.8798413,.2849685,.8255596,.6974412,.2123175,.7588523,.5470437,.5102502,-.1687844,.5853448,.8033476,.2590716,-.5262504,.5607718,-.6342825,.8666443,-.1491841,.8341052,-.4935003,-.1568441,-.6634066,.2512113,-.8769391,-.2559827,-.9572457,-.01928852,-.3966542,-.750667,.6409678),this._distributions[29]=new Array(.3454786,-.04837726,.2649553,.2406852,.5599093,-.3839145,-.1111814,-.05502108,.7586042,-.05818377,.2519488,-.4665135,-.1264972,.2602723,-.08766216,-.3671907,.6428129,.3999204,-.6105871,-.1246869,-.4589451,-.7646643,-.03021116,-.7899352,-.6036922,-.4293956,-.2481938,.6534185,.102798,.6784465,-.6392644,.4821358,-.6789002,.1779133,-.9140783,-.1989647,-.9262617,.3381507,.4794891,-.8093274,.3959447,.668478,.9602883,.2272305,-.123672,.9210883,.2375148,.9523395,-.52898,.7973378,-.382433,.1228794,.695015,.6948439,.7530277,-.6458191,.8777987,-.3272956,.2318525,-.962768),this._distributions[30]=new Array(.4518921,-.1146195,.4720805,-.4238748,.3655423,.1806341,.1589939,-.23568,.7673324,-.5149941,.01163658,.09045836,.7010971,.1245747,.7518286,-.1855433,.4960719,.4601022,.2566979,-.6308268,-.0654714,-.5126389,-.1823319,-.1343282,-.1464312,.4883236,-.3858738,.203523,.1484799,.4432284,-.477109,-.116241,.2719092,.7208626,.9104174,.3578536,-.5956199,.7662588,-.6996251,.3678654,-.2514512,.9251933,.1275825,-.9478135,-.204608,-.8611552,.4264838,-.877443,.9854161,.05521112,.5912951,.7997434,.1140349,.982093,-.9324368,-.2094094,-.42436,-.6441524,-.6722705,-.3554261,-.7844236,.08587621),this._distributions[31]=new Array(-.4206714,-.5613642,-.8733016,-.3373051,-.1046226,-.2902999,-.1318562,-.8434365,.1145093,-.5962623,-.4965627,-.1873259,-.5011808,-.8546229,-.7165636,-.5743566,.1090901,.2017643,.3404809,-.220455,-.1989015,.2372122,-.4538706,.0979171,.4514146,-.572846,.2314168,-.8514503,-.4247236,.5650803,-.943347,.04514639,-.1309718,.5221877,-.7004157,.4561877,.6306441,.04448673,.4301621,.5766876,.1078042,.7245752,.3875354,.2794483,.702876,-.2924213,.7360667,-.6210318,.7486517,.6531103,.4898235,.8591025,.6549174,.3854057,-.2596106,.7916998,.9251194,-.05296265,-.5620695,.820877,-.01228026,.9937211,.9612103,.2628758)},t.getDistribution=function(t){return this._distributions||this.initDistributions(),t<1||t>32?null:this._distributions[t-1]},t}(),Quaternion=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=0,this.y=0,this.z=0,this.w=1,this.x=t,this.y=e,this.z=i,this.w=r}return Object.defineProperty(t.prototype,"magnitude",{get:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},enumerable:!0,configurable:!0}),t.prototype.multiply=function(t,e){var i=t.w,r=t.x,n=t.y,o=t.z,s=e.w,a=e.x,l=e.y,h=e.z;this.w=i*s-r*a-n*l-o*h,this.x=i*a+r*s+n*h-o*l,this.y=i*l-r*h+n*s+o*a,this.z=i*h+r*l-n*a+o*s},t.prototype.multiplyVector=function(e,i){void 0===i&&(i=null),null===i&&(i=new t);var r=e.x,n=e.y,o=e.z;return i.w=-this.x*r-this.y*n-this.z*o,i.x=this.w*r+this.y*o-this.z*n,i.y=this.w*n-this.x*o+this.z*r,i.z=this.w*o+this.x*n-this.y*r,i},t.prototype.fromAxisAngle=function(t,e){var i=Math.sin(e/2),r=Math.cos(e/2);this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=r,this.normalize()},t.prototype.slerp=function(t,e,i){var r=t.w,n=t.x,o=t.y,s=t.z,a=e.w,l=e.x,h=e.y,c=e.z,u=r*a+n*l+o*h+s*c;if(u<0&&(u=-u,a=-a,l=-l,h=-h,c=-c),u<.95){var p=Math.acos(u),d=1/Math.sin(p),f=Math.sin(p*(1-i))*d,_=Math.sin(p*i)*d;this.w=r*f+a*_,this.x=n*f+l*_,this.y=o*f+h*_,this.z=s*f+c*_}else{this.w=r+i*(a-r),this.x=n+i*(l-n),this.y=o+i*(h-o),this.z=s+i*(c-s);var g=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z);this.w*=g,this.x*=g,this.y*=g,this.z*=g}},t.prototype.lerp=function(t,e,i){var r,n=t.w,o=t.x,s=t.y,a=t.z,l=e.w,h=e.x,c=e.y,u=e.z;n*l+o*h+s*c+a*u<0&&(l=-l,h=-h,c=-c,u=-u),this.w=n+i*(l-n),this.x=o+i*(h-o),this.y=s+i*(c-s),this.z=a+i*(u-a),r=1/Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z),this.w*=r,this.x*=r,this.y*=r,this.z*=r},t.prototype.fromEulerAngles=function(t,e,i){var r=.5*t,n=.5*e,o=.5*i,s=Math.cos(r),a=Math.sin(r),l=Math.cos(n),h=Math.sin(n),c=Math.cos(o),u=Math.sin(o);this.w=s*l*c+a*h*u,this.x=a*l*c-s*h*u,this.y=s*h*c+a*l*u,this.z=s*l*u-a*h*c},t.prototype.toEulerAngles=function(t){return void 0===t&&(t=null),null===t&&(t=new Vector3D),t.x=Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),t.y=Math.asin(2*(this.w*this.y-this.z*this.x)),t.z=Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z)),t},t.prototype.normalize=function(t){void 0===t&&(t=1);var e=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);this.x*=e,this.y*=e,this.z*=e,this.w*=e},t.prototype.toString=function(){return"{x:"+this.x+" y:"+this.y+" z:"+this.z+" w:"+this.w+"}"},t.prototype.toMatrix3D=function(t){void 0===t&&(t=null);var e=2*this.x*this.y,i=2*this.x*this.z,r=2*this.x*this.w,n=2*this.y*this.z,o=2*this.y*this.w,s=2*this.z*this.w,a=this.x*this.x,l=this.y*this.y,h=this.z*this.z,c=this.w*this.w;t||(t=new Matrix3D);var u=t._rawData;return u[0]=a-l-h+c,u[4]=e-s,u[8]=i+o,u[12]=0,u[1]=e+s,u[5]=-a+l-h+c,u[9]=n-r,u[13]=0,u[2]=i-o,u[6]=n+r,u[10]=-a-l+h+c,u[14]=0,u[3]=0,u[7]=0,u[11]=0,u[15]=1,t},t.prototype.fromMatrix=function(t){var e=t.decompose(Orientation3D.QUATERNION)[1];this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w},t.prototype.toRawData=function(t,e){void 0===e&&(e=!1);var i=2*this.x*this.y,r=2*this.x*this.z,n=2*this.x*this.w,o=2*this.y*this.z,s=2*this.y*this.w,a=2*this.z*this.w,l=this.x*this.x,h=this.y*this.y,c=this.z*this.z,u=this.w*this.w;t[0]=l-h-c+u,t[1]=i-a,t[2]=r+s,t[4]=i+a,t[5]=-l+h-c+u,t[6]=o-n,t[8]=r-s,t[9]=o+n,t[10]=-l-h+c+u,t[3]=t[7]=t[11]=0,e||(t[12]=t[13]=t[14]=0,t[15]=1)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.rotatePoint=function(t,e){var i,r,n,o;void 0===e&&(e=null);var s=t.x,a=t.y,l=t.z;return null===e&&(e=new Vector3D),o=-this.x*s-this.y*a-this.z*l,i=this.w*s+this.y*l-this.z*a,r=this.w*a-this.x*l+this.z*s,n=this.w*l+this.x*a-this.y*s,e.x=-o*this.x+i*this.w-r*this.z+n*this.y,e.y=-o*this.y+i*this.z+r*this.w-n*this.x,e.z=-o*this.z-i*this.y+r*this.x+n*this.w,e},t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},t}(),Rectangle=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this._rawData=new Float32Array(4);var n=this._rawData;n[0]=t,n[1]=e,n[2]=i,n[3]=r}return t.prototype.axCallPublicProperty=function(t,e){return null},t.prototype.axGetPublicProperty=function(t){return null},t.prototype.axSetPublicProperty=function(t){return null},Object.defineProperty(t.prototype,"height",{get:function(){return this._rawData[3]},set:function(t){this._rawData[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._rawData[2]},set:function(t){this._rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._rawData[0]},set:function(t){this._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._rawData[1]},set:function(t){this._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._rawData[1]+this._rawData[3]},set:function(t){this._rawData[3]=t-this._rawData[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return null==this._bottomRight&&(this._bottomRight=new Point),this._bottomRight._rawData[0]=this._rawData[0]+this._rawData[2],this._bottomRight._rawData[1]=this._rawData[1]+this._rawData[3],this._bottomRight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._rawData[0]},set:function(t){this._rawData[2]+=this._rawData[0]-t,this._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._rawData[0]+this._rawData[2]},set:function(t){this._rawData[2]=t-this._rawData[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return null==this._size&&(this._size=new Point),this._size._rawData[0]=this._rawData[2],this._size._rawData[1]=this._rawData[3],this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._rawData[1]},set:function(t){this._rawData[3]+=this._rawData[1]-t,this._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return null==this._topLeft&&(this._topLeft=new Point),this._topLeft._rawData[0]=this._rawData[0],this._topLeft._rawData[1]=this._rawData[1],this._topLeft},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=this._rawData;return new t(e[0],e[1],e[2],e[3])},t.prototype.contains=function(t,e){var i=this._rawData;return i[0]<=t&&i[0]+i[2]>=t&&i[1]<=e&&i[1]+i[3]>=e},t.prototype.containsPoint=function(t){var e=this._rawData,i=t._rawData;return e[0]<=i[0]&&e[0]+e[2]>=i[0]&&e[1]<=i[1]&&e[1]+e[3]>=i[1]},t.prototype.containsRect=function(t){var e=this._rawData,i=t._rawData;return e[0]<=i[0]&&e[0]+e[2]>=i[0]+i[2]&&e[1]<=i[1]&&e[1]+e[3]>=i[1]+i[3]},t.prototype.copyFrom=function(t){var e=this._rawData,i=t._rawData;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},t.prototype.equals=function(t){var e=this._rawData,i=t._rawData;return e[0]==i[0]&&e[1]==i[1]&&e[2]==i[2]&&e[3]==i[3]},t.prototype.inflate=function(t,e){var i=this._rawData;i[0]-=t/2,i[1]-=e/2,i[2]+=t/2,i[3]+=e/2},t.prototype.inflatePoint=function(t){var e=this._rawData;e[0]-=t.x/2,e[1]-=t.y/2,e[2]+=t.x/2,e[3]+=t.y/2},t.prototype.intersection=function(e){var i=this._rawData,r=e._rawData;if(this.intersects(e)){var n=new t,o=n._rawData;return i[0]>r[0]?(o[0]=i[0],o[2]=r[0]-i[0]+r[2],o[2]>i[2]&&(o[2]=i[2])):(o[0]=r[0],o[2]=i[0]-r[0]+i[2],o[2]>r[2]&&(o[2]=r[2])),i[1]>r[1]?(o[1]=i[1],o[3]=r[1]-i[1]+r[3],o[3]>i[3]&&(o[3]=i[3])):(o[1]=r[1],o[3]=i[1]-r[1]+i[3],o[3]>r[3]&&(o[3]=r[3])),n}return new t},t.prototype.intersects=function(t){var e=this._rawData,i=t._rawData;return e[0]+e[2]>i[0]&&e[0]<i[0]+i[2]&&e[1]+e[3]>i[1]&&e[1]<i[1]+i[3]},t.prototype.isEmpty=function(){var t=this._rawData;return 0==t[0]&&0==t[1]&&0==t[2]&&0==t[3]},t.prototype.offset=function(t,e){this._rawData[0]+=t,this._rawData[1]+=e},t.prototype.offsetPoint=function(t){this._rawData[0]+=t.x,this._rawData[1]+=t.y},t.prototype.setEmpty=function(){var t=this._rawData;t[0]=0,t[1]=0,t[2]=0,t[3]=0},t.prototype.setTo=function(t,e,i,r){var n=this._rawData;n[0]=t,n[1]=e,n[2]=i,n[3]=r},t.prototype.toString=function(){return"[Rectangle] (x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},t.prototype.union=function(e){var i=this._rawData,r=e._rawData,n=new t,o=n._rawData;return i[0]<r[0]?(o[0]=i[0],o[2]=r[0]-i[0]+r[2],o[2]<i[2]&&(o[2]=i[2])):(o[0]=r[0],o[2]=i[0]-r[0]+i[2],o[2]<r[2]&&(o[2]=r[2])),i[1]<r[1]?(o[1]=i[1],o[3]=r[1]-i[1]+r[3],o[3]<i[3]&&(o[3]=i[3])):(o[1]=r[1],o[3]=i[1]-r[1]+i[3],o[3]<r[3]&&(o[3]=r[3])),n},t}(),AbstractionBase=function(t){function e(e,i){var r=t.call(this)||this;return r._invalid=!0,r._asset=e,r._pool=i,r._onClearDelegate=function(t){return r.onClear(t)},r._onInvalidateDelegate=function(t){return r.onInvalidate(t)},r._asset&&(r._asset.addEventListener(AssetEvent.CLEAR,r._onClearDelegate),r._asset.addEventListener(AssetEvent.INVALIDATE,r._onInvalidateDelegate)),r}return __extends(e,t),e.prototype.onClear=function(t){this._asset&&(this._asset.removeEventListener(AssetEvent.CLEAR,this._onClearDelegate),this._asset.removeEventListener(AssetEvent.INVALIDATE,this._onInvalidateDelegate)),this._pool.clearAbstraction(this._asset),this._pool=null,this._asset=null},e.prototype.onInvalidate=function(t){this._invalid=!0},e}(EventDispatcher),AssetLibraryIterator=function(){function t(t,e,i,r){this._assets=t,this.filter(e,i,r)}return Object.defineProperty(t.prototype,"currentAsset",{get:function(){return this._idx<this._filtered.length?this._filtered[this._idx]:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numAssets",{get:function(){return this._filtered.length},enumerable:!0,configurable:!0}),t.prototype.next=function(){var t=null;return this._idx<this._filtered.length&&(t=this._filtered[this._idx]),this._idx++,t},t.prototype.reset=function(){this._idx=0},t.prototype.setIndex=function(t){this._idx=t},t.prototype.filter=function(t,e,i){if(t||e){var r,n;r=0,this._filtered=new Array;for(var o=this._assets.length,s=0;s<o;s++)n=this._assets[s],t&&n.adaptee.assetType!=t||e&&n.adaptee.assetNamespace!=e||(null==i||i(n))&&(this._filtered[r++]=n)}else this._filtered=this._assets},t}(),LoaderContext=function(){function t(e,i){void 0===e&&(e=!0),void 0===i&&(i=null),this._includeDependencies=e,this._dependencyBaseUrl=i||"",this._embeddedDataByUrl={},this._remappedUrls={},this._materialMode=t.UNDEFINED,this._externalAssetMode=t.PRELOADED}return Object.defineProperty(t.prototype,"includeDependencies",{get:function(){return this._includeDependencies},set:function(t){this._includeDependencies=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"externalAssetMode",{get:function(){return this._externalAssetMode},set:function(t){this._externalAssetMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencyBaseUrl",{get:function(){return this._dependencyBaseUrl},set:function(t){this._dependencyBaseUrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"overrideAbsolutePaths",{get:function(){return this._overrideAbsPath},set:function(t){this._overrideAbsPath=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"overrideFullURLs",{get:function(){return this._overrideFullUrls},set:function(t){this._overrideFullUrls=t},enumerable:!0,configurable:!0}),t.prototype.mapUrl=function(t,e){this._remappedUrls[t]=e},t.prototype.mapUrlToData=function(t,e){this._embeddedDataByUrl[t]=e},t.prototype._iHasDataForUrl=function(t){return this._embeddedDataByUrl.hasOwnProperty(t)},t.prototype._iGetDataForUrl=function(t){return this._embeddedDataByUrl[t]},t.prototype._iHasMappingForUrl=function(t){return this._remappedUrls.hasOwnProperty(t)},t.prototype._iGetRemappedUrl=function(t){return this._remappedUrls[t]},t.UNDEFINED=0,t.SINGLEPASS_MATERIALS=1,t.MULTIPASS_MATERIALS=2,t.ON_DEMAND="onDemand",t.PRELOADED="preloaded",t}(),URLLoaderDataFormat=function(){function t(){}return t.TEXT="text",t.VARIABLES="variables",t.BLOB="blob",t.ARRAY_BUFFER="arraybuffer",t.BINARY="binary",t}(),URLRequestMethod=function(){function t(){}return t.POST="POST",t.GET="GET",t}(),URLVariables=function(){function t(t){void 0===t&&(t=null),this._variables=new Object,null!==t&&this.decode(t)}return t.prototype.decode=function(t){t=t.split("+").join(" ");for(var e,i=/[?&]?([^=]+)=([^&]*)/g;e=i.exec(t);)this._variables[decodeURIComponent(e[1])]=decodeURIComponent(e[2])},t.prototype.toString=function(){return""},Object.defineProperty(t.prototype,"variables",{get:function(){return this._variables},set:function(t){this._variables=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formData",{get:function(){var t=new FormData;for(var e in this._variables)t.append(e,this._variables[e]);return t},enumerable:!0,configurable:!0}),t}(),URLLoader=function(t){function e(){var e=t.call(this)||this;return e._bytesLoaded=0,e._bytesTotal=0,e._dataFormat=URLLoaderDataFormat.TEXT,e._loadError=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"url",{get:function(){return this._request?this._request.url:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataFormat",{get:function(){return this._dataFormat},set:function(t){this._dataFormat=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:!0,configurable:!0}),e.prototype.load=function(t){this._request=t,this.initXHR(),t.method===URLRequestMethod.POST?this.postRequest(t):this.getRequest(t)},e.prototype.isSupported=function(){return null!=window},e.prototype.close=function(){this._XHR.abort(),this.disposeXHR()},e.prototype.dispose=function(){this._XHR&&this._XHR.abort(),this.disposeXHR()},e.prototype.setResponseType=function(t,e){switch(e){case URLLoaderDataFormat.ARRAY_BUFFER:case URLLoaderDataFormat.BLOB:case URLLoaderDataFormat.TEXT:t.responseType=e;break;case URLLoaderDataFormat.VARIABLES:t.responseType=URLLoaderDataFormat.TEXT;break;case URLLoaderDataFormat.BINARY:t.responseType=""}},e.prototype.getRequest=function(t){try{this._XHR.open(t.method,t.url,t.async),this.setResponseType(this._XHR,this._dataFormat),this._XHR.send()}catch(t){this.handleXmlHttpRequestException(t)}},e.prototype.postRequest=function(t){if(this._loadError=!1,this._XHR.open(t.method,t.url,t.async),null!=t.data)if(t.data instanceof URLVariables){var e=t.data;try{this._XHR.responseType="text",this._XHR.send(e.formData)}catch(t){this.handleXmlHttpRequestException(t)}}else this.setResponseType(this._XHR,this._dataFormat),t.data?this._XHR.send(t.data):this._XHR.send();else this._XHR.send()},e.prototype.handleXmlHttpRequestException=function(t){t.code},e.prototype.initXHR=function(){var t=this;this._XHR||(this._XHR=new XMLHttpRequest,this._XHR.onloadstart=function(e){return t.onLoadStart(e)},this._XHR.onprogress=function(e){return t.onProgress(e)},this._XHR.onabort=function(e){return t.onAbort(e)},this._XHR.onerror=function(e){return t.onLoadError(e)},this._XHR.onload=function(e){return t.onLoadComplete(e)},this._XHR.ontimeout=function(e){return t.onTimeOut(e)},this._XHR.onloadend=function(e){return t.onLoadEnd(e)},this._XHR.onreadystatechange=function(e){return t.onReadyStateChange(e)})},e.prototype.disposeXHR=function(){null!==this._XHR&&(this._XHR.onloadstart=null,this._XHR.onprogress=null,this._XHR.onabort=null,this._XHR.onerror=null,this._XHR.onload=null,this._XHR.ontimeout=null,this._XHR.onloadend=null,this._XHR=null)},e.prototype.decodeURLVariables=function(t){var e=new Object;t=t.split("+").join(" ");for(var i,r=/[?&]?([^=]+)=([^&]*)/g;i=r.exec(t);)e[decodeURIComponent(i[1])]=decodeURIComponent(i[2]);return e},e.prototype.onReadyStateChange=function(t){4==this._XHR.readyState&&(this._status=this._XHR.status,404==this._status&&(this._loadError=!0,this.dispatchEvent(this._loadErrorEvent||(this._loadErrorEvent=new URLLoaderEvent(URLLoaderEvent.LOAD_ERROR,this)))),this.dispatchEvent(this._statusEvent||(this._statusEvent=new URLLoaderEvent(URLLoaderEvent.HTTP_STATUS,this))))},e.prototype.onLoadEnd=function(t){this._loadError},e.prototype.onTimeOut=function(t){},e.prototype.onAbort=function(t){},e.prototype.onProgress=function(t){this._bytesTotal=t.total,this._bytesLoaded=t.loaded,this.dispatchEvent(this._progressEvent||(this._progressEvent=new URLLoaderEvent(URLLoaderEvent.LOAD_PROGRESS,this)))},e.prototype.onLoadStart=function(t){this.dispatchEvent(this._loadStartEvent||(this._loadStartEvent=new URLLoaderEvent(URLLoaderEvent.LOAD_START,this)))},e.prototype.onLoadComplete=function(t){if(!0!==this._loadError){switch(this._dataFormat){case URLLoaderDataFormat.TEXT:this._data=this._XHR.responseText;break;case URLLoaderDataFormat.VARIABLES:this._data=this.decodeURLVariables(this._XHR.responseText);break;case URLLoaderDataFormat.BLOB:case URLLoaderDataFormat.ARRAY_BUFFER:case URLLoaderDataFormat.BINARY:this._data=this._XHR.response;break;default:this._data=this._XHR.responseText}this.dispatchEvent(this._loadCompleteEvent||(this._loadCompleteEvent=new URLLoaderEvent(URLLoaderEvent.LOAD_COMPLETE,this)))}},e.prototype.onLoadError=function(t){this._loadError=!0,this.dispatchEvent(this._loadErrorEvent||(this._loadErrorEvent=new URLLoaderEvent(URLLoaderEvent.LOAD_ERROR,this)))},e}(EventDispatcher),ResourceDependency=function(){function t(t,e,i,r,n,o,s,a){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=0),this._id=t,this._sub_id=a,this._request=e,this._data=i,this._parser=r,this._parentParser=n,this._retrieveAsRawData=o,this._suppressAssetEvents=s,this._assets=new Array,this._dependencies=new Array}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sub_id",{get:function(){return this._sub_id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parser",{get:function(){return this._parser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentParser",{get:function(){return this._parentParser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retrieveAsRawData",{get:function(){return this._retrieveAsRawData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"suppresAssetEvents",{get:function(){return this._suppressAssetEvents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assets",{get:function(){return this._assets},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0}),t.prototype._iSetData=function(t){this._data=t},t.prototype._iSetParser=function(t){this._parser=t},t.prototype.resolve=function(){this._parentParser&&this._parentParser._iResolveDependency(this)},t.prototype.resolveFailure=function(){this._parentParser&&this._parentParser._iResolveDependencyFailure(this)},t.prototype.resolveName=function(t){return this._parentParser?this._parentParser._iResolveDependencyName(this,t):t.name},t}(),Loader=function(t){function e(e){void 0===e&&(e=0);var i=t.call(this)||this;return i._materialMode=e,i._stack=new Array,i._errorHandlers=new Array,i._parseErrorHandlers=new Array,i._onReadyForDependenciesDelegate=function(t){return i.onReadyForDependencies(t)},i._onParseCompleteDelegate=function(t){return i.onParseComplete(t)},i._onParseErrorDelegate=function(t){return i.onParseError(t)},i._onLoadProgressDelegate=function(t){return i.onLoadProgress(t)},i._onLoadCompleteDelegate=function(t){return i.onLoadComplete(t)},i._onLoadErrorDelegate=function(t){return i.onLoadError(t)},i._onTextureSizeErrorDelegate=function(t){return i.onTextureSizeError(t)},i._onAssetCompleteDelegate=function(t){return i.onAssetComplete(t)},i}return __extends(e,t),e.enableParser=function(t){e._parsers.indexOf(t)<0&&e._parsers.push(t)},e.enableParsers=function(t){for(var i=0;i<t.length;i++)e.enableParser(t[i])},Object.defineProperty(e.prototype,"baseDependency",{get:function(){return this._baseDependency},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaderInfo",{get:function(){return this._loaderInfo},enumerable:!0,configurable:!0}),e.prototype.load=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this._uri=t.url=t.url.replace(/\\/g,"/"),this._context=e,this._namespace=i,this._baseDependency=new ResourceDependency("",t,null,r,null),this.retrieveDependency(this._baseDependency)},e.prototype.loadData=function(t,e,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),this._uri=e,this._context=i,this._namespace=r,this._baseDependency=new ResourceDependency(e,null,t,n,null),this.retrieveDependency(this._baseDependency)},e.prototype.retrieveNext=function(t){if(void 0===t&&(t=null),this._currentDependency.dependencies.length){var e=this._currentDependency.dependencies.pop();this._stack.push(this._currentDependency),this.retrieveDependency(e)}else if(this._currentDependency.parser&&this._currentDependency.parser.parsingPaused)this._currentDependency.parser._iResumeParsing();else if(this._stack&&this._stack.length){var i=this._currentDependency;this._currentDependency=this._stack.pop(),i._iSuccess&&i.resolve(),this.retrieveNext(t)}else this.dispatchEvent(new LoaderEvent(LoaderEvent.LOAD_COMPLETE,this._uri,this._baseDependency.parser.content,this._baseDependency.assets))},e.prototype.retrieveDependency=function(t){var e;this._context&&0!=this._context.materialMode&&(this._materialMode=this._context.materialMode),this._currentDependency=t,t._iLoader=new URLLoader,this.addEventListeners(t._iLoader),e=t.data,this._context&&t.request&&(this._context._iHasDataForUrl(t.request.url)?e=this._context._iGetDataForUrl(t.request.url):this._context.externalAssetMode!=LoaderContext.ON_DEMAND||"jpg"!=this.getSuffix(t.request.url)&&"png"!=this.getSuffix(t.request.url)||(e=t.request,t.parser||t._iSetParser(this.getParserFromSuffix(t.request.url)))),e?(e.constructor===Function&&(e=new e),t._iSetData(e),t.retrieveAsRawData?(t.resolve(),this.retrieveNext()):this.parseDependency(t)):(t.request.url=this.resolveDependencyUrl(t),t.retrieveAsRawData?t._iLoader.dataFormat=URLLoaderDataFormat.BINARY:(t.parser||t._iSetParser(this.getParserFromSuffix(t.request.url)),t.parser?t._iLoader.dataFormat=t.parser.dataFormat:t._iLoader.dataFormat=URLLoaderDataFormat.BINARY),t._iLoader.load(t.request))},e.prototype.joinUrl=function(t,e){return"/"!=e.charAt(0)&&"\\"!=e.charAt(0)||(e=e.substr(1)),"."==e.charAt(0)&&(e=e.substr(2)),0==t.length?e:("/"!=t.charAt(t.length-1)&&"\\"!=t.charAt(t.length-1)||(t=t.substr(0,t.length-1)),t.concat("/",e))},e.prototype.resolveDependencyUrl=function(t){var e,i,r=t.request.url;if(this._context&&this._context._iHasMappingForUrl(r))return this._context._iGetRemappedUrl(r);if(r==this._uri)return r;if(e=new RegExp("/^[a-zA-Z]{3,4}:///"),"/"==r.charAt(0))return this._context&&this._context.overrideAbsolutePaths?this.joinUrl(this._context.dependencyBaseUrl,r):r;if(e.test(r)&&this._context&&this._context.overrideFullURLs){var n=r.replace(e,"");return this.joinUrl(this._context.dependencyBaseUrl,n)}return this._context&&this._context.dependencyBaseUrl?(i=this._context.dependencyBaseUrl,this.joinUrl(i,r)):(i=this._uri.substring(0,this._uri.lastIndexOf("/")+1),this.joinUrl(i,r))},e.prototype.retrieveParserDependencies=function(){if(this._currentDependency){var t,e=this._currentDependency.parser.dependencies,i=e.length;for(t=0;t<i;t++)this._currentDependency.dependencies[t]=e[t];e.length=0,this._stack.push(this._currentDependency),this.retrieveNext()}},e.prototype.resolveParserDependencies=function(){this._currentDependency._iSuccess=!0,this._currentDependency.parser&&this._currentDependency.parser.dependencies.length&&(!this._context||this._context.includeDependencies)?this.retrieveParserDependencies():this.retrieveNext()},e.prototype.onLoadError=function(t){var e,i=this._currentDependency!=this._baseDependency,r=t.urlLoader;if(this.removeEventListeners(r),this.hasEventListener(URLLoaderEvent.LOAD_ERROR))this.dispatchEvent(t),e=!0;else{var n,o=this._errorHandlers.length;for(n=0;n<o;n++)e||(e=this._errorHandlers[n](t))}if(!e)throw new Error;i?(this._currentDependency.resolveFailure(),this.retrieveNext()):this.dispose()},e.prototype.onParseError=function(t){this._currentDependency,this._baseDependency;var e,i=t.target;if(this.removeEventListeners(i),this.hasEventListener(ParserEvent.PARSE_ERROR))this.dispatchEvent(t),e=!0;else{var r,n=this._parseErrorHandlers.length;for(r=0;r<n;r++)e||(e=this._parseErrorHandlers[r](t))}if(!e)throw new Error(t.message);this.retrieveNext()},e.prototype.onAssetComplete=function(t){this._currentDependency&&this._currentDependency.assets.push(t.asset),t.asset.resetAssetPath(t.asset.name,this._namespace),this._currentDependency.suppresAssetEvents||this.dispatchEvent(t)},e.prototype.onReadyForDependencies=function(t){var e=t.target;this._context&&!this._context.includeDependencies?e._iResumeParsing():this.retrieveParserDependencies()},e.prototype.onLoadProgress=function(t){this.dispatchEvent(t)},e.prototype.onLoadComplete=function(t){var e=t.urlLoader;this.removeEventListeners(e),this._currentDependency._iSetData(e.data),this._currentDependency.retrieveAsRawData?this.resolveParserDependencies():this.parseDependency(this._currentDependency)},e.prototype.onParseComplete=function(t){var e=t.target;e.removeEventListener(ParserEvent.READY_FOR_DEPENDENCIES,this._onReadyForDependenciesDelegate),e.removeEventListener(ParserEvent.PARSE_COMPLETE,this._onParseCompleteDelegate),e.removeEventListener(ParserEvent.PARSE_ERROR,this._onParseErrorDelegate),e.removeEventListener(AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),e.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),this.resolveParserDependencies()},e.prototype.onTextureSizeError=function(t){t.asset.name=this._currentDependency.resolveName(t.asset),this.dispatchEvent(t)},e.prototype.addEventListeners=function(t){t.addEventListener(URLLoaderEvent.LOAD_PROGRESS,this._onLoadProgressDelegate),t.addEventListener(URLLoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),t.addEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate)},e.prototype.removeEventListeners=function(t){t.removeEventListener(URLLoaderEvent.LOAD_PROGRESS,this._onLoadProgressDelegate),t.removeEventListener(URLLoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),t.removeEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate)},e.prototype.stop=function(){this.dispose()},e.prototype.dispose=function(){this._errorHandlers=null,this._parseErrorHandlers=null,this._context=null,this._stack=null,this._currentDependency&&this._currentDependency._iLoader&&this.removeEventListeners(this._currentDependency._iLoader),this._currentDependency=null},e.prototype._iAddParseErrorHandler=function(t){this._parseErrorHandlers.indexOf(t)<0&&this._parseErrorHandlers.push(t)},e.prototype._iAddErrorHandler=function(t){this._errorHandlers.indexOf(t)<0&&this._errorHandlers.push(t)},e.prototype.getParserFromData=function(t){for(var i=e._parsers.length-1;i>=0;i--)if(e._parsers[i].supportsData(t))return new e._parsers[i];return null},e.prototype.parseDependency=function(t){var e=t.parser;if(e||t._iSetParser(e=this.getParserFromData(t.data)),e)e.addEventListener(ParserEvent.READY_FOR_DEPENDENCIES,this._onReadyForDependenciesDelegate),e.addEventListener(ParserEvent.PARSE_COMPLETE,this._onParseCompleteDelegate),e.addEventListener(ParserEvent.PARSE_ERROR,this._onParseErrorDelegate),e.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),e.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),t.request&&t.request.url&&(e._iFileName=t.request.url),e.materialMode=this._materialMode,e.parseAsync(t.data);else{var i,r="No parser defined. To enable all parsers for auto-detection, use Parsers.enableAllBundled()",n=new ParserEvent(ParserEvent.PARSE_ERROR,r);if(this.hasEventListener(ParserEvent.PARSE_ERROR))this.dispatchEvent(n),i=!0;else{var o,s=this._parseErrorHandlers.length;for(o=0;o<s;o++)i||(i=this._parseErrorHandlers[o](n))}if(!i)throw new Error(r);this.retrieveNext()}},e.prototype.getParserFromSuffix=function(t){for(var i=this.getSuffix(t),r=e._parsers.length-1;r>=0;r--){var n=e._parsers[r];if(n.supportsType(i))return new n}return null},e.prototype.getSuffix=function(t){var e=t.indexOf("?")>0?t.split("?")[0]:t;return e.substr(e.lastIndexOf(".")+1).toLowerCase()},e._parsers=new Array,e}(EventDispatcher),ConflictPrecedence=function(){function t(){}return t.FAVOR_OLD="favorOld",t.FAVOR_NEW="favorNew",t}(),ConflictStrategyBase=function(){function t(){}return t.prototype.resolveConflict=function(t,e,i,r){throw new AbstractMethodError},t.prototype.create=function(){throw new AbstractMethodError},t.prototype._pUpdateNames=function(t,e,i,r,n,o){var s,a,l;a=o===ConflictPrecedence.FAVOR_NEW?r:i,s=(l=o===ConflictPrecedence.FAVOR_NEW?i:r).adaptee.name,n[a.adaptee.name]=a,n[e]=l,l.adaptee.resetAssetPath(e,t,!1),l.adaptee.dispatchEvent(new AssetEvent(AssetEvent.ASSET_CONFLICT_RESOLVED,l.adaptee,s))},t}(),ErrorConflictStrategy=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.resolveConflict=function(t,e,i,r){throw new ErrorBase("Asset name collision while AssetLibrary.namingStrategy set to AssetLibrary.THROW_ERROR. Asset path: "+t.adaptee.assetFullPath)},e.prototype.create=function(){return new e},e}(ConflictStrategyBase),IgnoreConflictStrategy=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.resolveConflict=function(t,e,i,r){},e.prototype.create=function(){return new e},e}(ConflictStrategyBase),NumSuffixConflictStrategy=function(t){function e(e){void 0===e&&(e=".");var i=t.call(this)||this;return i._separator=e,i._next_suffix={},i}return __extends(e,t),e.prototype.resolveConflict=function(t,e,i,r){var n,o,s,a;(n=t.adaptee.name).indexOf(this._separator)>=0?(s=n.substring(0,n.lastIndexOf(this._separator)),a=parseInt(n.substring(s.length-1)),isNaN(a)&&(s=n,a=0)):(s=n,a=0),0==a&&this._next_suffix.hasOwnProperty(s)&&(a=this._next_suffix[s]);do{a++,o=s.concat(this._separator,a.toString())}while(i.hasOwnProperty(o));this._next_suffix[s]=a,this._pUpdateNames(e.adaptee.assetNamespace,o,e,t,i,r)},e.prototype.create=function(){return new e(this._separator)},e}(ConflictStrategyBase),ConflictStrategy=function(){function t(t){}return t.APPEND_NUM_SUFFIX=new NumSuffixConflictStrategy,t.IGNORE=new IgnoreConflictStrategy,t.THROW_ERROR=new ErrorConflictStrategy,t}(),AssetLibraryBundle=function(t){function e(){var e=t.call(this)||this;return e._loaderSessionsGarbage=new Array,e._assets=new Array,e._assetDictionary=new Object,e._loaderSessions=new Array,e.conflictStrategy=ConflictStrategy.IGNORE.create(),e.conflictPrecedence=ConflictPrecedence.FAVOR_NEW,e._onAssetRenameDelegate=function(t){return e.onAssetRename(t)},e._onAssetConflictResolvedDelegate=function(t){return e.onAssetConflictResolved(t)},e._onLoadCompleteDelegate=function(t){return e.onLoadComplete(t)},e._onTextureSizeErrorDelegate=function(t){return e.onTextureSizeError(t)},e._onAssetCompleteDelegate=function(t){return e.onAssetComplete(t)},e._onLoadErrorDelegate=function(t){return e.onLoadError(t)},e._onParseErrorDelegate=function(t){return e.onParseError(t)},e}return __extends(e,t),e.getInstance=function(t){return void 0===t&&(t="default"),t||(t="default"),e._iInstances.hasOwnProperty(t)||(e._iInstances[t]=new e),e._iInstances[t]},e.prototype.enableParser=function(t){Loader.enableParser(t)},e.prototype.enableParsers=function(t){Loader.enableParsers(t)},Object.defineProperty(e.prototype,"conflictStrategy",{get:function(){return this._strategy},set:function(t){if(!t)throw new ErrorBase("namingStrategy must not be null. To ignore naming, use AssetLibrary.IGNORE");this._strategy=t.create()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conflictPrecedence",{get:function(){return this._strategyPreference},set:function(t){this._strategyPreference=t},enumerable:!0,configurable:!0}),e.prototype.createIterator=function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),new AssetLibraryIterator(this._assets,t,e,i)},e.prototype.load=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this.getLoader().load(t,e,i,r)},e.prototype.loadData=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this.getLoader().loadData(t,"",e,i,r)},e.prototype.getLoader=function(){var t=new Loader;return this._loaderSessions.push(t),t.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),t.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),t.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),t._iAddErrorHandler(this._onLoadErrorDelegate),t._iAddParseErrorHandler(this._onParseErrorDelegate),t},e.prototype.disposeLoader=function(t){var e=this._loaderSessions.indexOf(t);this._loaderSessions.splice(e,1),this.killloaderSession(t)},e.prototype.getAsset=function(t,e){return void 0===e&&(e=null),this._assetDictDirty&&this.rehashAssetDict(),null==e&&(e=AssetBase.DEFAULT_NAMESPACE),this._assetDictionary.hasOwnProperty(e)?this._assetDictionary[e][t.toString().toLowerCase()]:null},e.prototype.getAllAssets=function(){return this._assets},e.prototype.addAsset=function(t){var e,i;this._assets.indexOf(t)>=0||(i=this.getAsset(t.adaptee.name,t.adaptee.assetNamespace),e=t.adaptee.assetNamespace||AssetBase.DEFAULT_NAMESPACE,null!=i&&this._strategy.resolveConflict(t,i,this._assetDictionary[e],this._strategyPreference),this._assets.push(t),this._assetDictionary.hasOwnProperty(e)||(this._assetDictionary[e]=new Object),this._assetDictionary[e][t.adaptee.name.toString().toLowerCase()]=t,t.adaptee.addEventListener(AssetEvent.RENAME,this._onAssetRenameDelegate),t.adaptee.addEventListener(AssetEvent.ASSET_CONFLICT_RESOLVED,this._onAssetConflictResolvedDelegate))},e.prototype.removeAsset=function(t,e){var i;void 0===e&&(e=!0),this.removeAssetFromDict(t),t.adaptee.removeEventListener(AssetEvent.RENAME,this._onAssetRenameDelegate),t.adaptee.removeEventListener(AssetEvent.ASSET_CONFLICT_RESOLVED,this._onAssetConflictResolvedDelegate),(i=this._assets.indexOf(t))>=0&&this._assets.splice(i,1),e&&t.dispose()},e.prototype.removeAssetByName=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=!0);var r=this.getAsset(t,e);return r&&this.removeAsset(r,i),r},e.prototype.removeAllAssets=function(t){if(void 0===t&&(t=!0),t)for(var e=this._assets.length,i=0;i<e;i++)this._assets[i].dispose();this._assets.length=0,this.rehashAssetDict()},e.prototype.removeNamespaceAssets=function(t,e){void 0===t&&(t=null),void 0===e&&(e=!0);var i,r,n=0;r=this._assets.concat(),this._assets.length=0,null==t&&(t=AssetBase.DEFAULT_NAMESPACE);for(var o=r.length,s=0;s<o;s++)(i=r[s]).adaptee.assetNamespace==t?(e&&i.dispose(),this.removeAssetFromDict(i,!1)):this._assets[n++]=i;this._assetDictionary.hasOwnProperty(t)&&delete this._assetDictionary[t]},e.prototype.removeAssetFromDict=function(t,e){if(void 0===e&&(e=!0),this._assetDictDirty&&this.rehashAssetDict(),this._assetDictionary.hasOwnProperty(t.adaptee.assetNamespace)&&(this._assetDictionary[t.adaptee.assetNamespace].hasOwnProperty(t.adaptee.name.toString().toLowerCase())&&delete this._assetDictionary[t.adaptee.assetNamespace][t.adaptee.name.toString().toLowerCase()],e)){var i,r=!0;for(i in this._assetDictionary[t.adaptee.assetNamespace]){r=!1;break}r&&delete this._assetDictionary[t.adaptee.assetNamespace]}},e.prototype.stopAllLoaders=function(){for(var t=this._loaderSessions.length,e=0;e<t;e++)this.killloaderSession(this._loaderSessions[e]);this._loaderSessions=new Array},e.prototype.rehashAssetDict=function(){var t;this._assetDictionary={};for(var e=this._assets.length,i=0;i<e;i++)t=this._assets[i],this._assetDictionary.hasOwnProperty(t.adaptee.assetNamespace)||(this._assetDictionary[t.adaptee.assetNamespace]={}),this._assetDictionary[t.adaptee.assetNamespace][t.adaptee.name.toString().toLowerCase()]=t;this._assetDictDirty=!1},e.prototype.onLoadError=function(t){return!!this.hasEventListener(URLLoaderEvent.LOAD_ERROR)&&(this.dispatchEvent(t),!0)},e.prototype.onParseError=function(t){return!!this.hasEventListener(ParserEvent.PARSE_ERROR)&&(this.dispatchEvent(t),!0)},e.prototype.onAssetComplete=function(t){t.type==AssetEvent.ASSET_COMPLETE&&this.addAsset(t.asset.adapter),this.dispatchEvent(t)},e.prototype.onTextureSizeError=function(t){this.dispatchEvent(t)},e.prototype.onLoadComplete=function(t){var e=t.target;this.dispatchEvent(t),this.disposeLoader(e)},e.prototype.killloaderSession=function(t){t.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),t.removeEventListener(AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),t.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),t.stop()},e.prototype.onAssetRename=function(t){var e=t.target.adapter,i=this.getAsset(e.adaptee.assetNamespace,e.adaptee.name);if(null!=i)this._strategy.resolveConflict(e,i,this._assetDictionary[e.adaptee.assetNamespace],this._strategyPreference);else{var r=this._assetDictionary[t.asset.assetNamespace];if(null==r)return;r[t.prevName]=null,r[t.asset.name.toString().toLowerCase()]=t.asset}},e.prototype.onAssetConflictResolved=function(t){this.dispatchEvent(t.clone())},e._iInstances=new Object,e}(EventDispatcher),AssetLibrary=function(){function t(){}return t.getBundle=function(t){return void 0===t&&(t="default"),AssetLibraryBundle.getInstance(t)},t.enableParser=function(t){Loader.enableParser(t)},t.enableParsers=function(t){Loader.enableParsers(t)},Object.defineProperty(t,"conflictStrategy",{get:function(){return t.getBundle().conflictStrategy},set:function(e){t.getBundle().conflictStrategy=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"conflictPrecedence",{get:function(){return t.getBundle().conflictPrecedence},set:function(e){t.getBundle().conflictPrecedence=e},enumerable:!0,configurable:!0}),t.createIterator=function(e,i,r){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),t.getBundle().createIterator(e,i,r)},t.load=function(e,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),t.getBundle().load(e,i,r,n)},t.loadData=function(e,i,r,n){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),t.getBundle().loadData(e,i,r,n)},t.stopLoad=function(){t.getBundle().stopAllLoaders()},t.getLoader=function(){return t.getBundle().getLoader()},t.getAsset=function(e,i){return void 0===i&&(i=null),t.getBundle().getAsset(e,i)},t.getAllAssets=function(){return t.getBundle().getAllAssets()},t.addEventListener=function(e,i){t.getBundle().addEventListener(e,i)},t.removeEventListener=function(e,i){t.getBundle().removeEventListener(e,i)},t.addAsset=function(e){t.getBundle().addAsset(e)},t.removeAsset=function(e,i){void 0===i&&(i=!0),t.getBundle().removeAsset(e,i)},t.removeAssetByName=function(e,i,r){return void 0===i&&(i=null),void 0===r&&(r=!0),t.getBundle().removeAssetByName(e,i,r)},t.removeAllAssets=function(e){void 0===e&&(e=!0),t.getBundle().removeAllAssets(e)},t.removeNamespaceAssets=function(e,i){void 0===e&&(e=null),void 0===i&&(i=!0),t.getBundle().removeNamespaceAssets(e,i)},t}(),LoaderInfo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"bytes",{get:function(){return this._bytes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loader",{get:function(){return this._loader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),e}(EventDispatcher),URLRequest=function(){function t(t){void 0===t&&(t=null),this.method=URLRequestMethod.GET,this.async=!0,this._url=t}return Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.data=null,this._url=null},t}(),Timer=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this)||this;if(r._repeatCount=0,r._currentCount=0,r._running=!1,r._delay=e,r._repeatCount=i,isNaN(e)||e<0)throw new ErrorBase("Delay is negative or not a number");return r}return __extends(e,t),Object.defineProperty(e.prototype,"currentCount",{get:function(){return this._currentCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},set:function(t){this._delay=t,this._running&&(this.stop(),this.start())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(t){this._repeatCount=t},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._running&&this.stop(),this._currentCount=0},Object.defineProperty(e.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),e.prototype.start=function(){var t=this;this._running=!0,clearInterval(this._iid),this._iid=setInterval((function(){return t.tick()}),this._delay)},e.prototype.stop=function(){this._running=!1,clearInterval(this._iid)},e.prototype.tick=function(){this._currentCount++,this._repeatCount>0&&this._currentCount>=this._repeatCount?(this.stop(),this.dispatchEvent(new TimerEvent(TimerEvent.TIMER)),this.dispatchEvent(new TimerEvent(TimerEvent.TIMER_COMPLETE))):this.dispatchEvent(new TimerEvent(TimerEvent.TIMER))},e}(EventDispatcher);function getTimer(){return Date.now()}var ParserBase=function(t){function e(e){var i=t.call(this)||this;return i._materialMode=0,i._dataFormat=e,i._dependencies=new Array,i._pOnIntervalDelegate=function(t){return i._pOnInterval(t)},i}return __extends(e,t),e.supportsType=function(t){throw new AbstractMethodError},Object.defineProperty(e.prototype,"content",{get:function(){return this._pContent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parsingFailure",{get:function(){return this._parsingFailure},set:function(t){this._parsingFailure=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parsingPaused",{get:function(){return this._parsingPaused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parsingComplete",{get:function(){return this._parsingComplete},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"materialMode",{get:function(){return this._materialMode},set:function(t){this._materialMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataFormat",{get:function(){return this._dataFormat},enumerable:!0,configurable:!0}),e.prototype.parseAsync=function(t,e){void 0===e&&(e=30),this._data=t,this._pStartParsing(e)},e.prototype.parseSync=function(t){this._data=t;for(var i=e.MORE_TO_PARSE;i==e.MORE_TO_PARSE;)i=this._pProceedParsing();return this._pContent},Object.defineProperty(e.prototype,"dependencies",{get:function(){return this._dependencies},enumerable:!0,configurable:!0}),e.prototype._iResolveDependency=function(t){throw new AbstractMethodError},e.prototype._iResolveDependencyFailure=function(t){throw new AbstractMethodError},e.prototype._iResolveDependencyName=function(t,e){return e.name},e.prototype._iResumeParsing=function(){this._parsingPaused=!1,this._timer&&this._timer.start(),this._isParsing||this._pOnInterval()},e.prototype._pFinalizeAsset=function(t,e){void 0===e&&(e=null),null!=e&&(t.name=e),t.name||(t.name=t.assetType),this.dispatchEvent(new AssetEvent(AssetEvent.ASSET_COMPLETE,t))},e.prototype._pProceedParsing=function(){throw new AbstractMethodError},e.prototype._pDieWithError=function(t){void 0===t&&(t="Unknown parsing error"),this._timer&&(this._timer.removeEventListener(TimerEvent.TIMER,this._pOnIntervalDelegate),this._timer.stop(),this._timer=null),this.dispatchEvent(new ParserEvent(ParserEvent.PARSE_ERROR,t))},e.prototype._pAddDependency=function(t,e,i,r,n,o,s){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=0);var a=new ResourceDependency(t,e,r,i,this,n,o,s);return this._dependencies.push(a),a},e.prototype._pPauseAndRetrieveDependencies=function(){this._pPauseParsing(),this.dispatchEvent(new ParserEvent(ParserEvent.READY_FOR_DEPENDENCIES))},e.prototype._pPauseParsing=function(){this._timer&&this._timer.stop(),this._parsingPaused=!0},e.prototype._pHasTime=function(){return getTimer()-this._lastFrameTime<this._frameLimit},e.prototype._pOnInterval=function(t){this._lastFrameTime=getTimer(),this._isParsing=!0,this._pProceedParsing()&&!this._parsingFailure&&this._pFinishParsing(),this._isParsing=!1},e.prototype._pStartParsing=function(t){this._frameLimit=t,this._timer=new Timer(this._frameLimit,0),this._timer.addEventListener(TimerEvent.TIMER,this._pOnIntervalDelegate),this._timer.start(),this._pOnInterval()},e.prototype._pFinishParsing=function(){this._timer&&(this._timer.removeEventListener(TimerEvent.TIMER,this._pOnIntervalDelegate),this._timer.stop()),this._timer=null,this._parsingComplete=!0,this._isParsing=!1,this.dispatchEvent(new ParserEvent(ParserEvent.PARSE_COMPLETE))},e.prototype._pGetTextData=function(){return ParserUtils.toString(this._data)},e.prototype._pGetByteData=function(){return ParserUtils.toByteArray(this._data)},e.prototype._pGetData=function(){return this._data},e.PARSING_DONE=!0,e.MORE_TO_PARSE=!1,e}(EventDispatcher),WaveAudioParser=function(t){function e(){return t.call(this,URLLoaderDataFormat.BLOB)||this}return __extends(e,t),e.supportsType=function(t){return"wav"==(t=t.toLowerCase())||"mp3"==t||"ogg"==t},e.supportsData=function(t){if(!(t instanceof ByteArray))return!1;var i=t;return!!e.parseFileType(i)},e.prototype._pStartParsing=function(e){delete this._pContent,this._pContent=null,t.prototype._pStartParsing.call(this,e)},e.prototype._pProceedParsing=function(){return this._pContent=new WaveAudio(new WaveAudioData(this.data)),this._pFinalizeAsset(this._pContent,this._iFileName),ParserBase.PARSING_DONE},e.parseFileType=function(t){if(t.position=0,65504==(65504&t.readUnsignedShort()))return"mp3";t.position=0;var e=t.readUnsignedByte(),i=t.readUnsignedByte(),r=t.readUnsignedByte();return 73===e&&68===i&&51===r||255===e&&251===i||255===e&&243===i&&130===r?"mp3":(t.position=0,"RIFF"==t.readUTFBytes(4)?"wav":(t.position=0,"OggS"==t.readUTFBytes(4)?"ogg":(t.position=0,null)))},e.processFilename=function(t){return t},e}(ParserBase),CoordinateSystem;!function(t){t[t.LEFT_HANDED=0]="LEFT_HANDED",t[t.RIGHT_HANDED=1]="RIGHT_HANDED"}(CoordinateSystem||(CoordinateSystem={}));var ProjectionBase=function(t){function e(e){void 0===e&&(e=CoordinateSystem.LEFT_HANDED);var i=t.call(this)||this;return i._viewMatrix3D=new Matrix3D,i._inverseViewMatrix3D=new Matrix3D,i._frustumMatrix3D=new Matrix3D,i._near=20,i._far=3e3,i._scale=1,i._ratio=1,i._originX=0,i._originY=0,i._frustumRect=new Rectangle,i._viewFrustumCorners=[],i._viewMatrix3DDirty=!0,i._inverseViewMatrix3DDirty=!0,i._frustumMatrix3DDirty=!0,i._viewFrustumCornersDirty=!0,i._viewFrustumPlanesDirty=!0,i._coordinateSystem=e,i._onInvalidateConcatenatedMatrix3DDelegate=function(t){return i._onInvalidateConcatenatedMatrix3D(t)},i}return __extends(e,t),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform!=t&&(this._transform&&this._transform.removeEventListener(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateConcatenatedMatrix3DDelegate),this._transform=t,this._transform&&this._transform.addEventListener(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateConcatenatedMatrix3DDelegate),this._invalidateViewMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinateSystem",{get:function(){return this._coordinateSystem},set:function(t){this._coordinateSystem!=t&&(this._coordinateSystem=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._propertiesDirty&&this._updateProperties(),this._scale},set:function(t){this._scale!=t&&(this._scale=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._propertiesDirty&&this._updateProperties(),this._ratio},set:function(t){this._ratio!=t&&(this._ratio=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumMatrix3D",{get:function(){return this._frustumMatrix3DDirty&&this._updateFrustumMatrix3D(),this._frustumMatrix3D},set:function(t){this._frustumMatrix3D=t,this._invalidateViewMatrix3D(),this._invalidateProperties()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewFrustumCorners",{get:function(){if(this._viewFrustumCornersDirty){this._viewFrustumCornersDirty=!1,this._frustumMatrix3DDirty&&this._updateFrustumMatrix3D();var t=this._frustumRect.left,e=this._frustumRect.right,i=this._frustumRect.top,r=this._frustumRect.bottom;this._propertiesDirty&&this._updateProperties();var n=this._near,o=this._far;this._viewFrustumCorners[0]=this._viewFrustumCorners[9]=n*t,this._viewFrustumCorners[3]=this._viewFrustumCorners[6]=n*e,this._viewFrustumCorners[1]=this._viewFrustumCorners[4]=n*i,this._viewFrustumCorners[7]=this._viewFrustumCorners[10]=n*r,this._viewFrustumCorners[12]=this._viewFrustumCorners[21]=o*t,this._viewFrustumCorners[15]=this._viewFrustumCorners[18]=o*e,this._viewFrustumCorners[13]=this._viewFrustumCorners[16]=o*i,this._viewFrustumCorners[19]=this._viewFrustumCorners[22]=o*r,this._viewFrustumCorners[2]=this._viewFrustumCorners[5]=this._viewFrustumCorners[8]=this._viewFrustumCorners[11]=n,this._viewFrustumCorners[14]=this._viewFrustumCorners[17]=this._viewFrustumCorners[20]=this._viewFrustumCorners[23]=o,this._transform.concatenatedMatrix3D.transformVectors(this._viewFrustumCorners,this._viewFrustumCorners)}return this._viewFrustumCorners},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewFrustumPlanes",{get:function(){if(this._viewFrustumPlanesDirty){if(this._viewFrustumPlanesDirty=!1,!this._viewFrustumPlanes){this._viewFrustumPlanes=[];for(var t=0;t<6;++t)this._viewFrustumPlanes[t]=new Plane3D}var e,i,r,n,o,s=this.viewMatrix3D._rawData,a=s[0],l=s[4],h=s[8],c=s[12],u=s[1],p=s[5],d=s[9],f=s[13],_=s[2],g=s[6],m=s[10],y=s[14],v=s[3],b=s[7],x=s[11],A=s[15];o=this._viewFrustumPlanes[0],i=v+a,r=b+l,n=x+h,e=1/Math.sqrt(i*i+r*r+n*n),o.a=i*e,o.b=r*e,o.c=n*e,o.d=-(A+c)*e,o=this._viewFrustumPlanes[1],i=v-a,r=b-l,n=x-h,e=1/Math.sqrt(i*i+r*r+n*n),o.a=i*e,o.b=r*e,o.c=n*e,o.d=(c-A)*e,o=this._viewFrustumPlanes[2],i=v+u,r=b+p,n=x+d,e=1/Math.sqrt(i*i+r*r+n*n),o.a=i*e,o.b=r*e,o.c=n*e,o.d=-(A+f)*e,o=this._viewFrustumPlanes[3],i=v-u,r=b-p,n=x-d,e=1/Math.sqrt(i*i+r*r+n*n),o.a=i*e,o.b=r*e,o.c=n*e,o.d=(f-A)*e,o=this._viewFrustumPlanes[4],i=_,r=g,n=m,e=1/Math.sqrt(i*i+r*r+n*n),o.a=i*e,o.b=r*e,o.c=n*e,o.d=-y*e,o=this._viewFrustumPlanes[5],i=v-_,r=b-g,n=x-m,e=1/Math.sqrt(i*i+r*r+n*n),o.a=i*e,o.b=r*e,o.c=n*e,o.d=(y-A)*e}return this._viewFrustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._propertiesDirty&&this._updateProperties(),this._near},set:function(t){t!=this._near&&(this._near=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originX",{get:function(){return this._propertiesDirty&&this._updateProperties(),this._originX},set:function(t){this._originX!=t&&(this._originX=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originY",{get:function(){return this._propertiesDirty&&this._updateProperties(),this._originY},set:function(t){this._originY!=t&&(this._originY=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._propertiesDirty&&this._updateProperties(),this._far},set:function(t){t!=this._far&&(this._far=t,this._invalidateFrustumMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumRect",{get:function(){return this._frustumMatrix3DDirty&&this._updateFrustumMatrix3D(),this._frustumRect},enumerable:!0,configurable:!0}),e.prototype.project=function(t,e){throw new AbstractMethodError},e.prototype.unproject=function(t,e,i,r){throw new AbstractMethodError},Object.defineProperty(e.prototype,"viewMatrix3D",{get:function(){return this._viewMatrix3DDirty&&(this._viewMatrix3DDirty=!1,this._transform?(this._viewMatrix3D.copyFrom(this._transform.inverseConcatenatedMatrix3D),this._viewMatrix3D.append(this.frustumMatrix3D)):this._viewMatrix3D.copyFrom(this.frustumMatrix3D)),this._viewMatrix3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseViewMatrix3D",{get:function(){return this._inverseViewMatrix3DDirty&&(this._inverseViewMatrix3DDirty=!1,this._inverseViewMatrix3D.copyFrom(this.viewMatrix3D),this._inverseViewMatrix3D.invert()),this._inverseViewMatrix3D},enumerable:!0,configurable:!0}),e.prototype.clone=function(){throw new AbstractMethodError},e.prototype._invalidateProperties=function(){this._propertiesDirty=!0},e.prototype._invalidateViewMatrix3D=function(){this._viewMatrix3DDirty=!0,this._inverseViewMatrix3DDirty=!0,this._viewFrustumCornersDirty=!0,this._viewFrustumPlanesDirty=!0,this.dispatchEvent(new ProjectionEvent(ProjectionEvent.INVALIDATE_VIEW_MATRIX3D,this))},e.prototype._invalidateFrustumMatrix3D=function(){this._propertiesDirty&&this._updateProperties(),this._frustumMatrix3DDirty=!0,this.dispatchEvent(new ProjectionEvent(ProjectionEvent.INVALIDATE_FRUSTUM_MATRIX3D,this)),this._invalidateViewMatrix3D()},e.prototype._updateFrustumMatrix3D=function(){this._frustumMatrix3DDirty=!1},e.prototype._updateProperties=function(){this._propertiesDirty=!1},e.prototype._onInvalidateConcatenatedMatrix3D=function(t){this._invalidateViewMatrix3D()},e}(EventDispatcher),ObliqueNearPlaneProjection=function(t){function e(e,i){var r=t.call(this)||this;return r.baseProjection=e,r.plane=i,r._onProjectionMatrixChangedDelegate=function(t){return r.onProjectionMatrixChanged(t)},r}return __extends(e,t),Object.defineProperty(e.prototype,"near",{get:function(){return this._baseProjection.near},set:function(t){this._baseProjection.near=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._baseProjection.far},set:function(t){this._baseProjection.far=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plane",{get:function(){return this._plane},set:function(t){this._plane=t,this._invalidateFrustumMatrix3D()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseProjection",{set:function(t){this._baseProjection&&this._baseProjection.removeEventListener(ProjectionEvent.INVALIDATE_FRUSTUM_MATRIX3D,this._onProjectionMatrixChangedDelegate),this._baseProjection=t,this._baseProjection&&this._baseProjection.addEventListener(ProjectionEvent.INVALIDATE_FRUSTUM_MATRIX3D,this._onProjectionMatrixChangedDelegate),this._invalidateFrustumMatrix3D()},enumerable:!0,configurable:!0}),e.prototype.onProjectionMatrixChanged=function(t){this._invalidateFrustumMatrix3D()},e.prototype._updateFrustumMatrix3D=function(){t.prototype._updateFrustumMatrix3D.call(this),this._frustumMatrix3D.copyFrom(this._baseProjection.frustumMatrix3D);var e=this._plane.a,i=this._plane.b,r=this._plane.c,n=.05-this._plane.d,o=new Vector3D(e>=0?1:-1,i>=0?1:-1,1,1),s=this._frustumMatrix3D.clone();s.invert();var a=s.transformVector(o);this._frustumMatrix3D.copyRowTo(3,o);var l=(a.x*o.x+a.y*o.y+a.z*o.z+a.w*o.w)/(e*a.x+i*a.y+r*a.z+n*a.w);this._frustumMatrix3D.copyRowFrom(2,new Vector3D(e*l,i*l,r*l,n*l))},e}(ProjectionBase),OrthographicProjection=function(t){function e(e,i){void 0===e&&(e=1),void 0===i&&(i=CoordinateSystem.LEFT_HANDED);var r=t.call(this,i)||this;return r.scale=e,r}return __extends(e,t),e.prototype.project=function(t,e){void 0===e&&(e=null);var i=this.viewMatrix3D.transformVector(t,e);return i.x=i.x,i.y=-i.y,i.z=(i.z*(this._far-this._near)+this._far+this._near)/2,i.w=1,i},e.prototype.unproject=function(t,e,i,r){return void 0===r&&(r=null),null==r&&(r=new Vector3D),r.x=t*i,r.y=-e*i,r.z=(2*i-this._far-this._near)/(this._far-this._near),r.w=1,this.inverseViewMatrix3D.transformVector(r,r),r.w=1,r},e.prototype.clone=function(){var t=new e(this.scale,this._coordinateSystem);return t._near=this._near,t._far=this._far,t._coordinateSystem=this._coordinateSystem,t},e.prototype._updateFrustumMatrix3D=function(){t.prototype._updateFrustumMatrix3D.call(this);var e=this._frustumMatrix3D._rawData,i=this._scale,r=this._scale/this._ratio;this._frustumRect.left=.5*(this._originX-1)/r,this._frustumRect.top=.5*(this._originY-1)/i,this._frustumRect.right=this._frustumRect.left+1/r,this._frustumRect.bottom=this._frustumRect.top+1/i,e[0]=2*r,e[5]=2*i,e[12]=this._originX,e[13]=this._originY,e[10]=2/(this._far-this._near),e[14]=-(this._far+this._near)/(this._far-this._near),e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=0,e[15]=1,this._frustumMatrix3D.invalidatePosition()},e.prototype._updateProperties=function(){t.prototype._updateProperties.call(this);var e=this._frustumMatrix3D._rawData;this._near=-(e[14]+1)/e[10],this._far=-(e[14]-1)/e[10],this._originX=e[8],this._originY=e[9],this._scale=e[5]/2,this._ratio=.5*this._scale/e[0]},e}(ProjectionBase),PerspectiveProjection=function(t){function e(e,i){void 0===e&&(e=60),void 0===i&&(i=CoordinateSystem.LEFT_HANDED);var r=t.call(this,i)||this;return r.fieldOfView=e,r}return __extends(e,t),Object.defineProperty(e.prototype,"fieldOfView",{get:function(){return 360*Math.atan(.5/this.scale)/Math.PI},set:function(t){this.scale=.5/Math.tan(t*Math.PI/360)},enumerable:!0,configurable:!0}),e.prototype.project=function(t,e){void 0===e&&(e=null);var i=this.viewMatrix3D.transformVector(t,e);return i.x=i.x/i.w,i.y=-i.y/i.w,i.z=i.w,i.w=1,i},e.prototype.unproject=function(t,e,i,r){return void 0===r&&(r=null),null==r&&(r=new Vector3D),r.x=t*i,r.y=-e*i,r.z=(this._far+this._near)/(this._far-this._near)*i-2*this._far*this._near/(this._far-this._near),r.w=i,this.inverseViewMatrix3D.transformVector(r,r),r.w=1,r},e.prototype.clone=function(){var t=new e(this.fieldOfView,this._coordinateSystem);return t._near=this._near,t._far=this._far,t._coordinateSystem=this._coordinateSystem,t},e.prototype._updateFrustumMatrix3D=function(){t.prototype._updateFrustumMatrix3D.call(this);var e=this._frustumMatrix3D._rawData,i=this._scale,r=this._scale/this._ratio;this._frustumRect.left=.5*(this._originX-1)/r,this._frustumRect.top=.5*(this._originY-1)/i,this._frustumRect.right=this._frustumRect.left+1/r,this._frustumRect.bottom=this._frustumRect.top+1/i,e[0]=2*r,e[5]=2*i,e[8]=this._originX,e[9]=this._originY,e[10]=(this._far+this._near)/(this._far-this._near),e[11]=1,e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[12]=e[13]=e[15]=0,e[14]=-2*this._far*this._near/(this._far-this._near),this._coordinateSystem==CoordinateSystem.RIGHT_HANDED&&(e[5]=-e[5]),this._frustumMatrix3D.invalidatePosition()},e.prototype._updateProperties=function(){t.prototype._updateProperties.call(this);var e=this._frustumMatrix3D._rawData;this._near=e[14]/(-1-e[10]),this._far=e[14]/(1-e[10]),this._scale=e[5]/2,this._ratio=.5*this._scale/e[0],this._originX=e[8],this._originY=e[9]},e}(ProjectionBase),BuildMode=function(){function t(){}return t.AVM1="avm1",t.AS2_AS_JS="as2asjs",t.STANDART="standart",t.mode=t.STANDART,t}(),Byte32Array=function(){function t(t){void 0===t&&(t=0),this._maxLength=-1,this.bytePosition=0,this.byteLength=-1,this._ensureSpace(t)}return Object.defineProperty(t.prototype,"arrayBuffer",{get:function(){return this._arrayBuffer},set:function(t){this.bytePosition=0,this.byteLength=-1,this._maxLength=-1,this._ensureSpace(t.byteLength),this._int32Array.set(new Int32Array(t))},enumerable:!0,configurable:!0}),t.prototype.readByte32Array=function(t,e){void 0===e&&(e=-1),-1==e&&(e=t.byteLength-t.bytePosition),t.writeInt32Array(this._int32Array.subarray(this.bytePosition/4,(this.bytePosition+e)/4)),this.bytePosition+=e},t.prototype.writeByte32Array=function(t){t.bytePosition=0,t.readByte32Array(this,t.byteLength)},t.prototype.writeFloat32Array=function(t){this._ensureSpace(this.bytePosition+4*t.length),this._float32Array.set(t,this.bytePosition/4),this.bytePosition+=4*t.length},t.prototype.writeInt32Array=function(t){this._ensureSpace(this.bytePosition+4*t.length),this._uint32Array.set(t,this.bytePosition/4),this.bytePosition+=4*t.length},t.prototype.writeUint32Array=function(t){this._ensureSpace(this.bytePosition+4*t.length),this._uint32Array.set(t,this.bytePosition/4),this.bytePosition+=4*t.length},t.prototype.readFloat32Array=function(t){t.set(this._float32Array.subarray(this.bytePosition/4,this.bytePosition/4+t.length))},t.prototype.readInt32Array=function(t){t.set(this._int32Array.subarray(this.bytePosition/4,this.bytePosition/4+t.length))},t.prototype.readUint32Array=function(t){t.set(this._uint32Array.subarray(this.bytePosition/4,this.bytePosition/4+t.length))},t.prototype.getBytesAvailable=function(){return this.byteLength-this.bytePosition},t.prototype.readUTFBytes=function(t){for(var e="",i=this.bytePosition+t,r=new DataView(this._arrayBuffer);this.bytePosition<i;){var n=r.getUint8(this.bytePosition++);if(n<128){if(0==n)break;e+=String.fromCharCode(n)}else if(n<224)e+=String.fromCharCode((63&n)<<6|127&r.getUint8(this.bytePosition++));else if(n<240){var o=r.getUint8(this.bytePosition++);e+=String.fromCharCode((31&n)<<12|(127&o)<<6|127&r.getUint8(this.bytePosition++))}else{o=r.getUint8(this.bytePosition++);var s=r.getUint8(this.bytePosition++);e+=String.fromCharCode((15&n)<<18|(127&o)<<12|s<<6&127|127&r.getUint8(this.bytePosition++))}}return e},t.prototype.writeUTFBytes=function(t){var e=encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt("0x"+e))}));if(e.length%4)for(var i=4-e.length%4,r=0;r<i;r++)e+=" ";this._ensureSpace(this.bytePosition+4+e.length),this.writeInt(e.length);for(r=0;r<e.length;r+=4)this.writeUnsignedInt(e.charCodeAt(r+3)<<24|e.charCodeAt(r+2)<<16|e.charCodeAt(r+1)<<8|e.charCodeAt(r));return e.length},t.prototype.readInt=function(){if(this.bytePosition>this.byteLength+4)throw"ByteArray out of bounds read. Position="+this.bytePosition+", Length="+this.byteLength;var t=this.bytePosition>>2;return this.bytePosition+=4,this._int32Array[t]},t.prototype.writeUnsignedInt=function(t){this._ensureSpace(this.bytePosition+4),this._uint32Array[this.bytePosition>>2]=4294967295&~~t,this.bytePosition+=4},t.prototype.writeInt=function(t){this._ensureSpace(this.bytePosition+4),this._int32Array[this.bytePosition>>2]=~~t,this.bytePosition+=4},t.prototype.readUnsignedInt=function(){if(this.bytePosition>this.byteLength+4)throw"ByteArray out of bounds read. Position="+this.bytePosition+", Length="+this.byteLength;var t=this.bytePosition>>2;return this.bytePosition+=4,this._uint32Array[t]},t.prototype.writeFloat=function(t){this._ensureSpace(this.bytePosition+4),this._float32Array[this.bytePosition>>2]=t,this.bytePosition+=4},t.prototype.readFloat=function(){if(this.bytePosition>this.byteLength+4)throw"ByteArray out of bounds read. Positon="+this.bytePosition+", Length="+this.byteLength;var t=this.bytePosition>>2;return this.bytePosition+=4,this._float32Array[t]},t.prototype._ensureSpace=function(t){if(this.byteLength<t&&(this.byteLength=t,this._maxLength<t)){this._maxLength=Math.max(t+255&-256,4);var e=new ArrayBuffer(this._maxLength),i=new Int32Array(e);this._int32Array&&i.set(this._int32Array),this._uint32Array=new Uint32Array(e),this._float32Array=new Float32Array(e),this._int32Array=i,this._arrayBuffer=e}},t}(),ByteArrayBuffer=function(t){function e(){var e=t.call(this)||this;return e._bytes=[],e._mode="Array",e}return __extends(e,t),e.prototype.writeByte=function(t){var e=~~t;this._bytes[this.position++]=e,this.position>this.length&&(this.length=this.position)},e.prototype.readByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;return this._bytes[this.position++]},e.prototype.writeUnsignedByte=function(t){var e=~~t;this._bytes[this.position++]=255&e,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedByte=function(){if(this.position>=this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;return this._bytes[this.position++]},e.prototype.writeUnsignedShort=function(t){var e=~~t;this._bytes[this.position++]=255&e,this._bytes[this.position++]=e>>8&255,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedShort=function(){if(this.position+2>this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;var t=this._bytes[this.position]|this._bytes[this.position+1]<<8;return this.position+=2,t},e.prototype.writeUnsignedInt=function(t){var e=~~t;this._bytes[this.position++]=255&e,this._bytes[this.position++]=e>>>8&255,this._bytes[this.position++]=e>>>16&255,this._bytes[this.position++]=e>>>24&255,this.position>this.length&&(this.length=this.position)},e.prototype.readUnsignedInt=function(){if(this.position+4>this.length)throw"ByteArray out of bounds read. Position="+this.position+", Length="+this.length;var t=this._bytes[this.position]|this._bytes[this.position+1]<<8|this._bytes[this.position+2]<<16|this._bytes[this.position+3]<<24;return this.position+=4,t>>>0},e.prototype.writeFloat=function(t){this.writeUnsignedInt(this.toFloatBits(Number(t)))},e.prototype.toFloatBits=function(t){if(0==t)return 0;var e=0;t<0?(t=-t,e=1):e=0;var i=Math.log(t)/Math.log(2);return i=Math.floor(i),t*=Math.pow(2,23-i),e<<31>>>0|(i+=127)<<23|Math.floor(t)-8388608},e.prototype.readFloat=function(t){return this.fromFloatBits(this.readUnsignedInt())},e.prototype.fromFloatBits=function(t){if(0==t)return 0;var e=t>>>23&255,i=8388607&t|8388608,r=Math.pow(2,e-127-23)*i;return t>>>31!=0&&(r=-r),r},e}(ByteArrayBase),CSS=function(){function t(){}return t.setElementSize=function(t,e,i){t&&(t.style.width=e+"px",t.style.height=i+"px",t.width=e,t.height=i)},t.setElementWidth=function(t,e){t&&(t.style.width=e+"px",t.width=e)},t.setElementHeight=function(t,e){t&&(t.style.height=e+"px",t.height=e)},t.setElementX=function(t,e){t&&(t.style.position="absolute",t.style.left=e+"px")},t.setElementY=function(t,e){t&&(t.style.position="absolute",t.style.top=e+"px")},t.getElementVisibility=function(t){return!!t&&"visible"==t.style.visibility},t.setElementVisibility=function(t,e){t&&(t.style.visibility=e?"visible":"hidden")},t.setElementAlpha=function(t,e){t instanceof HTMLCanvasElement&&(t.getContext("2d").globalAlpha=e)},t.setElementPosition=function(t,e,i,r){void 0===r&&(r=!1),t&&(t.style.position=r?"absolute":"relative",t.style.left=e+"px",t.style.top=i+"px")},t}(),Extensions=function(){function t(){}return t.SIMD=Boolean("undefined"!=typeof SIMD),t}(),RequestAnimationFrame=function(){function t(t,e){var i=this;this._active=!1,this._argsArray=new Array,this._getTimer=getTimer,this.setCallback(t,e),this._rafUpdateFunction=function(){i._active&&i._tick()},this._argsArray.push(this._dt)}return t.prototype.setCallback=function(t,e){this._callback=t,this._callbackContext=e},t.prototype.start=function(){this._prevTime=this._getTimer(),this._active=!0,window&&(window.requestAnimationFrame?window.requestAnimationFrame(this._rafUpdateFunction):window.mozRequestAnimationFrame?window.requestAnimationFrame=window.mozRequestAnimationFrame:window.webkitRequestAnimationFrame?window.requestAnimationFrame=window.webkitRequestAnimationFrame:window.oRequestAnimationFrame&&(window.requestAnimationFrame=window.oRequestAnimationFrame))},t.prototype.stop=function(){this._active=!1},Object.defineProperty(t.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),t.prototype._tick=function(){this._currentTime=this._getTimer(),this._dt=this._currentTime-this._prevTime,this._argsArray[0]=this._dt,this._callback.apply(this._callbackContext,this._argsArray),window.requestAnimationFrame(this._rafUpdateFunction),this._prevTime=this._currentTime},t}(),XmlUtils=function(){function t(){}return t.getChildrenWithTag=function(t,e){var i=document.createDocumentFragment();if(t)for(var r=t.childNodes.length,n=0;n<r;n++){var o=t.childNodes[n];null!=o&&o.nodeName==e&&i.appendChild(o)}return i.childNodes},t.filterListByParam=function(t,e,i){var r=document.createDocumentFragment();if(t)for(var n=t.length,o=0;o<n;o++){var s=t[o];null!=s&&s.attributes.getNamedItem(e).value==i&&r.appendChild(s)}return r.childNodes},t.strToXml=function(t){return(new DOMParser).parseFromString(t,"text/xml")},t.nodeToString=function(t){return t?(new XMLSerializer).serializeToString(t):""},t.readAttributeValue=function(t,e){var i=t.attributes;if(null==i)return"";var r=i.getNamedItem(e);return r?r.value:""},t.writeAttributeValue=function(t,e,i){var r=document.createAttribute(e);r.value=i,r=t.attributes.setNamedItem(r),console.log("XmlUltils - writeAttributeValue() - name: "+r.name+", value: "+r.value)},t.hasAttribute=function(t,e){var i=t.attributes;return null!=i&&null!=i.getNamedItem(e)},t}();console.debug("AwayJS - Core - 0.8.14"),Loader.enableParser(WaveAudioParser);var Flags=function(){},FS=function(){},Opcode=function(t,e,i,r,n,o,s,a,l,h){this.a=new FS,this.b=new FS,this.flags=new Flags,this.dest=t,this.a.format=e,this.a.size=i,this.b.format=r,this.b.size=n,this.opcode=o,this.flags.simple=s,this.flags.horizontal=a,this.flags.fragonly=l,this.flags.matrix=h},OpcodeMap=function(){function t(){}return Object.defineProperty(t,"map",{get:function(){return t._map||(t._map=new Array,t._map.mov=new Opcode("vector","vector",4,"none",0,0,!0,null,null,null),t._map.add=new Opcode("vector","vector",4,"vector",4,1,!0,null,null,null),t._map.sub=new Opcode("vector","vector",4,"vector",4,2,!0,null,null,null),t._map.mul=new Opcode("vector","vector",4,"vector",4,3,!0,null,null,null),t._map.div=new Opcode("vector","vector",4,"vector",4,4,!0,null,null,null),t._map.rcp=new Opcode("vector","vector",4,"none",0,5,!0,null,null,null),t._map.min=new Opcode("vector","vector",4,"vector",4,6,!0,null,null,null),t._map.max=new Opcode("vector","vector",4,"vector",4,7,!0,null,null,null),t._map.frc=new Opcode("vector","vector",4,"none",0,8,!0,null,null,null),t._map.sqt=new Opcode("vector","vector",4,"none",0,9,!0,null,null,null),t._map.rsq=new Opcode("vector","vector",4,"none",0,10,!0,null,null,null),t._map.pow=new Opcode("vector","vector",4,"vector",4,11,!0,null,null,null),t._map.log=new Opcode("vector","vector",4,"none",0,12,!0,null,null,null),t._map.exp=new Opcode("vector","vector",4,"none",0,13,!0,null,null,null),t._map.nrm=new Opcode("vector","vector",4,"none",0,14,!0,null,null,null),t._map.sin=new Opcode("vector","vector",4,"none",0,15,!0,null,null,null),t._map.cos=new Opcode("vector","vector",4,"none",0,16,!0,null,null,null),t._map.crs=new Opcode("vector","vector",4,"vector",4,17,!0,!0,null,null),t._map.dp3=new Opcode("vector","vector",4,"vector",4,18,!0,!0,null,null),t._map.dp4=new Opcode("vector","vector",4,"vector",4,19,!0,!0,null,null),t._map.abs=new Opcode("vector","vector",4,"none",0,20,!0,null,null,null),t._map.neg=new Opcode("vector","vector",4,"none",0,21,!0,null,null,null),t._map.sat=new Opcode("vector","vector",4,"none",0,22,!0,null,null,null),t._map.ted=new Opcode("vector","vector",4,"sampler",1,38,!0,null,!0,null),t._map.kil=new Opcode("none","scalar",1,"none",0,39,!0,null,!0,null),t._map.tex=new Opcode("vector","vector",4,"sampler",1,40,!0,null,!0,null),t._map.m33=new Opcode("vector","matrix",3,"vector",3,23,!0,null,null,!0),t._map.m44=new Opcode("vector","matrix",4,"vector",4,24,!0,null,null,!0),t._map.m43=new Opcode("vector","matrix",3,"vector",4,25,!0,null,null,!0),t._map.ddx=new Opcode("vector","vector",4,"none",0,26,!0,null,!0,null),t._map.ddy=new Opcode("vector","vector",4,"none",0,27,!0,null,!0,null),t._map.sge=new Opcode("vector","vector",4,"vector",4,41,!0,null,null,null),t._map.slt=new Opcode("vector","vector",4,"vector",4,42,!0,null,null,null),t._map.sgn=new Opcode("vector","vector",4,"vector",4,43,!0,null,null,null),t._map.seq=new Opcode("vector","vector",4,"vector",4,44,!0,null,null,null),t._map.sne=new Opcode("vector","vector",4,"vector",4,45,!0,null,null,null)),t._map},enumerable:!0,configurable:!0}),t}(),Part=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.name="",this.version=0,this.name=t,this.version=e,this.data=new ByteArray},Reg=function(t,e){this.code=t,this.desc=e},RegMap=function(){function t(){}return Object.defineProperty(t,"map",{get:function(){return t._map||(t._map=new Array,t._map.va=new Reg(0,"vertex attribute"),t._map.fc=new Reg(1,"fragment constant"),t._map.vc=new Reg(1,"vertex constant"),t._map.ft=new Reg(2,"fragment temporary"),t._map.vt=new Reg(2,"vertex temporary"),t._map.vo=new Reg(3,"vertex output"),t._map.op=new Reg(3,"vertex output"),t._map.fd=new Reg(3,"fragment depth output"),t._map.fo=new Reg(3,"fragment output"),t._map.oc=new Reg(3,"fragment output"),t._map.v=new Reg(4,"varying"),t._map.vi=new Reg(4,"varying output"),t._map.fi=new Reg(4,"varying input"),t._map.fs=new Reg(5,"sampler")),t._map},enumerable:!0,configurable:!0}),t}(),Sampler=function(t,e,i){this.shift=t,this.mask=e,this.value=i},SamplerMap=function(){function t(){}return Object.defineProperty(t,"map",{get:function(){return t._map||(t._map=new Array,t._map.rgba=new Sampler(8,15,0),t._map.rg=new Sampler(8,15,5),t._map.r=new Sampler(8,15,4),t._map.compressed=new Sampler(8,15,1),t._map.compressed_alpha=new Sampler(8,15,2),t._map.dxt1=new Sampler(8,15,1),t._map.dxt5=new Sampler(8,15,2),t._map["2d"]=new Sampler(12,15,0),t._map.cube=new Sampler(12,15,1),t._map["3d"]=new Sampler(12,15,2),t._map.centroid=new Sampler(16,1,1),t._map.ignoresampler=new Sampler(16,4,4),t._map.clamp=new Sampler(20,15,0),t._map.repeat=new Sampler(20,15,1),t._map.wrap=new Sampler(20,15,1),t._map.nomip=new Sampler(24,15,0),t._map.mipnone=new Sampler(24,15,0),t._map.mipnearest=new Sampler(24,15,1),t._map.miplinear=new Sampler(24,15,2),t._map.nearest=new Sampler(28,15,0),t._map.linear=new Sampler(28,15,1)),t._map},enumerable:!0,configurable:!0}),t}(),AGALMiniAssembler=function(){function t(){this.r={},this.cur=new Part}return t.prototype.assemble=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),i||(i=1),e&&this.addHeader(e,i);var r=t.replace(/[\f\n\r\v]+/g,"\n").split("\n");for(var n in r)this.processLine(r[n],n);return this.r},t.prototype.processLine=function(t,e){var i=t.search("//");if(-1!=i&&(t=t.slice(0,i)),(t=t.replace(/^\s+|\s+$/g,"")).length>0){var r=t.search(/<.*>/g),n=null;-1!=r&&(n=t.slice(r).match(/([\w\.\-\+]+)/gi),t=t.slice(0,r));var o=t.match(/([\w\.\+\[\]]+)/gi);if(!o||o.length<1)t.length>=3&&console.log("Warning: bad line "+e+": "+t);else switch(o[0]){case"part":this.addHeader(o[1],Number(o[2]));break;case"endpart":if(!this.cur)throw"Unexpected endpart";return this.cur.data.position=0,void(this.cur=null);default:if(!this.cur)return void console.log("Warning: bad line "+e+": "+t+" (Outside of any part definition)");if("comment"==this.cur.name)return;var s=OpcodeMap.map[o[0]];if(!s)throw"Bad opcode "+o[0]+" "+e+": "+t;this.emitOpcode(this.cur,s.opcode);var a=1;if(s.dest&&"none"!=s.dest){if(!this.emitDest(this.cur,o[a++],s.dest))throw"Bad destination register "+o[a-1]+" "+e+": "+t}else this.emitZeroDword(this.cur);if(s.a&&"none"!=s.a.format){if(!this.emitSource(this.cur,o[a++],s.a))throw"Bad source register "+o[a-1]+" "+e+": "+t}else this.emitZeroQword(this.cur);if(s.b&&"none"!=s.b.format){if("sampler"==s.b.format){if(!this.emitSampler(this.cur,o[a++],s.b,n))throw"Bad sampler register "+o[a-1]+" "+e+": "+t}else if(!this.emitSource(this.cur,o[a++],s.b))throw"Bad source register "+o[a-1]+" "+e+": "+t}else this.emitZeroQword(this.cur)}}},t.prototype.emitHeader=function(t){switch(t.data.writeUnsignedByte(160),t.data.writeUnsignedInt(t.version),t.version>=16&&t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(161),t.name){case"fragment":t.data.writeUnsignedByte(1);break;case"vertex":t.data.writeUnsignedByte(0);break;case"cpu":t.data.writeUnsignedByte(2);break;default:t.data.writeUnsignedByte(255)}},t.prototype.emitOpcode=function(t,e){t.data.writeUnsignedInt(e)},t.prototype.emitZeroDword=function(t){t.data.writeUnsignedInt(0)},t.prototype.emitZeroQword=function(t){t.data.writeUnsignedInt(0),t.data.writeUnsignedInt(0)},t.prototype.emitDest=function(t,e,i){var r=e.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i);if(!RegMap.map[r[1]])return!1;var n={num:r[2]?r[2]:0,code:RegMap.map[r[1]].code,mask:this.stringToMask(r[3])};return t.data.writeUnsignedShort(n.num),t.data.writeUnsignedByte(n.mask),t.data.writeUnsignedByte(n.code),!0},t.prototype.stringToMask=function(t){if(!t)return 15;var e=0;return-1!=t.indexOf("x")&&(e|=1),-1!=t.indexOf("y")&&(e|=2),-1!=t.indexOf("z")&&(e|=4),-1!=t.indexOf("w")&&(e|=8),e},t.prototype.stringToSwizzle=function(t){if(!t)return 228;var e={x:0,y:1,z:2,w:3},i=0;if("."!=t.charAt(0))throw"Missing . for swizzle";return t.length>1&&(i|=e[t.charAt(1)]),t.length>2?i|=e[t.charAt(2)]<<2:i|=(3&i)<<2,t.length>3?i|=e[t.charAt(3)]<<4:i|=(12&i)<<2,t.length>4?i|=e[t.charAt(4)]<<6:i|=(48&i)<<2,i},t.prototype.emitSampler=function(t,e,i,r){var n=e.match(/fs(\d*)/i);if(!n||!n[1])return!1;t.data.writeUnsignedShort(parseInt(n[1])),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(0);for(var o=5,s=0,a=0;a<r.length;a++){var l=SamplerMap.map[r[a].toLowerCase()];l?(0!=(s>>l.shift&l.mask)&&console.log("Warning, duplicate sampler option"),s|=l.mask<<l.shift,o&=~(l.mask<<l.shift),o|=l.value<<l.shift):console.log("Warning, unknown sampler option: ",r[a])}return t.data.writeUnsignedInt(o),!0},t.prototype.emitSource=function(t,e,i){var r,n=e.match(/vc\[(v[tcai])(\d+)\.([xyzw])([\+\-]\d+)?\](\.[xyzw]{1,4})?/i);if(n){if(!RegMap.map[n[1]])return!1;var o={num:0|n[2],code:RegMap.map[n[1]].code,swizzle:this.stringToSwizzle(n[5]),select:{x:0,y:1,z:2,w:3}[n[3]],offset:0|n[4]};t.data.writeUnsignedShort(o.num),t.data.writeByte(o.offset),t.data.writeUnsignedByte(o.swizzle),t.data.writeUnsignedByte(1),t.data.writeUnsignedByte(o.code),t.data.writeUnsignedByte(o.select),t.data.writeUnsignedByte(128)}else{if(r=e.match(/([fov]?[tpocidavs])(\d*)(\.[xyzw]{1,4})?/i),!RegMap.map[r[1]])return!1;o={num:0|r[2],code:RegMap.map[r[1]].code,swizzle:this.stringToSwizzle(r[3])};t.data.writeUnsignedShort(o.num),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(o.swizzle),t.data.writeUnsignedByte(o.code),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(0),t.data.writeUnsignedByte(0)}return!0},t.prototype.addHeader=function(t,e){if(e||(e=1),null==this.r[t])this.r[t]=new Part(t,e),this.emitHeader(this.r[t]);else if(this.r[t].version!=e)throw"Multiple versions for part "+t;this.cur=this.r[t]},t}(),Header=function(){this.progid=0,this.version=0,this.type=""},Description=function(){this.regread=[[],[],[],[],[],[],[]],this.regwrite=[[],[],[],[],[],[],[]],this.hasindirect=!1,this.writedepth=!1,this.hasmatrix=!1,this.samplers=[],this.tokens=[],this.header=new Header},OpLUT=function(t,e,i,r,n,o,s,a,l,h,c){this.s=t,this.flags=e,this.dest=i,this.a=r,this.b=n,this.matrixwidth=o,this.matrixheight=s,this.ndwm=a,this.scalar=l,this.dm=h,this.lod=c},Mapping=function(){function t(t){}return t.agal2glsllut=[new OpLUT("%dest = %cast(%a);\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(%a + %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(%a - %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(%a * %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(%a / %b);\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(1.0) / %a;\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(min(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(max(%a,%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(fract(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(sqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(inversesqrt(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(pow(abs(%a),%b));\n",0,!0,!0,!0,null,null,null,null,null,null),new OpLUT("%dest = %cast(log2(abs(%a)));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(exp2(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(normalize(vec3( %a ) ));\n",0,!0,!0,!1,null,null,!0,null,null,null),new OpLUT("%dest = %cast(sin(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(cos(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(cross(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",0,!0,!0,!0,null,null,!0,null,null,null),new OpLUT("%dest = %cast(abs(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(%a * -1.0);\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(clamp(%a,0.0,1.0));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(dot(vec3(%a),vec3(%b)));\n",null,!0,!0,!0,3,3,!0,null,null,null),new OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,4,!0,null,null,null),new OpLUT("%dest = %cast(dot(vec4(%a),vec4(%b)));\n",null,!0,!0,!0,4,3,!0,null,null,null),new OpLUT("%dest = %cast(dFdx(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(dFdy(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("if (float(%a)==float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new OpLUT("if (float(%a)!=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new OpLUT("if (float(%a)>=float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new OpLUT("if (float(%a)<float(%b)) {;\n",0,!1,!0,!0,null,null,null,!0,null,null),new OpLUT("} else {;\n",0,!1,!1,!1,null,null,null,null,null,null),new OpLUT("};\n",0,!1,!1,!1,null,null,null,null,null,null),new OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new OpLUT(null,null,null,null,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(texture%texdimLod(%b,%texsize(%a)).%dm);\n",null,!0,!0,!0,null,null,null,null,!0,null),new OpLUT("if ( float(%a)<0.0 ) discard;\n",null,!1,!0,!1,null,null,null,!0,null,null),new OpLUT("%dest = %cast(texture%texdim(%b,%texsize(%a)%lod).%dm);\n",null,!0,!0,!0,null,null,!0,null,!0,!0),new OpLUT("%dest = %cast(greaterThanEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new OpLUT("%dest = %cast(lessThan(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new OpLUT("%dest = %cast(sign(%a));\n",0,!0,!0,!1,null,null,null,null,null,null),new OpLUT("%dest = %cast(equal(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null),new OpLUT("%dest = %cast(notEqual(%a,%b).%dm);\n",0,!0,!0,!0,null,null,!0,null,!0,null)],t}(),Destination=function(){this.mask=0,this.regnum=0,this.regtype=0,this.dim=0,this.indexoffset=0,this.swizzle=0,this.lodbiad=0,this.readmode=0,this.special=0,this.wrap=0,this.filter=0,this.indexregtype=0,this.indexselect=0,this.indirectflag=0},Token=function(){this.dest=new Destination,this.opcode=0,this.a=new Destination,this.b=new Destination},AGALTokenizer=function(){function t(){}return t.prototype.decribeAGALByteArray=function(t){var e=new Header;if(160!=t.readUnsignedByte())throw"Bad AGAL: Missing 0xa0 magic byte.";if(e.version=t.readUnsignedInt(),e.version>=16&&(t.readUnsignedByte(),e.version>>=1),161!=t.readUnsignedByte())throw"Bad AGAL: Missing 0xa1 magic byte.";switch(e.progid=t.readUnsignedByte(),e.progid){case 1:e.type="fragment";break;case 0:e.type="vertex";break;case 2:e.type="cpu";break;default:e.type=""}for(var i=new Description,r=[];t.position<t.length;){var n=new Token;n.opcode=t.readUnsignedInt();var o=Mapping.agal2glsllut[n.opcode];if(!o)throw"Opcode not valid or not implemented yet: "+n.opcode;o.matrixheight&&(i.hasmatrix=!0),o.dest?(n.dest.regnum=t.readUnsignedShort(),n.dest.mask=t.readUnsignedByte(),n.dest.regtype=t.readUnsignedByte(),i.regwrite[n.dest.regtype][n.dest.regnum]|=n.dest.mask):(n.dest=null,t.readUnsignedInt()),o.a?this.readReg(n.a,1,i,t):(n.a=null,t.readUnsignedInt(),t.readUnsignedInt()),o.b?this.readReg(n.b,0|o.matrixheight,i,t):(n.b=null,t.readUnsignedInt(),t.readUnsignedInt()),r.push(n)}return i.header=e,i.tokens=r,i},t.prototype.readReg=function(t,e,i,r){if(t.regnum=r.readUnsignedShort(),t.indexoffset=r.readByte(),t.swizzle=r.readUnsignedByte(),t.regtype=r.readUnsignedByte(),i.regread[t.regtype][t.regnum]=15,5==t.regtype?(t.lodbiad=t.indexoffset,t.indexoffset=void 0,t.swizzle=void 0,t.readmode=r.readUnsignedByte(),t.dim=t.readmode>>4,t.readmode&=15,t.special=r.readUnsignedByte(),t.wrap=t.special>>4,t.special&=15,t.mipmap=r.readUnsignedByte(),t.filter=t.mipmap>>4,t.mipmap&=15,i.samplers[t.regnum]=t):(t.indexregtype=r.readUnsignedByte(),t.indexselect=r.readUnsignedByte(),t.indirectflag=r.readUnsignedByte()),t.indirectflag&&(i.hasindirect=!0),!t.indirectflag&&e)for(var n=0;n<e;n++)i.regread[t.regtype][t.regnum+n]=i.regread[t.regtype][t.regnum]},t}(),AGLSLParser=function(){function t(){}return t.prototype.parse=function(t,e){var i="",r="";i+="precision "+e+" float;\n";var n=t.header.type[0];"vertex"==t.header.type&&(i+="uniform float yflip;\n");var o=t.regread[1].length;o>0&&(i+="uniform vec4 "+n+"c["+o+"];\n");for(var s=0;s<t.regread[2].length||s<t.regwrite[2].length;s++)(t.regread[2][s]||t.regwrite[2][s])&&(i+="vec4 "+n+"t"+s+";\n");for(s=0;s<t.regread[0].length;s++)t.regread[0][s]&&(i+="attribute vec4 va"+s+";\n");for(s=0;s<t.regread[4].length||s<t.regwrite[4].length;s++)(t.regread[4][s]||t.regwrite[4][s])&&(i+="varying vec4 vi"+s+";\n");var a=["2D","Cube","3D",""];for(s=0;s<t.samplers.length;s++)t.samplers[s]&&(i+="uniform sampler"+a[3&t.samplers[s].dim]+" fs"+s+";\n");"vertex"==t.header.type&&(i+="vec4 outpos;\n"),t.writedepth&&(i+="vec4 tmp_FragDepth;\n");var l=!1;r+="void main() {\n";for(s=0;s<t.tokens.length;s++){var h=Mapping.agal2glsllut[t.tokens[s].opcode];if(-1==h.s.indexOf("dFdx")&&-1==h.s.indexOf("dFdy")||(l=!0),!h)throw"Opcode not valid or not implemented yet: ";for(var c=h.matrixheight||1,u=0;u<c;u++){var p="  "+h.s;if(t.tokens[s].dest){if(h.matrixheight){if(1!=(t.tokens[s].dest.mask>>u&1))continue;var d=this.regtostring(t.tokens[s].dest.regtype,t.tokens[s].dest.regnum,t,n),f="float";d+="."+(_=["x","y","z","w"][u])}else{var _;d=this.regtostring(t.tokens[s].dest.regtype,t.tokens[s].dest.regnum,t,n);if(15!=t.tokens[s].dest.mask){var g=0;switch(_="",1&t.tokens[s].dest.mask&&(g++,_+="x"),2&t.tokens[s].dest.mask&&(g++,_+="y"),4&t.tokens[s].dest.mask&&(g++,_+="z"),8&t.tokens[s].dest.mask&&(g++,_+="w"),d+="."+_,g){case 1:f="float";break;case 2:f="vec2";break;case 3:f="vec3";break;default:throw"Unexpected destination mask"}}else f="vec4",_="xyzw"}p=(p=(p=p.replace("%dest",d)).replace("%cast",f)).replace("%dm",_)}var m=15;if(!h.ndwm&&h.dest&&t.tokens[s].dest&&(m=t.tokens[s].dest.mask),t.tokens[s].a&&(p=p.replace("%a",this.sourcetostring(t.tokens[s].a,0,m,h.scalar,t,n))),t.tokens[s].b&&(p=p.replace("%b",this.sourcetostring(t.tokens[s].b,u,m,h.scalar,t,n)),5==t.tokens[s].b.regtype)){var y=["2D","Cube","3D"][t.tokens[s].b.dim],v=["vec2","vec3","vec3"][t.tokens[s].b.dim];p=(p=(p=p.replace("%texdim",y)).replace("%texsize",v)).replace("%lod","")}r+=p}}return"vertex"==t.header.type&&(r+="  gl_Position = vec4(outpos.x, outpos.y, outpos.z*2.0 - outpos.w, outpos.w);\n"),l&&"fragment"==t.header.type&&(i="#extension GL_OES_standard_derivatives : enable\n"+i),t.writedepth&&(r+="  gl_FragDepth = clamp(tmp_FragDepth,0.0,1.0);\n"),i+(r+="}\n")},t.prototype.regtostring=function(t,e,i,r){switch(t){case 0:return"va"+e;case 1:return i.header.type[0]+"c["+e+"]";case 2:return r+"t"+e;case 3:return"vertex"==i.header.type?"outpos":"gl_FragColor";case 4:return"vi"+e;case 5:return"fs"+e;case 6:return"tmp_FragDepth";default:throw"Unknown register type"}},t.prototype.sourcetostring=function(t,e,i,r,n,o){var s,a=["x","y","z","w"];if(t.indirectflag){s="vcarrr[int("+this.regtostring(t.indexregtype,t.regnum,n,o)+"."+a[t.indexselect]+")";var l=e+t.indexoffset;l<0&&(s+=l.toString()),l>0&&(s+="+"+l.toString()),s+="]"}else s=this.regtostring(t.regtype,t.regnum+e,n,o);return 5==t.regtype?s:r?s+"."+a[t.swizzle>>0&3]:228==t.swizzle&&15==i?s:(s+=".",1&i&&(s+=a[t.swizzle>>0&3]),2&i&&(s+=a[t.swizzle>>2&3]),4&i&&(s+=a[t.swizzle>>4&3]),8&i&&(s+=a[t.swizzle>>6&3]),s)},t.maxvertexconstants=128,t.maxfragconstants=28,t.maxtemp=8,t.maxstreams=8,t.maxtextures=8,t}(),ContextGLBlendFactor,ContextGLClearMask,ContextGLCompareMode,ContextGLDrawMode,ContextGLMipFilter,ContextGLProfile,ContextGLProgramType,ContextGLStencilAction,ContextGLTextureFilter,ContextGLTextureFormat,ContextGLTriangleFace,ContextGLVertexBufferFormat,ContextGLWrapMode,ContextMode;!function(t){t[t.DESTINATION_ALPHA=0]="DESTINATION_ALPHA",t[t.DESTINATION_COLOR=1]="DESTINATION_COLOR",t[t.ONE=2]="ONE",t[t.ONE_MINUS_DESTINATION_ALPHA=3]="ONE_MINUS_DESTINATION_ALPHA",t[t.ONE_MINUS_DESTINATION_COLOR=4]="ONE_MINUS_DESTINATION_COLOR",t[t.ONE_MINUS_SOURCE_ALPHA=5]="ONE_MINUS_SOURCE_ALPHA",t[t.ONE_MINUS_SOURCE_COLOR=6]="ONE_MINUS_SOURCE_COLOR",t[t.SOURCE_ALPHA=7]="SOURCE_ALPHA",t[t.SOURCE_COLOR=8]="SOURCE_COLOR",t[t.ZERO=9]="ZERO"}(ContextGLBlendFactor||(ContextGLBlendFactor={})),function(t){t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.ALL=7]="ALL"}(ContextGLClearMask||(ContextGLClearMask={})),function(t){t[t.ALWAYS=0]="ALWAYS",t[t.EQUAL=1]="EQUAL",t[t.GREATER=2]="GREATER",t[t.GREATER_EQUAL=3]="GREATER_EQUAL",t[t.LESS=4]="LESS",t[t.LESS_EQUAL=5]="LESS_EQUAL",t[t.NEVER=6]="NEVER",t[t.NOT_EQUAL=7]="NOT_EQUAL"}(ContextGLCompareMode||(ContextGLCompareMode={})),function(t){t[t.TRIANGLES=0]="TRIANGLES",t[t.LINES=1]="LINES"}(ContextGLDrawMode||(ContextGLDrawMode={})),function(t){t[t.MIPLINEAR=0]="MIPLINEAR",t[t.MIPNEAREST=1]="MIPNEAREST",t[t.MIPNONE=2]="MIPNONE"}(ContextGLMipFilter||(ContextGLMipFilter={})),function(t){t[t.BASELINE=0]="BASELINE",t[t.BASELINE_CONSTRAINED=1]="BASELINE_CONSTRAINED",t[t.BASELINE_EXTENDED=2]="BASELINE_EXTENDED"}(ContextGLProfile||(ContextGLProfile={})),function(t){t[t.FRAGMENT=0]="FRAGMENT",t[t.SAMPLER=1]="SAMPLER",t[t.VERTEX=2]="VERTEX"}(ContextGLProgramType||(ContextGLProgramType={})),function(t){t[t.DECREMENT_SATURATE=0]="DECREMENT_SATURATE",t[t.DECREMENT_WRAP=1]="DECREMENT_WRAP",t[t.INCREMENT_SATURATE=2]="INCREMENT_SATURATE",t[t.INCREMENT_WRAP=3]="INCREMENT_WRAP",t[t.INVERT=4]="INVERT",t[t.KEEP=5]="KEEP",t[t.SET=6]="SET",t[t.ZERO=7]="ZERO"}(ContextGLStencilAction||(ContextGLStencilAction={})),function(t){t[t.LINEAR=0]="LINEAR",t[t.NEAREST=1]="NEAREST"}(ContextGLTextureFilter||(ContextGLTextureFilter={})),function(t){t[t.BGRA=0]="BGRA",t[t.BGRA_PACKED=1]="BGRA_PACKED",t[t.BGR_PACKED=2]="BGR_PACKED",t[t.COMPRESSED=3]="COMPRESSED",t[t.COMPRESSED_ALPHA=4]="COMPRESSED_ALPHA"}(ContextGLTextureFormat||(ContextGLTextureFormat={})),function(t){t[t.BACK=0]="BACK",t[t.FRONT=1]="FRONT",t[t.FRONT_AND_BACK=2]="FRONT_AND_BACK",t[t.NONE=3]="NONE"}(ContextGLTriangleFace||(ContextGLTriangleFace={})),function(t){t[t.FLOAT_1=0]="FLOAT_1",t[t.FLOAT_2=1]="FLOAT_2",t[t.FLOAT_3=2]="FLOAT_3",t[t.FLOAT_4=3]="FLOAT_4",t[t.BYTE_1=4]="BYTE_1",t[t.BYTE_2=5]="BYTE_2",t[t.BYTE_3=6]="BYTE_3",t[t.BYTE_4=7]="BYTE_4",t[t.UNSIGNED_BYTE_1=8]="UNSIGNED_BYTE_1",t[t.UNSIGNED_BYTE_2=9]="UNSIGNED_BYTE_2",t[t.UNSIGNED_BYTE_3=10]="UNSIGNED_BYTE_3",t[t.UNSIGNED_BYTE_4=11]="UNSIGNED_BYTE_4",t[t.SHORT_1=12]="SHORT_1",t[t.SHORT_2=13]="SHORT_2",t[t.SHORT_3=14]="SHORT_3",t[t.SHORT_4=15]="SHORT_4",t[t.UNSIGNED_SHORT_1=16]="UNSIGNED_SHORT_1",t[t.UNSIGNED_SHORT_2=17]="UNSIGNED_SHORT_2",t[t.UNSIGNED_SHORT_3=18]="UNSIGNED_SHORT_3",t[t.UNSIGNED_SHORT_4=19]="UNSIGNED_SHORT_4"}(ContextGLVertexBufferFormat||(ContextGLVertexBufferFormat={})),function(t){t[t.CLAMP=0]="CLAMP",t[t.REPEAT=1]="REPEAT"}(ContextGLWrapMode||(ContextGLWrapMode={})),function(t){t[t.AUTO=0]="AUTO",t[t.WEBGL=1]="WEBGL",t[t.FLASH=2]="FLASH",t[t.GLES=3]="GLES",t[t.NATIVE=4]="NATIVE",t[t.SOFTWARE=5]="SOFTWARE"}(ContextMode||(ContextMode={}));var SamplerState=function(){},ImageEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._image=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),e.INVALIDATE_MIPMAPS="invalidateMipmaps",e}(EventBase),StageEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._stage=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._stage)},e.STAGE_ERROR="stageError",e.CONTEXT_CREATED="contextCreated",e.CONTEXT_DISPOSED="contextDisposed",e.CONTEXT_RECREATED="contextRecreated",e.INVALIDATE_SIZE="invalidateSize",e}(EventBase),RTTEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._rttManager=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"rttManager",{get:function(){return this._rttManager},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._rttManager)},e.RESIZE="rttManagerResize",e}(EventBase),ImageBase=function(t){function e(){var e=t.call(this)||this;return e._pFormat="bgra",e}return __extends(e,t),Object.defineProperty(e.prototype,"format",{get:function(){return this._pFormat},enumerable:!0,configurable:!0}),e.prototype.invalidateMipmaps=function(){this.dispatchEvent(new ImageEvent(ImageEvent.INVALIDATE_MIPMAPS,this))},e}(AssetBase),_Stage_ImageBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.usages=0,r._invalidMipmaps=!0,r._invalidMapper=!0,r._stage=i,r._onInvalidateMipmapsDelegate=function(t){return r._onInvalidateMipmaps(t)},r._asset.addEventListener(ImageEvent.INVALIDATE_MIPMAPS,r._onInvalidateMipmapsDelegate),r}return __extends(e,t),e.prototype.getTexture=function(){return this._texture||(this._createTexture(),this._invalid=!0),this._texture},e.prototype.getType=function(){throw new AbstractMethodError},e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._texture&&(this._texture.dispose(),this._texture=null)},e.prototype.activate=function(t,e){void 0===e&&(e=null),e||(e=ImageUtils.getDefaultSampler());var i=!(!e.mipmap||this._stage.globalDisableMipmap)&&e.mipmap;this._stage.setSamplerAt(t,e),this._stage.context.setTextureAt(t,this.getTexture()),!this._mipmap&&i&&(this._mipmap=!0,this._invalidMipmaps=!0),this._invalidMipmaps&&(this._invalidMipmaps=!1,i&&this._texture.generateMipmaps())},e.prototype._createTexture=function(){throw new AbstractMethodError},e.prototype._onInvalidateMipmaps=function(t){this._invalidMipmaps=!0},e}(AbstractionBase),OpCodes=function(){function t(){}return t.trueValue=32,t.falseValue=33,t.intMask=63,t.drawTriangles=41,t.setProgramConstant=42,t.setProgram=43,t.present=44,t.clear=45,t.initProgram=46,t.initVertexBuffer=47,t.initIndexBuffer=48,t.configureBackBuffer=49,t.uploadArrayIndexBuffer=50,t.uploadArrayVertexBuffer=51,t.uploadAGALBytesProgram=52,t.setVertexBufferAt=53,t.uploadBytesIndexBuffer=54,t.uploadBytesVertexBuffer=55,t.setColorMask=56,t.setDepthTest=57,t.disposeProgram=58,t.disposeContext=59,t.disposeVertexBuffer=61,t.disposeIndexBuffer=63,t.initTexture=64,t.setTextureAt=65,t.uploadBytesTexture=66,t.disposeTexture=67,t.setCulling=68,t.setScissorRect=69,t.clearScissorRect=70,t.setBlendFactors=71,t.setRenderToTexture=72,t.clearTextureAt=73,t.clearVertexBufferAt=74,t.setStencilActions=75,t.setStencilReferenceValue=76,t.initCubeTexture=77,t.disposeCubeTexture=78,t.uploadBytesCubeTexture=79,t.clearRenderToTexture=80,t.enableErrorChecking=81,t.drawVertices=82,t.getFrameBufferForTexture=83,t.uploadProgram=84,t.disableCulling=85,t.disableBlending=86,t.setSamplerStateAt=87,t.enableStencil=88,t.disableStencil=89,t.setStencilActionsMasks=90,t.uploadTextureFromURL=92,t.startSound=101,t.stopSound=102,t.updateSound=103,t}(),GLESAssetBase=function(){function t(t,e){this._context=t,this._id=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t}(),TextureBaseGLES=function(t){function e(e,i,r){var n=t.call(this,e,r)||this;return n.textureType="",n}return __extends(e,t),e.prototype.dispose=function(){this._context._createBytes.writeInt(OpCodes.disposeTexture),this._context._createBytes.writeInt(this.id)},Object.defineProperty(e.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:!0,configurable:!0}),e.prototype.generateMipmaps=function(){},e}(GLESAssetBase),CubeTextureGLES=function(t){function e(e,i,r,n){var o=t.call(this,e,i,n)||this;return o._textureSelectorDictionary=new Array(6),o.textureType="textureCube",o._size=r,o}return __extends(e,t),e.prototype.uploadFromArray=function(t,e,i){if(t.length!=this._size*this._size*4)throw new Error("Array is not the correct length for texture dimensions");t instanceof Array&&(t=new Uint8Array(t))},e.prototype.uploadCompressedTextureFromArray=function(t,e,i){},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e}(TextureBaseGLES),IndexBufferGLES=function(t){function e(e,i,r,n){var o=t.call(this,e,n)||this;return o._gl=i,o._numIndices=r,o}return __extends(e,t),e.prototype.uploadFromArray=function(t,e,i){},e.prototype.uploadFromByteArray=function(t,e,i){},e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),e}(GLESAssetBase),GLESConnector=function(){function t(){}return Object.defineProperty(t,"gles",{get:function(){if(!t._gles)throw"Error: Set GlesConnector.gles before calling methods on ContextGLES!";return t._gles},set:function(e){t._gles=e},enumerable:!0,configurable:!0}),t._gles=null,t}(),ProgramGLES=function(t){function e(e,i,r){var n=t.call(this,e,r)||this;return n._uniforms=[[],[],[]],n._attribs=[],n}return __extends(e,t),e.prototype.upload=function(t,i){var r=0!=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT).precision?"highp":"mediump",n=0!=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT).precision?"highp":"mediump",o=e._aglslParser.parse(e._tokenizer.decribeAGALByteArray(t),r),s=e._aglslParser.parse(e._tokenizer.decribeAGALByteArray(i),n),a=new Byte32Array;a.writeInt(1),a.writeInt(OpCodes.uploadProgram),a.writeInt(this.id),a.writeUTFBytes(o),a.writeUTFBytes(s),a.bytePosition=0;var l=new Int32Array(a.byteLength/4);a.readInt32Array(l),GLESConnector.gles.sendGLESCommands(l.buffer)},e.prototype.getUniformLocation=function(t,e){return null},e.prototype.getAttribLocation=function(t){return 0},e.prototype.dispose=function(){this._context._createBytes.writeInt(OpCodes.disposeProgram),this._context._createBytes.writeInt(this.id)},e.prototype.focusProgram=function(){},Object.defineProperty(e.prototype,"glProgram",{get:function(){return this._program},enumerable:!0,configurable:!0}),e._tokenizer=new AGALTokenizer,e._aglslParser=new AGLSLParser,e._uniformLocationNameDictionary=["fc","fs","vc"],e}(GLESAssetBase),TextureGLES=function(t){function e(e,i,r,n,o){var s=t.call(this,e,i,o)||this;return s.textureType="texture2d",s._width=r,s._height=n,s}return __extends(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameBuffer",{get:function(){return this._frameBuffer},enumerable:!0,configurable:!0}),e.prototype.uploadFromArray=function(t,e){if(void 0===e&&(e=0),t.length!=this._width*this._height*4)throw new Error("Array is not the correct length for texture dimensions");t instanceof Array&&(t=new Uint8Array(t));var i=new Byte32Array;i.writeInt(1),i.writeInt(OpCodes.uploadBytesTexture|e<<8),i.writeInt(this.id),i.writeFloat(this._width),i.writeFloat(this._height),i.writeInt(t.buffer.byteLength),i.writeInt32Array(new Int32Array(t.buffer)),i.bytePosition=0;var r=new Int32Array(i.byteLength/4);i.readInt32Array(r),GLESConnector.gles.sendGLESCommands(r.buffer)},e.prototype.uploadFromURL=function(t,e){void 0===e&&(e=0);var i=new Byte32Array;i.writeInt(1),i.writeInt(OpCodes.uploadTextureFromURL|e<<8),i.writeInt(this.id);var r=t.url.replace(/[^a-zA-Z0-9]/g,"");console.log("urlRequest.url "+r),i.writeUTFBytes(r),i.bytePosition=0;var n=new Int32Array(i.byteLength/4);i.readInt32Array(n),GLESConnector.gles.sendGLESCommands(n.buffer)},e.prototype.uploadCompressedTextureFromArray=function(t,e,i){},e}(TextureBaseGLES),VertexBufferGLES=function(t){function e(e,i,r,n,o){var s=t.call(this,e,o)||this;return s._numVertices=r,s._dataPerVertex=n,s}return __extends(e,t),e.prototype.uploadFromArray=function(t,e,i){},e.prototype.uploadFromByteArray=function(t,e,i){var r=new Byte32Array;r.writeInt(1),r.writeInt(OpCodes.uploadArrayVertexBuffer),r.writeInt(this.id),r.writeInt(e),r.writeInt(t.byteLength),r.writeInt32Array(new Int32Array(t)),r.bytePosition=0;var n=new Int32Array(r.byteLength/4);r.readInt32Array(n),GLESConnector.gles.sendGLESCommands(n.buffer)},Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._context._createBytes.writeInt(OpCodes.disposeVertexBuffer),this._context._createBytes.writeInt(this.id)},e}(GLESAssetBase),ContextGLES=function(){function t(e){this._blendFactorDictionary=new Object,this._drawModeDictionary=new Object,this._compareModeDictionary=new Object,this.stencilTriangleFace=new Object,this._stencilActionDictionary=new Object,this._textureIndexDictionary=new Array(8),this._textureTypeDictionary=new Object,this._wrapDictionary=new Object,this._filterDictionary=new Object,this._mipmapFilterDictionary=new Object,this._vertexBufferPropertiesDictionary=[],this._samplerStates=new Array(8),this._stencilReferenceValue=0,this._stencilReadMask=255,this._separateStencil=!1,this._textureCnt=0,this._programCnt=0,this._cubeTextureCnt=0,this._indexBufferCnt=0,this._vertexBufferCnt=0,this._container=e,this._cmdBytes=new Byte32Array,this._createBytes=new Byte32Array,t._soundBytes=new Byte32Array,t._soundBytes.writeUnsignedInt(100),this._cmdBytes.writeUnsignedInt(0),this._createBytes.writeUnsignedInt(1),this._blendFactorDictionary[ContextGLBlendFactor.ONE]=0,this._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_ALPHA]=1,this._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_COLOR]=2,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=3,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=4,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=5,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=6,this._blendFactorDictionary[ContextGLBlendFactor.SOURCE_ALPHA]=7,this._blendFactorDictionary[ContextGLBlendFactor.SOURCE_COLOR]=8,this._blendFactorDictionary[ContextGLBlendFactor.ZERO]=9,this._drawModeDictionary[ContextGLDrawMode.LINES]=0,this._drawModeDictionary[ContextGLDrawMode.TRIANGLES]=1,this._compareModeDictionary[ContextGLCompareMode.ALWAYS]=0,this._compareModeDictionary[ContextGLCompareMode.EQUAL]=1,this._compareModeDictionary[ContextGLCompareMode.GREATER]=2,this._compareModeDictionary[ContextGLCompareMode.GREATER_EQUAL]=3,this._compareModeDictionary[ContextGLCompareMode.LESS]=4,this._compareModeDictionary[ContextGLCompareMode.LESS_EQUAL]=5,this._compareModeDictionary[ContextGLCompareMode.NEVER]=6,this._compareModeDictionary[ContextGLCompareMode.NOT_EQUAL]=7,this.stencilTriangleFace[ContextGLTriangleFace.BACK]=2,this.stencilTriangleFace[ContextGLTriangleFace.FRONT]=1,this.stencilTriangleFace[ContextGLTriangleFace.FRONT_AND_BACK]=0,this._stencilActionDictionary[ContextGLStencilAction.DECREMENT_SATURATE]=0,this._stencilActionDictionary[ContextGLStencilAction.DECREMENT_WRAP]=1,this._stencilActionDictionary[ContextGLStencilAction.INCREMENT_SATURATE]=2,this._stencilActionDictionary[ContextGLStencilAction.INCREMENT_WRAP]=3,this._stencilActionDictionary[ContextGLStencilAction.INVERT]=4,this._stencilActionDictionary[ContextGLStencilAction.KEEP]=5,this._stencilActionDictionary[ContextGLStencilAction.SET]=6,this._stencilActionDictionary[ContextGLStencilAction.ZERO]=7,this._textureTypeDictionary.texture2d=0,this._textureTypeDictionary.textureCube=1,this._wrapDictionary[ContextGLWrapMode.REPEAT]=0,this._wrapDictionary[ContextGLWrapMode.CLAMP]=1,this._filterDictionary[ContextGLTextureFilter.LINEAR]=0,this._filterDictionary[ContextGLTextureFilter.NEAREST]=1,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR]=new Object,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNEAREST]=2,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPLINEAR]=3,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNONE]=0,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST]=new Object,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNEAREST]=4,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPLINEAR]=5,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNONE]=1}return t.startSound=function(e,i,r,n){t._soundBytes.writeInt(OpCodes.startSound|(n?1:0)<<8),t._soundBytes.writeFloat(r),t._soundBytes.writeInt(i),t._soundBytes.writeUTFBytes(e)},t.stopSound=function(e){t._soundBytes.writeInt(OpCodes.stopSound),t._soundBytes.writeInt(e)},t.updateSound=function(e,i,r){t._soundBytes.writeInt(OpCodes.updateSound|(r?1:0)<<8),t._soundBytes.writeFloat(i),t._soundBytes.writeInt(e)},Object.defineProperty(t.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDerivatives",{get:function(){return this._standardDerivatives},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glVersion",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return 1},enumerable:!0,configurable:!0}),t.prototype.enableStencil=function(){this._cmdBytes.writeInt(OpCodes.enableStencil)},t.prototype.disableStencil=function(){this._cmdBytes.writeInt(OpCodes.disableStencil)},t.prototype.gl=function(){return this._gl},t.prototype.clear=function(t,e,i,r,n,o,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=ContextGLClearMask.ALL),this._cmdBytes.writeInt(OpCodes.clear),this._cmdBytes.writeFloat(t),this._cmdBytes.writeFloat(e),this._cmdBytes.writeFloat(i),this._cmdBytes.writeFloat(r),this._cmdBytes.writeInt(n),this._cmdBytes.writeInt(o),this._cmdBytes.writeInt(s)},t.prototype.configureBackBuffer=function(t,e,i,r){void 0===r&&(r=!0),this._width=t,this._height=e,this._cmdBytes.writeInt(OpCodes.configureBackBuffer|(r?1:0)<<8),this._cmdBytes.writeFloat(t),this._cmdBytes.writeFloat(e)},t.prototype.createCubeTexture=function(t,e,i,r){return new CubeTextureGLES(this,this._gl,t,this._cubeTextureCnt++)},t.prototype.createIndexBuffer=function(t){return new IndexBufferGLES(this,this._gl,t,this._indexBufferCnt++)},t.prototype.createProgram=function(){return new ProgramGLES(this,this._gl,this._programCnt++)},t.prototype.createTexture=function(t,e,i,r,n){return new TextureGLES(this,this._gl,t,e,this._textureCnt++)},t.prototype.createVertexBuffer=function(t,e){return new VertexBufferGLES(this,this._gl,t,e,this._vertexBufferCnt++)},t.prototype.dispose=function(){this._cmdBytes.writeInt(OpCodes.disposeContext),this.execute()},t.prototype.drawToBitmapImage2D=function(t){},t.prototype.drawIndices=function(t,e,i,r){},t.prototype.drawVertices=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._cmdBytes.writeInt(OpCodes.drawVertices|this._drawModeDictionary[t]<<8),this._cmdBytes.writeInt(e),this._cmdBytes.writeInt(i)},t.prototype.present=function(){this.execute()},t.prototype.setBlendFactors=function(t,e){this._blendEnabled=!0,this._blendSourceFactor=this._blendFactorDictionary[t],this._blendDestinationFactor=this._blendFactorDictionary[e],this.updateBlendStatus()},t.prototype.setColorMask=function(t,e,i,r){this._cmdBytes.writeInt(OpCodes.setColorMask),this._cmdBytes.writeInt((t?1:0)|(e?1:0)<<8|(i?1:0)<<16|(r?1:0)<<24)},t.prototype.setCulling=function(t,e){if(void 0===e&&(e=CoordinateSystem.LEFT_HANDED),t!=ContextGLTriangleFace.NONE){var i=this.translateTriangleFace(t,e);this._cmdBytes.writeInt(OpCodes.setCulling|i<<8)}else this._cmdBytes.writeInt(OpCodes.disableCulling)},t.prototype.setDepthTest=function(t,e){this._cmdBytes.writeInt(OpCodes.setDepthTest|(t?1:0)<<8|this._compareModeDictionary[e]<<16)},t.prototype.setStencilActionsMasks=function(t,e,i,r,n,o,s){void 0===r&&(r="keep"),void 0===n&&(n="keep"),void 0===o&&(o="keep");var a=this._compareModeDictionary[t],l=this._stencilActionDictionary[o],h=this._stencilActionDictionary[n],c=this._stencilActionDictionary[r];this._cmdBytes.writeInt(OpCodes.setStencilActionsMasks|a<<8),this._cmdBytes.writeInt(e),this._cmdBytes.writeInt(i|l<<8|h<<16|c<<24)},t.prototype.setStencilActions=function(t,e,i,r,n,o){void 0===t&&(t=ContextGLTriangleFace.FRONT_AND_BACK),void 0===e&&(e=ContextGLCompareMode.ALWAYS),void 0===i&&(i=ContextGLStencilAction.KEEP),void 0===r&&(r=ContextGLStencilAction.KEEP),void 0===n&&(n=ContextGLStencilAction.KEEP),void 0===o&&(o=CoordinateSystem.LEFT_HANDED);var s=this._compareModeDictionary[e],a=this.stencilTriangleFace[t],l=this._stencilActionDictionary[n],h=this._stencilActionDictionary[r],c=this._stencilActionDictionary[i];this._cmdBytes.writeInt(OpCodes.setStencilActions|a<<8),this._cmdBytes.writeInt(s|l<<8|h<<16|c<<24)},t.prototype.setStencilReferenceValue=function(t,e,i){void 0===e&&(e=255),void 0===i&&(i=255),this._cmdBytes.writeInt(OpCodes.setStencilReferenceValue),this._cmdBytes.writeInt(t),this._cmdBytes.writeInt(e),this._cmdBytes.writeInt(i)},t.prototype.setProgram=function(t){this._cmdBytes.writeInt(OpCodes.setProgram),this._cmdBytes.writeInt(t.id)},t.prototype.setProgramConstantsFromArray=function(t,e){this._cmdBytes.writeInt(OpCodes.setProgramConstant|t<<8),this._cmdBytes.writeInt(e.length),this._cmdBytes.writeFloat32Array(e)},t.prototype.setScissorRectangle=function(t){t?(this._cmdBytes.writeInt(OpCodes.setScissorRect),this._cmdBytes.writeFloat(t.x),this._cmdBytes.writeFloat(t.y),this._cmdBytes.writeFloat(t.width),this._cmdBytes.writeFloat(t.height)):this._cmdBytes.writeInt(OpCodes.clearScissorRect)},t.prototype.setTextureAt=function(t,e){e?(this._cmdBytes.writeInt(OpCodes.setTextureAt|t<<8),this._cmdBytes.writeInt(e.id)):this._cmdBytes.writeInt(OpCodes.clearTextureAt|t<<8)},t.prototype.setSamplerStateAt=function(t,e,i,r){this._cmdBytes.writeInt(OpCodes.setSamplerStateAt|t<<8),this._cmdBytes.writeInt(this._wrapDictionary[e]|this._filterDictionary[i]<<8|this._mipmapFilterDictionary[i][r]<<16)},t.prototype.setVertexBufferAt=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=4),e?(this._cmdBytes.writeInt(OpCodes.setVertexBufferAt|t<<8|r<<16|e.dataPerVertex<<24),this._cmdBytes.writeInt(e.id),this._cmdBytes.writeInt(i)):this._cmdBytes.writeInt(OpCodes.clearVertexBufferAt|t<<8)},t.prototype.setRenderToTexture=function(t,e,i,r,n){void 0===e&&(e=!1),null==t?this._cmdBytes.writeInt(OpCodes.clearRenderToTexture):(this._cmdBytes.writeInt(OpCodes.setRenderToTexture|(e?1:0)<<8),this._cmdBytes.writeInt(t.id))},t.prototype.setRenderToBackBuffer=function(){this._cmdBytes.writeInt(OpCodes.clearRenderToTexture)},t.prototype.copyToTexture=function(t,e,i){},t.prototype.updateBlendStatus=function(){this._blendEnabled?this._cmdBytes.writeInt(OpCodes.setBlendFactors|this._blendSourceFactor<<8|this._blendDestinationFactor<<16):this._cmdBytes.writeUnsignedInt(OpCodes.disableBlending)},t.prototype.translateTriangleFace=function(t,e){switch(t){case ContextGLTriangleFace.BACK:return e==CoordinateSystem.LEFT_HANDED?2:1;case ContextGLTriangleFace.FRONT:return e==CoordinateSystem.LEFT_HANDED?1:2;case ContextGLTriangleFace.FRONT_AND_BACK:return 0;default:throw"Unknown ContextGLTriangleFace type."}},t.prototype.execute=function(){if(this._createBytes.bytePosition>4){this._createBytes.bytePosition=0;var e=new Int32Array(this._createBytes.byteLength/4);this._createBytes.readInt32Array(e),GLESConnector.gles.sendGLESCommands(e.buffer),this._createBytes.byteLength=0,this._createBytes.bytePosition=0,this._createBytes.writeUnsignedInt(1)}if(this._cmdBytes.bytePosition>4){this._cmdBytes.bytePosition=0;var i=new Int32Array(this._cmdBytes.byteLength/4);this._cmdBytes.readInt32Array(i),GLESConnector.gles.sendGLESCommands(i.buffer),this._cmdBytes.byteLength=0,this._cmdBytes.bytePosition=0,this._cmdBytes.writeUnsignedInt(0)}if(t._soundBytes.bytePosition>4){t._soundBytes.bytePosition=0;var r=new Int32Array(t._soundBytes.byteLength/4);t._soundBytes.readInt32Array(r),GLESConnector.gles.sendGLESCommands(r.buffer),t._soundBytes.byteLength=0,t._soundBytes.bytePosition=0,t._soundBytes.writeUnsignedInt(100)}},t._uniformLocationNameDictionary=["fc","fs","vc"],t.MAX_SAMPLERS=8,t.modulo=0,t}(),ImageSampler=function(t){function e(e,i,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=!1);var n=t.call(this)||this;return n._repeat=e,n._smooth=i,n._mipmap=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeat",{get:function(){return this._repeat},set:function(t){this._repeat!=t&&(this._repeat=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth!=t&&(this._smooth=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mipmap",{get:function(){return this._mipmap},set:function(t){this._mipmap!=t&&(this._mipmap=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageRect",{get:function(){return this._imageRect},set:function(t){this._imageRect!=t&&(this._imageRect=t,this._updateRect())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameRect",{get:function(){return this._frameRect},set:function(t){this._frameRect!=t&&(this._frameRect=t,this._updateRect())},enumerable:!0,configurable:!0}),e.prototype._updateRect=function(){},e.assetType="[asset Sampler]",e}(AssetBase),ProgramData=function(){function t(t,e,i,r){this.usages=0,this._pool=t,this.stage=e,this.vertexString=i,this.fragmentString=r,this.stage.registerProgram(this)}return t.prototype.dispose=function(){this.usages--,this.usages||(this._pool.disposeItem(this.vertexString+this.fragmentString),this.stage.unRegisterProgram(this),this.program&&(this.program.dispose(),this.program=null))},t.PROGRAMDATA_ID_COUNT=0,t}(),ProgramDataPool=function(){function t(t){this._pool=new Object,this._stage=t}return t.prototype.getItem=function(t,e){var i=t+e;return this._pool[i]||(this._pool[i]=new ProgramData(this,this._stage,t,e))},t.prototype.disposeItem=function(t){this._pool[t]=null},t}(),IndexBufferSoftware=function(){function t(t){this._numIndices=t}return t.prototype.uploadFromArray=function(t,e,i){this._startOffset=2*e,this._data=t},t.prototype.uploadFromByteArray=function(t,e,i){this._startOffset=2*e,this._data=new Uint16Array(t)},t.prototype.dispose=function(){this._data=null},Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),t}(),VertexBufferSoftware=function(){function t(t,e){this._numVertices=t,this._dataPerVertex=e}return t.prototype.uploadFromArray=function(t,e,i){this._floatData=t},t.prototype.uploadFromByteArray=function(t,e,i){this._floatData=new Float32Array(t,e*this._dataPerVertex,i*this._dataPerVertex/4),this._uintData=new Uint8Array(t)},Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attributesPerVertex",{get:function(){return this._dataPerVertex/4},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._floatData=null},Object.defineProperty(t.prototype,"data",{get:function(){return this._floatData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uintData",{get:function(){return this._uintData},enumerable:!0,configurable:!0}),t}(),TextureSoftware=function(){function t(t,e){this._mipLevels=[],this._width=t,this._height=e}return Object.defineProperty(t.prototype,"textureType",{get:function(){return t.textureType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._mipLevels=null},t.prototype.isTexture=function(t){return this.textureType==t.textureType},t.prototype.uploadFromArray=function(t,e){void 0===e&&(e=0),this._mipLevels[e]=t instanceof Array?new Uint8Array(t):t},t.prototype.uploadFromURL=function(t,e){},t.prototype.getData=function(t){return this._mipLevels[t]},t.prototype.getMipLevelsCount=function(){return this._mipLevels.length},t.prototype.generateMipmaps=function(){},t.textureType="texture2d",t}(),CubeTextureSoftware=function(){function t(t){this._textureSelectorDictionary=[[],[],[],[],[],[]],this._size=t}return Object.defineProperty(t.prototype,"textureType",{get:function(){return t.textureType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._textureSelectorDictionary=null},t.prototype.isTexture=function(t){return this.textureType==t.textureType},t.prototype.uploadFromArray=function(t,e,i){void 0===i&&(i=0),this._textureSelectorDictionary[e][i]=t instanceof Array?new Uint8Array(t):t},t.prototype.getData=function(t,e){return void 0===e&&(e=0),this._textureSelectorDictionary[t][e]},t.prototype.getMipLevelsCount=function(){return 1},t.prototype.generateMipmaps=function(){},t.prototype.uploadCompressedTextureFromArray=function(t,e,i){},t.textureType="textureCube",t}(),ProgramVOSoftware=function(){this.outputColor=new Float32Array([0,0,0,1]),this.discard=!1},SoftwareSamplerState=function(){this.wrap=ContextGLWrapMode.REPEAT,this.filter=ContextGLTextureFilter.LINEAR,this.mipfilter=ContextGLMipFilter.MIPLINEAR},ProgramSoftware=function(){function t(){this._numVarying=0}return Object.defineProperty(t.prototype,"numVarying",{get:function(){return this._numVarying},enumerable:!0,configurable:!0}),t.prototype.upload=function(e,i){this._vertexDescr=t._tokenizer.decribeAGALByteArray(e),this._vertexVO=new ProgramVOSoftware,this._vertexVO.temp=new Float32Array(4*this._vertexDescr.regwrite[2].length),this._vertexVO.attributes=new Float32Array(4*this._vertexDescr.regread[0].length),this._numVarying=this._vertexDescr.regwrite[4].length,this._fragmentDescr=t._tokenizer.decribeAGALByteArray(i),this._fragmentVO=new ProgramVOSoftware,this._fragmentVO.temp=new Float32Array(4*this._fragmentDescr.regwrite[2].length),this._fragmentVO.varying=new Float32Array(4*this._fragmentDescr.regread[4].length),this._fragmentVO.derivativeX=new Float32Array(this._fragmentVO.varying.length),this._fragmentVO.derivativeY=new Float32Array(this._fragmentVO.varying.length)},t.prototype.dispose=function(){this._vertexDescr=null,this._fragmentDescr=null},t.prototype.vertex=function(e,i,r,n){var o=0,s=this._vertexDescr.regread[0].length,a=this._vertexVO.attributes;for(p=0;p<s;p++){var l=e._vertexBuffers[p];if(l){var h=e._vertexBufferOffsets[p]/4+i*l.attributesPerVertex;e._vertexBufferFormats[p]==ContextGLVertexBufferFormat.UNSIGNED_BYTE_4?(a[o++]=l.uintData[4*h],a[o++]=l.uintData[4*h+1],a[o++]=l.uintData[4*h+2],a[o++]=l.uintData[4*h+3]):e._vertexBufferFormats[p]==ContextGLVertexBufferFormat.FLOAT_4?(a[o++]=l.data[h],a[o++]=l.data[h+1],a[o++]=l.data[h+2],a[o++]=l.data[h+3]):e._vertexBufferFormats[p]==ContextGLVertexBufferFormat.FLOAT_3?(a[o++]=l.data[h],a[o++]=l.data[h+1],a[o++]=l.data[h+2],a[o++]=1):e._vertexBufferFormats[p]==ContextGLVertexBufferFormat.FLOAT_2?(a[o++]=l.data[h],a[o++]=l.data[h+1],a[o++]=0,a[o++]=1):e._vertexBufferFormats[p]==ContextGLVertexBufferFormat.FLOAT_1&&(a[o++]=l.data[h],a[o++]=0,a[o++]=0,a[o++]=1)}}for(var c=this._vertexVO.temp,u=c.length,p=0;p<u;p+=4)c[p]=0,c[p+1]=0,c[p+2]=0,c[p+3]=1;this._vertexVO.outputPosition=r,this._vertexVO.varying=n;var d=this._vertexDescr.tokens.length;for(p=0;p<d;p++){var f=this._vertexDescr.tokens[p];t._opCodeFunc[f.opcode](this._vertexVO,this._vertexDescr,f.dest,f.a,f.b,e)}},t.prototype.fragment=function(e,i,r,n,o,s,a,l){this._fragmentVO.outputDepth=l,this._fragmentVO.discard=!1;for(var h=this._fragmentVO.temp,c=h.length,u=0;u<c;u+=4)h[u]=0,h[u+1]=0,h[u+2]=0,h[u+3]=1;var p=[],d=this._fragmentDescr.tokens.length;for(u=0;u<d;u++){40==(y=this._fragmentDescr.tokens[u]).opcode&&e._samplerStates[y.b.regnum]&&e._samplerStates[y.b.regnum].mipfilter==ContextGLMipFilter.MIPLINEAR&&e._textures[y.b.regnum].getMipLevelsCount()>1&&p.push(y.a.regnum)}var f=this._fragmentVO.derivativeX,_=this._fragmentVO.derivativeY,g=this._fragmentVO.varying,m=g.length;for(u=0;u<m;u+=4)g[u]=i.x*o[u]+i.y*s[u]+i.z*a[u],g[u+1]=i.x*o[u+1]+i.y*s[u+1]+i.z*a[u+1],g[u+2]=i.x*o[u+2]+i.y*s[u+2]+i.z*a[u+2],g[u+3]=i.x*o[u+3]+i.y*s[u+3]+i.z*a[u+3],-1!=p.indexOf(u)&&(f[u]=r.x*o[u]+r.y*s[u]+r.z*a[u],f[u+1]=r.x*o[u+1]+r.y*s[u+1]+r.z*a[u+1],f[u+2]=r.x*o[u+2]+r.y*s[u+2]+r.z*a[u+2],f[u+3]=r.x*o[u+3]+r.y*s[u+3]+r.z*a[u+3],f[u]-=g[u],f[u+1]-=g[u+1],f[u+2]-=g[u+2],f[u+3]-=g[u+3],_[u]=n.x*o[u]+n.y*s[u]+n.z*a[u],_[u+1]=n.x*o[u+1]+n.y*s[u+1]+n.z*a[u+1],_[u+2]=n.x*o[u+2]+n.y*s[u+2]+n.z*a[u+2],_[u+3]=n.x*o[u+3]+n.y*s[u+3]+n.z*a[u+3],_[u]-=g[u],_[u+1]-=g[u+1],_[u+2]-=g[u+2],_[u+3]-=g[u+3]);for(u=0;u<d;u++){var y=this._fragmentDescr.tokens[u];t._opCodeFunc[y.opcode](this._fragmentVO,this._fragmentDescr,y.dest,y.a,y.b,e)}return this._fragmentVO},t.getDestTarget=function(t,e,i){var r;return 2==i.regtype?r=t.temp:3==i.regtype?r="vertex"==e.header.type?t.outputPosition:t.outputColor:4==i.regtype&&(r=t.varying),r},t.getSourceTarget=function(t,e,i,r){var n;return 0==i.regtype?n=t.attributes:1==i.regtype?n="vertex"==e.header.type?r._vertexConstants:r._fragmentConstants:2==i.regtype?n=t.temp:4==i.regtype&&(n=t.varying),n},t.mov=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask;1&u&&(h[a]=c[l+(n.swizzle>>0&3)]),2&u&&(h[a+1]=c[l+(n.swizzle>>2&3)]),4&u&&(h[a+2]=c[l+(n.swizzle>>4&3)]),8&u&&(h[a+3]=c[l+(n.swizzle>>6&3)])},t.m44=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask;1&d&&(c[a]=u[l]*p[h]+u[l+1]*p[h+1]+u[l+2]*p[h+2]+p[h+3]),2&d&&(c[a+1]=u[l]*p[h+4]+u[l+1]*p[h+5]+u[l+2]*p[h+6]+p[h+7]),4&d&&(c[a+2]=u[l]*p[h+8]+u[l+1]*p[h+9]+u[l+2]*p[h+10]+p[h+11]),8&d&&(c[a+3]=u[l]*p[h+12]+u[l+1]*p[h+13]+u[l+2]*p[h+14]+p[h+15])},t.sample=function(e,i,r,n,o){var s=r._textures[o];if(s.isTexture(TextureSoftware))return t.sampleSimpleTexture(e,i,r,n,o);if(s.isTexture(CubeTextureSoftware))return t.sampleCubeTexture(e,i,r,n,o);throw new ArgumentError("Cannot sample provided texture type")},t.sampleCubeTexture=function(e,i,r,n,o){var s=4*n.regnum,a=t.getSourceTarget(e,i,n,r),l=a[s+(n.swizzle>>0&3)],h=a[s+(n.swizzle>>2&3)],c=a[s+(n.swizzle>>4&3)],u=0,p=0,d=0,f=Math.abs(l),_=Math.abs(h),g=Math.abs(c),m=Math.max(f,_,g);m==f?l>=0?(u=0,p=.5-c/l*.5,d=.5-h/l*.5):(u=1,p=.5-c/l*.5,d=.5+h/l*.5):m==_?h>=0?(u=2,p=.5+l/h*.5,d=.5+c/h*.5):(u=3,p=.5-l/h*.5,d=.5+c/h*.5):m==g&&(c>=0?(u=4,p=.5+l/c*.5,d=.5-h/c*.5):(u=5,p=.5+l/c*.5,d=.5+h/c*.5));var y=r._textures[o],v=r._samplerStates[o]||this._defaultSamplerState,b=v.wrap==ContextGLWrapMode.REPEAT;v.mipfilter,ContextGLMipFilter.MIPLINEAR;return v.filter==ContextGLTextureFilter.LINEAR?t.sampleBilinear(p,d,y.getData(u),y.size,y.size,b,t._colorValue0):t.sampleNearest(p,d,y.getData(u),y.size,y.size,b,t._colorValue0)},t.sampleSimpleTexture=function(e,i,r,n,o){var s=4*n.regnum,a=t.getSourceTarget(e,i,n,r),l=a[s+(n.swizzle>>0&3)],h=a[s+(n.swizzle>>2&3)];if(o>=r._textures.length||null==r._textures[o])throw new ArgumentError("textureIndex contains no texture");var c=r._textures[o],u=r._samplerStates[o]||this._defaultSamplerState,p=u.wrap==ContextGLWrapMode.REPEAT;if(u.mipfilter==ContextGLMipFilter.MIPLINEAR&&c.getMipLevelsCount()>1){var d=Math.abs(e.derivativeX[s+(n.swizzle>>0&3)]),f=Math.abs(e.derivativeX[s+(n.swizzle>>2&3)]),_=Math.abs(e.derivativeY[s+(n.swizzle>>0&3)]),g=Math.abs(e.derivativeY[s+(n.swizzle>>2&3)]),m=Math.log(Math.max(c.width*Math.sqrt(d*d+f*f),c.height*Math.sqrt(_*_+g*g)))/Math.LN2;if(m>0){var y=Math.floor(m),v=Math.ceil(m),b=Math.log(Math.min(c.width,c.height))/Math.LN2;v>b&&(v=b),y>b&&(y=b);var x=m-Math.floor(m),A=c.getData(y),E=c.width/Math.pow(2,y),S=c.height/Math.pow(2,y),T=c.getData(v),P=c.width/Math.pow(2,v),C=c.height/Math.pow(2,v);return u.filter==ContextGLTextureFilter.LINEAR?(t.sampleBilinear(l,h,A,E,S,p,t._colorValue0),t.sampleBilinear(l,h,T,P,C,p,t._colorValue1)):(t.sampleNearest(l,h,A,E,S,p,t._colorValue0),t.sampleNearest(l,h,T,P,C,p,t._colorValue1)),t.interpolateColor(t._colorValue0,t._colorValue1,x,t._colorValue0)}}return u.filter==ContextGLTextureFilter.LINEAR?t.sampleBilinear(l,h,c.getData(0),c.width,c.height,p,t._colorValue0):t.sampleNearest(l,h,c.getData(0),c.width,c.height,p,t._colorValue0)},t.sampleNearest=function(t,e,i,r,n,o,s){t*=r,e*=n,o?(t=Math.abs(t%r),e=Math.abs(e%n)):(t<0?t=0:t>r-1&&(t=r-1),e<0?e=0:e>n-1&&(e=n-1));var a=4*((t=Math.floor(t))+(e=Math.floor(e))*r);return s[0]=i[a]/255,s[1]=i[a+1]/255,s[2]=i[a+2]/255,s[3]=i[a+3]/255,s},t.sampleBilinear=function(e,i,r,n,o,s,a){var l=1/n,h=1/o;i-=h/2;var c=(e-=l/2)*n;c-=Math.floor(c);var u=i*o;return u-=Math.floor(u),t.interpolateColor(t.interpolateColor(t.sampleNearest(e,i,r,n,o,s,t._colorInterpolated0),t.sampleNearest(e+l,i,r,n,o,s,t._colorValue0),c,t._colorInterpolated0),t.interpolateColor(t.sampleNearest(e,i+h,r,n,o,s,t._colorInterpolated1),t.sampleNearest(e+l,i+h,r,n,o,s,t._colorValue0),c,t._colorInterpolated1),u,a)},t.interpolateColor=function(t,e,i,r){return r[0]=t[0]+(e[0]-t[0])*i,r[1]=t[1]+(e[1]-t[1])*i,r[2]=t[2]+(e[2]-t[2])*i,r[3]=t[3]+(e[3]-t[3])*i,r},t.tex=function(e,i,r,n,o,s){var a=4*r.regnum,l=t.getDestTarget(e,i,r),h=t.sample(e,i,s,n,o.regnum),c=r.mask;1&c&&(l[a]=h[0]),2&c&&(l[a+1]=h[1]),4&c&&(l[a+2]=h[2]),8&c&&(l[a+3]=h[3])},t.add=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=u[l+(f>>0&3)]+p[h+(_>>0&3)]),2&d&&(c[a+1]=u[l+(f>>2&3)]+p[h+(_>>2&3)]),4&d&&(c[a+2]=u[l+(f>>4&3)]+p[h+(_>>4&3)]),8&d&&(c[a+3]=u[l+(f>>6&3)]+p[h+(_>>6&3)])},t.sub=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=u[l+(f>>0&3)]-p[h+(_>>0&3)]),2&d&&(c[a+1]=u[l+(f>>2&3)]-p[h+(_>>2&3)]),4&d&&(c[a+2]=u[l+(f>>4&3)]-p[h+(_>>4&3)]),8&d&&(c[a+3]=u[l+(f>>6&3)]-p[h+(_>>6&3)])},t.mul=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=u[l+(f>>0&3)]*p[h+(_>>0&3)]),2&d&&(c[a+1]=u[l+(f>>2&3)]*p[h+(_>>2&3)]),4&d&&(c[a+2]=u[l+(f>>4&3)]*p[h+(_>>4&3)]),8&d&&(c[a+3]=u[l+(f>>6&3)]*p[h+(_>>6&3)])},t.div=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=u[l+(f>>0&3)]/p[h+(_>>0&3)]),2&d&&(c[a+1]=u[l+(f>>2&3)]/p[h+(_>>2&3)]),4&d&&(c[a+2]=u[l+(f>>4&3)]/p[h+(_>>4&3)]),8&d&&(c[a+3]=u[l+(f>>6&3)]/p[h+(_>>6&3)])},t.rcp=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=1/c[l+(p>>0&3)]),2&u&&(h[a+1]=1/c[l+(p>>2&3)]),4&u&&(h[a+2]=1/c[l+(p>>4&3)]),8&u&&(h[a+3]=1/c[l+(p>>6&3)])},t.min=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=Math.min(u[l+(f>>0&3)],p[h+(_>>0&3)])),2&d&&(c[a+1]=Math.min(u[l+(f>>2&3)],p[h+(_>>2&3)])),4&d&&(c[a+2]=Math.min(u[l+(f>>4&3)],p[h+(_>>4&3)])),8&d&&(c[a+3]=Math.min(u[l+(f>>6&3)],p[h+(_>>6&3)]))},t.max=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=Math.max(u[l+(f>>0&3)],p[h+(_>>0&3)])),2&d&&(c[a+1]=Math.max(u[l+(f>>2&3)],p[h+(_>>2&3)])),4&d&&(c[a+2]=Math.max(u[l+(f>>4&3)],p[h+(_>>4&3)])),8&d&&(c[a+3]=Math.max(u[l+(f>>6&3)],p[h+(_>>6&3)]))},t.frc=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=c[l+(p>>0&3)]-Math.floor(c[l+(p>>0&3)])),2&u&&(h[a+1]=c[l+(p>>2&3)]-Math.floor(c[l+(p>>2&3)])),4&u&&(h[a+2]=c[l+(p>>4&3)]-Math.floor(c[l+(p>>4&3)])),8&u&&(h[a+3]=c[l+(p>>6&3)]-Math.floor(c[l+(p>>6&3)]))},t.sqt=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.sqrt(c[l+(p>>0&3)])),2&u&&(h[a+1]=Math.sqrt(c[l+(p>>2&3)])),4&u&&(h[a+2]=Math.sqrt(c[l+(p>>4&3)])),8&u&&(h[a+3]=Math.sqrt(c[l+(p>>6&3)]))},t.rsq=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=1/Math.sqrt(c[l+(p>>0&3)])),2&u&&(h[a+1]=1/Math.sqrt(c[l+(p>>2&3)])),4&u&&(h[a+2]=1/Math.sqrt(c[l+(p>>4&3)])),8&u&&(h[a+3]=1/Math.sqrt(c[l+(p>>6&3)]))},t.pow=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask,f=n.swizzle,_=o.swizzle;1&d&&(c[a]=Math.pow(u[l+(f>>0&3)],p[h+(_>>0&3)])),2&d&&(c[a+1]=Math.pow(u[l+(f>>2&3)],p[h+(_>>2&3)])),4&d&&(c[a+2]=Math.pow(u[l+(f>>4&3)],p[h+(_>>4&3)])),8&d&&(c[a+3]=Math.pow(u[l+(f>>6&3)],p[h+(_>>6&3)]))},t.log=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.log(c[l+(p>>0&3)])/Math.LN2),2&u&&(h[a+1]=Math.log(c[l+(p>>2&3)])/Math.LN2),4&u&&(h[a+2]=Math.log(c[l+(p>>4&3)])/Math.LN2),8&u&&(h[a+3]=Math.log(c[l+(p>>6&3)])/Math.LN2)},t.exp=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.exp(c[l+(p>>0&3)])),2&u&&(h[a+1]=Math.exp(c[l+(p>>2&3)])),4&u&&(h[a+2]=Math.exp(c[l+(p>>4&3)])),8&u&&(h[a+3]=Math.exp(c[l+(p>>6&3)]))},t.nrm=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle,d=c[l+(p>>0&3)],f=c[l+(p>>2&3)],_=c[l+(p>>4&3)],g=Math.sqrt(d*d+f*f+_*_);d/=g,f/=g,_/=g,1&u&&(h[a]=d),2&u&&(h[a+1]=f),4&u&&(h[a+2]=_)},t.sin=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.sin(c[l+(p>>0&3)])),2&u&&(h[a+1]=Math.sin(c[l+(p>>2&3)])),4&u&&(h[a+2]=Math.sin(c[l+(p>>4&3)])),8&u&&(h[a+3]=Math.sin(c[l+(p>>6&3)]))},t.cos=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.cos(c[l+(p>>0&3)])),2&u&&(h[a+1]=Math.cos(c[l+(p>>2&3)])),4&u&&(h[a+2]=Math.cos(c[l+(p>>4&3)])),8&u&&(h[a+3]=Math.cos(c[l+(p>>6&3)]))},t.crs=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=t.getSourceTarget(e,i,o,s),v=y[h+(d>>0&3)],b=y[h+(d>>2&3)],x=y[h+(d>>4&3)];1&u&&(c[a]=g*x-m*b),2&u&&(c[a+1]=m*v-_*x),4&u&&(c[a+2]=_*b-g*v)},t.dp3=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=t.getSourceTarget(e,i,o,s),v=y[h+(d>>0&3)],b=y[h+(d>>2&3)],x=y[h+(d>>4&3)];1&u&&(c[a]=_*v+g*b+m*x),2&u&&(c[a+1]=_*v+g*b+m*x),4&u&&(c[a+2]=_*v+g*b+m*x),8&u&&(c[a+3]=_*v+g*b+m*x)},t.dp4=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=f[l+(p>>6&3)],v=t.getSourceTarget(e,i,o,s),b=v[h+(d>>0&3)],x=v[h+(d>>2&3)],A=v[h+(d>>4&3)],E=v[h+(d>>6&3)];1&u&&(c[a]=_*b+g*x+m*A+y*E),2&u&&(c[a+1]=_*b+g*x+m*A+y*E),4&u&&(c[a+2]=_*b+g*x+m*A+y*E),8&u&&(c[a+3]=_*b+g*x+m*A+y*E)},t.abs=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.abs(c[l+(p>>0&3)])),2&u&&(h[a+1]=Math.abs(c[l+(p>>2&3)])),4&u&&(h[a+2]=Math.abs(c[l+(p>>4&3)])),8&u&&(h[a+3]=Math.abs(c[l+(p>>6&3)]))},t.neg=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=-c[l+(p>>0&3)]),2&u&&(h[a+1]=-c[l+(p>>2&3)]),4&u&&(h[a+2]=-c[l+(p>>4&3)]),8&u&&(h[a+3]=-c[l+(p>>6&3)])},t.sat=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=t.getSourceTarget(e,i,n,s),u=r.mask,p=n.swizzle;1&u&&(h[a]=Math.max(0,Math.min(1,c[l+(p>>0&3)]))),2&u&&(h[a+1]=Math.max(0,Math.min(1,c[l+(p>>2&3)]))),4&u&&(h[a+2]=Math.max(0,Math.min(1,c[l+(p>>4&3)]))),8&u&&(h[a+3]=Math.max(0,Math.min(1,c[l+(p>>6&3)])))},t.m33=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask;1&d&&(c[a]=u[l]*p[h]+u[l+1]*p[h+1]+u[l+2]*p[h+2]),2&d&&(c[a+1]=u[l]*p[h+4]+u[l+1]*p[h+5]+u[l+2]*p[h+6]),4&d&&(c[a+2]=u[l]*p[h+8]+u[l+1]*p[h+9]+u[l+2]*p[h+10])},t.m34=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=t.getSourceTarget(e,i,n,s),p=t.getSourceTarget(e,i,o,s),d=r.mask;1&d&&(c[a]=u[l]*p[h]+u[l+1]*p[h+1]+u[l+2]*p[h+2]+p[h+3]),2&d&&(c[a+1]=u[l]*p[h+4]+u[l+1]*p[h+5]+u[l+2]*p[h+6]+p[h+7]),4&d&&(c[a+2]=u[l]*p[h+8]+u[l+1]*p[h+9]+u[l+2]*p[h+10]+p[h+11])},t.ddx=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=e.derivativeX,u=r.mask,p=n.swizzle;1&u&&(h[a]=c[l+(p>>0&3)]),2&u&&(h[a+1]=c[l+(p>>2&3)]),4&u&&(h[a+2]=c[l+(p>>4&3)]),8&u&&(h[a+3]=c[l+(p>>6&3)])},t.ddy=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=e.derivativeY,u=r.mask,p=n.swizzle;1&u&&(h[a]=c[l+(p>>0&3)]),2&u&&(h[a+1]=c[l+(p>>2&3)]),4&u&&(h[a+2]=c[l+(p>>4&3)]),8&u&&(h[a+3]=c[l+(p>>6&3)])},t.sge=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=f[l+(p>>6&3)],v=t.getSourceTarget(e,i,o,s),b=v[h+(d>>0&3)],x=v[h+(d>>2&3)],A=v[h+(d>>4&3)],E=v[h+(d>>6&3)];1&u&&(c[a]=_>=b?1:0),2&u&&(c[a+1]=g>=x?1:0),4&u&&(c[a+2]=m>=A?1:0),8&u&&(c[a+3]=y>=E?1:0)},t.slt=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*o.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=f[l+(p>>6&3)],v=t.getSourceTarget(e,i,o,s),b=v[h+(d>>0&3)],x=v[h+(d>>2&3)],A=v[h+(d>>4&3)],E=v[h+(d>>6&3)];1&u&&(c[a]=_<b?1:0),2&u&&(c[a+1]=g<x?1:0),4&u&&(c[a+2]=m<A?1:0),8&u&&(c[a+3]=y<E?1:0)},t.seq=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*n.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=f[l+(p>>6&3)],v=t.getSourceTarget(e,i,o,s),b=v[h+(d>>0&3)],x=v[h+(d>>2&3)],A=v[h+(d>>4&3)],E=v[h+(d>>6&3)];1&u&&(c[a]=_==b?1:0),2&u&&(c[a+1]=g==x?1:0),4&u&&(c[a+2]=m==A?1:0),8&u&&(c[a+3]=y==E?1:0)},t.sne=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=4*n.regnum,c=t.getDestTarget(e,i,r),u=r.mask,p=n.swizzle,d=o.swizzle,f=t.getSourceTarget(e,i,n,s),_=f[l+(p>>0&3)],g=f[l+(p>>2&3)],m=f[l+(p>>4&3)],y=f[l+(p>>6&3)],v=t.getSourceTarget(e,i,o,s),b=v[h+(d>>0&3)],x=v[h+(d>>2&3)],A=v[h+(d>>4&3)],E=v[h+(d>>6&3)];1&u&&(c[a]=_!=b?1:0),2&u&&(c[a+1]=g!=x?1:0),4&u&&(c[a+2]=m!=A?1:0),8&u&&(c[a+3]=y!=E?1:0)},t.sgn=function(e,i,r,n,o,s){var a=4*r.regnum,l=4*n.regnum,h=t.getDestTarget(e,i,r),c=r.mask,u=n.swizzle,p=t.getSourceTarget(e,i,n,s),d=p[l+(u>>0&3)],f=p[l+(u>>2&3)],_=p[l+(u>>4&3)],g=p[l+(u>>6&3)];1&c&&(h[a]=d<0?-1:d>0?1:0),2&c&&(h[a+1]=f<0?-1:f>0?1:0),4&c&&(h[a+2]=_<0?-1:_>0?1:0),8&c&&(h[a+3]=g<0?-1:g>0?1:0)},t.kil=function(e,i,r,n,o,s){var a=4*n.regnum,l=n.swizzle;t.getSourceTarget(e,i,n,s)[a+(l>>0&3)]<0&&(e.discard=!0)},t._defaultSamplerState=new SoftwareSamplerState,t._tokenizer=new AGALTokenizer,t._opCodeFunc=[t.mov,t.add,t.sub,t.mul,t.div,t.rcp,t.min,t.max,t.frc,t.sqt,t.rsq,t.pow,t.log,t.exp,t.nrm,t.sin,t.cos,t.crs,t.dp3,t.dp4,t.abs,t.neg,t.sat,t.m33,t.m44,t.m34,null,null,null,null,null,null,null,null,null,null,null,null,null,t.kil,t.tex,t.sge,t.slt,t.sgn,t.seq,t.sne],t._colorValue0=new Float32Array(4),t._colorValue1=new Float32Array(4),t._colorInterpolated0=new Float32Array(4),t._colorInterpolated1=new Float32Array(4),t}(),BlendModeSoftware=function(){function t(){}return t.destinationAlpha=function(t,e,i,r){t[0]=e[0]*i[3]/255,t[1]=e[1]*i[3]/255,t[2]=e[2]*i[3]/255,t[3]=e[3]*i[3]/255},t.destinationColor=function(t,e,i,r){t[0]=e[0]*i[0]/255,t[1]=e[1]*i[1]/255,t[2]=e[2]*i[2]/255,t[3]=e[3]*i[3]/255},t.one=function(t,e,i,r){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]},t.oneMinusDestinationAlpha=function(t,e,i,r){t[0]=e[0]*(1-i[3]/255),t[1]=e[1]*(1-i[3]/255),t[2]=e[2]*(1-i[3]/255),t[3]=e[3]*(1-i[3]/255)},t.oneMinusDestinationColor=function(t,e,i,r){t[0]=e[0]*(1-i[0]/255),t[1]=e[1]*(1-i[1]/255),t[2]=e[2]*(1-i[2]/255),t[3]=e[3]*(1-i[3]/255)},t.oneMinusSourceAlpha=function(t,e,i,r){t[0]=e[0]*(1-r[3]/255),t[1]=e[1]*(1-r[3]/255),t[2]=e[2]*(1-r[3]/255),t[3]=e[3]*(1-r[3]/255)},t.oneMinusSourceColor=function(t,e,i,r){t[0]=e[0]*(1-r[0]/255),t[1]=e[1]*(1-r[1]/255),t[2]=e[2]*(1-r[2]/255),t[3]=e[3]*(1-r[3]/255)},t.sourceAlpha=function(t,e,i,r){t[0]=e[0]*r[3]/255,t[1]=e[1]*r[3]/255,t[2]=e[2]*r[3]/255,t[3]=e[3]*r[3]/255},t.sourceColor=function(t,e,i,r){t[0]=e[0]*r[0]/255,t[1]=e[1]*r[1]/255,t[2]=e[2]*r[2]/255,t[3]=e[3]*r[3]/255},t.zero=function(t,e,i,r){},t}(),DepthCompareModeSoftware=function(){function t(){}return t.always=function(t,e){return!0},t.equal=function(t,e){return t==e},t.greater=function(t,e){return t>e},t.greaterEqual=function(t,e){return t>=e},t.less=function(t,e){return t<e},t.lessEqual=function(t,e){return t<=e},t.never=function(t,e){return!1},t.notEqual=function(t,e){return t!=e},t}(),ContextSoftware=function(){function t(t){this._backBufferRect=new Rectangle,this._cullingMode=ContextGLTriangleFace.BACK,this._blendSource=ContextGLBlendFactor.ONE,this._blendDestination=ContextGLBlendFactor.ZERO,this._colorMaskR=!0,this._colorMaskG=!0,this._colorMaskB=!0,this._colorMaskA=!0,this._writeDepth=!0,this._depthCompareMode=ContextGLCompareMode.LESS,this._depthCompareModeSoftware=function(t,e){},this._blendModeSoftware=function(t,e,i){},this._screenMatrix=new Matrix3D,this._frontBufferMatrix=new Matrix,this._bboxMin=new Point,this._bboxMax=new Point,this._clamp=new Point,this._samplerStates=[],this._textures=[],this.textureBuffersColor=[],this.textureBuffersZ=[],this.textureBuffersZClear=[],this._vertexBuffers=[],this._vertexBufferOffsets=[],this._vertexBufferFormats=[],this._rgba=new Uint8ClampedArray(4),this._source=new Uint8ClampedArray(4),this._dest=new Uint8ClampedArray(4),this._destComp=new Uint8ClampedArray(4),this._sourceComp=new Uint8ClampedArray(4),this._antialias=0,this._p0=new Vector3D,this._p1=new Vector3D,this._p2=new Vector3D,this._project=new Vector3D,this._barycentric=new Vector3D,this._barycentricRight=new Vector3D,this._barycentricBottom=new Vector3D,this._canvas=t,this._backBufferColor=new BitmapImage2D(100,100,!1,0,!1),this._frontBuffer=new BitmapImage2D(100,100,!1,0,!1),this._activeBufferColor=this._backBufferColor;var e=new ArrayBuffer(8e4);this._backBufferZ=new Float32Array(e,0,1e4),this._backBufferZClear=new Float32Array(e,4e4,1e4);for(var i=0;i<1e4;i++)this._backBufferZClear[i]=1e7;this._activeBufferZ=this._backBufferZ,document&&document.body&&(this._frontCanvas=document.createElement("canvas"),this._frontBufferContext=this._frontCanvas.getContext("2d"),this._frontBufferImageData=this._frontBufferContext.getImageData(0,0,100,100),this._frontCanvas.style.position="absolute",document.body.appendChild(this._frontCanvas)),this._depthCompareModeSoftware[ContextGLCompareMode.ALWAYS]=DepthCompareModeSoftware.always,this._depthCompareModeSoftware[ContextGLCompareMode.EQUAL]=DepthCompareModeSoftware.equal,this._depthCompareModeSoftware[ContextGLCompareMode.GREATER]=DepthCompareModeSoftware.greaterEqual,this._depthCompareModeSoftware[ContextGLCompareMode.GREATER_EQUAL]=DepthCompareModeSoftware.greater,this._depthCompareModeSoftware[ContextGLCompareMode.LESS]=DepthCompareModeSoftware.less,this._depthCompareModeSoftware[ContextGLCompareMode.LESS_EQUAL]=DepthCompareModeSoftware.lessEqual,this._depthCompareModeSoftware[ContextGLCompareMode.NEVER]=DepthCompareModeSoftware.never,this._depthCompareModeSoftware[ContextGLCompareMode.NOT_EQUAL]=DepthCompareModeSoftware.notEqual,this._blendModeSoftware[ContextGLBlendFactor.DESTINATION_ALPHA]=BlendModeSoftware.destinationAlpha,this._blendModeSoftware[ContextGLBlendFactor.DESTINATION_COLOR]=BlendModeSoftware.destinationColor,this._blendModeSoftware[ContextGLBlendFactor.ONE]=BlendModeSoftware.one,this._blendModeSoftware[ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=BlendModeSoftware.oneMinusDestinationAlpha,this._blendModeSoftware[ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=BlendModeSoftware.oneMinusDestinationColor,this._blendModeSoftware[ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=BlendModeSoftware.oneMinusSourceAlpha,this._blendModeSoftware[ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=BlendModeSoftware.oneMinusSourceColor,this._blendModeSoftware[ContextGLBlendFactor.SOURCE_ALPHA]=BlendModeSoftware.sourceAlpha,this._blendModeSoftware[ContextGLBlendFactor.SOURCE_COLOR]=BlendModeSoftware.sourceColor,this._blendModeSoftware[ContextGLBlendFactor.ZERO]=BlendModeSoftware.zero}return Object.defineProperty(t.prototype,"glVersion",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return 1},enumerable:!0,configurable:!0}),t.prototype.configureBackBuffer=function(t,e,i,r){this._antialias=i,this._antialias%2!=0&&(this._antialias=Math.floor(this._antialias-.5)),0==this._antialias&&(this._antialias=1),this._frontBuffer._setSize(t,e),this._frontCanvas.width=t,this._frontCanvas.height=e,this._frontBufferImageData=this._frontBufferContext.getImageData(0,0,t,e);var n=t*this._antialias,o=e*this._antialias,s=n*o,a=new ArrayBuffer(8*s);this._backBufferZ=new Float32Array(a,0,s),this._backBufferZClear=new Float32Array(a,4*s,s);for(var l=0;l<s;l++)this._backBufferZClear[l]=1e7;this._activeBufferColor==this._backBufferColor&&(this._activeBufferZ=this._backBufferZ),this._backBufferRect.width=n,this._backBufferRect.height=o,this._backBufferColor._setSize(n,o),this.activateScreenMatrix(this._backBufferRect.width,this._backBufferRect.height,!0),this._frontBufferMatrix=new Matrix,this._frontBufferMatrix.scale(1/this._antialias,1/this._antialias)},t.prototype.activateScreenMatrix=function(t,e,i){var r=this._screenMatrix._rawData;r[0]=t/2,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i?-e/2:e/2,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t/2,r[13]=e/2,r[14]=0,r[15]=0,this._yflip=i},t.prototype.setRenderToTexture=function(t,e,i,r,n){var o=this.textureBuffersColor[r];null==o?(o=this.textureBuffersColor[r]=new BitmapImage2D(t.width,t.height,!1,16777215,!0),t.uploadFromArray(o.data)):o.fillRect(o.rect,16777215),this._activeBufferColor=o,this._activeBufferColor.lock();var s=this.textureBuffersZ[r],a=this.textureBuffersZClear[r];if(null==s){var l=t.width*t.height,h=new ArrayBuffer(8*l);s=this.textureBuffersZ[r]=new Float32Array(h,0,l),a=this.textureBuffersZClear[r]=new Float32Array(h,4*l,l);for(var c=0;c<l;c++)a[c]=1e7}s.set(a),this._activeBufferZ=s,this.activateScreenMatrix(t.width,t.height,!1),this._activeTexture=t},t.prototype.setRenderToBackBuffer=function(){this._activeBufferColor=this._backBufferColor,this._activeBufferZ=this._backBufferZ,this.activateScreenMatrix(this._backBufferColor.width,this._backBufferColor.height,!0)},t.prototype.copyToTexture=function(t,e,i){},t.prototype.drawIndices=function(t,e,i,r){if(this._program){var n=new Float32Array(4),o=new Float32Array(4),s=new Float32Array(4),a=new Float32Array(4),l=new Float32Array(4),h=new Float32Array(4*this._program.numVarying),c=new Float32Array(4*this._program.numVarying),u=new Float32Array(4*this._program.numVarying),p=new Float32Array(4*this._program.numVarying),d=new Float32Array(4*this._program.numVarying),f=new Array(5),_=new Array(4);f[0]=o,f[1]=s,f[2]=n,f[3]=a,f[4]=l;var g=new Array(5),m=new Array(4);if(g[0]=c,g[1]=u,g[2]=h,g[3]=p,g[4]=d,this._yflip&&this._cullingMode==ContextGLTriangleFace.BACK||!this._yflip&&this._cullingMode==ContextGLTriangleFace.FRONT)for(var y=i;y<r;y+=3)this._program.vertex(this,e.data[e.startOffset+y],n,h),this._program.vertex(this,e.data[e.startOffset+y+1],o,c),this._program.vertex(this,e.data[e.startOffset+y+2],s,u),this._triangle(f,_,g,m);else if(this._yflip&&this._cullingMode==ContextGLTriangleFace.FRONT||!this._yflip&&this._cullingMode==ContextGLTriangleFace.BACK)for(y=i;y<r;y+=3)this._program.vertex(this,e.data[e.startOffset+y+2],n,h),this._program.vertex(this,e.data[e.startOffset+y+1],o,c),this._program.vertex(this,e.data[e.startOffset+y],s,u),this._triangle(f,_,g,m);else if(this._cullingMode==ContextGLTriangleFace.FRONT_AND_BACK||this._cullingMode==ContextGLTriangleFace.NONE)for(y=i;y<r;y+=3)this._program.vertex(this,e.data[e.startOffset+y+2],n,h),this._program.vertex(this,e.data[e.startOffset+y+1],o,c),this._program.vertex(this,e.data[e.startOffset+y],s,u),this._triangle(f,_,g,m),this._program.vertex(this,e.data[e.startOffset+y],n,h),this._program.vertex(this,e.data[e.startOffset+y+1],o,c),this._program.vertex(this,e.data[e.startOffset+y+2],s,u),this._triangle(f,_,g,m);this._activeBufferColor!=this._backBufferColor&&(this._activeBufferColor.unlock(),this._activeTexture.uploadFromArray(this._activeBufferColor.data))}},t.prototype._triangle=function(t,e,i,r){var n=0,o=0,s=0,a=t[2],l=i[2],h=a[2]>0;h&&(e[0]=a,r[0]=l,s++,n++);for(var c=0;c<3;c++){var u=t[c],p=i[c],d=u[2]>0;if(d!=h){var f=Math.abs(u[2]),_=Math.abs(a[2]),g=_/(_+f);this._interpolateVertexPair(g,u,a,t[3+o]),e[s]=t[3+o],this._interpolateVertexPair(g,p,l,i[3+o]),r[s]=i[3+o],s++,o++}d&&2!=c&&(e[s]=u,r[s]=p,s++,n++),a=u,l=p,h=d}3==n?this._projectTriangle(t[0],t[1],t[2],i[0],i[1],i[2]):2==n?(this._projectTriangle(e[0],e[1],e[2],r[0],r[1],r[2]),this._projectTriangle(e[0],e[2],e[3],r[0],r[2],r[3])):1==n&&this._projectTriangle(e[0],e[1],e[2],r[0],r[1],r[2])},t.prototype._projectTriangle=function(t,e,i,r,n,o){if(this._p0.x=t[0],this._p0.y=t[1],this._p0.z=t[2],this._p0.w=t[3],this._p1.x=e[0],this._p1.y=e[1],this._p1.z=e[2],this._p1.w=e[3],this._p2.x=i[0],this._p2.y=i[1],this._p2.z=i[2],this._p2.w=i[3],0!=this._p0.w&&0!=this._p1.w&&0!=this._p2.w&&!(isNaN(this._p0.x)||isNaN(this._p0.y)||isNaN(this._p0.z)||isNaN(this._p0.w)||isNaN(this._p1.x)||isNaN(this._p1.y)||isNaN(this._p1.z)||isNaN(this._p1.w)||isNaN(this._p2.x)||isNaN(this._p2.y)||isNaN(this._p2.z)||isNaN(this._p2.w))){this._p0.z=2*this._p0.z-this._p0.w,this._p1.z=2*this._p1.z-this._p1.w,this._p2.z=2*this._p2.z-this._p2.w,this._p0.project(),this._p1.project(),this._p2.project(),this._project.x=this._p0.w,this._project.y=this._p1.w,this._project.z=this._p2.w,this._p0.w=1,this._p1.w=1,this._p2.w=1,this._p0=this._screenMatrix.transformVector(this._p0,this._p0),this._p1=this._screenMatrix.transformVector(this._p1,this._p1),this._p2=this._screenMatrix.transformVector(this._p2,this._p2),this._bboxMin.x=1e6,this._bboxMin.y=1e6,this._bboxMax.x=-1e6,this._bboxMax.y=-1e6,this._clamp.x=this._activeBufferColor.width-1,this._clamp.y=this._activeBufferColor.height-1,this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,this._p0.x)),this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,this._p0.y)),this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,this._p1.x)),this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,this._p1.y)),this._bboxMin.x=Math.max(0,Math.min(this._bboxMin.x,this._p2.x)),this._bboxMin.y=Math.max(0,Math.min(this._bboxMin.y,this._p2.y)),this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,this._p0.x)),this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,this._p0.y)),this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,this._p1.x)),this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,this._p1.y)),this._bboxMax.x=Math.min(this._clamp.x,Math.max(this._bboxMax.x,this._p2.x)),this._bboxMax.y=Math.min(this._clamp.y,Math.max(this._bboxMax.y,this._p2.y)),this._bboxMin.x=Math.floor(this._bboxMin.x),this._bboxMin.y=Math.floor(this._bboxMin.y),this._bboxMax.x=Math.floor(this._bboxMax.x),this._bboxMax.y=Math.floor(this._bboxMax.y);var s=this._bboxMax.x-this._bboxMin.x,a=this._bboxMax.y-this._bboxMin.y;if(!(s<=0||a<=0)){var l=(this._p1.x-this._p0.x)*(this._p2.y-this._p0.y)-(this._p1.y-this._p0.y)*(this._p2.x-this._p0.x);if(!(l<0))for(var h=-(this._p2.y-this._p1.y)/l,c=-(this._p0.y-this._p2.y)/l,u=-(this._p1.y-this._p0.y)/l,p=(this._p2.x-this._p1.x)/l,d=(this._p0.x-this._p2.x)/l,f=(this._p1.x-this._p0.x)/l,_=((this._p2.x-this._p1.x)*(this._bboxMin.y-this._p1.y)-(this._p2.y-this._p1.y)*(this._bboxMin.x-this._p1.x))/l,g=((this._p0.x-this._p2.x)*(this._bboxMin.y-this._p2.y)-(this._p0.y-this._p2.y)*(this._bboxMin.x-this._p2.x))/l,m=((this._p1.x-this._p0.x)*(this._bboxMin.y-this._p0.y)-(this._p1.y-this._p0.y)*(this._bboxMin.x-this._p0.x))/l,y=0,v=0,b=this._bboxMin.x;b<=this._bboxMax.x;b++){for(var x=this._bboxMin.y;x<=this._bboxMax.y;x++)if(this._barycentric.x=_+h*y+p*v,this._barycentric.y=g+c*y+d*v,this._barycentric.z=m+u*y+f*v,v+=1,!(this._barycentric.x<0||this._barycentric.y<0||this._barycentric.z<0)){b!=this._bboxMax.x&&(this._barycentricRight.x=this._barycentric.x+h,this._barycentricRight.y=this._barycentric.y+c,this._barycentricRight.z=this._barycentric.z+u,this._barycentricRight.x/=this._project.x,this._barycentricRight.y/=this._project.y,this._barycentricRight.z/=this._project.z,this._barycentricRight.scaleBy(1/(this._barycentricRight.x+this._barycentricRight.y+this._barycentricRight.z))),x!=this._bboxMax.y&&(this._barycentricBottom.x=this._barycentric.x+p,this._barycentricBottom.y=this._barycentric.y+d,this._barycentricBottom.z=this._barycentric.z+f,this._barycentricBottom.x/=this._project.x,this._barycentricBottom.y/=this._project.y,this._barycentricBottom.z/=this._project.z,this._barycentricBottom.scaleBy(1/(this._barycentricBottom.x+this._barycentricBottom.y+this._barycentricBottom.z)));var A=b%this._activeBufferColor.width+x*this._activeBufferColor.width,E=(this._barycentric.x*this._p0.z+this._barycentric.y*this._p1.z+this._barycentric.z*this._p2.z)/(this._barycentric.x+this._barycentric.y+this._barycentric.z);if(this._barycentric.x/=this._project.x,this._barycentric.y/=this._project.y,this._barycentric.z/=this._project.z,this._barycentric.scaleBy(1/(this._barycentric.x+this._barycentric.y+this._barycentric.z)),this._depthCompareModeSoftware[this._depthCompareMode](E,this._activeBufferZ[A])){var S=this._program.fragment(this,this._barycentric,this._barycentricRight,this._barycentricBottom,r,n,o,E);S.discard||(this._writeDepth&&(this._activeBufferZ[A]=E),this._source[0]=255*S.outputColor[0],this._source[1]=255*S.outputColor[1],this._source[2]=255*S.outputColor[2],this._source[3]=255*S.outputColor[3],this._activeBufferColor.getPixelData(b,x,this._dest),this._putPixel(b,x))}}v=0,y+=1}}}},t.prototype._putPixel=function(t,e){this._blendModeSoftware[this._blendDestination](this._destComp,this._dest,this._dest,this._source),this._blendModeSoftware[this._blendSource](this._sourceComp,this._source,this._dest,this._source),this._rgba[0]=this._sourceComp[0]+this._destComp[0],this._rgba[1]=this._sourceComp[1]+this._destComp[1],this._rgba[2]=this._sourceComp[2]+this._destComp[2],this._rgba[3]=this._sourceComp[3]+this._destComp[3],this._activeBufferColor.setPixelData(t,e,this._rgba)},t.prototype.createCubeTexture=function(t,e,i,r){return new CubeTextureSoftware(t)},t.prototype.createIndexBuffer=function(t){return new IndexBufferSoftware(t)},t.prototype.createProgram=function(){return new ProgramSoftware},t.prototype.createTexture=function(t,e,i,r,n){return new TextureSoftware(t,e)},t.prototype.createVertexBuffer=function(t,e){return new VertexBufferSoftware(t,e)},t.prototype.dispose=function(){},t.prototype.setBlendFactors=function(t,e){this._blendSource=t,this._blendDestination=e},t.prototype.setColorMask=function(t,e,i,r){this._colorMaskR=t,this._colorMaskG=e,this._colorMaskB=i,this._colorMaskA=r},t.prototype.setStencilActions=function(t,e,i,r,n,o){void 0===t&&(t=ContextGLTriangleFace.FRONT_AND_BACK),void 0===e&&(e=ContextGLCompareMode.ALWAYS),void 0===i&&(i=ContextGLStencilAction.KEEP),void 0===r&&(r=ContextGLStencilAction.KEEP),void 0===n&&(n=ContextGLStencilAction.KEEP),void 0===o&&(o=CoordinateSystem.LEFT_HANDED)},t.prototype.setStencilReferenceValue=function(t,e,i){},t.prototype.setCulling=function(t,e){this._cullingMode=t},t.prototype.setDepthTest=function(t,e){this._writeDepth=t,this._depthCompareMode=e},t.prototype.setProgram=function(t){this._program=t},t.prototype.setProgramConstantsFromArray=function(t,e){var i;t==ContextGLProgramType.VERTEX?i=this._vertexConstants=new Float32Array(e.length):t==ContextGLProgramType.FRAGMENT&&(i=this._fragmentConstants=new Float32Array(e.length)),i.set(e)},t.prototype.setTextureAt=function(t,e){this._textures[t]=e},t.prototype.setVertexBufferAt=function(t,e,i,r){this._vertexBuffers[t]=e,this._vertexBufferOffsets[t]=i,this._vertexBufferFormats[t]=r},t.prototype.present=function(){this._backBufferColor.unlock(),this._frontBuffer.fillRect(this._frontBuffer.rect,0),this._frontBuffer.drawBitmap(this._backBufferColor.data,0,0,this._backBufferColor.width,this._backBufferColor.height,this._frontBufferMatrix),document&&document.body&&(this._frontBufferImageData.data.set(this._frontBuffer.data),this._frontBufferContext.putImageData(this._frontBufferImageData,0,0))},t.prototype.drawToBitmapImage2D=function(t){t.setPixels(this._activeBufferColor.rect,this._activeBufferColor.data)},t.prototype._interpolateVertexPair=function(t,e,i,r){for(var n=0;n<e.length;n++){var o=e[n]-i[n];r[n]=i[n]+o*t}},t.prototype.clamp=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),Math.max(e,Math.min(t,i))},t.prototype.interpolate=function(t,e,i){return t+(e-t)*this.clamp(i)},t.prototype.drawVertices=function(t,e,i){},t.prototype.setScissorRectangle=function(t){},t.prototype.setSamplerStateAt=function(t,e,i,r){var n=this._samplerStates[t];n||(n=this._samplerStates[t]=new SoftwareSamplerState),n.wrap=e,n.filter=i,n.mipfilter=r},t.prototype.enableStencil=function(){},t.prototype.disableStencil=function(){},Object.defineProperty(t.prototype,"frontBuffer",{get:function(){return this._frontBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),t.prototype.clear=function(t,e,i,r,n,o,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===s&&(s=ContextGLClearMask.ALL),this._backBufferColor.lock(),s&ContextGLClearMask.COLOR&&this._backBufferColor.fillRect(this._backBufferRect,ColorUtils.ARGBtoFloat32(255*r,255*t,255*e,255*i)),s&ContextGLClearMask.DEPTH&&this._backBufferZ.set(this._backBufferZClear)},t.MAX_SAMPLERS=8,t}(),TextureBaseWebGL=function(){function t(t){this.textureType="",this._gl=t}return t.prototype.dispose=function(){this._gl.deleteTexture(this._glTexture)},Object.defineProperty(t.prototype,"glTexture",{get:function(){return this._glTexture},enumerable:!0,configurable:!0}),t.prototype.generateMipmaps=function(){throw new AbstractMethodError},t}(),CubeTextureWebGL=function(t){function e(e,i){var r=t.call(this,e)||this;return r._textureSelectorDictionary=new Array(6),r.textureType="textureCube",r._size=i,r._glTexture=r._gl.createTexture(),r._textureSelectorDictionary[0]=e.TEXTURE_CUBE_MAP_POSITIVE_X,r._textureSelectorDictionary[1]=e.TEXTURE_CUBE_MAP_NEGATIVE_X,r._textureSelectorDictionary[2]=e.TEXTURE_CUBE_MAP_POSITIVE_Y,r._textureSelectorDictionary[3]=e.TEXTURE_CUBE_MAP_NEGATIVE_Y,r._textureSelectorDictionary[4]=e.TEXTURE_CUBE_MAP_POSITIVE_Z,r._textureSelectorDictionary[5]=e.TEXTURE_CUBE_MAP_NEGATIVE_Z,r}return __extends(e,t),e.prototype.uploadFromArray=function(t,e,i){if(void 0===i&&(i=0),t.length!=this._size*this._size*4)throw new Error("Array is not the correct length for texture dimensions");t instanceof Array&&(t=new Uint8Array(t)),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._glTexture),this._gl.texImage2D(this._textureSelectorDictionary[e],i,this._gl.RGBA,this._size,this._size,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)},e.prototype.uploadCompressedTextureFromArray=function(t,e,i){},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype.generateMipmaps=function(){this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,this._glTexture),this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP)},e}(TextureBaseWebGL),IndexBufferWebGL=function(){function t(t,e){this._gl=t,this._buffer=this._gl.createBuffer(),this._numIndices=e}return t.prototype.uploadFromArray=function(t,e,i){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer),e?this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,2*e,t):this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,t,this._gl.STATIC_DRAW)},t.prototype.uploadFromByteArray=function(t,e,i){this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._buffer),e?this._gl.bufferSubData(this._gl.ELEMENT_ARRAY_BUFFER,2*e,t):this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,t,this._gl.STATIC_DRAW)},t.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)},Object.defineProperty(t.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(),ProgramWebGL=function(){function t(t){this._uniforms=[[],[],[]],this._attribs=[],this._gl=t,this._program=this._gl.createProgram()}return t.prototype.upload=function(e,i){var r=0!=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT).precision?"highp":"mediump",n=0!=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT).precision?"highp":"mediump",o=t._aglslParser.parse(t._tokenizer.decribeAGALByteArray(e),r),s=t._aglslParser.parse(t._tokenizer.decribeAGALByteArray(i),n);if(this._vertexShader=this._gl.createShader(this._gl.VERTEX_SHADER),this._fragmentShader=this._gl.createShader(this._gl.FRAGMENT_SHADER),this._gl.shaderSource(this._vertexShader,o),this._gl.compileShader(this._vertexShader),!this._gl.getShaderParameter(this._vertexShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._vertexShader));if(this._gl.shaderSource(this._fragmentShader,s),this._gl.compileShader(this._fragmentShader),!this._gl.getShaderParameter(this._fragmentShader,this._gl.COMPILE_STATUS))throw new Error(this._gl.getShaderInfoLog(this._fragmentShader));if(this._gl.attachShader(this._program,this._vertexShader),this._gl.attachShader(this._program,this._fragmentShader),this._gl.linkProgram(this._program),!this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS))throw new Error(this._gl.getProgramInfoLog(this._program));this._uniforms[0].length=0,this._uniforms[1].length=0,this._uniforms[2].length=0,this._attribs.length=0},t.prototype.getUniformLocation=function(e,i){if(void 0===i&&(i=-1),null!=this._uniforms[e][i+1])return this._uniforms[e][i+1];var r=-1==i?t._uniformLocationNameDictionary[e]:t._uniformLocationNameDictionary[e]+i;return this._uniforms[e][i+1]=this._gl.getUniformLocation(this._program,r)},t.prototype.getAttribLocation=function(t){return null!=this._attribs[t]?this._attribs[t]:this._attribs[t]=this._gl.getAttribLocation(this._program,"va"+t)},t.prototype.dispose=function(){this._gl.deleteProgram(this._program)},t.prototype.focusProgram=function(){this._gl.useProgram(this._program)},Object.defineProperty(t.prototype,"glProgram",{get:function(){return this._program},enumerable:!0,configurable:!0}),t._tokenizer=new AGALTokenizer,t._aglslParser=new AGLSLParser,t._uniformLocationNameDictionary=["fc","fs","vc"],t}(),TextureWebGL=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.textureType="texture2d",n._frameBuffer=[],n._frameBufferDraw=[],n._renderBuffer=[],n._renderBufferDepth=[],n._width=i,n._height=r,n._glTexture=n._gl.createTexture(),n}return __extends(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.setFrameBuffer=function(t,e,i,r){void 0===t&&(t=!1),void 0===e&&(e=0),void 0===r&&(r=0),this._gl instanceof WebGLRenderingContext&&(r=0);var n=this._width>>>r,o=this._height>>>r;if(this._mipmapSelector=r,this._frameBuffer[r])this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._frameBuffer[r]);else{var s=this._frameBuffer[r]=this._gl.createFramebuffer();this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,s);var a=this._renderBufferDepth[r]=this._gl.createRenderbuffer();if(this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,a),this._gl instanceof WebGLRenderingContext)this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,n,o,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,a),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_STENCIL,this._width,this._height),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._glTexture,0),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_STENCIL_ATTACHMENT,this._gl.RENDERBUFFER,a),this._gl.bindTexture(this._gl.TEXTURE_2D,null);else{this._gl.renderbufferStorageMultisample(this._gl.RENDERBUFFER,e,this._gl.DEPTH24_STENCIL8,n,o),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_STENCIL_ATTACHMENT,this._gl.RENDERBUFFER,a);var l=this._renderBuffer[r]=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,l),this._gl.renderbufferStorageMultisample(this._gl.RENDERBUFFER,e,this._gl.RGBA8,n,o),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.RENDERBUFFER,l)}this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null)}t?(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST)):(this._gl.disable(this._gl.STENCIL_TEST),this._gl.disable(this._gl.DEPTH_TEST)),this._gl.viewport(0,0,n,o)},e.prototype.presentFrameBuffer=function(){if(!(this._gl instanceof WebGLRenderingContext)){var t=this._width>>>this._mipmapSelector,e=this._height>>>this._mipmapSelector;this._frameBufferDraw[this._mipmapSelector]||(this._frameBufferDraw[this._mipmapSelector]=this._gl.createFramebuffer()),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._frameBufferDraw[this._mipmapSelector]),this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._texStorageFlag||(this._gl.texStorage2D(this._gl.TEXTURE_2D,Math.log(Math.min(this._width,this._height))/Math.LN2+1,this._gl.RGBA8,t,e),this._texStorageFlag=!0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._glTexture,this._mipmapSelector),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindFramebuffer(this._gl.READ_FRAMEBUFFER,this._frameBuffer[this._mipmapSelector]),this._gl.bindFramebuffer(this._gl.DRAW_FRAMEBUFFER,this._frameBufferDraw[this._mipmapSelector]),this._gl.clearBufferfv(this._gl.COLOR,0,[0,0,0,0]),this._gl.blitFramebuffer(0,0,t,e,0,0,t,e,this._gl.COLOR_BUFFER_BIT,this._gl.NEAREST)}},e.prototype.uploadFromArray=function(t,e){void 0===e&&(e=0);for(var i=this._width,r=this._height,n=0;n<e;n++)i*=.5,r*=.5;if(t.length!=Math.floor(i)*Math.floor(r)*4)throw new Error("Array is not the correct length for texture dimensions");t instanceof Array&&(t=new Uint8Array(t)),this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,e,this._gl.RGBA,i,r,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},e.prototype.uploadFromURL=function(t,e){this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._width,this._height,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.bindTexture(this._gl.TEXTURE_2D,null)},e.prototype.uploadCompressedTextureFromArray=function(t,e,i){this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc")},e.prototype.generateMipmaps=function(){this._gl.bindTexture(this._gl.TEXTURE_2D,this._glTexture),this._gl.generateMipmap(this._gl.TEXTURE_2D)},e}(TextureBaseWebGL),VertexBufferWebGL=function(){function t(t,e,i){this._gl=t,this._buffer=this._gl.createBuffer(),this._numVertices=e,this._dataPerVertex=i}return t.prototype.uploadFromArray=function(t,e,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer),e?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e*this._dataPerVertex,t):this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW)},t.prototype.uploadFromByteArray=function(t,e,i){this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._buffer),e?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e*this._dataPerVertex,t):this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW)},Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataPerVertex",{get:function(){return this._dataPerVertex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glBuffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._gl.deleteBuffer(this._buffer)},t}(),ContextWebGL=function(){function t(t,e){void 0===e&&(e=!1),this._blendFactorDictionary=new Object,this._drawModeDictionary=new Object,this._compareModeDictionary=new Object,this._stencilActionDictionary=new Object,this._textureIndexDictionary=new Array(8),this._textureTypeDictionary=new Object,this._wrapDictionary=new Object,this._filterDictionary=new Object,this._mipmapFilterDictionary=new Object,this._vertexBufferPropertiesDictionary=[],this._drawing=!0,this._samplerStates=new Array(8),this._stencilReferenceValue=0,this._stencilReadMask=255,this._separateStencil=!1,this._container=t,this.initWebGL(e)}return Object.defineProperty(t.prototype,"glVersion",{get:function(){return this._glVersion},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return this._pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t,this.initWebGL()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDerivatives",{get:function(){return this._standardDerivatives},enumerable:!0,configurable:!0}),t.prototype.initWebGL=function(e){void 0===e&&(e=!1);var i={alpha:e,stencil:!0};try{this._gl=this._container.getContext("webgl2",i),this._gl?this._glVersion=2:(this._gl=this._container.getContext("webgl",i)||this._container.getContext("experimental-webgl",i),this._glVersion=1)}catch(t){}if(this._gl){this._gl.getExtension("OES_standard_derivatives")?this._standardDerivatives=!0:this._standardDerivatives=!1,this._blendFactorDictionary[ContextGLBlendFactor.ONE]=this._gl.ONE,this._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_ALPHA]=this._gl.DST_ALPHA,this._blendFactorDictionary[ContextGLBlendFactor.DESTINATION_COLOR]=this._gl.DST_COLOR,this._blendFactorDictionary[ContextGLBlendFactor.ONE]=this._gl.ONE,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_ALPHA]=this._gl.ONE_MINUS_DST_ALPHA,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_DESTINATION_COLOR]=this._gl.ONE_MINUS_DST_COLOR,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA]=this._gl.ONE_MINUS_SRC_ALPHA,this._blendFactorDictionary[ContextGLBlendFactor.ONE_MINUS_SOURCE_COLOR]=this._gl.ONE_MINUS_SRC_COLOR,this._blendFactorDictionary[ContextGLBlendFactor.SOURCE_ALPHA]=this._gl.SRC_ALPHA,this._blendFactorDictionary[ContextGLBlendFactor.SOURCE_COLOR]=this._gl.SRC_COLOR,this._blendFactorDictionary[ContextGLBlendFactor.ZERO]=this._gl.ZERO,this._drawModeDictionary[ContextGLDrawMode.LINES]=this._gl.LINES,this._drawModeDictionary[ContextGLDrawMode.TRIANGLES]=this._gl.TRIANGLES,this._compareModeDictionary[ContextGLCompareMode.ALWAYS]=this._gl.ALWAYS,this._compareModeDictionary[ContextGLCompareMode.EQUAL]=this._gl.EQUAL,this._compareModeDictionary[ContextGLCompareMode.GREATER]=this._gl.GREATER,this._compareModeDictionary[ContextGLCompareMode.GREATER_EQUAL]=this._gl.GEQUAL,this._compareModeDictionary[ContextGLCompareMode.LESS]=this._gl.LESS,this._compareModeDictionary[ContextGLCompareMode.LESS_EQUAL]=this._gl.LEQUAL,this._compareModeDictionary[ContextGLCompareMode.NEVER]=this._gl.NEVER,this._compareModeDictionary[ContextGLCompareMode.NOT_EQUAL]=this._gl.NOTEQUAL,this._stencilActionDictionary[ContextGLStencilAction.DECREMENT_SATURATE]=this._gl.DECR,this._stencilActionDictionary[ContextGLStencilAction.DECREMENT_WRAP]=this._gl.DECR_WRAP,this._stencilActionDictionary[ContextGLStencilAction.INCREMENT_SATURATE]=this._gl.INCR,this._stencilActionDictionary[ContextGLStencilAction.INCREMENT_WRAP]=this._gl.INCR_WRAP,this._stencilActionDictionary[ContextGLStencilAction.INVERT]=this._gl.INVERT,this._stencilActionDictionary[ContextGLStencilAction.KEEP]=this._gl.KEEP,this._stencilActionDictionary[ContextGLStencilAction.SET]=this._gl.REPLACE,this._stencilActionDictionary[ContextGLStencilAction.ZERO]=this._gl.ZERO,this._textureIndexDictionary[0]=this._gl.TEXTURE0,this._textureIndexDictionary[1]=this._gl.TEXTURE1,this._textureIndexDictionary[2]=this._gl.TEXTURE2,this._textureIndexDictionary[3]=this._gl.TEXTURE3,this._textureIndexDictionary[4]=this._gl.TEXTURE4,this._textureIndexDictionary[5]=this._gl.TEXTURE5,this._textureIndexDictionary[6]=this._gl.TEXTURE6,this._textureIndexDictionary[7]=this._gl.TEXTURE7,this._textureTypeDictionary.texture2d=this._gl.TEXTURE_2D,this._textureTypeDictionary.textureCube=this._gl.TEXTURE_CUBE_MAP,this._wrapDictionary[ContextGLWrapMode.REPEAT]=this._gl.REPEAT,this._wrapDictionary[ContextGLWrapMode.CLAMP]=this._gl.CLAMP_TO_EDGE,this._filterDictionary[ContextGLTextureFilter.LINEAR]=this._gl.LINEAR,this._filterDictionary[ContextGLTextureFilter.NEAREST]=this._gl.NEAREST,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR]=new Object,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNEAREST]=this._gl.LINEAR_MIPMAP_NEAREST,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPLINEAR]=this._gl.LINEAR_MIPMAP_LINEAR,this._mipmapFilterDictionary[ContextGLTextureFilter.LINEAR][ContextGLMipFilter.MIPNONE]=this._gl.LINEAR,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST]=new Object,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNEAREST]=this._gl.NEAREST_MIPMAP_NEAREST,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPLINEAR]=this._gl.NEAREST_MIPMAP_LINEAR,this._mipmapFilterDictionary[ContextGLTextureFilter.NEAREST][ContextGLMipFilter.MIPNONE]=this._gl.NEAREST,this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.FLOAT_1]=new VertexBufferProperties(1,this._gl.FLOAT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.FLOAT_2]=new VertexBufferProperties(2,this._gl.FLOAT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.FLOAT_3]=new VertexBufferProperties(3,this._gl.FLOAT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.FLOAT_4]=new VertexBufferProperties(4,this._gl.FLOAT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.BYTE_1]=new VertexBufferProperties(1,this._gl.BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.BYTE_2]=new VertexBufferProperties(2,this._gl.BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.BYTE_3]=new VertexBufferProperties(3,this._gl.BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.BYTE_4]=new VertexBufferProperties(4,this._gl.BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_BYTE_1]=new VertexBufferProperties(1,this._gl.UNSIGNED_BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_BYTE_2]=new VertexBufferProperties(2,this._gl.UNSIGNED_BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_BYTE_3]=new VertexBufferProperties(3,this._gl.UNSIGNED_BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_BYTE_4]=new VertexBufferProperties(4,this._gl.UNSIGNED_BYTE,!0),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.SHORT_1]=new VertexBufferProperties(1,this._gl.SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.SHORT_2]=new VertexBufferProperties(2,this._gl.SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.SHORT_3]=new VertexBufferProperties(3,this._gl.SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.SHORT_4]=new VertexBufferProperties(4,this._gl.SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_SHORT_1]=new VertexBufferProperties(1,this._gl.UNSIGNED_SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_SHORT_2]=new VertexBufferProperties(2,this._gl.UNSIGNED_SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_SHORT_3]=new VertexBufferProperties(3,this._gl.UNSIGNED_SHORT,!1),this._vertexBufferPropertiesDictionary[ContextGLVertexBufferFormat.UNSIGNED_SHORT_4]=new VertexBufferProperties(4,this._gl.UNSIGNED_SHORT,!1),this._stencilCompareMode=this._gl.ALWAYS,this._stencilCompareModeBack=this._gl.ALWAYS,this._stencilCompareModeFront=this._gl.ALWAYS;var r=window.devicePixelRatio||1,n=this._gl.webkitBackingStorePixelRatio||this._gl.mozBackingStorePixelRatio||this._gl.msBackingStorePixelRatio||this._gl.oBackingStorePixelRatio||this._gl.backingStorePixelRatio||1;this._pixelRatio=r/n}else alert("WebGL is not available.");for(var o=0;o<t.MAX_SAMPLERS;++o)this._samplerStates[o]=new SamplerState,this._samplerStates[o].wrap=this._gl.REPEAT,this._samplerStates[o].filter=this._gl.LINEAR,this._samplerStates[o].mipfilter=this._gl.LINEAR},t.prototype.gl=function(){return this._gl},t.prototype.clear=function(t,e,i,r,n,o,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=ContextGLClearMask.ALL),this._drawing||(this.updateBlendStatus(),this._drawing=!0);var a=0;s&ContextGLClearMask.COLOR&&(a|=this._gl.COLOR_BUFFER_BIT),s&ContextGLClearMask.STENCIL&&(a|=this._gl.STENCIL_BUFFER_BIT),s&ContextGLClearMask.DEPTH&&(a|=this._gl.DEPTH_BUFFER_BIT),this._gl.clearColor(t,e,i,r),this._gl.clearDepth(n),this._gl.clearStencil(o),this._gl.clear(a)},t.prototype.configureBackBuffer=function(t,e,i,r){void 0===r&&(r=!0),this._width=t*this._pixelRatio,this._height=e*this._pixelRatio,r?(this._gl.enable(this._gl.STENCIL_TEST),this._gl.enable(this._gl.DEPTH_TEST)):(this._gl.disable(this._gl.STENCIL_TEST),this._gl.disable(this._gl.DEPTH_TEST)),this._gl.viewport(0,0,this._width,this._height)},t.prototype.createCubeTexture=function(t,e,i,r){return new CubeTextureWebGL(this._gl,t)},t.prototype.createIndexBuffer=function(t){return new IndexBufferWebGL(this._gl,t)},t.prototype.createProgram=function(){return new ProgramWebGL(this._gl)},t.prototype.createTexture=function(t,e,i,r,n){return new TextureWebGL(this._gl,t,e)},t.prototype.createVertexBuffer=function(t,e){return new VertexBufferWebGL(this._gl,t,e)},t.prototype.dispose=function(){for(var t=0;t<this._samplerStates.length;++t)this._samplerStates[t]=null},t.prototype.drawToBitmapImage2D=function(t){var e=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e),t.setPixels(new Rectangle(0,0,t.width,t.height),new Uint8ClampedArray(e.buffer))},t.prototype.drawIndices=function(t,e,i,r){if(void 0===i&&(i=0),void 0===r&&(r=-1),!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";if(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,e.glBuffer),window.awayDebugDrawing)for(var n=0;n<r;n+=3)this._gl.drawElements(this._gl.LINE_LOOP,3,this._gl.UNSIGNED_SHORT,2*(i+n));else this._gl.drawElements(this._drawModeDictionary[t],-1==r?e.numIndices:r,this._gl.UNSIGNED_SHORT,2*i)},t.prototype.drawVertices=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=-1),!this._drawing)throw"Need to clear before drawing if the buffer has not been cleared since the last present() call.";if(0!=i)if(window.awayDebugDrawing)for(var r=0;r<i;r+=3)this._gl.drawArrays(this._gl.LINE_LOOP,e+r,3);else try{this._gl.drawArrays(this._drawModeDictionary[t],e,i)}catch(t){console.log(t)}},t.prototype.present=function(){},t.prototype.setBlendFactors=function(t,e){this._blendEnabled=!0,this._blendSourceFactor=this._blendFactorDictionary[t],this._blendDestinationFactor=this._blendFactorDictionary[e],this.updateBlendStatus()},t.prototype.setColorMask=function(t,e,i,r){this._gl.colorMask(t,e,i,r)},t.prototype.setCulling=function(t,e){void 0===e&&(e=CoordinateSystem.LEFT_HANDED),t==ContextGLTriangleFace.NONE?this._gl.disable(this._gl.CULL_FACE):(this._gl.enable(this._gl.CULL_FACE),this._gl.cullFace(this.translateTriangleFace(t,e)))},t.prototype.setDepthTest=function(t,e){this._gl.depthFunc(this._compareModeDictionary[e]),this._gl.depthMask(t)},t.prototype.enableStencil=function(){this._gl.enable(this._gl.STENCIL_TEST)},t.prototype.disableStencil=function(){this._gl.disable(this._gl.STENCIL_TEST)},t.prototype.setStencilActions=function(t,e,i,r,n,o){void 0===t&&(t=ContextGLTriangleFace.FRONT_AND_BACK),void 0===e&&(e=ContextGLCompareMode.ALWAYS),void 0===i&&(i=ContextGLStencilAction.KEEP),void 0===r&&(r=ContextGLStencilAction.KEEP),void 0===n&&(n=ContextGLStencilAction.KEEP),void 0===o&&(o=CoordinateSystem.LEFT_HANDED),this._separateStencil=t!=ContextGLTriangleFace.FRONT_AND_BACK;var s=this._compareModeDictionary[e],a=this._stencilActionDictionary[n],l=this._stencilActionDictionary[r],h=this._stencilActionDictionary[i];this._separateStencil?t==ContextGLTriangleFace.BACK?(this._stencilCompareModeBack=s,this._gl.stencilFuncSeparate(this._gl.BACK,s,this._stencilReferenceValue,this._stencilReadMask),this._gl.stencilOpSeparate(this._gl.BACK,a,l,h)):t==ContextGLTriangleFace.FRONT&&(this._stencilCompareModeFront=s,this._gl.stencilFuncSeparate(this._gl.FRONT,s,this._stencilReferenceValue,this._stencilReadMask),this._gl.stencilOpSeparate(this._gl.FRONT,a,l,h)):(this._stencilCompareMode=s,this._gl.stencilFunc(s,this._stencilReferenceValue,this._stencilReadMask),this._gl.stencilOp(a,l,h))},t.prototype.setStencilReferenceValue=function(t,e,i){void 0===e&&(e=255),void 0===i&&(i=255),this._stencilReferenceValue=t,this._stencilReadMask=e,this._separateStencil?(this._gl.stencilFuncSeparate(this._gl.FRONT,this._stencilCompareModeFront,t,e),this._gl.stencilFuncSeparate(this._gl.BACK,this._stencilCompareModeBack,t,e)):this._gl.stencilFunc(this._stencilCompareMode,t,e),this._gl.stencilMask(i)},t.prototype.setProgram=function(t){this._currentProgram=t,t.focusProgram()},t.prototype.setProgramConstantsFromArray=function(t,e){e.length&&this._gl.uniform4fv(this._currentProgram.getUniformLocation(t),e)},t.prototype.setScissorRectangle=function(t){t?(this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(t.x*this._pixelRatio,this._height-(t.y+t.height)*this._pixelRatio,t.width*this._pixelRatio,t.height*this._pixelRatio)):this._gl.disable(this._gl.SCISSOR_TEST)},t.prototype.setTextureAt=function(t,e){var i=this._samplerStates[t];if(this._activeTexture!=t&&(e||i.type)&&(this._activeTexture=t,this._gl.activeTexture(this._textureIndexDictionary[t])),e){var r=this._textureTypeDictionary[e.textureType];i.type=r,this._gl.bindTexture(r,e.glTexture),this._gl.uniform1i(this._currentProgram.getUniformLocation(ContextGLProgramType.SAMPLER,t),t),this._gl.texParameteri(r,this._gl.TEXTURE_WRAP_S,i.wrap),this._gl.texParameteri(r,this._gl.TEXTURE_WRAP_T,i.wrap),this._gl.texParameteri(r,this._gl.TEXTURE_MAG_FILTER,i.filter),this._gl.texParameteri(r,this._gl.TEXTURE_MIN_FILTER,i.mipfilter)}else i.type&&(this._gl.bindTexture(i.type,null),i.type=null)},t.prototype.setSamplerStateAt=function(e,i,r,n){if(!(0<=e&&e<t.MAX_SAMPLERS))throw"Sampler is out of bounds.";this._samplerStates[e].wrap=this._wrapDictionary[i],this._samplerStates[e].filter=this._filterDictionary[r],this._samplerStates[e].mipfilter=this._mipmapFilterDictionary[r][n]},t.prototype.setVertexBufferAt=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=4);var n=this._currentProgram?this._currentProgram.getAttribLocation(t):-1;if(e){this._currentArrayBuffer!=e&&(this._currentArrayBuffer=e,this._gl.bindBuffer(this._gl.ARRAY_BUFFER,e?e.glBuffer:null));var o=this._vertexBufferPropertiesDictionary[r];this._gl.enableVertexAttribArray(n),this._gl.vertexAttribPointer(n,o.size,o.type,o.normalized,e.dataPerVertex,i)}else n>-1&&this._gl.disableVertexAttribArray(n)},t.prototype.setRenderToTexture=function(t,e,i,r,n){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this._renderTarget&&this._renderTarget.presentFrameBuffer(),this._renderTarget=t,this._renderTarget.setFrameBuffer(e,i,r,n)},t.prototype.setRenderToBackBuffer=function(){this._renderTarget&&(this._renderTarget.presentFrameBuffer(),this._renderTarget=null),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},t.prototype.copyToTexture=function(t,e,i){this._gl.bindTexture(this._gl.TEXTURE_2D,t.glTexture),this._gl.copyTexSubImage2D(this._gl.TEXTURE_2D,0,i.x,i.y,e.x,e.y,e.width,e.height)},t.prototype.updateBlendStatus=function(){this._blendEnabled?(this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._blendSourceFactor,this._blendDestinationFactor)):this._gl.disable(this._gl.BLEND)},t.prototype.translateTriangleFace=function(t,e){switch(t){case ContextGLTriangleFace.BACK:return e==CoordinateSystem.LEFT_HANDED?this._gl.FRONT:this._gl.BACK;case ContextGLTriangleFace.FRONT:return e==CoordinateSystem.LEFT_HANDED?this._gl.BACK:this._gl.FRONT;case ContextGLTriangleFace.FRONT_AND_BACK:return this._gl.FRONT_AND_BACK;default:throw"Unknown ContextGLTriangleFace type."}},t.MAX_SAMPLERS=8,t.modulo=0,t}(),VertexBufferProperties=function(t,e,i){this.size=t,this.type=e,this.normalized=i},ShaderRegisterElement=function(){function t(e,i,r){void 0===r&&(r=-1),this._component=r,this._regName=e,this._index=i,this._toStr=this._regName,this._index>=0&&(this._toStr+=this._index),r>-1&&(this._toStr+="."+t.COMPONENTS[r])}return t.prototype.toString=function(){return this._toStr},Object.defineProperty(t.prototype,"regName",{get:function(){return this._regName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),t.COMPONENTS=["x","y","z","w"],t}(),RegisterPool=function(){function t(t,e,i){void 0===i&&(i=!0),this._regName=t,this._regCount=e,this._persistent=i,this.initRegisters(t,e)}return t.prototype.requestFreeVectorReg=function(){for(var t=0;t<this._regCount;++t)if(!this.isRegisterUsed(t))return this._persistent&&this._usedVectorCount[t]++,this._vectorRegisters[t];throw new Error("Register overflow!")},t.prototype.requestFreeRegComponent=function(){for(var t=0;t<this._regCount;++t)if(!(this._usedVectorCount[t]>0))for(var e=0;e<4;++e)if(0==this._usedSingleCount[e][t])return this._persistent&&this._usedSingleCount[e][t]++,this._registerComponents[e][t];throw new Error("Register overflow!")},t.prototype.addUsage=function(t,e){t._component>-1?this._usedSingleCount[t._component][t.index]+=e:this._usedVectorCount[t.index]+=e},t.prototype.removeUsage=function(t){if(t._component>-1){if(--this._usedSingleCount[t._component][t.index]<0)throw new Error("More usages removed than exist!")}else if(--this._usedVectorCount[t.index]<0)throw new Error("More usages removed than exist!")},t.prototype.dispose=function(){this._vectorRegisters=null,this._registerComponents=null,this._usedSingleCount=null,this._usedVectorCount=null},t.prototype.hasRegisteredRegs=function(){for(var t=0;t<this._regCount;++t)if(this.isRegisterUsed(t))return!0;return!1},t.prototype.initRegisters=function(e,i){var r=t._initPool(e,i);this._vectorRegisters=t._regPool[r],this._registerComponents=t._regCompsPool[r],this._usedVectorCount=this._initArray(Array(i),0),this._usedSingleCount=new Array(4),this._usedSingleCount[0]=this._initArray(new Array(i),0),this._usedSingleCount[1]=this._initArray(new Array(i),0),this._usedSingleCount[2]=this._initArray(new Array(i),0),this._usedSingleCount[3]=this._initArray(new Array(i),0)},t._initPool=function(e,i){var r=e+i;if(null!=t._regPool[r])return r;var n=new Array(i);t._regPool[r]=n;var o=[[],[],[],[]];t._regCompsPool[r]=o;for(var s=0;s<i;++s){n[s]=new ShaderRegisterElement(e,s);for(var a=0;a<4;++a)o[a][s]=new ShaderRegisterElement(e,s,a)}return r},t.prototype.isRegisterUsed=function(t){if(this._usedVectorCount[t]>0)return!0;for(var e=0;e<4;++e)if(this._usedSingleCount[e][t]>0)return!0;return!1},t.prototype._initArray=function(t,e){for(var i=t.length,r=0;r<i;r++)t[r]=e;return t},t._regPool=new Object,t._regCompsPool=new Object,t}(),ShaderRegisterCache=function(){function t(t){this._numUsedVertexConstants=0,this._numUsedFragmentConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._profile=t,this.reset()}return t.prototype.reset=function(){this._fragmentTempCache=new RegisterPool("ft",8,!1),this._vertexTempCache=new RegisterPool("vt",8,!1),this._varyingCache=new RegisterPool("v",8),this._textureCache=new RegisterPool("fs",8),this._vertexAttributesCache=new RegisterPool("va",8),this._fragmentConstantsCache=new RegisterPool("fc",28),this._vertexConstantsCache=new RegisterPool("vc",128),this._fragmentOutputRegister=new ShaderRegisterElement("oc",-1),this._vertexOutputRegister=new ShaderRegisterElement("op",-1),this._numUsedVertexConstants=0,this._numUsedStreams=0,this._numUsedTextures=0,this._numUsedVaryings=0,this._numUsedFragmentConstants=0},t.prototype.dispose=function(){this._fragmentTempCache.dispose(),this._vertexTempCache.dispose(),this._varyingCache.dispose(),this._fragmentConstantsCache.dispose(),this._vertexAttributesCache.dispose(),this._fragmentTempCache=null,this._vertexTempCache=null,this._varyingCache=null,this._fragmentConstantsCache=null,this._vertexAttributesCache=null,this._fragmentOutputRegister=null,this._vertexOutputRegister=null},t.prototype.addFragmentTempUsages=function(t,e){this._fragmentTempCache.addUsage(t,e)},t.prototype.removeFragmentTempUsage=function(t){this._fragmentTempCache.removeUsage(t)},t.prototype.addVertexTempUsages=function(t,e){this._vertexTempCache.addUsage(t,e)},t.prototype.removeVertexTempUsage=function(t){this._vertexTempCache.removeUsage(t)},t.prototype.getFreeFragmentVectorTemp=function(){return this._fragmentTempCache.requestFreeVectorReg()},t.prototype.getFreeFragmentSingleTemp=function(){return this._fragmentTempCache.requestFreeRegComponent()},t.prototype.getFreeVarying=function(){return++this._numUsedVaryings,this._varyingCache.requestFreeVectorReg()},t.prototype.getFreeFragmentConstant=function(){return++this._numUsedFragmentConstants,this._fragmentConstantsCache.requestFreeVectorReg()},t.prototype.getFreeVertexConstant=function(){return++this._numUsedVertexConstants,this._vertexConstantsCache.requestFreeVectorReg()},t.prototype.getFreeVertexVectorTemp=function(){return this._vertexTempCache.requestFreeVectorReg()},t.prototype.getFreeVertexSingleTemp=function(){return this._vertexTempCache.requestFreeRegComponent()},t.prototype.getFreeVertexAttribute=function(){return++this._numUsedStreams,this._vertexAttributesCache.requestFreeVectorReg()},t.prototype.getFreeTextureReg=function(){return++this._numUsedTextures,this._textureCache.requestFreeVectorReg()},Object.defineProperty(t.prototype,"fragmentOutputRegister",{get:function(){return this._fragmentOutputRegister},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedVertexConstants",{get:function(){return this._numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedFragmentConstants",{get:function(){return this._numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedStreams",{get:function(){return this._numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedTextures",{get:function(){return this._numUsedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedVaryings",{get:function(){return this._numUsedVaryings},enumerable:!0,configurable:!0}),t}(),Filter3DTaskBase=function(){function t(t){void 0===t&&(t=!1),this._scaledTextureWidth=-1,this._scaledTextureHeight=-1,this._textureWidth=-1,this._textureHeight=-1,this._textureDimensionsInvalid=!0,this._program3DInvalid=!0,this._textureScale=1,this._requireDepthRender=t,this._registerCache=new ShaderRegisterCache(ContextGLProfile.BASELINE)}return Object.defineProperty(t.prototype,"textureScale",{get:function(){return this._textureScale},set:function(t){this._textureScale!=t&&(this._textureScale=t,this._scaledTextureWidth=this._textureWidth/this._textureScale,this._scaledTextureHeight=this._textureHeight/this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rttManager",{get:function(){return this._rttManager},set:function(t){this._rttManager!=t&&(this._rttManager=t,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(t){this._textureWidth!=t&&(this._textureWidth=t,this._scaledTextureWidth=this._textureWidth/this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(t){this._textureHeight!=t&&(this._textureHeight=t,this._scaledTextureHeight=this._textureHeight/this._textureScale,this._textureDimensionsInvalid=!0)},enumerable:!0,configurable:!0}),t.prototype.getMainInputTexture=function(t){return this._textureDimensionsInvalid&&this.updateTextures(t),this._mainInputTexture},t.prototype.dispose=function(){this._mainInputTexture&&this._mainInputTexture.dispose(),this._program3D&&this._program3D.dispose()},t.prototype.invalidateProgram=function(){this._program3DInvalid=!0},t.prototype.updateProgram=function(t){this._program3D&&this._program3D.dispose(),this._program3D=t.context.createProgram(),this._registerCache.reset();var e=(new AGALMiniAssembler).assemble("part vertex 1\n"+this.getVertexCode()+"endpart").vertex.data,i=(new AGALMiniAssembler).assemble("part fragment 1\n"+this.getFragmentCode()+"endpart").fragment.data;this._program3D.upload(e,i),this._program3DInvalid=!1},t.prototype.getVertexCode=function(){var t=this._registerCache.getFreeVertexAttribute();this._positionIndex=t.index;var e=this._registerCache.getFreeVertexAttribute();return this._uvIndex=e.index,this._uvVarying=this._registerCache.getFreeVarying(),"mov op, "+t+"\nmov "+this._uvVarying+", "+e+"\n"},t.prototype.getFragmentCode=function(){throw new AbstractMethodError},t.prototype.updateTextures=function(t){this._mainInputTexture&&this._mainInputTexture.dispose(),this._mainInputTexture=new Image2D(this._scaledTextureWidth,this._scaledTextureHeight),this._textureDimensionsInvalid=!1},t.prototype.getProgram=function(t){return this._program3DInvalid&&this.updateProgram(t),this._program3D},t.prototype.activate=function(t,e,i){},t.prototype.deactivate=function(t){},Object.defineProperty(t.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),t}(),Filter3DCopyPixelTask=function(t){function e(){var e=t.call(this)||this;return e.rect=new Rectangle,e.destPoint=new Point,e._vertexConstantData=new Float32Array([0,0,0,0]),e._fragmentConstantData=new Float32Array([0,0,0,0]),e}return __extends(e,t),Object.defineProperty(e.prototype,"sourceTexture",{get:function(){return this._mainInputTexture},set:function(t){this._mainInputTexture=t},enumerable:!0,configurable:!0}),e.prototype.getVertexCode=function(){var t=this._registerCache.getFreeVertexVectorTemp(),e=this._registerCache.getFreeVertexConstant(),i=this._registerCache.getFreeVertexAttribute();this._positionIndex=i.index;var r=this._registerCache.getFreeVertexAttribute();return this._uvIndex=r.index,this._uvVarying=this._registerCache.getFreeVarying(),"mul "+t+".xy, "+i+", "+e+".zw\nadd "+t+".xy, "+t+", "+e+".xy\nmov "+t+".w, "+i+".w\nmov op, "+t+"\nmov "+this._uvVarying+", "+r+"\n"},e.prototype.getFragmentCode=function(){var t=this._registerCache.getFreeFragmentVectorTemp(),e=this._registerCache.getFreeTextureReg();this._inputTextureIndex=e.index;var i=this._registerCache.getFreeFragmentConstant();return"add "+t+", "+this._uvVarying+", "+i+".xy\ntex "+t+", "+this._uvVarying+", "+e+" <2d,linear,clamp>\nmov oc, "+t+"\n"},e.prototype.getMainInputTexture=function(t){return this._mainInputTexture},e.prototype.activate=function(t,e,i){this._vertexConstantData[0]=(2*this.destPoint.x+this.rect.width)/this._target.width-1,this._vertexConstantData[1]=(2*this.destPoint.y+this.rect.height)/this._target.height-1,this._vertexConstantData[2]=this.rect.width/this._target.width,this._vertexConstantData[3]=this.rect.height/this._target.height,this._fragmentConstantData[0]=this.rect.x/this._mainInputTexture.width,this._fragmentConstantData[1]=this.rect.y/this._mainInputTexture.height;var r=t.context;r.setProgramConstantsFromArray(ContextGLProgramType.VERTEX,this._vertexConstantData),r.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,this._fragmentConstantData)},e.prototype.deactivate=function(t){},e}(Filter3DTaskBase),Filter3DBase=function(){function t(){this._textureScale=1,this._tasks=new Array}return Object.defineProperty(t.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),t.prototype.addTask=function(t){this._tasks.push(t),null==this._requireDepthRender&&(this._requireDepthRender=t.requireDepthRender)},Object.defineProperty(t.prototype,"tasks",{get:function(){return this._tasks},enumerable:!0,configurable:!0}),t.prototype.getMainInputTexture=function(t){return this._tasks[0].getMainInputTexture(t)},Object.defineProperty(t.prototype,"textureWidth",{get:function(){return this._textureWidth},set:function(t){this._textureWidth=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rttManager",{get:function(){return this._rttManager},set:function(t){this._rttManager=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].rttManager=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureHeight",{get:function(){return this._textureHeight},set:function(t){this._textureHeight=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureScale",{get:function(){return this._textureScale},set:function(t){this._textureScale=t;for(var e=0;e<this._tasks.length;++e)this._tasks[e].textureScale=t},enumerable:!0,configurable:!0}),t.prototype.setRenderTargets=function(t,e){this._tasks[this._tasks.length-1].target=t},t.prototype.dispose=function(){for(var t=0;t<this._tasks.length;++t)this._tasks[t].dispose()},t.prototype.update=function(t,e){},t}(),CopyPixelFilter3D=function(t){function e(){var e=t.call(this)||this;return e._copyPixelTask=new Filter3DCopyPixelTask,e.addTask(e._copyPixelTask),e}return __extends(e,t),Object.defineProperty(e.prototype,"rect",{get:function(){return this._copyPixelTask.rect},set:function(t){this._copyPixelTask.rect=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destPoint",{get:function(){return this._copyPixelTask.destPoint},set:function(t){this._copyPixelTask.destPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceTexture",{get:function(){return this._copyPixelTask.sourceTexture},set:function(t){this._copyPixelTask.sourceTexture=t},enumerable:!0,configurable:!0}),e}(Filter3DBase),Stage=function(t){function e(e,i,r,n,o){void 0===o&&(o=ContextGLProfile.BASELINE);var s=t.call(this)||this;return s._abstractionPool=new Object,s._programData=new Array,s._x=0,s._y=0,s._stageIndex=-1,s._antiAlias=4,s._renderTarget=null,s._renderSurfaceSelector=0,s._renderMipmapSelector=0,s._initialised=!1,s._bufferFormatDictionary=new Array(5),s.globalDisableMipmap=!1,s.globalDisableSmooth=!1,s._programDataPool=new ProgramDataPool(s),s._container=e,s._container&&(s._container.addEventListener("webglcontextlost",(function(t){return s.onContextLost(t)})),s._container.addEventListener("webglcontextrestored",(function(t){return s.onContextRestored(t)}))),s._stageIndex=i,s._stageManager=r,s._enableDepthAndStencil=!0,CSS.setElementX(s._container,0),CSS.setElementY(s._container,0),s._bufferFormatDictionary[1]=new Array(5),s._bufferFormatDictionary[1][1]=ContextGLVertexBufferFormat.BYTE_1,s._bufferFormatDictionary[1][2]=ContextGLVertexBufferFormat.BYTE_2,s._bufferFormatDictionary[1][3]=ContextGLVertexBufferFormat.BYTE_3,s._bufferFormatDictionary[1][4]=ContextGLVertexBufferFormat.BYTE_4,s._bufferFormatDictionary[2]=new Array(5),s._bufferFormatDictionary[2][1]=ContextGLVertexBufferFormat.SHORT_1,s._bufferFormatDictionary[2][2]=ContextGLVertexBufferFormat.SHORT_2,s._bufferFormatDictionary[2][3]=ContextGLVertexBufferFormat.SHORT_3,s._bufferFormatDictionary[2][4]=ContextGLVertexBufferFormat.SHORT_4,s._bufferFormatDictionary[4]=new Array(5),s._bufferFormatDictionary[4][1]=ContextGLVertexBufferFormat.FLOAT_1,s._bufferFormatDictionary[4][2]=ContextGLVertexBufferFormat.FLOAT_2,s._bufferFormatDictionary[4][3]=ContextGLVertexBufferFormat.FLOAT_3,s._bufferFormatDictionary[4][4]=ContextGLVertexBufferFormat.FLOAT_4,s._bufferFormatDictionary[5]=new Array(5),s._bufferFormatDictionary[5][1]=ContextGLVertexBufferFormat.UNSIGNED_BYTE_1,s._bufferFormatDictionary[5][2]=ContextGLVertexBufferFormat.UNSIGNED_BYTE_2,s._bufferFormatDictionary[5][3]=ContextGLVertexBufferFormat.UNSIGNED_BYTE_3,s._bufferFormatDictionary[5][4]=ContextGLVertexBufferFormat.UNSIGNED_BYTE_4,s._bufferFormatDictionary[6]=new Array(5),s._bufferFormatDictionary[6][1]=ContextGLVertexBufferFormat.UNSIGNED_SHORT_1,s._bufferFormatDictionary[6][2]=ContextGLVertexBufferFormat.UNSIGNED_SHORT_2,s._bufferFormatDictionary[6][3]=ContextGLVertexBufferFormat.UNSIGNED_SHORT_3,s._bufferFormatDictionary[6][4]=ContextGLVertexBufferFormat.UNSIGNED_SHORT_4,s.visible=!0,s}return __extends(e,t),Object.defineProperty(e.prototype,"glVersion",{get:function(){return this._context.glVersion},enumerable:!0,configurable:!0}),e.prototype.getProgramData=function(t,e){return this._programDataPool.getItem(t,e)},e.prototype.setRenderTarget=function(t,e,i,r){if(void 0===e&&(e=!1),void 0===i&&(i=0),void 0===r&&(r=0),this._renderTarget!==t||i!=this._renderSurfaceSelector||r!=this._renderMipmapSelector||this._enableDepthAndStencil!=e)if(this._renderTarget=t,this._renderSurfaceSelector=i,this._renderMipmapSelector=r,this._enableDepthAndStencil=e,t){var n=this.getAbstraction(t);this._context.setRenderToTexture(n.getTexture(),e,this._antiAlias,i,r),0!=r&&1!=this._context.glVersion&&(n._invalidMipmaps=!1,n._mipmap=!0)}else this._context.setRenderToBackBuffer(),this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)},e.prototype.copyPixels=function(t,e,i,r,n,o,s){if(void 0===s&&(s=!1),!(r.x<-i.width||r.x>e.width||r.y<-i.height||r.y>e.height))if(s){this._renderToTextureVertexBuffer||(this._renderToTextureVertexBuffer=this._context.createVertexBuffer(4,20),this._renderToTextureVertexBuffer.uploadFromArray(new Float32Array([-1,-1,0,0,0,1,-1,1,0,1,1,1,1,1,2,-1,1,0,1,3]),0,4)),this._indexBuffer||(this._indexBuffer=this._context.createIndexBuffer(6),this._indexBuffer.uploadFromArray(new Uint16Array([2,1,0,3,2,0]),0,6)),this._copyPixelFilter||(this._copyPixelFilter=new CopyPixelFilter3D,this._copyPixelSampler=new ImageSampler(!1,!1,!1)),this._copyPixelFilter.sourceTexture=t,this._copyPixelFilter.rect=i,this._copyPixelFilter.destPoint=r,this._copyPixelFilter.setRenderTargets(e,this);var a=this._indexBuffer,l=this._renderToTextureVertexBuffer,h=this._copyPixelFilter.tasks,c=h.length;(c>1||h[0].target)&&(this._context.setProgram(h[0].getProgram(this)),this._context.setVertexBufferAt(h[0]._positionIndex,l,0,ContextGLVertexBufferFormat.FLOAT_2),this._context.setVertexBufferAt(h[0]._uvIndex,l,8,ContextGLVertexBufferFormat.FLOAT_2));for(var u=0;u<c;++u){var p=h[u];this.setRenderTarget(p.target,!1),this.setScissor(null),this._context.setProgram(p.getProgram(this)),this._context.setDepthTest(!1,ContextGLCompareMode.LESS_EQUAL),this.getAbstraction(p.getMainInputTexture(this)).activate(p._inputTextureIndex,this._copyPixelSampler),p.target||(l=this._renderToTextureVertexBuffer,this._context.setVertexBufferAt(p._positionIndex,l,0,ContextGLVertexBufferFormat.FLOAT_2),this._context.setVertexBufferAt(p._uvIndex,l,8,ContextGLVertexBufferFormat.FLOAT_2)),p.activate(this,null,null),this._context.drawIndices(ContextGLDrawMode.TRIANGLES,a,0,6),p.deactivate(this)}this._context.setDepthTest(!0,ContextGLCompareMode.LESS_EQUAL),this._context.setTextureAt(0,null),this._context.setVertexBufferAt(0,null),this._context.setVertexBufferAt(1,null)}else{i=i.clone();(r=r.clone()).x<0&&(i.x-=r.x,i.width+=r.x,r.x=0),r.y<0&&(i.y-=r.y,i.height+=r.y,r.y=0),i.width>e.width-r.x&&(i.width=e.width-r.x),i.height>e.height-r.y&&(i.height=e.height-r.y),this.setRenderTarget(t,!1),this.setScissor(null);var d=this.getAbstraction(e);this._context.copyToTexture(d.getTexture(),i,r)}},e.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new e._abstractionClassPool[t.assetType](t,this))},e.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},e.registerAbstraction=function(t,i){e._abstractionClassPool[i.assetType]=t},e.prototype.requestContext=function(t,e,i,r){void 0===t&&(t=!1),void 0===e&&(e=ContextGLProfile.BASELINE),void 0===i&&(i=ContextMode.AUTO),void 0===r&&(r=!1),null!=this._usesSoftwareRendering&&(this._usesSoftwareRendering=t),this._profile=e;try{i==ContextMode.SOFTWARE?this._context=new ContextSoftware(this._container):i==ContextMode.GLES?this._context=new ContextGLES(this._container):this._context=new ContextWebGL(this._container,r)}catch(t){this.dispatchEvent(new StageEvent(StageEvent.STAGE_ERROR,this))}this._context&&this._callback(this._context)},Object.defineProperty(e.prototype,"width",{get:function(){return this._sizeDirty=!1,this._width},set:function(t){this._width!=t&&(this._container.style.width=t+"px",this._container.width=t*this._context.pixelRatio,this._width=t,this._backBufferDirty=!0,this._invalidateSize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._sizeDirty=!1,this._height},set:function(t){this._height!=t&&(this._container.style.height=t+"px",this._container.height=t*this._context.pixelRatio,this._height=t,this._backBufferDirty=!0,this._invalidateSize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x!=t&&(CSS.setElementX(this._container,t),this._x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y!=t&&(CSS.setElementY(this._container,t),this._y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return CSS.getElementVisibility(this._container)},set:function(t){CSS.setElementVisibility(this._container,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._container},set:function(t){this._container=t,this._context&&(this._context.container=this._container)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),e.prototype._invalidateSize=function(){this._sizeDirty||(this._sizeDirty=!0,this.dispatchEvent(new StageEvent(StageEvent.INVALIDATE_SIZE,this)))},Object.defineProperty(e.prototype,"profile",{get:function(){return this._profile},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var t in this._abstractionPool)this._abstractionPool[t].clear&&this._abstractionPool[t].clear();this._abstractionPool={},this._stageManager.iRemoveStage(this),this.freeContext(),this._stageManager=null,this._stageIndex=-1},e.prototype.configureBackBuffer=function(t,e,i,r){this.width=t,this.height=e,this._antiAlias=i,this._enableDepthAndStencil=r,this._context&&this._context.configureBackBuffer(t,e,i,r)},Object.defineProperty(e.prototype,"enableDepthAndStencil",{get:function(){return this._enableDepthAndStencil},set:function(t){this._enableDepthAndStencil!=t&&(this._enableDepthAndStencil=t,this._backBufferDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderSurfaceSelector",{get:function(){return this._renderSurfaceSelector},enumerable:!0,configurable:!0}),e.prototype.clear=function(t,e,i,r,n,o,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=ContextGLClearMask.ALL),this._context&&(this._backBufferDirty&&null==this._renderTarget&&(this._backBufferDirty=!1,this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)),this._context.clear(t,e,i,r,n,o,s),this._bufferClear=!0)},Object.defineProperty(e.prototype,"stageIndex",{get:function(){return this._stageIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usesSoftwareRendering",{get:function(){return this._usesSoftwareRendering},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"antiAlias",{get:function(){return this._antiAlias},set:function(t){this._antiAlias!=t&&(this._antiAlias=t,this._backBufferDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!0,configurable:!0}),e.prototype.registerProgram=function(t){for(var e=0;null!=this._programData[e];)e++;this._programData[e]=t,t.id=e},e.prototype.unRegisterProgram=function(t){this._programData[t.id]=null,t.id=-1},e.prototype.freeContext=function(){this._context&&(this._context.dispose(),this.dispatchEvent(new StageEvent(StageEvent.CONTEXT_DISPOSED,this))),this._context=null,this._initialised=!1},e.prototype.onContextLost=function(t){},e.prototype.onContextRestored=function(t){},e.prototype.recoverFromDisposal=function(){return!!this._context},e.prototype._callback=function(t){this._context=t,this._container=this._context.container,this._width&&this._height&&this._context.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil),this.dispatchEvent(new StageEvent(this._initialised?StageEvent.CONTEXT_RECREATED:StageEvent.CONTEXT_CREATED,this)),this._initialised=!0},e.prototype.setVertexBuffer=function(t,e,i,r,n,o){void 0===o&&(o=!1),this._context.setVertexBufferAt(t,e,n,this._bufferFormatDictionary[o?i+4:i][r])},e.prototype.setScissor=function(t){this._backBufferDirty&&null==this._renderTarget&&(this._backBufferDirty=!1,this.configureBackBuffer(this._width,this._height,this._antiAlias,this._enableDepthAndStencil)),this._context.setScissorRectangle(t)},e.prototype.setSamplerAt=function(t,e){var i=e.repeat?ContextGLWrapMode.REPEAT:ContextGLWrapMode.CLAMP,r=e.smooth&&!this.globalDisableSmooth?ContextGLTextureFilter.LINEAR:ContextGLTextureFilter.NEAREST,n=e.mipmap&&!this.globalDisableMipmap?ContextGLMipFilter.MIPLINEAR:ContextGLMipFilter.MIPNONE;this._context.setSamplerStateAt(t,i,r,n)},e._abstractionClassPool=new Object,e}(EventDispatcher),ImageCube=function(t){function e(e){var i=t.call(this)||this;return i._size=e,i._testDimensions(),i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size!=t&&this._setSize(this._size)},enumerable:!0,configurable:!0}),e.prototype._setSize=function(t){this._size!=t&&this.clear(),this._size=t,this._testDimensions()},e.prototype._testDimensions=function(){if(!ImageUtils.isDimensionValid(this._size))throw new Error("Invalid dimension: Width and height must be power of 2 and cannot exceed 2048")},e.assetType="[image ImageCube]",e}(ImageBase),_Stage_ImageCube=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getType=function(){return"cube"},e.prototype._createTexture=function(){this._texture=this._stage.context.createCubeTexture(this._asset.size,ContextGLTextureFormat.BGRA,!1)},e}(_Stage_ImageBase);Stage.registerAbstraction(_Stage_ImageCube,ImageCube);var BitmapImageUtils=function(){function t(){}return t.drawBitmap=function(e,i,r,n,o,s,a,l,h,c,u){if(void 0===u&&(u=null),u||h!=n||c!=o){u||(u=new Matrix).scale(h/n,c/o);var p=Math.sqrt(u.a*u.a+u.b*u.b),d=Math.sqrt(u.c*u.c+u.d*u.d),f=n*p,_=o*d;u.tx+=a,u.ty+=l;a=Math.floor(u.tx),l=Math.floor(u.ty);if(u.invert(),p>=1||d>=1)for(var g=new Point,m=a;m<a+f;m++)for(var y=l;y<l+_;y++){g.x=m,g.y=y,g=u.transformPoint(g);var v=t.sampleBilinear(g.x,g.y,e,n,o);t.applyPixel32(s,h,c,m,y,v)}else{var b=new Point,x=new Point;for(m=a;m<a+f;m++)for(y=l;y<l+_;y++){b.x=m,b.y=y,b=u.transformPoint(b),x.x=m+1,x.y=y+1,x=u.transformPoint(x);v=t.sampleBox(b.x+i,b.y+r,x.x+i,x.y+r,e,n,o);t.applyPixel32(s,h,c,m,y,v)}}u.invert()}else for(m=a;m<a+f;m++)for(y=l;y<l+_;y++){v=t.sample(m-a+i,y-l+r,e,n,o);t.applyPixel32(s,h,c,m,y,v)}},t.applyPixel32=function(t,e,i,r,n,o){if(r=Math.floor(r),n=Math.floor(n),!(r<0||r>=e||n>=i||n<0)){var s=4*(r+n*e);t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],t[s]=255&t[s],t[s+1]=255&t[s+1],t[s+2]=255&t[s+2],t[s+3]=255&t[s+3]}},t.sampleBilinear=function(e,i,r,n,o,s,a){void 0===s&&(s=1),void 0===a&&(a=1);var l=t.sample(e,i,r,n,o),h=t.sample(e+s,i,r,n,o),c=t.sample(e,i+a,r,n,o),u=t.sample(e+s,i+a,r,n,o),p=e;p-=Math.floor(p);var d=t.interpolateColor(l,h,p),f=t.interpolateColor(c,u,p),_=i;return _-=Math.floor(_),t.interpolateColor(d,f,_)},t.sample=function(t,e,i,r,n){t=Math.floor(t),e=Math.floor(e);var o=[0,0,0,0];if(t<0||t>=r||e<0||e>=n)return o;var s=4*(t+e*r);return o[0]=i[s],o[1]=i[s+1],o[2]=i[s+2],o[3]=i[s+3],o},t.sampleBox=function(e,i,r,n,o,s,a){var l,h,c,u,p=0,d=[0,0,0,0],f=Math.floor(i),_=Math.ceil(n);for(f=Math.max(Math.min(f,a-1),0),_=Math.max(Math.min(_,a-1),0),h=f;h<_;h++){u=1,h<i&&(u*=1-(i-h)),h>n&&(u*=1-(h-n));var g=Math.floor(e),m=Math.ceil(r);for(g=Math.max(Math.min(g,s-1),0),m=Math.max(Math.min(m,s-1),0),l=g;l<m;l++){c=u;var y=t.sample(l,h,o,s,a);l<e&&(c*=1-(e-l)),l>r&&(c*=1-(l-r)),d[0]+=y[0]*c,d[1]+=y[1]*c,d[2]+=y[2]*c,d[3]+=y[3]*c,p+=c}}return d[0]/=p,d[1]/=p,d[2]/=p,d[3]/=p,d[0]=255&d[0],d[1]=255&d[1],d[2]=255&d[2],d[3]=255&d[3],d},t.interpolateColor=function(t,e,i){var r=[];return r[0]=t[0]+(e[0]-t[0])*i,r[1]=t[1]+(e[1]-t[1])*i,r[2]=t[2]+(e[2]-t[2])*i,r[3]=t[3]+(e[3]-t[3])*i,r},t}(),BitmapImageCube=function(t){function e(e,i,r){void 0===i&&(i=!0),void 0===r&&(r=null);var n=t.call(this,e)||this;n._data=new Array(6),n._locked=!1,n._transparent=i;for(var o=0;o<6;o++)n._data[o]=new Uint8ClampedArray(4*n._size*n._size),null!=r&&n.fillRect(o,new Rectangle(0,0,e,e),r);return n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transparent",{get:function(){return this._transparent},set:function(t){this._transparent=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){for(var t=new e(this._size,this.transparent),i=0;i<6;i++)t.setPixels(i,new Rectangle(0,0,this._size,this._size),this.data[i]);return t},e.prototype.colorTransform=function(t,e,i){var r,n,o,s=this.data[t];for(r=0;r<e.width;++r)for(n=0;n<e.height;++n)s[o=4*(r+e.x+(n+e.y)*this._size)]=s[o]*i.redMultiplier+i.redOffset,s[o+1]=s[o+1]*i.greenMultiplier+i.greenOffset,s[o+2]=s[o+2]*i.blueMultiplier+i.blueOffset,s[o+3]=s[o+3]*i.alphaMultiplier+i.alphaOffset;this._locked||this.invalidate()},e.prototype.copyChannel=function(t,e,i,r,n,o){var s,a,l,h=e.data,c=this._data[t],u=Math.round(Math.log(n)/Math.log(2)),p=Math.round(Math.log(o)/Math.log(2)),d=Math.round(i.x),f=Math.round(i.y),_=Math.round(r.x),g=Math.round(r.y);for(s=0;s<i.width;++s)for(a=0;a<i.height;++a)l=4*(s+d+(a+f)*e.width),c[4*(s+_+(a+g)*this._size)+p]=h[l+u];this._locked||this.invalidate()},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=0;e<6;e++)this._data[e]=null;this._transparent=null,this._locked=null},e.prototype.drawBitmap=function(t,e,i,r,n,o,s){void 0===s&&(s=null),BitmapImageUtils.drawBitmap(e,i,r,n,o,this.data[t],0,0,this._size,this._size,s),this._locked||this.invalidate()},e.prototype.fillRect=function(t,e,i){var r,n,o=new Uint32Array(this._data[t].buffer),s=~~e.x,a=~~e.y,l=~~e.width,h=~~e.height,c=this._transparent?4294967295&i:4278190080+(16777215&i);if(0==s&&0==a&&l==this._size&&h==this._size)o.fill(c);else for(r=0;r<h;++r)n=s+(r+a)*this._size,o.fill(c,n,n+l);this._locked||this.invalidate()},e.prototype.getPixel=function(t,e,i){var r,n,o,s,a=4*(~~e+~~i*this._size),l=this.data[t];return r=l[a+0],n=l[a+1],o=l[a+2],(s=l[a+3])?255*r/s<<16|255*n/s<<8|255*o/s:0},e.prototype.getPixel32=function(t,e,i){var r,n,o,s,a=4*(~~e+~~i*this._size),l=this.data[t];return r=l[a++],n=l[a++],o=l[a++],(s=l[a])?s<<24|255*r/s<<16|255*n/s<<8|255*o/s:0},e.prototype.lock=function(){this._locked||(this._locked=!0)},e.prototype.setArray=function(t,e,i){var r,n,o,s,a=this.data[t];for(r=0;r<e.width;++r)for(n=0;n<e.height;++n)s=ColorUtils.float32ColorToARGB(i[r+n*e.width]),a[(o=4*(r+e.x+(n+e.y)*this._size))+0]=s[1],a[o+1]=s[2],a[o+2]=s[3],a[o+3]=this._transparent?s[0]:255;this._locked||this.invalidate()},e.prototype.setPixel=function(t,e,i,r){var n=4*(~~e+~~i*this._size),o=ColorUtils.float32ColorToARGB(r),s=this.data[t];s[n+0]=o[1],s[n+1]=o[2],s[n+2]=o[3],s[n+3]=255,this._locked||this.invalidate()},e.prototype.setPixel32=function(t,e,i,r){var n=4*(~~e+~~i*this._size),o=ColorUtils.float32ColorToARGB(r),s=this.data[t];s[n+0]=o[1],s[n+1]=o[2],s[n+2]=o[3],s[n+3]=this._transparent?o[0]:255,this._locked||this.invalidate()},e.prototype.setPixels=function(t,e,i){if(0==e.x&&0==e.y&&e.width==this._size&&e.height==this._size)this._data[t].set(i);else{var r,n=this._size,o=e.width,s=this._data[t];for(r=0;r<e.height;++r)s.set(i.subarray(r*o*4,(r+1)*o*4),4*(e.x+(r+e.y)*n))}this._locked||this.invalidate()},e.prototype.unlock=function(){this._locked&&(this._locked=!1,this.invalidate())},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype._setSize=function(e){for(var i=0;i<6;i++){var r=this.data[i];this._data[i]=new Uint8ClampedArray(4*e*e);for(var n=this._size<e?this._size:e;0<n;++i)this._data[i].set(r.subarray(0*n*4,1*n*4),0*e*4)}t.prototype._setSize.call(this,e)},e.assetType="[image BitmapImageCube]",e.posX=0,e.negX=1,e.posY=2,e.negY=3,e.posZ=4,e.negZ=5,e}(ImageCube),_Stage_BitmapImageCube=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getTexture=function(){if(t.prototype.getTexture.call(this),this._invalid){this._invalid=!1;for(var e=0;e<6;++e)this._texture.uploadFromArray(new Uint8Array(this._asset.data[e].buffer),e,0);this._invalidMipmaps=!0}return this._texture},e}(_Stage_ImageCube);Stage.registerAbstraction(_Stage_BitmapImageCube,BitmapImageCube);var DefaultGraphicsFactory=function(){function t(){}return t.prototype.createImage2D=function(t,e,i,r,n){return void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=!0),new BitmapImage2D(t,e,i,r,n)},t}(),ImageUtils=function(){function t(){}return t.imageToBitmapImage2D=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=null),i||(i=new DefaultGraphicsFactory);var r=i.createImage2D(t.naturalWidth,t.naturalHeight,!0,null,e),n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;var o=n.getContext("2d");return o.drawImage(t,0,0),r.setPixels(r.rect,o.getImageData(0,0,t.naturalWidth,t.naturalHeight).data),r},t.isImage2DValid=function(t){return null==t||this.isDimensionValid(t.width,t.powerOfTwo)&&this.isDimensionValid(t.height,t.powerOfTwo)},t.isHTMLImageElementValid=function(t){return null==t||this.isDimensionValid(t.width)&&this.isDimensionValid(t.height)},t.isDimensionValid=function(t,e){return void 0===e&&(e=!0),t>=1&&t<=this.MAX_SIZE&&(!e||this.isPowerOfTwo(t))},t.isPowerOfTwo=function(t){return!!t&&(t&-t)==t},t.getBestPowerOf2=function(t){for(var e=1;e<t;)e<<=1;return e>this.MAX_SIZE&&(e=this.MAX_SIZE),e},t.getDefaultImage2D=function(){return this._defaultBitmapImage2D||this.createDefaultImage2D(),this._defaultBitmapImage2D},t.getDefaultImageCube=function(){return this._defaultBitmapImageCube||this.createDefaultImageCube(),this._defaultBitmapImageCube},t.getDefaultSampler=function(){return this._defaultSampler||this.createDefaultSampler(),this._defaultSampler},t.createDefaultImageCube=function(){this._defaultBitmapImage2D||this.createDefaultImage2D();for(var t=new BitmapImageCube(this._defaultBitmapImage2D.width),e=0;e<6;e++)t.drawBitmap(e,this._defaultBitmapImage2D.data,0,0,this._defaultBitmapImage2D.width,this._defaultBitmapImage2D.height);this._defaultBitmapImageCube=t},t.createDefaultImage2D=function(){var t,e,i=new BitmapImage2D(8,8,!1,0);for(t=0;t<8;t++)for(e=0;e<8;e++)1&e^1&t&&i.setPixel(t,e,16777215);this._defaultBitmapImage2D=i},t.createDefaultSampler=function(){this._defaultSampler=new ImageSampler},t.MAX_SIZE=8192,t}(),Image2D=function(t){function e(e,i,r){void 0===r&&(r=!0);var n=t.call(this)||this;return n._powerOfTwo=!0,n._rect=new Rectangle(0,0,Math.round(e),Math.round(i)),n._powerOfTwo=r,n._testDimensions(),n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._rect.height},set:function(t){this._setSize(this._rect.width,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaChannel",{get:function(){return this._alphaChannel},set:function(t){this._alphaChannel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rect",{get:function(){return this._rect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._rect.width},set:function(t){this._setSize(t,this._rect.height)},enumerable:!0,configurable:!0}),e.prototype._setSize=function(t,e){t=Math.round(t),e=Math.round(e),this._rect.width==t&&this._rect.height==e||(this.clear(),this._rect.width=t,this._rect.height=e,this._testDimensions())},e.prototype._testDimensions=function(){if(this._powerOfTwo&&(!ImageUtils.isDimensionValid(this._rect.width)||!ImageUtils.isDimensionValid(this._rect.height)))throw new Error("Invalid dimension: Width and height must be power of 2 and cannot exceed 2048")},Object.defineProperty(e.prototype,"powerOfTwo",{get:function(){return this._powerOfTwo},set:function(t){this._powerOfTwo!=t&&(this._powerOfTwo=t,this._testDimensions())},enumerable:!0,configurable:!0}),e.assetType="[image Image2D]",e}(ImageBase),_Stage_Image2D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getType=function(){return"2d"},e.prototype._createTexture=function(){this._texture=this._stage.context.createTexture(this._asset.width,this._asset.height,ContextGLTextureFormat.BGRA,!0)},e}(_Stage_ImageBase);Stage.registerAbstraction(_Stage_Image2D,Image2D);var BitmapImage2D=function(t){function e(e,i,r,n,o,s){void 0===r&&(r=!0),void 0===n&&(n=null),void 0===o&&(o=!0),void 0===s&&(s=null);var a=t.call(this,e,i,o)||this;return a._locked=!1,a._data=new Uint8ClampedArray(4*a._rect.width*a._rect.height),a._transparent=r,a._stage=s,null!=n&&0!=n&&a.fillRect(a._rect,n),a}return __extends(e,t),e.prototype.addMipLevel=function(t){this._customMipLevels||(this._customMipLevels=[]),this._customMipLevels.push(t)},Object.defineProperty(e.prototype,"mipLevels",{get:function(){return this._customMipLevels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transparent",{get:function(){return this._transparent},set:function(t){this._transparent=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this._rect.width,this._rect.height,this._transparent,null,this._powerOfTwo);return t.setPixels(this._rect,this.data),t},e.prototype.colorTransform=function(t,e){var i,r,n,o=this.data;for(i=0;i<t.width;++i)for(r=0;r<t.height;++r)o[n=4*(i+t.x+(r+t.y)*this._rect.width)]=o[n]*e.redMultiplier+e.redOffset,o[n+1]=o[n+1]*e.greenMultiplier+e.greenOffset,o[n+2]=o[n+2]*e.blueMultiplier+e.blueOffset,o[n+3]=o[n+3]*e.alphaMultiplier+e.alphaOffset;this._locked||this.invalidate()},e.prototype.copyChannel=function(t,e,i,r,n){var o,s,a,l=t.data,h=this.data,c=Math.round(Math.log(r)/Math.log(2)),u=Math.round(Math.log(n)/Math.log(2)),p=Math.round(e.x),d=Math.round(e.y),f=Math.round(i.x),_=Math.round(i.y);for(o=0;o<e.width;++o)for(s=0;s<e.height;++s)a=4*(o+p+(s+d)*t.width),h[4*(o+f+(s+_)*this._rect.width)+u]=l[a+c];this._locked||this.invalidate()},e.prototype.merge=function(t,e,i,r,n,o,s){var a,l,h,c=this.data,u=t.data;for(r=~~r,n=~~n,o=~~o,s=~~s,a=0;a<e.width;++a)for(l=0;l<e.height;++l)c[h=4*(a+e.x+(l+e.y)*this.width)]=~~((u[h]*r+c[h]*(256-r))/256),c[h+1]=~~((u[h+1]*n+c[h+1]*(256-n))/256),c[h+2]=~~((u[h+2]*o+c[h+2]*(256-o))/256),c[h+3]=~~((u[h+3]*s+c[h+3]*(256-s))/256);this._locked||this.invalidate()},e.prototype.dispose=function(){this.clear(),this._data=null,this._rect=null,this._transparent=null,this._locked=null},e.prototype.drawBitmap=function(t,e,i,r,n,o){void 0===o&&(o=null),BitmapImageUtils.drawBitmap(t,e,i,r,n,this.data,0,0,this._rect.width,this._rect.height,o),this._locked||this.invalidate()},e.prototype.fillRect=function(t,e){var i,r,n=new Uint32Array(this._data.buffer),o=~~t.x,s=~~t.y,a=~~t.width,l=~~t.height,h=this._transparent?4294967295&e:4278190080+(16777215&e);if(0==o&&0==s&&a==this._rect.width&&l==this._rect.height)n.fill(h);else for(i=0;i<l;++i)r=o+(i+s)*this._rect.width,n.fill(h,r,r+a);this._locked||this.invalidate()},e.prototype.getPixel=function(t,e){var i,r,n,o,s=4*(~~t+~~e*this._rect.width),a=this.data;return i=a[s+0],r=a[s+1],n=a[s+2],(o=a[s+3])?255*i/o<<16|255*r/o<<8|255*n/o:0},e.prototype.getPixel32=function(t,e){var i,r,n,o,s=4*(~~t+~~e*this._rect.width),a=this.data;return i=a[s++],r=a[s++],n=a[s++],(o=a[s])?o<<24|255*i/o<<16|255*r/o<<8|255*n/o:0},e.prototype.getPixelData=function(t,e,i){var r=4*(t+e*this._rect.width),n=this.data;i[0]=n[r++],i[1]=n[r++],i[2]=n[r++],i[3]=n[r]},e.prototype.setPixelData=function(t,e,i){var r=4*(t+e*this._rect.width),n=this.data;n[r+0]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=this._transparent?i[3]:255,this._locked||this.invalidate()},e.prototype.lock=function(){this._locked||(this._locked=!0)},e.prototype.setArray=function(t,e){var i,r,n,o,s=this.data;for(i=0;i<t.width;++i)for(r=0;r<t.height;++r)o=ColorUtils.float32ColorToARGB(e[i+r*t.width]),s[(n=4*(i+t.x+(r+t.y)*this._rect.width))+0]=o[1],s[n+1]=o[2],s[n+2]=o[3],s[n+3]=this._transparent?o[0]:255;this._locked||this.invalidate()},e.prototype.setPixel=function(t,e,i){var r=4*(~~t+~~e*this._rect.width),n=ColorUtils.float32ColorToARGB(i),o=this.data;o[r+0]=n[1],o[r+1]=n[2],o[r+2]=n[3],o[r+3]=255,this._locked||this.invalidate()},e.prototype.setPixelFromArray=function(t,e,i){var r=4*(t+e*this._rect.width),n=this.data;n[r+0]=i[1],n[r+1]=i[2],n[r+2]=i[3],n[r+3]=255*i[0],this._locked||this.invalidate()},e.prototype.setPixel32=function(t,e,i){var r=4*(~~t+~~e*this._rect.width),n=ColorUtils.float32ColorToARGB(i),o=this.data;o[r+0]=n[1],o[r+1]=n[2],o[r+2]=n[3],o[r+3]=this._transparent?n[0]:255,this._locked||this.invalidate()},e.prototype.setPixels=function(t,e){if(t.equals(this._rect))this._data.set(e);else{var i,r=this._rect.width,n=t.width,o=this._data;for(i=0;i<t.height;++i)o.set(e.subarray(i*n*4,(i+1)*n*4),4*(t.x+(i+t.y)*r))}this._locked||this.invalidate()},e.prototype.unlock=function(){this._locked&&(this._locked=!1,this.invalidate())},Object.defineProperty(e.prototype,"data",{get:function(){if(this._alphaChannel){if(this._data.length!=4*this._alphaChannel.length)throw"error when trying to merge the alpha channel into the image. the length of the alpha channel should be 1/4 of the length of the imageData";for(var t=0;t<this._alphaChannel.length;t++)this._data[4*t+3]=this._alphaChannel[t];this._alphaChannel=null}return this._data},enumerable:!0,configurable:!0}),e.prototype._setSize=function(e,i){var r,n=this.data;this._data=new Uint8ClampedArray(4*e*i);var o=this._rect.width<e?this._rect.width:e,s=this._rect.height<i?this._rect.height:i;for(r=0;r<s;++r)this._data.set(n.subarray(r*o*4,(r+1)*o*4),r*e*4);t.prototype._setSize.call(this,e,i)},e.assetType="[image BitmapImage2D]",e}(Image2D),_Stage_BitmapImage2D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getTexture=function(){if(t.prototype.getTexture.call(this),this._invalid){this._invalid=!1,this._texture.uploadFromArray(new Uint8Array(this._asset.data.buffer),0);var e=this._asset.mipLevels;if(e&&e.length>0){for(var i=0;i<e.length;i++)this._texture.uploadFromArray(new Uint8Array(e[i].data.buffer),i+1);this._mipmap=!0,this._invalidMipmaps=!1}else this._invalidMipmaps=!0}return this._texture},e}(_Stage_Image2D);Stage.registerAbstraction(_Stage_BitmapImage2D,BitmapImage2D);var BitmapImageChannel=function(){function t(){}return t.ALPHA=8,t.BLUE=4,t.GREEN=2,t.RED=1,t}(),BlendMode=function(){function t(){}return t.ADD="add",t.ALPHA="alpha",t.DARKEN="darken",t.DIFFERENCE="difference",t.ERASE="erase",t.HARDLIGHT="hardlight",t.INVERT="invert",t.LAYER="layer",t.LIGHTEN="lighten",t.MULTIPLY="multiply",t.NORMAL="normal",t.OVERLAY="overlay",t.SCREEN="screen",t.SHADER="shader",t.SUBTRACT="subtract",t}(),ExternalImage2D=function(t){function e(e){var i=t.call(this,8,8,!0)||this;return i._urlRequest=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"urlRequest",{get:function(){return this._urlRequest},set:function(t){this._urlRequest=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._urlRequest)},e.assetType="[image ExternalImage2D]",e}(Image2D),_Stage_ExternalImage2D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getTexture=function(){return t.prototype.getTexture.call(this),this._invalid&&(this._invalid=!1,this._texture.uploadFromURL(this._asset.urlRequest,0),this._invalidMipmaps=!0),this._texture},e}(_Stage_Image2D);Stage.registerAbstraction(_Stage_ExternalImage2D,ExternalImage2D);var SpecularImage2D=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,1,1)||this;return r._specularSource=e,r._glossSource=i,r._output=new BitmapImage2D(1,1,!1,16777215),r._testSize(),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularSource",{get:function(){return this._specularSource},set:function(t){this._specularSource!=t&&(this._specularSource=t,this.invalidate(),this._testSize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glossSource",{get:function(){return this._glossSource},set:function(t){this._glossSource!=t&&(this._glossSource=t,this.invalidate(),this._testSize())},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._specularSource,this._glossSource)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._rect=null,this._output.dispose()},Object.defineProperty(e.prototype,"data",{get:function(){var t=new Point;return this._output.fillRect(this._rect,16777215),this._glossSource&&this._output.copyChannel(this._glossSource,this._rect,t,BitmapImageChannel.GREEN,BitmapImageChannel.GREEN),this._specularSource&&this._output.copyChannel(this._specularSource,this._rect,t,BitmapImageChannel.RED,BitmapImageChannel.RED),this._output.data},enumerable:!0,configurable:!0}),e.prototype._setSize=function(e,i){t.prototype._setSize.call(this,e,i),this._output._setSize(e,i)},e.prototype._testSize=function(){var t,e;this._specularSource?(t=this._specularSource.width,e=this._specularSource.height):this._glossSource?(t=this._glossSource.width,e=this._glossSource.height):(t=1,e=1),t!=this._output.width&&e!=this._output.height&&(this._output.dispose(),this._output=new BitmapImage2D(t,e,!1,16777215)),this._setSize(t,e)},e.assetType="[asset SpecularImage2D]",e}(Image2D);Stage.registerAbstraction(_Stage_BitmapImage2D,SpecularImage2D);var Filter3DCompositeTask=function(t){function e(e,i){void 0===i&&(i=1);var r=t.call(this)||this;return r._data=new Float32Array([i,.5,2,-1,0,0,0,0]),r._blendMode=e,r}return __extends(e,t),Object.defineProperty(e.prototype,"overlayTexture",{get:function(){return this._overlayTexture},set:function(t){this._overlayTexture=t,this._overlayWidth=this._overlayTexture.width,this._overlayHeight=this._overlayTexture.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._data[0]},set:function(t){this._data[0]=t},enumerable:!0,configurable:!0}),e.prototype.getFragmentCode=function(){var t=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(t,1);var e=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(e,1);var i=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(i,1);var r=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(r,1);var n=this._registerCache.getFreeTextureReg();this._inputTextureIndex=n.index;var o=this._registerCache.getFreeTextureReg();this._overlayTextureIndex=o.index;var s=this._registerCache.getFreeFragmentConstant();this._exposureIndex=4*s.index;var a,l=this._registerCache.getFreeFragmentConstant();switch(this._scalingIndex=4*l.index,a="tex "+t+", "+this._uvVarying+", "+n+" <2d,linear,clamp>\nmul "+e+", "+this._uvVarying+", "+l+".zw\nadd "+e+", "+e+", "+l+".xy\ntex "+e+", "+e+", "+o+" <2d,linear,clamp>\nmul "+e+", "+e+", "+s+".xxx\nadd "+e+", "+e+", "+s+".xxx\n",this._blendMode){case"multiply":a+="mul oc, "+t+", "+e+"\n";break;case"add":a+="add oc, "+t+", "+e+"\n";break;case"subtract":a+="sub oc, "+t+", "+e+"\n";break;case"overlay":a+="sge "+i+", "+t+", "+s+".yyy\n",a+="sub "+t+", "+i+", "+t+"\n",a+="sub "+e+", "+e+", "+i+"\n",a+="mul "+e+", "+e+", "+t+"\n",a+="sub "+r+", "+i+", "+s+".yyy\n",a+="div "+e+", "+e+", "+r+"\n",a+="add oc, "+e+", "+i+"\n";break;case"normal":a+="mov oc, "+t+"\n";break;default:throw new Error("Unknown blend mode")}return a},e.prototype.activate=function(t,e,i){this._data[4]=-.5*(this._textureWidth-this._overlayWidth)/this._overlayWidth,this._data[5]=-.5*(this._textureHeight-this._overlayHeight)/this._overlayHeight,this._data[6]=this._textureWidth/this._overlayWidth,this._data[7]=this._textureHeight/this._overlayHeight,t.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,this._data),t.getAbstraction(this._overlayTexture).activate(this._overlayTextureIndex)},e.prototype.deactivate=function(t){t.context.setTextureAt(1,null)},e}(Filter3DTaskBase),Filter3DFXAATask=function(t){function e(e,i){void 0===e&&(e=1),void 0===i&&(i=-1);var r=t.call(this)||this;return r._stepSize=1,r._data=new Float32Array(20),r._data.set([.299,.587,.114,0],0),r._data.set([.25,.5,.75,1],4),r._data.set([1/1024,1/1024,-1,1],8),r._data.set([1/128,1/8,8,0],12),r._data.set([1/3-.5,2/3-.5,-.5,.5],16),r.amount=e,r.stepSize=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount!=t&&(this._amount=t,this.invalidateProgram(),this.updateBlurData())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stepSize",{get:function(){return this._stepSize},set:function(t){this._stepSize!=t&&(this._stepSize=t,this.calculateStepSize(),this.invalidateProgram(),this.updateBlurData())},enumerable:!0,configurable:!0}),e.prototype.getFragmentCode=function(){var t="fc0",e="fc2.x",i="fc2.y",r="ft0.xy",n="ft0.x",o="ft0.y",s="ft2.x",a="ft2.y",l="ft2.z",h="ft2.w",c="ft3.x",u="ft3.y",p="ft3.z",d="ft1",f="ft4.x",_=new Array;return _.push("tex",d,"v0","fs0","<2d wrap linear>","\n"),_.push("dp3",c,d,t,"\n"),_.push("mov",r,"v0","\n"),_.push("sub",r,r,"fc2.xy","\n"),_.push("tex",d,r,"fs0","<2d wrap linear>","\n"),_.push("dp3",s,d,t,"\n"),_.push("mov",r,"v0","\n"),_.push("add",r,r,"fc2.xy","\n"),_.push("tex",d,r,"fs0","<2d wrap linear>","\n"),_.push("dp3",h,d,t,"\n"),_.push("mov",r,"v0","\n"),_.push("sub",o,o,i,"\n"),_.push("add",n,n,e,"\n"),_.push("tex",d,r,"fs0","<2d wrap linear>","\n"),_.push("dp3",a,d,t,"\n"),_.push("mov",r,"v0","\n"),_.push("add",o,o,i,"\n"),_.push("sub",n,n,e,"\n"),_.push("tex",d,r,"fs0","<2d wrap linear>","\n"),_.push("dp3",l,d,t,"\n"),_.push("add",u,s,a,"\n"),_.push("add",p,l,h,"\n"),_.push("sub",f,u,p,"\n"),_.push("neg",f,f,"\n"),_.push("add",u,s,l,"\n"),_.push("add",p,a,h,"\n"),_.push("sub","ft4.y",u,p,"\n"),_.push("add",u,u,p,"\n"),_.push("mul",u,u,"fc3.y","\n"),_.push("mul",u,u,"fc1.x","\n"),_.push("max","ft5.x",u,"fc3.x","\n"),_.push("abs",u,f,"\n"),_.push("abs",p,"ft4.y","\n"),_.push("min",u,u,p,"\n"),_.push("add",u,u,"ft5.x","\n"),_.push("rcp","ft5.y",u,"\n"),_.push("mul",u,f,"ft5.y","\n"),_.push("mov",p,"fc3.z","\n"),_.push("neg",p,p,"\n"),_.push("max",u,u,p,"\n"),_.push("min",u,"fc3.z",u,"\n"),_.push("mul",f,u,e,"\n"),_.push("mul",u,"ft4.y","ft5.y","\n"),_.push("mov",p,"fc3.z","\n"),_.push("neg",p,p,"\n"),_.push("max",u,u,p,"\n"),_.push("min",u,"fc3.z",u,"\n"),_.push("mul","ft4.y",u,i,"\n"),_.push("mul","ft1.xy","ft4.xy","fc4.x","\n"),_.push("add",r,"v0","ft1.xy","\n"),_.push("tex","ft6",r,"fs0","<2d wrap linear>","\n"),_.push("mul","ft1.xy","ft4.xy","fc4.y","\n"),_.push("add",r,"v0","ft1.xy","\n"),_.push("tex",d,r,"fs0","<2d wrap linear>","\n"),_.push("add","ft6","ft6",d,"\n"),_.push("mul","ft6","ft6","fc1.y","\n"),_.push("mul","ft1.xy","ft4.xy","fc4.z","\n"),_.push("add",r,"v0","ft1.xy","\n"),_.push("tex","ft7",r,"fs0","<2d wrap linear>","\n"),_.push("mul","ft1.xy","ft4.xy","fc4.w","\n"),_.push("add",r,"v0","ft1.xy","\n"),_.push("tex",d,r,"fs0","<2d wrap linear>","\n"),_.push("add","ft7","ft7",d,"\n"),_.push("mul","ft7","ft7","fc1.x","\n"),_.push("mul",d,"ft6","fc1.y","\n"),_.push("add","ft7","ft7",d,"\n"),_.push("min",u,l,h,"\n"),_.push("min",p,s,a,"\n"),_.push("min",u,u,p,"\n"),_.push("min","ft5.x",u,c,"\n"),_.push("max",u,l,h,"\n"),_.push("max",p,s,a,"\n"),_.push("max",u,u,p,"\n"),_.push("max","ft5.y",u,c,"\n"),_.push("dp3",u,t,"ft7","\n"),_.push("slt",p,u,"ft5.x","\n"),_.push("sge","ft3.w",u,"ft5.y","\n"),_.push("mul",p,p,"ft3.w","\n"),_.push("mul","ft6","ft6",p,"\n"),_.push("sub",p,"fc1.w",p,"\n"),_.push("mul","ft7","ft7",p,"\n"),_.push("add","oc","ft6","ft7","\n"),_.join(" ")},e.prototype.activate=function(t,e,i){t.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,this._data)},e.prototype.updateTextures=function(e){t.prototype.updateTextures.call(this,e),this.updateBlurData()},e.prototype.updateBlurData=function(){this._rttManager&&(this._data[8]=1/this._textureWidth,this._data[9]=1/this._textureHeight)},e.prototype.calculateStepSize=function(){this._realStepSize=1},e.MAX_AUTO_SAMPLES=15,e}(Filter3DTaskBase),Filter3DHBlurTask=function(t){function e(e,i){void 0===i&&(i=-1);var r=t.call(this)||this;return r._stepSize=1,r._amount=e,r._data=new Float32Array([0,0,0,1]),r.stepSize=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount!=t&&(this._amount=t,this.invalidateProgram(),this.updateBlurData(),this.calculateStepSize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stepSize",{get:function(){return this._stepSize},set:function(t){this._stepSize!=t&&(this._stepSize=t,this.calculateStepSize(),this.invalidateProgram(),this.updateBlurData())},enumerable:!0,configurable:!0}),e.prototype.getFragmentCode=function(){var t=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(t,1);var e=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(e,1);var i=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(i,1);var r=this._registerCache.getFreeTextureReg();this._inputTextureIndex=r.index;var n,o=this._registerCache.getFreeFragmentConstant();this._blurIndex=4*o.index;var s=1;n="mov "+t+", "+this._uvVarying+"\nsub "+t+".x, "+this._uvVarying+".x, "+o+".x\n",n+="tex "+e+", "+t+", "+r+" <2d,linear,clamp>\n";for(var a=this._realStepSize;a<=this._amount;a+=this._realStepSize)n+="add "+t+".x, "+t+".x, "+o+".y\ntex "+i+", "+t+", "+r+" <2d,linear,clamp>\nadd "+e+", "+e+", "+i+"\n",++s;return n+="mul oc, "+e+", "+o+".z\n",this._data[2]=1/s,n},e.prototype.activate=function(t,e,i){t.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,this._data)},e.prototype.updateTextures=function(e){t.prototype.updateTextures.call(this,e),this.updateBlurData()},e.prototype.updateBlurData=function(){var t=1/this._textureWidth;this._data[0]=.5*this._amount*t,this._data[1]=this._realStepSize*t},e.prototype.calculateStepSize=function(){this._realStepSize=this._stepSize>0?this._stepSize:this._amount>e.MAX_AUTO_SAMPLES?this._amount/e.MAX_AUTO_SAMPLES:1},e.MAX_AUTO_SAMPLES=15,e}(Filter3DTaskBase),Filter3DVBlurTask=function(t){function e(e,i){void 0===i&&(i=-1);var r=t.call(this)||this;return r._stepSize=1,r._amount=e,r._data=new Float32Array([0,0,0,1]),r.stepSize=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"amount",{get:function(){return this._amount},set:function(t){this._amount!=t&&(this._amount=t,this.invalidateProgram(),this.updateBlurData())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stepSize",{get:function(){return this._stepSize},set:function(t){this._stepSize!=t&&(this._stepSize=t,this.calculateStepSize(),this.invalidateProgram(),this.updateBlurData())},enumerable:!0,configurable:!0}),e.prototype.getFragmentCode=function(){var t=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(t,1);var e=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(e,1);var i=this._registerCache.getFreeFragmentVectorTemp();this._registerCache.addFragmentTempUsages(i,1);var r=this._registerCache.getFreeTextureReg();this._inputTextureIndex=r.index;var n,o=this._registerCache.getFreeFragmentConstant();this._blurIndex=4*o.index;var s=1;n="mov "+t+", "+this._uvVarying+"\nsub "+t+".y, "+this._uvVarying+".y, "+o+".x\n",n+="tex "+e+", "+t+", "+r+" <2d,linear,clamp>\n";for(var a=this._realStepSize;a<=this._amount;a+=this._realStepSize)n+="add "+t+".y, "+t+".y, "+o+".y\n",n+="tex "+i+", "+t+", "+r+" <2d,linear,clamp>\nadd "+e+", "+e+", "+i+"\n",++s;return n+="mul oc, "+e+", "+o+".z\n",this._data[2]=1/s,n},e.prototype.activate=function(t,e,i){t.context.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,this._data)},e.prototype.updateTextures=function(e){t.prototype.updateTextures.call(this,e),this.updateBlurData()},e.prototype.updateBlurData=function(){var t=1/this._textureHeight;this._data[0]=.5*this._amount*t,this._data[1]=this._realStepSize*t},e.prototype.calculateStepSize=function(){this._realStepSize=this._stepSize>0?this._stepSize:this._amount>e.MAX_AUTO_SAMPLES?this._amount/e.MAX_AUTO_SAMPLES:1},e.MAX_AUTO_SAMPLES=15,e}(Filter3DTaskBase),BlurFilter3D=function(t){function e(e,i,r){void 0===e&&(e=3),void 0===i&&(i=3),void 0===r&&(r=-1);var n=t.call(this)||this;return n._hBlurTask=new Filter3DHBlurTask(e,r),n._vBlurTask=new Filter3DVBlurTask(i,r),n.addTask(n._hBlurTask),n.addTask(n._vBlurTask),n}return __extends(e,t),Object.defineProperty(e.prototype,"blurX",{get:function(){return this._hBlurTask.amount},set:function(t){this._hBlurTask.amount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._vBlurTask.amount},set:function(t){this._vBlurTask.amount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stepSize",{get:function(){return this._hBlurTask.stepSize},set:function(t){this._hBlurTask.stepSize=t,this._vBlurTask.stepSize=t},enumerable:!0,configurable:!0}),e.prototype.setRenderTargets=function(e,i){this._hBlurTask.target=this._vBlurTask.getMainInputTexture(i),t.prototype.setRenderTargets.call(this,e,i)},e}(Filter3DBase),CompositeFilter3D=function(t){function e(e,i){void 0===i&&(i=1);var r=t.call(this)||this;return r._compositeTask=new Filter3DCompositeTask(e,i),r.addTask(r._compositeTask),r}return __extends(e,t),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._compositeTask.exposure},set:function(t){this._compositeTask.exposure=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overlayTexture",{get:function(){return this._compositeTask.overlayTexture},set:function(t){this._compositeTask.overlayTexture=t},enumerable:!0,configurable:!0}),e}(Filter3DBase),FXAAFilter3D=function(t){function e(e,i){void 0===i&&(i=-1);var r=t.call(this)||this;return r._fxaaTask=new Filter3DFXAATask(e,i),r.addTask(r._fxaaTask),r}return __extends(e,t),Object.defineProperty(e.prototype,"amount",{get:function(){return this._fxaaTask.amount},set:function(t){this._fxaaTask.amount=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stepSize",{get:function(){return this._fxaaTask.stepSize},set:function(t){this._fxaaTask.stepSize=t},enumerable:!0,configurable:!0}),e}(Filter3DBase),StageManager=function(t){function e(){var i=t.call(this)||this;return i._stages=new Array(e.STAGE_MAX_QUANTITY),i._onContextCreatedDelegate=function(t){return i.onContextCreated(t)},i}return __extends(e,t),e.getInstance=function(){return null==this._instance&&(this._instance=new e),this._instance},e.prototype.getStageAt=function(t,i,r,n,o){if(void 0===i&&(i=!1),void 0===r&&(r=ContextGLProfile.BASELINE),void 0===n&&(n=ContextMode.AUTO),void 0===o&&(o=!1),t<0||t>=e.STAGE_MAX_QUANTITY)throw new ArgumentError("Index is out of bounds [0.."+e.STAGE_MAX_QUANTITY+"]");if(!this._stages[t]){if(e._numStages++,document&&null==e.htmlCanvas)(s=document.createElement("canvas")).id="stage"+t,document.body.appendChild(s);else if(e.htmlCanvas)var s=e.htmlCanvas;var a=this._stages[t]=new Stage(s,t,this,i,r);a.addEventListener(StageEvent.CONTEXT_CREATED,this._onContextCreatedDelegate),a.requestContext(i,r,n,o)}return this._stages[t]},e.prototype.iRemoveStage=function(t){e._numStages--,t.removeEventListener(StageEvent.CONTEXT_CREATED,this._onContextCreatedDelegate),this._stages[t.stageIndex]=null},e.prototype.getFreeStage=function(t,e,i,r){void 0===t&&(t=!1),void 0===e&&(e=ContextGLProfile.BASELINE),void 0===i&&(i=ContextMode.AUTO),void 0===r&&(r=!1);for(var n=0,o=this._stages.length;n<o;){if(!this._stages[n])return this.getStageAt(n,t,e,i,r);++n}return null},Object.defineProperty(e.prototype,"hasFreeStage",{get:function(){return e._numStages<e.STAGE_MAX_QUANTITY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSlotsFree",{get:function(){return e.STAGE_MAX_QUANTITY-e._numStages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSlotsUsed",{get:function(){return e._numStages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSlotsTotal",{get:function(){return this._stages.length},enumerable:!0,configurable:!0}),e.prototype.onContextCreated=function(t){},e.STAGE_MAX_QUANTITY=8,e.htmlCanvas=null,e._numStages=0,e}(EventDispatcher),RTTBufferManager=function(t){function e(e,i){void 0===i&&(i=!0);var r=t.call(this)||this;return r._viewOffsetX=0,r._viewOffsetY=0,r._viewWidth=-1,r._viewHeight=-1,r._textureWidth=-1,r._textureHeight=-1,r._buffersInvalid=!0,r._renderToTextureRect=new Rectangle,r._stage=e,r._powerOfTwo=i,r}return __extends(e,t),e.getInstance=function(t){if(!t)throw new Error("stage key cannot be null!");null==e._instances&&(e._instances=new Array);var i=e.getRTTBufferManagerFromStage(t);if(null==i){i=new e(t);var r=new RTTBufferManagerVO;r.stage3d=t,r.rttbfm=i,e._instances.push(r)}return i},e.getRTTBufferManagerFromStage=function(t){for(var i,r=e._instances.length,n=0;n<r;n++)if((i=e._instances[n]).stage3d===t)return i.rttbfm;return null},e.deleteRTTBufferManager=function(t){for(var i=e._instances.length,r=0;r<i;r++)if(e._instances[r].stage3d===t)return void e._instances.splice(r,1)},Object.defineProperty(e.prototype,"textureRatioX",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureRatioY",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._textureRatioY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewOffsetX",{get:function(){return this._viewOffsetX},set:function(t){this._viewOffsetX=t,this._buffersInvalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewOffsetY",{get:function(){return this._viewOffsetY},set:function(t){this._viewOffsetY=t,this._buffersInvalid=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewWidth",{get:function(){return this._viewWidth},set:function(t){t!=this._viewWidth&&(this._viewWidth=t,this._buffersInvalid=!0,this._textureWidth=this._powerOfTwo?ImageUtils.getBestPowerOf2(this._viewWidth):this._viewWidth,this._textureWidth>this._viewWidth?(this._renderToTextureRect.x=Math.floor(.5*(this._textureWidth-this._viewWidth)),this._renderToTextureRect.width=this._viewWidth):(this._renderToTextureRect.x=0,this._renderToTextureRect.width=this._textureWidth),this.dispatchEvent(new RTTEvent(RTTEvent.RESIZE,this)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewHeight",{get:function(){return this._viewHeight},set:function(t){t!=this._viewHeight&&(this._viewHeight=t,this._buffersInvalid=!0,this._textureHeight=this._powerOfTwo?ImageUtils.getBestPowerOf2(this._viewHeight):this._viewHeight,this._textureHeight>this._viewHeight?(this._renderToTextureRect.y=Math.floor(.5*(this._textureHeight-this._viewHeight)),this._renderToTextureRect.height=this._viewHeight):(this._renderToTextureRect.y=0,this._renderToTextureRect.height=this._textureHeight),this.dispatchEvent(new RTTEvent(RTTEvent.RESIZE,this)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderToTextureVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderToScreenVertexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToScreenVertexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexBuffer",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._indexBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderToTextureRect",{get:function(){return this._buffersInvalid&&this.updateRTTBuffers(),this._renderToTextureRect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWidth",{get:function(){return this._textureWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){return this._textureHeight},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){e.deleteRTTBufferManager(this._stage),this._indexBuffer&&(this._indexBuffer.dispose(),this._renderToScreenVertexBuffer.dispose(),this._renderToTextureVertexBuffer.dispose(),this._renderToScreenVertexBuffer=null,this._renderToTextureVertexBuffer=null,this._indexBuffer=null)},e.prototype.updateRTTBuffers=function(){var t,e,i,r,n=this._stage.context;null==this._renderToTextureVertexBuffer&&(this._renderToTextureVertexBuffer=n.createVertexBuffer(4,20)),null==this._renderToScreenVertexBuffer&&(this._renderToScreenVertexBuffer=n.createVertexBuffer(4,20)),this._indexBuffer||(this._indexBuffer=n.createIndexBuffer(6),this._indexBuffer.uploadFromArray(new Uint16Array([2,1,0,3,2,0]),0,6)),this._textureRatioX=i=Math.min(this._viewWidth/this._textureWidth,1),this._textureRatioY=r=Math.min(this._viewHeight/this._textureHeight,1);var o=.5*(1-i),s=.5*(i+1),a=.5*(1-r),l=.5*(r+1);t=new Float32Array([-i,-r,o,a,0,i,-r,s,a,1,i,r,s,l,2,-i,r,o,l,3]),e=new Float32Array([-1,-1,o,a,0,1,-1,s,a,1,1,1,s,l,2,-1,1,o,l,3]),this._renderToTextureVertexBuffer.uploadFromArray(t,0,4),this._renderToScreenVertexBuffer.uploadFromArray(e,0,4),this._buffersInvalid=!1},e}(EventDispatcher),RTTBufferManagerVO=function(){},Image2DParser=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,URLLoaderDataFormat.BLOB)||this;return r._factory=e||new DefaultGraphicsFactory,r._alphaChannel=i,r}return __extends(e,t),e.supportsType=function(t){return"jpg"==(t=t.toLowerCase())||"jpeg"==t||"png"==t||"gif"==t},e.supportsData=function(t){if(t instanceof HTMLImageElement)return!0;if(!(t instanceof ByteArray))return!1;var e=t;return e.position=0,55551==e.readUnsignedShort()||(e.position=0,16973==e.readShort()||(e.position=1,"PNG"==e.readUTFBytes(3)||(e.position=0,"GIF"==e.readUTFBytes(3)&&14393==e.readShort()&&97==e.readByte()||(e.position=0,"ATF"==e.readUTFBytes(3)))))},e.prototype._pFinalizeAsset=function(e,i){this._alphaChannel&&(e.alphaChannel=this._alphaChannel),t.prototype._pFinalizeAsset.call(this,e,i)},e.prototype._pProceedParsing=function(){var t,e=this;if(this._loadingImage)return ParserBase.MORE_TO_PARSE;if(this._htmlImageElement)t=ImageUtils.imageToBitmapImage2D(this._htmlImageElement,!1,this._factory),this._pFinalizeAsset(t,this._iFileName);else if(this.data instanceof HTMLImageElement){var i=this.data;t=ImageUtils.imageToBitmapImage2D(i,!1,this._factory),this._pFinalizeAsset(t,this._iFileName)}else if(this.data instanceof ByteArray){if(this.data.position=0,this._htmlImageElement=ParserUtils.byteArrayToImage(this.data),!this._htmlImageElement.naturalWidth)return this._htmlImageElement.onload=function(t){return e.onLoadComplete(t)},this._loadingImage=!0,ParserBase.MORE_TO_PARSE;t=ImageUtils.imageToBitmapImage2D(this._htmlImageElement,!1,this._factory),this._pFinalizeAsset(t,this._iFileName)}else if(this.data instanceof ArrayBuffer)this._htmlImageElement=ParserUtils.arrayBufferToImage(this.data),t=ImageUtils.imageToBitmapImage2D(this._htmlImageElement,!1,this._factory),this._pFinalizeAsset(t,this._iFileName);else{if(this.data instanceof Blob)return this._htmlImageElement=ParserUtils.blobToImage(this.data),this._htmlImageElement.onload=function(t){return e.onLoadComplete(t)},this._loadingImage=!0,ParserBase.MORE_TO_PARSE;this.data instanceof URLRequest&&(t=new ExternalImage2D(this.data),this._pFinalizeAsset(t,this._iFileName))}return this._pContent=t,ParserBase.PARSING_DONE},e.prototype.onLoadComplete=function(t){this._loadingImage=!1},e}(ParserBase),ImageCubeParser=function(t){function e(){return t.call(this,URLLoaderDataFormat.TEXT)||this}return __extends(e,t),e.supportsType=function(t){return"cube"==(t=t.toLowerCase())},e.supportsData=function(t){try{return!!JSON.parse(t)}catch(t){return!1}},e.prototype._iResolveDependency=function(t){},e.prototype._iResolveDependencyFailure=function(t){},e.prototype._pProceedParsing=function(){if(null!=this._imgDependencyDictionary){var t=new BitmapImageCube(this._getBitmapImage2D(e.posX).width),i=new Rectangle(0,0,t.size,t.size);return t.setPixels(BitmapImageCube.posX,i,this._getBitmapImage2D(e.posX).data),t.setPixels(BitmapImageCube.negX,i,this._getBitmapImage2D(e.negX).data),t.setPixels(BitmapImageCube.posY,i,this._getBitmapImage2D(e.posY).data),t.setPixels(BitmapImageCube.negY,i,this._getBitmapImage2D(e.negY).data),t.setPixels(BitmapImageCube.posZ,i,this._getBitmapImage2D(e.posZ).data),t.setPixels(BitmapImageCube.negZ,i,this._getBitmapImage2D(e.negZ).data),this._imgDependencyDictionary=null,t.name=this._iFileName,this._pFinalizeAsset(t,this._iFileName),ParserBase.PARSING_DONE}try{var r,n=JSON.parse(this.data),o=n.data;if(6!=o.length&&this._pDieWithError("ImageCubeParser: Error - cube texture should have exactly 6 images"),n){this._imgDependencyDictionary=new Object;for(var s=0;s<o.length;s++)r=o[s],this._imgDependencyDictionary[r.id]=this._pAddDependency(r.id,new URLRequest(r.image.toString()));return this._validateCubeData()?(this._pPauseAndRetrieveDependencies(),ParserBase.MORE_TO_PARSE):(this._pDieWithError("ImageCubeParser: JSON data error - cubes require id of:   \n"+e.posX+", "+e.negX+",  \n"+e.posY+", "+e.negY+",  \n"+e.posZ+", "+e.negZ),ParserBase.PARSING_DONE)}}catch(t){this._pDieWithError("CubeTexturePaser Error parsing JSON")}return ParserBase.PARSING_DONE},e.prototype._validateCubeData=function(){return null!=this._imgDependencyDictionary[e.posX]&&null!=this._imgDependencyDictionary[e.negX]&&null!=this._imgDependencyDictionary[e.posY]&&null!=this._imgDependencyDictionary[e.negY]&&null!=this._imgDependencyDictionary[e.posZ]&&null!=this._imgDependencyDictionary[e.negZ]},e.prototype._getBitmapImage2D=function(t){var e=this._imgDependencyDictionary[t];return e?e.assets[0]:null},e.posX="posX",e.negX="negX",e.posY="posY",e.negY="negY",e.posZ="posZ",e.negZ="negZ",e}(ParserBase),TextureAtlasParser=function(t){function e(){var e=t.call(this,URLLoaderDataFormat.TEXT)||this;return e._parseState=0,e}return __extends(e,t),e.supportsType=function(t){return"xml"==(t=t.toLowerCase())},e.supportsData=function(t){try{var e=ParserUtils.toString(t);return-1!=e.indexOf("TextureAtlas")||-1!=e.indexOf("textureatlas")}catch(t){return!1}},e.prototype._iResolveDependency=function(t){t.assets.length?(this._imageData=t.assets[0],this._pFinalizeAsset(this._imageData),this._parseState=TextureAtlasParserState.PARSE_SUBTEXTURES):this._parseState=TextureAtlasParserState.PARSE_COMPLETE},e.prototype._iResolveDependencyFailure=function(t){this._parseState=TextureAtlasParserState.PARSE_COMPLETE},e.prototype._pProceedParsing=function(){switch(this._parseState){case TextureAtlasParserState.PARSE_XML:try{this._doc=XmlUtils.getChildrenWithTag(XmlUtils.strToXml(this._pGetTextData()),"TextureAtlas")[0],this._imagePath=XmlUtils.readAttributeValue(this._doc,"imagePath"),this._subTextureNodes=XmlUtils.getChildrenWithTag(this._doc,"SubTexture"),this._parseState=TextureAtlasParserState.PARSE_IMAGE}catch(t){return ParserBase.PARSING_DONE}break;case TextureAtlasParserState.PARSE_IMAGE:if(!this._imagePath)return ParserBase.PARSING_DONE;this._pAddDependency(this._imagePath,new URLRequest(this._imagePath)),this._pPauseAndRetrieveDependencies();break;case TextureAtlasParserState.PARSE_SUBTEXTURES:for(var t,e,i,r,n,o,s=this._subTextureNodes.length,a=0;a<s;a++)e=this._subTextureNodes[a],t=new ImageSampler,i=XmlUtils.readAttributeValue(e,"x"),r=XmlUtils.readAttributeValue(e,"y"),n=XmlUtils.readAttributeValue(e,"width"),o=XmlUtils.readAttributeValue(e,"height"),(i||r||n||o)&&(t.imageRect=new Rectangle(parseInt(i)/this._imageData.width,parseInt(r)/this._imageData.height,parseInt(n)/this._imageData.width,parseInt(o)/this._imageData.height)),i=XmlUtils.readAttributeValue(e,"frameX"),r=XmlUtils.readAttributeValue(e,"frameY"),n=XmlUtils.readAttributeValue(e,"frameWidth"),o=XmlUtils.readAttributeValue(e,"frameHeight"),(i||r||n||o)&&(t.frameRect=new Rectangle(parseInt(i),parseInt(r),parseInt(n),parseInt(o))),this._pFinalizeAsset(t,XmlUtils.readAttributeValue(e,"name"));this._parseState=TextureAtlasParserState.PARSE_COMPLETE;break;case TextureAtlasParserState.PARSE_COMPLETE:return ParserBase.PARSING_DONE}return ParserBase.MORE_TO_PARSE},e}(ParserBase),TextureAtlasParserState=function(){function t(){}return t.PARSE_XML=0,t.PARSE_IMAGE=1,t.PARSE_SUBTEXTURES=2,t.PARSE_COMPLETE=3,t}(),ShaderRegisterData=function(){this.textures=new Array,this.animatableAttributes=new Array,this.animationTargetRegisters=new Array},AttributesBuffer=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=t.call(this)||this;return r._count=0,r._newCount=0,r._stride=0,r._newStride=0,r._viewVOs=new Array,r._stride=r._newStride=e,r._count=r._newCount=i,r._buffer=new ArrayBuffer(r._stride*r._count),r._bufferView=new Uint8Array(r._buffer,0,r._buffer.byteLength),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this._lengthDirty&&this._updateLength(),this._stride},set:function(t){this._newStride!=t&&(this._newStride=t,this.resize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._newCount},set:function(t){this._newCount!=t&&(this._newCount=t,this.resize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._lengthDirty&&this._updateLength(),this._contentDirty=!1,this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferView",{get:function(){return this._lengthDirty&&this._updateLength(),this._contentDirty=!1,this._bufferView},set:function(t){this._bufferView=t,this._buffer=this._bufferView.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._count*this.stride},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){this._contentDirty||(t.prototype.invalidate.call(this),this._contentDirty=!0)},e.prototype.resize=function(){this._lengthDirty||(this.clear(),this._lengthDirty=!0,this._newStride||(this._buffer=null,this._bufferView=null))},e.prototype.cloneBufferView=function(){var t=new e(this._stride,this._count);return t.bufferView.set(this.bufferView),t},e.prototype.clone=function(){var t=new e(this._stride,this._count);t.bufferView.set(this.bufferView);for(var i=this._viewVOs.length,r=0;r<i;r++)this._viewVOs[r].view._internalClone(t);return t},e.prototype.getView=function(t){return t<this._viewVOs.length?this._viewVOs[t].view:null},e.prototype._setAttributes=function(t,e,i){void 0===i&&(i=0);var r=e instanceof Uint8Array?e:new Uint8Array(e.buffer),n=this._viewVOs[t],o=n.length,s=n.offset,a=r.length/o;if(this.count<a+i&&(this.count=a+i),this._lengthDirty&&this._updateLength(),1==this._viewVOs.length)this._bufferView.set(r);else for(var l=0;l<a;l++)this._bufferView.set(r.subarray(l*o,(l+1)*o),(l+i)*this._stride+s);this.invalidate()},e.prototype._addView=function(t){var e=new ViewVO(t),i=this._viewVOs.length;e.offset=i?this._viewVOs[i-1].offset+this._viewVOs[i-1].length:0,this._viewVOs.push(e),this._newStride<e.offset+e.length&&(this._newStride=e.offset+e.length,this.resize()),t._index=i},e.prototype._removeView=function(t){var e=t._index,i=this._viewVOs.splice(e,1)[0],r=this._viewVOs.length;i.dispose();for(var n=e;n<r;n++)(i=this._viewVOs[n]).offset=n?this._viewVOs[n-1].offset+this._viewVOs[n-1].length:0,i.view._index=n;this._newStride=r?this._viewVOs[r-1].offset+this._viewVOs[r-1].length:0,this.resize()},e.prototype._getOffset=function(t){return this._viewVOs[t].offset},e.prototype._updateLength=function(){var t,e;this._lengthDirty=!1;var i=this._viewVOs.length,r=this._newStride*this._newCount;if(!this._buffer||this._buffer.byteLength!=r){var n,o,s,a,l=new ArrayBuffer(r),h=new Uint8Array(l,0,l.byteLength);if(this._buffer)if(this._stride!=this._newStride){for(t=0;t<i;t++){for(o=(n=this._viewVOs[t]).length,s=n.offset,a=n.oldOffset,e=0;e<this._count;e++)null!=a&&h.set(new Uint8Array(this._buffer,e*this._stride+a,o),e*this._newStride+s);n.oldOffset=n.offset}this._stride=this._newStride}else h.set(new Uint8Array(this._buffer,0,Math.min(r,this._buffer.byteLength)));this._buffer=l,this._bufferView=h}this._count=this._newCount},e.assetType="[assets AttributesBuffer]",e}(AssetBase),ViewVO=function(){function t(t){this.view=t,this.length=t.size*t.dimensions}return t.prototype.dispose=function(){this.view=null},t.prototype.clone=function(){return new t(this.view)},t}(),_Stage_AttributesBuffer=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._stage=i,r._attributesBuffer=e,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._attributesBuffer=null,this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null)},e.prototype.activate=function(t,e,i,r,n){void 0===n&&(n=!1),this._stage.setVertexBuffer(t,this._getVertexBuffer(),e,i,r,n)},e.prototype.draw=function(t,e,i){this._stage.context.drawIndices(t,this._getIndexBuffer(),e,i)},e.prototype._getIndexBuffer=function(){return this._indexBuffer||(this._invalid=!0,this._indexBuffer=this._stage.context.createIndexBuffer(this._attributesBuffer.count*this._attributesBuffer.stride/2)),this._invalid&&(this._invalid=!1,this._indexBuffer.uploadFromByteArray(this._attributesBuffer.buffer,0,this._attributesBuffer.length)),this._indexBuffer},e.prototype._getVertexBuffer=function(){return this._vertexBuffer||(this._invalid=!0,this._vertexBuffer=this._stage.context.createVertexBuffer(this._attributesBuffer.count,this._attributesBuffer.stride)),this._invalid&&(this._invalid=!1,this._vertexBuffer.uploadFromByteArray(this._attributesBuffer.buffer,0,this._attributesBuffer.count)),this._vertexBuffer},e}(AbstractionBase);Stage.registerAbstraction(_Stage_AttributesBuffer,AttributesBuffer);var AttributesView=function(t){function e(e,i,r,n){void 0===r&&(r=0),void 0===n&&(n=!1);var o=t.call(this)||this;return o._arrayClass=e,o._size=e.BYTES_PER_ELEMENT,o._dimensions=i,o._attributesBuffer=r instanceof AttributesBuffer?r:new AttributesBuffer(o._dimensions*o._size,r),o._attributesBuffer._addView(o),o._unsigned=n,o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributesBuffer",{get:function(){return this._attributesBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size!=t&&(this._size=t,this._attributesBuffer._removeView(this),this._attributesBuffer._addView(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dimensions",{get:function(){return this._dimensions},set:function(t){this._dimensions!=t&&(this._dimensions=t,this._attributesBuffer._removeView(this),this._attributesBuffer._addView(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unsigned",{get:function(){return this._unsigned},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._attributesBuffer.count},set:function(t){this._attributesBuffer.count=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._attributesBuffer._getOffset(this._index)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._attributesBuffer.count*this._dimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this._attributesBuffer.stride/this._size},enumerable:!0,configurable:!0}),e.prototype.set=function(t,e){void 0===e&&(e=0),this._attributesBuffer._setAttributes(this._index,t instanceof Array?new this._arrayClass(t):t,e)},e.prototype.get=function(t,e){return void 0===e&&(e=0),new this._arrayClass(this._attributesBuffer.buffer,e*this._attributesBuffer.stride+this.offset,t*this.stride-this.offset/this.size)},e.prototype._internalClone=function(t){return this._cloneCache=new e(this._arrayClass,this._dimensions,t,this._unsigned)},e.prototype.clone=function(t){void 0===t&&(t=null),t&&this._internalClone(t),this._cloneCache||this._attributesBuffer.clone();var e=this._cloneCache;return this._cloneCache=null,e},e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._attributesBuffer.invalidate()},e.prototype.dispose=function(){this._attributesBuffer&&(this._attributesBuffer._removeView(this),this._attributesBuffer=null)},e.assetType="[attributes AttributesView]",e}(AssetBase),Byte4Attributes=function(t){function e(e,i){return void 0===i&&(i=!0),t.call(this,i?Uint8Array:Int8Array,4,e,i)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t,this._arrayClass==Uint8Array)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Byte4Attributes]",e}(AttributesView),Float1Attributes=function(t){function e(e){return t.call(this,Float32Array,1,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Float1Attributes]",e}(AttributesView),Float2Attributes=function(t){function e(e){return t.call(this,Float32Array,2,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Float2Attributes]",e}(AttributesView),Float3Attributes=function(t){function e(e){return t.call(this,Float32Array,3,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Float3Attributes]",e}(AttributesView),Float4Attributes=function(t){function e(e){return t.call(this,Float32Array,4,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Float4Attributes]",e}(AttributesView),Short2Attributes=function(t){function e(e,i){return void 0===i&&(i=!0),t.call(this,i?Uint16Array:Int16Array,2,e,i)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t,this._arrayClass==Uint16Array)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Short2Attributes]",e}(AttributesView),Short3Attributes=function(t){function e(e,i){return void 0===i&&(i=!0),t.call(this,i?Uint16Array:Int16Array,3,e,i)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.set=function(e,i){void 0===i&&(i=0),t.prototype.set.call(this,e,i)},e.prototype.get=function(e,i){return void 0===i&&(i=0),t.prototype.get.call(this,e,i)},e.prototype._internalClone=function(t){return this._cloneCache=new e(t,this._arrayClass==Uint16Array)},e.prototype.clone=function(e){return void 0===e&&(e=null),t.prototype.clone.call(this,e)},e.assetType="[attributes Short3Attributes]",e}(AttributesView);console.debug("AwayJS - Stage - 0.10.20"),Loader.enableParser(Image2DParser),Loader.enableParser(ImageCubeParser),Loader.enableParser(TextureAtlasParser);var AlignmentMode=function(){function t(){}return t.REGISTRATION_POINT="registrationPoint",t.TRANSFORM_POINT="transformPoint",t}(),HierarchicalProperties=function(){function t(){}return t.MOUSE_ENABLED=1,t.VISIBLE=2,t.MASK_ID=4,t.MASKS=8,t.COLOR_TRANSFORM=16,t.SCENE_TRANSFORM=32,t.ALL=63,t}(),OrientationMode=function(){function t(){}return t.DEFAULT="default",t.CAMERA_PLANE="cameraPlane",t.CAMERA_POSITION="cameraPosition",t}(),PickingCollision=function(t){this.entity=t},BoundingVolumeType;!function(t){t[t.SPHERE=0]="SPHERE",t[t.SPHERE_FAST=1]="SPHERE_FAST",t[t.SPHERE_BOUNDS=2]="SPHERE_BOUNDS",t[t.SPHERE_BOUNDS_FAST=3]="SPHERE_BOUNDS_FAST",t[t.BOX=4]="BOX",t[t.BOX_FAST=5]="BOX_FAST",t[t.BOX_BOUNDS=6]="BOX_BOUNDS",t[t.BOX_BOUNDS_FAST=7]="BOX_BOUNDS_FAST",t[t.NULL=8]="NULL"}(BoundingVolumeType||(BoundingVolumeType={}));var BoundsPickerEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._boundsPicker=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"boundsPicker",{get:function(){return this._boundsPicker},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._boundsPicker)},e.INVALIDATE_BOUNDS="invalidateBounds",e}(EventBase),BoundingVolumeBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;if(r._targetCoordinateSpace=e,r._picker=i.picker,r._strokeFlag=i.strokeFlag,r._fastFlag=i.fastFlag,r._onInvalidateBoundsDelegate=function(t){return r._onInvalidateBounds(t)},r._onInvalidateMatrix3DDelegate=function(t){return r._onInvalidateMatrix3D(t)},r._picker.addEventListener(BoundsPickerEvent.INVALIDATE_BOUNDS,r._onInvalidateBoundsDelegate),r._targetCoordinateSpace){for(var n=r._picker.entity;n&&n!=r._targetCoordinateSpace.parent;)n.transform.addEventListener(TransformEvent.INVALIDATE_MATRIX3D,r._onInvalidateMatrix3DDelegate),n=n.parent;n||r._targetCoordinateSpace.transform.addEventListener(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,r._onInvalidateMatrix3DDelegate)}return r}return __extends(e,t),e.prototype._onInvalidateBounds=function(t){this._invalid=!0},e.prototype._onInvalidateMatrix3D=function(t){this._invalid=!0},e.prototype.onClear=function(e){if(t.prototype.onClear.call(this,e),this._picker.addEventListener(BoundsPickerEvent.INVALIDATE_BOUNDS,this._onInvalidateBoundsDelegate),this._targetCoordinateSpace){for(var i=this._picker.entity;i&&i!=this._targetCoordinateSpace.parent;)i.transform.removeEventListener(TransformEvent.INVALIDATE_MATRIX3D,this._onInvalidateMatrix3DDelegate),i=i.parent;i||this._targetCoordinateSpace.transform.removeEventListener(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateMatrix3DDelegate)}this._targetCoordinateSpace=null,this._picker=null},e.prototype.nullify=function(){throw new AbstractMethodError},e.prototype.isInFrustum=function(t,e){throw new AbstractMethodError},e.prototype.clone=function(){throw new AbstractMethodError},e.prototype.rayIntersection=function(t,e,i){return-1},e.prototype.classifyToPlane=function(t){throw new AbstractMethodError},e.prototype._update=function(){this._invalid=!1},e}(AbstractionBase),BoundingBox=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._x=0,e._y=0,e._z=0,e._width=0,e._height=0,e._depth=0,e._centerX=0,e._centerY=0,e._centerZ=0,e._halfExtentsX=0,e._halfExtentsY=0,e._halfExtentsZ=0,e}return __extends(e,t),e.prototype.nullify=function(){this._x=this._y=this._z=0,this._width=this._height=this._depth=0,this._centerX=this._centerY=this._centerZ=0,this._halfExtentsX=this._halfExtentsY=this._halfExtentsZ=0},e.prototype.isInFrustum=function(t,e){if(this._invalid&&this._update(),null!=this._box){for(var i=0;i<e;++i){var r=t[i],n=r.a,o=r.b,s=r.c,a=n<0?-this._halfExtentsX:this._halfExtentsX,l=o<0?-this._halfExtentsY:this._halfExtentsY,h=s<0?-this._halfExtentsZ:this._halfExtentsZ;if(n*(this._centerX+a)+o*(this._centerY+l)+s*(this._centerZ+h)-r.d<0)return!1}return!0}},e.prototype.rayIntersection=function(t,e,i){return this._invalid&&this._update(),null==this._box?-1:this._box.rayIntersection(t,e,i)},e.prototype.getBox=function(){return this._invalid&&this._update(),this._box},e.prototype.classifyToPlane=function(t){var e=t.a,i=t.b,r=t.c,n=e*this._centerX+i*this._centerY+r*this._centerZ-t.d;e<0&&(e=-e),i<0&&(i=-i),r<0&&(r=-r);var o=e*this._halfExtentsX+i*this._halfExtentsY+r*this._halfExtentsZ;return n>o?PlaneClassification.FRONT:n<-o?PlaneClassification.BACK:PlaneClassification.INTERSECT},e.prototype._update=function(){var e;if(t.prototype._update.call(this),this._targetCoordinateSpace&&(this._targetCoordinateSpace==this._picker.entity?e=this._picker.entity.transform.matrix3D:(e=this._picker.entity.transform.concatenatedMatrix3D.clone(),this._targetCoordinateSpace.parent&&e.append(this._targetCoordinateSpace.parent.transform.inverseConcatenatedMatrix3D))),this._box=this._picker._getBoxBoundsInternal(e,this._strokeFlag,this._fastFlag,this._box),null!=this._box){var i=this._box.width/2,r=this._box.height/2,n=this._box.depth/2;this._box.x,this._box.y,this._box.z}},e}(BoundingVolumeBase),BoundingSphere=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=0,e._centerX=0,e._centerY=0,e._centerZ=0,e}return __extends(e,t),e.prototype.nullify=function(){this._centerX=this._centerY=this._centerZ=0,this._radius=0},e.prototype.isInFrustum=function(t,e){this._invalid&&this._update();for(var i=0;i<e;++i){var r=t[i],n=r.a<0?-this._radius:this._radius,o=r.b<0?-this._radius:this._radius,s=r.c<0?-this._radius:this._radius;if(r.a*(this._centerX+n)+r.b*(this._centerY+o)+r.c*(this._centerZ+s)-r.d<0)return!1}return!0},e.prototype.rayIntersection=function(t,e,i){return this._invalid&&this._update(),this._sphere.rayIntersection(t,e,i)},e.prototype.getSphere=function(){return this._invalid&&this._update(),this._sphere},e.prototype.classifyToPlane=function(t){var e=t.a,i=t.b,r=t.c,n=e*this._centerX+i*this._centerY+r*this._centerZ-t.d;e<0&&(e=-e),i<0&&(i=-i),r<0&&(r=-r);var o=(e+i+r)*this._radius;return n>o?PlaneClassification.FRONT:n<-o?PlaneClassification.BACK:PlaneClassification.INTERSECT},e.prototype._update=function(){var e;t.prototype._update.call(this),this._targetCoordinateSpace&&(this._targetCoordinateSpace==this._picker.entity?e=this._picker.entity.transform.matrix3D:(e=this._picker.entity.transform.concatenatedMatrix3D.clone(),this._targetCoordinateSpace.parent&&e.append(this._targetCoordinateSpace.parent.transform.inverseConcatenatedMatrix3D))),this._sphere=this._picker._getSphereBoundsInternal(null,e,this._strokeFlag,this._fastFlag,this._sphere);var i=this._picker.entity.transform.concatenatedMatrix3D,r=this._sphere.x,n=this._sphere.y,o=this._sphere.z,s=this._sphere.radius,a=i._rawData,l=a[0],h=a[4],c=a[8],u=a[12],p=a[1],d=a[5],f=a[9],_=a[13],g=a[2],m=a[6],y=a[10],v=a[14];this._centerX=r*l+n*h+o*c+u,this._centerY=r*p+n*d+o*f+_,this._centerZ=r*g+n*m+o*y+v;var b=l+h+c,x=p+d+f,A=g+m+y;this._radius=s*Math.sqrt((b*b+x*x+A*A)/3)},e}(BoundingVolumeBase),NullBounds=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.isInFrustum=function(t,e){return!0},e.prototype.classifyToPlane=function(t){return PlaneClassification.INTERSECT},e}(BoundingVolumeBase),_a,_b,_c,BoundingVolumePool=function(){function t(e,i){this._boundingVolumePool=new Object,this._picker=e,this._strokeFlag=t._strokeDict[i],this._fastFlag=t._fastDict[i],this._boundingVolumeClass=t._boundsDict[i]}return Object.defineProperty(t.prototype,"picker",{get:function(){return this._picker},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeFlag",{get:function(){return this._strokeFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fastFlag",{get:function(){return this._fastFlag},enumerable:!0,configurable:!0}),t.prototype.getAbstraction=function(t){var e=t?t.id:-1;return this._boundingVolumePool[e]||(this._boundingVolumePool[e]=new this._boundingVolumeClass(t,this))},t.prototype.clearAbstraction=function(t){delete this._boundingVolumePool[t?t.id:-1]},t.prototype.dispose=function(){for(var t in this._boundingVolumePool)this._boundingVolumePool[t].onClear(null)},t._strokeDict=((_a={})[BoundingVolumeType.BOX]=!1,_a[BoundingVolumeType.BOX_FAST]=!1,_a[BoundingVolumeType.BOX_BOUNDS]=!0,_a[BoundingVolumeType.BOX_BOUNDS_FAST]=!0,_a[BoundingVolumeType.SPHERE]=!1,_a[BoundingVolumeType.SPHERE_FAST]=!1,_a[BoundingVolumeType.SPHERE_BOUNDS]=!0,_a[BoundingVolumeType.SPHERE_FAST]=!0,_a[BoundingVolumeType.NULL]=!1,_a),t._fastDict=((_b={})[BoundingVolumeType.BOX]=!1,_b[BoundingVolumeType.BOX_FAST]=!0,_b[BoundingVolumeType.BOX_BOUNDS]=!1,_b[BoundingVolumeType.BOX_BOUNDS_FAST]=!0,_b[BoundingVolumeType.SPHERE]=!1,_b[BoundingVolumeType.SPHERE_FAST]=!0,_b[BoundingVolumeType.SPHERE_BOUNDS]=!1,_b[BoundingVolumeType.SPHERE_FAST]=!0,_b[BoundingVolumeType.NULL]=!1,_b),t._boundsDict=((_c={})[BoundingVolumeType.BOX]=BoundingBox,_c[BoundingVolumeType.BOX_FAST]=BoundingBox,_c[BoundingVolumeType.BOX_BOUNDS]=BoundingBox,_c[BoundingVolumeType.BOX_BOUNDS_FAST]=BoundingBox,_c[BoundingVolumeType.SPHERE]=BoundingSphere,_c[BoundingVolumeType.SPHERE_FAST]=BoundingSphere,_c[BoundingVolumeType.SPHERE_BOUNDS]=BoundingSphere,_c[BoundingVolumeType.SPHERE_FAST]=BoundingSphere,_c[BoundingVolumeType.NULL]=NullBounds,_c),t}(),PickEntity=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n._boundingVolumePools=new Object,n._orientedBoxBounds=[],n._orientedBoxBoundsDirty=[!0,!0],n._orientedSphereBounds=[],n._orientedSphereBoundsDirty=[!0,!0],n._pickablePool=new Object,n._pickables=[],n.shapeFlag=!1,n._view=e,n._entity=i,n._pickGroup=r,n._pickingCollision=new PickingCollision(n._entity),n}return __extends(e,t),Object.defineProperty(e.prototype,"pickingCollision",{get:function(){return this._pickingCollision},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pickGroup",{get:function(){return this._pickGroup},enumerable:!0,configurable:!0}),e.prototype.getBoundingVolume=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),null==e&&(e=this._entity.defaultBoundingVolume),(this._boundingVolumePools[e]||(this._boundingVolumePools[e]=new BoundingVolumePool(this,e))).getAbstraction(t)},e.prototype.hitTestPoint=function(t,e,i){return void 0===i&&(i=!1),this._hitTestPointInternal(this._entity,t,e,i,!1)},e.prototype._hitTestPointInternal=function(t,e,i,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!(-1==this._entity.maskId||n&&r))return!1;this._invalid&&this._update();var o=new Point(e,i);this._entity.transform.globalToLocal(o,o);var s=this._getBoxBoundsInternal(null,!1,!0);if(null==s||!s.contains(o.x,o.y,0))return!1;if(!r||"[asset TextField]"==this._entity.assetType||"[asset Billboard]"==this._entity.assetType)return!0;for(var a=this._pickables.length,l=!1,h=0;h<a;h++)if(this._pickables[h].hitTestPoint(o.x,o.y,0)){l=!0;break}if(!l)return!1;var c=this._entity.maskOwners;if(c){var u,p,d,f,_=c.length;for(h=0;h<_;h++)if((u=c[h]).isDescendant(t)){d=(p=u.masks).length,f=!1;for(var g=0;g<d;g++)if((u=p[g]).isDescendant(t)&&u&&this._pickGroup.getBoundsPicker(u.partition)._hitTestPointInternal(t,e,i,r,!0)){f=!0;break}if(!f)return!1}}return!0},e.prototype.isIntersectingRay=function(t,e){return this._isIntersectingRayInternal(this._entity,t,e)},e.prototype._isIntersectingRayInternal=function(t,e,i){this._pickingCollision.rayPosition=this._entity.transform.inverseConcatenatedMatrix3D.transformVector(e,this._pickingCollision.rayPosition),this._pickingCollision.rayDirection=this._entity.transform.inverseConcatenatedMatrix3D.deltaTransformVector(i,this._pickingCollision.rayDirection),this._pickingCollision.normal=this._pickingCollision.normal||new Vector3D;var r=this.getBoundingVolume().rayIntersection(this._pickingCollision.rayPosition,this._pickingCollision.rayDirection,this._pickingCollision.normal);return!(r<0||!this._isIntersectingMasks(t,e,i))&&(this._pickingCollision.rayEntryDistance=r,this._pickingCollision.globalRayPosition=e,this._pickingCollision.globalRayDirection=i,this._pickingCollision.rayOriginIsInsideBounds=0==r,!0)},e.prototype.isIntersectingShape=function(t){for(var e=!1,i=0;i<this._pickables.length;i++)if(this._pickables[i].testCollision(this._pickingCollision,t)){if(!t)return!0;e=!0}return e},e.prototype.getBoxBounds=function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e=!1),void 0===i&&(i=!1),this._getBoxBoundsInternal(t?t.transform.matrix3D:null,e,i)},e.prototype._getBoxBoundsInternal=function(t,e,i,r,n){void 0===t&&(t=null),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=null),this._invalid&&this._update();var o=this._pickables.length;if(o)if(i){var s,a=e?1:0;if(this._orientedBoxBoundsDirty[a]){this._orientedBoxBoundsDirty[a]=!1;for(var l=0;l<o;l++)s=this._pickables[l].getBoxBounds(null,e,this._orientedBoxBounds[a],s);this._orientedBoxBounds[a]=s}else s=this._orientedBoxBounds[a];null!=s&&(n=t?t.transformBox(s).union(n,n||r):s.union(n,n||r))}else for(l=0;l<o;l++)n=this._pickables[l].getBoxBounds(t,e,r,n);return n},e.prototype.getSphereBounds=function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e=!1),void 0===i&&(i=!1),this._getSphereBoundsInternal(null,t?t.transform.matrix3D:null,e,i)},e.prototype._getSphereBoundsInternal=function(t,e,i,r,n,o){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===n&&(n=null),void 0===o&&(o=null),this._invalid&&this._update();var s=this._getBoxBoundsInternal(e,i);if(null!=s){t||((t=new Vector3D).x=s.x+s.width/2,t.y=s.y+s.height/2,t.z=s.z+s.depth/2);var a=this._pickables.length;if(a)if(r){var l,h=i?1:0;if(this._orientedSphereBoundsDirty[h]){this._orientedSphereBoundsDirty[h]=!1;for(var c=0;c<a;c++)l=this._pickables[c].getSphereBounds(t,null,i,this._orientedSphereBounds[h],l);this._orientedSphereBounds[h]=l}else l=this._orientedSphereBounds[h];null!=l&&(o=e?e.transformSphere(l).union(o,o||n):l.union(o,o||n))}else for(c=0;c<a;c++)o=this._pickables[c].getSphereBounds(t,e,i,n,o);return o}},e.prototype.applyTraversable=function(t){this._pickables.push(this.getAbstraction(t))},e.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e),this._pickables=[],this._orientedBoxBoundsDirty[0]=!0,this._orientedBoxBoundsDirty[1]=!0,this._orientedSphereBoundsDirty[0]=!0,this._orientedSphereBoundsDirty[1]=!0,this.dispatchEvent(new BoundsPickerEvent(BoundsPickerEvent.INVALIDATE_BOUNDS,this))},e.prototype.onClear=function(e){for(var i in t.prototype.onClear.call(this,e),this._boundingVolumePools)this._boundingVolumePools[i].dispose(),delete this._boundingVolumePools[i]},e.prototype.getAbstraction=function(t){return this._pickablePool[t.id]||(this._pickablePool[t.id]=new e._pickPickableClassPool[t.assetType](t,this))},e.prototype.clearAbstraction=function(t){delete this._pickablePool[t.id],this.onInvalidate(null)},e.registerPickable=function(t,i){e._pickPickableClassPool[i.assetType]=t},e.prototype._update=function(){this._invalid=!1,this._entity._acceptTraverser(this)},e.prototype._isIntersectingMasks=function(t,e,i){var r=this._entity.maskOwners;if(r)for(var n,o,s,a,l=r.length,h=0;h<l;h++)if((n=r[h]).isDescendant(t)){s=(o=n.masks).length,a=!1;for(var c=0;c<s;c++)if((n=o[c]).isDescendant(t)&&n&&this._pickGroup.getRaycastPicker(n.partition)._getCollisionInternal(e,i,!0,!0)){a=!0;break}if(!a)return!1}return!0},e._pickPickableClassPool=new Object,e}(AbstractionBase),_Pick_PickableBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.sourceEntity=i.entity,r._view=i.view,r._pickGroup=i.pickGroup,r.pickable=e,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._view=null,this.pickable=null},e.prototype.hitTestPoint=function(t,e,i){throw new AbstractMethodError},e.prototype.getBoxBounds=function(t,e,i,r){return void 0===r&&(r=null),r},e.prototype.getSphereBounds=function(t,e,i,r,n){return void 0===n&&(n=null),n},e.prototype.testCollision=function(t,e){throw new AbstractMethodError},e}(AbstractionBase),ViewEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._view=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),e.INVALIDATE_VIEW_MATRIX3D="invalidateViewMatrix3D",e.INVALIDATE_SIZE="invalidateSize",e}(EventBase),NodeBase=function(){function t(t,e){this._childNodes=new Array,this._numChildNodes=0,this._entity=t,this._partition=e}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pickObject",{get:function(){return this._entity.pickObject},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boundsVisible",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maskId",{get:function(){return this._entity.maskId},enumerable:!0,configurable:!0}),t.prototype.getBoundsPrimitive=function(t){throw new AbstractMethodError},t.prototype.isInFrustum=function(t,e){return!0},t.prototype.isVisible=function(){return this._entity._iIsVisible()},t.prototype.isIntersectingRay=function(t,e,i,r){return!0},t.prototype.isRenderable=function(){return!0},t.prototype.isCastingShadow=function(){return!0},t.prototype.dispose=function(){this.parent=null,this._childNodes=null},t.prototype.acceptTraverser=function(t){if(this._partition.root==this._entity&&this._partition.updateEntities(),(t.partition==this._partition||t==t.getTraverser(this._partition))&&t.enterNode(this))for(var e=0;e<this._numChildNodes;e++)this._childNodes[e].acceptTraverser(t)},t.prototype.iAddNode=function(t){t.parent=this,this._childNodes[this._numChildNodes++]=t},t.prototype.iRemoveNode=function(t){var e=this._childNodes.indexOf(t);this._childNodes[e]=this._childNodes[--this._numChildNodes],this._childNodes.pop()},t}(),PartitionBase=function(t){function e(e,i){void 0===i&&(i=!1);var r=t.call(this)||this;return r._children=new Array,r._abstractionPool=new Object,r._updateQueue={},r._root=e,r._root.addEventListener(AssetEvent.CLEAR,(function(t){return r._onRootClear(t)})),i&&(r._scene=e),r}return __extends(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),e.prototype.addChild=function(t){return t&&t.parent&&t.parent.removeChildInternal(t),this._children.push(t),t._setParent(this),t},e.prototype.removeChild=function(t){return this.removeChildInternal(t),t._setParent(null),t},e.prototype.removeChildInternal=function(t){return this._children.splice(this._children.indexOf(t),1)[0]},e.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new e._abstractionClassPool[t.assetType](t,this))},e.prototype.getPartition=function(t){return null},e.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},e.prototype.traverse=function(t){this._invalid=!1,this._rootNode.acceptTraverser(t)},e.prototype.invalidateEntity=function(t){this._invalid||this.invalidate(),this._updateQueue[t.id]=t},e.prototype.updateEntity=function(t){t._iInternalUpdate(),this.updateNode(this.getAbstraction(t))},e.prototype.updateNode=function(t){var e=this.findParentForNode(t);e&&t.parent!=e&&(t.parent&&t.parent.iRemoveNode(t),e.iAddNode(t))},e.prototype.clearEntity=function(t){this._invalid||this.invalidate(),delete this._updateQueue[t.id],this.clearNode(this.getAbstraction(t))},e.prototype.clearNode=function(t){t.parent&&(t.parent.iRemoveNode(t),t.parent=null)},e.prototype.findParentForNode=function(t){return this._rootNode},e.prototype.updateEntities=function(){for(var t in this._updateQueue)this.updateEntity(this._updateQueue[t]);this._updateQueue={}},e.prototype.invalidate=function(){this._invalid=!0,t.prototype.invalidate.call(this),this._parent&&this._parent.invalidate()},e.prototype.dispose=function(){for(var t in this._abstractionPool)this._abstractionPool[t].onClear(null)},e.prototype._setParent=function(t){this._parent&&(this._parent.clearNode(this._rootNode),this._parent.invalidate()),this._parent=t,t&&(t.updateNode(this._rootNode),t.invalidate()),this._setScene(t?t.scene:null)},e.prototype._setScene=function(t){if(this._scene!=t){this._scene=t;for(var e=this._children.length,i=0;i<e;++i)this._children[i]._setScene(t)}},e.prototype._onRootClear=function(t){this.clear(),this._abstractionPool},e.registerAbstraction=function(t,i){e._abstractionClassPool[i.assetType]=t},e._abstractionClassPool=new Object,e}(AssetBase),BasicPartition=function(t){function e(e){var i=t.call(this,e)||this;return i._rootNode=new NodeBase(e,i),i}return __extends(e,t),e}(PartitionBase),EntityNode=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),Object.defineProperty(e.prototype,"entity",{get:function(){return this._asset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pickObject",{get:function(){return this._asset.pickObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundsVisible",{get:function(){return this._asset.boundsVisible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maskId",{get:function(){return this._asset.maskId},enumerable:!0,configurable:!0}),e.prototype.getBoundsPrimitive=function(t){return this._asset.getBoundsPrimitive(t)},e.prototype.isCastingShadow=function(){return this._asset.castsShadows},e.prototype.onClear=function(e){this._pool.clearEntity(this._asset),t.prototype.onClear.call(this,e)},e.prototype.isInFrustum=function(t,e){return!!this._asset._iIsVisible()},e.prototype.isVisible=function(){return this._asset._iIsVisible()},e.prototype.isIntersectingRay=function(t,e,i,r){return r.getAbstraction(this._asset)._isIntersectingRayInternal(t,e,i)},e.prototype.isRenderable=function(){return this._asset._iAssignedColorTransform()._isRenderable()},e.prototype.acceptTraverser=function(t){t.enterNode(this)&&t.applyEntity(this._asset)},e}(AbstractionBase),RaycastPicker=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n.shapeFlag=!1,n.findClosestCollision=!1,n._entities=[],n._pickers=[],n._collectedEntities=[],n._pickGroup=e,n._partition=i,n._entity=i.root,n}return __extends(e,t),Object.defineProperty(e.prototype,"partition",{get:function(){return this._partition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),e.prototype.traverse=function(){this._entities.length=0,this._pickers.length=0,this._partition.traverse(this)},e.prototype.getTraverser=function(t){if(t.root._iIsMouseEnabled()||t.root.isDragEntity()){var e=this._pickGroup.getRaycastPicker(t);return e._isIntersectingRayInternal(this._rootEntity,this._globalRayPosition,this._globalRayDirection,this._shapeFlag)&&this._pickers.push(e),e}return this},Object.defineProperty(e.prototype,"dragEntity",{get:function(){return this._dragEntity},set:function(t){this._dragEntity!=t&&(this._dragEntity&&this._dragEntity._stopDrag(),this._dragEntity=t,this._dragEntity&&this._dragEntity._startDrag())},enumerable:!0,configurable:!0}),e.prototype.enterNode=function(t){return!(!t.isVisible()||t.maskId!=this._rootEntity.maskId)&&(t.pickObject?(t.pickObject.partition.traverse(this),!1):t.isIntersectingRay(this._rootEntity,this._globalRayPosition,this._globalRayDirection,this._pickGroup))},e.prototype.isInFrustum=function(t,e){return!!this._entity._iIsVisible()},e.prototype.isIntersectingRay=function(t,e,i){return void 0===i&&(i=!1),this._isIntersectingRayInternal(this._entity,t,e,i)},e.prototype._isIntersectingRayInternal=function(t,e,i,r){return this._rootEntity=t,this._globalRayPosition=e,this._globalRayDirection=i,this._shapeFlag=this.shapeFlag||r,this.traverse(),!(!this._entities.length&&!this._pickers.length)},e.prototype.getCollision=function(t,e,i){return void 0===i&&(i=!1),this._getCollisionInternal(t,e,i,!1)},e.prototype._getCollisionInternal=function(t,e,i,r){if(!this._isIntersectingRayInternal(this._entity,t,e,i))return null;this._collectEntities(this._collectedEntities,this._dragEntity);var n=this._getPickingCollision();return this._collectedEntities.length=0,n},e.prototype._collectEntities=function(t,e){for(var i,r,n=this._pickers.length,o=0;o<n;o++)(i=this._pickers[o]).entity!=e&&i._collectEntities(t,e);for(o=0;o<this._entities.length;++o)(r=this._entities[o]).pickingCollision.pickerEntity=this._entity,t.push(r)},e.prototype.setIgnoreList=function(t){this._ignoredEntities=t},e.prototype.isIgnored=function(t){if(this._ignoredEntities)for(var e=this._ignoredEntities.length,i=0;i<e;i++)if(this._ignoredEntities[i]==t)return!0;return!1},e.prototype.sortOnNearT=function(t,e){return t.pickingCollision.rayEntryDistance>e.pickingCollision.rayEntryDistance?1:t.pickingCollision.rayEntryDistance<e.pickingCollision.rayEntryDistance?-1:0},e.prototype._getPickingCollision=function(){var t,e,i;this._collectedEntities=this._collectedEntities.sort(this.sortOnNearT);for(var r=this._collectedEntities.length,n=0;n<r&&(e=(t=this._collectedEntities[n]).pickingCollision,null==i||e.rayEntryDistance<i.rayEntryDistance);n++)if(this._shapeFlag||t.shapeFlag)e.rayEntryDistance=Number.MAX_VALUE,t.isIntersectingShape(this.findClosestCollision)&&(i=e);else if(!e.rayOriginIsInsideBounds){i=e;break}return i&&this.updatePosition(i),this._dragEntity&&"[asset MovieClip]"==this._dragEntity.assetType&&this._dragEntity.adapter&&this._dragEntity.adapter.setDropTarget(i?i.entity:null),i},e.prototype.updatePosition=function(t){var e=t.position||(t.position=new Vector3D),i=t.rayDirection,r=t.rayPosition,n=t.rayEntryDistance;e.x=r.x+n*i.x,e.y=r.y+n*i.y,e.z=r.z+n*i.z},e.prototype.dispose=function(){},e.prototype.applyEntity=function(t){if(!this.isIgnored(t)){var e=this._pickGroup.getAbstraction(t);this._entities.push(e)}},e}(AbstractionBase),BoundsPicker=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n._boundingVolumePools=new Object,n._boundsPickers=[],n._pickGroup=e,n._partition=i,n._entity=i.root,n}return __extends(e,t),Object.defineProperty(e.prototype,"partition",{get:function(){return this._partition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){var t=this.getBoxBounds();return null==t?0:t.width*this._entity.transform.scale.x},set:function(t){var e=this.getBoxBounds();null!=e&&0!=e.width&&this._entity.transform.scaleTo(t/e.width,this._entity.transform.scale.y,this._entity.transform.scale.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){var t=this.getBoxBounds();return null==t?0:t.height*this._entity.transform.scale.y},set:function(t){var e=this.getBoxBounds();null!=e&&0!=e.height&&this._entity.transform.scaleTo(this._entity.transform.scale.x,t/e.height,this._entity.transform.scale.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){var t=this.getBoxBounds();return null==t?0:t.depth*this._entity.transform.scale.z},set:function(t){var e=this.getBoxBounds();null!=e&&0!=e.depth&&this._entity.transform.scaleTo(this._entity.transform.scale.x,this._entity.transform.scale.y,t/e.depth)},enumerable:!0,configurable:!0}),e.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e),this.dispatchEvent(new BoundsPickerEvent(BoundsPickerEvent.INVALIDATE_BOUNDS,this))},e.prototype.traverse=function(){this._boundsPickers.length=0,this._partition.traverse(this),this._invalid=!1},e.prototype.getTraverser=function(t){var e=this._pickGroup.getBoundsPicker(t);return this._invalid&&this._boundsPickers.push(e),e},e.prototype.enterNode=function(t){return!0},e.prototype.getBoundingVolume=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),null==e&&(e=this._entity.defaultBoundingVolume),(this._boundingVolumePools[e]||(this._boundingVolumePools[e]=new BoundingVolumePool(this,e))).getAbstraction(t)},e.prototype.getBoxBounds=function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e=!1),void 0===i&&(i=!1),this.getBoundingVolume(t,e?i?BoundingVolumeType.BOX_BOUNDS_FAST:BoundingVolumeType.BOX_BOUNDS:i?BoundingVolumeType.BOX_FAST:BoundingVolumeType.BOX).getBox()},e.prototype.getSphereBounds=function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e=!1),void 0===i&&(i=!1),this.getBoundingVolume(t,e?i?BoundingVolumeType.SPHERE_BOUNDS_FAST:BoundingVolumeType.SPHERE_BOUNDS:i?BoundingVolumeType.SPHERE_FAST:BoundingVolumeType.SPHERE).getSphere()},e.prototype.hitTestPoint=function(t,e,i){return void 0===i&&(i=!1),this._hitTestPointInternal(this._entity,t,e,i,!1)},e.prototype._hitTestPointInternal=function(t,e,i,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!(-1==this._entity.maskId||n&&r))return!1;this._invalid&&this.traverse();var o=new Point(e,i);this._entity.transform.globalToLocal(o,o);var s=this.getBoxBounds(null,!1,!0);if(null==s||!s.contains(o.x,o.y,0))return!1;if(!r||"[asset TextField]"==this._entity.assetType||"[asset Billboard]"==this._entity.assetType)return!0;var a=this._boundsPickers.length;if(a)for(var l=0;l<a;++l)if(this._boundsPickers[l]._hitTestPointInternal(t,e,i,r,n))return!0},e.prototype.hitTestObject=function(t){var e=t.getBoxBounds(this._entity,!0);if(null==e)return!1;var i=this.getBoxBounds(this._entity,!0);return null!=i&&!!e.intersects(i)},e.prototype._getBoxBoundsInternal=function(t,e,i,r,n){void 0===t&&(t=null),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=null),this._invalid&&this.traverse();var o=this._boundsPickers.length;if(o>0)for(var s=new Matrix3D,a=0;a<o;++a)this._boundsPickers[a].entity!=this._entity?(t?s.copyFrom(t):s.identity(),s.prepend(this._boundsPickers[a].entity.transform.matrix3D),this._boundsPickers[a].entity._registrationMatrix3D&&s.prepend(this._boundsPickers[a].entity._registrationMatrix3D),n=this._boundsPickers[a]._getBoxBoundsInternal(s,e,i,r,n)):n=this._boundsPickers[a]._getBoxBoundsInternal(t,e,i,r,n);return n},e.prototype._getSphereBoundsInternal=function(t,e,i,r,n,o){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===n&&(n=null),void 0===o&&(o=null),this._invalid&&this.traverse();var s=this._getBoxBoundsInternal(e,i,r);if(null!=s){t||((t=new Vector3D).x=s.x+s.width/2,t.y=s.y+s.height/2,t.z=s.z+s.depth/2);var a=this._boundsPickers.length;if(a>0)for(var l=new Matrix3D,h=0;h<a;++h)this._boundsPickers[h].entity!=this._entity?(e?l.copyFrom(e):l.identity(),l.prepend(this._boundsPickers[h].entity.transform.matrix3D),this._boundsPickers[h].entity._registrationMatrix3D&&l.prepend(this._boundsPickers[h].entity._registrationMatrix3D),o=this._boundsPickers[h]._getSphereBoundsInternal(t,l,i,r,n,o)):o=this._boundsPickers[h]._getSphereBoundsInternal(t,e,i,r,n,o);return o}},e.prototype.isInFrustum=function(t,e){return!!this._entity._iIsVisible()},e.prototype.onClear=function(e){for(var i in t.prototype.onClear.call(this,e),this._boundingVolumePools)this._boundingVolumePools[i].dispose(),delete this._boundingVolumePools[i]},e.prototype.dispose=function(){},e.prototype.applyEntity=function(t){this._boundsPickers.push(this._pickGroup.getAbstraction(t))},e}(AbstractionBase),TabPicker=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._tabEntities=[],r._customTabEntities=[],r._customTabEntitiesSorted=[],r._partition=e,r._entity=e.root,r}return __extends(e,t),Object.defineProperty(e.prototype,"partition",{get:function(){return this._partition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),e.prototype.sortTabEnabledEntities=function(){if(!(this._customTabEntities.length<=0&&this._tabEntities.length<=0)){var t,e=[],i=0,r=0;if(this._customTabEntities.length>0)for(;i<this._customTabEntities.length;)this._customTabEntities[i]&&(this._customTabEntities[i]=this._customTabEntities[i].reverse()),i++;else{for(t=this._tabEntities.length,i=0;i<t;i++){var n=this._tabEntities[i],o=n.transform.concatenatedMatrix3D.position,s=Math.floor(o.y/10);e.length<=s&&(e.length=s+1),e[s]||(e[s]=[]),e[s].push(n)}for(this._tabEntities.length=0,i=0;i<e.length;i++){var a=e[i];if(a)for(a=a.sort((function(t,e){return t.transform.concatenatedMatrix3D.position.x>e.transform.concatenatedMatrix3D.position.x?1:-1})),r=0;r<a.length;r++)this._tabEntities[this._tabEntities.length]=a[r]}}}},e.prototype.traverse=function(){this._tabEntities.length=0,this._customTabEntities.length=0,this._customTabEntitiesSorted.length=0,this._partition.traverse(this),this.sortTabEnabledEntities(),this._invalid=!1},e.prototype.getTraverser=function(t){return this},e.prototype.getNextTabEntity=function(t){if(this._invalid&&this.traverse(),this._customTabEntities.length<=0&&this._tabEntities.length<=0)return t;if(this._customTabEntities.length>0){var e=0,i=0,r=0,n=0;if(t)for(;e<this._customTabEntities.length;){if(this._customTabEntities[e])for(r=0;r<this._customTabEntities[e].length;r++)if(this._customTabEntities[e][r]==t){for(n=r+1;n<this._customTabEntities[e].length;){if(this._customTabEntities[e][n])return this._customTabEntities[e][n];n++}for(i=e+1;i<this._customTabEntities.length;){if(this._customTabEntities[i])for(n=0;n<this._customTabEntities[i].length;n++)if(this._customTabEntities[i][n])return this._customTabEntities[i][n];i++}for(i=0;i<this._customTabEntities.length;){if(this._customTabEntities[i])for(n=0;n<this._customTabEntities[i].length;n++)if(this._customTabEntities[i][n])return this._customTabEntities[i][n];i++}}e++}for(i=0;i<this._customTabEntities.length;){if(this._customTabEntities[i])for(n=0;n<this._customTabEntities[i].length;n++)if(this._customTabEntities[i][n])return this._customTabEntities[i][n];i++}return t}var o=this._tabEntities.length;for(e=0;e<o;e++)if(this._tabEntities[e]==t)return e==o-1?this._tabEntities[0]:this._tabEntities[e+1];return this._tabEntities[0]},e.prototype.getPrevTabEntity=function(t){if(this._invalid&&this.traverse(),this._customTabEntities.length<=0&&this._tabEntities.length<=0)return t;if(this._customTabEntities.length>0){var e=this._customTabEntities.length,i=0,r=0,n=0;if(t)for(;e>0;)if(e--,this._customTabEntities[e])for(r=this._customTabEntities[e].length-1;r>=0;r--)if(this._customTabEntities[e][r]==t){for(n=r-1;n>0;)if(n--,this._customTabEntities[e][n])return this._customTabEntities[e][n];for(i=e-1;i>0;)if(i--,this._customTabEntities[i])for(n=this._customTabEntities[i].length-1;n>=0;n--)if(this._customTabEntities[i][n])return this._customTabEntities[i][n];for(i=this._customTabEntities.length;i>0;)if(i--,this._customTabEntities[i])for(n=this._customTabEntities[i].length-1;n>=0;n--)if(this._customTabEntities[i][n])return this._customTabEntities[i][n]}for(i=this._customTabEntities.length-1;i>0;)if(i--,this._customTabEntities[i])for(n=this._customTabEntities[i].length-1;n>=0;n--)if(this._customTabEntities[i][n])return this._customTabEntities[i][n];return t}if(t)for(e=this._tabEntities.length-1;e>=0;e--)if(this._tabEntities[e]==t)return 0==e?this._tabEntities[this._tabEntities.length-1]:this._tabEntities[e-1];return this._tabEntities[0]},e.prototype.enterNode=function(t){return!!t.isVisible()},e.prototype.dispose=function(){},e.prototype.applyEntity=function(t){t.tabEnabled&&("[asset TextField]"==t.assetType&&"input"!=t.type||(t.tabIndex>=0?(this._customTabEntities.length<t.tabIndex&&(this._customTabEntities.length=t.tabIndex),this._customTabEntities[t.tabIndex]||(this._customTabEntities[t.tabIndex]=[]),this._customTabEntities[t.tabIndex].push(t)):this._tabEntities[this._tabEntities.length]=t))},e}(AbstractionBase),PickGroup=function(){function t(e){this._entityPool=new Object,this._view=e,this._raycastPickerPool=new RaycastPickerPool(this),this._boundsPickerPool=new BoundsPickerPool(this),this._tabPickerPool=t._tabPickerPool||(t._tabPickerPool=new TabPickerPool)}return Object.defineProperty(t,"instancePool",{get:function(){return t._instancePool},enumerable:!0,configurable:!0}),t.clearAllInstances=function(){for(var t in this._instancePool){var e=this._instancePool[t];if(e){for(var i in e._entityPool)e._entityPool[i]&&e._entityPool[i].entity&&(e._entityPool[i].entity.isStage||e._entityPool[i].entity.dispose()),e._entityPool[i]&&delete e._entityPool[i];e._entityPool=null}delete this._instancePool[t]}},t.getInstance=function(e){return this._instancePool[e.id]||(this._instancePool[e.id]=new t(e))},t.prototype.getAbstraction=function(t){return this._entityPool[t.id]||(this._entityPool[t.id]=new PickEntity(this._view,t,this))},t.prototype.clearAbstraction=function(t){delete this._entityPool[t.id]},t.prototype.getRaycastPicker=function(t){return this._raycastPickerPool.getAbstraction(t)},t.prototype.getBoundsPicker=function(t){return this._boundsPickerPool.getAbstraction(t)},t.prototype.getTabPicker=function(t){return this._tabPickerPool.getAbstraction(t)},t._instancePool=new Object,t}(),RaycastPickerPool=function(){function t(t){this._abstractionPool=new Object,this._pickGroup=t}return t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new RaycastPicker(this._pickGroup,t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t}(),BoundsPickerPool=function(){function t(t){this._abstractionPool=new Object,this._pickGroup=t}return t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new BoundsPicker(this._pickGroup,t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t}(),TabPickerPool=function(){function t(){this._abstractionPool=new Object}return t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new TabPicker(t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t}(),View=function(t){function e(e,i,r,n,o,s){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=ContextGLProfile.BASELINE),void 0===o&&(o=ContextMode.AUTO),void 0===s&&(s=!1);var a=t.call(this)||this;return a._rect=new Rectangle,a._backgroundRed=0,a._backgroundGreen=0,a._backgroundBlue=0,a._focalLength=1e3,a._pixelRatio=1,a._frustumMatrix3D=new Matrix3D,a._viewMatrix3D=new Matrix3D,a._inverseViewMatrix3D=new Matrix3D,a._components=new Array(4),a._offset=new Vector3D,a._scale=new Vector3D(1,1,1),a._frustumMatrix3DDirty=!0,a._viewMatrix3DDirty=!0,a._inverseViewMatrix3DDirty=!0,a.backgroundAlpha=1,a.backgroundDepth=1,a.backgroundStencil=0,a.preservePixelRatio=!0,a.preserveFocalLength=!1,a.preserveDimensions=!1,a._components[0]=a._offset,a._components[3]=a._scale,a._onInvalidateSizeDelegate=function(t){return a._onInvalidateSize(t)},a._onInvalidateViewMatrix3DDelegate=function(t){return a._onInvalidateViewMatrix3D(t)},a._projection=e||new PerspectiveProjection,a._projection.addEventListener(ProjectionEvent.INVALIDATE_VIEW_MATRIX3D,a._onInvalidateViewMatrix3DDelegate),i&&(a._shareContext=!0),a._stage=i||StageManager.getInstance().getFreeStage(r,n,o,s),a._stage.addEventListener(StageEvent.INVALIDATE_SIZE,a._onInvalidateSizeDelegate),a._targetWidth=a._stage.width,a._targetHeight=a._stage.height,a._updateFocalLength(),a._updatePixelRatio(),a}return __extends(e,t),Object.defineProperty(e.prototype,"shareContext",{get:function(){return this._shareContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._shareContext||this._target?this._rect.x:this._stage.x},set:function(t){if(this._shareContext||this._target){if(this._rect.x==t)return;this._offset.x=(this._rect.x=t)/this._targetWidth,this._invalidateViewMatrix3D()}else this._stage.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._shareContext||this._target?this._rect.y:this._stage.y},set:function(t){if(this._shareContext||this._target){if(this._rect.y==t)return;this._offset.y=(this._rect.y=t)/this._targetHeight,this._invalidateViewMatrix3D()}else this._stage.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._rect.width},set:function(t){this._rect.width!=t&&(this._rect.width=t,this._shareContext||this._target?(this._scale.x=t/this._targetWidth,this._updatePixelRatio(),this._invalidateViewMatrix3D()):this._stage.width=t,this._invalidateSize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._scale.y*this._targetHeight},set:function(t){this._rect.height!=t&&(this._rect.height=t,this._shareContext||this._target?(this._scale.y=t/this._targetHeight,this._updateFocalLength(),this._updatePixelRatio(),this._invalidateViewMatrix3D()):this._stage.height=t,this._invalidateSize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor!=t&&(this._backgroundColor=t,this._backgroundRed=(t>>16&255)/255,this._backgroundGreen=(t>>8&255)/255,this._backgroundBlue=(255&t)/255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focalLength",{get:function(){return this._focalLength},set:function(t){this._focalLength!=t&&(this._focalLength=t,this._updateFocalLength())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return this._pixelRatio},set:function(t){this._pixelRatio!=t&&(this._pixelRatio=t,this._updatePixelRatio())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},set:function(t){if(null==t)throw new ErrorBase("projection cannot be null");this._projection!=t&&(this._projection.removeEventListener(ProjectionEvent.INVALIDATE_VIEW_MATRIX3D,this._onInvalidateViewMatrix3DDelegate),this._projection=t,this._projection.addEventListener(ProjectionEvent.INVALIDATE_VIEW_MATRIX3D,this._onInvalidateViewMatrix3DDelegate),this._invalidateViewMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target!=t&&this._updateTarget(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustumMatrix3D",{get:function(){return this._frustumMatrix3DDirty&&(this._frustumMatrix3DDirty=!1,this._frustumMatrix3D.recompose(this._components),this._frustumMatrix3D.prepend(this._projection.frustumMatrix3D)),this._frustumMatrix3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix3D",{get:function(){return this._viewMatrix3DDirty&&(this._viewMatrix3DDirty=!1,this._viewMatrix3D.recompose(this._components),this._viewMatrix3D.prepend(this._projection.viewMatrix3D)),this._viewMatrix3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseViewMatrix3D",{get:function(){return this._inverseViewMatrix3DDirty&&(this._inverseViewMatrix3DDirty=!1,this._inverseViewMatrix3D.copyFrom(this.viewMatrix3D),this._inverseViewMatrix3D.invert()),this._inverseViewMatrix3D},enumerable:!0,configurable:!0}),e.prototype.clear=function(t,e,i,r,n){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=ContextGLClearMask.ALL),this._stage.setRenderTarget(this._target,e,i,r),this._stage.setScissor(null==this._target?this._rect:null),t&&this._stage.clear(this._backgroundRed,this._backgroundGreen,this._backgroundBlue,this.backgroundAlpha,this.backgroundDepth,this.backgroundStencil,n)},e.prototype.present=function(){this._shareContext||null!=this._target||this._stage.context.present()},e.prototype.project=function(t,e){return void 0===e&&(e=null),(e=this._projection.project(t,e)).x=(e.x+1)*this.width/2,e.y=(e.y+1)*this.height/2,e},e.prototype.unproject=function(t,e,i,r){return void 0===r&&(r=null),this._projection.unproject(2*t/this.width-1,2*e/this.height-1,i,r)},e.prototype.dispose=function(){this._target?(this._target.removeEventListener(AssetEvent.INVALIDATE,this._onInvalidateSizeDelegate),this._target=null):(this._stage.removeEventListener(StageEvent.INVALIDATE_SIZE,this._onInvalidateSizeDelegate),this._shareContext||null!=this._target||this._stage.dispose(),this._stage=null),this._projection&&(this._projection.removeEventListener(ProjectionEvent.INVALIDATE_VIEW_MATRIX3D,this._onInvalidateViewMatrix3DDelegate),this._projection=null)},e.prototype._onInvalidateSize=function(t){this._updateDimensions(),this._updateFocalLength(),this._updatePixelRatio()},e.prototype._onInvalidateViewMatrix3D=function(t){this._invalidateViewMatrix3D()},e.prototype._updateTarget=function(t){this._target?this._target.removeEventListener(AssetEvent.INVALIDATE,this._onInvalidateSizeDelegate):this._stage.removeEventListener(StageEvent.INVALIDATE_SIZE,this._onInvalidateSizeDelegate),this._target=t,this._target?this._target.addEventListener(AssetEvent.INVALIDATE,this._onInvalidateSizeDelegate):this._stage.addEventListener(StageEvent.INVALIDATE_SIZE,this._onInvalidateSizeDelegate),this._updateDimensions(),this._updateFocalLength(),this._updatePixelRatio()},e.prototype._updateDimensions=function(){this._target?this._target instanceof Image2D?(this._targetWidth=this._target.width,this._targetHeight=this._target.height):this._target instanceof ImageCube&&(this._targetWidth=this._target.size,this._targetHeight=this._target.size):(this._targetWidth=this._stage.width,this._targetHeight=this._stage.height),this.preserveDimensions&&(this._shareContext||this._target)?(this._offset.x=this._rect.x/this._targetWidth,this._offset.y=this._rect.y/this._targetHeight,this._scale.x=this._rect.width/this._targetWidth,this._scale.y=this._rect.height/this._targetHeight):(this._rect.x=this._offset.x*this._targetWidth,this._rect.y=this._offset.y*this._targetHeight,this._rect.width=this._scale.x*this._targetWidth,this._rect.height=this._scale.y*this._targetHeight,this._invalidateSize())},e.prototype._updateFocalLength=function(){this.preserveFocalLength?this.projection.scale=this._focalLength/this._rect.height:this._focalLength=this._projection.scale*this._rect.height},e.prototype._updatePixelRatio=function(){this.preservePixelRatio?this._projection.ratio=this._pixelRatio*this._rect.width/this._rect.height:this._pixelRatio=this._projection.ratio*this._rect.height/this._rect.width},e.prototype._invalidateViewMatrix3D=function(){this._frustumMatrix3DDirty=!0,this._viewMatrix3DDirty=!0,this._inverseViewMatrix3DDirty=!0,this.dispatchEvent(new ViewEvent(ViewEvent.INVALIDATE_VIEW_MATRIX3D,this))},e.prototype._invalidateSize=function(){this.dispatchEvent(new ViewEvent(ViewEvent.INVALIDATE_SIZE,this))},e}(AssetBase);console.debug("AwayJS - View - 0.5.11");var AnimationElements=function(){function t(){this._pVertexBuffer=new Array(8),this._pBufferContext=new Array(8),this._pBufferDirty=new Array(8),this.numProcessedVertices=0,this.previousTime=Number.NEGATIVE_INFINITY,this.animationParticles=new Array;for(var e=0;e<8;e++)this._pBufferDirty[e]=!0;this._iUniqueId=t.SUBGEOM_ID_COUNT++}return t.prototype.createVertexData=function(t,e){this._numVertices=t,this._totalLenOfOneVertex=e,this._pVertexData=new Float32Array(t*e)},t.prototype.activateVertexBuffer=function(t,e,i,r){var n=i.stageIndex,o=i.context,s=this._pVertexBuffer[n];s&&this._pBufferContext[n]==o||(s=this._pVertexBuffer[n]=o.createVertexBuffer(this._numVertices,4*this._totalLenOfOneVertex),this._pBufferContext[n]=o,this._pBufferDirty[n]=!0),this._pBufferDirty[n]&&(s.uploadFromArray(this._pVertexData,0,this._numVertices),this._pBufferDirty[n]=!1),o.setVertexBufferAt(t,s,4*e,r)},t.prototype.dispose=function(){for(;this._pVertexBuffer.length;){var t=this._pVertexBuffer.pop();t&&t.dispose()}},t.prototype.invalidateBuffer=function(){for(var t=0;t<8;t++)this._pBufferDirty[t]=!0},Object.defineProperty(t.prototype,"vertexData",{get:function(){return this._pVertexData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalLenOfOneVertex",{get:function(){return this._totalLenOfOneVertex},enumerable:!0,configurable:!0}),t.SUBGEOM_ID_COUNT=0,t}(),ColorSegmentPoint=function(){function t(t,e){if(t<=0||t>=1)throw new Error("life exceeds range (0,1)");this._life=t,this._color=e}return Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"life",{get:function(){return this._life},enumerable:!0,configurable:!0}),t}(),JointPose=function(){function t(){this.orientation=new Quaternion,this.translation=new Vector3D}return t.prototype.toMatrix3D=function(t){return void 0===t&&(t=null),null==t&&(t=new Matrix3D),this.orientation.toMatrix3D(t),t.appendTranslation(this.translation.x,this.translation.y,this.translation.z),t},t.prototype.copyFrom=function(t){var e=t.orientation,i=t.translation;this.orientation.x=e.x,this.orientation.y=e.y,this.orientation.z=e.z,this.orientation.w=e.w,this.translation.x=i.x,this.translation.y=i.y,this.translation.z=i.z},t}(),ParticleAnimationData=function(t,e,i,r,n){this.index=t,this.startTime=e,this.totalTime=i+r,this.duration=i,this.delay=r,this.startVertexIndex=n.startVertexIndex,this.numVertices=n.numVertices},ParticleProperties=function(){},ParticlePropertiesMode=function(){function t(){}return t.GLOBAL=0,t.LOCAL_STATIC=1,t.LOCAL_DYNAMIC=2,t}(),Skeleton=function(t){function e(){var e=t.call(this)||this;return e.joints=new Array,e}return __extends(e,t),Object.defineProperty(e.prototype,"numJoints",{get:function(){return this.joints.length},enumerable:!0,configurable:!0}),e.prototype.jointFromName=function(t){var e=this.jointIndexFromName(t);return-1!=e?this.joints[e]:null},e.prototype.jointIndexFromName=function(t){for(var e,i;i<this.joints.length;i++){if(this.joints[i].name==t)return e;e++}return-1},e.prototype.dispose=function(){this.joints.length=0},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset Skeleton]",e}(AssetBase),SkeletonPose=function(t){function e(){var e=t.call(this)||this;return e.jointPoses=new Array,e}return __extends(e,t),Object.defineProperty(e.prototype,"numJointPoses",{get:function(){return this.jointPoses.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.jointPoseFromName=function(t){var e=this.jointPoseIndexFromName(t);return-1!=e?this.jointPoses[e]:null},e.prototype.jointPoseIndexFromName=function(t){for(var e,i;i<this.jointPoses.length;i++){if(this.jointPoses[i].name==t)return e;e++}return-1},e.prototype.clone=function(){for(var t=new e,i=this.jointPoses.length,r=0;r<i;r++){var n=new JointPose,o=this.jointPoses[r];n.name=o.name,n.copyFrom(o),t.jointPoses[r]=n}return t},e.prototype.dispose=function(){this.jointPoses.length=0},e.assetType="[asset SkeletonPose]",e}(AssetBase),VertexAnimationMode=function(){function t(){}return t.ADDITIVE="additive",t.ABSOLUTE="absolute",t}(),ShaderBase=function(){function t(t,e,i,r){this._abstractionPool=new Object,this._blendFactorSource=ContextGLBlendFactor.ONE,this._blendFactorDest=ContextGLBlendFactor.ZERO,this._invalidProgram=!0,this._animationVertexCode="",this._animationFragmentCode="",this._vertexCode="",this._fragmentCode="",this._postAnimationFragmentCode="",this.usesBlending=!1,this.useImageRect=!1,this.usesCurves=!1,this.depthCompareMode=ContextGLCompareMode.LESS_EQUAL,this.writeDepth=!0,this._defaultCulling=ContextGLTriangleFace.BACK,this._pInverseSceneMatrix=new Float32Array(16),this.ambientR=255,this.ambientG=255,this.ambientB=255,this.usesGlobalPosFragment=!1,this.usesPositionFragment=!1,this.imageIndices=new Array,this._renderElements=t,this._renderMaterial=e,this._pass=i,this._stage=r,this.profile=this._stage.profile}return Object.defineProperty(t.prototype,"pass",{get:function(){return this._pass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderMaterial",{get:function(){return this._renderMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"programData",{get:function(){return this._invalidProgram&&this._updateProgram(),this._programData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usesAnimation",{get:function(){return this._usesAnimation},set:function(t){this._usesAnimation!=t&&(this._usesAnimation=t,this.invalidateProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedVertexConstants",{get:function(){return this._invalidProgram&&this._updateProgram(),this._numUsedVertexConstants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedFragmentConstants",{get:function(){return this._invalidProgram&&this._updateProgram(),this._numUsedFragmentConstants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedStreams",{get:function(){return this._invalidProgram&&this._updateProgram(),this._numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numUsedTextures",{get:function(){return this._invalidProgram&&this._updateProgram(),this._numUsedTextures},enumerable:!0,configurable:!0}),t.prototype.getAbstraction=function(e){return this._abstractionPool[e.id]||(this._abstractionPool[e.id]=new t._abstractionClassPool[e.assetType](e,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t.registerAbstraction=function(e,i){t._abstractionClassPool[i.assetType]=e},t.prototype._includeDependencies=function(){this._renderMaterial.renderElements._includeDependencies(this),this._pass._includeDependencies(this)},t.prototype.reset=function(){this.projectionDependencies=0,this.normalDependencies=0,this.colorDependencies=0,this.viewDirDependencies=0,this.uvDependencies=0,this.secondaryUVDependencies=0,this.globalPosDependencies=0,this.tangentDependencies=0,this.usesCommonData=!1,this.usesGlobalPosFragment=!1,this.usesPositionFragment=!1,this.usesFragmentAnimation=!1,this.usesTangentSpace=!1,this.outputsNormals=!1,this.outputsTangentNormals=!1},t.prototype.setBlendMode=function(t){switch(t){case BlendMode.NORMAL:this._blendFactorSource=ContextGLBlendFactor.ONE,this._blendFactorDest=ContextGLBlendFactor.ZERO,this.usesBlending=!1;break;case BlendMode.LAYER:this._blendFactorSource=ContextGLBlendFactor.SOURCE_ALPHA,this._blendFactorDest=ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA,this.usesBlending=!0;break;case BlendMode.MULTIPLY:this._blendFactorSource=ContextGLBlendFactor.ZERO,this._blendFactorDest=ContextGLBlendFactor.SOURCE_COLOR,this.usesBlending=!0;break;case BlendMode.ADD:this._blendFactorSource=ContextGLBlendFactor.SOURCE_ALPHA,this._blendFactorDest=ContextGLBlendFactor.ONE,this.usesBlending=!0;break;case BlendMode.ALPHA:this._blendFactorSource=ContextGLBlendFactor.ZERO,this._blendFactorDest=ContextGLBlendFactor.SOURCE_ALPHA,this.usesBlending=!0;break;default:throw new ArgumentError("Unsupported blend mode!")}},t.prototype._activate=function(t){if(!this.programData.program){this.programData.program=this._stage.context.createProgram();var e=(new AGALMiniAssembler).assemble("part vertex 1\n"+this.programData.vertexString+"endpart").vertex.data,i=(new AGALMiniAssembler).assemble("part fragment 1\n"+this.programData.fragmentString+"endpart").fragment.data;this.programData.program.upload(e,i)}if(this._stage.context.setProgram(this.programData.program),this._stage.context.setCulling(this.useBothSides?ContextGLTriangleFace.NONE:this._defaultCulling,t.coordinateSystem),!this.usesTangentSpace&&this.cameraPositionIndex>=0){var r=t.transform.concatenatedMatrix3D.position;this.vertexConstantData[this.cameraPositionIndex]=r.x,this.vertexConstantData[this.cameraPositionIndex+1]=r.y,this.vertexConstantData[this.cameraPositionIndex+2]=r.z}this._stage.context.setDepthTest(this.writeDepth&&!this.usesBlending,this.depthCompareMode),this.usesBlending&&this._stage.context.setBlendFactors(this._blendFactorSource,this._blendFactorDest),this.activeElements=null},t.prototype._deactivate=function(){this._stage.context.setDepthTest(!0,ContextGLCompareMode.LESS_EQUAL),this.activeElements=null},t.prototype._setRenderState=function(t,e){var i;if(t.sourceEntity.animator&&t.sourceEntity.animator.setRenderState(this,t,this._stage,e),this.usesUVTransform){var r=t.uvMatrix;r?(i=r.rawData,this.vertexConstantData[this.uvMatrixIndex]=i[0],this.vertexConstantData[this.uvMatrixIndex+1]=i[2],this.vertexConstantData[this.uvMatrixIndex+3]=i[4],this.vertexConstantData[this.uvMatrixIndex+4]=i[1],this.vertexConstantData[this.uvMatrixIndex+5]=i[3],this.vertexConstantData[this.uvMatrixIndex+7]=i[5]):(this.vertexConstantData[this.uvMatrixIndex]=1,this.vertexConstantData[this.uvMatrixIndex+1]=0,this.vertexConstantData[this.uvMatrixIndex+3]=0,this.vertexConstantData[this.uvMatrixIndex+4]=0,this.vertexConstantData[this.uvMatrixIndex+5]=1,this.vertexConstantData[this.uvMatrixIndex+7]=0)}if(this.usesColorTransform){var n=t.sourceEntity._iAssignedColorTransform();n?(i=n._rawData,this.fragmentConstantData[this.colorTransformIndex]=i[0],this.fragmentConstantData[this.colorTransformIndex+1]=i[1],this.fragmentConstantData[this.colorTransformIndex+2]=i[2],this.fragmentConstantData[this.colorTransformIndex+3]=i[3],this.fragmentConstantData[this.colorTransformIndex+4]=i[4]/255,this.fragmentConstantData[this.colorTransformIndex+5]=i[5]/255,this.fragmentConstantData[this.colorTransformIndex+6]=i[6]/255,this.fragmentConstantData[this.colorTransformIndex+7]=i[7]/255):(this.fragmentConstantData[this.colorTransformIndex]=1,this.fragmentConstantData[this.colorTransformIndex+1]=1,this.fragmentConstantData[this.colorTransformIndex+2]=1,this.fragmentConstantData[this.colorTransformIndex+3]=1,this.fragmentConstantData[this.colorTransformIndex+4]=0,this.fragmentConstantData[this.colorTransformIndex+5]=0,this.fragmentConstantData[this.colorTransformIndex+6]=0,this.fragmentConstantData[this.colorTransformIndex+7]=0)}if(this.sceneNormalMatrixIndex>=0&&this.sceneNormalMatrix.copyFrom(t.sourceEntity.transform.inverseConcatenatedMatrix3D),this.usesTangentSpace&&this.cameraPositionIndex>=0){t.sourceEntity.transform.inverseConcatenatedMatrix3D.copyRawDataTo(this._pInverseSceneMatrix);var o=e.transform.concatenatedMatrix3D.position,s=o.x,a=o.y,l=o.z;this.vertexConstantData[this.cameraPositionIndex]=this._pInverseSceneMatrix[0]*s+this._pInverseSceneMatrix[4]*a+this._pInverseSceneMatrix[8]*l+this._pInverseSceneMatrix[12],this.vertexConstantData[this.cameraPositionIndex+1]=this._pInverseSceneMatrix[1]*s+this._pInverseSceneMatrix[5]*a+this._pInverseSceneMatrix[9]*l+this._pInverseSceneMatrix[13],this.vertexConstantData[this.cameraPositionIndex+2]=this._pInverseSceneMatrix[2]*s+this._pInverseSceneMatrix[6]*a+this._pInverseSceneMatrix[10]*l+this._pInverseSceneMatrix[14]}},t.prototype.invalidateProgram=function(){this._invalidProgram=!0},t.prototype.dispose=function(){this._programData.dispose(),this._programData=null,this._registerCache.dispose(),this._registerCache=null,this._sharedRegisters=null},t.prototype._updateProgram=function(){this._invalidProgram=!1,this._sharedRegisters=new ShaderRegisterData,this._registerCache=new ShaderRegisterCache(this.profile),this.reset(),this._includeDependencies(),this._initRegisterIndices(),this._compileDependencies(),this._vertexCode+=this._pass._getVertexCode(this._registerCache,this._sharedRegisters),this._fragmentCode+=this._pass._getFragmentCode(this._registerCache,this._sharedRegisters),this._postAnimationFragmentCode+=this._pass._getPostAnimationFragmentCode(this._registerCache,this._sharedRegisters),this._postAnimationFragmentCode+="mov "+this._registerCache.fragmentOutputRegister+", "+this._sharedRegisters.shadedTarget+"\n",this._registerCache.removeFragmentTempUsage(this._sharedRegisters.shadedTarget),this._compileAnimationCode(),this._initConstantData();var t=this._stage.getProgramData(this._animationVertexCode+this._vertexCode,this._fragmentCode+this._animationFragmentCode+this._postAnimationFragmentCode);this._programData!=t&&(this._programData&&this._programData.dispose(),this._programData=t,t.usages++)},t.prototype._initRegisterIndices=function(){this.commonsDataIndex=-1,this.cameraPositionIndex=-1,this.curvesIndex=-1,this.uvIndex=-1,this.uvMatrixIndex=-1,this.colorTransformIndex=-1,this.secondaryUVIndex=-1,this.normalIndex=-1,this.colorBufferIndex=-1,this.tangentIndex=-1,this.sceneMatrixIndex=-1,this.sceneNormalMatrixIndex=-1,this.jointIndexIndex=-1,this.jointWeightIndex=-1,this.imageIndices.length=0,this._sharedRegisters.animatedPosition=this._registerCache.getFreeVertexVectorTemp(),this._registerCache.addVertexTempUsages(this._sharedRegisters.animatedPosition,1),this._sharedRegisters.animatableAttributes.push(this._registerCache.getFreeVertexAttribute()),this._sharedRegisters.animationTargetRegisters.push(this._sharedRegisters.animatedPosition),this._vertexCode="",this._fragmentCode="",this._postAnimationFragmentCode="",(this.usesCommonData||this.normalDependencies>0)&&(this._sharedRegisters.commons=this._registerCache.getFreeFragmentConstant(),this.commonsDataIndex=4*this._sharedRegisters.commons.index),(this.tangentDependencies>0||this.outputsNormals)&&(this._sharedRegisters.tangentInput=this._registerCache.getFreeVertexAttribute(),this.tangentIndex=this._sharedRegisters.tangentInput.index,this._sharedRegisters.animatedTangent=this._registerCache.getFreeVertexVectorTemp(),this._registerCache.addVertexTempUsages(this._sharedRegisters.animatedTangent,1),this.usesTangentSpace&&(this._sharedRegisters.bitangent=this._registerCache.getFreeVertexVectorTemp(),this._registerCache.addVertexTempUsages(this._sharedRegisters.bitangent,1)),this._sharedRegisters.animatableAttributes.push(this._sharedRegisters.tangentInput),this._sharedRegisters.animationTargetRegisters.push(this._sharedRegisters.animatedTangent)),this.normalDependencies>0&&(this._sharedRegisters.normalInput=this._registerCache.getFreeVertexAttribute(),this.normalIndex=this._sharedRegisters.normalInput.index,this._sharedRegisters.animatedNormal=this._registerCache.getFreeVertexVectorTemp(),this._registerCache.addVertexTempUsages(this._sharedRegisters.animatedNormal,1),this._sharedRegisters.animatableAttributes.push(this._sharedRegisters.normalInput),this._sharedRegisters.animationTargetRegisters.push(this._sharedRegisters.animatedNormal)),this.uvDependencies>0&&(this._sharedRegisters.uvInput=this._registerCache.getFreeVertexAttribute(),this.uvIndex=this._sharedRegisters.uvInput.index,this.usesUVTransform||(this._sharedRegisters.animatedUV=this._registerCache.getFreeVertexVectorTemp(),this._registerCache.addVertexTempUsages(this._sharedRegisters.animatedUV,1))),this._sharedRegisters.shadedTarget=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(this._sharedRegisters.shadedTarget,1)},t.prototype._compileDependencies=function(){this.colorDependencies>0&&this._compileColorCode(),this.globalPosDependencies>0&&this._compileGlobalPositionCode(),this.usesPositionFragment&&this._compilePositionCode(),this.usesCurves&&this._compileCurvesCode(),this.usesColorTransform&&this._compileColorTransformCode(),this.uvDependencies>0&&this._compileUVCode(),this.secondaryUVDependencies>0&&this._compileSecondaryUVCode(),this.normalDependencies>0&&this._compileNormalCode(),this.viewDirDependencies>0&&this._compileViewDirCode(),this._vertexCode+=this._renderElements._getVertexCode(this,this._registerCache,this._sharedRegisters),this._fragmentCode+=this._renderElements._getFragmentCode(this,this._registerCache,this._sharedRegisters)},t.prototype._initConstantData=function(){this._numUsedVertexConstants=this._registerCache.numUsedVertexConstants,this._numUsedFragmentConstants=this._registerCache.numUsedFragmentConstants,this._numUsedStreams=this._registerCache.numUsedStreams,this._numUsedTextures=this._registerCache.numUsedTextures,this.vertexConstantData=new Float32Array(4*this._registerCache.numUsedVertexConstants),this.fragmentConstantData=new Float32Array(4*this._registerCache.numUsedFragmentConstants),this.viewMatrixIndex>=0?this.viewMatrix=new Matrix3D(new Float32Array(this.vertexConstantData.buffer,4*this.viewMatrixIndex,16)):this.viewMatrix&&(this.viewMatrix=null),this.sceneMatrixIndex>=0?this.sceneMatrix=new Matrix3D(new Float32Array(this.vertexConstantData.buffer,4*this.sceneMatrixIndex,16)):this.sceneMatrix&&(this.sceneMatrix=null),this.commonsDataIndex>=0&&(this.fragmentConstantData[this.commonsDataIndex]=.5,this.fragmentConstantData[this.commonsDataIndex+1]=0,this.fragmentConstantData[this.commonsDataIndex+2]=1/255,this.fragmentConstantData[this.commonsDataIndex+3]=1),this.uvMatrixIndex>=0&&(this.vertexConstantData[this.uvMatrixIndex]=1,this.vertexConstantData[this.uvMatrixIndex+1]=0,this.vertexConstantData[this.uvMatrixIndex+2]=0,this.vertexConstantData[this.uvMatrixIndex+3]=0,this.vertexConstantData[this.uvMatrixIndex+4]=0,this.vertexConstantData[this.uvMatrixIndex+5]=1,this.vertexConstantData[this.uvMatrixIndex+6]=0,this.vertexConstantData[this.uvMatrixIndex+7]=0),this.colorTransformIndex>=0&&(this.fragmentConstantData[this.colorTransformIndex]=1,this.fragmentConstantData[this.colorTransformIndex+1]=1,this.fragmentConstantData[this.colorTransformIndex+2]=1,this.fragmentConstantData[this.colorTransformIndex+3]=1,this.fragmentConstantData[this.colorTransformIndex+4]=0,this.fragmentConstantData[this.colorTransformIndex+5]=0,this.fragmentConstantData[this.colorTransformIndex+6]=0,this.fragmentConstantData[this.colorTransformIndex+7]=0),this.sceneNormalMatrixIndex>=0?this.sceneNormalMatrix=new Matrix3D(new Float32Array(this.vertexConstantData.buffer,4*this.sceneNormalMatrixIndex,16)):this.sceneNormalMatrix&&(this.sceneNormalMatrix=null),this.cameraPositionIndex>=0&&(this.vertexConstantData[this.cameraPositionIndex+3]=1),this._pass._initConstantData(),this._usesAnimation&&this._renderMaterial.animationSet.doneAGALCode(this)},t.prototype._compileColorCode=function(){this._sharedRegisters.colorInput=this._registerCache.getFreeVertexAttribute(),this.colorBufferIndex=this._sharedRegisters.colorInput.index,this._sharedRegisters.colorVarying=this._registerCache.getFreeVarying(),this._vertexCode+="mov "+this._sharedRegisters.colorVarying+", "+this._sharedRegisters.colorInput+"\n"},t.prototype._compileGlobalPositionCode=function(){this._registerCache.addVertexTempUsages(this._sharedRegisters.globalPositionVertex=this._registerCache.getFreeVertexVectorTemp(),this.globalPosDependencies);var t=this._registerCache.getFreeVertexConstant();this._registerCache.getFreeVertexConstant(),this._registerCache.getFreeVertexConstant(),this._registerCache.getFreeVertexConstant(),this.sceneMatrixIndex=4*t.index,this._vertexCode+="m44 "+this._sharedRegisters.globalPositionVertex+", "+this._sharedRegisters.animatedPosition+", "+t+"\n",this.usesGlobalPosFragment&&(this._sharedRegisters.globalPositionVarying=this._registerCache.getFreeVarying(),this._vertexCode+="mov "+this._sharedRegisters.globalPositionVarying+", "+this._sharedRegisters.globalPositionVertex+"\n")},t.prototype._compilePositionCode=function(){this._sharedRegisters.positionVarying=this._registerCache.getFreeVarying(),this._vertexCode+="mov "+this._sharedRegisters.positionVarying+", "+this._sharedRegisters.animatedPosition+"\n"},t.prototype._compileCurvesCode=function(){this._sharedRegisters.curvesInput=this._registerCache.getFreeVertexAttribute(),this.curvesIndex=this._sharedRegisters.curvesInput.index,this._sharedRegisters.curvesVarying=this._registerCache.getFreeVarying(),this._vertexCode+="mov "+this._sharedRegisters.curvesVarying+", "+this._sharedRegisters.curvesInput+"\n";var t=this._registerCache.getFreeFragmentSingleTemp();this._fragmentCode+="mul "+t+", "+this._sharedRegisters.curvesVarying+".y, "+this._sharedRegisters.curvesVarying+".y\nsub "+t+", "+t+", "+this._sharedRegisters.curvesVarying+".z\nmul "+t+", "+t+", "+this._sharedRegisters.curvesVarying+".x\nkil "+t+"\n"},t.prototype._compileColorTransformCode=function(){var t=this._registerCache.getFreeFragmentConstant(),e=this._registerCache.getFreeFragmentConstant();this.colorTransformIndex=4*t.index,this._postAnimationFragmentCode+="mul "+this._sharedRegisters.shadedTarget+", "+this._sharedRegisters.shadedTarget+", "+t+"\n",this._postAnimationFragmentCode+="add "+this._sharedRegisters.shadedTarget+", "+this._sharedRegisters.shadedTarget+", "+e+"\n"},t.prototype._compileUVCode=function(){if(this._sharedRegisters.uvVarying=this._registerCache.getFreeVarying(),this.usesUVTransform){var t=this._registerCache.getFreeVertexConstant(),e=this._registerCache.getFreeVertexConstant();this.uvMatrixIndex=4*t.index,this._vertexCode+="dp4 "+this._sharedRegisters.uvVarying+".x, "+this._sharedRegisters.uvInput+", "+t+"\ndp4 "+this._sharedRegisters.uvVarying+".y, "+this._sharedRegisters.uvInput+", "+e+"\nmov "+this._sharedRegisters.uvVarying+".zw, "+this._sharedRegisters.uvInput+".zw \n"}else this._vertexCode+="mov "+this._sharedRegisters.uvVarying+", "+this._sharedRegisters.animatedUV+"\n"},t.prototype._compileSecondaryUVCode=function(){var t=this._registerCache.getFreeVertexAttribute();this.secondaryUVIndex=t.index,this._sharedRegisters.secondaryUVVarying=this._registerCache.getFreeVarying(),this._vertexCode+="mov "+this._sharedRegisters.secondaryUVVarying+", "+t+"\n"},t.prototype._compileViewDirCode=function(){var t=this._registerCache.getFreeVertexConstant();if(this._sharedRegisters.viewDirVarying=this._registerCache.getFreeVarying(),this._sharedRegisters.viewDirFragment=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(this._sharedRegisters.viewDirFragment,this.viewDirDependencies),this.cameraPositionIndex=4*t.index,this.usesTangentSpace){var e=this._registerCache.getFreeVertexVectorTemp();this._vertexCode+="sub "+e+", "+t+", "+this._sharedRegisters.animatedPosition+"\nm33 "+this._sharedRegisters.viewDirVarying+".xyz, "+e+", "+this._sharedRegisters.animatedTangent+"\nmov "+this._sharedRegisters.viewDirVarying+".w, "+this._sharedRegisters.animatedPosition+".w\n"}else this._vertexCode+="sub "+this._sharedRegisters.viewDirVarying+", "+t+", "+this._sharedRegisters.globalPositionVertex+"\n",this._registerCache.removeVertexTempUsage(this._sharedRegisters.globalPositionVertex);this._fragmentCode+="nrm "+this._sharedRegisters.viewDirFragment+".xyz, "+this._sharedRegisters.viewDirVarying+"\nmov "+this._sharedRegisters.viewDirFragment+".w,   "+this._sharedRegisters.viewDirVarying+".w\n"},t.prototype._compileNormalCode=function(){if(this._sharedRegisters.normalFragment=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(this._sharedRegisters.normalFragment,this.normalDependencies),this.outputsNormals&&!this.outputsTangentNormals)return this._vertexCode+=this._pass._getNormalVertexCode(this._registerCache,this._sharedRegisters),void(this._fragmentCode+=this._pass._getNormalFragmentCode(this._registerCache,this._sharedRegisters));var t;if(this.outputsNormals&&this.usesTangentSpace||((t=new Array(3))[0]=this._registerCache.getFreeVertexConstant(),t[1]=this._registerCache.getFreeVertexConstant(),t[2]=this._registerCache.getFreeVertexConstant(),this._registerCache.getFreeVertexConstant(),this.sceneNormalMatrixIndex=4*t[0].index,this._sharedRegisters.normalVarying=this._registerCache.getFreeVarying()),this.outputsNormals)if(this.usesTangentSpace)this._vertexCode+="nrm "+this._sharedRegisters.animatedNormal+".xyz, "+this._sharedRegisters.animatedNormal+"\nnrm "+this._sharedRegisters.animatedTangent+".xyz, "+this._sharedRegisters.animatedTangent+"\ncrs "+this._sharedRegisters.bitangent+".xyz, "+this._sharedRegisters.animatedNormal+", "+this._sharedRegisters.animatedTangent+"\n",this._fragmentCode+=this._pass._getNormalFragmentCode(this._registerCache,this._sharedRegisters);else{this._sharedRegisters.tangentVarying=this._registerCache.getFreeVarying(),this._sharedRegisters.bitangentVarying=this._registerCache.getFreeVarying();var e,i,r,n=this._registerCache.getFreeVertexVectorTemp();this._vertexCode+="m33 "+n+".xyz, "+this._sharedRegisters.animatedNormal+", "+t[0]+"\nnrm "+this._sharedRegisters.animatedNormal+".xyz, "+n+"\nm33 "+n+".xyz, "+this._sharedRegisters.animatedTangent+", "+t[0]+"\nnrm "+this._sharedRegisters.animatedTangent+".xyz, "+n+"\nmov "+this._sharedRegisters.tangentVarying+".x, "+this._sharedRegisters.animatedTangent+".x  \nmov "+this._sharedRegisters.tangentVarying+".z, "+this._sharedRegisters.animatedNormal+".x  \nmov "+this._sharedRegisters.tangentVarying+".w, "+this._sharedRegisters.normalInput+".w  \nmov "+this._sharedRegisters.bitangentVarying+".x, "+this._sharedRegisters.animatedTangent+".y  \nmov "+this._sharedRegisters.bitangentVarying+".z, "+this._sharedRegisters.animatedNormal+".y  \nmov "+this._sharedRegisters.bitangentVarying+".w, "+this._sharedRegisters.normalInput+".w  \nmov "+this._sharedRegisters.normalVarying+".x, "+this._sharedRegisters.animatedTangent+".z  \nmov "+this._sharedRegisters.normalVarying+".z, "+this._sharedRegisters.animatedNormal+".z  \nmov "+this._sharedRegisters.normalVarying+".w, "+this._sharedRegisters.normalInput+".w  \ncrs "+n+".xyz, "+this._sharedRegisters.animatedNormal+", "+this._sharedRegisters.animatedTangent+"\nmov "+this._sharedRegisters.tangentVarying+".y, "+n+".x    \nmov "+this._sharedRegisters.bitangentVarying+".y, "+n+".y  \nmov "+this._sharedRegisters.normalVarying+".y, "+n+".z    \n",this._registerCache.removeVertexTempUsage(this._sharedRegisters.animatedTangent),e=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(e,1),i=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(i,1),r=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(r,1),this._fragmentCode+="nrm "+e+".xyz, "+this._sharedRegisters.tangentVarying+"\nmov "+e+".w, "+this._sharedRegisters.tangentVarying+".w\t\nnrm "+i+".xyz, "+this._sharedRegisters.bitangentVarying+"\nnrm "+r+".xyz, "+this._sharedRegisters.normalVarying+"\n",this._fragmentCode+=this._pass._getNormalFragmentCode(this._registerCache,this._sharedRegisters)+"m33 "+this._sharedRegisters.normalFragment+".xyz, "+this._sharedRegisters.normalFragment+", "+e+"\nmov "+this._sharedRegisters.normalFragment+".w, "+this._sharedRegisters.normalVarying+".w\n",this._registerCache.removeFragmentTempUsage(i),this._registerCache.removeFragmentTempUsage(e),this._registerCache.removeFragmentTempUsage(r)}else this._vertexCode+="m33 "+this._sharedRegisters.normalVarying+".xyz, "+this._sharedRegisters.animatedNormal+", "+t[0]+"\nmov "+this._sharedRegisters.normalVarying+".w, "+this._sharedRegisters.animatedNormal+".w\n",this._fragmentCode+="nrm "+this._sharedRegisters.normalFragment+".xyz, "+this._sharedRegisters.normalVarying+"\nmov "+this._sharedRegisters.normalFragment+".w, "+this._sharedRegisters.normalVarying+".w\n",this.tangentDependencies>0&&(this._sharedRegisters.tangentVarying=this._registerCache.getFreeVarying(),this._vertexCode+="m33 "+this._sharedRegisters.tangentVarying+".xyz, "+this._sharedRegisters.animatedTangent+", "+t[0]+"\nmov "+this._sharedRegisters.tangentVarying+".w, "+this._sharedRegisters.animatedTangent+".w\n");this.usesTangentSpace||this._registerCache.removeVertexTempUsage(this._sharedRegisters.animatedNormal)},t.prototype._compileAnimationCode=function(){if(this._animationVertexCode="",this._animationFragmentCode="",this._usesAnimation){var t=this._renderMaterial.animationSet;this._animationVertexCode+=t.getAGALVertexCode(this,this._registerCache,this._sharedRegisters),this.uvDependencies>0&&!this.usesUVTransform&&(this._animationVertexCode+=t.getAGALUVCode(this,this._registerCache,this._sharedRegisters)),this.usesFragmentAnimation&&(this._animationFragmentCode+=t.getAGALFragmentCode(this,this._registerCache,this._sharedRegisters.shadedTarget))}else{for(var e=this._sharedRegisters.animatableAttributes.length,i=0;i<e;++i)this._animationVertexCode+="mov "+this._sharedRegisters.animationTargetRegisters[i]+", "+this._sharedRegisters.animatableAttributes[i]+"\n";this.uvDependencies>0&&!this.usesUVTransform&&(this._animationVertexCode+="mov "+this._sharedRegisters.animatedUV+","+this._sharedRegisters.uvInput+"\n")}},t.prototype.setVertexConst=function(t,e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),t*=4,this.vertexConstantData[t++]=e,this.vertexConstantData[t++]=i,this.vertexConstantData[t++]=r,this.vertexConstantData[t]=n},t.prototype.setVertexConstFromArray=function(t,e){t*=4;for(var i=0;i<e.length;i++)this.vertexConstantData[t++]=e[i]},t.prototype.setVertexConstFromMatrix=function(t,e){t*=4;var i=e._rawData;this.vertexConstantData[t++]=i[0],this.vertexConstantData[t++]=i[4],this.vertexConstantData[t++]=i[8],this.vertexConstantData[t++]=i[12],this.vertexConstantData[t++]=i[1],this.vertexConstantData[t++]=i[5],this.vertexConstantData[t++]=i[9],this.vertexConstantData[t++]=i[13],this.vertexConstantData[t++]=i[2],this.vertexConstantData[t++]=i[6],this.vertexConstantData[t++]=i[10],this.vertexConstantData[t++]=i[14],this.vertexConstantData[t++]=i[3],this.vertexConstantData[t++]=i[7],this.vertexConstantData[t++]=i[11],this.vertexConstantData[t]=i[15]},t.prototype.setFragmentConst=function(t,e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),t*=4,this.fragmentConstantData[t++]=e,this.fragmentConstantData[t++]=i,this.fragmentConstantData[t++]=r,this.fragmentConstantData[t]=n},t._abstractionClassPool=new Object,t}(),PassEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._pass=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"pass",{get:function(){return this._pass},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._pass)},e.INVALIDATE="invalidatePass",e}(EventBase),MaterialEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._material=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._material)},e.INVALIDATE_TEXTURES="invalidateTextures",e.INVALIDATE_PASSES="invalidatePasses",e}(EventBase),_Render_MaterialBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._owners=new Array,r._passes=new Array,r._invalidAnimation=!0,r._invalidRender=!0,r._invalidImages=!0,r._imageIndices=new Object,r._usesAnimation=!1,r.images=new Array,r.samplers=new Array,r.requiresBlending=!1,r.materialID=e.id,r._material=e,r._renderElements=i,r._stage=i.stage,r._renderGroup=i.renderGroup,r._onInvalidateTexturesDelegate=function(t){return r.onInvalidateTextures(t)},r._onInvalidatePassesDelegate=function(t){return r.onInvalidatePasses(t)},r._material.addEventListener(MaterialEvent.INVALIDATE_TEXTURES,r._onInvalidateTexturesDelegate),r._material.addEventListener(MaterialEvent.INVALIDATE_PASSES,r._onInvalidatePassesDelegate),r._onPassInvalidateDelegate=function(t){return r.onPassInvalidate(t)},r}return __extends(e,t),Object.defineProperty(e.prototype,"animationSet",{get:function(){return this._animationSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numImages",{get:function(){return this._invalidImages&&this._updateImages(),this._numImages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOrderId",{get:function(){return this._invalidAnimation&&this._updateAnimation(),this._renderOrderId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"passes",{get:function(){return this._invalidAnimation&&this._updateAnimation(),this._passes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._material.style},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderElements",{get:function(){return this._renderElements},enumerable:!0,configurable:!0}),e.prototype.addOwner=function(t){var e;this._owners.push(t);var i=t.sourceEntity.animator;if(i&&(e=i.animationSet),t.sourceEntity.animator){if(this._animationSet&&e!=this._animationSet)throw new Error("A Material instance cannot be shared across material owners with different animation sets");this._animationSet!=e&&(this._animationSet=e,this._invalidAnimation=!0)}},e.prototype.removeOwner=function(t){this._owners.splice(this._owners.indexOf(t),1),this._owners.length||this.onClear(null)},e.prototype.getImageIndex=function(t,e){return void 0===e&&(e=0),this._invalidImages&&this._updateImages(),this._imageIndices[t.id][e]},e.prototype.onClear=function(e){t.prototype.onClear.call(this,e);for(var i=this._passes.length,r=0;r<i;r++)this._passes[r].removeEventListener(PassEvent.INVALIDATE,this._onPassInvalidateDelegate),this._passes[r].dispose();this._passes=null,this._material.removeEventListener(MaterialEvent.INVALIDATE_TEXTURES,this._onInvalidateTexturesDelegate),this._material.removeEventListener(MaterialEvent.INVALIDATE_PASSES,this._onInvalidatePassesDelegate),this._animationSet=null,this._material=null,this._renderElements=null,this._stage=null,this._owners=null},e.prototype.onInvalidatePasses=function(t){for(var e=this._passes.length,i=0;i<e;i++)this._passes[i].invalidate();this._invalidAnimation=!0,this._invalidImages=!0},e.prototype.onPassInvalidate=function(t){this._invalidAnimation=!0},e.prototype.onInvalidateTextures=function(t){for(var e=this._owners,i=e.length,r=0;r<i;r++)e[r]._onInvalidateStyle()},e.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e),this._invalidRender=!0,this._invalidAnimation=!0},e.prototype._pClearPasses=function(){for(var t=this._passes.length,e=0;e<t;++e)this._passes[e].removeEventListener(PassEvent.INVALIDATE,this._onPassInvalidateDelegate);this._passes.length=0},e.prototype._pAddPass=function(t){this._passes.push(t),t.addEventListener(PassEvent.INVALIDATE,this._onPassInvalidateDelegate)},e.prototype._pRemovePass=function(t){t.removeEventListener(PassEvent.INVALIDATE,this._onPassInvalidateDelegate),this._passes.splice(this._passes.indexOf(t),1)},e.prototype._pUpdateRender=function(){this._invalidRender=!1},e.prototype._updateAnimation=function(){this._invalidRender&&this._pUpdateRender(),this._invalidAnimation=!1;for(var t,e=this._getEnabledGPUAnimation(),i=0,r=1,n=this._passes.length,o=0;o<n;o++)(t=this._passes[o].shader).usesAnimation=e,i+=t.programData.id*r,r*=1e3;if(this._usesAnimation!=e){this._usesAnimation=e;for(var s=this._owners,a=s.length,l=0;l<a;l++)s[l]._onInvalidateElements()}this._renderOrderId=i},e.prototype._updateImages=function(){this._invalidImages=!1;for(var t,e,i,r=this._material.style,n=this._material.getNumTextures(),o=0,s=0;s<n;s++){e=(t=this._material.getTextureAt(s)).getNumImages(),i=this._imageIndices[t.id]=new Array;for(var a=0;a<e;a++)this.images[o]=this._stage.getAbstraction(t.getImageAt(a)||(r?r.getImageAt(t,a):null)||ImageUtils.getDefaultImage2D()),this.samplers[o]=t.getSamplerAt(a)||(r?r.getSamplerAt(t,a):null)||ImageUtils.getDefaultSampler(),i[a]=o++}this._numImages=o},e.prototype._getEnabledGPUAnimation=function(){if(this._animationSet){this._animationSet.resetGPUCompatibility();for(var t,e=this._owners,i=e.length,r=this._passes.length,n=0;n<r;n++){(t=this._passes[n].shader).usesAnimation=!1;for(var o=0;o<i;o++)e[o].sourceEntity.animator&&e[o].sourceEntity.animator.testGPUCompatibility(t)}return!this._animationSet.usesCPU}return!1},e}(AbstractionBase),_Render_ElementsBase=function(){function t(t,e,i){this._abstractionPool=new Object,this._stage=t,this._renderMaterialClassPool=e,this._renderGroup=i}return Object.defineProperty(t.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new this._renderMaterialClassPool[t.assetType](t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t.prototype._includeDependencies=function(t){},t.prototype._getVertexCode=function(t,e,i){return""},t.prototype._getFragmentCode=function(t,e,i){return""},t}(),RenderableEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._renderable=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"renderable",{get:function(){return this._renderable},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._renderable)},e.INVALIDATE_MATERIAL="invalidateMaterial",e.INVALIDATE_ELEMENTS="invalidateElements",e.INVALIDATE_STYLE="invalidateStyle",e}(EventBase),MaterialUtils=function(){function t(){}return t.getDefaultTextureMaterial=function(){return this._defaultTextureMaterial||this.createDefaultTextureMaterial(),this._defaultTextureMaterial},t.getDefaultCubeTextureMaterial=function(){return this._defaultCubeTextureMaterial||this.createDefaultCubeTextureMaterial(),this._defaultCubeTextureMaterial},t.getDefaultColorMaterial=function(){return t._defaultColorMaterial||t.createDefaultColorMaterial(),t._defaultColorMaterial},t.createDefaultTextureMaterial=function(){this._defaultTextureMaterial=new this._defaultMaterialClass(ImageUtils.getDefaultImage2D()),this._defaultTextureMaterial.name="defaultTextureMaterial"},t.createDefaultCubeTextureMaterial=function(){this._defaultCubeTextureMaterial=new this._defaultMaterialClass(ImageUtils.getDefaultImageCube()),this._defaultCubeTextureMaterial.name="defaultCubeTextureMaterial"},t.createDefaultColorMaterial=function(){this._defaultColorMaterial=new this._defaultMaterialClass(16777215),this._defaultColorMaterial.name="defaultColorMaterial"},t.setDefaultMaterialClass=function(t){this._defaultMaterialClass=t},t}(),_Render_RenderableBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._materialDirty=!0,r._elementsDirty=!0,r._styleDirty=!0,r._images=new Array,r._samplers=new Array,r._count=0,r._offset=0,r._onInvalidateElementsDelegate=function(t){return r._onInvalidateElements(t)},r._onInvalidateMaterialDelegate=function(t){return r._onInvalidateMaterial(t)},r._onInvalidateStyleDelegate=function(t){return r._onInvalidateStyle(t)},r.sourceEntity=i.entity,r._stage=i.stage,r.renderGroup=i.renderGroup,r._asset.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,r._onInvalidateElementsDelegate),r._asset.addEventListener(RenderableEvent.INVALIDATE_MATERIAL,r._onInvalidateMaterialDelegate),r._asset.addEventListener(RenderableEvent.INVALIDATE_STYLE,r._onInvalidateStyleDelegate),r}return __extends(e,t),Object.defineProperty(e.prototype,"images",{get:function(){return this._styleDirty&&this._updateStyle(),this._images},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samplers",{get:function(){return this._styleDirty&&this._updateStyle(),this._samplers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvMatrix",{get:function(){return this._styleDirty&&this._updateStyle(),this._uvMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageElements",{get:function(){return this._elementsDirty&&this._updateElements(),this._stageElements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderMaterial",{get:function(){return this._materialDirty&&this._updateMaterial(),this._renderMaterial},enumerable:!0,configurable:!0}),e.prototype._iRender=function(t,e){t._setRenderState(this,e);var i=this.stageElements;t.shader.activeElements!=i&&(t.shader.activeElements=i,i._setRenderState(this,t.shader,e)),this._stageElements.draw(this,t.shader,e,this._count,this._offset)},e.prototype.onClear=function(e){this._asset.removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate),this._asset.removeEventListener(RenderableEvent.INVALIDATE_MATERIAL,this._onInvalidateMaterialDelegate),this._asset.removeEventListener(RenderableEvent.INVALIDATE_STYLE,this._onInvalidateStyleDelegate),t.prototype.onClear.call(this,e),this.renderSceneTransform=null,this._stage=null,this.next=null,this.maskOwners=null,this._renderMaterial.removeOwner(this),this._renderMaterial=null,this._stageElements=null},e.prototype._onInvalidateElements=function(t){this._elementsDirty=!0},e.prototype._onInvalidateMaterial=function(t){this._materialDirty=!0,this._styleDirty=!0},e.prototype._onInvalidateStyle=function(t){this._styleDirty=!0},e.prototype._getStageElements=function(){throw new AbstractMethodError},e.prototype._getRenderMaterial=function(){throw new AbstractMethodError},e.prototype._getStyle=function(){throw new AbstractMethodError},e.prototype._updateElements=function(){this._stageElements=this._getStageElements(),this._elementsDirty=!1},e.prototype._updateMaterial=function(){var t=this._getRenderMaterial();this._renderMaterial!=t&&(this._renderMaterial&&this._renderMaterial.removeOwner(this),this._renderMaterial=t,this._renderMaterial.addOwner(this)),this._materialDirty=!1},e.prototype._updateStyle=function(){var t=this._getStyle();this._materialDirty&&this._updateMaterial();var e=this._renderMaterial.numImages,i=this._renderMaterial.material;this._images.length=e,this._samplers.length=e,this._uvMatrix=t?t.uvMatrix:i.style?i.style.uvMatrix:null;for(var r,n,o,s=this._renderMaterial.material.getNumTextures(),a=0;a<s;a++){e=(r=i.getTextureAt(a)).getNumImages();for(var l=0;l<e;l++)o=this._renderMaterial.getImageIndex(r,l),n=t?t.getImageAt(r,l):null,this._images[o]=n?this._stage.getAbstraction(n):null,this._samplers[o]=t?t.getSamplerAt(r,l):null}this._styleDirty=!1},e.prototype.getDefaultMaterial=function(){return MaterialUtils.getDefaultTextureMaterial()},e}(AbstractionBase),RenderEntity=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n._abstractionPool=new Object,n._stage=e,n._renderGroup=r,n._onInvalidateElementsDelegate=function(t){return n._onInvalidateElements(t)},n._onInvalidateMaterialDelegate=function(t){return n._onInvalidateMaterial(t)},n._onInvalidateStyleDelegate=function(t){return n._onInvalidateStyle(t)},n._asset.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,n._onInvalidateElementsDelegate),n._asset.addEventListener(RenderableEvent.INVALIDATE_MATERIAL,n._onInvalidateMaterialDelegate),n._asset.addEventListener(RenderableEvent.INVALIDATE_STYLE,n._onInvalidateStyleDelegate),n}return __extends(e,t),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._asset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),e.prototype.onClear=function(e){for(var i in this._asset.removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate),this._asset.removeEventListener(RenderableEvent.INVALIDATE_MATERIAL,this._onInvalidateMaterialDelegate),this._asset.removeEventListener(RenderableEvent.INVALIDATE_STYLE,this._onInvalidateStyleDelegate),this._abstractionPool)this._abstractionPool[i].onClear(null);t.prototype.onClear.call(this,e)},e.prototype._onInvalidateElements=function(t){for(var e in this._abstractionPool)this._abstractionPool[e]._onInvalidateElements()},e.prototype._onInvalidateMaterial=function(t){for(var e in this._abstractionPool)this._abstractionPool[e]._onInvalidateMaterial()},e.prototype._onInvalidateStyle=function(t){for(var e in this._abstractionPool)this._abstractionPool[e]._onInvalidateStyle()},e.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new e._renderRenderableClassPool[t.assetType](t,this))},e.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},e.registerRenderable=function(t,i){e._renderRenderableClassPool[i.assetType]=t},e._renderRenderableClassPool=new Object,e}(AbstractionBase),StyleEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._style=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._style)},e.INVALIDATE_PROPERTIES="invalidateProperties",e}(EventBase),Style=function(t){function e(){var e=t.call(this)||this;return e._samplers=new Object,e._images=new Object,e._color=16777215,e}return __extends(e,t),Object.defineProperty(e.prototype,"sampler",{get:function(){return this._sampler},set:function(t){this._sampler!=t&&(this._sampler=t,this._invalidateProperties())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},set:function(t){this._image!=t&&(this._image=t,this._invalidateProperties())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvMatrix",{get:function(){return this._uvMatrix},set:function(t){this._uvMatrix!=t&&(this._uvMatrix=t,this._invalidateProperties())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this._invalidateProperties())},enumerable:!0,configurable:!0}),e.prototype.getImageAt=function(t,e){return void 0===e&&(e=0),(this._images[t.id]?this._images[t.id][e]:null)||this._image},e.prototype.getSamplerAt=function(t,e){return void 0===e&&(e=0),(this._samplers[t.id]?this._samplers[t.id][e]:null)||this._sampler},e.prototype.addImageAt=function(t,e,i){void 0===i&&(i=0),this._images[e.id]||(this._images[e.id]=new Array),this._images[e.id][i]=t},e.prototype.addSamplerAt=function(t,e,i){void 0===i&&(i=0),this._samplers[e.id]||(this._samplers[e.id]=new Array),this._samplers[e.id][i]=t,this._invalidateProperties()},e.prototype.removeImageAt=function(t,e){void 0===e&&(e=0),this._images[t.id]&&(this._images[t.id][e]=null,this._invalidateProperties())},e.prototype.removeSamplerAt=function(t,e){void 0===e&&(e=0),this._samplers[t.id]&&(this._samplers[t.id][e]=null,this._invalidateProperties())},e.prototype._invalidateProperties=function(){this.dispatchEvent(new StyleEvent(StyleEvent.INVALIDATE_PROPERTIES,this))},e}(EventDispatcher),_Shader_TextureBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._texture=e,r._shader=i,r._stage=i._stage,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._texture=null,this._shader=null,this._stage=null},e.prototype._initVO=function(t){},e.prototype._initConstants=function(){},e.prototype._getFragmentCode=function(t,e,i,r){throw new AbstractMethodError},e.prototype._setRenderState=function(t){},e.prototype.activate=function(){},e.prototype.getTextureReg=function(t,e,i){var r=this._shader.imageIndices.indexOf(t);if(-1==r){var n=e.getFreeTextureReg();return i.textures.push(n),this._shader.imageIndices.push(t),n}return i.textures[r]},e}(AbstractionBase),AnimationRegisterData=function(){function t(){this.indexDictionary=new Object}return t.prototype.reset=function(t,e,i){this.rotationRegisters=new Array,this.positionAttribute=e.animatableAttributes[0],this.scaleAndRotateTarget=e.animationTargetRegisters[0];for(var r=1;r<e.animationTargetRegisters.length;r++)this.rotationRegisters.push(e.animationTargetRegisters[r]);if(this.vertexZeroConst=t.getFreeVertexConstant(),this.vertexZeroConst=new ShaderRegisterElement(this.vertexZeroConst.regName,this.vertexZeroConst.index,0),this.vertexOneConst=new ShaderRegisterElement(this.vertexZeroConst.regName,this.vertexZeroConst.index,1),this.vertexTwoConst=new ShaderRegisterElement(this.vertexZeroConst.regName,this.vertexZeroConst.index,2),this.positionTarget=t.getFreeVertexVectorTemp(),t.addVertexTempUsages(this.positionTarget,1),this.positionTarget=new ShaderRegisterElement(this.positionTarget.regName,this.positionTarget.index),i)this.velocityTarget=t.getFreeVertexVectorTemp(),t.addVertexTempUsages(this.velocityTarget,1),this.velocityTarget=new ShaderRegisterElement(this.velocityTarget.regName,this.velocityTarget.index),this.vertexTime=new ShaderRegisterElement(this.velocityTarget.regName,this.velocityTarget.index,3),this.vertexLife=new ShaderRegisterElement(this.positionTarget.regName,this.positionTarget.index,3);else{var n=t.getFreeVertexVectorTemp();t.addVertexTempUsages(n,1),this.vertexTime=new ShaderRegisterElement(n.regName,n.index,0),this.vertexLife=new ShaderRegisterElement(n.regName,n.index,1)}},t.prototype.setUVSourceAndTarget=function(t){this.uvVar=t.animatedUV,this.uvAttribute=t.uvInput,this.uvTarget=new ShaderRegisterElement(this.positionTarget.regName,this.positionTarget.index)},t.prototype.setRegisterIndex=function(t,e,i){var r=this.indexDictionary[t.id];null==r&&(r=this.indexDictionary[t.id]=new Array(8)),r[e]=i},t.prototype.getRegisterIndex=function(t,e){return this.indexDictionary[t.id][e]},t}(),AnimationNodeBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"stateClass",{get:function(){return this._pStateClass},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset AnimationNodeBase]",e}(AssetBase),ElementsEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._attributesView=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"attributesView",{get:function(){return this._attributesView},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._attributesView)},e.INVALIDATE_INDICES="invalidateIndices",e.CLEAR_INDICES="clearIndices",e.INVALIDATE_VERTICES="invalidateVertices",e.CLEAR_VERTICES="clearVertices",e}(EventBase),ElementsUtils=function(){function t(){}return t.generateFaceNormals=function(t,e,i,r,n){void 0===n&&(n=0);var o=t.get(r,n),s=e.get(e.count);null==i?i=new Float4Attributes(r+n):i.count<r+n&&(i.count=r+n);var a,l,h,c,u,p,d,f,_,g,m,y,v,b,x,A,E,S,T,P=t.stride,C=e.dimensions,w=e.stride,D=i.get(r,n),M=r*P,O=0,I=0;if(3==C)for(O=0;O<M;O+=P)l=s[a=o[O]*w],u=s[a+1],f=s[a+2],h=s[a=o[O+1]*w],p=s[a+1],_=s[a+2],c=s[a=o[O+2]*w],d=s[a+1],A=(y=s[a+2]-f)*(b=p-u)-(m=d-u)*(x=_-f),E=(g=c-l)*x-y*(v=h-l),S=m*v-g*b,T=Math.sqrt(A*A+E*E+S*S),D[I++]=A,D[I++]=E,D[I++]=S,D[I++]=T;else if(2==C)for(O=0;O<M;O+=P)D[I++]=0,D[I++]=0,D[I++]=1,D[I++]=1;return i},t.generateNormals=function(t,e,i,r){var n=t.get(t.count),o=e.get(e.count);null==i&&(i=new Float3Attributes(r));var s,a,l=t.dimensions,h=i.stride,c=i.get(i.count),u=i.count*h;for(s=0;s<u;s+=h)c[s]=0,c[s+1]=0,c[s+2]=0;u=t.count*l;var p,d,f,_,g=0,m=1,y=2;for(s=0;s<u;s+=l)c[a=n[s]*h]+=o[g],c[a+1]+=o[m],c[a+2]+=o[y],c[a=n[s+1]*h]+=o[g],c[a+1]+=o[m],c[a+2]+=o[y],c[a=n[s+2]*h]+=o[g],c[a+1]+=o[m],c[a+2]+=o[y],g+=4,m+=4,y+=4;for(u=i.count*h,s=0;s<u;s+=h)p=c[s],d=c[s+1],f=c[s+2],_=1/Math.sqrt(p*p+d*d+f*f),c[s]=p*_,c[s+1]=d*_,c[s+2]=f*_;return i},t.generateFaceTangents=function(t,e,i,r,n,o,s){void 0===o&&(o=0);var a=t.get(n,o),l=e.get(e.count),h=i.get(i.count);null==r?r=new Float4Attributes(n+o):r.count<n+o&&(r.count=n+o);var c,u,p,d,f,_,g,m,y,v,b,x,A,E,S,T=t.dimensions,P=e.dimensions,C=e.stride,w=i.stride,D=r.get(n,o),M=0,O=n*T;for(M=0;M<O;M+=T)c=a[M],u=a[M+1],p=a[M+2],d=h[c*w+1],g=h[u*w+1]-d,m=h[p*w+1]-d,f=u*C,_=p*C,v=l[d=c*C],A=m*(l[f]-v)-g*(l[_]-v),b=l[d+1],E=m*(l[f+1]-b)-g*(l[_+1]-b),3==P?(x=l[d+2],S=m*(l[f+2]-x)-g*(l[_+2]-x)):S=0,y=1/Math.sqrt(A*A+E*E+S*S),D[M]=y*A,D[M+1]=y*E,D[M+2]=y*S;return r},t.generateTangents=function(t,e,i,r,n){var o=t.get(t.count),s=e.get(e.count),a=i.get(i.count);null==r&&(r=new Float3Attributes(n));var l,h,c,u=t.dimensions,p=r.stride,d=r.get(r.count),f=r.count*p;for(l=0;l<f;l+=p)d[l]=0,d[l+1]=0,d[l+2]=0;var _,g,m,y,v=0,b=1,x=2,A=3;for(f=t.count*u,l=0;l<f;l+=u)h=a[A],c=o[l]*p,d[c++]+=s[v]*h,d[c++]+=s[b]*h,d[c]+=s[x]*h,c=o[l+1]*p,d[c++]+=s[v]*h,d[c++]+=s[b]*h,d[c]+=s[x]*h,c=o[l+2]*p,d[c++]+=s[v]*h,d[c++]+=s[b]*h,d[c]+=s[x]*h,v+=3,b+=3,x+=3,A+=4;for(l=0;l<f;l+=p)_=d[l],g=d[l+1],m=d[l+2],y=1/Math.sqrt(_*_+g*g+m*m),d[l]=_*y,d[l+1]=g*y,d[l+2]=m*y;return r},t.generateColors=function(t,e,i,r,n){void 0===n&&(n=0),null==e&&(e=new Byte4Attributes(i)),e.count<r+n&&(e.count=r+n);for(var o=e.get(r,n),s=e.stride,a=e.count*s,l=0;l<a;l+=s)o[l]=255,o[l+1]=255,o[l+2]=255,o[l+3]=255;return e},t.scale=function(t,e,i,r,n,o){void 0===o&&(o=0),r.count<n+o&&(r.count=n+o);var s,a,l=new Float32Array([t,e,i]),h=r.get(n,o),c=r.stride,u=r.dimensions,p=n*c;for(s=0;s<p;s+=c)for(a=0;a<u;a++)h[s+a]*=l[a];r.invalidate()},t.applyTransformation=function(t,e,i,r,n,o){void 0===o&&(o=0);var s,a,l,h,c,u,p,d=e.get(n,o),f=e.stride;i&&(s=i.get(n,o),a=i.stride),r&&(l=r.get(n,o),h=r.stride);var _,g=new Vector3D;(i||r)&&((_=t.clone()).invert(),_.transpose());var m=0,y=0,v=0;for(c=0;c<n;++c)u=m+1,p=m+2,g.x=d[m],g.y=d[u],g.z=d[p],g=t.transformVector(g),d[m]=g.x,d[u]=g.y,d[p]=g.z,m+=f,s&&(u=y+1,p=y+2,g.x=s[y],g.y=s[u],g.z=s[p],(g=_.deltaTransformVector(g)).normalize(),s[y]=g.x,s[u]=g.y,s[p]=g.z,y+=a),l&&(u=v+1,p=v+2,g.x=l[v],g.y=l[u],g.z=l[p],(g=_.deltaTransformVector(g)).normalize(),l[v]=g.x,l[u]=g.y,l[p]=g.z,v+=h);e.invalidate(),i&&i.invalidate(),r&&r.invalidate()},t.getSubIndices=function(e,i,r,n){void 0===n&&(n=0);var o,s=e.attributesBuffer,a=e.length;if(r.length=0,a<t.LIMIT_INDICES&&i<t.LIMIT_VERTS)return s;var l,h,c=e.get(e.count,n),u=new Array,p=t._indexSwap;for(p.length=a,o=0;o<a;o++)p[o]=-1;var d=0,f=n*e.dimensions;for(o=0;o<a+f&&o+1<t.LIMIT_INDICES&&d+1<t.LIMIT_VERTS;)p[l=c[o]]>=0?h=p[l]:(h=d++,p[l]=h,r[h]=l),u[o++]=h;return s=new AttributesBuffer(e.size*e.dimensions,u.length/e.dimensions),(e=e.clone(s)).set(u),s},t.getSubVertices=function(t,e){if(!e.length)return t;var i,r,n=t.stride,o=t.bufferView,s=new Uint8Array(e.length*n),a=0,l=0,h=e.length;for(a=0;a<h;a++)for(i=a*n,r=e[a]*n,l=0;l<n;l++)s[i+l]=o[r+l];return(t=new AttributesBuffer(n,h)).bufferView=s,t},t.tempFloat32x4=new Float32Array(4),t.LIMIT_VERTS=65535,t.LIMIT_INDICES=16777215,t._indexSwap=new Array,t}(),_Stage_ElementsBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.usages=0,r._vertices=new Object,r._verticesUpdated=new Object,r._indexMappings=Array(),r._numIndices=0,r._elements=e,r._stage=i,r._onInvalidateIndicesDelegate=function(t){return r._onInvalidateIndices(t)},r._onClearIndicesDelegate=function(t){return r._onClearIndices(t)},r._onInvalidateVerticesDelegate=function(t){return r._onInvalidateVertices(t)},r._onClearVerticesDelegate=function(t){return r._onClearVertices(t)},r._elements.addEventListener(ElementsEvent.CLEAR_INDICES,r._onClearIndicesDelegate),r._elements.addEventListener(ElementsEvent.INVALIDATE_INDICES,r._onInvalidateIndicesDelegate),r._elements.addEventListener(ElementsEvent.CLEAR_VERTICES,r._onClearVerticesDelegate),r._elements.addEventListener(ElementsEvent.INVALIDATE_VERTICES,r._onInvalidateVerticesDelegate),r}return __extends(e,t),Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numIndices",{get:function(){return this._numIndices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),e.prototype.getIndexMappings=function(){return this._indicesUpdated||this._updateIndices(),this._indexMappings},e.prototype.getIndexBufferGL=function(){return this._indicesUpdated||this._updateIndices(),this._indices},e.prototype.getVertexBufferGL=function(t){this._indicesUpdated||this._updateIndices();var e=t.attributesBuffer.id;return this._verticesUpdated[e]||this._updateVertices(t),this._vertices[e]},e.prototype.activateVertexBufferVO=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this.getVertexBufferGL(e).activate(t,e.size,i||e.dimensions,e.offset+r,e.unsigned)},e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._elements.removeEventListener(ElementsEvent.CLEAR_INDICES,this._onClearIndicesDelegate),this._elements.removeEventListener(ElementsEvent.INVALIDATE_INDICES,this._onInvalidateIndicesDelegate),this._elements.removeEventListener(ElementsEvent.CLEAR_VERTICES,this._onClearVerticesDelegate),this._elements.removeEventListener(ElementsEvent.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate),this._elements=null,this._overflow&&(this._overflow.onClear(e),this._overflow=null)},e.prototype._setRenderState=function(t,e,i){this._verticesUpdated||this._updateIndices()},e.prototype.draw=function(t,e,i,r,n){throw new AbstractMethodError},e.prototype._updateIndices=function(t){void 0===t&&(t=0);var e=this._elements.indices;if(e?(this._indices=this._stage.getAbstraction(ElementsUtils.getSubIndices(e,this._elements.numVertices,this._indexMappings,t)),this._numIndices=this._indices._attributesBuffer.count*e.dimensions):(this._indices=null,this._numIndices=0,this._indexMappings=Array()),t+=this._numIndices,e&&t<e.count*this._elements.indices.dimensions?(this._overflow||(this._overflow=this._pGetOverflowElements()),this._overflow._updateIndices(t)):this._overflow&&(this._overflow.onClear(new AssetEvent(AssetEvent.CLEAR,this._elements)),this._overflow=null),this._indicesUpdated=!0,this._indexMappings.length)for(var i in this._verticesUpdated)this._verticesUpdated[i]=!1},e.prototype._updateVertices=function(t){this._numVertices=this._elements.numVertices;var e=t.attributesBuffer.id;this._vertices[e]=this._stage.getAbstraction(ElementsUtils.getSubVertices(t.attributesBuffer,this._indexMappings)),this._verticesUpdated[e]=!0},e.prototype._onInvalidateIndices=function(t){t.attributesView&&(this._indicesUpdated=!1)},e.prototype._onClearIndices=function(t){t.attributesView&&(this._indices.onClear(new AssetEvent(AssetEvent.CLEAR,t.attributesView)),this._indices=null)},e.prototype._onInvalidateVertices=function(t){if(t.attributesView){var e=t.attributesView.attributesBuffer.id;this._verticesUpdated[e]=!1}},e.prototype._onClearVertices=function(t){if(t.attributesView){var e=t.attributesView.attributesBuffer.id;this._vertices[e]&&(this._vertices[e].onClear(new AssetEvent(AssetEvent.CLEAR,t.attributesView)),delete this._vertices[e],delete this._verticesUpdated[e])}},e.prototype._pGetOverflowElements=function(){throw new AbstractMethodError},e}(AbstractionBase),ChunkVO=function(){},MappingMode;!function(t){t[t.LINEAR=0]="LINEAR",t[t.RADIAL=1]="RADIAL"}(MappingMode||(MappingMode={}));var Filter3DRenderer=function(){function t(t){var e=this;this._filterSizesInvalid=!0,this._onRTTResizeDelegate=function(t){return e.onRTTResize(t)},this._stage=t,this._rttManager=RTTBufferManager.getInstance(t),this._rttManager.addEventListener(RTTEvent.RESIZE,this._onRTTResizeDelegate),this._sampler=new ImageSampler(!1,!1,!1),this._renderToTextureRect=new Rectangle}return t.prototype.onRTTResize=function(t){this._filterSizesInvalid=!0},Object.defineProperty(t.prototype,"requireDepthRender",{get:function(){return this._requireDepthRender},enumerable:!0,configurable:!0}),t.prototype.getMainInputTexture=function(t){return this._filterTasksInvalid&&this.updateFilterTasks(t),this._mainInputTexture},Object.defineProperty(t.prototype,"filters",{get:function(){return this._filters},set:function(t){if(this._filters=t,this._filterTasksInvalid=!0,this._requireDepthRender=!1,this._filters){for(var e=0;e<this._filters.length;++e)this._filters[e].requireDepthRender&&(this._requireDepthRender=!0);this._filterSizesInvalid=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sampler",{get:function(){return this._sampler},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderToTextureRect",{get:function(){return this._filterSizesInvalid&&this.updateFilterSizes(),this._renderToTextureRect},enumerable:!0,configurable:!0}),t.prototype.updateFilterTasks=function(t){var e;if(this._filterSizesInvalid&&this.updateFilterSizes(),this._filters){var i;this._tasks=new Array,e=this._filters.length-1;for(var r=0;r<=e;++r)(i=this._filters[r]).setRenderTargets(r==e?null:this._filters[r+1].getMainInputTexture(t),t),this._tasks=this._tasks.concat(i.tasks);this._mainInputTexture=this._filters[0].getMainInputTexture(t)}else this._tasks=null},t.prototype.render=function(t,e,i){var r,n,o,s=t.context,a=this._rttManager.indexBuffer,l=this._rttManager.renderToTextureVertexBuffer;if(this._filters){for(this._filterSizesInvalid&&this.updateFilterSizes(),this._filterTasksInvalid&&this.updateFilterTasks(t),r=this._filters.length,n=0;n<r;++n)this._filters[n].update(t,e);for((r=this._tasks.length)>1&&(s.setProgram(this._tasks[0].getProgram(t)),s.setVertexBufferAt(this._tasks[0]._positionIndex,l,0,ContextGLVertexBufferFormat.FLOAT_2),s.setVertexBufferAt(this._tasks[0]._uvIndex,l,8,ContextGLVertexBufferFormat.FLOAT_2)),n=0;n<r;++n)o=this._tasks[n],t.setRenderTarget(o.target),s.setProgram(o.getProgram(t)),t.getAbstraction(o.getMainInputTexture(t)).activate(o._inputTextureIndex,this._sampler),o.target||(l=this._rttManager.renderToScreenVertexBuffer,s.setVertexBufferAt(o._positionIndex,l,0,ContextGLVertexBufferFormat.FLOAT_2),s.setVertexBufferAt(o._uvIndex,l,8,ContextGLVertexBufferFormat.FLOAT_2)),s.clear(0,0,0,0),o.activate(t,e,i),s.setBlendFactors(ContextGLBlendFactor.ONE,ContextGLBlendFactor.ZERO),s.drawIndices(ContextGLDrawMode.TRIANGLES,a,0,6),o.deactivate(t);s.setTextureAt(0,null),s.setVertexBufferAt(0,null),s.setVertexBufferAt(1,null)}},t.prototype.updateFilterSizes=function(){for(var t=0;t<this._filters.length;++t)this._filters[t].textureWidth=this._rttManager.textureWidth,this._filters[t].textureHeight=this._rttManager.textureHeight,this._filters[t].rttManager=this._rttManager;var e=this._filters[0].textureScale;this._renderToTextureRect.x=this._rttManager.renderToTextureRect.x/e,this._renderToTextureRect.y=this._rttManager.renderToTextureRect.y/e,this._renderToTextureRect.width=this._rttManager.renderToTextureRect.width/e,this._renderToTextureRect.height=this._rttManager.renderToTextureRect.height/e,this._filterSizesInvalid=!1},t.prototype.dispose=function(){this._rttManager.removeEventListener(RTTEvent.RESIZE,this._onRTTResizeDelegate),this._rttManager=null,this._stage=null},t}(),RenderableMergeSort=function(){function t(){}return t.prototype.sortBlendedRenderables=function(t){var e,i,r,n,o,s;if(!t||!t.next)return t;for(r=t,i=t.next;i;)(i=i.next)&&(r=r.next,i=i.next);if(e=r.next,r.next=null,t=this.sortBlendedRenderables(t),e=this.sortBlendedRenderables(e),!t)return e;if(!e)return t;for(;t&&e;)t.zIndex<e.zIndex?(s=t,t=t.next):(s=e,e=e.next),n?o.next=s:n=s,o=s;return t?o.next=t:e&&(o.next=e),n},t.prototype.sortOpaqueRenderables=function(t){var e,i,r,n,o,s;if(!t||!t.next)return t;for(r=t,i=t.next;i;)(i=i.next)&&(r=r.next,i=i.next);e=r.next,r.next=null,t=this.sortOpaqueRenderables(t),e=this.sortOpaqueRenderables(e);var a=0;if(!t)return e;if(!e)return t;for(;t&&e&&null!=t&&null!=e;){var l=t.renderOrderId,h=e.renderOrderId;if(l==h){var c=t.materialID,u=e.materialID;a=c==u?t.zIndex<e.zIndex?1:-1:c>u?1:-1}else a=l>h?1:-1;a<0?(s=t,t=t.next):(s=e,e=e.next),n?(o.next=s,o=s):(n=s,o=s)}return t?o.next=t:e&&(o.next=e),n},t}(),RendererBase=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n._numUsedStreams=0,n._numUsedTextures=0,n._cameraForward=new Vector3D,n._depthTextureDirty=!0,n._depthPrepass=!1,n._pNumElements=0,n._disableColor=!1,n._disableClear=!1,n._renderBlended=!0,n._numCullPlanes=0,n._partition=i,n._maskId=i.root.maskId,n._onSizeInvalidateDelegate=function(t){return n.onSizeInvalidate(t)},n._onContextUpdateDelegate=function(t){return n.onContextUpdate(t)},n.renderableSorter=new RenderableMergeSort,n._renderGroup=e,n._renderGroup.addEventListener(StageEvent.CONTEXT_CREATED,n._onContextUpdateDelegate),n._renderGroup.addEventListener(StageEvent.CONTEXT_RECREATED,n._onContextUpdateDelegate),n._renderGroup.addEventListener(ViewEvent.INVALIDATE_SIZE,n._onSizeInvalidateDelegate),n._view=n._renderGroup.view,n._stage=n._renderGroup.stage,n._stage.context&&(n._context=n._stage.context),n}return __extends(e,t),Object.defineProperty(e.prototype,"partition",{get:function(){return this._partition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullPlanes",{get:function(){return this._customCullPlanes},set:function(t){this._customCullPlanes=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderBlended",{get:function(){return this._renderBlended},set:function(t){this._renderBlended=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableColor",{get:function(){return this._disableColor},set:function(t){this._disableColor!=t&&(this._disableColor=t,this._invalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableClear",{get:function(){return this._disableClear},set:function(t){this._disableClear!=t&&(this._disableClear=t,this._invalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numElements",{get:function(){return this._pNumElements},enumerable:!0,configurable:!0}),e.prototype.activatePass=function(t){var e;for(e=t.shader.numUsedStreams;e<this._numUsedStreams;e++)this._context.setVertexBufferAt(e,null);for(e=t.shader.numUsedTextures;e<this._numUsedTextures;e++)this._context.setTextureAt(e,null);t._activate(this._view)},e.prototype.deactivatePass=function(t){t._deactivate(),this._numUsedStreams=t.shader.numUsedStreams,this._numUsedTextures=t.shader.numUsedTextures},Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._renderGroup.removeEventListener(StageEvent.CONTEXT_CREATED,this._onContextUpdateDelegate),this._renderGroup.removeEventListener(StageEvent.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._renderGroup.removeEventListener(ViewEvent.INVALIDATE_SIZE,this._onSizeInvalidateDelegate),this._onContextUpdateDelegate=null,this._onSizeInvalidateDelegate=null,this._view=null,this._stage=null,this._context=null},e.prototype.render=function(t,i,r,n){void 0===t&&(t=!0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this._maskConfig=n,this._maskConfig&&(this._disableClear=!0,this._disableColor=!0),this._renderGroup.update(this._partition),this._pBlendedRenderableHead=null,this._pOpaqueRenderableHead=null,this._pNumElements=0,this._activeMaskOwners=null,this._cameraTransform=this._view.projection.transform.concatenatedMatrix3D,this._cameraForward=this._view.projection.transform.forwardVector,this._cullPlanes=this._customCullPlanes?this._customCullPlanes:this._view.projection.viewFrustumPlanes,this._numCullPlanes=this._cullPlanes?this._cullPlanes.length:0,e._collectionMark++,this._partition.traverse(this),this.renderableSorter&&(this._pOpaqueRenderableHead=this.renderableSorter.sortOpaqueRenderables(this._pOpaqueRenderableHead),this._pBlendedRenderableHead=this.renderableSorter.sortBlendedRenderables(this._pBlendedRenderableHead)),this._view.target&&this._view.target.invalidateMipmaps(),this._executeRender(t,i,r);for(var o=0;o<8;++o)this._context.setVertexBufferAt(o,null),this._context.setTextureAt(o,null)},e.prototype._iRenderCascades=function(t,e,i,r){},e.prototype._executeRender=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=0),void 0===i&&(i=0),this._view.clear(!this._depthPrepass&&!this._disableClear,t,e,i,!this._view.shareContext||this._view.target?ContextGLClearMask.ALL:ContextGLClearMask.DEPTH),this._context.setBlendFactors(ContextGLBlendFactor.ONE,ContextGLBlendFactor.ZERO),this._context.setDepthTest(!0,ContextGLCompareMode.LESS_EQUAL),this._disableColor?this._context.setColorMask(!1,!1,!1,!1):this._context.setColorMask(!0,!0,!0,!0),this._maskConfig?this._context.enableStencil():this._context.disableStencil(),this.drawRenderables(this._pOpaqueRenderableHead),this._renderBlended&&this.drawRenderables(this._pBlendedRenderableHead),this._view.shareContext&&!this._view.target||this._snapshotRequired&&this._snapshotBitmapImage2D&&(this._context.drawToBitmapImage2D(this._snapshotBitmapImage2D),this._snapshotRequired=!1)},e.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e),this._renderGroup.invalidate()},e.prototype.queueSnapshot=function(t){this._snapshotRequired=!0,this._snapshotBitmapImage2D=t},e.prototype.drawRenderables=function(t){for(var e,i,r,n,o,s;t;){for(o=(n=t.renderMaterial).passes,(this._activeMasksDirty||this._checkMaskOwners(t.maskOwners))&&((this._activeMaskOwners=t.maskOwners)?this._renderMasks(this._activeMaskOwners):this._maskConfig||this._context.disableStencil(),this._activeMasksDirty=!1),i=o.length,e=0;e<i;e++){r=t,s=o[e],this.activatePass(s);do{r._iRender(s,this._view),r=r.next}while(r&&r.renderMaterial==n&&!(this._activeMasksDirty=this._checkMaskOwners(r.maskOwners)));this.deactivatePass(s)}t=r}},e.prototype.onContextUpdate=function(t){this._context=this._stage.context},e.prototype.onSizeInvalidate=function(t){this._pRttBufferManager&&(this._pRttBufferManager.viewWidth=this._view.width,this._pRttBufferManager.viewHeight=this._view.height),this._depthTextureDirty=!0},e.prototype.enterNode=function(t){var i=t._collectionMark!=e._collectionMark&&t.isRenderable()&&t.isInFrustum(this._cullPlanes,this._numCullPlanes)&&t.maskId==this._maskId;return t._collectionMark=e._collectionMark,i},e.prototype.getTraverser=function(t){return this},e.prototype.applyEntity=function(t){this._sourceEntity=t,this._renderEntity=this._renderGroup.getAbstraction(t),this._zIndex=t.zOffset+this._cameraTransform.position.subtract(t.scenePosition).dotProduct(this._cameraForward),this._renderSceneTransform=t.getRenderSceneTransform(this._cameraTransform),t._acceptTraverser(this)},e.prototype.applyTraversable=function(t){var e=this._renderEntity.getAbstraction(t);e.cascaded=!1,e.zIndex=this._zIndex,e.maskId=this._sourceEntity.maskId,e.maskOwners=this._sourceEntity.maskOwners;var i=e.renderMaterial;e.materialID=i.materialID,e.renderOrderId=i.renderOrderId,e.renderSceneTransform=this._renderSceneTransform,i.requiresBlending?(e.next=this._pBlendedRenderableHead,this._pBlendedRenderableHead=e):(e.next=this._pOpaqueRenderableHead,this._pOpaqueRenderableHead=e),this._pNumElements+=e.stageElements.elements.numElements},e.prototype._renderMasks=function(t){var e=Math.log2(this._maskConfig)>>1,i=this._maskConfig?Math.pow(2,e+1<<1):1,r=i;this._context.enableStencil(),this._context.setStencilActions(ContextGLTriangleFace.FRONT_AND_BACK,ContextGLCompareMode.ALWAYS,ContextGLStencilAction.SET,ContextGLStencilAction.SET,ContextGLStencilAction.SET);for(var n,o,s,a=t.length,l=0;l<a;++l){0!=l&&this._context.setStencilActions(ContextGLTriangleFace.FRONT_AND_BACK,ContextGLCompareMode.EQUAL,ContextGLStencilAction.SET,ContextGLStencilAction.SET,ContextGLStencilAction.KEEP),this._context.setStencilReferenceValue(255,r,r=(r&i)+i),this._context.clear(0,0,0,0,0,0,ContextGLClearMask.STENCIL),o=(n=t[l].masks).length;for(var h=0;h<o;++h)(s=n[h])&&this._renderGroup.getRenderer(s.partition).render(!0,0,0,r)}this._context.setStencilActions(ContextGLTriangleFace.FRONT_AND_BACK,ContextGLCompareMode.EQUAL,ContextGLStencilAction.SET,ContextGLStencilAction.SET,ContextGLStencilAction.KEEP),this._context.setStencilReferenceValue(255,r,this._maskConfig),this._disableColor||this._context.setColorMask(!0,!0,!0,!0)},e.prototype._checkMaskOwners=function(t){if(null==this._activeMaskOwners||null==t)return Boolean(this._activeMaskOwners!=t);if(this._activeMaskOwners.length!=t.length)return!0;for(var e,i,r,n=t.length,o=0;o<n;o++){if(e=(i=t[o].masks).length,(r=this._activeMaskOwners[o].masks).length!=e)return!0;for(var s=0;s<e;s++)if(r[s]!=i[s])return!0}return!1},e._collectionMark=0,e}(AbstractionBase),DefaultRenderer=function(t){function e(e,i,r){var n=t.call(this,e,i,r)||this;return n._pRttBufferManager=RTTBufferManager.getInstance(n._stage),n._depthRenderer=e.depthRenderGroup.getRenderer(i),n._distanceRenderer=e.distanceRenderGroup.getRenderer(i),n}return __extends(e,t),Object.defineProperty(e.prototype,"antiAlias",{get:function(){return this._stage.antiAlias},set:function(t){this._stage.antiAlias=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthPrepass",{get:function(){return this._depthPrepass},set:function(t){this._depthPrepass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters3d",{get:function(){return this._filter3DRenderer?this._filter3DRenderer.filters:null},set:function(t){t&&0==t.length&&(t=null),this._filter3DRenderer&&!t?(this._filter3DRenderer.dispose(),this._filter3DRenderer=null):!this._filter3DRenderer&&t&&(this._filter3DRenderer=new Filter3DRenderer(this._stage),this._filter3DRenderer.filters=t),this._filter3DRenderer?(this._filter3DRenderer.filters=t,this._requireDepthRender=this._filter3DRenderer.requireDepthRender):(this._requireDepthRender=!1,this._depthRender&&(this._depthRender.dispose(),this._depthRender=null))},enumerable:!0,configurable:!0}),e.prototype.enterNode=function(e){var i=t.prototype.enterNode.call(this,e);return i&&e.boundsVisible&&this.applyEntity(e.getBoundsPrimitive(this._renderGroup.pickGroup)),i},e.prototype.render=function(e,i,r,n){void 0===e&&(e=!0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this._stage.recoverFromDisposal()&&(this._requireDepthRender&&this._renderSceneDepthToTexture(),this._depthPrepass&&this._renderDepthPrepass(),this._filter3DRenderer?(this._view.target=this._filter3DRenderer.getMainInputTexture(this._stage),t.prototype.render.call(this,e,i,r),this._filter3DRenderer.render(this._stage,this._view.projection,this._depthRender)):t.prototype.render.call(this,e,i,r,n),n||this._view.present())},e.prototype.dispose=function(){this._view.dispose(),this._pRttBufferManager.dispose(),this._pRttBufferManager=null,this._depthRenderer.dispose(),this._distanceRenderer.dispose(),this._depthRenderer=null,this._distanceRenderer=null,this._depthRender=null,t.prototype.dispose.call(this)},e.prototype._renderDepthPrepass=function(){this._depthRenderer.disableColor=!0,this._depthRenderer.view.projection=this._view.projection,this._filter3DRenderer?(this._depthRenderer.view.target=this._filter3DRenderer.getMainInputTexture(this._stage),this._depthRenderer.render()):(this._depthRenderer.view.target=null,this._depthRenderer.render()),this._depthRenderer.disableColor=!1},e.prototype._renderSceneDepthToTexture=function(){!this._depthTextureDirty&&this._depthRender||this.initDepthTexture(this._stage.context),this._depthRenderer.render()},e.prototype.initDepthTexture=function(t){this._depthTextureDirty=!1,this._depthRender&&this._depthRender.dispose(),this._depthRender=new BitmapImage2D(this._pRttBufferManager.textureWidth,this._pRttBufferManager.textureHeight),this._depthRenderer.view.target=this._depthRender,this._depthRenderer.view.projection=this._view.projection},e}(RendererBase),DepthRenderer=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return __extends(e,t),e.prototype.enterNode=function(e){return e._collectionMark!=RendererBase._collectionMark&&e.isCastingShadow()?t.prototype.enterNode.call(this,e):(e._collectionMark=RendererBase._collectionMark,!1)},e}(RendererBase),DistanceRenderer=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return __extends(e,t),e.prototype.enterNode=function(e){return e._collectionMark!=RendererBase._collectionMark&&e.isCastingShadow()?t.prototype.enterNode.call(this,e):(e._collectionMark=RendererBase._collectionMark,!1)},e}(RendererBase),_a$1,_b$1,DefaultRendererPool=function(){function t(t){this._abstractionPool=new Object,this._renderGroup=t}return Object.defineProperty(t.prototype,"materialClassPool",{get:function(){return t._materialClassPool},enumerable:!0,configurable:!0}),t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new DefaultRenderer(this._renderGroup,t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t.registerMaterial=function(e,i){t._materialClassPool[i.assetType]=e},t._materialClassPool=new Object,t}(),DepthRendererPool=function(){function t(t){this._abstractionPool=new Object,this._renderGroup=t}return Object.defineProperty(t.prototype,"materialClassPool",{get:function(){return t._materialClassPool},enumerable:!0,configurable:!0}),t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new DepthRenderer(this._renderGroup,t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t.registerMaterial=function(e,i){t._materialClassPool[i.assetType]=e},t._materialClassPool=new Object,t}(),DistanceRendererPool=function(){function t(t){this._abstractionPool=new Object,this._renderGroup=t}return Object.defineProperty(t.prototype,"materialClassPool",{get:function(){return t._materialClassPool},enumerable:!0,configurable:!0}),t.prototype.getAbstraction=function(t){return this._abstractionPool[t.id]||(this._abstractionPool[t.id]=new DistanceRenderer(this._renderGroup,t,this))},t.prototype.clearAbstraction=function(t){delete this._abstractionPool[t.id]},t.registerMaterial=function(e,i){t._materialClassPool[i.assetType]=e},t._materialClassPool=new Object,t}(),RendererType;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DEPTH=1]="DEPTH",t[t.DISTANCE=2]="DISTANCE"}(RendererType||(RendererType={}));var RenderGroup=function(t){function e(i,r){var n=t.call(this)||this;return n._mappers=new Array,n._materialPools=new Object,n._entityPool=new Object,n._view=i,n._stage=i.stage,n._pickGroup=PickGroup.getInstance(i),n._rendererPool=new e._rendererClass[r](n),n._materialClassPool=n._rendererPool.materialClassPool,r!=RendererType.DEFAULT&&(n._view.backgroundColor=16777215),n._onSizeInvalidateDelegate=function(t){return n.onSizeInvalidate(t)},n._onContextUpdateDelegate=function(t){return n.onContextUpdate(t)},n._stage.addEventListener(StageEvent.CONTEXT_CREATED,n._onContextUpdateDelegate),n._stage.addEventListener(StageEvent.CONTEXT_RECREATED,n._onContextUpdateDelegate),n._view.addEventListener(ViewEvent.INVALIDATE_SIZE,n._onSizeInvalidateDelegate),n}return __extends(e,t),e.getInstance=function(t,i){return this._instancePool[i][t.id]||(this._instancePool[i][t.id]=new e(t,i))},Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthRenderGroup",{get:function(){return null==this._depthRenderGroup&&(this._depthRenderGroup=e.getInstance(new View(null,this._stage),RendererType.DEPTH)),this._depthRenderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceRenderGroup",{get:function(){return null==this._distanceRenderGroup&&(this._distanceRenderGroup=e.getInstance(new View(null,this._stage),RendererType.DISTANCE)),this._distanceRenderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pickGroup",{get:function(){return this._pickGroup},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._stage.removeEventListener(StageEvent.CONTEXT_CREATED,this._onContextUpdateDelegate),this._stage.removeEventListener(StageEvent.CONTEXT_RECREATED,this._onContextUpdateDelegate),this._view.removeEventListener(ViewEvent.INVALIDATE_SIZE,this._onSizeInvalidateDelegate),this._view=null,this._stage=null},e.prototype.update=function(t){for(var e=this._mappers.length,i=0;i<e;i++)this._mappers[i].update(t,this)},e.prototype.invalidate=function(){this._invalid=!0},e.prototype._addMapper=function(t){-1==this._mappers.indexOf(t)&&this._mappers.push(t)},e.prototype._removeMapper=function(t){var e=this._mappers.indexOf(t);-1!=e&&this._mappers.splice(e,1)},e.prototype.onSizeInvalidate=function(t){this.dispatchEvent(t)},e.prototype.onContextUpdate=function(t){this.dispatchEvent(t)},e.prototype.getRenderElements=function(t){return this._materialPools[t.assetType]||(this._materialPools[t.assetType]=new e._renderElementsClassPool[t.assetType](this._stage,this._materialClassPool,this))},e.prototype.getAbstraction=function(t){return this._entityPool[t.id]||(this._entityPool[t.id]=new RenderEntity(this._stage,t,this))},e.prototype.getRenderer=function(t){return this._rendererPool.getAbstraction(t)},e.prototype.clearAbstraction=function(t){delete this._entityPool[t.id]},e.registerElements=function(t,i){e._renderElementsClassPool[i.assetType]=t},e.registerDefaultMaterial=function(t,e){DefaultRendererPool.registerMaterial(t,e)},e.registerDepthMaterial=function(t,e){DepthRendererPool.registerMaterial(t,e)},e.registerDistanceMaterial=function(t,e){DistanceRendererPool.registerMaterial(t,e)},e._rendererClass=((_a$1={})[RendererType.DEFAULT]=DefaultRendererPool,_a$1[RendererType.DEPTH]=DepthRendererPool,_a$1[RendererType.DISTANCE]=DistanceRendererPool,_a$1),e._defaultInstancePool=new Object,e._depthInstancePool=new Object,e._distanceInstancePool=new Object,e._instancePool=((_b$1={})[RendererType.DEFAULT]=e._defaultInstancePool,_b$1[RendererType.DEPTH]=e._depthInstancePool,_b$1[RendererType.DISTANCE]=e._distanceInstancePool,_b$1),e._renderElementsClassPool=new Object,e}(EventDispatcher);console.debug("AwayJS - Renderer - 0.10.9");var AnimationClipNodeBase=function(t){function e(){var e=t.call(this)||this;return e._pLooping=!0,e._pTotalDuration=0,e._pStitchDirty=!0,e._pStitchFinalFrame=!1,e._pNumFrames=0,e._pDurations=new Array,e._pTotalDelta=new Vector3D,e.fixedFrameRate=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"looping",{get:function(){return this._pLooping},set:function(t){this._pLooping!=t&&(this._pLooping=t,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stitchFinalFrame",{get:function(){return this._pStitchFinalFrame},set:function(t){this._pStitchFinalFrame!=t&&(this._pStitchFinalFrame=t,this._pStitchDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalDuration",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDuration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalDelta",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pTotalDelta},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastFrame",{get:function(){return this._pStitchDirty&&this._pUpdateStitch(),this._pLastFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durations",{get:function(){return this._pDurations},enumerable:!0,configurable:!0}),e.prototype._pUpdateStitch=function(){this._pStitchDirty=!1,this._pLastFrame=this._pStitchFinalFrame?this._pNumFrames:this._pNumFrames-1,this._pTotalDuration=0,this._pTotalDelta.x=0,this._pTotalDelta.y=0,this._pTotalDelta.z=0},e}(AnimationNodeBase),AnimationStateBase=function(){function t(t,e){this._pRootDelta=new Vector3D,this._pPositionDeltaDirty=!0,this._pStartTime=0,this._pAnimator=t,this._pAnimationNode=e}return Object.defineProperty(t.prototype,"positionDelta",{get:function(){return this._pPositionDeltaDirty&&this._pUpdatePositionDelta(),this._pRootDelta},enumerable:!0,configurable:!0}),t.prototype.offset=function(t){this._pStartTime=t,this._pPositionDeltaDirty=!0},t.prototype.update=function(t){this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},t.prototype.phase=function(t){},t.prototype._pUpdateTime=function(t){this._pTime=t-this._pStartTime,this._pPositionDeltaDirty=!0},t.prototype._pUpdatePositionDelta=function(){},t}(),ParticleStateBase=function(t){function e(e,i,r){void 0===r&&(r=!1);var n=t.call(this,e,i)||this;return n._pDynamicProperties=new Array,n._pDynamicPropertiesDirty=new Object,n._pParticleAnimator=e,n._particleNode=i,n._pNeedUpdateTime=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"needUpdateTime",{get:function(){return this._pNeedUpdateTime},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,e,i,r,n,o){},e.prototype._pUpdateDynamicProperties=function(t){this._pDynamicPropertiesDirty[t._iUniqueId]=!0;for(var e,i,r,n,o,s=t.animationParticles,a=t.vertexData,l=t.totalLenOfOneVertex,h=this._particleNode.dataLength,c=this._particleNode._iDataOffset,u=this._pDynamicProperties.length,p=0,d=0,f=0;p<u;){for(;d<u&&(o=s[d]).index==p;){for(n=this._pDynamicProperties[p],e=o.numVertices*l,i=o.startVertexIndex*l+c,f=0;f<e;f+=l)for(r=i+f,f=0;f<e;f+=l)r=i+f,a[r++]=n.x,a[r++]=n.y,a[r++]=n.z,4==h&&(a[r++]=n.w);d++}p++}t.invalidateBuffer()},e}(AnimationStateBase),ParticleAccelerationState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleAccelerationNode=i,r._acceleration=r._particleAccelerationNode._acceleration,r.updateAccelerationData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"acceleration",{get:function(){return this._acceleration},set:function(t){this._acceleration.x=t.x,this._acceleration.y=t.y,this._acceleration.z=t.z,this.updateAccelerationData()},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){var a=n.getRegisterIndex(this._pAnimationNode,e.ACCELERATION_INDEX);this._particleAccelerationNode.mode==ParticlePropertiesMode.LOCAL_STATIC?r.activateVertexBuffer(a,this._particleAccelerationNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3):t.setVertexConst(a,this._halfAcceleration.x,this._halfAcceleration.y,this._halfAcceleration.z)},e.prototype.updateAccelerationData=function(){this._particleAccelerationNode.mode==ParticlePropertiesMode.GLOBAL&&(this._halfAcceleration=new Vector3D(this._acceleration.x/2,this._acceleration.y/2,this._acceleration.z/2))},e.ACCELERATION_INDEX=0,e}(ParticleStateBase),ParticleNodeBase=function(t){function e(i,r,n,o){void 0===o&&(o=1);var s=t.call(this)||this;return s._pDataLength=3,i+=e.MODES[r],s.name=i,s._pMode=r,s._priority=o,s._pDataLength=n,s._pOneData=new Array(s._pDataLength),s}return __extends(e,t),Object.defineProperty(e.prototype,"mode",{get:function(){return this._pMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataLength",{get:function(){return this._pDataLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oneData",{get:function(){return this._pOneData},enumerable:!0,configurable:!0}),e.prototype.getAGALVertexCode=function(t,e,i,r){return""},e.prototype.getAGALFragmentCode=function(t,e,i,r){return""},e.prototype.getAGALUVCode=function(t,e,i,r){return""},e.prototype._iGeneratePropertyOfOneParticle=function(t){},e.prototype._iProcessAnimationSetting=function(t){},e.GLOBAL="Global",e.LOCAL_STATIC="LocalStatic",e.LOCAL_DYNAMIC="LocalDynamic",e.MODES={0:e.GLOBAL,1:e.LOCAL_STATIC,2:e.LOCAL_DYNAMIC},e}(AnimationNodeBase),ParticleAccelerationNode=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,"ParticleAcceleration",e,3)||this;return r._pStateClass=ParticleAccelerationState,r._acceleration=i||new Vector3D,r}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleAccelerationState.ACCELERATION_INDEX,n.index);var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var s="mul "+o+","+r.vertexTime+","+n+"\n";if(e.needVelocity){var a=i.getFreeVertexVectorTemp();s+="mul "+a+","+o+","+r.vertexTwoConst+"\n",s+="add "+r.velocityTarget+".xyz,"+a+".xyz,"+r.velocityTarget+".xyz\n"}return i.removeVertexTempUsage(o),s+="mul "+o+","+o+","+r.vertexTime+"\n",s+="add "+r.positionTarget+".xyz,"+o+","+r.positionTarget+".xyz\n"},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.ACCELERATION_VECTOR3D];if(!i)throw new Error("there is no "+e.ACCELERATION_VECTOR3D+" in param!");this._pOneData[0]=i.x/2,this._pOneData[1]=i.y/2,this._pOneData[2]=i.z/2},e.ACCELERATION_VECTOR3D="AccelerationVector3D",e}(ParticleNodeBase),ParticleBezierCurveState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleBezierCurveNode=i,r._controlPoint=r._particleBezierCurveNode._iControlPoint,r._endPoint=r._particleBezierCurveNode._iEndPoint,r}return __extends(e,t),Object.defineProperty(e.prototype,"controlPoint",{get:function(){return this._controlPoint},set:function(t){this._controlPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endPoint",{get:function(){return this._endPoint},set:function(t){this._endPoint=t},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){var a=n.getRegisterIndex(this._pAnimationNode,e.BEZIER_CONTROL_INDEX),l=n.getRegisterIndex(this._pAnimationNode,e.BEZIER_END_INDEX);this._particleBezierCurveNode.mode==ParticlePropertiesMode.LOCAL_STATIC?(r.activateVertexBuffer(a,this._particleBezierCurveNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3),r.activateVertexBuffer(l,this._particleBezierCurveNode._iDataOffset+3,s,ContextGLVertexBufferFormat.FLOAT_3)):(t.setVertexConst(a,this._controlPoint.x,this._controlPoint.y,this._controlPoint.z),t.setVertexConst(l,this._endPoint.x,this._endPoint.y,this._endPoint.z))},e.BEZIER_CONTROL_INDEX=0,e.BEZIER_END_INDEX=1,e}(ParticleStateBase),ParticleBezierCurveNode=function(t){function e(e,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var n=t.call(this,"ParticleBezierCurve",e,6)||this;return n._pStateClass=ParticleBezierCurveState,n._iControlPoint=i||new Vector3D,n._iEndPoint=r||new Vector3D,n}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleBezierCurveState.BEZIER_CONTROL_INDEX,n.index);var o=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleBezierCurveState.BEZIER_END_INDEX,o.index);var s=i.getFreeVertexVectorTemp(),a=new ShaderRegisterElement(s.regName,s.index,0),l=new ShaderRegisterElement(s.regName,s.index,1),h=new ShaderRegisterElement(s.regName,s.index,2);i.addVertexTempUsages(s,1);var c=i.getFreeVertexVectorTemp(),u=new ShaderRegisterElement(c.regName,c.index);i.removeVertexTempUsage(s);var p="";return p+="sub "+a+","+r.vertexOneConst+","+r.vertexLife+"\n",p+="mul "+l+","+r.vertexLife+","+r.vertexLife+"\n",p+="mul "+h+","+r.vertexLife+","+a+"\n",p+="mul "+h+","+h+","+r.vertexTwoConst+"\n",p+="mul "+u+".xyz,"+h+","+n+"\n",p+="add "+r.positionTarget+".xyz,"+u+".xyz,"+r.positionTarget+".xyz\n",p+="mul "+u+".xyz,"+l+","+o+"\n",p+="add "+r.positionTarget+".xyz,"+u+".xyz,"+r.positionTarget+".xyz\n",e.needVelocity&&(p+="mul "+l+","+r.vertexLife+","+r.vertexTwoConst+"\n",p+="sub "+h+","+r.vertexOneConst+","+l+"\n",p+="mul "+h+","+r.vertexTwoConst+","+h+"\n",p+="mul "+u+".xyz,"+n+","+h+"\n",p+="add "+r.velocityTarget+".xyz,"+u+".xyz,"+r.velocityTarget+".xyz\n",p+="mul "+u+".xyz,"+o+","+l+"\n",p+="add "+r.velocityTarget+".xyz,"+u+".xyz,"+r.velocityTarget+".xyz\n"),p},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.BEZIER_CONTROL_VECTOR3D];if(!i)throw new Error("there is no "+e.BEZIER_CONTROL_VECTOR3D+" in param!");var r=t[e.BEZIER_END_VECTOR3D];if(!r)throw new Error("there is no "+e.BEZIER_END_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,this._pOneData[3]=r.x,this._pOneData[4]=r.y,this._pOneData[5]=r.z},e.BEZIER_CONTROL_VECTOR3D="BezierControlVector3D",e.BEZIER_END_VECTOR3D="BezierEndVector3D",e}(ParticleNodeBase),ParticleBillboardState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._matrix=new Matrix3D,r._billboardAxis=i._iBillboardAxis,r}return __extends(e,t),e.prototype.setRenderState=function(t,i,r,n,o,s){var a;if(this._billboardAxis){var l=i.sourceEntity.transform.concatenatedMatrix3D.position,h=o.transform.concatenatedMatrix3D.position.subtract(l),c=h.crossProduct(this._billboardAxis);c.normalize(),(h=this.billboardAxis.crossProduct(c)).normalize(),this._matrix.copyFrom(i.sourceEntity.transform.concatenatedMatrix3D),a=this._matrix.decompose(Orientation3D.AXIS_ANGLE),this._matrix.copyColumnFrom(0,c),this._matrix.copyColumnFrom(1,this.billboardAxis),this._matrix.copyColumnFrom(2,h),this._matrix.copyColumnFrom(3,l),this._matrix.appendRotation(-a[1].w*MathConsts.RADIANS_TO_DEGREES,a[1])}else this._matrix.copyFrom(i.sourceEntity.transform.concatenatedMatrix3D),this._matrix.append(o.transform.inverseConcatenatedMatrix3D),a=this._matrix.decompose(Orientation3D.AXIS_ANGLE),this._matrix.identity(),this._matrix.appendRotation(-a[1].w*MathConsts.RADIANS_TO_DEGREES,a[1]);t.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,e.MATRIX_INDEX),this._matrix)},Object.defineProperty(e.prototype,"billboardAxis",{get:function(){return this.billboardAxis},set:function(t){this.billboardAxis=t?t.clone():null,this.billboardAxis&&this.billboardAxis.normalize()},enumerable:!0,configurable:!0}),e.MATRIX_INDEX=0,e}(ParticleStateBase),ParticleBillboardNode=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this,"ParticleBillboard",ParticlePropertiesMode.GLOBAL,0,4)||this;return i._pStateClass=ParticleBillboardState,i._iBillboardAxis=e,i}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleBillboardState.MATRIX_INDEX,n.index),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant();for(var o,s=i.getFreeVertexVectorTemp(),a="m33 "+s+".xyz,"+r.scaleAndRotateTarget+","+n+"\nmov "+r.scaleAndRotateTarget+".xyz,"+s+"\n",l=0;l<r.rotationRegisters.length;l++)a+="m33 "+s+".xyz,"+(o=r.rotationRegisters[l])+","+n+"\nmov "+o+".xyz,"+o+"\n";return a},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iProcessAnimationSetting=function(t){t.hasBillboard=!0},e}(ParticleNodeBase),ParticleColorState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleColorNode=i,r._usesMultiplier=r._particleColorNode._iUsesMultiplier,r._usesOffset=r._particleColorNode._iUsesOffset,r._usesCycle=r._particleColorNode._iUsesCycle,r._usesPhase=r._particleColorNode._iUsesPhase,r._startColor=r._particleColorNode._iStartColor,r._endColor=r._particleColorNode._iEndColor,r._cycleDuration=r._particleColorNode._iCycleDuration,r._cyclePhase=r._particleColorNode._iCyclePhase,r.updateColorData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateColorData()},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){if(t.usesFragmentAnimation){var a=this._particleColorNode._iDataOffset;this._usesCycle&&t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.CYCLE_INDEX),this._cycleData.x,this._cycleData.y,this._cycleData.z,this._cycleData.w),this._usesMultiplier&&(this._particleColorNode.mode==ParticlePropertiesMode.LOCAL_STATIC?(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.START_MULTIPLIER_INDEX),a,s,ContextGLVertexBufferFormat.FLOAT_4),a+=4,r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.DELTA_MULTIPLIER_INDEX),a,s,ContextGLVertexBufferFormat.FLOAT_4),a+=4):(t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.START_MULTIPLIER_INDEX),this._startMultiplierData.x,this._startMultiplierData.y,this._startMultiplierData.z,this._startMultiplierData.w),t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.DELTA_MULTIPLIER_INDEX),this._deltaMultiplierData.x,this._deltaMultiplierData.y,this._deltaMultiplierData.z,this._deltaMultiplierData.w))),this._usesOffset&&(this._particleColorNode.mode==ParticlePropertiesMode.LOCAL_STATIC?(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.START_OFFSET_INDEX),a,s,ContextGLVertexBufferFormat.FLOAT_4),a+=4,r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.DELTA_OFFSET_INDEX),a,s,ContextGLVertexBufferFormat.FLOAT_4)):(t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.START_OFFSET_INDEX),this._startOffsetData.x,this._startOffsetData.y,this._startOffsetData.z,this._startOffsetData.w),t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.DELTA_OFFSET_INDEX),this._deltaOffsetData.x,this._deltaOffsetData.y,this._deltaOffsetData.z,this._deltaOffsetData.w)))}},e.prototype.updateColorData=function(){if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._cycleData=new Vector3D(2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180,0,0)}this._particleColorNode.mode==ParticlePropertiesMode.GLOBAL&&(this._usesCycle?(this._usesMultiplier&&(this._startMultiplierData=new Vector3D((this._startColor.redMultiplier+this._endColor.redMultiplier)/2,(this._startColor.greenMultiplier+this._endColor.greenMultiplier)/2,(this._startColor.blueMultiplier+this._endColor.blueMultiplier)/2,(this._startColor.alphaMultiplier+this._endColor.alphaMultiplier)/2),this._deltaMultiplierData=new Vector3D((this._endColor.redMultiplier-this._startColor.redMultiplier)/2,(this._endColor.greenMultiplier-this._startColor.greenMultiplier)/2,(this._endColor.blueMultiplier-this._startColor.blueMultiplier)/2,(this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)/2)),this._usesOffset&&(this._startOffsetData=new Vector3D((this._startColor.redOffset+this._endColor.redOffset)/510,(this._startColor.greenOffset+this._endColor.greenOffset)/510,(this._startColor.blueOffset+this._endColor.blueOffset)/510,(this._startColor.alphaOffset+this._endColor.alphaOffset)/510),this._deltaOffsetData=new Vector3D((this._endColor.redOffset-this._startColor.redOffset)/510,(this._endColor.greenOffset-this._startColor.greenOffset)/510,(this._endColor.blueOffset-this._startColor.blueOffset)/510,(this._endColor.alphaOffset-this._startColor.alphaOffset)/510))):(this._usesMultiplier&&(this._startMultiplierData=new Vector3D(this._startColor.redMultiplier,this._startColor.greenMultiplier,this._startColor.blueMultiplier,this._startColor.alphaMultiplier),this._deltaMultiplierData=new Vector3D(this._endColor.redMultiplier-this._startColor.redMultiplier,this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._endColor.alphaMultiplier-this._startColor.alphaMultiplier)),this._usesOffset&&(this._startOffsetData=new Vector3D(this._startColor.redOffset/255,this._startColor.greenOffset/255,this._startColor.blueOffset/255,this._startColor.alphaOffset/255),this._deltaOffsetData=new Vector3D((this._endColor.redOffset-this._startColor.redOffset)/255,(this._endColor.greenOffset-this._startColor.greenOffset)/255,(this._endColor.blueOffset-this._startColor.blueOffset)/255,(this._endColor.alphaOffset-this._startColor.alphaOffset)/255))))},e.START_MULTIPLIER_INDEX=0,e.DELTA_MULTIPLIER_INDEX=1,e.START_OFFSET_INDEX=2,e.DELTA_OFFSET_INDEX=3,e.CYCLE_INDEX=4,e}(ParticleStateBase),ParticleTimeState=function(t){function e(e,i){var r=t.call(this,e,i,!0)||this;return r._particleTimeNode=i,r}return __extends(e,t),e.prototype.setRenderState=function(t,i,r,n,o,s){r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.TIME_STREAM_INDEX),this._particleTimeNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_4);var a=this._pTime/1e3;t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.TIME_CONSTANT_INDEX),a,a,a,a)},e.TIME_STREAM_INDEX=0,e.TIME_CONSTANT_INDEX=1,e}(ParticleStateBase),ParticleTimeNode=function(t){function e(e,i,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=!1);var n=t.call(this,"ParticleTime",ParticlePropertiesMode.LOCAL_STATIC,4,0)||this;return n._pStateClass=ParticleTimeState,n._iUsesDuration=e,n._iUsesLooping=i,n._iUsesDelay=r,n}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleTimeState.TIME_STREAM_INDEX,n.index);var o=i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleTimeState.TIME_CONSTANT_INDEX,o.index);var s="";s+="sub "+r.vertexTime+","+o+","+n+".x\n";var a=i.getFreeVertexSingleTemp();if(s+="sge "+a+","+r.vertexTime+","+r.vertexZeroConst+"\n",s+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+a+"\n",this._iUsesDuration)if(this._iUsesLooping){var l=i.getFreeVertexSingleTemp();this._iUsesDelay?(s+="div "+l+","+r.vertexTime+","+n+".z\n",s+="frc "+l+","+l+"\n",s+="mul "+r.vertexTime+","+l+","+n+".z\n",s+="slt "+l+","+r.vertexTime+","+n+".y\n",s+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+l+"\n"):(s+="mul "+l+","+r.vertexTime+","+n+".w\n",s+="frc "+l+","+l+"\n",s+="mul "+r.vertexTime+","+l+","+n+".y\n")}else{var h=i.getFreeVertexSingleTemp();s+="sge "+h+","+n+".y,"+r.vertexTime+"\n",s+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+h+"\n"}return s+="mul "+r.vertexLife+","+r.vertexTime+","+n+".w\n"},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){this._pOneData[0]=t.startTime,this._pOneData[1]=t.duration,this._pOneData[2]=t.delay+t.duration,this._pOneData[3]=1/t.duration},e}(ParticleNodeBase),AnimationSetError=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ErrorBase),AnimationSetBase=function(t){function e(){var e=t.call(this)||this;return e._animations=new Array,e._animationNames=new Array,e._animationDictionary=new Object,e}return __extends(e,t),e.prototype._pFindTempReg=function(t,e){void 0===e&&(e=null);for(var i,r=0;;){if(i="vt"+r,-1==t.indexOf(i)&&e!=i)return i;++r}},Object.defineProperty(e.prototype,"usesCPU",{get:function(){return this._usesCPU},enumerable:!0,configurable:!0}),e.prototype.resetGPUCompatibility=function(){this._usesCPU=!1},e.prototype.cancelGPUCompatibility=function(){this._usesCPU=!0},e.prototype.getAGALVertexCode=function(t,e,i){throw new AbstractMethodError},e.prototype.getAGALFragmentCode=function(t,e,i){throw new AbstractMethodError},e.prototype.getAGALUVCode=function(t,e,i){throw new AbstractMethodError},e.prototype.doneAGALCode=function(t){throw new AbstractMethodError},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animations",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),e.prototype.hasAnimation=function(t){return null!=this._animationDictionary[t]},e.prototype.getAnimation=function(t){return this._animationDictionary[t]},e.prototype.addAnimation=function(t){if(this._animationDictionary[t.name])throw new AnimationSetError("root node name '"+t.name+"' already exists in the set");this._animationDictionary[t.name]=t,this._animations.push(t),this._animationNames.push(t.name)},e.prototype.dispose=function(){},e.assetType="[asset AnimationSet]",e}(AssetBase),ParticleAnimationSet=function(t){function e(e,i,r){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===r&&(r=!1);var n=t.call(this)||this;return n._animationElements=new Object,n._particleNodes=new Array,n._localDynamicNodes=new Array,n._localStaticNodes=new Array,n._totalLenOfOneVertex=0,n.addAnimation(n._timeNode=new ParticleTimeNode(e,i,r)),n}return __extends(e,t),Object.defineProperty(e.prototype,"particleNodes",{get:function(){return this._particleNodes},enumerable:!0,configurable:!0}),e.prototype.addAnimation=function(e){var i,r=e;for(r._iProcessAnimationSetting(this),r.mode==ParticlePropertiesMode.LOCAL_STATIC?(r._iDataOffset=this._totalLenOfOneVertex,this._totalLenOfOneVertex+=r.dataLength,this._localStaticNodes.push(r)):r.mode==ParticlePropertiesMode.LOCAL_DYNAMIC&&this._localDynamicNodes.push(r),i=this._particleNodes.length-1;i>=0&&!(this._particleNodes[i].priority<=r.priority);i--);this._particleNodes.splice(i+1,0,r),t.prototype.addAnimation.call(this,e)},e.prototype.getAGALVertexCode=function(t,i,r){this._iAnimationRegisterData=t.animationRegisterData,null==this._iAnimationRegisterData&&(this._iAnimationRegisterData=t.animationRegisterData=new AnimationRegisterData),this._iAnimationRegisterData.reset(i,r,this.needVelocity);for(var n,o="",s=r.animatableAttributes.length,a=0;a<s;a++)o+="mov "+r.animationTargetRegisters[a]+","+r.animatableAttributes[a]+"\n";for(o+="mov "+this._iAnimationRegisterData.positionTarget+".xyz,"+this._iAnimationRegisterData.vertexZeroConst+"\n",this.needVelocity&&(o+="mov "+this._iAnimationRegisterData.velocityTarget+".xyz,"+this._iAnimationRegisterData.vertexZeroConst+"\n"),a=0;a<this._particleNodes.length;a++)(n=this._particleNodes[a]).priority<e.POST_PRIORITY&&(o+=n.getAGALVertexCode(t,this,i,this._iAnimationRegisterData));for(o+="add "+this._iAnimationRegisterData.scaleAndRotateTarget+".xyz,"+this._iAnimationRegisterData.scaleAndRotateTarget+".xyz,"+this._iAnimationRegisterData.positionTarget+".xyz\n",a=0;a<this._particleNodes.length;a++)(n=this._particleNodes[a]).priority>=e.POST_PRIORITY&&n.priority<e.COLOR_PRIORITY&&(o+=n.getAGALVertexCode(t,this,i,this._iAnimationRegisterData));for(this.hasColorMulNode&&(this._iAnimationRegisterData.colorMulTarget=i.getFreeVertexVectorTemp(),i.addVertexTempUsages(this._iAnimationRegisterData.colorMulTarget,1),this._iAnimationRegisterData.colorMulVary=i.getFreeVarying(),o+="mov "+this._iAnimationRegisterData.colorMulTarget+","+this._iAnimationRegisterData.vertexOneConst+"\n"),this.hasColorAddNode&&(this._iAnimationRegisterData.colorAddTarget=i.getFreeVertexVectorTemp(),i.addVertexTempUsages(this._iAnimationRegisterData.colorAddTarget,1),this._iAnimationRegisterData.colorAddVary=i.getFreeVarying(),o+="mov "+this._iAnimationRegisterData.colorAddTarget+","+this._iAnimationRegisterData.vertexZeroConst+"\n"),a=0;a<this._particleNodes.length;a++)(n=this._particleNodes[a]).priority>=e.COLOR_PRIORITY&&(o+=n.getAGALVertexCode(t,this,i,this._iAnimationRegisterData));return t.usesFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)&&(this.hasColorMulNode&&(o+="mov "+this._iAnimationRegisterData.colorMulVary+","+this._iAnimationRegisterData.colorMulTarget+"\n"),this.hasColorAddNode&&(o+="mov "+this._iAnimationRegisterData.colorAddVary+","+this._iAnimationRegisterData.colorAddTarget+"\n")),o},e.prototype.getAGALUVCode=function(t,e,i){var r="";if(this.hasUVNode){var n;this._iAnimationRegisterData.setUVSourceAndTarget(i),r+="mov "+this._iAnimationRegisterData.uvTarget+".xy,"+this._iAnimationRegisterData.uvAttribute.toString()+"\n";for(var o=0;o<this._particleNodes.length;o++)n=this._particleNodes[o];r+=n.getAGALUVCode(t,this,e,this._iAnimationRegisterData),r+="mov "+this._iAnimationRegisterData.uvVar+","+this._iAnimationRegisterData.uvTarget+".xy\n"}else r+="mov "+i.animatedUV+","+i.uvInput+"\n";return r},e.prototype.getAGALFragmentCode=function(t,e,i){var r="";return t.usesFragmentAnimation&&(this.hasColorAddNode||this.hasColorMulNode)&&(this.hasColorMulNode&&(r+="mul "+i+","+i+","+this._iAnimationRegisterData.colorMulVary+"\n"),this.hasColorAddNode&&(r+="add "+i+","+i+","+this._iAnimationRegisterData.colorAddVary+"\n")),r},e.prototype.doneAGALCode=function(t){t.setVertexConst(this._iAnimationRegisterData.vertexZeroConst.index,0,1,2,0)},Object.defineProperty(e.prototype,"usesCPU",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.cancelGPUCompatibility=function(){},e.prototype.dispose=function(){for(var e in this._animationElements)this._animationElements[e].dispose();t.prototype.dispose.call(this)},e.prototype.getAnimationElements=function(t,e){var i=this._animationElements[e.id];return i||(this._iGenerateAnimationElements(t),this._animationElements[e.id])},e.prototype._iGenerateAnimationElements=function(t){if(null==this.initParticleFunc)throw new Error("no initParticleFunc set");var e,i,r,n,o,s,a=!1;for(e=0;e<t.numElements;e++)o=t.elements[e],this._animationElements[o.id]||((n=this._animationElements[o.id]=new AnimationElements).createVertexData(o.numVertices,this._totalLenOfOneVertex),a=!0);if(a){var l,h,c,u,p,d,f,_,g,m,y,v=t.particles,b=v.length,x=t.numParticles,A=new ParticleProperties;for(A.total=x,A.startTime=0,A.duration=1e3,A.delay=.1,e=0,i=0;e<x;){for(A.index=e,this.initParticleFunc.call(this.initParticleScope,A),r=0;r<this._localStaticNodes.length;r++)this._localStaticNodes[r]._iGeneratePropertyOfOneParticle(A);for(;i<b&&(l=v[i]).particleIndex==e;){for(r=0;r<t.numElements;r++)if((o=t.elements[r])==l.elements){n=this._animationElements[o.id];break}for(f=l.numVertices,_=n.vertexData,g=f*this._totalLenOfOneVertex,m=n.numProcessedVertices*this._totalLenOfOneVertex,r=0;r<this._localStaticNodes.length;r++)for(d=(s=this._localStaticNodes[r]).oneData,h=s.dataLength,c=m+s._iDataOffset,u=0;u<g;u+=this._totalLenOfOneVertex)for(y=c+u,p=0;p<h;p++)_[y+p]=d[p];this._localDynamicNodes.length&&n.animationParticles.push(new ParticleAnimationData(e,A.startTime,A.duration,A.delay,l)),n.numProcessedVertices+=f,i++}e++}}},e.POST_PRIORITY=9,e.COLOR_PRIORITY=18,e}(AnimationSetBase),ParticleColorNode=function(t){function e(e,i,r,n,o,s,a,l,h){void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=1),void 0===h&&(h=0);var c=t.call(this,"ParticleColor",e,i&&r?16:8,ParticleAnimationSet.COLOR_PRIORITY)||this;return c._pStateClass=ParticleColorState,c._iUsesMultiplier=i,c._iUsesOffset=r,c._iUsesCycle=n,c._iUsesPhase=o,c._iStartColor=s||new ColorTransform,c._iEndColor=a||new ColorTransform,c._iCycleDuration=l,c._iCyclePhase=h,c}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(t.usesFragmentAnimation){var o=i.getFreeVertexVectorTemp();if(this._iUsesCycle){var s=i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleColorState.CYCLE_INDEX,s.index),i.addVertexTempUsages(o,1);var a=i.getFreeVertexSingleTemp();i.removeVertexTempUsage(o),n+="mul "+a+","+r.vertexTime+","+s+".x\n",this._iUsesPhase&&(n+="add "+a+","+a+","+s+".y\n"),n+="sin "+a+","+a+"\n"}if(this._iUsesMultiplier){var l=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute(),h=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleColorState.START_MULTIPLIER_INDEX,l.index),r.setRegisterIndex(this,ParticleColorState.DELTA_MULTIPLIER_INDEX,h.index),n+="mul "+o+","+h+","+(this._iUsesCycle?a:r.vertexLife)+"\n",n+="add "+o+","+o+","+l+"\n",n+="mul "+r.colorMulTarget+","+o+","+r.colorMulTarget+"\n"}if(this._iUsesOffset){var c=this._pMode==ParticlePropertiesMode.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant(),u=this._pMode==ParticlePropertiesMode.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleColorState.START_OFFSET_INDEX,c.index),r.setRegisterIndex(this,ParticleColorState.DELTA_OFFSET_INDEX,u.index),n+="mul "+o+","+u+","+(this._iUsesCycle?a:r.vertexLife)+"\n",n+="add "+o+","+o+","+c+"\n",n+="add "+r.colorAddTarget+","+o+","+r.colorAddTarget+"\n"}}return n},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iProcessAnimationSetting=function(t){this._iUsesMultiplier&&(t.hasColorMulNode=!0),this._iUsesOffset&&(t.hasColorAddNode=!0)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.COLOR_START_COLORTRANSFORM];if(!i)throw new Error("there is no "+e.COLOR_START_COLORTRANSFORM+" in param!");var r=t[e.COLOR_END_COLORTRANSFORM];if(!r)throw new Error("there is no "+e.COLOR_END_COLORTRANSFORM+" in param!");var n=0;this._iUsesCycle?(this._iUsesMultiplier&&(this._pOneData[n++]=(i.redMultiplier+r.redMultiplier)/2,this._pOneData[n++]=(i.greenMultiplier+r.greenMultiplier)/2,this._pOneData[n++]=(i.blueMultiplier+r.blueMultiplier)/2,this._pOneData[n++]=(i.alphaMultiplier+r.alphaMultiplier)/2,this._pOneData[n++]=(i.redMultiplier-r.redMultiplier)/2,this._pOneData[n++]=(i.greenMultiplier-r.greenMultiplier)/2,this._pOneData[n++]=(i.blueMultiplier-r.blueMultiplier)/2,this._pOneData[n++]=(i.alphaMultiplier-r.alphaMultiplier)/2),this._iUsesOffset&&(this._pOneData[n++]=(i.redOffset+r.redOffset)/510,this._pOneData[n++]=(i.greenOffset+r.greenOffset)/510,this._pOneData[n++]=(i.blueOffset+r.blueOffset)/510,this._pOneData[n++]=(i.alphaOffset+r.alphaOffset)/510,this._pOneData[n++]=(i.redOffset-r.redOffset)/510,this._pOneData[n++]=(i.greenOffset-r.greenOffset)/510,this._pOneData[n++]=(i.blueOffset-r.blueOffset)/510,this._pOneData[n++]=(i.alphaOffset-r.alphaOffset)/510)):(this._iUsesMultiplier&&(this._pOneData[n++]=i.redMultiplier,this._pOneData[n++]=i.greenMultiplier,this._pOneData[n++]=i.blueMultiplier,this._pOneData[n++]=i.alphaMultiplier,this._pOneData[n++]=r.redMultiplier-i.redMultiplier,this._pOneData[n++]=r.greenMultiplier-i.greenMultiplier,this._pOneData[n++]=r.blueMultiplier-i.blueMultiplier,this._pOneData[n++]=r.alphaMultiplier-i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[n++]=i.redOffset/255,this._pOneData[n++]=i.greenOffset/255,this._pOneData[n++]=i.blueOffset/255,this._pOneData[n++]=i.alphaOffset/255,this._pOneData[n++]=(r.redOffset-i.redOffset)/255,this._pOneData[n++]=(r.greenOffset-i.greenOffset)/255,this._pOneData[n++]=(r.blueOffset-i.blueOffset)/255,this._pOneData[n++]=(r.alphaOffset-i.alphaOffset)/255))},e.COLOR_START_COLORTRANSFORM="ColorStartColorTransform",e.COLOR_END_COLORTRANSFORM="ColorEndColorTransform",e}(ParticleNodeBase),ParticleFollowState=function(t){function e(e,i){var r=t.call(this,e,i,!0)||this;return r._targetPos=new Vector3D,r._targetEuler=new Vector3D,r._temp=new Vector3D,r._particleFollowNode=i,r._smooth=i._iSmooth,r}return __extends(e,t),Object.defineProperty(e.prototype,"followTarget",{get:function(){return this._followTarget},set:function(t){this._followTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},set:function(t){this._smooth=t},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){this._followTarget&&(this._particleFollowNode._iUsesPosition&&(this._targetPos.x=this._followTarget.transform.position.x/i.sourceEntity.transform.scale.x,this._targetPos.y=this._followTarget.transform.position.y/i.sourceEntity.transform.scale.y,this._targetPos.z=this._followTarget.transform.position.z/i.sourceEntity.transform.scale.z),this._particleFollowNode._iUsesRotation&&(this._targetEuler.x=this._followTarget.transform.rotation.x,this._targetEuler.y=this._followTarget.transform.rotation.y,this._targetEuler.z=this._followTarget.transform.rotation.z)),this._prePos||(this._prePos=this._targetPos.clone()),this._preEuler||(this._preEuler=this._targetEuler.clone());var a=this._pTime/1e3,l=r.previousTime,h=a-l,c=l!=a;this._particleFollowNode._iUsesPosition&&this._particleFollowNode._iUsesRotation?(c&&this.processPositionAndRotation(a,h,r),r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3),r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset+3,s,ContextGLVertexBufferFormat.FLOAT_3)):this._particleFollowNode._iUsesPosition?(c&&this.processPosition(a,h,r),r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.FOLLOW_POSITION_INDEX),this._particleFollowNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3)):this._particleFollowNode._iUsesRotation&&(c&&this.precessRotation(a,h,r),r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.FOLLOW_ROTATION_INDEX),this._particleFollowNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3)),this._prePos.copyFrom(this._targetPos),this._targetEuler.copyFrom(this._targetEuler),r.previousTime=a},e.prototype.processPosition=function(t,e,i){var r,n,o=i.animationParticles,s=i.vertexData,a=!1,l=o.length;this._smooth?(n=this._prePos.subtract(this._targetPos)).scaleBy(1/e):r=this._targetPos;for(var h=0;h<l;h++){var c=(t-o[h].startTime)/o[h].totalTime,u=(c-Math.floor(c))*o[h].totalTime;if(u-e<=0){var p=o[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(n),this._temp.scaleBy(u),r=this._targetPos.add(this._temp)),s[p]!=r.x||s[p+1]!=r.y||s[p+2]!=r.z){a=!0;for(var d=0;d<o[h].numVertices;d++)s[p++]=r.x,s[p++]=r.y,s[p++]=r.z}}}a&&i.invalidateBuffer()},e.prototype.precessRotation=function(t,e,i){var r,n,o=i.animationParticles,s=i.vertexData,a=!1,l=o.length;this._smooth?(n=this._preEuler.subtract(this._targetEuler)).scaleBy(1/e):r=this._targetEuler;for(var h=0;h<l;h++){var c=(t-o[h].startTime)/o[h].totalTime,u=(c-Math.floor(c))*o[h].totalTime;if(u-e<=0){var p=o[h].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(n),this._temp.scaleBy(u),r=this._targetEuler.add(this._temp)),s[p]!=r.x||s[p+1]!=r.y||s[p+2]!=r.z){a=!0;for(var d=0;d<o[h].numVertices;d++)s[p++]=r.x,s[p++]=r.y,s[p++]=r.z}}}a&&i.invalidateBuffer()},e.prototype.processPositionAndRotation=function(t,e,i){var r,n,o,s,a=i.animationParticles,l=i.vertexData,h=!1,c=a.length;this._smooth?((o=this._prePos.subtract(this._targetPos)).scaleBy(1/e),(s=this._preEuler.subtract(this._targetEuler)).scaleBy(1/e)):(r=this._targetPos,n=this._targetEuler);for(var u=0;u<c;u++){var p=(t-a[u].startTime)/a[u].totalTime,d=(p-Math.floor(p))*a[u].totalTime;if(d-e<=0){var f=a[u].startVertexIndex*i.totalLenOfOneVertex+this._particleFollowNode._iDataOffset;if(this._smooth&&(this._temp.copyFrom(o),this._temp.scaleBy(d),r=this._targetPos.add(this._temp),this._temp.copyFrom(s),this._temp.scaleBy(d),n=this._targetEuler.add(this._temp)),l[f]!=r.x||l[f+1]!=r.y||l[f+2]!=r.z||l[f+3]!=n.x||l[f+4]!=n.y||l[f+5]!=n.z){h=!0;for(var _=0;_<a[u].numVertices;_++)l[f++]=r.x,l[f++]=r.y,l[f++]=r.z,l[f++]=n.x,l[f++]=n.y,l[f++]=n.z}}}h&&i.invalidateBuffer()},e.FOLLOW_POSITION_INDEX=0,e.FOLLOW_ROTATION_INDEX=1,e}(ParticleStateBase),ParticleFollowNode=function(t){function e(e,i,r){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===r&&(r=!1);var n=t.call(this,"ParticleFollow",ParticlePropertiesMode.LOCAL_DYNAMIC,e&&i?6:3,ParticleAnimationSet.POST_PRIORITY)||this;return n._pStateClass=ParticleFollowState,n._iUsesPosition=e,n._iUsesRotation=i,n._iSmooth=r,n}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(this._iUsesRotation){var o=i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleFollowState.FOLLOW_ROTATION_INDEX,o.index);var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var l,h=i.getFreeVertexVectorTemp();e.hasBillboard&&(i.addVertexTempUsages(h,1),l=i.getFreeVertexVectorTemp()),i.removeVertexTempUsage(s),i.removeVertexTempUsage(a),e.hasBillboard&&i.removeVertexTempUsage(h);var c,u=r.rotationRegisters.length;if(n+="mov "+s+","+r.vertexZeroConst+"\n",n+="mov "+s+".x,"+r.vertexOneConst+"\n",n+="mov "+h+","+r.vertexZeroConst+"\n",n+="sin "+h+".y,"+o+".x\n",n+="cos "+h+".z,"+o+".x\n",n+="mov "+a+".x,"+r.vertexZeroConst+"\n",n+="mov "+a+".y,"+h+".z\n",n+="neg "+a+".z,"+h+".y\n",e.hasBillboard)n+="m33 "+l+".xyz,"+r.positionTarget+".xyz,"+s+"\n";else for(n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+s+"\n",c=0;c<u;c++)n+="m33 "+r.rotationRegisters[c]+".xyz,"+r.rotationRegisters[c]+","+s+"\n";if(n+="mov "+s+","+r.vertexZeroConst+"\n",n+="cos "+s+".x,"+o+".y\n",n+="sin "+s+".z,"+o+".y\n",n+="mov "+a+","+r.vertexZeroConst+"\n",n+="mov "+a+".y,"+r.vertexOneConst+"\n",n+="mov "+h+","+r.vertexZeroConst+"\n",n+="neg "+h+".x,"+s+".z\n",n+="mov "+h+".z,"+s+".x\n",e.hasBillboard)n+="m33 "+l+".xyz,"+l+".xyz,"+s+"\n";else for(n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+s+"\n",c=0;c<u;c++)n+="m33 "+r.rotationRegisters[c]+".xyz,"+r.rotationRegisters[c]+","+s+"\n";if(n+="mov "+a+","+r.vertexZeroConst+"\n",n+="sin "+a+".x,"+o+".z\n",n+="cos "+a+".y,"+o+".z\n",n+="mov "+s+","+r.vertexZeroConst+"\n",n+="mov "+s+".x,"+a+".y\n",n+="neg "+s+".y,"+a+".x\n",n+="mov "+h+","+r.vertexZeroConst+"\n",n+="mov "+h+".z,"+r.vertexOneConst+"\n",e.hasBillboard)n+="m33 "+l+".xyz,"+l+".xyz,"+s+"\n",n+="sub "+l+".xyz,"+l+".xyz,"+r.positionTarget+".xyz\n",n+="add "+r.scaleAndRotateTarget+".xyz,"+l+".xyz,"+r.scaleAndRotateTarget+".xyz\n";else for(n+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+s+"\n",c=0;c<u;c++)n+="m33 "+r.rotationRegisters[c]+".xyz,"+r.rotationRegisters[c]+","+s+"\n"}if(this._iUsesPosition){var p=i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleFollowState.FOLLOW_POSITION_INDEX,p.index),n+="add "+r.scaleAndRotateTarget+".xyz,"+p+","+r.scaleAndRotateTarget+".xyz\n"}return n},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e}(ParticleNodeBase),ParticleInitialColorState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleInitialColorNode=i,r._usesMultiplier=i._iUsesMultiplier,r._usesOffset=i._iUsesOffset,r._initialColor=i._iInitialColor,r.updateColorData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"initialColor",{get:function(){return this._initialColor},set:function(t){this._initialColor=t},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){if(t.usesFragmentAnimation)if(this._particleInitialColorNode.mode==ParticlePropertiesMode.LOCAL_STATIC){var a=this._particleInitialColorNode._iDataOffset;this._usesMultiplier&&(r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.MULTIPLIER_INDEX),a,s,ContextGLVertexBufferFormat.FLOAT_4),a+=4),this._usesOffset&&r.activateVertexBuffer(n.getRegisterIndex(this._pAnimationNode,e.OFFSET_INDEX),a,s,ContextGLVertexBufferFormat.FLOAT_4)}else this._usesMultiplier&&t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.MULTIPLIER_INDEX),this._multiplierData.x,this._multiplierData.y,this._multiplierData.z,this._multiplierData.w),this._usesOffset&&t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.OFFSET_INDEX),this._offsetData.x,this._offsetData.y,this._offsetData.z,this._offsetData.w)},e.prototype.updateColorData=function(){this._particleInitialColorNode.mode==ParticlePropertiesMode.GLOBAL&&(this._usesMultiplier&&(this._multiplierData=new Vector3D(this._initialColor.redMultiplier,this._initialColor.greenMultiplier,this._initialColor.blueMultiplier,this._initialColor.alphaMultiplier)),this._usesOffset&&(this._offsetData=new Vector3D(this._initialColor.redOffset/255,this._initialColor.greenOffset/255,this._initialColor.blueOffset/255,this._initialColor.alphaOffset/255)))},e.MULTIPLIER_INDEX=0,e.OFFSET_INDEX=1,e}(ParticleStateBase),ParticleInitialColorNode=function(t){function e(e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=null);var o=t.call(this,"ParticleInitialColor",e,i&&r?8:4,ParticleAnimationSet.COLOR_PRIORITY)||this;return o._pStateClass=ParticleInitialColorState,o._iUsesMultiplier=i,o._iUsesOffset=r,o._iInitialColor=n||new ColorTransform,o}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(t.usesFragmentAnimation){if(this._iUsesMultiplier){var o=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleInitialColorState.MULTIPLIER_INDEX,o.index),n+="mul "+r.colorMulTarget+","+o+","+r.colorMulTarget+"\n"}if(this._iUsesOffset){var s=this._pMode==ParticlePropertiesMode.LOCAL_STATIC?i.getFreeVertexAttribute():i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleInitialColorState.OFFSET_INDEX,s.index),n+="add "+r.colorAddTarget+","+s+","+r.colorAddTarget+"\n"}}return n},e.prototype._iProcessAnimationSetting=function(t){this._iUsesMultiplier&&(t.hasColorMulNode=!0),this._iUsesOffset&&(t.hasColorAddNode=!0)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.COLOR_INITIAL_COLORTRANSFORM];if(!i)throw new Error("there is no "+e.COLOR_INITIAL_COLORTRANSFORM+" in param!");var r=0;this._iUsesMultiplier&&(this._pOneData[r++]=i.redMultiplier,this._pOneData[r++]=i.greenMultiplier,this._pOneData[r++]=i.blueMultiplier,this._pOneData[r++]=i.alphaMultiplier),this._iUsesOffset&&(this._pOneData[r++]=i.redOffset/255,this._pOneData[r++]=i.greenOffset/255,this._pOneData[r++]=i.blueOffset/255,this._pOneData[r++]=i.alphaOffset/255)},e.COLOR_INITIAL_COLORTRANSFORM="ColorInitialColorTransform",e}(ParticleNodeBase),ParticleOrbitState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleOrbitNode=i,r._usesEulers=r._particleOrbitNode._iUsesEulers,r._usesCycle=r._particleOrbitNode._iUsesCycle,r._usesPhase=r._particleOrbitNode._iUsesPhase,r._eulers=r._particleOrbitNode._iEulers,r._radius=r._particleOrbitNode._iRadius,r._cycleDuration=r._particleOrbitNode._iCycleDuration,r._cyclePhase=r._particleOrbitNode._iCyclePhase,r.updateOrbitData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eulers",{get:function(){return this._eulers},set:function(t){this._eulers=t,this.updateOrbitData()},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){var a=n.getRegisterIndex(this._pAnimationNode,e.ORBIT_INDEX);this._particleOrbitNode.mode==ParticlePropertiesMode.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(a,this._particleOrbitNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_4):r.activateVertexBuffer(a,this._particleOrbitNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3):t.setVertexConst(a,this._orbitData.x,this._orbitData.y,this._orbitData.z,this._orbitData.w),this._usesEulers&&t.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,e.EULERS_INDEX),this._eulersMatrix)},e.prototype.updateOrbitData=function(){if(this._usesEulers&&(this._eulersMatrix=new Matrix3D,this._eulersMatrix.appendRotation(this._eulers.x,Vector3D.X_AXIS),this._eulersMatrix.appendRotation(this._eulers.y,Vector3D.Y_AXIS),this._eulersMatrix.appendRotation(this._eulers.z,Vector3D.Z_AXIS)),this._particleOrbitNode.mode==ParticlePropertiesMode.GLOBAL)if(this._orbitData=new Vector3D(this._radius,0,this._radius*Math.PI*2,this._cyclePhase*Math.PI/180),this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._orbitData.y=2*Math.PI/this._cycleDuration}else this._orbitData.y=2*Math.PI},e.ORBIT_INDEX=0,e.EULERS_INDEX=1,e}(ParticleStateBase),ParticleOrbitNode=function(t){function e(e,i,r,n,o,s,a,l){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===o&&(o=100),void 0===s&&(s=1),void 0===a&&(a=0),void 0===l&&(l=null);var h=this,c=3;return n&&c++,(h=t.call(this,"ParticleOrbit",e,c)||this)._pStateClass=ParticleOrbitState,h._iUsesEulers=i,h._iUsesCycle=r,h._iUsesPhase=n,h._iRadius=o,h._iCycleDuration=s,h._iCyclePhase=a,h._iEulers=l||new Vector3D,h}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleOrbitState.ORBIT_INDEX,n.index);var o=i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleOrbitState.EULERS_INDEX,o.index),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant();var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a=new ShaderRegisterElement(s.regName,s.index),l=i.getFreeVertexVectorTemp(),h=new ShaderRegisterElement(l.regName,l.index,0),c=new ShaderRegisterElement(l.regName,l.index,1),u=new ShaderRegisterElement(l.regName,l.index,2);i.removeVertexTempUsage(s);var p="";return this._iUsesCycle?(p+="mul "+u+","+r.vertexTime+","+n+".y\n",this._iUsesPhase&&(p+="add "+u+","+u+","+n+".w\n")):p+="mul "+u+","+r.vertexLife+","+n+".y\n",p+="cos "+h+","+u+"\n",p+="sin "+c+","+u+"\n",p+="mul "+a+".x,"+h+","+n+".x\n",p+="mul "+a+".y,"+c+","+n+".x\n",p+="mov "+a+".wz"+r.vertexZeroConst+"\n",this._iUsesEulers&&(p+="m44 "+a+","+a+","+o+"\n"),p+="add "+r.positionTarget+".xyz,"+a+".xyz,"+r.positionTarget+".xyz\n",e.needVelocity&&(p+="neg "+a+".x,"+c+"\n",p+="mov "+a+".y,"+h+"\n",p+="mov "+a+".zw,"+r.vertexZeroConst+"\n",this._iUsesEulers&&(p+="m44 "+a+","+a+","+o+"\n"),p+="mul "+a+","+a+","+n+".z\n",p+="div "+a+","+a+","+n+".y\n",this._iUsesCycle||(p+="div "+a+","+a+","+r.vertexLife+"\n"),p+="add "+r.velocityTarget+".xyz,"+r.velocityTarget+".xyz,"+a+".xyz\n"),p},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.ORBIT_VECTOR3D];if(!i)throw new Error("there is no "+e.ORBIT_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._iUsesCycle&&i.y<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[1]=2*Math.PI/(this._iUsesCycle?i.y:1),this._pOneData[2]=i.x*Math.PI*2,this._iUsesPhase&&(this._pOneData[3]=i.z*Math.PI/180)},e.ORBIT_VECTOR3D="OrbitVector3D",e}(ParticleNodeBase),ParticleOscillatorState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleOscillatorNode=i,r._oscillator=r._particleOscillatorNode._iOscillator,r.updateOscillatorData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"oscillator",{get:function(){return this._oscillator},set:function(t){this._oscillator=t,this.updateOscillatorData()},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){var a=n.getRegisterIndex(this._pAnimationNode,e.OSCILLATOR_INDEX);this._particleOscillatorNode.mode==ParticlePropertiesMode.LOCAL_STATIC?r.activateVertexBuffer(a,this._particleOscillatorNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_4):t.setVertexConst(a,this._oscillatorData.x,this._oscillatorData.y,this._oscillatorData.z,this._oscillatorData.w)},e.prototype.updateOscillatorData=function(){if(this._particleOscillatorNode.mode==ParticlePropertiesMode.GLOBAL){if(this._oscillator.w<=0)throw new Error("the cycle duration must greater than zero");null==this._oscillatorData&&(this._oscillatorData=new Vector3D),this._oscillatorData.x=this._oscillator.x,this._oscillatorData.y=this._oscillator.y,this._oscillatorData.z=this._oscillator.z,this._oscillatorData.w=2*Math.PI/this._oscillator.w}},e.OSCILLATOR_INDEX=0,e}(ParticleStateBase),ParticleOscillatorNode=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,"ParticleOscillator",e,4)||this;return r._pStateClass=ParticleOscillatorState,r._iOscillator=i||new Vector3D,r}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleOscillatorState.OSCILLATOR_INDEX,n.index);var o=i.getFreeVertexVectorTemp(),s=new ShaderRegisterElement(o.regName,o.index,0),a=new ShaderRegisterElement(o.regName,o.index,1),l=new ShaderRegisterElement(o.regName,o.index,2);i.addVertexTempUsages(o,1);var h=i.getFreeVertexVectorTemp(),c=new ShaderRegisterElement(h.regName,h.index);i.removeVertexTempUsage(o);var u="";return u+="mul "+s+","+r.vertexTime+","+n+".w\n",u+="sin "+a+","+s+"\n",u+="mul "+c+".xyz,"+a+","+n+".xyz\n",u+="add "+r.positionTarget+".xyz,"+c+".xyz,"+r.positionTarget+".xyz\n",e.needVelocity&&(u+="cos "+l+","+s+"\n",u+="mul "+c+".xyz,"+l+","+n+".xyz\n",u+="add "+r.velocityTarget+".xyz,"+c+".xyz,"+r.velocityTarget+".xyz\n"),u},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.OSCILLATOR_VECTOR3D];if(!i)throw new Error("there is no "+e.OSCILLATOR_VECTOR3D+" in param!");if(this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=2*Math.PI/i.w},e.OSCILLATOR_VECTOR3D="OscillatorVector3D",e}(ParticleNodeBase),ParticlePositionState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particlePositionNode=i,r._position=r._particlePositionNode._iPosition,r}return __extends(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),e.prototype.getPositions=function(){return this._pDynamicProperties},e.prototype.setPositions=function(t){this._pDynamicProperties=t,this._pDynamicPropertiesDirty=new Object},e.prototype.setRenderState=function(t,i,r,n,o,s){this._particlePositionNode.mode!=ParticlePropertiesMode.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var a=n.getRegisterIndex(this._pAnimationNode,e.POSITION_INDEX);this._particlePositionNode.mode==ParticlePropertiesMode.GLOBAL?t.setVertexConst(a,this._position.x,this._position.y,this._position.z):r.activateVertexBuffer(a,this._particlePositionNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3)},e.POSITION_INDEX=0,e}(ParticleStateBase),ParticlePositionNode=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,"ParticlePosition",e,3)||this;return r._pStateClass=ParticlePositionState,r._iPosition=i||new Vector3D,r}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();return r.setRegisterIndex(this,ParticlePositionState.POSITION_INDEX,n.index),"add "+r.positionTarget+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n"},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+e.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},e.POSITION_VECTOR3D="PositionVector3D",e}(ParticleNodeBase),ParticleRotateToHeadingState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._matrix=new Matrix3D,r}return __extends(e,t),e.prototype.setRenderState=function(t,i,r,n,o,s){this._pParticleAnimator.animationSet.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.transform.concatenatedMatrix3D),this._matrix.append(o.transform.inverseConcatenatedMatrix3D),t.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,e.MATRIX_INDEX),this._matrix))},e.MATRIX_INDEX=0,e}(ParticleStateBase),ParticleRotateToHeadingNode=function(t){function e(){var e=t.call(this,"ParticleRotateToHeading",ParticlePropertiesMode.GLOBAL,0,3)||this;return e._pStateClass=ParticleRotateToHeadingState,e}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n,o="",s=r.rotationRegisters.length;if(e.hasBillboard){var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var l=i.getFreeVertexVectorTemp();i.addVertexTempUsages(l,1);var h=i.getFreeVertexVectorTemp(),c=i.getFreeVertexConstant();for(r.setRegisterIndex(this,ParticleRotateToHeadingState.MATRIX_INDEX,c.index),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.removeVertexTempUsage(a),i.removeVertexTempUsage(l),o+="m33 "+a+".xyz,"+r.velocityTarget+".xyz,"+c+"\n",o+="mov "+h+","+r.vertexZeroConst+"\n",o+="mov "+h+".xy,"+a+".xy\n",o+="nrm "+h+".xyz,"+h+".xyz\n",o+="mov "+l+","+r.vertexZeroConst+"\n",o+="mov "+l+".x,"+h+".y\n",o+="mov "+l+".y,"+h+".x\n",o+="mov "+a+","+r.vertexZeroConst+"\n",o+="mov "+a+".x,"+h+".x\n",o+="neg "+a+".y,"+h+".y\n",o+="mov "+h+","+r.vertexZeroConst+"\n",o+="mov "+h+".z,"+r.vertexOneConst+"\n",o+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+a+"\n",n=0;n<s;n++)o+="m33 "+r.rotationRegisters[n]+".xyz,"+r.rotationRegisters[n]+","+a+"\n"}else{var u=i.getFreeVertexVectorTemp();i.addVertexTempUsages(u,1);var p=i.getFreeVertexVectorTemp();i.addVertexTempUsages(p,1);var d=i.getFreeVertexVectorTemp();i.addVertexTempUsages(d,1);var f=i.getFreeVertexVectorTemp(),_=new ShaderRegisterElement(d.regName,d.index,3),g=new ShaderRegisterElement(f.regName,f.index,3),m=new ShaderRegisterElement(u.regName,u.index,3),y=g;for(i.removeVertexTempUsage(u),i.removeVertexTempUsage(p),i.removeVertexTempUsage(d),o+="mov "+p+".x,"+r.vertexOneConst+"\n",o+="mov "+p+".yz,"+r.vertexZeroConst+"\n",o+="nrm "+u+".xyz,"+r.velocityTarget+".xyz\n",o+="dp3 "+m+","+u+".xyz,"+p+".xyz\n",o+="crs "+u+".xyz,"+p+".xyz,"+u+".xyz\n",o+="nrm "+u+".xyz,"+u+".xyz\n",o+="dp3 "+d+".x,"+u+".xyz,"+u+".xyz\n",o+="sge "+d+".x,"+r.vertexZeroConst+","+d+".x\n",o+="add "+u+".z,"+d+".x,"+u+".z\n",o+="add "+y+","+m+","+r.vertexOneConst+"\n",o+="div "+y+","+y+","+r.vertexTwoConst+"\n",o+="sqt "+_+","+y+"\n",o+="sub "+y+","+r.vertexOneConst+","+m+"\n",o+="div "+y+","+y+","+r.vertexTwoConst+"\n",o+="sqt "+g+","+y+"\n",o+="mul "+d+".xyz,"+g+","+u+".xyz\n",o+="mul "+f+".xyz,"+g+","+u+".xyz\n",o+="neg "+f+".xyz,"+f+".xyz\n",o+="crs "+u+".xyz,"+d+".xyz,"+r.scaleAndRotateTarget+".xyz\n",o+="mul "+p+".xyz,"+_+","+r.scaleAndRotateTarget+".xyz\n",o+="add "+u+".xyz,"+u+".xyz,"+p+".xyz\n",o+="dp3 "+p+".w,"+d+".xyz,"+r.scaleAndRotateTarget+".xyz\n",o+="neg "+u+".w,"+p+".w\n",o+="crs "+d+".xyz,"+u+".xyz,"+f+".xyz\n",o+="mul "+p+".xyzw,"+u+".xyzw,"+_+"\n",o+="add "+d+".xyz,"+d+".xyz,"+p+".xyz\n",o+="mul "+p+".xyz,"+u+".w,"+f+".xyz\n",o+="add "+r.scaleAndRotateTarget+".xyz,"+d+".xyz,"+p+".xyz\n",n=0;n<s;n++)o+="mov "+p+".x,"+r.vertexOneConst+"\n",o+="mov "+p+".yz,"+r.vertexZeroConst+"\n",o+="nrm "+u+".xyz,"+r.velocityTarget+".xyz\n",o+="dp3 "+m+","+u+".xyz,"+p+".xyz\n",o+="crs "+u+".xyz,"+p+".xyz,"+u+".xyz\n",o+="nrm "+u+".xyz,"+u+".xyz\n",o+="dp3 "+d+".x,"+u+".xyz,"+u+".xyz\n",o+="sge "+d+".x,"+r.vertexZeroConst+","+d+".x\n",o+="add "+u+".z,"+d+".x,"+u+".z\n",o+="add "+y+","+m+","+r.vertexOneConst+"\n",o+="div "+y+","+y+","+r.vertexTwoConst+"\n",o+="sqt "+_+","+y+"\n",o+="sub "+y+","+r.vertexOneConst+","+m+"\n",o+="div "+y+","+y+","+r.vertexTwoConst+"\n",o+="sqt "+g+","+y+"\n",o+="mul "+d+".xyz,"+g+","+u+".xyz\n",o+="mul "+f+".xyz,"+g+","+u+".xyz\n",o+="neg "+f+".xyz,"+f+".xyz\n",o+="crs "+u+".xyz,"+d+".xyz,"+r.rotationRegisters[n]+".xyz\n",o+="mul "+p+".xyz,"+_+","+r.rotationRegisters[n]+".xyz\n",o+="add "+u+".xyz,"+u+".xyz,"+p+".xyz\n",o+="dp3 "+p+".w,"+d+".xyz,"+r.rotationRegisters[n]+".xyz\n",o+="neg "+u+".w,"+p+".w\n",o+="crs "+d+".xyz,"+u+".xyz,"+f+".xyz\n",o+="mul "+p+".xyzw,"+u+".xyzw,"+_+"\n",o+="add "+d+".xyz,"+d+".xyz,"+p+".xyz\n",o+="mul "+p+".xyz,"+u+".w,"+f+".xyz\n",o+="add "+r.rotationRegisters[n]+".xyz,"+d+".xyz,"+p+".xyz\n"}return o},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iProcessAnimationSetting=function(t){t.needVelocity=!0},e}(ParticleNodeBase),ParticleRotateToPositionState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._matrix=new Matrix3D,r._particleRotateToPositionNode=i,r._position=r._particleRotateToPositionNode._iPosition,r}return __extends(e,t),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){var a=n.getRegisterIndex(this._pAnimationNode,e.POSITION_INDEX);this._pParticleAnimator.animationSet.hasBillboard&&(this._matrix.copyFrom(i.sourceEntity.transform.concatenatedMatrix3D),this._matrix.append(o.transform.inverseConcatenatedMatrix3D),t.setVertexConstFromMatrix(n.getRegisterIndex(this._pAnimationNode,e.MATRIX_INDEX),this._matrix)),this._particleRotateToPositionNode.mode==ParticlePropertiesMode.GLOBAL?(this._offset=i.sourceEntity.transform.inverseConcatenatedMatrix3D.transformVector(this._position),t.setVertexConst(a,this._offset.x,this._offset.y,this._offset.z)):r.activateVertexBuffer(a,this._particleRotateToPositionNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3)},e.MATRIX_INDEX=0,e.POSITION_INDEX=1,e}(ParticleStateBase),ParticleRotateToPositionNode=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,"ParticleRotateToPosition",e,3,3)||this;return r._pStateClass=ParticleRotateToPositionState,r._iPosition=i||new Vector3D,r}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleRotateToPositionState.POSITION_INDEX,n.index);var o,s="",a=r.rotationRegisters.length;if(e.hasBillboard){var l=i.getFreeVertexVectorTemp();i.addVertexTempUsages(l,1);var h=i.getFreeVertexVectorTemp();i.addVertexTempUsages(h,1);var c=i.getFreeVertexVectorTemp(),u=i.getFreeVertexConstant();for(r.setRegisterIndex(this,ParticleRotateToPositionState.MATRIX_INDEX,u.index),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.getFreeVertexConstant(),i.removeVertexTempUsage(l),i.removeVertexTempUsage(h),s+="sub "+l+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n",s+="m33 "+l+".xyz,"+l+".xyz,"+u+"\n",s+="mov "+c+","+r.vertexZeroConst+"\n",s+="mov "+c+".xy,"+l+".xy\n",s+="nrm "+c+".xyz,"+c+".xyz\n",s+="mov "+h+","+r.vertexZeroConst+"\n",s+="mov "+h+".x,"+c+".y\n",s+="mov "+h+".y,"+c+".x\n",s+="mov "+l+","+r.vertexZeroConst+"\n",s+="mov "+l+".x,"+c+".x\n",s+="neg "+l+".y,"+c+".y\n",s+="mov "+c+","+r.vertexZeroConst+"\n",s+="mov "+c+".z,"+r.vertexOneConst+"\n",s+="m33 "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+l+"\n",o=0;o<a;o++)s+="m33 "+r.rotationRegisters[o]+".xyz,"+r.rotationRegisters[o]+","+l+"\n"}else{var p=i.getFreeVertexVectorTemp();i.addVertexTempUsages(p,1);var d=i.getFreeVertexVectorTemp();i.addVertexTempUsages(d,1);var f=new ShaderRegisterElement(d.regName,d.index,0),_=new ShaderRegisterElement(d.regName,d.index,1),g=new ShaderRegisterElement(d.regName,d.index,2),m=new ShaderRegisterElement(d.regName,d.index,3),y=i.getFreeVertexVectorTemp();for(i.addVertexTempUsages(y,1),i.removeVertexTempUsage(p),i.removeVertexTempUsage(d),i.removeVertexTempUsage(y),s+="sub "+p+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n",s+="nrm "+p+".xyz,"+p+".xyz\n",s+="mov "+_+","+p+".y\n",s+="mul "+f+","+_+","+_+"\n",s+="sub "+f+","+r.vertexOneConst+","+f+"\n",s+="sqt "+f+","+f+"\n",s+="mul "+y+".x,"+f+","+r.scaleAndRotateTarget+".y\n",s+="mul "+y+".y,"+_+","+r.scaleAndRotateTarget+".z\n",s+="mul "+y+".z,"+_+","+r.scaleAndRotateTarget+".y\n",s+="mul "+y+".w,"+f+","+r.scaleAndRotateTarget+".z\n",s+="sub "+r.scaleAndRotateTarget+".y,"+y+".x,"+y+".y\n",s+="add "+r.scaleAndRotateTarget+".z,"+y+".z,"+y+".w\n",s+="abs "+y+".y,"+p+".y\n",s+="sge "+y+".z,"+y+".y,"+r.vertexOneConst+"\n",s+="mul "+y+".x,"+y+".y,"+p+".y\n",s+="mov "+p+".y,"+r.vertexZeroConst+"\n",s+="dp3 "+_+","+p+".xyz,"+p+".xyz\n",s+="sge "+m+","+r.vertexZeroConst+","+_+"\n",s+="mov "+p+".y,"+r.vertexZeroConst+"\n",s+="nrm "+p+".xyz,"+p+".xyz\n",s+="sub "+_+","+r.vertexOneConst+","+m+"\n",s+="mul "+_+","+_+","+p+".x\n",s+="mov "+f+","+p+".z\n",s+="neg "+f+","+f+"\n",s+="sub "+g+","+r.vertexOneConst+","+f+"\n",s+="mul "+g+","+y+".x,"+m+"\n",s+="add "+f+","+f+","+g+"\n",s+="mul "+y+".x,"+f+","+r.scaleAndRotateTarget+".x\n",s+="mul "+y+".y,"+_+","+r.scaleAndRotateTarget+".z\n",s+="mul "+y+".z,"+_+","+r.scaleAndRotateTarget+".x\n",s+="mul "+y+".w,"+f+","+r.scaleAndRotateTarget+".z\n",s+="sub "+r.scaleAndRotateTarget+".x,"+y+".x,"+y+".y\n",s+="add "+r.scaleAndRotateTarget+".z,"+y+".z,"+y+".w\n",o=0;o<a;o++)s+="sub "+p+".xyz,"+n+".xyz,"+r.positionTarget+".xyz\n",s+="nrm "+p+".xyz,"+p+".xyz\n",s+="mov "+_+","+p+".y\n",s+="mul "+f+","+_+","+_+"\n",s+="sub "+f+","+r.vertexOneConst+","+f+"\n",s+="sqt "+f+","+f+"\n",s+="mul "+y+".x,"+f+","+r.rotationRegisters[o]+".y\n",s+="mul "+y+".y,"+_+","+r.rotationRegisters[o]+".z\n",s+="mul "+y+".z,"+_+","+r.rotationRegisters[o]+".y\n",s+="mul "+y+".w,"+f+","+r.rotationRegisters[o]+".z\n",s+="sub "+r.rotationRegisters[o]+".y,"+y+".x,"+y+".y\n",s+="add "+r.rotationRegisters[o]+".z,"+y+".z,"+y+".w\n",s+="abs "+y+".y,"+p+".y\n",s+="sge "+y+".z,"+y+".y,"+r.vertexOneConst+"\n",s+="mul "+y+".x,"+y+".y,"+p+".y\n",s+="mov "+p+".y,"+r.vertexZeroConst+"\n",s+="dp3 "+_+","+p+".xyz,"+p+".xyz\n",s+="sge "+m+","+r.vertexZeroConst+","+_+"\n",s+="mov "+p+".y,"+r.vertexZeroConst+"\n",s+="nrm "+p+".xyz,"+p+".xyz\n",s+="sub "+_+","+r.vertexOneConst+","+m+"\n",s+="mul "+_+","+_+","+p+".x\n",s+="mov "+f+","+p+".z\n",s+="neg "+f+","+f+"\n",s+="sub "+g+","+r.vertexOneConst+","+f+"\n",s+="mul "+g+","+y+".x,"+m+"\n",s+="add "+f+","+f+","+g+"\n",s+="mul "+y+".x,"+f+","+r.rotationRegisters[o]+".x\n",s+="mul "+y+".y,"+_+","+r.rotationRegisters[o]+".z\n",s+="mul "+y+".z,"+_+","+r.rotationRegisters[o]+".x\n",s+="mul "+y+".w,"+f+","+r.rotationRegisters[o]+".z\n",s+="sub "+r.rotationRegisters[o]+".x,"+y+".x,"+y+".y\n",s+="add "+r.rotationRegisters[o]+".z,"+y+".z,"+y+".w\n"}return s},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.POSITION_VECTOR3D];if(!i)throw new Error("there is no "+e.POSITION_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},e.POSITION_VECTOR3D="RotateToPositionVector3D",e}(ParticleNodeBase),ParticleRotationalVelocityState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleRotationalVelocityNode=i,r._rotationalVelocity=r._particleRotationalVelocityNode._iRotationalVelocity,r.updateRotationalVelocityData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"rotationalVelocity",{get:function(){return this._rotationalVelocity},set:function(t){this._rotationalVelocity=t,this.updateRotationalVelocityData()},enumerable:!0,configurable:!0}),e.prototype.getRotationalVelocities=function(){return this._pDynamicProperties},e.prototype.setRotationalVelocities=function(t){this._pDynamicProperties=t,this._pDynamicPropertiesDirty=new Object},e.prototype.setRenderState=function(t,i,r,n,o,s){this._particleRotationalVelocityNode.mode!=ParticlePropertiesMode.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var a=n.getRegisterIndex(this._pAnimationNode,e.ROTATIONALVELOCITY_INDEX);this._particleRotationalVelocityNode.mode==ParticlePropertiesMode.GLOBAL?t.setVertexConst(a,this._rotationalVelocityData.x,this._rotationalVelocityData.y,this._rotationalVelocityData.z,this._rotationalVelocityData.w):r.activateVertexBuffer(a,this._particleRotationalVelocityNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_4)},e.prototype.updateRotationalVelocityData=function(){if(this._particleRotationalVelocityNode.mode==ParticlePropertiesMode.GLOBAL){if(this._rotationalVelocity.w<=0)throw new Error("the cycle duration must greater than zero");var t=this._rotationalVelocity.clone();t.length<=0?t.z=1:t.normalize(),this._rotationalVelocityData=new Vector3D(t.x,t.y,t.z,Math.PI/t.w)}},e.ROTATIONALVELOCITY_INDEX=0,e}(ParticleStateBase),ParticleRotationalVelocityNode=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,"ParticleRotationalVelocity",e,4)||this;return r._pStateClass=ParticleRotationalVelocityState,r._iRotationalVelocity=i||new Vector3D,r}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleRotationalVelocityState.ROTATIONALVELOCITY_INDEX,n.index);var o=i.getFreeVertexVectorTemp();i.addVertexTempUsages(o,1);var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a=i.getFreeVertexVectorTemp();i.addVertexTempUsages(a,1);var l=new ShaderRegisterElement(a.regName,a.index),h=i.getFreeVertexVectorTemp();h=new ShaderRegisterElement(h.regName,h.index);var c=new ShaderRegisterElement(l.regName,l.index,3),u=new ShaderRegisterElement(h.regName,h.index,3);i.removeVertexTempUsage(o),i.removeVertexTempUsage(s),i.removeVertexTempUsage(a);var p="";p+="mov "+o+".xyz,"+n+".xyz\n",p+="mov "+o+".w,"+r.vertexZeroConst+"\n",p+="mul "+c+","+r.vertexTime+","+n+".w\n",p+="sin "+u+","+c+"\n",p+="cos "+c+","+c+"\n",p+="mul "+l+".xyz,"+u+","+o+".xyz\n",p+="mul "+h+".xyz,"+u+","+o+".xyz\n",p+="neg "+h+".xyz,"+h+".xyz\n",p+="crs "+o+".xyz,"+l+".xyz,"+r.scaleAndRotateTarget+".xyz\n",p+="mul "+s+".xyz,"+c+","+r.scaleAndRotateTarget+".xyz\n",p+="add "+o+".xyz,"+o+".xyz,"+s+".xyz\n",p+="dp3 "+s+".w,"+l+".xyz,"+r.scaleAndRotateTarget+".xyz\n",p+="neg "+o+".w,"+s+".w\n",p+="crs "+l+".xyz,"+o+".xyz,"+h+".xyz\n",p+="mul "+s+".xyzw,"+o+".xyzw,"+c+"\n",p+="add "+l+".xyz,"+l+".xyz,"+s+".xyz\n",p+="mul "+s+".xyz,"+o+".w,"+h+".xyz\n",p+="add "+r.scaleAndRotateTarget+".xyz,"+l+".xyz,"+s+".xyz\n";for(var d=r.rotationRegisters.length,f=0;f<d;f++)p+="mov "+o+".xyz,"+n+".xyz\n",p+="mov "+o+".w,"+r.vertexZeroConst+"\n",p+="mul "+c+","+r.vertexTime+","+n+".w\n",p+="sin "+u+","+c+"\n",p+="cos "+c+","+c+"\n",p+="mul "+l+".xyz,"+u+","+o+".xyz\n",p+="mul "+h+".xyz,"+u+","+o+".xyz\n",p+="neg "+h+".xyz,"+h+".xyz\n",p+="crs "+o+".xyz,"+l+".xyz,"+r.rotationRegisters[f]+".xyz\n",p+="mul "+s+".xyz,"+c+","+r.rotationRegisters[f]+"\n",p+="add "+o+".xyz,"+o+".xyz,"+s+".xyz\n",p+="dp3 "+s+".w,"+l+".xyz,"+r.rotationRegisters[f]+"\n",p+="neg "+o+".w,"+s+".w\n",p+="crs "+l+".xyz,"+o+".xyz,"+h+".xyz\n",p+="mul "+s+".xyzw,"+o+".xyzw,"+c+"\n",p+="add "+l+".xyz,"+l+".xyz,"+s+".xyz\n",p+="mul "+s+".xyz,"+o+".w,"+h+".xyz\n",p+="add "+r.rotationRegisters[f]+","+l+".xyz,"+s+".xyz\n";return p},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.ROTATIONALVELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+e.ROTATIONALVELOCITY_VECTOR3D+" in param!");if(i.length<=0?i.z=1:i.normalize(),this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z,i.w<=0)throw new Error("the cycle duration must greater than zero");this._pOneData[3]=Math.PI/i.w},e.ROTATIONALVELOCITY_VECTOR3D="RotationalVelocityVector3D",e}(ParticleNodeBase),ParticleScaleState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleScaleNode=i,r._usesCycle=r._particleScaleNode._iUsesCycle,r._usesPhase=r._particleScaleNode._iUsesPhase,r._minScale=r._particleScaleNode._iMinScale,r._maxScale=r._particleScaleNode._iMaxScale,r._cycleDuration=r._particleScaleNode._iCycleDuration,r._cyclePhase=r._particleScaleNode._iCyclePhase,r.updateScaleData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"minScale",{get:function(){return this._minScale},set:function(t){this._minScale=t,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScale",{get:function(){return this._maxScale},set:function(t){this._maxScale=t,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateScaleData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateScaleData()},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){var a=n.getRegisterIndex(this._pAnimationNode,e.SCALE_INDEX);this._particleScaleNode.mode==ParticlePropertiesMode.LOCAL_STATIC?this._usesCycle?this._usesPhase?r.activateVertexBuffer(a,this._particleScaleNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_4):r.activateVertexBuffer(a,this._particleScaleNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3):r.activateVertexBuffer(a,this._particleScaleNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_2):t.setVertexConst(a,this._scaleData.x,this._scaleData.y,this._scaleData.z,this._scaleData.w)},e.prototype.updateScaleData=function(){if(this._particleScaleNode.mode==ParticlePropertiesMode.GLOBAL)if(this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._scaleData=new Vector3D((this._minScale+this._maxScale)/2,Math.abs(this._minScale-this._maxScale)/2,2*Math.PI/this._cycleDuration,this._cyclePhase*Math.PI/180)}else this._scaleData=new Vector3D(this._minScale,this._maxScale-this._minScale,0,0)},e.SCALE_INDEX=0,e}(ParticleStateBase),ParticleScaleNode=function(t){function e(e,i,r,n,o,s,a){void 0===n&&(n=1),void 0===o&&(o=1),void 0===s&&(s=1),void 0===a&&(a=0);var l=t.call(this,"ParticleScale",e,i&&r?4:i||r?3:2,3)||this;return l._pStateClass=ParticleScaleState,l._iUsesCycle=i,l._iUsesPhase=r,l._iMinScale=n,l._iMaxScale=o,l._iCycleDuration=s,l._iCyclePhase=a,l}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n="",o=i.getFreeVertexSingleTemp(),s=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();return r.setRegisterIndex(this,ParticleScaleState.SCALE_INDEX,s.index),this._iUsesCycle&&(n+="mul "+o+","+r.vertexTime+","+s+".z\n",this._iUsesPhase&&(n+="add "+o+","+o+","+s+".w\n"),n+="sin "+o+","+o+"\n"),n+="mul "+o+","+s+".y,"+(this._iUsesCycle?o:r.vertexLife)+"\n",n+="add "+o+","+s+".x,"+o+"\n",n+="mul "+r.scaleAndRotateTarget+".xyz,"+r.scaleAndRotateTarget+".xyz,"+o+"\n"},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.SCALE_VECTOR3D];if(!i)throw new Error("there is no "+e.SCALE_VECTOR3D+" in param!");if(this._iUsesCycle){if(this._pOneData[0]=(i.x+i.y)/2,this._pOneData[1]=Math.abs(i.x-i.y)/2,i.z<=0)throw new Error("the cycle duration must be greater than zero");this._pOneData[2]=2*Math.PI/i.z,this._iUsesPhase&&(this._pOneData[3]=i.w*Math.PI/180)}else this._pOneData[0]=i.x,this._pOneData[1]=i.y-i.x},e.SCALE_VECTOR3D="ScaleVector3D",e}(ParticleNodeBase),ParticleSegmentedColorState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._usesMultiplier=i._iUsesMultiplier,r._usesOffset=i._iUsesOffset,r._startColor=i._iStartColor,r._endColor=i._iEndColor,r._segmentPoints=i._iSegmentPoints,r._numSegmentPoint=i._iNumSegmentPoint,r.updateColorData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"startColor",{get:function(){return this._startColor},set:function(t){this._startColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endColor",{get:function(){return this._endColor},set:function(t){this._endColor=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSegmentPoint",{get:function(){return this._numSegmentPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentPoints",{get:function(){return this._segmentPoints},set:function(t){this._segmentPoints=t,this.updateColorData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usesMultiplier",{get:function(){return this._usesMultiplier},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usesOffset",{get:function(){return this._usesOffset},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){t.usesFragmentAnimation&&(this._numSegmentPoint>0&&t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.TIME_DATA_INDEX),this._timeLifeData[0],this._timeLifeData[1],this._timeLifeData[2],this._timeLifeData[3]),this._usesMultiplier&&t.setVertexConstFromArray(n.getRegisterIndex(this._pAnimationNode,e.START_MULTIPLIER_INDEX),this._multiplierData),this._usesOffset&&t.setVertexConstFromArray(n.getRegisterIndex(this._pAnimationNode,e.START_OFFSET_INDEX),this._offsetData))},e.prototype.updateColorData=function(){var t;this._timeLifeData=new Float32Array(4),this._multiplierData=new Float32Array(4*(this._numSegmentPoint+1)),this._offsetData=new Float32Array(4*(this._numSegmentPoint+1));var e=0,i=this._numSegmentPoint>3?3:this._numSegmentPoint;for(t=0;t<i;t++)this._timeLifeData[e++]=0==t?this._segmentPoints[t].life:this._segmentPoints[t].life-this._segmentPoints[t-1].life;if(t=i,0==this._numSegmentPoint?this._timeLifeData[e++]=1:this._timeLifeData[e++]=1-this._segmentPoints[t-1].life,this._usesMultiplier){for(e=0,this._multiplierData[e++]=this._startColor.redMultiplier,this._multiplierData[e++]=this._startColor.greenMultiplier,this._multiplierData[e++]=this._startColor.blueMultiplier,this._multiplierData[e++]=this._startColor.alphaMultiplier,t=0;t<this._numSegmentPoint;t++)0==t?(this._multiplierData[e++]=(this._segmentPoints[t].color.redMultiplier-this._startColor.redMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._segmentPoints[t].color.greenMultiplier-this._startColor.greenMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._segmentPoints[t].color.blueMultiplier-this._startColor.blueMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._segmentPoints[t].color.alphaMultiplier-this._startColor.alphaMultiplier)/this._timeLifeData[t]):(this._multiplierData[e++]=(this._segmentPoints[t].color.redMultiplier-this._segmentPoints[t-1].color.redMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._segmentPoints[t].color.greenMultiplier-this._segmentPoints[t-1].color.greenMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._segmentPoints[t].color.blueMultiplier-this._segmentPoints[t-1].color.blueMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._segmentPoints[t].color.alphaMultiplier-this._segmentPoints[t-1].color.alphaMultiplier)/this._timeLifeData[t]);t=this._numSegmentPoint,0==this._numSegmentPoint?(this._multiplierData[e++]=this._endColor.redMultiplier-this._startColor.redMultiplier,this._multiplierData[e++]=this._endColor.greenMultiplier-this._startColor.greenMultiplier,this._multiplierData[e++]=this._endColor.blueMultiplier-this._startColor.blueMultiplier,this._multiplierData[e++]=this._endColor.alphaMultiplier-this._startColor.alphaMultiplier):(this._multiplierData[e++]=(this._endColor.redMultiplier-this._segmentPoints[t-1].color.redMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._endColor.greenMultiplier-this._segmentPoints[t-1].color.greenMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._endColor.blueMultiplier-this._segmentPoints[t-1].color.blueMultiplier)/this._timeLifeData[t],this._multiplierData[e++]=(this._endColor.alphaMultiplier-this._segmentPoints[t-1].color.alphaMultiplier)/this._timeLifeData[t])}if(this._usesOffset){for(e=0,this._offsetData[e++]=this._startColor.redOffset/255,this._offsetData[e++]=this._startColor.greenOffset/255,this._offsetData[e++]=this._startColor.blueOffset/255,this._offsetData[e++]=this._startColor.alphaOffset/255,t=0;t<this._numSegmentPoint;t++)0==t?(this._offsetData[e++]=(this._segmentPoints[t].color.redOffset-this._startColor.redOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._segmentPoints[t].color.greenOffset-this._startColor.greenOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._segmentPoints[t].color.blueOffset-this._startColor.blueOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._segmentPoints[t].color.alphaOffset-this._startColor.alphaOffset)/this._timeLifeData[t]/255):(this._offsetData[e++]=(this._segmentPoints[t].color.redOffset-this._segmentPoints[t-1].color.redOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._segmentPoints[t].color.greenOffset-this._segmentPoints[t-1].color.greenOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._segmentPoints[t].color.blueOffset-this._segmentPoints[t-1].color.blueOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._segmentPoints[t].color.alphaOffset-this._segmentPoints[t-1].color.alphaOffset)/this._timeLifeData[t]/255);t=this._numSegmentPoint,0==this._numSegmentPoint?(this._offsetData[e++]=(this._endColor.redOffset-this._startColor.redOffset)/255,this._offsetData[e++]=(this._endColor.greenOffset-this._startColor.greenOffset)/255,this._offsetData[e++]=(this._endColor.blueOffset-this._startColor.blueOffset)/255,this._offsetData[e++]=(this._endColor.alphaOffset-this._startColor.alphaOffset)/255):(this._offsetData[t]=(this._endColor.redOffset-this._segmentPoints[t-1].color.redOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._endColor.greenOffset-this._segmentPoints[t-1].color.greenOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._endColor.blueOffset-this._segmentPoints[t-1].color.blueOffset)/this._timeLifeData[t]/255,this._offsetData[e++]=(this._endColor.alphaOffset-this._segmentPoints[t-1].color.alphaOffset)/this._timeLifeData[t]/255)}},e.START_MULTIPLIER_INDEX=0,e.START_OFFSET_INDEX=1,e.TIME_DATA_INDEX=2,e}(ParticleStateBase),ParticleSegmentedColorNode=function(t){function e(e,i,r,n,o,s){var a=t.call(this,"ParticleSegmentedColor",ParticlePropertiesMode.GLOBAL,0,ParticleAnimationSet.COLOR_PRIORITY)||this;if(a._pStateClass=ParticleSegmentedColorState,r>4)throw new Error("the numSegmentPoint must be less or equal 4");return a._iUsesMultiplier=e,a._iUsesOffset=i,a._iNumSegmentPoint=r,a._iStartColor=n,a._iEndColor=o,a._iSegmentPoints=s,a}return __extends(e,t),e.prototype._iProcessAnimationSetting=function(t){this._iUsesMultiplier&&(t.hasColorMulNode=!0),this._iUsesOffset&&(t.hasColorAddNode=!0)},e.prototype.getAGALVertexCode=function(t,e,i,r){var n="";if(t.usesFragmentAnimation){var o;this._iUsesMultiplier&&(o=i.getFreeVertexVectorTemp(),i.addVertexTempUsages(o,1));var s=i.getFreeVertexVectorTemp();i.addVertexTempUsages(s,1);var a=i.getFreeVertexVectorTemp(),l=new ShaderRegisterElement(a.regName,a.index,0),h=new ShaderRegisterElement(a.regName,a.index,1);this._iUsesMultiplier&&i.removeVertexTempUsage(o),i.removeVertexTempUsage(s);var c,u,p,d,f,_=i.getFreeVertexConstant();if(r.setRegisterIndex(this,ParticleSegmentedColorState.TIME_DATA_INDEX,_.index),this._iUsesMultiplier)for(u=i.getFreeVertexConstant(),r.setRegisterIndex(this,ParticleSegmentedColorState.START_MULTIPLIER_INDEX,u.index),p=new Array,c=0;c<this._iNumSegmentPoint+1;c++)p.push(i.getFreeVertexConstant());if(this._iUsesOffset)for(d=i.getFreeVertexConstant(),r.setRegisterIndex(this,ParticleSegmentedColorState.START_OFFSET_INDEX,d.index),f=new Array,c=0;c<this._iNumSegmentPoint+1;c++)f.push(i.getFreeVertexConstant());for(this._iUsesMultiplier&&(n+="mov "+o+","+u+"\n"),this._iUsesOffset&&(n+="add "+r.colorAddTarget+","+r.colorAddTarget+","+d+"\n"),c=0;c<this._iNumSegmentPoint;c++){switch(c){case 0:n+="min "+h+","+r.vertexLife+","+_+".x\n";break;case 1:n+="sub "+l+","+r.vertexLife+","+_+".x\n",n+="max "+h+","+l+","+r.vertexZeroConst+"\n",n+="min "+h+","+h+","+_+".y\n";break;case 2:n+="sub "+l+","+l+","+_+".y\n",n+="max "+h+","+l+","+r.vertexZeroConst+"\n",n+="min "+h+","+h+","+_+".z\n";break;case 3:n+="sub "+l+","+l+","+_+".z\n",n+="max "+h+","+l+","+r.vertexZeroConst+"\n",n+="min "+h+","+h+","+_+".w\n"}this._iUsesMultiplier&&(n+="mul "+s+","+h+","+p[c]+"\n",n+="add "+o+","+o+","+s+"\n"),this._iUsesOffset&&(n+="mul "+s+","+h+","+f[c]+"\n",n+="add "+r.colorAddTarget+","+r.colorAddTarget+","+s+"\n")}if(0==this._iNumSegmentPoint)h=r.vertexLife;else{switch(this._iNumSegmentPoint){case 1:n+="sub "+l+","+r.vertexLife+","+_+".x\n";break;case 2:n+="sub "+l+","+l+","+_+".y\n";break;case 3:n+="sub "+l+","+l+","+_+".z\n";break;case 4:n+="sub "+l+","+l+","+_+".w\n"}n+="max "+h+","+l+","+r.vertexZeroConst+"\n"}this._iUsesMultiplier&&(n+="mul "+s+","+h+","+p[this._iNumSegmentPoint]+"\n",n+="add "+o+","+o+","+s+"\n",n+="mul "+r.colorMulTarget+","+r.colorMulTarget+","+o+"\n"),this._iUsesOffset&&(n+="mul "+s+","+h+","+f[this._iNumSegmentPoint]+"\n",n+="add "+r.colorAddTarget+","+r.colorAddTarget+","+s+"\n")}return n},e}(ParticleNodeBase),ParticleSpriteSheetState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleSpriteSheetNode=i,r._usesCycle=r._particleSpriteSheetNode._iUsesCycle,r._usesPhase=r._particleSpriteSheetNode._iUsesCycle,r._totalFrames=r._particleSpriteSheetNode._iTotalFrames,r._numColumns=r._particleSpriteSheetNode._iNumColumns,r._numRows=r._particleSpriteSheetNode._iNumRows,r._cycleDuration=r._particleSpriteSheetNode._iCycleDuration,r._cyclePhase=r._particleSpriteSheetNode._iCyclePhase,r.updateSpriteSheetData(),r}return __extends(e,t),Object.defineProperty(e.prototype,"cyclePhase",{get:function(){return this._cyclePhase},set:function(t){this._cyclePhase=t,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cycleDuration",{get:function(){return this._cycleDuration},set:function(t){this._cycleDuration=t,this.updateSpriteSheetData()},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,i,r,n,o,s){if(!t.usesUVTransform&&(t.setVertexConst(n.getRegisterIndex(this._pAnimationNode,e.UV_INDEX_0),this._spriteSheetData[0],this._spriteSheetData[1],this._spriteSheetData[2],this._spriteSheetData[3]),this._usesCycle)){var a=n.getRegisterIndex(this._pAnimationNode,e.UV_INDEX_1);this._particleSpriteSheetNode.mode==ParticlePropertiesMode.LOCAL_STATIC?this._usesPhase?r.activateVertexBuffer(a,this._particleSpriteSheetNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3):r.activateVertexBuffer(a,this._particleSpriteSheetNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_2):t.setVertexConst(a,this._spriteSheetData[4],this._spriteSheetData[5])}},e.prototype.updateSpriteSheetData=function(){this._spriteSheetData=new Array(8);var t=this._totalFrames/this._numColumns;if(this._spriteSheetData[0]=t,this._spriteSheetData[1]=1/this._numColumns,this._spriteSheetData[2]=1/this._numRows,this._usesCycle){if(this._cycleDuration<=0)throw new Error("the cycle duration must be greater than zero");this._spriteSheetData[4]=t/this._cycleDuration,this._spriteSheetData[5]=this._cycleDuration,this._usesPhase&&(this._spriteSheetData[6]=this._cyclePhase)}},e.UV_INDEX_0=0,e.UV_INDEX_1=1,e}(ParticleStateBase),ParticleSpriteSheetNode=function(t){function e(e,i,r,n,o,s,a,l){void 0===n&&(n=1),void 0===o&&(o=1),void 0===s&&(s=1),void 0===a&&(a=0),void 0===l&&(l=Number.MAX_VALUE);var h=t.call(this,"ParticleSpriteSheet",e,i?r?3:2:1,ParticleAnimationSet.POST_PRIORITY+1)||this;return h._pStateClass=ParticleSpriteSheetState,h._iUsesCycle=i,h._iUsesPhase=r,h._iNumColumns=n,h._iNumRows=o,h._iCyclePhase=a,h._iCycleDuration=s,h._iTotalFrames=Math.min(l,n*o),h}return __extends(e,t),Object.defineProperty(e.prototype,"numColumns",{get:function(){return this._iNumColumns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numRows",{get:function(){return this._iNumRows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._iTotalFrames},enumerable:!0,configurable:!0}),e.prototype.getAGALUVCode=function(t,e,i,r){var n=i.getFreeVertexConstant(),o=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleSpriteSheetState.UV_INDEX_0,n.index),r.setRegisterIndex(this,ParticleSpriteSheetState.UV_INDEX_1,o.index);var s=new ShaderRegisterElement(n.regName,n.index,0),a=new ShaderRegisterElement(n.regName,n.index,1),l=new ShaderRegisterElement(n.regName,n.index,2),h=new ShaderRegisterElement(o.regName,o.index,0),c=new ShaderRegisterElement(o.regName,o.index,1),u=new ShaderRegisterElement(o.regName,o.index,2),p=i.getFreeVertexVectorTemp(),d=new ShaderRegisterElement(p.regName,p.index,0),f=new ShaderRegisterElement(p.regName,p.index,1);p=new ShaderRegisterElement(p.regName,p.index,2);var _=new ShaderRegisterElement(p.regName,p.index,3),g=new ShaderRegisterElement(r.uvTarget.regName,r.uvTarget.index,0),m=new ShaderRegisterElement(r.uvTarget.regName,r.uvTarget.index,1),y="";return y+="mul "+g+","+g+","+a+"\n",this._iNumRows>1&&(y+="mul "+m+","+m+","+l+"\n"),this._iUsesCycle?(this._iUsesPhase?y+="add "+d+","+r.vertexTime+","+u+"\n":y+="mov "+d+","+r.vertexTime+"\n",y+="div "+d+","+d+","+c+"\n",y+="frc "+d+","+d+"\n",y+="mul "+d+","+d+","+c+"\n",y+="mul "+p+","+d+","+h+"\n"):y+="mul "+p.toString()+","+r.vertexLife+","+s+"\n",this._iNumRows>1&&(y+="frc "+_+","+p+"\n",y+="sub "+f+","+p+","+_+"\n",y+="mul "+f+","+f+","+l+"\n",y+="add "+m+","+m+","+f+"\n"),y+="div "+_+","+p+","+a+"\n",y+="frc "+p+","+_+"\n",y+="sub "+_+","+_+","+p+"\n",y+="mul "+p+","+_+","+a+"\n",this._iNumRows>1&&(y+="frc "+p+","+p+"\n"),y+="add "+g+","+g+","+p+"\n"},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iProcessAnimationSetting=function(t){t.hasUVNode=!0},e.prototype._iGeneratePropertyOfOneParticle=function(t){if(this._iUsesCycle){var i=t[e.UV_VECTOR3D];if(!i)throw new Error("there is no "+e.UV_VECTOR3D+" in param!");if(i.x<=0)throw new Error("the cycle duration must be greater than zero");var r=this._iTotalFrames/this._iNumColumns;this._pOneData[0]=r/i.x,this._pOneData[1]=i.x,this._iUsesPhase&&(this._pOneData[2]=i.y)}},e.UV_VECTOR3D="UVVector3D",e}(ParticleNodeBase),ParticleUVState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleUVNode=i,r}return __extends(e,t),e.prototype.setRenderState=function(t,i,r,n,o,s){if(!t.usesUVTransform){var a=n.getRegisterIndex(this._pAnimationNode,e.UV_INDEX),l=this._particleUVNode._iUvData;t.setVertexConst(a,l.x,l.y)}},e.UV_INDEX=0,e}(ParticleStateBase),ParticleUVNode=function(t){function e(e,i,r,n){void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n="x");var o=t.call(this,"ParticleUV",ParticlePropertiesMode.GLOBAL,4,ParticleAnimationSet.POST_PRIORITY+1)||this;return o._pStateClass=ParticleUVState,o._cycle=i,o._scale=r,o._axis=n,o.updateUVData(),o}return __extends(e,t),Object.defineProperty(e.prototype,"cycle",{get:function(){return this._cycle},set:function(t){this._cycle=t,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateUVData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"axis",{get:function(){return this._axis},set:function(t){this._axis=t},enumerable:!0,configurable:!0}),e.prototype.getAGALUVCode=function(t,e,i,r){var n="",o=i.getFreeVertexConstant();r.setRegisterIndex(this,ParticleUVState.UV_INDEX,o.index);var s="x"==this._axis?0:"y"==this._axis?1:2,a=new ShaderRegisterElement(r.uvTarget.regName,r.uvTarget.index,s),l=i.getFreeVertexSingleTemp();return 1!=this._scale&&(n+="mul "+a+","+a+","+o+".y\n"),n+="mul "+l+","+r.vertexTime+","+o+".x\n",n+="sin "+l+","+l+"\n",n+="add "+a+","+a+","+l+"\n"},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype.updateUVData=function(){this._iUvData=new Vector3D(2*Math.PI/this._cycle,this._scale,0,0)},e.prototype._iProcessAnimationSetting=function(t){t.hasUVNode=!0},e.U_AXIS="x",e.V_AXIS="y",e}(ParticleNodeBase),ParticleVelocityState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._particleVelocityNode=i,r._velocity=r._particleVelocityNode._iVelocity,r}return __extends(e,t),Object.defineProperty(e.prototype,"velocity",{get:function(){return this._velocity},set:function(t){this._velocity=t},enumerable:!0,configurable:!0}),e.prototype.getVelocities=function(){return this._pDynamicProperties},e.prototype.setVelocities=function(t){this._pDynamicProperties=t,this._pDynamicPropertiesDirty=new Object},e.prototype.setRenderState=function(t,i,r,n,o,s){this._particleVelocityNode.mode!=ParticlePropertiesMode.LOCAL_DYNAMIC||this._pDynamicPropertiesDirty[r._iUniqueId]||this._pUpdateDynamicProperties(r);var a=n.getRegisterIndex(this._pAnimationNode,e.VELOCITY_INDEX);this._particleVelocityNode.mode==ParticlePropertiesMode.GLOBAL?t.setVertexConst(a,this._velocity.x,this._velocity.y,this._velocity.z):r.activateVertexBuffer(a,this._particleVelocityNode._iDataOffset,s,ContextGLVertexBufferFormat.FLOAT_3)},e.VELOCITY_INDEX=0,e}(ParticleStateBase),ParticleVelocityNode=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,"ParticleVelocity",e,3)||this;return r._pStateClass=ParticleVelocityState,r._iVelocity=i||new Vector3D,r}return __extends(e,t),e.prototype.getAGALVertexCode=function(t,e,i,r){var n=this._pMode==ParticlePropertiesMode.GLOBAL?i.getFreeVertexConstant():i.getFreeVertexAttribute();r.setRegisterIndex(this,ParticleVelocityState.VELOCITY_INDEX,n.index);var o=i.getFreeVertexVectorTemp(),s="";return s+="mul "+o+","+r.vertexTime+","+n+"\n",s+="add "+r.positionTarget+".xyz,"+o+","+r.positionTarget+".xyz\n",e.needVelocity&&(s+="add "+r.velocityTarget+".xyz,"+n+".xyz,"+r.velocityTarget+".xyz\n"),s},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._iGeneratePropertyOfOneParticle=function(t){var i=t[e.VELOCITY_VECTOR3D];if(!i)throw new Error("there is no "+e.VELOCITY_VECTOR3D+" in param!");this._pOneData[0]=i.x,this._pOneData[1]=i.y,this._pOneData[2]=i.z},e.VELOCITY_VECTOR3D="VelocityVector3D",e}(ParticleNodeBase),SkeletonBinaryLERPState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._blendWeight=0,r._skeletonPose=new SkeletonPose,r._skeletonPoseDirty=!0,r._skeletonAnimationNode=i,r._inputA=e.getAnimationState(r._skeletonAnimationNode.inputA),r._inputB=e.getAnimationState(r._skeletonAnimationNode.inputB),r}return __extends(e,t),Object.defineProperty(e.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(t){this._blendWeight=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),e.prototype.phase=function(t){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(t),this._inputB.phase(t)},e.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=!0,this._inputA.update(e),this._inputB.update(e),t.prototype._pUpdateTime.call(this,e)},e.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},e.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var t=this._inputA.positionDelta,e=this._inputB.positionDelta;this._pRootDelta.x=t.x+this._blendWeight*(e.x-t.x),this._pRootDelta.y=t.y+this._blendWeight*(e.y-t.y),this._pRootDelta.z=t.z+this._blendWeight*(e.z-t.z)},e.prototype.updateSkeletonPose=function(t){var e;this._skeletonPoseDirty=!1;var i,r,n,o,s,a=this._skeletonPose.jointPoses,l=this._inputA.getSkeletonPose(t).jointPoses,h=this._inputB.getSkeletonPose(t).jointPoses,c=t.numJoints;a.length!=c&&(a.length=c);for(var u=0;u<c;++u)null==(e=a[u])&&(e=a[u]=new JointPose),i=l[u],r=h[u],n=i.translation,o=r.translation,e.orientation.lerp(i.orientation,r.orientation,this._blendWeight),(s=e.translation).x=n.x+this._blendWeight*(o.x-n.x),s.y=n.y+this._blendWeight*(o.y-n.y),s.z=n.z+this._blendWeight*(o.z-n.z)},e}(AnimationStateBase),SkeletonBinaryLERPNode=function(t){function e(){var e=t.call(this)||this;return e._pStateClass=SkeletonBinaryLERPState,e}return __extends(e,t),e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e}(AnimationNodeBase),AnimationStateEvent=function(t){function e(e,i,r,n){var o=t.call(this,e)||this;return o._animator=i,o._animationState=r,o._animationNode=n,o}return __extends(e,t),Object.defineProperty(e.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationState",{get:function(){return this._animationState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationNode",{get:function(){return this._animationNode},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._animator,this._animationState,this._animationNode)},e.PLAYBACK_COMPLETE="playbackComplete",e.TRANSITION_COMPLETE="transitionComplete",e}(EventBase),AnimationClipState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._pFramesDirty=!0,r._animationClipNode=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"blendWeight",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pBlendWeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pCurrentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextFrame",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._pNextFrame},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this._animationClipNode.looping||(t>this._pStartTime+this._animationClipNode.totalDuration?t=this._pStartTime+this._animationClipNode.totalDuration:t<this._pStartTime&&(t=this._pStartTime)),this._pTime!=t-this._pStartTime&&this._pUpdateTime(t)},e.prototype.phase=function(t){var e=t*this._animationClipNode.totalDuration+this._pStartTime;this._pTime!=e-this._pStartTime&&this._pUpdateTime(e)},e.prototype._pUpdateTime=function(e){this._pFramesDirty=!0,this._pTimeDir=e-this._pStartTime>this._pTime?1:-1,t.prototype._pUpdateTime.call(this,e)},e.prototype._pUpdateFrames=function(){this._pFramesDirty=!1;var t=this._animationClipNode.looping,e=this._animationClipNode.totalDuration,i=this._animationClipNode.lastFrame,r=this._pTime;if(t&&(r>=e||r<0)&&(r%=e)<0&&(r+=e),!t&&r>=e)this.notifyPlaybackComplete(),this._pCurrentFrame=i,this._pNextFrame=i,this._pBlendWeight=0;else if(!t&&r<=0)this._pCurrentFrame=0,this._pNextFrame=0,this._pBlendWeight=0;else if(this._animationClipNode.fixedFrameRate){var n=r/e*i;this._pCurrentFrame=Math.floor(n),this._pBlendWeight=n-this._pCurrentFrame,this._pNextFrame=this._pCurrentFrame+1}else{this._pCurrentFrame=0,this._pNextFrame=0;var o,s=0,a=this._animationClipNode.durations;do{o=s,s+=a[this._pNextFrame],this._pCurrentFrame=this._pNextFrame++}while(r>s);this._pCurrentFrame==i&&(this._pCurrentFrame=0,this._pNextFrame=1),this._pBlendWeight=(r-o)/a[this._pCurrentFrame]}},e.prototype.notifyPlaybackComplete=function(){null==this._animationStatePlaybackComplete&&(this._animationStatePlaybackComplete=new AnimationStateEvent(AnimationStateEvent.PLAYBACK_COMPLETE,this._pAnimator,this,this._animationClipNode)),this._animationClipNode.dispatchEvent(this._animationStatePlaybackComplete)},e}(AnimationStateBase),SkeletonClipState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._rootPos=new Vector3D,r._skeletonPose=new SkeletonPose,r._skeletonPoseDirty=!0,r._skeletonClipNode=i,r._frames=r._skeletonClipNode.frames,r}return __extends(e,t),Object.defineProperty(e.prototype,"currentPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentPose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextPose",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextPose},enumerable:!0,configurable:!0}),e.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},e.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=!0,t.prototype._pUpdateTime.call(this,e)},e.prototype._pUpdateFrames=function(){t.prototype._pUpdateFrames.call(this),this._currentPose=this._frames[this._pCurrentFrame],this._skeletonClipNode.looping&&this._pNextFrame>=this._skeletonClipNode.lastFrame?(this._nextPose=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextPose=this._frames[this._pNextFrame]},e.prototype.updateSkeletonPose=function(t){if(this._skeletonPoseDirty=!1,this._skeletonClipNode.totalDuration){this._pFramesDirty&&this._pUpdateFrames();var e,i,r,n,o,s,a=this._currentPose.jointPoses,l=this._nextPose.jointPoses,h=t.numJoints,c=this._skeletonPose.jointPoses;if(c.length!=h&&(c.length=h),h!=a.length||h!=l.length)throw new Error("joint counts don't match!");for(var u=0;u<h;++u)null==(o=c[u])&&(o=c[u]=new JointPose),r=a[u],n=l[u],e=r.translation,i=n.translation,this._skeletonClipNode.highQuality?o.orientation.slerp(r.orientation,n.orientation,this._pBlendWeight):o.orientation.lerp(r.orientation,n.orientation,this._pBlendWeight),u>0&&((s=o.translation).x=e.x+this._pBlendWeight*(i.x-e.x),s.y=e.y+this._pBlendWeight*(i.y-e.y),s.z=e.z+this._pBlendWeight*(i.z-e.z))}},e.prototype._pUpdatePositionDelta=function(){var t,e,i;this._pPositionDeltaDirty=!1,this._pFramesDirty&&this._pUpdateFrames();var r=this._skeletonClipNode.totalDelta;(this._pTimeDir>0&&this._pNextFrame<this._pOldFrame||this._pTimeDir<0&&this._pNextFrame>this._pOldFrame)&&(this._rootPos.x-=r.x*this._pTimeDir,this._rootPos.y-=r.y*this._pTimeDir,this._rootPos.z-=r.z*this._pTimeDir);var n=this._rootPos.x,o=this._rootPos.y,s=this._rootPos.z;this._skeletonClipNode.stitchFinalFrame&&this._pNextFrame==this._skeletonClipNode.lastFrame?(t=this._frames[0].jointPoses[0].translation,e=this._frames[1].jointPoses[0].translation,i=this._currentPose.jointPoses[0].translation,this._rootPos.x=i.x+t.x+this._pBlendWeight*(e.x-t.x),this._rootPos.y=i.y+t.y+this._pBlendWeight*(e.y-t.y),this._rootPos.z=i.z+t.z+this._pBlendWeight*(e.z-t.z)):(t=this._currentPose.jointPoses[0].translation,e=this._frames[this._pNextFrame].jointPoses[0].translation,this._rootPos.x=t.x+this._pBlendWeight*(e.x-t.x),this._rootPos.y=t.y+this._pBlendWeight*(e.y-t.y),this._rootPos.z=t.z+this._pBlendWeight*(e.z-t.z)),this._pRootDelta.x=this._rootPos.x-n,this._pRootDelta.y=this._rootPos.y-o,this._pRootDelta.z=this._rootPos.z-s,this._pOldFrame=this._pNextFrame},e}(AnimationClipState),SkeletonClipNode=function(t){function e(){var e=t.call(this)||this;return e._frames=new Array,e.highQuality=!1,e._pStateClass=SkeletonClipState,e}return __extends(e,t),Object.defineProperty(e.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),e.prototype.addFrame=function(t,e){this._frames.push(t),this._pDurations.push(e),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e.prototype._pUpdateStitch=function(){t.prototype._pUpdateStitch.call(this);for(var e,i,r=this._pNumFrames-1;r--;)this._pTotalDuration+=this._pDurations[r],e=this._frames[r].jointPoses[0].translation,i=this._frames[r+1].jointPoses[0].translation.subtract(e),this._pTotalDelta.x+=i.x,this._pTotalDelta.y+=i.y,this._pTotalDelta.z+=i.z;!this._pStitchFinalFrame&&this._pLooping||(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],e=this._frames[0].jointPoses[0].translation,i=this._frames[1].jointPoses[0].translation.subtract(e),this._pTotalDelta.x+=i.x,this._pTotalDelta.y+=i.y,this._pTotalDelta.z+=i.z)},e}(AnimationClipNodeBase),SkeletonDifferenceState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._blendWeight=0,r._skeletonPose=new SkeletonPose,r._skeletonPoseDirty=!0,r._skeletonAnimationNode=i,r._baseInput=e.getAnimationState(r._skeletonAnimationNode.baseInput),r._differenceInput=e.getAnimationState(r._skeletonAnimationNode.differenceInput),r}return __extends(e,t),Object.defineProperty(e.prototype,"blendWeight",{get:function(){return this._blendWeight},set:function(t){this._blendWeight=t,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},enumerable:!0,configurable:!0}),e.prototype.phase=function(t){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._baseInput.phase(t),this._baseInput.phase(t)},e.prototype._pUpdateTime=function(e){this._skeletonPoseDirty=!0,this._baseInput.update(e),this._differenceInput.update(e),t.prototype._pUpdateTime.call(this,e)},e.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},e.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1;var t=this._baseInput.positionDelta,e=this._differenceInput.positionDelta;this.positionDelta.x=t.x+this._blendWeight*e.x,this.positionDelta.y=t.y+this._blendWeight*e.y,this.positionDelta.z=t.z+this._blendWeight*e.z},e.prototype.updateSkeletonPose=function(t){var i;this._skeletonPoseDirty=!1;var r,n,o,s,a,l=this._skeletonPose.jointPoses,h=this._baseInput.getSkeletonPose(t).jointPoses,c=this._differenceInput.getSkeletonPose(t).jointPoses,u=t.numJoints;l.length!=u&&(l.length=u);for(var p=0;p<u;++p)null==(i=l[p])&&(i=l[p]=new JointPose),r=h[p],n=c[p],o=r.translation,s=n.translation,e._tempQuat.multiply(n.orientation,r.orientation),i.orientation.lerp(r.orientation,e._tempQuat,this._blendWeight),(a=i.translation).x=o.x+this._blendWeight*s.x,a.y=o.y+this._blendWeight*s.y,a.z=o.z+this._blendWeight*s.z},e._tempQuat=new Quaternion,e}(AnimationStateBase),SkeletonDifferenceNode=function(t){function e(){var e=t.call(this)||this;return e._pStateClass=SkeletonDifferenceState,e}return __extends(e,t),e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e}(AnimationNodeBase),SkeletonDirectionalState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._skeletonPose=new SkeletonPose,r._skeletonPoseDirty=!0,r._blendWeight=0,r._direction=0,r._blendDirty=!0,r._skeletonAnimationNode=i,r._forward=e.getAnimationState(r._skeletonAnimationNode.forward),r._backward=e.getAnimationState(r._skeletonAnimationNode.backward),r._left=e.getAnimationState(r._skeletonAnimationNode.left),r._right=e.getAnimationState(r._skeletonAnimationNode.right),r}return __extends(e,t),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction!=t&&(this._direction=t,this._blendDirty=!0,this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.phase=function(t){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0,this._inputA.phase(t),this._inputB.phase(t)},e.prototype._pUdateTime=function(e){this._blendDirty&&this.updateBlend(),this._skeletonPoseDirty=!0,this._inputA.update(e),this._inputB.update(e),t.prototype._pUpdateTime.call(this,e)},e.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},e.prototype._pUpdatePositionDelta=function(){this._pPositionDeltaDirty=!1,this._blendDirty&&this.updateBlend();var t=this._inputA.positionDelta,e=this._inputB.positionDelta;this.positionDelta.x=t.x+this._blendWeight*(e.x-t.x),this.positionDelta.y=t.y+this._blendWeight*(e.y-t.y),this.positionDelta.z=t.z+this._blendWeight*(e.z-t.z)},e.prototype.updateSkeletonPose=function(t){var e;this._skeletonPoseDirty=!1,this._blendDirty&&this.updateBlend();var i,r,n,o,s,a=this._skeletonPose.jointPoses,l=this._inputA.getSkeletonPose(t).jointPoses,h=this._inputB.getSkeletonPose(t).jointPoses,c=t.numJoints;a.length!=c&&(a.length=c);for(var u=0;u<c;++u)null==(e=a[u])&&(e=a[u]=new JointPose),i=l[u],r=h[u],n=i.translation,o=r.translation,e.orientation.lerp(i.orientation,r.orientation,this._blendWeight),(s=e.translation).x=n.x+this._blendWeight*(o.x-n.x),s.y=n.y+this._blendWeight*(o.y-n.y),s.z=n.z+this._blendWeight*(o.z-n.z)},e.prototype.updateBlend=function(){this._blendDirty=!1,(this._direction<0||this._direction>360)&&(this._direction%=360,this._direction<0&&(this._direction+=360)),this._direction<90?(this._inputA=this._forward,this._inputB=this._right,this._blendWeight=this._direction/90):this._direction<180?(this._inputA=this._right,this._inputB=this._backward,this._blendWeight=(this._direction-90)/90):this._direction<270?(this._inputA=this._backward,this._inputB=this._left,this._blendWeight=(this._direction-180)/90):(this._inputA=this._left,this._inputB=this._forward,this._blendWeight=(this._direction-270)/90)},e}(AnimationStateBase),SkeletonDirectionalNode=function(t){function e(){var e=t.call(this)||this;return e._pStateClass=SkeletonDirectionalState,e}return __extends(e,t),e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e}(AnimationNodeBase),SkeletonNaryLERPState=function(t){function e(e,i){var r=t.call(this,e,i)||this;r._skeletonPose=new SkeletonPose,r._skeletonPoseDirty=!0,r._blendWeights=new Array,r._inputs=new Array,r._skeletonAnimationNode=i;for(var n=r._skeletonAnimationNode.numInputs;n--;)r._inputs[n]=e.getAnimationState(r._skeletonAnimationNode._iInputs[n]);return r}return __extends(e,t),e.prototype.phase=function(t){this._skeletonPoseDirty=!0,this._pPositionDeltaDirty=!0;for(var e=0;e<this._skeletonAnimationNode.numInputs;++e)this._blendWeights[e]&&this._inputs[e].update(t)},e.prototype._pUdateTime=function(e){for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)this._blendWeights[i]&&this._inputs[i].update(e);t.prototype._pUpdateTime.call(this,e)},e.prototype.getSkeletonPose=function(t){return this._skeletonPoseDirty&&this.updateSkeletonPose(t),this._skeletonPose},e.prototype.getBlendWeightAt=function(t){return this._blendWeights[t]},e.prototype.setBlendWeightAt=function(t,e){this._blendWeights[t]=e,this._pPositionDeltaDirty=!0,this._skeletonPoseDirty=!0},e.prototype._pUpdatePositionDelta=function(){var t,e;this._pPositionDeltaDirty=!1,this.positionDelta.x=0,this.positionDelta.y=0,this.positionDelta.z=0;for(var i=0;i<this._skeletonAnimationNode.numInputs;++i)(e=this._blendWeights[i])&&(t=this._inputs[i].positionDelta,this.positionDelta.x+=e*t.x,this.positionDelta.y+=e*t.y,this.positionDelta.z+=e*t.z)},e.prototype.updateSkeletonPose=function(t){var e;this._skeletonPoseDirty=!1;var i,r,n,o,s,a,l,h,c,u,p,d,f,_,g,m,y,v=this._skeletonPose.jointPoses,b=t.numJoints;v.length!=b&&(v.length=b);for(var x=0;x<this._skeletonAnimationNode.numInputs;++x)if(e=this._blendWeights[x])if(i=this._inputs[x].getSkeletonPose(t).jointPoses,h)for(c=0;c<t.numJoints;++c)r=v[c],n=i[c],p=(l=h[c].orientation).x,d=l.y,f=l.z,u=l.w,l=n.orientation,s=n.translation,p*(g=l.x)+d*(m=l.y)+f*(y=l.z)+u*(_=l.w)<0&&(g=-g,m=-m,y=-y,_=-_),(a=r.orientation).x+=e*g,a.y+=e*m,a.z+=e*y,a.w+=e*_,(o=r.translation).x+=e*s.x,o.y+=e*s.y,o.z+=e*s.z;else for(h=i,c=0;c<b;++c)null==(r=v[c])&&(r=v[c]=new JointPose),l=(n=i[c]).orientation,s=n.translation,(a=r.orientation).x=e*l.x,a.y=e*l.y,a.z=e*l.z,a.w=e*l.w,(o=r.translation).x=e*s.x,o.y=e*s.y,o.z=e*s.z;for(c=0;c<t.numJoints;++c)v[c].orientation.normalize()},e}(AnimationStateBase),SkeletonNaryLERPNode=function(t){function e(){var e=t.call(this)||this;return e._iInputs=new Array,e._pStateClass=SkeletonNaryLERPState,e}return __extends(e,t),Object.defineProperty(e.prototype,"numInputs",{get:function(){return this._numInputs},enumerable:!0,configurable:!0}),e.prototype.getInputIndex=function(t){return this._iInputs.indexOf(t)},e.prototype.getInputAt=function(t){return this._iInputs[t]},e.prototype.addInput=function(t){this._iInputs[this._numInputs++]=t},e.prototype.getAnimationState=function(t){return t.getAnimationState(this)},e}(AnimationNodeBase),VertexClipState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._vertexClipNode=i,r._frames=r._vertexClipNode.frames,r}return __extends(e,t),Object.defineProperty(e.prototype,"currentElements",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._currentGraphics},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nextElements",{get:function(){return this._pFramesDirty&&this._pUpdateFrames(),this._nextGraphics},enumerable:!0,configurable:!0}),e.prototype._pUpdateFrames=function(){t.prototype._pUpdateFrames.call(this),this._currentGraphics=this._frames[this._pCurrentFrame],this._vertexClipNode.looping&&this._pNextFrame>=this._vertexClipNode.lastFrame?(this._nextGraphics=this._frames[0],this._pAnimator.dispatchCycleEvent()):this._nextGraphics=this._frames[this._pNextFrame]},e.prototype._pUpdatePositionDelta=function(){},e}(AnimationClipState),VertexClipNode=function(t){function e(){var e=t.call(this)||this;return e._frames=new Array,e._translations=new Array,e._pStateClass=VertexClipState,e}return __extends(e,t),Object.defineProperty(e.prototype,"frames",{get:function(){return this._frames},enumerable:!0,configurable:!0}),e.prototype.addFrame=function(t,e,i){void 0===i&&(i=null),this._frames.push(t),this._pDurations.push(e),this._translations.push(i||new Vector3D),this._pNumFrames=this._pDurations.length,this._pStitchDirty=!0},e.prototype._pUpdateStitch=function(){t.prototype._pUpdateStitch.call(this);for(var e,i,r=this._pNumFrames-1;r--;)this._pTotalDuration+=this._pDurations[r],e=this._translations[r],i=this._translations[r+1].subtract(e),this._pTotalDelta.x+=i.x,this._pTotalDelta.y+=i.y,this._pTotalDelta.z+=i.z;this._pNumFrames>1&&(this._pStitchFinalFrame||!this._pLooping)&&(this._pTotalDuration+=this._pDurations[this._pNumFrames-1],e=this._translations[0],i=this._translations[1].subtract(e),this._pTotalDelta.x+=i.x,this._pTotalDelta.y+=i.y,this._pTotalDelta.z+=i.z)},e}(AnimationClipNodeBase),CrossfadeTransitionState=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._crossfadeTransitionNode=i,r}return __extends(e,t),e.prototype._pUpdateTime=function(e){this.blendWeight=Math.abs(e-this._crossfadeTransitionNode.startBlend)/(1e3*this._crossfadeTransitionNode.blendSpeed),this.blendWeight>=1&&(this.blendWeight=1,null==this._animationStateTransitionComplete&&(this._animationStateTransitionComplete=new AnimationStateEvent(AnimationStateEvent.TRANSITION_COMPLETE,this._pAnimator,this,this._crossfadeTransitionNode)),this._crossfadeTransitionNode.dispatchEvent(this._animationStateTransitionComplete)),t.prototype._pUpdateTime.call(this,e)},e}(SkeletonBinaryLERPState),CrossfadeTransitionNode=function(t){function e(){var e=t.call(this)||this;return e._pStateClass=CrossfadeTransitionState,e}return __extends(e,t),e}(SkeletonBinaryLERPNode),AnimatorEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._animator=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"animator",{get:function(){return this._animator},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._animator)},e.START="animatorStart",e.STOP="animatorStop",e.CYCLE_COMPLETE="animatorCycleComplete",e}(EventBase),AnimatorBase=function(t){function e(e){var i=t.call(this)||this;return i._autoUpdate=!0,i._time=0,i._playbackSpeed=1,i._pOwners=new Array,i._pAbsoluteTime=0,i._animationStates=new Object,i.updatePosition=!0,i._pAnimationSet=e,i._broadcaster=new RequestAnimationFrame(i.onEnterFrame,i),i}return __extends(e,t),e.prototype.getAnimationState=function(t){var e=t.stateClass,i=t.id;return null==this._animationStates[i]&&(this._animationStates[i]=new e(this,t)),this._animationStates[i]},e.prototype.getAnimationStateByName=function(t){return this.getAnimationState(this._pAnimationSet.getAnimation(t))},Object.defineProperty(e.prototype,"absoluteTime",{get:function(){return this._pAbsoluteTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationSet",{get:function(){return this._pAnimationSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeState",{get:function(){return this._pActiveState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeAnimation",{get:function(){return this._pAnimationSet.getAnimation(this._pActiveAnimationName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeAnimationName",{get:function(){return this._pActiveAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate!=t&&(this._autoUpdate=t,this._autoUpdate?this.start():this.stop())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},set:function(t){this._time!=t&&this.update(t)},enumerable:!0,configurable:!0}),e.prototype.phase=function(t){this._pActiveState.phase(t)},Object.defineProperty(e.prototype,"playbackSpeed",{get:function(){return this._playbackSpeed},set:function(t){this._playbackSpeed=t},enumerable:!0,configurable:!0}),e.prototype.setRenderState=function(t,e,i,r){throw new AbstractMethodError},e.prototype.start=function(){!this._isPlaying&&this._autoUpdate&&(this._time=this._pAbsoluteTime=getTimer(),this._isPlaying=!0,this._broadcaster.start(),this.hasEventListener(AnimatorEvent.START)&&(null==this._startEvent&&(this._startEvent=new AnimatorEvent(AnimatorEvent.START,this)),this.dispatchEvent(this._startEvent)))},e.prototype.stop=function(){this._isPlaying&&(this._isPlaying=!1,this._broadcaster.stop(),this.hasEventListener(AnimatorEvent.STOP)&&(null==this._stopEvent&&(this._stopEvent=new AnimatorEvent(AnimatorEvent.STOP,this)),this.dispatchEvent(this._stopEvent)))},e.prototype.update=function(t){var e=(t-this._time)*this.playbackSpeed;this._pUpdateDeltaTime(e),this._time=t},e.prototype.reset=function(t,e){void 0===e&&(e=0),this.getAnimationState(this._pAnimationSet.getAnimation(t)).offset(e+this._pAbsoluteTime)},e.prototype.addOwner=function(t){this._pOwners.push(t)},e.prototype.removeOwner=function(t){this._pOwners.splice(this._pOwners.indexOf(t),1)},e.prototype._pUpdateDeltaTime=function(t){this._pAbsoluteTime+=t,this._pActiveState.update(this._pAbsoluteTime),this.updatePosition&&this.applyPositionDelta()},e.prototype.onEnterFrame=function(t){this.update(getTimer())},e.prototype.applyPositionDelta=function(){var t,e=this._pActiveState.positionDelta,i=e.length;if(i>0){t=this._pOwners.length;for(var r=0;r<t;++r)this._pOwners[r].transform.translateLocal(e,i)}},e.prototype.dispatchCycleEvent=function(){this.hasEventListener(AnimatorEvent.CYCLE_COMPLETE)&&(null==this._cycleEvent&&(this._cycleEvent=new AnimatorEvent(AnimatorEvent.CYCLE_COMPLETE,this)),this.dispatchEvent(this._cycleEvent))},e.prototype.clone=function(){throw new AbstractMethodError},e.prototype.dispose=function(){},e.prototype.invalidateElements=function(){for(var t=this._pOwners.length,e=0;e<t;e++)this._pOwners[e].invalidateElements()},e.prototype.testGPUCompatibility=function(t){throw new AbstractMethodError},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.getRenderableElements=function(t,e){return e},e.assetType="[asset Animator]",e}(AssetBase),ParticleAnimator=function(t){function e(e){var i,r,n=t.call(this,e)||this;n._animationParticleStates=new Array,n._animatorParticleStates=new Array,n._timeParticleStates=new Array,n._totalLenOfOneVertex=0,n._animatorSubGeometries=new Object,n._particleAnimationSet=e;for(var o=0;o<n._particleAnimationSet.particleNodes.length;o++)r=n._particleAnimationSet.particleNodes[o],i=n.getAnimationState(r),r.mode==ParticlePropertiesMode.LOCAL_DYNAMIC?(n._animatorParticleStates.push(i),r._iDataOffset=n._totalLenOfOneVertex,n._totalLenOfOneVertex+=r.dataLength):n._animationParticleStates.push(i),i.needUpdateTime&&n._timeParticleStates.push(i);return n}return __extends(e,t),e.prototype.clone=function(){return new e(this._particleAnimationSet)},e.prototype.setRenderState=function(t,e,i,r){var n,o=this._particleAnimationSet._iAnimationRegisterData,s=e.shape.particleCollection,a=e.shape.elements,l=this._particleAnimationSet.getAnimationElements(s,a);for(n=0;n<this._animationParticleStates.length;n++)this._animationParticleStates[n].setRenderState(t,e,l,o,r,i);var h=this.getAnimatorElements(s,a);for(n=0;n<this._animatorParticleStates.length;n++)this._animatorParticleStates[n].setRenderState(t,e,h,o,r,i)},e.prototype.testGPUCompatibility=function(t){},e.prototype.start=function(){t.prototype.start.call(this);for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].offset(this._pAbsoluteTime)},e.prototype._pUpdateDeltaTime=function(t){this._pAbsoluteTime+=t;for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].update(this._pAbsoluteTime)},e.prototype.resetTime=function(t){void 0===t&&(t=0);for(var e=0;e<this._timeParticleStates.length;e++)this._timeParticleStates[e].offset(this._pAbsoluteTime+t);this.update(this.time)},e.prototype.dispose=function(){for(var t in this._animatorSubGeometries)this._animatorSubGeometries[t].dispose()},e.prototype.getAnimatorElements=function(t,e){if(this._animatorParticleStates.length){var i=this._animatorSubGeometries[e.id]=new AnimationElements;i.createVertexData(e.numVertices,this._totalLenOfOneVertex),i.animationParticles=this._particleAnimationSet.getAnimationElements(t,e).animationParticles}},e}(AnimatorBase),SkeletonAnimationSet=function(t){function e(e){void 0===e&&(e=4);var i=t.call(this)||this;return i._jointsPerVertex=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matricesIndex",{get:function(){return this._matricesIndex},enumerable:!0,configurable:!0}),e.prototype.getAGALVertexCode=function(t,e,i){this._matricesIndex=e.numUsedVertexConstants;var r=this._matricesIndex,n=this._matricesIndex+1,o=this._matricesIndex+2,s=e.getFreeVertexAttribute();t.jointIndexIndex=s.index;var a=e.getFreeVertexAttribute();t.jointWeightIndex=a.index;for(var l=[s+".x",s+".y",s+".z",s+".w"],h=[a+".x",a+".y",a+".z",a+".w"],c=e.getFreeVertexVectorTemp(),u="dp4",p="",d=i.animatableAttributes.length,f=0;f<d;++f){for(var _=i.animatableAttributes[f],g=i.animationTargetRegisters[f],m=0;m<this._jointsPerVertex;++m)e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),p+=u+" "+c+".x, "+_+", vc["+l[m]+"+"+r+"]\n"+u+" "+c+".y, "+_+", vc["+l[m]+"+"+n+"]\n"+u+" "+c+".z, "+_+", vc["+l[m]+"+"+o+"]\nmov "+c+".w, "+_+".w\nmul "+c+", "+c+", "+h[m]+"\n",p+=0==m?"mov "+g+", "+c+"\n":"add "+g+", "+g+", "+c+"\n";u="dp3"}return p},e.prototype.getAGALFragmentCode=function(t,e,i){return""},e.prototype.getAGALUVCode=function(t,e,i){return"mov "+i.animatedUV+","+i.uvInput+"\n"},e.prototype.doneAGALCode=function(t){},e}(AnimationSetBase),SkeletonAnimator=function(t){function e(e,i,r){void 0===r&&(r=!1);var n=t.call(this,e)||this;n._globalPose=new SkeletonPose,n._morphedElements=new Object,n._morphedElementsDirty=new Object,n._skeletonAnimationSet=e,n._skeleton=i,n._forceCPU=r,n._jointsPerVertex=e.jointsPerVertex,n._numJoints=n._skeleton.numJoints,n._globalMatrices=new Float32Array(12*n._numJoints);for(var o=0,s=0;s<n._numJoints;++s)n._globalMatrices[o++]=1,n._globalMatrices[o++]=0,n._globalMatrices[o++]=0,n._globalMatrices[o++]=0,n._globalMatrices[o++]=0,n._globalMatrices[o++]=1,n._globalMatrices[o++]=0,n._globalMatrices[o++]=0,n._globalMatrices[o++]=0,n._globalMatrices[o++]=0,n._globalMatrices[o++]=1,n._globalMatrices[o++]=0;return n._onTransitionCompleteDelegate=function(t){return n.onTransitionComplete(t)},n._onIndicesUpdateDelegate=function(t){return n.onIndicesUpdate(t)},n._onVerticesUpdateDelegate=function(t){return n.onVerticesUpdate(t)},n}return __extends(e,t),Object.defineProperty(e.prototype,"globalMatrices",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalPose",{get:function(){return this._globalPropertiesDirty&&this.updateGlobalProperties(),this._globalPose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forceCPU",{get:function(){return this._forceCPU},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(t){this._useCondensedIndices=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._skeletonAnimationSet,this._skeleton,this._forceCPU)},e.prototype.play=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=NaN),this._pActiveAnimationName!=t){if(this._pActiveAnimationName=t,!this._pAnimationSet.hasAnimation(t))throw new Error("Animation root node "+t+" not found!");e&&this._pActiveNode?(this._pActiveNode=e.getAnimationNode(this,this._pActiveNode,this._pAnimationSet.getAnimation(t),this._pAbsoluteTime),this._pActiveNode.addEventListener(AnimationStateEvent.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate)):this._pActiveNode=this._pAnimationSet.getAnimation(t),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeSkeletonState=this._pActiveState,this.start(),isNaN(i)||this.reset(t,i)}},e.prototype.setRenderState=function(t,e,i,r){this._globalPropertiesDirty&&this.updateGlobalProperties();var n=e.shape.elements;if(n.useCondensedIndices=this._useCondensedIndices,this._useCondensedIndices)this.updateCondensedMatrices(n.condensedIndexLookUp),t.setVertexConstFromArray(this._skeletonAnimationSet.matricesIndex,this._condensedMatrices);else{if(this._pAnimationSet.usesCPU)return void(this._morphedElementsDirty[n.id]&&this.morphElements(e,n));t.setVertexConstFromArray(this._skeletonAnimationSet.matricesIndex,this._globalMatrices)}},e.prototype.testGPUCompatibility=function(t){!this._useCondensedIndices&&(this._forceCPU||this._jointsPerVertex>4||t.numUsedVertexConstants+3*this._numJoints>128)&&this._pAnimationSet.cancelGPUCompatibility()},e.prototype._pUpdateDeltaTime=function(e){t.prototype._pUpdateDeltaTime.call(this,e),this._globalPropertiesDirty=!0,this._pAnimationSet.usesCPU&&this.invalidateElements()},e.prototype.updateCondensedMatrices=function(t){var e,i=0,r=0,n=t.length;this._condensedMatrices=new Float32Array(12*n);for(var o=0;o<n;o++)for(e=12*t[o],r=12;r--;)this._condensedMatrices[i++]=this._globalMatrices[e++]},e.prototype.updateGlobalProperties=function(){this._globalPropertiesDirty=!1,this.localToGlobalPose(this._activeSkeletonState.getSkeletonPose(this._skeleton),this._globalPose,this._skeleton);for(var t,e,i,r,n,o,s,a,l,h,c,u,p,d,f,_,g,m,y,v,b,x,A,E,S,T,P,C,w,D,M,O,I,L,N,F,R=0,B=this._globalPose.jointPoses,V=this._skeleton.joints,k=0;k<this._numJoints;++k)L=(I=B[k]).orientation,N=I.translation,o=(F=2*(e=L.x))*(i=L.y),s=F*(r=L.z),a=F*(n=L.w),(F=2*i)*r,F*n,2*r*n,l=2*i*r,h=2*i*n,c=2*r*n,u=(F=(e*=e)-(i*=i))-(r*=r)+(n*=n),p=o-c,d=s+h,f=o+c,_=-F-r+n,g=l-a,m=s-h,y=l+a,v=-e-i+r+n,b=(t=V[k].inverseBindPose)[0],x=t[4],A=t[8],E=t[12],S=t[1],T=t[5],P=t[9],C=t[13],w=t[2],D=t[6],M=t[10],O=t[14],this._globalMatrices[R]=u*b+p*S+d*w,this._globalMatrices[R+1]=u*x+p*T+d*D,this._globalMatrices[R+2]=u*A+p*P+d*M,this._globalMatrices[R+3]=u*E+p*C+d*O+N.x,this._globalMatrices[R+4]=f*b+_*S+g*w,this._globalMatrices[R+5]=f*x+_*T+g*D,this._globalMatrices[R+6]=f*A+_*P+g*M,this._globalMatrices[R+7]=f*E+_*C+g*O+N.y,this._globalMatrices[R+8]=m*b+y*S+v*w,this._globalMatrices[R+9]=m*x+y*T+v*D,this._globalMatrices[R+10]=m*A+y*P+v*M,this._globalMatrices[R+11]=m*E+y*C+v*O+N.z,R+=12},e.prototype.getRenderableElements=function(t,e){return this._morphedElementsDirty[e.id]=!0,this._pAnimationSet.usesCPU?((i=this._morphedElements[e.id])||(e.normals,e.tangents,(i=this._morphedElements[e.id]=e.clone()).autoDeriveNormals=!1,i.autoDeriveTangents=!1,e.addEventListener(ElementsEvent.INVALIDATE_INDICES,this._onIndicesUpdateDelegate),e.addEventListener(ElementsEvent.INVALIDATE_VERTICES,this._onVerticesUpdateDelegate)),i):e;var i},e.prototype.morphElements=function(t,e){this._morphedElementsDirty[e.id]=!1;var i=e.numVertices,r=e.positions.get(i),n=e.normals.get(i),o=e.tangents.get(i),s=e.positions.dimensions,a=e.positions.stride,l=e.normals.stride,h=e.tangents.stride,c=e.jointIndices.get(i),u=e.jointWeights.get(i),p=e.jointIndices.stride,d=this._morphedElements[e.id],f=d.positions.get(i),_=d.normals.get(i),g=d.tangents.get(i);d.positions.attributesBuffer.invalidate(),d.normals.attributesBuffer.invalidate(),d.tangents.attributesBuffer.invalidate();for(var m,y,v,b,x,A,E,S,T,P,C,w,D,M,O,I,L,N,F,R,B,V,k,U,j,G,z,X,H,$=0,W=0,q=0,Y=0,K=0;$<i;){for(w=r[W=$*a],D=r[W+1],M=3==s?r[W+2]:0,O=n[q=$*l],I=n[q+1],L=n[q+2],N=o[Y=$*h],F=o[Y+1],R=o[Y+2],y=0,v=0,b=0,x=0,A=0,E=0,S=0,T=0,P=0,m=0,K=$*p;m<this._jointsPerVertex;)if((C=u[K+m])>0){var Z=c[K+m]<<2;y+=C*((B=this._globalMatrices[Z])*w+(V=this._globalMatrices[Z+1])*D+(k=this._globalMatrices[Z+2])*M+this._globalMatrices[Z+3]),v+=C*((U=this._globalMatrices[Z+4])*w+(j=this._globalMatrices[Z+5])*D+(G=this._globalMatrices[Z+6])*M+this._globalMatrices[Z+7]),b+=C*((z=this._globalMatrices[Z+8])*w+(X=this._globalMatrices[Z+9])*D+(H=this._globalMatrices[Z+10])*M+this._globalMatrices[Z+11]),x+=C*(B*O+V*I+k*L),A+=C*(U*O+j*I+G*L),E+=C*(z*O+X*I+H*L),S+=C*(B*N+V*F+k*R),T+=C*(U*N+j*F+G*R),P+=C*(z*N+X*F+H*R),m++}else m=this._jointsPerVertex;f[W]=y,f[W+1]=v,3==s&&(f[W+2]=b),_[q]=x,_[q+1]=A,_[q+2]=E,g[Y]=S,g[Y+1]=T,g[Y+2]=P,$++}},e.prototype.localToGlobalPose=function(t,e,i){var r,n,o,s,a,l,h,c,u,p,d,f,_,g,m,y,v,b,x,A=e.jointPoses,E=i.joints,S=t.numJointPoses,T=t.jointPoses;A.length!=S&&(A.length=S);for(var P=0;P<S;++P)null==(r=A[P])&&(r=A[P]=new JointPose),n=E[P].parentIndex,s=T[P],c=r.orientation,h=r.translation,n<0?(l=s.translation,a=s.orientation,c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,h.x=l.x,h.y=l.y,h.z=l.z):(a=(o=A[n]).orientation,l=s.translation,_=a.x,g=a.y,m=a.z,y=a.w,f=-_*(v=l.x)-g*(b=l.y)-m*(x=l.z),u=y*v+g*x-m*b,p=y*b-_*x+m*v,d=y*x+_*b-g*v,l=o.translation,h.x=-f*_+u*y-p*m+d*g+l.x,h.y=-f*g+u*m+p*y-d*_+l.y,h.z=-f*m-u*g+p*_+d*y+l.z,u=a.x,p=a.y,d=a.z,f=a.w,_=(a=s.orientation).x,g=a.y,m=a.z,y=a.w,c.w=f*y-u*_-p*g-d*m,c.x=f*_+u*y+p*m-d*g,c.y=f*g-u*m+p*y+d*_,c.z=f*m+u*g-p*_+d*y)},e.prototype.onTransitionComplete=function(t){t.type==AnimationStateEvent.TRANSITION_COMPLETE&&(t.animationNode.removeEventListener(AnimationStateEvent.TRANSITION_COMPLETE,this._onTransitionCompleteDelegate),this._pActiveState==t.animationState&&(this._pActiveNode=this._pAnimationSet.getAnimation(this._pActiveAnimationName),this._pActiveState=this.getAnimationState(this._pActiveNode),this._activeSkeletonState=this._pActiveState))},e.prototype.onIndicesUpdate=function(t){var e=t.target;this._morphedElements[e.id].setIndices(e.indices)},e.prototype.onVerticesUpdate=function(t){var e=t.target;if(t.attributesView==e.uvs||t.attributesView==e.getCustomAtributes("secondaryUVs")){var i=this._morphedElements[e.id],r=i.uvs.get(e.numVertices);i.invalidateVertices(i.uvs);for(var n=i.uvs.stride,o=t.attributesView.get(e.numVertices),s=e.numVertices*n,a=0;a<s;a+=n)r[a]=o[a],r[a+1]=o[a+1]}},e}(AnimatorBase),VertexAnimationSet=function(t){function e(e,i){void 0===e&&(e=2),void 0===i&&(i="absolute");var r=t.call(this)||this;return r._numPoses=e,r._blendMode=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"numPoses",{get:function(){return this._numPoses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},enumerable:!0,configurable:!0}),e.prototype.getAGALVertexCode=function(t,e,i){return this._iAnimationRegisterData=t.animationRegisterData,null==this._iAnimationRegisterData&&(this._iAnimationRegisterData=t.animationRegisterData=new AnimationRegisterData),this._blendMode==VertexAnimationMode.ABSOLUTE?this.getAbsoluteAGALCode(t,e,i):this.getAdditiveAGALCode(t,e,i)},e.prototype.getAGALFragmentCode=function(t,e,i){return""},e.prototype.getAGALUVCode=function(t,e,i){return"mov "+i.animatedUV+","+i.uvInput+"\n"},e.prototype.doneAGALCode=function(t){},e.prototype.getAbsoluteAGALCode=function(t,e,i){var r="",n=e.getFreeVertexVectorTemp();e.addVertexTempUsages(n,1);var o,s=e.getFreeVertexVectorTemp(),a=new Array(".x",".y",".z",".w"),l=i.animatableAttributes.length,h=e.getFreeVertexConstant();this._iAnimationRegisterData.weightsIndex=h.index,this._iAnimationRegisterData.poseIndices=new Array(this._numPoses);var c=0;l>2&&(l=2);for(var u=0;u<l;++u){r+="mul "+n+", "+i.animatableAttributes[u]+", "+h+a[0]+"\n";for(var p=1;p<this._numPoses;++p)o=e.getFreeVertexAttribute(),this._iAnimationRegisterData.poseIndices[c++]=o.index,r+="mul "+s+", "+o+", "+h+a[p]+"\n",p<this._numPoses-1&&(r+="add "+n+", "+n+", "+s+"\n");r+="add "+i.animationTargetRegisters[u]+", "+n+", "+s+"\n"}return(t.tangentDependencies>0||t.outputsNormals)&&(r+="dp3 "+n+".x, "+i.animatableAttributes[2]+", "+i.animationTargetRegisters[1]+"\nmul "+n+", "+i.animationTargetRegisters[1]+", "+n+".x\nsub "+i.animationTargetRegisters[2]+", "+i.animationTargetRegisters[2]+", "+n+"\n"),r},e.prototype.getAdditiveAGALCode=function(t,e,i){var r,n="",o=i.animatableAttributes.length,s=[".x",".y",".z",".w"],a=e.getFreeVertexVectorTemp(),l=e.getFreeVertexConstant();this._iAnimationRegisterData.weightsIndex=l.index,this._iAnimationRegisterData.poseIndices=new Array(this._numPoses);var h=0;o>2&&(o=2),n+="mov  "+i.animationTargetRegisters[0]+", "+i.animatableAttributes[0]+"\n",t.normalDependencies>0&&(n+="mov "+i.animationTargetRegisters[1]+", "+i.animatableAttributes[1]+"\n");for(var c=0;c<o;++c)for(var u=0;u<this._numPoses;++u)r=e.getFreeVertexAttribute(),this._iAnimationRegisterData.poseIndices[h++]=r.index,n+="mul "+a+", "+r+", "+l+s[u]+"\nadd "+i.animationTargetRegisters[c]+", "+i.animationTargetRegisters[c]+", "+a+"\n";return(t.tangentDependencies>0||t.outputsNormals)&&(n+="dp3 "+a+".x, "+i.animatableAttributes[2]+", "+i.animationTargetRegisters[1]+"\nmul "+a+", "+i.animationTargetRegisters[1]+", "+a+".x\nsub "+i.animationTargetRegisters[2]+", "+i.animatableAttributes[2]+", "+a+"\n"),n},e}(AnimationSetBase),VertexAnimator=function(t){function e(e){var i=t.call(this,e)||this;return i._poses=new Array,i._weights=new Float32Array([1,0,0,0]),i._vertexAnimationSet=e,i}return __extends(e,t),e.prototype.clone=function(){return new e(this._vertexAnimationSet)},e.prototype.play=function(t,e,i){if(void 0===i&&(i=NaN),this._pActiveAnimationName!=t){if(this._pActiveAnimationName=t,!this._pAnimationSet.hasAnimation(t))throw new Error("Animation root node "+t+" not found!");this._pActiveNode=this._pAnimationSet.getAnimation(t),this._pActiveState=this.getAnimationState(this._pActiveNode),this.updatePosition&&(this._pActiveState.update(this._pAbsoluteTime),this._pActiveState.positionDelta),this._activeVertexState=this._pActiveState,this.start(),isNaN(i)||this.reset(t,i)}},e.prototype._pUpdateDeltaTime=function(e){t.prototype._pUpdateDeltaTime.call(this,e);var i=!1;this._poses[0]!=this._activeVertexState.currentElements&&(this._poses[0]=this._activeVertexState.currentElements,i=!0),this._poses[1]!=this._activeVertexState.nextElements&&(this._poses[1]=this._activeVertexState.nextElements),this._weights[0]=1-(this._weights[1]=this._activeVertexState.blendWeight),i&&this.invalidateElements()},e.prototype.setRenderState=function(t,e,i,r){var n=e.shape,o=e.stageElements.elements;if(this._poses.length){var s,a,l=t.animationRegisterData,h=this._vertexAnimationSet.numPoses;t.setVertexConstFromArray(l.weightsIndex,this._weights),s=this._vertexAnimationSet.blendMode==VertexAnimationMode.ABSOLUTE?1:0;for(var c=0;s<h;++s)o=this._poses[s]||n.elements,(a=i.getAbstraction(o))._indexMappings=i.getAbstraction(n.elements).getIndexMappings(),a.activateVertexBufferVO(l.poseIndices[c++],o.positions),t.normalDependencies>0&&a.activateVertexBufferVO(l.poseIndices[c++],o.normals)}else this.setNullPose(t,o,i)},e.prototype.setNullPose=function(t,e,i){var r=t.animationRegisterData;t.setVertexConstFromArray(r.weightsIndex,this._weights);var n=i.getAbstraction(e),o=0;if(this._vertexAnimationSet.blendMode==VertexAnimationMode.ABSOLUTE)for(var s=this._vertexAnimationSet.numPoses,a=1;a<s;++a)n.activateVertexBufferVO(r.poseIndices[o++],e.positions),t.normalDependencies>0&&n.activateVertexBufferVO(r.poseIndices[o++],e.normals)},e.prototype.testGPUCompatibility=function(t){},e.prototype.getRenderableElements=function(t,e){return this._vertexAnimationSet.blendMode==VertexAnimationMode.ABSOLUTE&&this._poses.length&&this._poses[0]||e},e}(AnimatorBase);function assert(t,e){if(void 0===e&&(e="assertion failed"),""===t&&(t=!0),!t)throw"undefined"!=typeof console&&"assert"in console?(console.assert(!1,e),new Error(e)):new Error(e)}function memCopy(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),r>0||n>0&&n<e.length?(n<=0&&(n=e.length-r),t.set(e.subarray(r,r+n),i)):t.set(e,i)}var Bounds=function(){function t(t,e,i,r){this.xMin=0|t,this.yMin=0|e,this.xMax=0|i,this.yMax=0|r}return t.FromUntyped=function(e){return new t(e.xMin,e.yMin,e.xMax,e.yMax)},t.FromRectangle=function(e){return new t(20*e.x|0,20*e.y|0,20*(e.x+e.width)|0,20*(e.y+e.height)|0)},t.prototype.setElements=function(t,e,i,r){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=r},t.prototype.copyFrom=function(t){this.setElements(t.xMin,t.yMin,t.xMax,t.yMax)},t.prototype.contains=function(t,e){return t<this.xMin!=t<this.xMax&&e<this.yMin!=e<this.yMax},t.prototype.unionInPlace=function(t){t.isEmpty()||(this.extendByPoint(t.xMin,t.yMin),this.extendByPoint(t.xMax,t.yMax))},t.prototype.extendByPoint=function(t,e){this.extendByX(t),this.extendByY(e)},t.prototype.extendByX=function(t){134217728!==this.xMin?(this.xMin=Math.min(this.xMin,t),this.xMax=Math.max(this.xMax,t)):this.xMin=this.xMax=t},t.prototype.extendByY=function(t){134217728!==this.yMin?(this.yMin=Math.min(this.yMin,t),this.yMax=Math.max(this.yMax,t)):this.yMin=this.yMax=t},t.prototype.intersects=function(t){return this.contains(t.xMin,t.yMin)||this.contains(t.xMax,t.yMax)},t.prototype.isEmpty=function(){return this.xMax<=this.xMin||this.yMax<=this.yMin},Object.defineProperty(t.prototype,"width",{get:function(){return this.xMax-this.xMin},set:function(t){this.xMax=this.xMin+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.yMax-this.yMin},set:function(t){this.yMax=this.yMin+t},enumerable:!0,configurable:!0}),t.prototype.getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return e*(this.xMax-this.xMin)+i*(this.yMax-this.yMin)},t.prototype.getBaseHeight=function(t){var e=Math.abs(Math.cos(t));return Math.abs(Math.sin(t))*(this.xMax-this.xMin)+e*(this.yMax-this.yMin)},t.prototype.setEmpty=function(){this.xMin=this.yMin=this.xMax=this.yMax=0},t.prototype.setToSentinels=function(){this.xMin=this.yMin=this.xMax=this.yMax=134217728},t.prototype.clone=function(){return new t(this.xMin,this.yMin,this.xMax,this.yMax)},t.prototype.toString=function(){return"{ xMin: "+this.xMin+", xMin: "+this.yMin+", xMax: "+this.xMax+", xMax: "+this.yMax+" }"},t}(),ImageType;function clamp(t,e,i){return Math.max(e,Math.min(i,t))}function roundToMultipleOfFour(t){return t+3&-4}function isNullOrUndefined(t){return null==t}function utf8decode(t){for(var e=new Uint8Array(4*t.length),i=0,r=0,n=t.length;r<n;r++){var o=t.charCodeAt(r);if(o<=127)e[i++]=o;else{if(55296<=o&&o<=56319){var s=t.charCodeAt(r+1);56320<=s&&s<=57343&&(o=((1023&o)<<10)+(1023&s)+65536,++r)}0!=(4292870144&o)?(e[i++]=248|o>>>24&3,e[i++]=128|o>>>18&63,e[i++]=128|o>>>12&63,e[i++]=128|o>>>6&63,e[i++]=128|63&o):0!=(4294901760&o)?(e[i++]=240|o>>>18&7,e[i++]=128|o>>>12&63,e[i++]=128|o>>>6&63,e[i++]=128|63&o):0!=(4294965248&o)?(e[i++]=224|o>>>12&15,e[i++]=128|o>>>6&63,e[i++]=128|63&o):(e[i++]=192|o>>>6&31,e[i++]=128|63&o)}}return e.subarray(0,i)}function utf8encode(t){for(var e=0,i="";e<t.length;){var r=255&t[e++];if(r<=127)i+=String.fromCharCode(r);else{var n=192,o=5;do{if((r&(n>>1|128))===n)break;n=n>>1|128,--o}while(o>=0);if(o<=0){i+=String.fromCharCode(r);continue}for(var s=r&(1<<o)-1,a=!1,l=5;l>=o;--l){var h=t[e++];if(128!=(192&h)){a=!0;break}s=s<<6|63&h}if(a){for(var c=e-(7-l);c<e;++c)i+=String.fromCharCode(255&t[c]);continue}i+=s>=65536?String.fromCharCode(s-65536>>10&1023|55296,1023&s|56320):String.fromCharCode(s)}}return i}!function(t){t[t.None=0]="None",t[t.PremultipliedAlphaARGB=1]="PremultipliedAlphaARGB",t[t.StraightAlphaARGB=2]="StraightAlphaARGB",t[t.StraightAlphaRGBA=3]="StraightAlphaRGBA",t[t.JPEG=4]="JPEG",t[t.PNG=5]="PNG",t[t.GIF=6]="GIF"}(ImageType||(ImageType={}));var ArrayBufferPool=function(){function t(t){void 0===t&&(t=32),this._list=[],this._maxSize=t}return t.prototype.acquire=function(e){if(t._enabled)for(var i=this._list,r=0;r<i.length;r++){var n=i[r];if(n.byteLength>=e)return i.splice(r,1),n}return new ArrayBuffer(e)},t.prototype.release=function(e){if(t._enabled){var i=this._list;i.length===this._maxSize&&i.shift(),i.push(e)}},t.prototype.ensureUint8ArrayLength=function(t,e){if(t.length>=e)return t;var i=Math.max(t.length+e,1+(3*t.length>>1)),r=new Uint8Array(this.acquire(i),0,i);return r.set(t),this.release(t.buffer),r},t.prototype.ensureFloat64ArrayLength=function(t,e){if(t.length>=e)return t;var i=Math.max(t.length+e,1+(3*t.length>>1)),r=new Float64Array(this.acquire(i*Float64Array.BYTES_PER_ELEMENT),0,i);return r.set(t),this.release(t.buffer),r},t._enabled=!0,t}(),IntegerUtilities;function ensureTypedArrayCapacity(t,e){if(t.length<e){var i=t;(t=new t.constructor(IntegerUtilities.nearestPowerOfTwo(e))).set(i,0)}return t}!function(t){var e=new ArrayBuffer(8);function i(t){return 256*t<<16>>16}function r(t){return t/256}t.i8=new Int8Array(e),t.u8=new Uint8Array(e),t.i32=new Int32Array(e),t.f32=new Float32Array(e),t.f64=new Float64Array(e),t.nativeLittleEndian=1===new Int8Array(new Int32Array([1]).buffer)[0],t.floatToInt32=function(e){return t.f32[0]=e,t.i32[0]},t.int32ToFloat=function(e){return t.i32[0]=e,t.f32[0]},t.swap16=function(t){return(255&t)<<8|t>>8&255},t.swap32=function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255},t.toS8U8=i,t.fromS8U8=r,t.clampS8U8=function(t){return r(i(t))},t.toS16=function(t){return t<<16>>16},t.bitCount=function(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24},t.ones=function(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24},t.trailingZeros=function(e){return t.ones((e&-e)-1)},t.getFlags=function(t,e){var i="";for(t=0;t<e.length;t++)t&1<<t&&(i+=e[t]+" ");return 0===i.length?"":i.trim()},t.isPowerOfTwo=function(t){return t&&0==(t&t-1)},t.roundToMultipleOfFour=function(t){return t+3&-4},t.nearestPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},t.roundToMultipleOfPowerOfTwo=function(t,e){var i=(1<<e)-1;return t+i&~i},t.toHEX=function(t){return"0x"+("00000000"+(t=t<0?4294967295+t+1:t).toString(16)).substr(-8)}}(IntegerUtilities||(IntegerUtilities={}));var ABCBlock=function(){},SymbolExport=function(t,e){this.symbolId=t,this.className=e},UnparsedTag=function(t,e,i){this.tagCode=t,this.byteOffset=e,this.byteLength=i},DictionaryEntry=function(t){function e(e,i,r,n){var o=t.call(this,i,r,n)||this;return o.id=e,o}return __extends(e,t),e}(UnparsedTag),EagerlyParsedDictionaryEntry=function(t){function e(e,i,r,n){var o=t.call(this,e,i.tagCode,i.byteOffset,i.byteLength)||this;return o.type=r,o.definition=n,o.ready=!1,o}return __extends(e,t),e}(DictionaryEntry);function axCoerceString(t){return"string"==typeof t?t:null==t?null:t+""}var Errors={NotImplementedError:{code:1001,message:"The method %1 is not implemented."},InvalidPrecisionError:{code:1002,message:"Number.toPrecision has a range of 1 to 21. Number.toFixed and Number.toExponential have a range of 0 to 20. Specified value is not within expected range."},InvalidRadixError:{code:1003,message:"The radix argument must be between 2 and 36; got %1."},InvokeOnIncompatibleObjectError:{code:1004,message:"Method %1 was invoked on an incompatible object."},ArrayIndexNotIntegerError:{code:1005,message:"Array index is not a positive integer (%1)."},CallOfNonFunctionError:{code:1006,message:"%1 is not a function."},ConstructOfNonFunctionError:{code:1007,message:"Instantiation attempted on a non-constructor."},ConvertNullToObjectError:{code:1009,message:"Cannot access a property or method of a null object reference."},ConvertUndefinedToObjectError:{code:1010,message:"A term is undefined and has no properties."},ClassNotFoundError:{code:1014,message:"Class %1 could not be found."},DescendentsError:{code:1016,message:"Descendants operator (..) not supported on type %1."},StackOverflowError:{code:1023,message:"Stack overflow occurred."},CpoolIndexRangeError:{code:1032,message:"Cpool index %1 is out of range %2."},CpoolEntryWrongTypeError:{code:1033,message:"Cpool entry %1 is wrong type."},CheckTypeFailedError:{code:1034,message:"Type Coercion failed: cannot convert %1 to %2."},CannotAssignToMethodError:{code:1037,message:"Cannot assign to a method %1 on %2."},CantUseInstanceofOnNonObjectError:{code:1040,message:"The right-hand side of instanceof must be a class or function."},IsTypeMustBeClassError:{code:1041,message:"The right-hand side of operator must be a class."},InvalidMagicError:{code:1042,message:"Not an ABC file.  major_version=%1 minor_version=%2."},UnsupportedTraitsKindError:{code:1045,message:"Unsupported traits kind=%1."},PrototypeTypeError:{code:1049,message:"Prototype objects must be vanilla Objects."},ConvertToPrimitiveError:{code:1050,message:"Cannot convert %1 to primitive."},InvalidURIError:{code:1052,message:"Invalid URI passed to %1 function."},WriteSealedError:{code:1056,message:"Cannot create property %1 on %2."},WrongArgumentCountError:{code:1063,message:"Argument count mismatch on %1. Expected %2, got %3."},UndefinedVarError:{code:1065,message:"Variable %1 is not defined."},ReadSealedError:{code:1069,message:"Property %1 not found on %2 and there is no default value."},ConstWriteError:{code:1074,message:"Illegal write to read-only property %1 on %2."},XMLPrefixNotBound:{code:1083,message:'The prefix "%1" for element "%2" is not bound.'},XMLUnterminatedElementTag:{code:1085,message:'The element type "%1" must be terminated by the matching end-tag "</%2>".'},XMLOnlyWorksWithOneItemLists:{code:1086,message:"The %1 method only works on lists containing one item."},XMLAssignmentToIndexedXMLNotAllowed:{code:1087,message:"Assignment to indexed XML is not allowed."},XMLMarkupMustBeWellFormed:{code:1088,message:"The markup in the document following the root element must be well-formed."},XMLAssigmentOneItemLists:{code:1089,message:"Assignment to lists with more than one item is not supported."},XMLMalformedElement:{code:1090,message:"XML parser failure: element is malformed."},XMLUnterminatedCData:{code:1091,message:"XML parser failure: Unterminated CDATA section."},XMLUnterminatedXMLDecl:{code:1092,message:"XML parser failure: Unterminated XML declaration."},XMLUnterminatedDocTypeDecl:{code:1093,message:"XML parser failure: Unterminated DOCTYPE declaration."},XMLUnterminatedComment:{code:1094,message:"XML parser failure: Unterminated comment."},XMLUnterminatedElement:{code:1096,message:"XML parser failure: Unterminated element."},XMLNamespaceWithPrefixAndNoURI:{code:1098,message:"Illegal prefix %1 for no namespace."},RegExpFlagsArgumentError:{code:1100,message:"Cannot supply flags when constructing one RegExp from another."},InvalidBaseClassError:{code:1108,message:"The OP_newclass opcode was used with the incorrect base class."},XMLInvalidName:{code:1117,message:"Invalid XML name: %1."},XMLIllegalCyclicalLoop:{code:1118,message:"Illegal cyclical loop between nodes."},FilterError:{code:1123,message:"Filter operator not supported on type %1."},OutOfRangeError:{code:1125,message:"The index %1 is out of range %2."},VectorFixedError:{code:1126,message:"Cannot change the length of a fixed Vector."},TypeAppOfNonParamType:{code:1127,message:"Type application attempted on a non-parameterized type."},WrongTypeArgCountError:{code:1128,message:"Incorrect number of type parameters for %1. Expected %2, got %3."},JSONCyclicStructure:{code:1129,message:"Cyclic structure cannot be converted to JSON string."},JSONInvalidReplacer:{code:1131,message:"Replacer argument to JSON stringifier must be an array or a two parameter function."},JSONInvalidParseInput:{code:1132,message:"Invalid JSON parse input."},InvalidRangeError:{code:1506,message:"The specified range is invalid."},NullArgumentError:{code:1507,message:"Argument %1 cannot be null."},InvalidArgumentError:{code:1508,message:"The value specified for argument %1 is invalid."},ArrayFilterNonNullObjectError:{code:1510,message:"When the callback argument is a method of a class, the optional this argument must be null."},InvalidParamError:{code:2004,message:"One of the parameters is invalid."},ParamRangeError:{code:2006,message:"The supplied index is out of bounds."},NullPointerError:{code:2007,message:"Parameter %1 must be non-null."},InvalidEnumError:{code:2008,message:"Parameter %1 must be one of the accepted values."},CantInstantiateError:{code:2012,message:"%1 class cannot be instantiated."},InvalidBitmapData:{code:2015,message:"Invalid BitmapData."},EOFError:{code:2030,message:"End of file was encountered.",fqn:"flash.errors.EOFError"},CompressedDataError:{code:2058,message:"There was an error decompressing the data.",fqn:"flash.errors.IOError"},EmptyStringError:{code:2085,message:"Parameter %1 must be non-empty string."},ProxyGetPropertyError:{code:2088,message:"The Proxy class does not implement getProperty. It must be overridden by a subclass."},ProxySetPropertyError:{code:2089,message:"The Proxy class does not implement setProperty. It must be overridden by a subclass."},ProxyCallPropertyError:{code:2090,message:"The Proxy class does not implement callProperty. It must be overridden by a subclass."},ProxyHasPropertyError:{code:2091,message:"The Proxy class does not implement hasProperty. It must be overridden by a subclass."},ProxyDeletePropertyError:{code:2092,message:"The Proxy class does not implement deleteProperty. It must be overridden by a subclass."},ProxyGetDescendantsError:{code:2093,message:"The Proxy class does not implement getDescendants. It must be overridden by a subclass."},ProxyNextNameIndexError:{code:2105,message:"The Proxy class does not implement nextNameIndex. It must be overridden by a subclass."},ProxyNextNameError:{code:2106,message:"The Proxy class does not implement nextName. It must be overridden by a subclass."},ProxyNextValueError:{code:2107,message:"The Proxy class does not implement nextValue. It must be overridden by a subclass."},TooFewArgumentsError:{code:2001,message:"Too few arguments were specified; got %1, %2 expected."},ParamTypeError:{code:2005,message:"Parameter %1 is of the incorrect type. Should be type %2."},SocketConnectError:{code:2011,message:"Socket connection failed to %1:%2."},CantAddSelfError:{code:2024,message:"An object cannot be added as a child of itself."},NotAChildError:{code:2025,message:"The supplied DisplayObject must be a child of the caller."},UnhandledError:{code:2044,message:"Unhandled %1:."},AllowDomainArgumentError:{code:2052,message:"Only String arguments are permitted for allowDomain and allowInsecureDomain."},DelayRangeError:{code:2066,message:"The Timer delay specified is out of range."},ExternalInterfaceNotAvailableError:{code:2067,message:"The ExternalInterface is not available in this container. ExternalInterface requires Internet Explorer ActiveX, Firefox, Mozilla 1.7.5 and greater, or other browsers that support NPRuntime."},InvalidLoaderMethodError:{code:2069,message:"The Loader class does not implement this method."},InvalidStageMethodError:{code:2071,message:"The Stage class does not implement this property or method."},TimelineObjectNameSealedError:{code:2078,message:"The name property of a Timeline-placed object cannot be modified."},AlreadyConnectedError:{code:2082,message:"Connect failed because the object is already connected."},CloseNotConnectedError:{code:2083,message:"Close failed because the object is not connected."},ArgumentSizeError:{code:2084,message:"The AMF encoding of the arguments cannot exceed 40K."},AsyncError:{code:2095,message:"%1 was unable to invoke callback %2."},LoadingObjectNotSWFError:{code:2098,message:"The loading object is not a .swf file, you cannot request SWF properties from it."},LoadingObjectNotInitializedError:{code:2099,message:"The loading object is not sufficiently loaded to provide this information."},DecodeParamError:{code:2101,message:"The String passed to URLVariables.decode() must be a URL-encoded query string containing name/value pairs."},SceneNotFoundError:{code:2108,message:"Scene %1 was not found."},FrameLabelNotFoundError:{code:2109,message:"Frame label %1 not found in scene %2."},InvalidLoaderInfoMethodError:{code:2118,message:"The LoaderInfo class does not implement this method."},SecuritySwfNotAllowedError:{code:2121,message:"Security sandbox violation: %1: %2 cannot access %3. This may be worked around by calling Security.allowDomain."},UnknownFileTypeError:{code:2124,message:"Loaded file is an unknown type."},CantAddParentError:{code:2150,message:"An object cannot be added as a child to one of it's children (or children's children, etc.)."},Matrix3DRefCannontBeShared:{code:2189,message:"A Matrix3D can not be assigned to more than one DisplayObject."},ObjectWithStringsParamError:{code:2196,message:"Parameter %1 must be an Object with only String values."},AllowCodeImportError:{code:3226,message:"Cannot import a SWF file when LoaderContext.allowCodeImport is false."},PermissionDenied:{code:3315,message:"The current security context does not allow this operation."},InternalErrorIV:{code:3343,message:"Internal Error."}},InflateState;!function(t){t[t.INIT=0]="INIT",t[t.BLOCK_0=1]="BLOCK_0",t[t.BLOCK_1=2]="BLOCK_1",t[t.BLOCK_2_PRE=3]="BLOCK_2_PRE",t[t.BLOCK_2=4]="BLOCK_2",t[t.DONE=5]="DONE",t[t.ERROR=6]="ERROR",t[t.VERIFY_HEADER=7]="VERIFY_HEADER"}(InflateState||(InflateState={}));var WINDOW_SIZE=32768,WINDOW_SHIFT_POSITION=65536,MAX_WINDOW_SIZE=WINDOW_SHIFT_POSITION+258,Inflate=function(){function t(t){}return t.prototype.push=function(t){},t.prototype.close=function(){},t.create=function(t){return new BasicInflate(t)},t.prototype._processZLibHeader=function(t,e,i){if(e+2>i)return 0;var r=t[e]<<8|t[e+1],n=null;return 2048!=(3840&r)?n="inflate: unknown compression method":r%31!=0?n="inflate: bad FCHECK":0!=(32&r)&&(n="inflate: FDICT bit set"),n?(this.onError&&this.onError(n),-1):2},t.inflate=function(e,i,r){var n=new Uint8Array(i),o=0,s=t.create(r);return s.onData=function(t){var e=Math.min(t.length,n.length-o);e&&memCopy(n,t,o,0,e),o+=e},s.onError=function(t){throw new Error(t)},s.push(e),s.close(),n},t}(),BasicInflate=function(t){function e(e){var i=t.call(this,e)||this;return i._buffer=null,i._bufferSize=0,i._bufferPosition=0,i._bitBuffer=0,i._bitLength=0,i._window=new Uint8Array(MAX_WINDOW_SIZE),i._windowPosition=0,i._state=e?InflateState.VERIFY_HEADER:InflateState.INIT,i._isFinalBlock=!1,i._literalTable=null,i._distanceTable=null,i._block0Read=0,i._block2State=null,i._copyState={state:0,len:0,lenBits:0,dist:0,distBits:0},areTablesInitialized||(initializeTables(),areTablesInitialized=!0),i}return __extends(e,t),e.prototype.push=function(t){if(!this._buffer||this._buffer.length<this._bufferSize+t.length){var e=new Uint8Array(this._bufferSize+t.length);this._buffer&&e.set(this._buffer),this._buffer=e}this._buffer.set(t,this._bufferSize),this._bufferSize+=t.length,this._bufferPosition=0;var i=!1;do{var r=this._windowPosition;if(this._state===InflateState.INIT&&(i=this._decodeInitState()))break;switch(this._state){case InflateState.BLOCK_0:i=this._decodeBlock0();break;case InflateState.BLOCK_2_PRE:if(i=this._decodeBlock2Pre())break;case InflateState.BLOCK_1:case InflateState.BLOCK_2:i=this._decodeBlock();break;case InflateState.ERROR:case InflateState.DONE:this._bufferPosition=this._bufferSize;break;case InflateState.VERIFY_HEADER:var n=this._processZLibHeader(this._buffer,this._bufferPosition,this._bufferSize);n>0?(this._bufferPosition+=n,this._state=InflateState.INIT):0===n?i=!0:this._state=InflateState.ERROR}this._windowPosition-r>0&&this.onData(this._window.subarray(r,this._windowPosition)),this._windowPosition>=WINDOW_SHIFT_POSITION&&("copyWithin"in this._buffer?this._window.copyWithin(0,this._windowPosition-WINDOW_SIZE,this._windowPosition):this._window.set(this._window.subarray(this._windowPosition-WINDOW_SIZE,this._windowPosition)),this._windowPosition=WINDOW_SIZE)}while(!i&&this._bufferPosition<this._bufferSize);this._bufferPosition<this._bufferSize?("copyWithin"in this._buffer?this._buffer.copyWithin(0,this._bufferPosition,this._bufferSize):this._buffer.set(this._buffer.subarray(this._bufferPosition,this._bufferSize)),this._bufferSize-=this._bufferPosition):this._bufferSize=0},e.prototype._decodeInitState=function(){if(this._isFinalBlock)return this._state=InflateState.DONE,!1;var t,e=this._buffer,i=this._bufferSize,r=this._bitBuffer,n=this._bitLength,o=this._bufferPosition;if((i-o<<3)+n<3)return!0;n<3&&(r|=e[o++]<<n,n+=8);var s=7&r;switch(r>>=3,n-=3,s>>1){case 0:if(r=0,n=0,i-o<4)return!0;var a=e[o]|e[o+1]<<8,l=e[o+2]|e[o+3]<<8;if(o+=4,65535!=(a^l)){this._error("inflate: invalid block 0 length"),t=InflateState.ERROR;break}0===a?t=InflateState.INIT:(this._block0Read=a,t=InflateState.BLOCK_0);break;case 1:t=InflateState.BLOCK_1,this._literalTable=fixedLiteralTable,this._distanceTable=fixedDistanceTable;break;case 2:if((i-o<<3)+n<26)return!0;for(;n<14;)r|=e[o++]<<n,n+=8;var h=4+(r>>10&15);if((i-o<<3)+n<14+3*h)return!0;var c={numLiteralCodes:257+(31&r),numDistanceCodes:1+(r>>5&31),codeLengthTable:void 0,bitLengths:void 0,codesRead:0,dupBits:0};r>>=14,n-=14;for(var u=new Uint8Array(19),p=0;p<h;++p)n<3&&(r|=e[o++]<<n,n+=8),u[codeLengthOrder[p]]=7&r,r>>=3,n-=3;for(;p<19;p++)u[codeLengthOrder[p]]=0;c.bitLengths=new Uint8Array(c.numLiteralCodes+c.numDistanceCodes),c.codeLengthTable=makeHuffmanTable(u),this._block2State=c,t=InflateState.BLOCK_2_PRE;break;default:return this._error("inflate: unsupported block type"),t=InflateState.ERROR,!1}return this._isFinalBlock=!!(1&s),this._state=t,this._bufferPosition=o,this._bitBuffer=r,this._bitLength=n,!1},e.prototype._error=function(t){this.onError&&this.onError(t)},e.prototype._decodeBlock0=function(){var t=this._bufferPosition,e=this._windowPosition,i=this._block0Read,r=MAX_WINDOW_SIZE-e,n=this._bufferSize-t,o=n<i,s=Math.min(r,n,i);return this._window.set(this._buffer.subarray(t,t+s),e),this._windowPosition=e+s,this._bufferPosition=t+s,this._block0Read=i-s,i===s?(this._state=InflateState.INIT,!1):o&&r<n},e.prototype._readBits=function(t){var e=this._bitBuffer,i=this._bitLength;if(t>i){var r=this._bufferPosition,n=this._bufferSize;do{if(r>=n)return this._bufferPosition=r,this._bitBuffer=e,this._bitLength=i,-1;e|=this._buffer[r++]<<i,i+=8}while(t>i);this._bufferPosition=r}return this._bitBuffer=e>>t,this._bitLength=i-t,e&(1<<t)-1},e.prototype._readCode=function(t){var e=this._bitBuffer,i=this._bitLength,r=t.maxBits;if(r>i){var n=this._bufferPosition,o=this._bufferSize;do{if(n>=o)return this._bufferPosition=n,this._bitBuffer=e,this._bitLength=i,-1;e|=this._buffer[n++]<<i,i+=8}while(r>i);this._bufferPosition=n}var s=t.codes[e&(1<<r)-1],a=s>>16;return 32768&s?(this._error("inflate: invalid encoding"),this._state=InflateState.ERROR,-1):(this._bitBuffer=e>>a,this._bitLength=i-a,65535&s)},e.prototype._decodeBlock2Pre=function(){var t=this._block2State,e=t.numLiteralCodes+t.numDistanceCodes,i=t.bitLengths,r=t.codesRead,n=r>0?i[r-1]:0,o=t.codeLengthTable;if(t.dupBits>0){if((a=this._readBits(t.dupBits))<0)return!0;for(;a--;)i[r++]=n;t.dupBits=0}for(;r<e;){var s=this._readCode(o);if(s<0)return t.codesRead=r,!0;if(s<16)i[r++]=n=s;else{var a,l;switch(s){case 16:l=2,a=3,s=n;break;case 17:l=3,a=3,s=0;break;case 18:l=7,a=11,s=0}for(;a--;)i[r++]=s;if((a=this._readBits(l))<0)return t.codesRead=r,t.dupBits=l,!0;for(;a--;)i[r++]=s;n=s}}return this._literalTable=makeHuffmanTable(i.subarray(0,t.numLiteralCodes)),this._distanceTable=makeHuffmanTable(i.subarray(t.numLiteralCodes)),this._state=InflateState.BLOCK_2,this._block2State=null,!1},e.prototype._decodeBlock=function(){var t,e,i,r,n,o,s,a=this._literalTable,l=this._distanceTable,h=this._window,c=this._windowPosition,u=this._copyState;if(0!==u.state)switch(u.state){case 1:if(e=0,(e=this._readBits(u.lenBits))<0)return!0;u.len+=e,u.state=2;case 2:if((i=this._readCode(l))<0)return!0;u.distBits=distanceExtraBits[i],u.dist=distanceCodes[i],u.state=3;case 3:if(e=0,u.distBits>0&&(e=this._readBits(u.distBits))<0)return!0;for(o=u.dist+e,r=u.len,t=c-o;r--;)h[c++]=h[t++];if(u.state=0,c>=WINDOW_SHIFT_POSITION)return this._windowPosition=c,!1}do{if((i=this._readCode(a))<0)return this._windowPosition=c,!0;if(i<256)h[c++]=i;else{if(!(i>256)){this._state=InflateState.INIT;break}if(this._windowPosition=c,n=lengthExtraBits[i-=257],r=lengthCodes[i],(e=0===n?0:this._readBits(n))<0)return u.state=1,u.len=r,u.lenBits=n,!0;if(r+=e,(i=this._readCode(l))<0)return u.state=2,u.len=r,!0;if(s=distanceExtraBits[i],o=distanceCodes[i],(e=0===s?0:this._readBits(s))<0)return u.state=3,u.len=r,u.dist=o,u.distBits=s,!0;for(t=c-(o+=e);r--;)h[c++]=h[t++]}}while(c<WINDOW_SHIFT_POSITION);return this._windowPosition=c,!1},e}(Inflate),codeLengthOrder,distanceCodes,distanceExtraBits,fixedDistanceTable,lengthCodes,lengthExtraBits,fixedLiteralTable,areTablesInitialized=!1;function initializeTables(){codeLengthOrder=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),distanceCodes=new Uint16Array(30),distanceExtraBits=new Uint8Array(30);for(var t=0,e=0,i=1;t<30;++t)distanceCodes[t]=i,i+=1<<(distanceExtraBits[t]=~~((e+=t>2?1:0)/2));var r=new Uint8Array(288);for(t=0;t<32;++t)r[t]=5;fixedDistanceTable=makeHuffmanTable(r.subarray(0,32)),lengthCodes=new Uint16Array(29),lengthExtraBits=new Uint8Array(29);for(t=0,e=0,i=3;t<29;++t)lengthCodes[t]=i-(28==t?1:0),i+=1<<(lengthExtraBits[t]=~~((e+=t>4?1:0)/4%6));for(t=0;t<288;++t)r[t]=t<144||t>279?8:t<256?9:7;fixedLiteralTable=makeHuffmanTable(r)}function makeHuffmanTable(t){for(var e=Math.max.apply(null,t),i=t.length,r=1<<e,n=new Uint32Array(r),o=e<<16|65535,s=0;s<r;s++)n[s]=o;for(var a=0,l=1,h=2;l<=e;a<<=1,++l,h<<=1)for(var c=0;c<i;++c)if(t[c]===l){for(var u=0,p=0;p<l;++p)u=2*u+(a>>p&1);for(p=u;p<r;p+=h)n[p]=l<<16|c;++a}return{codes:n,maxBits:e}}var SpecialInflateAdapter=function(t){function e(e,i){var r=t.call(this,e)||this;return r._verifyHeader=e,r._specialInflate=i(),r._specialInflate.setDataCallback(function(t){this.onData(t)}.bind(r)),r}return __extends(e,t),e.prototype.push=function(t){if(this._verifyHeader){var e;this._buffer?((e=new Uint8Array(this._buffer.length+t.length)).set(this._buffer),e.set(t,this._buffer.length),this._buffer=null):e=new Uint8Array(t);var i=this._processZLibHeader(e,0,e.length);if(0===i)return void(this._buffer=e);this._verifyHeader=!0,i>0&&(t=e.subarray(i))}this._specialInflate.push(t)},e.prototype.close=function(){this._specialInflate&&(this._specialInflate.close(),this._specialInflate=null)},e}(Inflate),DeflateState;!function(t){t[t.WRITE=0]="WRITE",t[t.DONE=1]="DONE",t[t.ZLIB_HEADER=2]="ZLIB_HEADER"}(DeflateState||(DeflateState={}));var Adler32=function(){function t(){this.a=1,this.b=0}return t.prototype.update=function(t,e,i){for(var r=this.a,n=this.b,o=e;o<i;++o)n=(n+(r=(r+(255&t[o]))%65521))%65521;this.a=r,this.b=n},t.prototype.getChecksum=function(){return this.b<<16|this.a},t}(),Deflate=function(){function t(t){this._writeZlibHeader=t,this._state=t?DeflateState.ZLIB_HEADER:DeflateState.WRITE,this._adler32=t?new Adler32:null}return t.prototype.push=function(t){this._state===DeflateState.ZLIB_HEADER&&(this.onData(new Uint8Array([120,156])),this._state=DeflateState.WRITE);for(var e=t.length,i=e+5*Math.ceil(e/65535),r=new Uint8Array(i),n=0,o=0;e>65535;)r.set(new Uint8Array([0,255,255,0,0]),n),n+=5,r.set(t.subarray(o,o+65535),n),o+=65535,n+=65535,e-=65535;r.set(new Uint8Array([0,255&e,e>>8&255,255&~e,~e>>8&255]),n),n+=5,r.set(t.subarray(o,e),n),this.onData(r),this._adler32&&this._adler32.update(t,0,e)},t.prototype.close=function(){if(this._state=DeflateState.DONE,this.onData(new Uint8Array([1,0,0,255,255])),this._adler32){var t=this._adler32.getChecksum();this.onData(new Uint8Array([255&t,t>>8&255,t>>16&255,t>>>24&255]))}},t}(),InputStream=function(){function t(){this.available=0,this.pos=0,this.buffer=new Uint8Array(2e3)}return t.prototype.append=function(t){var e=this.pos+this.available,i=e+t.length;if(i>this.buffer.length){for(var r=2*this.buffer.length;r<i;)r*=2;var n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}this.buffer.set(t,e),this.available+=t.length},t.prototype.compact=function(){0!==this.available&&(this.buffer.set(this.buffer.subarray(this.pos,this.pos+this.available),0),this.pos=0)},t.prototype.readByte=function(){if(this.available<=0)throw new Error("Unexpected end of file");return this.available--,this.buffer[this.pos++]},t}(),OutputStream=function(){function t(t){this.onData=t,this.processed=0}return t.prototype.writeBytes=function(t){this.onData.call(null,t),this.processed+=t.length},t}(),OutWindow=function(){function t(t){this.outStream=t,this.buf=null,this.pos=0,this.size=0,this.isFull=!1,this.writePos=0,this.totalPos=0}return t.prototype.create=function(t){this.buf=new Uint8Array(t),this.pos=0,this.size=t,this.isFull=!1,this.writePos=0,this.totalPos=0},t.prototype.putByte=function(t){this.totalPos++,this.buf[this.pos++]=t,this.pos===this.size&&(this.flush(),this.pos=0,this.isFull=!0)},t.prototype.getByte=function(t){return this.buf[t<=this.pos?this.pos-t:this.size-t+this.pos]},t.prototype.flush=function(){this.writePos<this.pos&&(this.outStream.writeBytes(this.buf.subarray(this.writePos,this.pos)),this.writePos=this.pos===this.size?0:this.pos)},t.prototype.copyMatch=function(t,e){for(var i=this.pos,r=this.size,n=this.buf,o=t<=i?i-t:r-t+i,s=e;s>0;){for(var a=Math.min(Math.min(s,r-i),r-o),l=0;l<a;l++){var h=n[o++];n[i++]=h}i===r&&(this.pos=i,this.flush(),i=0,this.isFull=!0),o===r&&(o=0),s-=a}this.pos=i,this.totalPos+=e},t.prototype.checkDistance=function(t){return t<=this.pos||this.isFull},t.prototype.isEmpty=function(){return 0===this.pos&&!this.isFull},t}(),kNumBitModelTotalBits=11,kNumMoveBits=5,PROB_INIT_VAL=1<<kNumBitModelTotalBits>>1;function createProbsArray(t){for(var e=new Uint16Array(t),i=0;i<t;i++)e[i]=PROB_INIT_VAL;return e}var kTopValue=1<<24,RangeDecoder=function(){function t(t){this.inStream=t,this.range=0,this.code=0,this.corrupted=!1}return t.prototype.init=function(){0!==this.inStream.readByte()&&(this.corrupted=!0),this.range=-1;for(var t=0,e=0;e<4;e++)t=t<<8|this.inStream.readByte();t===this.range&&(this.corrupted=!0),this.code=t},t.prototype.isFinishedOK=function(){return 0===this.code},t.prototype.decodeDirectBits=function(t){var e=0,i=this.range,r=this.code;do{var n=(r=r-(i=i>>>1|0)|0)>>31;(r=r+(i&n)|0)===i&&(this.corrupted=!0),i>=0&&i<kTopValue&&(i<<=8,r=r<<8|this.inStream.readByte()),e=(e<<1)+n+1|0}while(--t);return this.range=i,this.code=r,e},t.prototype.decodeBit=function(t,e){var i,r=this.range,n=this.code,o=t[e],s=(r>>>kNumBitModelTotalBits)*o;return n>>>0<s?(o=o+((1<<kNumBitModelTotalBits)-o>>kNumMoveBits)|0,r=0|s,i=0):(o=o-(o>>kNumMoveBits)|0,n=n-s|0,r=r-s|0,i=1),t[e]=65535&o,r>=0&&r<kTopValue&&(r<<=8,n=n<<8|this.inStream.readByte()),this.range=r,this.code=n,i},t}();function bitTreeReverseDecode(t,e,i,r){for(var n=1,o=0,s=0;s<i;s++){var a=r.decodeBit(t,n+e);n=(n<<1)+a,o|=a<<s}return o}var BitTreeDecoder=function(){function t(t){this.numBits=t,this.probs=createProbsArray(1<<t)}return t.prototype.decode=function(t){for(var e=1,i=0;i<this.numBits;i++)e=(e<<1)+t.decodeBit(this.probs,e);return e-(1<<this.numBits)},t.prototype.reverseDecode=function(t){return bitTreeReverseDecode(this.probs,0,this.numBits,t)},t}();function createBitTreeDecoderArray(t,e){var i=[];i.length=e;for(var r=0;r<e;r++)i[r]=new BitTreeDecoder(t);return i}var kNumPosBitsMax=4,kNumStates=12,kNumLenToPosStates=4,kNumAlignBits=4,kEndPosModelIndex=14,kNumFullDistances=1<<(kEndPosModelIndex>>1),kMatchMinLen=2,LenDecoder=function(){function t(){this.choice=createProbsArray(2),this.lowCoder=createBitTreeDecoderArray(3,1<<kNumPosBitsMax),this.midCoder=createBitTreeDecoderArray(3,1<<kNumPosBitsMax),this.highCoder=new BitTreeDecoder(8)}return t.prototype.decode=function(t,e){return 0===t.decodeBit(this.choice,0)?this.lowCoder[e].decode(t):0===t.decodeBit(this.choice,1)?8+this.midCoder[e].decode(t):16+this.highCoder.decode(t)},t}();function updateState_Literal(t){return t<4?0:t<10?t-3:t-6}function updateState_Match(t){return t<7?7:10}function updateState_Rep(t){return t<7?8:11}function updateState_ShortRep(t){return t<7?9:11}var LZMA_DIC_MIN=4096,MAX_DECODE_BITS_CALLS=48,LzmaDecoderInternal=function(){function t(t,e){this.rangeDec=new RangeDecoder(t),this.outWindow=new OutWindow(e),this.markerIsMandatory=!1,this.lc=0,this.pb=0,this.lp=0,this.dictSize=0,this.dictSizeInProperties=0,this.unpackSize=void 0,this.leftToUnpack=void 0,this.reps=new Int32Array(4),this.state=0}return t.prototype.decodeProperties=function(t){var e=t[0];if(e>=225)throw new Error("Incorrect LZMA properties");this.lc=e%9,e=e/9|0,this.pb=e/5|0,this.lp=e%5,this.dictSizeInProperties=0;for(var i=0;i<4;i++)this.dictSizeInProperties|=t[i+1]<<8*i;this.dictSize=this.dictSizeInProperties,this.dictSize<LZMA_DIC_MIN&&(this.dictSize=LZMA_DIC_MIN)},t.prototype.create=function(){this.outWindow.create(this.dictSize),this.init(),this.rangeDec.init(),this.reps[0]=0,this.reps[1]=0,this.reps[2]=0,this.reps[3]=0,this.state=0,this.leftToUnpack=this.unpackSize},t.prototype.decodeLiteral=function(t,e){var i=this.outWindow,r=this.rangeDec,n=0;i.isEmpty()||(n=i.getByte(1));var o=1,s=768*(((i.totalPos&(1<<this.lp)-1)<<this.lc)+(n>>8-this.lc));if(t>=7){var a=i.getByte(e+1);do{var l=a>>7&1;a<<=1;var h=r.decodeBit(this.litProbs,s+((1+l<<8)+o));if(o=o<<1|h,l!==h)break}while(o<256)}for(;o<256;)o=o<<1|r.decodeBit(this.litProbs,s+o);return o-256&255},t.prototype.decodeDistance=function(t){var e=t;e>kNumLenToPosStates-1&&(e=kNumLenToPosStates-1);var i=this.rangeDec,r=this.posSlotDecoder[e].decode(i);if(r<4)return r;var n=(r>>1)-1,o=(2|1&r)<<n;return o=r<kEndPosModelIndex?o+bitTreeReverseDecode(this.posDecoders,o-r,n,i)|0:(o=o+(i.decodeDirectBits(n-kNumAlignBits)<<kNumAlignBits)|0)+this.alignDecoder.reverseDecode(i)|0},t.prototype.init=function(){this.litProbs=createProbsArray(768<<this.lc+this.lp),this.posSlotDecoder=createBitTreeDecoderArray(6,kNumLenToPosStates),this.alignDecoder=new BitTreeDecoder(kNumAlignBits),this.posDecoders=createProbsArray(1+kNumFullDistances-kEndPosModelIndex),this.isMatch=createProbsArray(kNumStates<<kNumPosBitsMax),this.isRep=createProbsArray(kNumStates),this.isRepG0=createProbsArray(kNumStates),this.isRepG1=createProbsArray(kNumStates),this.isRepG2=createProbsArray(kNumStates),this.isRep0Long=createProbsArray(kNumStates<<kNumPosBitsMax),this.lenDecoder=new LenDecoder,this.repLenDecoder=new LenDecoder},t.prototype.decode=function(t){for(var e=this.rangeDec,i=this.outWindow,r=this.pb,n=this.dictSize,o=this.markerIsMandatory,s=this.leftToUnpack,a=this.isMatch,l=this.isRep,h=this.isRepG0,c=this.isRepG1,u=this.isRepG2,p=this.isRep0Long,d=this.lenDecoder,f=this.repLenDecoder,_=this.reps[0],g=this.reps[1],m=this.reps[2],y=this.reps[3],v=this.state;;){if(t&&e.inStream.available<MAX_DECODE_BITS_CALLS){this.outWindow.flush();break}if(0===s&&!o&&(this.outWindow.flush(),e.isFinishedOK()))return LZMA_RES_FINISHED_WITHOUT_MARKER;var b=i.totalPos&(1<<r)-1;if(0!==e.decodeBit(a,(v<<kNumPosBitsMax)+b)){var x;if(0!==e.decodeBit(l,v)){if(0===s)return LZMA_RES_ERROR;if(i.isEmpty())return LZMA_RES_ERROR;var A;if(0===e.decodeBit(h,v)){if(0===e.decodeBit(p,(v<<kNumPosBitsMax)+b)){v=updateState_ShortRep(v),i.putByte(i.getByte(_+1)),s--;continue}}else 0===e.decodeBit(c,v)?A=g:(0===e.decodeBit(u,v)?A=m:(A=y,y=m),m=g),g=_,_=A;x=f.decode(e,b),v=updateState_Rep(v)}else{if(y=m,m=g,g=_,x=d.decode(e,b),v=updateState_Match(v),-1===(_=this.decodeDistance(x)))return this.outWindow.flush(),e.isFinishedOK()?LZMA_RES_FINISHED_WITH_MARKER:LZMA_RES_ERROR;if(0===s)return LZMA_RES_ERROR;if(_>=n||!i.checkDistance(_))return LZMA_RES_ERROR}x+=kMatchMinLen;var E=!1;if(void 0!==s&&s<x&&(x=s,E=!0),i.copyMatch(_+1,x),s-=x,E)return LZMA_RES_ERROR}else{if(0===s)return LZMA_RES_ERROR;i.putByte(this.decodeLiteral(v,_)),v=updateState_Literal(v),s--}}return this.state=v,this.reps[0]=_,this.reps[1]=g,this.reps[2]=m,this.reps[3]=y,this.leftToUnpack=s,LZMA_RES_NOT_COMPLETE},t.prototype.flushOutput=function(){this.outWindow.flush()},t}(),LZMA_RES_ERROR=0,LZMA_RES_FINISHED_WITH_MARKER=1,LZMA_RES_FINISHED_WITHOUT_MARKER=2,LZMA_RES_NOT_COMPLETE=3,SWF_LZMA_HEADER_LENGTH=17,STANDARD_LZMA_HEADER_LENGTH=13,EXTRA_LZMA_BYTES_NEEDED=5,LzmaDecoderState;!function(t){t[t.WAIT_FOR_LZMA_HEADER=0]="WAIT_FOR_LZMA_HEADER",t[t.WAIT_FOR_SWF_HEADER=1]="WAIT_FOR_SWF_HEADER",t[t.PROCESS_DATA=2]="PROCESS_DATA",t[t.CLOSED=3]="CLOSED",t[t.ERROR=4]="ERROR"}(LzmaDecoderState||(LzmaDecoderState={}));var LzmaDecoder=function(){function t(t){void 0===t&&(t=!1),this._state=t?LzmaDecoderState.WAIT_FOR_SWF_HEADER:LzmaDecoderState.WAIT_FOR_LZMA_HEADER,this.buffer=null}return t.prototype.push=function(t){if(this._state<LzmaDecoderState.PROCESS_DATA){var e=this.buffer?this.buffer.length:0,i=(this._state===LzmaDecoderState.WAIT_FOR_SWF_HEADER?SWF_LZMA_HEADER_LENGTH:STANDARD_LZMA_HEADER_LENGTH)+EXTRA_LZMA_BYTES_NEEDED;if(e+t.length<i){var r=new Uint8Array(e+t.length);return e>0&&r.set(this.buffer),r.set(t,e),void(this.buffer=r)}var n=new Uint8Array(i);if(e>0&&n.set(this.buffer),n.set(t.subarray(0,i-e),e),this._inStream=new InputStream,this._inStream.append(n.subarray(i-EXTRA_LZMA_BYTES_NEEDED)),this._outStream=new OutputStream(function(t){this.onData.call(null,t)}.bind(this)),this._decoder=new LzmaDecoderInternal(this._inStream,this._outStream),this._state===LzmaDecoderState.WAIT_FOR_SWF_HEADER)this._decoder.decodeProperties(n.subarray(12,17)),this._decoder.markerIsMandatory=!1,this._decoder.unpackSize=((n[4]|n[5]<<8|n[6]<<16|n[7]<<24)>>>0)-8;else{this._decoder.decodeProperties(n.subarray(0,5));for(var o=0,s=!1,a=0;a<8;a++){var l=n[5+a];255!==l&&(s=!0),o|=l<<8*a}this._decoder.markerIsMandatory=!s,this._decoder.unpackSize=s?o:void 0}this._decoder.create(),t=t.subarray(i),this._state=LzmaDecoderState.PROCESS_DATA}else if(this._state!==LzmaDecoderState.PROCESS_DATA)return;try{this._inStream.append(t);var h=this._decoder.decode(!0);this._inStream.compact(),h!==LZMA_RES_NOT_COMPLETE&&this._checkError(h)}catch(t){this._decoder.flushOutput(),this._decoder=null,this._error(t)}},t.prototype.close=function(){if(this._state===LzmaDecoderState.PROCESS_DATA){this._state=LzmaDecoderState.CLOSED;try{var t=this._decoder.decode(!1);this._checkError(t)}catch(t){this._decoder.flushOutput(),this._error(t)}this._decoder=null}},t.prototype._error=function(t){this._state=LzmaDecoderState.ERROR,this.onError&&this.onError(t)},t.prototype._checkError=function(t){var e;t===LZMA_RES_ERROR?e="LZMA decoding error":t===LZMA_RES_NOT_COMPLETE?e="Decoding is not complete":t===LZMA_RES_FINISHED_WITH_MARKER?void 0!==this._decoder.unpackSize&&this._decoder.unpackSize!==this._outStream.processed&&(e="Finished with end marker before than specified size"):e="Internal LZMA Error",e&&this._error(e)},t}();function axCoerceString$1(t){return"string"==typeof t?t:null==t?null:t+""}for(var PlainObjectDataBuffer=function(t,e,i){this.buffer=t,this.length=e,this.littleEndian=i},bitMasks=new Uint32Array(33),i=1,mask=0,TypedArrayViewFlags;i<=32;i++)bitMasks[i]=mask=mask<<1|1;!function(t){t[t.U8=1]="U8",t[t.I32=2]="I32",t[t.F32=4]="F32"}(TypedArrayViewFlags||(TypedArrayViewFlags={}));var DataBuffer=function(){function t(e){void 0===e&&(e=t.INITIAL_SIZE),this._buffer||(this._buffer=new ArrayBuffer(e),this._length=0,this._position=0,this._resetViews(),this._littleEndian=t._nativeLittleEndian,this._bitBuffer=0,this._bitLength=0)}return t.FromArrayBuffer=function(e,i){void 0===i&&(i=-1);var r=Object.create(t.prototype);return r._buffer=e,r._length=-1===i?e.byteLength:i,r._position=0,r._resetViews(),r._littleEndian=t._nativeLittleEndian,r._bitBuffer=0,r._bitLength=0,r},t.FromPlainObject=function(e){var i=t.FromArrayBuffer(e.buffer,e.length);return i._littleEndian=e.littleEndian,i},t.prototype.toPlainObject=function(){return new PlainObjectDataBuffer(this._buffer,this._length,this._littleEndian)},t.prototype.clone=function(){var e=t.FromArrayBuffer(new Uint8Array(this._u8).buffer,this._length);return e._position=this._position,e._littleEndian=this._littleEndian,e._bitBuffer=this._bitBuffer,e._bitLength=this._bitLength,e},t.prototype._resetViews=function(){this._u8=new Uint8Array(this._buffer),this._i32=null,this._f32=null},t.prototype._requestViews=function(t){0==(3&this._buffer.byteLength)&&(null===this._i32&&t&TypedArrayViewFlags.I32&&(this._i32=new Int32Array(this._buffer)),null===this._f32&&t&TypedArrayViewFlags.F32&&(this._f32=new Float32Array(this._buffer)))},t.prototype.getBytes=function(){return new Uint8Array(this._buffer,0,this._length)},t.prototype._ensureCapacity=function(e){var i=this._buffer;if(!(i.byteLength>=e)){for(var r=Math.max(i.byteLength,1);r<e;)r*=2;r>4294967295&&(assert(this.sec),this.sec.throwError("RangeError",Errors.ParamRangeError));var n=t._arrayBufferPool.acquire(r),o=this._u8;this._buffer=n,this._resetViews(),this._u8.set(o);for(var s=this._u8,a=o.length;a<s.length;a++)s[a]=0;t._arrayBufferPool.release(i)}},t.prototype.clear=function(){this._length=0,this._position=0},t.prototype.readBoolean=function(){return 0!==this.readUnsignedByte()},t.prototype.readByte=function(){return this.readUnsignedByte()<<24>>24},t.prototype.readUnsignedByte=function(){return this._position+1>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError)),this._u8[this._position++]},t.prototype.readBytes=function(t,e,i){var r=this._position;e>>>=0,0===(i>>>=0)&&(i=this._length-r),r+i>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError)),t.length<e+i&&(t._ensureCapacity(e+i),t.length=e+i),t._u8.set(new Uint8Array(this._buffer,r,i),e),this._position+=i},t.prototype.readShort=function(){return this.readUnsignedShort()<<16>>16},t.prototype.readUnsignedShort=function(){var t=this._u8,e=this._position;e+2>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError));var i=t[e+0],r=t[e+1];return this._position=e+2,this._littleEndian?r<<8|i:i<<8|r},t.prototype.readInt=function(){var t=this._u8,e=this._position;e+4>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError));var i=t[e+0],r=t[e+1],n=t[e+2],o=t[e+3];return this._position=e+4,this._littleEndian?o<<24|n<<16|r<<8|i:i<<24|r<<16|n<<8|o},t.prototype.readUnsignedInt=function(){return this.readInt()>>>0},t.prototype.readFloat=function(){var t=this._position;if(t+4>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError)),this._position=t+4,this._requestViews(TypedArrayViewFlags.F32),this._littleEndian&&0==(3&t)&&this._f32)return this._f32[t>>2];var e=this._u8,i=IntegerUtilities.u8;return this._littleEndian?(i[0]=e[t+0],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3]):(i[3]=e[t+0],i[2]=e[t+1],i[1]=e[t+2],i[0]=e[t+3]),IntegerUtilities.f32[0]},t.prototype.readDouble=function(){var t=this._u8,e=this._position;e+8>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError));var i=IntegerUtilities.u8;return this._littleEndian?(i[0]=t[e+0],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+3],i[4]=t[e+4],i[5]=t[e+5],i[6]=t[e+6],i[7]=t[e+7]):(i[0]=t[e+7],i[1]=t[e+6],i[2]=t[e+5],i[3]=t[e+4],i[4]=t[e+3],i[5]=t[e+2],i[6]=t[e+1],i[7]=t[e+0]),this._position=e+8,IntegerUtilities.f64[0]},t.prototype.writeBoolean=function(t){this.writeByte(t?1:0)},t.prototype.writeByte=function(t){var e=this._position+1;this._ensureCapacity(e),this._u8[this._position++]=t,e>this._length&&(this._length=e)},t.prototype.writeUnsignedByte=function(t){var e=this._position+1;this._ensureCapacity(e),this._u8[this._position++]=t,e>this._length&&(this._length=e)},t.prototype.writeRawBytes=function(t){var e=this._position+t.length;this._ensureCapacity(e),this._u8.set(t,this._position),this._position=e,e>this._length&&(this._length=e)},t.prototype.writeBytes=function(t,e,i){isNullOrUndefined(t)&&(assert(this.sec),this.sec.throwError("TypeError",Errors.NullPointerError,"bytes")),e>>>=0,i>>>=0,arguments.length<2&&(e=0),arguments.length<3&&(i=0),e===clamp(e,0,t.length)&&e+i===clamp(e+i,0,t.length)||(assert(this.sec),this.sec.throwError("RangeError",Errors.ParamRangeError)),0===i&&(i=t.length-e),this.writeRawBytes(new Uint8Array(t._buffer,e,i))},t.prototype.writeShort=function(t){this.writeUnsignedShort(t)},t.prototype.writeUnsignedShort=function(t){var e=this._position;this._ensureCapacity(e+2);var i=this._u8;this._littleEndian?(i[e+0]=t,i[e+1]=t>>8):(i[e+0]=t>>8,i[e+1]=t),e+=2,this._position=e,e>this._length&&(this._length=e)},t.prototype.writeInt=function(t){this.writeUnsignedInt(t)},t.prototype.write2Ints=function(t,e){this.write2UnsignedInts(t,e)},t.prototype.write4Ints=function(t,e,i,r){this.write4UnsignedInts(t,e,i,r)},t.prototype.writeUnsignedInt=function(e){var i=this._position;if(this._ensureCapacity(i+4),this._requestViews(TypedArrayViewFlags.I32),this._littleEndian===t._nativeLittleEndian&&0==(3&i)&&this._i32)this._i32[i>>2]=e;else{var r=this._u8;this._littleEndian?(r[i+0]=e,r[i+1]=e>>8,r[i+2]=e>>16,r[i+3]=e>>24):(r[i+0]=e>>24,r[i+1]=e>>16,r[i+2]=e>>8,r[i+3]=e)}i+=4,this._position=i,i>this._length&&(this._length=i)},t.prototype.write2UnsignedInts=function(e,i){var r=this._position;this._ensureCapacity(r+8),this._requestViews(TypedArrayViewFlags.I32),this._littleEndian===t._nativeLittleEndian&&0==(3&r)&&this._i32?(this._i32[0+(r>>2)]=e,this._i32[1+(r>>2)]=i,r+=8,this._position=r,r>this._length&&(this._length=r)):(this.writeUnsignedInt(e),this.writeUnsignedInt(i))},t.prototype.write4UnsignedInts=function(e,i,r,n){var o=this._position;this._ensureCapacity(o+16),this._requestViews(TypedArrayViewFlags.I32),this._littleEndian===t._nativeLittleEndian&&0==(3&o)&&this._i32?(this._i32[0+(o>>2)]=e,this._i32[1+(o>>2)]=i,this._i32[2+(o>>2)]=r,this._i32[3+(o>>2)]=n,o+=16,this._position=o,o>this._length&&(this._length=o)):(this.writeUnsignedInt(e),this.writeUnsignedInt(i),this.writeUnsignedInt(r),this.writeUnsignedInt(n))},t.prototype.writeFloat=function(e){var i=this._position;if(this._ensureCapacity(i+4),this._requestViews(TypedArrayViewFlags.F32),this._littleEndian===t._nativeLittleEndian&&0==(3&i)&&this._f32)this._f32[i>>2]=e;else{var r=this._u8;IntegerUtilities.f32[0]=e;var n=IntegerUtilities.u8;this._littleEndian?(r[i+0]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]):(r[i+0]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0])}i+=4,this._position=i,i>this._length&&(this._length=i)},t.prototype.write2Floats=function(e,i){var r=this._position;this._ensureCapacity(r+8),this._requestViews(TypedArrayViewFlags.F32),this._littleEndian===t._nativeLittleEndian&&0==(3&r)&&this._f32?(this._f32[0+(r>>2)]=e,this._f32[1+(r>>2)]=i,r+=8,this._position=r,r>this._length&&(this._length=r)):(this.writeFloat(e),this.writeFloat(i))},t.prototype.write6Floats=function(e,i,r,n,o,s){var a=this._position;this._ensureCapacity(a+24),this._requestViews(TypedArrayViewFlags.F32),this._littleEndian===t._nativeLittleEndian&&0==(3&a)&&this._f32?(this._f32[0+(a>>2)]=e,this._f32[1+(a>>2)]=i,this._f32[2+(a>>2)]=r,this._f32[3+(a>>2)]=n,this._f32[4+(a>>2)]=o,this._f32[5+(a>>2)]=s,a+=24,this._position=a,a>this._length&&(this._length=a)):(this.writeFloat(e),this.writeFloat(i),this.writeFloat(r),this.writeFloat(n),this.writeFloat(o),this.writeFloat(s))},t.prototype.writeDouble=function(t){var e=this._position;this._ensureCapacity(e+8);var i=this._u8;IntegerUtilities.f64[0]=t;var r=IntegerUtilities.u8;this._littleEndian?(i[e+0]=r[0],i[e+1]=r[1],i[e+2]=r[2],i[e+3]=r[3],i[e+4]=r[4],i[e+5]=r[5],i[e+6]=r[6],i[e+7]=r[7]):(i[e+0]=r[7],i[e+1]=r[6],i[e+2]=r[5],i[e+3]=r[4],i[e+4]=r[3],i[e+5]=r[2],i[e+6]=r[1],i[e+7]=r[0]),e+=8,this._position=e,e>this._length&&(this._length=e)},t.prototype.readRawBytes=function(){return new Int8Array(this._buffer,0,this._length)},t.prototype.writeUTF=function(t){var e=utf8decode(t=axCoerceString$1(t));this.writeShort(e.length),this.writeRawBytes(e)},t.prototype.writeUTFBytes=function(t){var e=utf8decode(t=axCoerceString$1(t));this.writeRawBytes(e)},t.prototype.readUTF=function(){return this.readUTFBytes(this.readShort())},t.prototype.readUTFBytes=function(t){t>>>=0;var e=this._position;return e+t>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError)),this._position+=t,utf8encode(new Uint8Array(this._buffer,e,t))},Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){(t>>>=0)>this._buffer.byteLength&&this._ensureCapacity(t),this._length=t,this._position=clamp(this._position,0,this._length)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bytesAvailable",{get:function(){return this._length-this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t>>>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bytes",{get:function(){return this._u8},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ints",{get:function(){return this._requestViews(TypedArrayViewFlags.I32),this._i32},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"objectEncoding",{get:function(){return this._objectEncoding},set:function(t){t>>>=0,this._objectEncoding=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endian",{get:function(){return this._littleEndian?"littleEndian":"bigEndian"},set:function(e){e=axCoerceString$1(e),this._littleEndian="auto"===e?t._nativeLittleEndian:"littleEndian"===e},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return utf8encode(new Uint8Array(this._buffer,0,this._length))},t.prototype.toBlob=function(t){return new Blob([new Uint8Array(this._buffer,this._position,this._length)],{type:t})},t.prototype.writeMultiByte=function(t,e){console.log("packageInternal flash.utils.ObjectOutput::writeMultiByte")},t.prototype.readMultiByte=function(t,e){console.log("packageInternal flash.utils.ObjectInput::readMultiByte")},t.prototype.getValue=function(t){if(!((t|=0)>=this._length))return this._u8[t]},t.prototype.setValue=function(t,e){var i=(t|=0)+1;this._ensureCapacity(i),this._u8[t]=e,i>this._length&&(this._length=i)},t.prototype.readFixed=function(){return this.readInt()/65536},t.prototype.readFixed8=function(){return this.readShort()/256},t.prototype.readFloat16=function(){var t=this.readUnsignedShort(),e=t>>15?-1:1,i=(31744&t)>>10,r=1023&t;return i?31===i?r?NaN:e*(1/0):e*Math.pow(2,i-15)*(1+r/1024):e*Math.pow(2,-14)*(r/1024)},t.prototype.readEncodedU32=function(){var t=this.readUnsignedByte();return 128&t&&16384&(t=127&t|this.readUnsignedByte()<<7)&&2097152&(t=16383&t|this.readUnsignedByte()<<14)&&268435456&(t=2097151&t|this.readUnsignedByte()<<21)?268435455&t|this.readUnsignedByte()<<28:t},t.prototype.readBits=function(t){return this.readUnsignedBits(t)<<32-t>>32-t},t.prototype.readUnsignedBits=function(t){for(var e=this._bitBuffer,i=this._bitLength;t>i;)e=e<<8|this.readUnsignedByte(),i+=8;var r=e>>>(i-=t)&bitMasks[t];return this._bitBuffer=e,this._bitLength=i,r},t.prototype.readFixedBits=function(t){return this.readBits(t)/65536},t.prototype.readString=function(t){var e=this._position;if(t)e+t>this._length&&(assert(this.sec),this.sec.throwError("flash.errors.EOFError",Errors.EOFError)),this._position+=t;else{t=0;for(var i=e;i<this._length&&this._u8[i];i++)t++;this._position+=t+1}return utf8encode(new Uint8Array(this._buffer,e,t))},t.prototype.align=function(){this._bitBuffer=0,this._bitLength=0},t.prototype.deflate=function(){this.compress("deflate")},t.prototype.inflate=function(){this.uncompress("deflate")},t.prototype.compress=function(e){var i;switch(e=0===arguments.length?"zlib":axCoerceString$1(e)){case"zlib":i=new Deflate(!0);break;case"deflate":i=new Deflate(!1);break;default:return}var r=new t;i.onData=r.writeRawBytes.bind(r),i.push(this._u8.subarray(0,this._length)),i.close(),this._ensureCapacity(r._u8.length),this._u8.set(r._u8),this.length=r.length,this._position=0},t.prototype.uncompress=function(e){var i;switch(e=0===arguments.length?"zlib":axCoerceString$1(e)){case"zlib":i=Inflate.create(!0);break;case"deflate":i=Inflate.create(!1);break;case"lzma":i=new LzmaDecoder(!1);break;default:return}var r,n=new t;i.onData=n.writeRawBytes.bind(n),i.onError=function(t){return r=t},i.push(this._u8.subarray(0,this._length)),r&&(assert(this.sec),this.sec.throwError("IOError",Errors.CompressedDataError)),i.close(),this._ensureCapacity(n._u8.length),this._u8.set(n._u8),this.length=n.length,this._position=0},t._nativeLittleEndian=1===new Int8Array(new Int32Array([1]).buffer)[0],t.INITIAL_SIZE=128,t._arrayBufferPool=new ArrayBufferPool,t}(),FillType;!function(t){t[t.Solid=0]="Solid",t[t.LinearGradient=16]="LinearGradient",t[t.RadialGradient=18]="RadialGradient",t[t.FocalRadialGradient=19]="FocalRadialGradient",t[t.RepeatingBitmap=64]="RepeatingBitmap",t[t.ClippedBitmap=65]="ClippedBitmap",t[t.NonsmoothedRepeatingBitmap=66]="NonsmoothedRepeatingBitmap",t[t.NonsmoothedClippedBitmap=67]="NonsmoothedClippedBitmap"}(FillType||(FillType={}));var PathSegment=function(){function t(e,i,r,n,o,s){this.commands=e,this.data=i,this.morphData=r,this.prev=n,this.next=o,this.isReversed=s,this.isValidFill=!0,this.id=t._counter++}return t.FromDefaults=function(e){var i=new DataBuffer,r=new DataBuffer;i.endian=r.endian="auto";var n=null;return e&&((n=new DataBuffer).endian="auto"),new t(i,r,n,null,null,!1)},t.prototype.moveTo=function(t,e){this.commands.writeUnsignedByte(9),this.data.write2Ints(t,e)},t.prototype.morphMoveTo=function(t,e,i,r){this.moveTo(t,e),this.morphData.write2Ints(i,r)},t.prototype.lineTo=function(t,e){this.commands.writeUnsignedByte(10),this.data.write2Ints(t,e)},t.prototype.morphLineTo=function(t,e,i,r){this.lineTo(t,e),this.morphData.write2Ints(i,r)},t.prototype.curveTo=function(t,e,i,r){this.commands.writeUnsignedByte(11),this.data.write4Ints(t,e,i,r)},t.prototype.morphCurveTo=function(t,e,i,r,n,o,s,a){this.curveTo(t,e,i,r),this.morphData.write4Ints(n,o,s,a)},t.prototype.toReversed=function(){return assert(!this.isReversed),new t(this.commands,this.data,this.morphData,null,null,!0)},t.prototype.clone=function(){return new t(this.commands,this.data,this.morphData,null,null,this.isReversed)},t.prototype.storeStartAndEnd=function(){var t=this.data.ints,e=t[0]+","+t[1],i=(this.data.length>>2)-2,r=t[i]+","+t[i+1];this.isReversed?(this.startPoint=r,this.endPoint=e):(this.startPoint=e,this.endPoint=r)},t.prototype.connectsTo=function(t){return t!==this&&(assert(this.endPoint),assert(t.startPoint),this.endPoint===t.startPoint)},t.prototype.startConnectsTo=function(t){return t!==this&&this.startPoint===t.startPoint},t.prototype.flipDirection=function(){var t;t=this.startPoint,this.startPoint=this.endPoint,this.endPoint=t,this.isReversed=!this.isReversed},t.prototype.serializeAJS=function(t,e,i){if(this.isReversed)this._serializeReversedAJS(t,e,i);else{var r=this.commands.bytes,n=this.data.length>>2,o=this.morphData?this.morphData.ints:null,s=this.data.ints;assert(9===r[0]);var a=0;s[0]===i.x&&s[1]===i.y&&a++;for(var l=this.commands.length,h=2*a,c=a;c<l;c++){switch(r[c]){case 9:t.moveTo(s[h]/20,s[h+1]/20),e&&e.moveTo(o[h]/20,o[h+1]/20);break;case 10:t.lineTo(s[h]/20,s[h+1]/20),e&&e.lineTo(o[h]/20,o[h+1]/20);break;case 11:t.curveTo(s[h]/20,s[h+1]/20,s[h+2]/20,s[h+3]/20),e&&e.curveTo(o[h]/20,o[h+1]/20,o[h+2]/20,o[h+3]/20),h+=2}h+=2}i.x=s[n-2],i.y=s[n-1]}},t.prototype._serializeReversedAJS=function(t,e,i){var r=this.commands.length,n=(this.data.length>>2)-2,o=this.commands.bytes;assert(9===o[0]);var s=this.data.ints,a=this.morphData?this.morphData.ints:null;if(s[n]===i.x&&s[n+1]===i.y||(t.moveTo(s[n]/20,s[n+1]/20),e&&e.moveTo(a[n]/20,a[n+1]/20)),1===r)return i.x=s[0],void(i.y=s[1]);for(var l=r;l-- >1;){n-=2;o[l];switch(o[l]){case 9:t.moveTo(s[n]/20,s[n+1]/20),e&&e.moveTo(a[n]/20,a[n+1]/20);break;case 10:t.lineTo(s[n]/20,s[n+1]/20),e&&e.lineTo(a[n]/20,a[n+1]/20);break;case 11:n-=2,t.curveTo(s[n+2]/20,s[n+3]/20,s[n]/20,s[n+1]/20),e&&e.curveTo(a[n+2]/20,a[n+3]/20,a[n]/20,a[n+1]/20)}}i.x=s[0],i.y=s[1]},t._counter=0,t}(),GradientType;!function(t){t[t.LINEAR=0]="LINEAR",t[t.RADIAL=1]="RADIAL"}(GradientType||(GradientType={}));var GraphicsFillStyle=function(){function t(t,e){void 0===t&&(t=16777215),void 0===e&&(e=1),this.color=t,this.alpha=e}return Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:!0,configurable:!0}),t.data_type="[graphicsdata FillStyle]",t}(),GradientFillStyle=function(t){function e(e,i,r,n,o,s,a,l){var h=t.call(this)||this;if(i.length!=r.length||i.length!=n.length)throw"GradientFillStyle: Error - colors, alphas and ratios must be of same length";h.colors=i,h.colors_r=[],h.colors_g=[],h.colors_b=[],h.colors_r.length=h.colors_g.length=h.colors_g.length=h.colors.length,h.alphas=r,h.ratios=n,h.matrix=o,h.type=e,h.uvRectangle=new Rectangle,h.ratios.sort((function(t,e){return t-e})),h.ratio_min=h.ratios[0],h.ratio_max=h.ratios[h.ratios.length-1];h.ratios.length;for(var c,u=i.length;u>0;)u--,c=ColorUtils.float32ColorToARGB(i[u]),h.colors_r[u]=c[1],h.colors_g[u]=c[2],h.colors_b[u]=c[3];return h}return __extends(e,t),e.prototype.getUVMatrix=function(){this.matrix||(this.matrix=new Matrix);var t=this.matrix.a,e=this.matrix.b,i=this.matrix.c,r=this.matrix.d,n=this.matrix.tx,o=this.matrix.ty,s=r/(t*r-e*i),a=-e/(t*r-e*i),l=-i/(t*r-e*i),h=t/(t*r-e*i),c=(i*o-r*n)/(t*r-e*i),u=-(t*o-e*n)/(t*r-e*i),p=s/1638.4*(1-1/256),d=l/1638.4*(1-1/256),f=this.uvRectangle.x+(c+819.2)/1638.4*(1-1/256),_=this.uvRectangle.y;return this.matrix=new Matrix(p,0,d,0,f,_),this.type==GradientType.RADIAL&&(this.matrix=new Matrix(s/819.2,l/819.2,a/819.2,h/819.2,(c+819.2)/819.2-1,(u+819.2)/819.2-1)),this.matrix},e.prototype.getColorAtPosition=function(t){var e=-1,i=-1;if(t<=this.ratio_min)e=0,i=0;else if(t>=this.ratio_max)e=this.ratios.length-1,i=this.ratios.length-1;else{var r=0;for(r=0;r<this.ratios.length-1;r++){if(t==this.ratios[r]){e=r,i=r;break}if(t==this.ratios[r+1]){e=r+1,i=r+1;break}if(t>=this.ratios[r]&&t<=this.ratios[r+1]){e=r,i=r+1;break}}}if(e==i)return[this.alphas[e],this.colors_r[e],this.colors_g[e],this.colors_b[e]];var n=(t-this.ratios[e])/(this.ratios[i]-this.ratios[e]),o=1-n;return[this.alphas[i]*n+this.alphas[e]*o,this.colors_r[i]*n+this.colors_r[e]*o,this.colors_g[i]*n+this.colors_g[e]*o,this.colors_b[i]*n+this.colors_b[e]*o]},e.prototype.toString=function(){for(var t="",e=this.colors.length;e>0;)e--,t+=this.colors[e]+"#"+this.alphas[e]+"#"+this.ratios[e]+"#";return t},Object.defineProperty(e.prototype,"data_type",{get:function(){return e.data_type},enumerable:!0,configurable:!0}),e.data_type="[graphicsdata GradientFillStyle]",e}(GraphicsFillStyle),BitmapFillStyle=function(){function t(t,e,i,r){this.material=t,this.matrix=e,this.repeat=i}return Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:!0,configurable:!0}),t.prototype.getUVMatrix=function(){this.matrix||(this.matrix=new Matrix);var t=.5*(2*this.material.ambientMethod.texture._images[0].width),e=.5*(2*this.material.ambientMethod.texture._images[0].height),i=this.matrix.a/20,r=this.matrix.b/20,n=this.matrix.c/20,o=this.matrix.d/20,s=this.matrix.tx,a=this.matrix.ty,l=o/(i*o-r*n),h=-r/(i*o-r*n),c=-n/(i*o-r*n),u=i/(i*o-r*n),p=(n*a-o*s)/(i*o-r*n),d=-(i*a-r*s)/(i*o-r*n);return this.matrix.a=l/t,this.matrix.b=h/e,this.matrix.c=c/t,this.matrix.d=u/e,this.matrix.tx=p/t,this.matrix.ty=d/e,this.matrix},t.data_type="[graphicsdata BitmapFillStyle]",t}(),LineScaleMode;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.NONE=1]="NONE",t[t.NORMAL=2]="NORMAL",t[t.VERTICAL=3]="VERTICAL",t[t.HAIRLINE=4]="HAIRLINE"}(LineScaleMode||(LineScaleMode={}));var CapsStyle=function(){function t(){}return t.ROUND=1,t.NONE=0,t.SQUARE=2,t}(),JointStyle=function(){function t(){}return t.BEVEL=1,t.MITER=2,t.ROUND=0,t}(),GraphicsStrokeStyle=function(){function t(t,e,i,r,n,o,s){void 0===t&&(t=16777215),void 0===e&&(e=1),void 0===i&&(i=10),void 0===r&&(r=JointStyle.ROUND),void 0===n&&(n=CapsStyle.SQUARE),void 0===o&&(o=10),void 0===s&&(s=LineScaleMode.NORMAL),this._color=t,this._alpha=e,this._thickness=i,this._jointstyle=r,this._capstyle=n,this._miter_limit=o,this.scaleMode=s}return Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"half_thickness",{get:function(){return this._thickness/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"jointstyle",{get:function(){return this._jointstyle},set:function(t){this._jointstyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"miter_limit",{get:function(){return this._miter_limit},set:function(t){this._miter_limit=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capstyle",{get:function(){return this._capstyle},set:function(t){this._capstyle=t},enumerable:!0,configurable:!0}),t.data_type="[graphicsdata StrokeStyle]",t}(),SegmentedPath=function(){function t(t,e){this.fillStyle=t,this.lineStyle=e,this._head=null}return t.prototype.addSegment=function(t){assert(t),assert(null===t.next),assert(null===t.prev);var e=this._head;e&&(assert(t!==e),e.next=t,t.prev=e),this._head=t},t.prototype.removeSegment=function(t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev)},t.prototype.insertSegment=function(t,e){var i=e.prev;t.prev=i,t.next=e,i&&(i.next=t),e.prev=t},t.prototype.head=function(){return this._head},t.prototype.rgbaToArgb=function(t){return(255&t)<<24|(4278190080&t)>>>24<<16|(16711680&t)>>>16<<8|(65280&t)>>>8},t.prototype.getAlpha=function(t){return 255&t},t.prototype.rgbToArgb=function(t){return(4278190080&t)>>>24<<24|(255&t)<<16|(65280&t)>>>8<<8|(16711680&t)>>>16},t.prototype.serializeAJS=function(t,e){var i=this.head();if(i){if(this.fillStyle){var r=(l=this.fillStyle).morph;switch(l.type){case FillType.Solid:l.alpha=this.getAlpha(l.color)/255,l.color=this.rgbaToArgb(l.color),t.style=new GraphicsFillStyle(l.color,l.alpha),r&&(r.alpha=this.getAlpha(r.color)/255,r.color=this.rgbaToArgb(r.color),e.style=new GraphicsFillStyle(r.color,r.alpha));break;case FillType.LinearGradient:case FillType.RadialGradient:case FillType.FocalRadialGradient:for(var n=l.type===FillType.LinearGradient?GradientType.LINEAR:GradientType.RADIAL,o=[],s=0;s<l.colors.length;s++)o[s]=this.getAlpha(l.colors[s])/255,l.colors[s]=this.rgbaToArgb(l.colors[s]);var a=new Matrix(l.transform.a,l.transform.b,l.transform.c,l.transform.d,l.transform.tx,l.transform.ty);if(t.style=new GradientFillStyle(n,l.colors,o,l.ratios,a,l.spreadMethod,l.interpolationMode,l.focalPoint/2|0),r){for(n=r.type===FillType.LinearGradient?GradientType.LINEAR:GradientType.RADIAL,o=[],s=0;s<r.colors.length;s++)o[s]=this.getAlpha(r.colors[s])/255,r.colors[s]=this.rgbaToArgb(r.colors[s]);a=new Matrix(r.transform.a,r.transform.b,r.transform.c,r.transform.d,r.transform.tx,r.transform.ty);e.style=new GradientFillStyle(n,r.colors,o,r.ratios,a,r.spreadMethod,r.interpolationMode,r.focalPoint/2|0)}break;case FillType.ClippedBitmap:case FillType.RepeatingBitmap:case FillType.NonsmoothedClippedBitmap:case FillType.NonsmoothedRepeatingBitmap:a=new Matrix(l.transform.a,l.transform.b,l.transform.c,l.transform.d,l.transform.tx,l.transform.ty);t.style=new BitmapFillStyle(l.material,a,l.repeat,l.smooth),r&&console.log("writeMorphBitmap not handled yet");break;default:console.log("Invalid fill style type: "+l.type)}}else{var l;r=(l=this.lineStyle).morph;switch(assert(l),l.type){case FillType.Solid:l.noHscale?l.noVscale:l.noVscale;var h=(0|clamp(l.width,0,5100))/20;l.alpha=this.getAlpha(l.color)/255,l.color=this.rgbaToArgb(l.color);var c=LineScaleMode.NORMAL;if(.05==h&&(c=LineScaleMode.HAIRLINE),l.startCapsStyle!=l.endCapsStyle&&console.log("Warning: different end vs start capstye"),l.startCapsStyle=CapsStyle.ROUND,l.jointStyle=0,t.style=new GraphicsStrokeStyle(l.color,l.alpha,h,l.jointStyle,l.startCapsStyle,l.miterLimit,c),r){h=(0|clamp(r.width,0,5100))/20;r.alpha=this.getAlpha(r.color)/255,r.color=this.rgbaToArgb(r.color),e.style=new GraphicsStrokeStyle(r.color,r.alpha,h,l.jointStyle,l.startCapsStyle,l.miterLimit,c)}break;case FillType.LinearGradient:case FillType.RadialGradient:case FillType.FocalRadialGradient:l.noHscale?l.noVscale:l.noVscale,h=(0|clamp(l.width,0,5100))/20;l.alpha=this.getAlpha(l.color)/255,l.color=this.rgbaToArgb(l.color),t.style=new GraphicsStrokeStyle(l.color,l.alpha,h,l.jointStyle,l.endCapsStyle,l.miterLimit);for(n=l.type===FillType.LinearGradient?GradientType.LINEAR:GradientType.RADIAL,s=0;s<l.colors.length;s++)l.colors[s]=this.rgbaToArgb(l.colors[s]),o[s]=1;for(s=0;s<l.colors.length;s++)o[s]=1;t.style=new GradientFillStyle(n,l.colors,o,l.ratios,l.transform,l.spreadMethod,l.interpolationMode,l.focalPoint/2|0);break;case FillType.ClippedBitmap:case FillType.RepeatingBitmap:case FillType.NonsmoothedClippedBitmap:case FillType.NonsmoothedRepeatingBitmap:l.noHscale?l.noVscale:l.noVscale,h=0|clamp(l.width,0,5100);t.style=new GraphicsStrokeStyle(l.color,1,h,l.jointStyle,l.endCapsStyle,l.miterLimit)}}for(;i;)i.storeStartAndEnd(),i=i.prev;for(var u=this.head(),p=u,d=null,f=null,_=u.prev;u;){for(;_;)_.startConnectsTo(u)&&_.flipDirection(),_.connectsTo(u)?(_.next!==u&&(this.removeSegment(_),this.insertSegment(_,u)),_=(u=_).prev):(_.startConnectsTo(p)&&_.flipDirection(),p.connectsTo(_)?(this.removeSegment(_),p.next=_,_=_.prev,p.next.prev=p,p.next.next=null,p=p.next):_=_.prev);if(_=u.prev,d?(f.next=u,u.prev=f,(f=p).next=null):(d=u,f=p),!_)break;_=(u=p=_).prev}var g={x:0,y:0};for(_=d;_;)_.isValidFill&&_.serializeAJS(t,e,g),_=_.next;return t}},t}(),PlainObjectShapeData=function(t,e,i,r,n,o,s,a,l,h,c){this.commands=t,this.commandsPosition=e,this.coordinates=i,this.morphCoordinates=r,this.coordinatesPosition=n,this.styles=o,this.stylesLength=s,this.morphStyles=a,this.morphStylesLength=l,this.hasFills=h,this.hasLines=c},DefaultSize;!function(t){t[t.Commands=32]="Commands",t[t.Coordinates=128]="Coordinates",t[t.Styles=16]="Styles"}(DefaultSize||(DefaultSize={}));var ShapeData=function(){function t(t){void 0===t&&(t=!0),t&&this.clear()}return t.FromPlainObject=function(e){var i=new t(!1);return i.commands=e.commands,i.coordinates=e.coordinates,i.morphCoordinates=e.morphCoordinates,i.commandsPosition=e.commandsPosition,i.coordinatesPosition=e.coordinatesPosition,i.styles=DataBuffer.FromArrayBuffer(e.styles,e.stylesLength),i.styles.endian="auto",e.morphStyles&&(i.morphStyles=DataBuffer.FromArrayBuffer(e.morphStyles,e.morphStylesLength),i.morphStyles.endian="auto"),i.hasFills=e.hasFills,i.hasLines=e.hasLines,i},t.prototype.moveTo=function(t,e){this.ensurePathCapacities(1,2),this.commands[this.commandsPosition++]=9,this.coordinates[this.coordinatesPosition++]=t,this.coordinates[this.coordinatesPosition++]=e},t.prototype.lineTo=function(t,e){this.ensurePathCapacities(1,2),this.commands[this.commandsPosition++]=10,this.coordinates[this.coordinatesPosition++]=t,this.coordinates[this.coordinatesPosition++]=e},t.prototype.curveTo=function(t,e,i,r){this.ensurePathCapacities(1,4),this.commands[this.commandsPosition++]=11,this.coordinates[this.coordinatesPosition++]=t,this.coordinates[this.coordinatesPosition++]=e,this.coordinates[this.coordinatesPosition++]=i,this.coordinates[this.coordinatesPosition++]=r},t.prototype.cubicCurveTo=function(t,e,i,r,n,o){this.ensurePathCapacities(1,6),this.commands[this.commandsPosition++]=12,this.coordinates[this.coordinatesPosition++]=t,this.coordinates[this.coordinatesPosition++]=e,this.coordinates[this.coordinatesPosition++]=i,this.coordinates[this.coordinatesPosition++]=r,this.coordinates[this.coordinatesPosition++]=n,this.coordinates[this.coordinatesPosition++]=o},t.prototype.beginFill=function(t){this.ensurePathCapacities(1,0),this.commands[this.commandsPosition++]=1,this.styles.writeUnsignedInt(t),this.hasFills=!0},t.prototype.writeMorphFill=function(t){this.morphStyles.writeUnsignedInt(t)},t.prototype.endFill=function(){this.ensurePathCapacities(1,0),this.commands[this.commandsPosition++]=4},t.prototype.endLine=function(){this.ensurePathCapacities(1,0),this.commands[this.commandsPosition++]=8},t.prototype.lineStyle=function(t,e,i,r,n,o,s){assert(t===(0|t),t>=0&&t<=5100),this.ensurePathCapacities(2,0),this.commands[this.commandsPosition++]=5,this.coordinates[this.coordinatesPosition++]=t;var a=this.styles;a.writeUnsignedInt(e),a.writeBoolean(i),a.writeUnsignedByte(r),a.writeUnsignedByte(n),a.writeUnsignedByte(o),a.writeUnsignedByte(s),this.hasLines=!0},t.prototype.writeMorphLineStyle=function(t,e){this.morphCoordinates[this.coordinatesPosition-1]=t,this.morphStyles.writeUnsignedInt(e)},t.prototype.beginBitmap=function(t,e,i,r,n){assert(3===t||7===t),this.ensurePathCapacities(1,0),this.commands[this.commandsPosition++]=t;var o=this.styles;o.writeUnsignedInt(e),this._writeStyleMatrix(i,!1),o.writeBoolean(r),o.writeBoolean(n),this.hasFills=!0},t.prototype.writeMorphBitmap=function(t){this._writeStyleMatrix(t,!0)},t.prototype.beginGradient=function(t,e,i,r,n,o,s,a){assert(2===t||6===t),this.ensurePathCapacities(1,0),this.commands[this.commandsPosition++]=t;var l=this.styles;l.writeUnsignedByte(r),assert(a===(0|a)),l.writeShort(a),this._writeStyleMatrix(n,!1);var h=e.length;l.writeByte(h);for(var c=0;c<h;c++)l.writeUnsignedByte(i[c]),l.writeUnsignedInt(e[c]);l.writeUnsignedByte(o),l.writeUnsignedByte(s),this.hasFills=!0},t.prototype.writeMorphGradient=function(t,e,i){this._writeStyleMatrix(i,!0);for(var r=this.morphStyles,n=0;n<t.length;n++)r.writeUnsignedByte(e[n]),r.writeUnsignedInt(t[n])},t.prototype.writeCommandAndCoordinates=function(t,e,i){this.ensurePathCapacities(1,2),this.commands[this.commandsPosition++]=t,this.coordinates[this.coordinatesPosition++]=e,this.coordinates[this.coordinatesPosition++]=i},t.prototype.writeCoordinates=function(t,e){this.ensurePathCapacities(0,2),this.coordinates[this.coordinatesPosition++]=t,this.coordinates[this.coordinatesPosition++]=e},t.prototype.writeMorphCoordinates=function(t,e){this.morphCoordinates=ensureTypedArrayCapacity(this.morphCoordinates,this.coordinatesPosition),this.morphCoordinates[this.coordinatesPosition-2]=t,this.morphCoordinates[this.coordinatesPosition-1]=e},t.prototype.clear=function(){this.commandsPosition=this.coordinatesPosition=0,this.commands=new Uint8Array(DefaultSize.Commands),this.coordinates=new Int32Array(DefaultSize.Coordinates),this.styles=new DataBuffer(DefaultSize.Styles),this.styles.endian="auto",this.hasFills=this.hasLines=!1},t.prototype.isEmpty=function(){return 0===this.commandsPosition},t.prototype.clone=function(){var e=new t(!1);return e.commands=new Uint8Array(this.commands),e.commandsPosition=this.commandsPosition,e.coordinates=new Int32Array(this.coordinates),e.coordinatesPosition=this.coordinatesPosition,e.styles=new DataBuffer(this.styles.length),e.styles.writeRawBytes(this.styles.bytes.subarray(0,this.styles.length)),this.morphStyles&&(e.morphStyles=new DataBuffer(this.morphStyles.length),e.morphStyles.writeRawBytes(this.morphStyles.bytes.subarray(0,this.morphStyles.length))),e.hasFills=this.hasFills,e.hasLines=this.hasLines,e},t.prototype.toPlainObject=function(){return new PlainObjectShapeData(this.commands,this.commandsPosition,this.coordinates,this.morphCoordinates,this.coordinatesPosition,this.styles.buffer,this.styles.length,this.morphStyles&&this.morphStyles.buffer,this.morphStyles?this.morphStyles.length:0,this.hasFills,this.hasLines)},Object.defineProperty(t.prototype,"buffers",{get:function(){var t=[this.commands.buffer,this.coordinates.buffer,this.styles.buffer];return this.morphCoordinates&&t.push(this.morphCoordinates.buffer),this.morphStyles&&t.push(this.morphStyles.buffer),t},enumerable:!0,configurable:!0}),t.prototype._writeStyleMatrix=function(t,e){(e?this.morphStyles:this.styles).write6Floats(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.ensurePathCapacities=function(t,e){this.commands=ensureTypedArrayCapacity(this.commands,this.commandsPosition+t),this.coordinates=ensureTypedArrayCapacity(this.coordinates,this.coordinatesPosition+e)},t}(),DrawMode=function(){function t(){}return t.BOTH=1,t.STROKE=0,t.FILL=2,t}(),HitTestCache=function(){this.cells=new Array,this.lastCollisionIndex=-1},TriangleElementsUtils=function(){function t(){}return t.hitTest=function(t,e,i,r,n,o,s){void 0===s&&(s=0);var a,l,h,c,u,p,d,f,_,g,m,y=n.positions,v=n.getCustomAtributes("curves"),b=y.stride,x=v?v.stride:null,A=y.get(o,s),E=v?v.get(o,s):null;n.indices?(a=n.indices.get(o,s),A=y.get(y.count),E=v?v.get(v.count):null,l=o*n.indices.dimensions):(A=y.get(o,s),E=v?v.get(o,s):null,l=o);var S=n.hitTestCache[s]||(n.hitTestCache[s]=new HitTestCache),T=S.lastCollisionIndex;if(-1!=T&&T<l)t:{if(a?(h=a[T+2],c=a[T+1],u=a[T]):(h=T+2,c=T+1,u=T),p=A[h*b],d=A[h*b+1],f=A[c*b],_=A[c*b+1],g=A[u*b],m=A[u*b+1],!((p-t)*(_-d)+(d-e)*-(f-p)>0||(f-t)*(m-_)+(_-e)*-(g-f)>0||(g-t)*(d-m)+(m-e)*-(p-g)>0)){if(E&&-128!=E[h*x+2]){var P=(Q=.5*(((Y=t-p)*(q=m-d)-(W=g-p)*(K=e-d))/(Z=(H=f-p)*q-W*($=_-d)))+(J=(H*K-Y*$)/Z))*Q-J,C=E[h*x];if(P>0&&-128==C)break t;if(P<0&&127==C)break t}return!0}}if(l>150){var w=S.cells,D=w.length?S.divisions:S.divisions=Math.min(Math.ceil(Math.sqrt(l)),32),M=D/r.width,O=D/r.height,I=r.x,L=r.y;if(!w.length){w.length=D*D;for(var N=0;N<l;N+=3){a?(h=a[N+2],c=a[N+1],u=a[N]):(h=N+2,c=N+1,u=N),p=A[h*b],d=A[h*b+1],f=A[c*b],_=A[c*b+1],g=A[u*b],m=A[u*b+1];for(var F=Math.floor((Math.min(p,f,g)-I)*M),R=Math.floor((Math.min(d,_,m)-L)*O),B=Math.floor((Math.max(p,f,g)-I)*M),V=Math.floor((Math.max(d,_,m)-L)*O),k=F;k<=B;k++)for(var U=R;U<=V;U++){var j,G=k+U*D;(j=w[G]||(w[G]=new Array)).push(N)}}}if(null==(j=w[Math.floor((t-I)*M)+Math.floor((e-L)*O)*D]))return S.lastCollisionIndex=-1,!1;for(var z=j.length,X=0;X<z;X++){N=j[X];if((u=a?a[N]:N)!=T)if(a?(h=a[N+2],c=a[N+1]):(h=N+2,c=N+1),p=A[h*b],d=A[h*b+1],f=A[c*b],_=A[c*b+1],g=A[u*b],m=A[u*b+1],!((p-t)*(_-d)+(d-e)*-(f-p)>0||(f-t)*(m-_)+(_-e)*-(g-f)>0||(g-t)*(d-m)+(m-e)*-(p-g)>0)){if(E&&-128!=E[h*x+2]){P=(Q=.5*(((Y=t-p)*(q=m-d)-(W=g-p)*(K=e-d))/(Z=(H=f-p)*q-W*($=_-d)))+(J=(H*K-Y*$)/Z))*Q-J,C=E[h*x];if(P>0&&-128==C)continue;if(P<0&&127==C)continue}return S.lastCollisionIndex=N,!0}}return S.lastCollisionIndex=-1,!1}for(N=0;N<l;N+=3){if((u=a?a[N]:N)!=T)if(a?(h=a[N+2],c=a[N+1]):(h=N+2,c=N+1),p=A[h*b],d=A[h*b+1],f=A[c*b],_=A[c*b+1],g=A[u*b],m=A[u*b+1],!((p-t)*(_-d)+(d-e)*-(f-p)>0||(f-t)*(m-_)+(_-e)*-(g-f)>0||(g-t)*(d-m)+(m-e)*-(p-g)>0)){if(E&&-128!=E[h*x+2]){var H,$,W,q,Y,K,Z,J,Q;P=(Q=.5*(((Y=t-p)*(q=m-d)-(W=g-p)*(K=e-d))/(Z=(H=f-p)*q-W*($=_-d)))+(J=(H*K-Y*$)/Z))*Q-J,C=E[h*x];if(P>0&&-128==C)continue;if(P<0&&127==C)continue}return S.lastCollisionIndex=N,!0}}return S.lastCollisionIndex=-1,!1},t.getBoxBounds=function(t,e,i,r,n,o,s){var a;void 0===s&&(s=0);var l,h,c=t.dimensions,u=t.stride,p=0,d=0,f=0,_=0,g=0,m=0;if(e?(h=o*e.dimensions,l=e.get(o,s),a=t.get(t.count)):(h=o,a=t.get(o,s)),0==h)return n;var y,v,b,x,A,E=0;for(i&&(A=i._rawData),null==n?(n=r||new Box,y=l?l[E]*u:E*u,i?3==c?(v=a[y]*A[0]+a[y+1]*A[4]+a[y+2]*A[8]+A[12],b=a[y]*A[1]+a[y+1]*A[5]+a[y+2]*A[9]+A[13],x=a[y]*A[2]+a[y+1]*A[6]+a[y+2]*A[10]+A[14]):(v=a[y]*A[0]+a[y+1]*A[4]+A[12],b=a[y]*A[1]+a[y+1]*A[5]+A[13]):(v=a[y],b=a[y+1],x=3==c?a[y+2]:0),_=p=v,g=d=b,m=f=3==c?x:0,E++):(_=(p=n.x)+n.width,g=(d=n.y)+n.height,m=(f=n.z)+n.depth);E<h;E++)y=l?l[E]*u:E*u,i?3==c?(v=a[y]*A[0]+a[y+1]*A[4]+a[y+2]*A[8]+A[12],b=a[y]*A[1]+a[y+1]*A[5]+a[y+2]*A[9]+A[13],x=a[y]*A[2]+a[y+1]*A[6]+a[y+2]*A[10]+A[14]):(v=a[y]*A[0]+a[y+1]*A[4]+A[12],b=a[y]*A[1]+a[y+1]*A[5]+A[13]):(v=a[y],b=a[y+1],x=3==c?a[y+2]:0),v<p?p=v:v>_&&(_=v),b<d?d=b:b>g&&(g=b),3==c&&(x<f?f=x:x>m&&(m=x));return n.width=_-(n.x=p),n.height=g-(n.y=d),n.depth=m-(n.z=f),n},t.getSphereBounds=function(t,e,i,r,n,o,s){void 0===s&&(s=0);for(var a,l,h,c,u=t.get(o,s),p=t.dimensions,d=t.stride,f=0,_=o*d,g=0;g<_;g+=d)f<(a=(l=u[g]-e.x)*l+(h=u[g+1]-e.y)*h+(c=3==p?u[g+2]-e.z:-e.z)*c)&&(f=a);return null==n&&(n=new Sphere),n.x=e.x,n.y=e.y,n.z=e.z,n.radius=Math.sqrt(f),n},t.updateTriangleGraphicsSlice9=function(t,e,i,r,n,o){if(void 0===n&&(n=!1),void 0===o&&(o=!1),9!=t.slice9Indices.length)throw"ElementUtils: Error - triangleElement does not provide valid slice9Indices!";var s,a=t.slice9Indices.length,l=e.width-(t.slice9offsets.x+t.slice9offsets.width)/i,h=e.height-(t.slice9offsets.y+t.slice9offsets.height)/r;if(l<0&&(l=0,i=(t.slice9offsets.x+t.slice9offsets.width)/e.width),h<0&&(h=0,r=(t.slice9offsets.y+t.slice9offsets.height)/e.height),o){for(var c=new Uint8Array(8*t.positions.count);f<2*t.positions.count;)c[f]=s[f++],c[f]=s[f++];var u,p=new AttributesBuffer(8,t.positions.count);p.bufferView=c,(u=new TriangleElements(p)).setPositions(new Float2Attributes(p)),u.slice9offsets=t.slice9offsets,u.initialSlice9Positions=t.initialSlice9Positions,u.slice9Indices=t.slice9Indices,s=u.positions.get(u.positions.count),f=0}else s=t.positions.get(t.positions.count);var d,f=0;if(n){for((d=[]).length=2*t.positions.count;f<2*t.positions.count;)d[f]=s[f++],d[f]=s[f++];t.initialSlice9Positions=d}else d=t.initialSlice9Positions;var _=t.slice9Indices,g=0;f=0;var m=[];m.length=3;var y=[];y.length=3,m[0]=e.x,m[1]=e.x+t.slice9offsets.x/i,m[2]=e.x+t.slice9offsets.x/i+l,y[0]=e.y,y[1]=e.y+t.slice9offsets.y/r,y[2]=e.y+t.slice9offsets.y/r+h;var v=-1,b=0,x=0,A=0,E=0,S=0;for(g=0;g<a;g++)for(2==v&&(b++,v=-1),x=1==b?l:1/i,A=1==++v?h:1/r,E=m[b],S=y[v];f<_[g];)s[f]=E+d[f++]*x,s[f]=S+d[f++]*A;return o?(u.positions.invalidate(),u):(t.positions.invalidate(),t)},t}(),ElementsBase=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._customAttributesNames=new Array,i._customAttributes=new Object,i._autoDeriveNormals=!0,i._autoDeriveTangents=!0,i._numElements=0,i._numVertices=0,i._verticesDirty=new Object,i._invalidateVertices=new Object,i.usages=0,i._concatenatedBuffer=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"concatenatedBuffer",{get:function(){return this._concatenatedBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),e.prototype.getCustomAtributesNames=function(){return this._customAttributesNames},e.prototype.getCustomAtributes=function(t){return this._customAttributes[t]},Object.defineProperty(e.prototype,"numElements",{get:function(){return this._numElements},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"condensedIndexLookUp",{get:function(){return this._condensedIndexLookUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoDeriveNormals",{get:function(){return this._autoDeriveNormals},set:function(t){this._autoDeriveNormals!=t&&(this._autoDeriveNormals=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoDeriveTangents",{get:function(){return this._autoDeriveTangents},set:function(t){this._autoDeriveTangents!=t&&(this._autoDeriveTangents=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCondensedIndices",{get:function(){return this._useCondensedIndices},set:function(t){this._useCondensedIndices!=t&&(this._useCondensedIndices=t)},enumerable:!0,configurable:!0}),e.prototype.copyTo=function(t){for(var e in this.indices&&t.setIndices(this.indices.clone()),this._customAttributes)t.setCustomAttributes(e,this.getCustomAtributes(e).clone())},e.prototype.dispose=function(){for(var t in this.clear(),this._indices&&(this._indices.dispose(),this._indices=null),this._customAttributes)this._customAttributes[t].dispose(),delete this._customAttributes},e.prototype.setIndices=function(t,e){void 0===e&&(e=0),t instanceof Short3Attributes?(this._indices&&this.clearIndices(),this._indices=t):t?(this._indices||(this._indices=new Short3Attributes),this._indices.set(t,e)):this._indices&&(this._indices.dispose(),this._indices=null,this.clearIndices()),this._indices?(this._numElements=this._indices.count,this.invalidateIndices()):this._numElements=0},e.prototype.setCustomAttributes=function(t,e,i){if(void 0===i&&(i=0),e!=this._customAttributes[t]){if(e instanceof AttributesView)this.clearVertices(this._customAttributes[t]),this._customAttributes[t]=e;else if(e)this._customAttributes[t]||(this._customAttributes[t]=new Float3Attributes(this._concatenatedBuffer)),this._customAttributes[t].set(e,i);else if(this._customAttributes[t])return this.clearVertices(this._customAttributes[t]),this._customAttributesNames.splice(this._customAttributesNames.indexOf(t),1),void delete this._customAttributes[t];this.invalidateVertices(this._customAttributes[t]),this._verticesDirty[this._customAttributes[t].id]=!1,-1==this._customAttributesNames.indexOf(t)&&this._customAttributesNames.push(t)}},e.prototype.clone=function(){throw new AbstractMethodError},e.prototype.applyTransformation=function(t,e,i){throw new AbstractMethodError},e.prototype.scale=function(t,e,i){throw new AbstractMethodError},e.prototype.scaleUV=function(t,e,i,r){throw new AbstractMethodError},e.prototype.getBoxBounds=function(t,e,i,r,n,o,s,a){throw new AbstractMethodError},e.prototype.getSphereBounds=function(t,e,i,r,n,o,s,a){throw new AbstractMethodError},e.prototype.hitTestPoint=function(t,e,i,r,n,o,s,a){throw new AbstractMethodError},e.prototype.invalidateIndices=function(){this._invalidateIndices||(this._invalidateIndices=new ElementsEvent(ElementsEvent.INVALIDATE_INDICES,this._indices)),this.dispatchEvent(this._invalidateIndices)},e.prototype.clearIndices=function(){this.dispatchEvent(new ElementsEvent(ElementsEvent.CLEAR_INDICES,this._indices))},e.prototype.invalidateVertices=function(t){t&&!this._verticesDirty[t.id]&&(this._verticesDirty[t.id]=!0,this._invalidateVertices[t.id]||(this._invalidateVertices[t.id]=new ElementsEvent(ElementsEvent.INVALIDATE_VERTICES,t)),this.dispatchEvent(this._invalidateVertices[t.id]))},e.prototype.clearVertices=function(t){t&&(t.dispose(),this.dispatchEvent(new ElementsEvent(ElementsEvent.CLEAR_VERTICES,t)),this._verticesDirty[t.id]=null,this._invalidateVertices[t.id]=null)},e.prototype.testCollision=function(t,e,i,r,n,o,s){throw new AbstractMethodError},e}(AssetBase),TriangleElements=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._faceNormalsDirty=!0,e._faceTangentsDirty=!0,e.hitTestCache=new Object,e}return __extends(e,t),e.prototype.updateSlice9=function(t,e){},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jointsPerVertex",{get:function(){return this._jointsPerVertex},set:function(t){this._jointsPerVertex!=t&&(this._jointsPerVertex=t,this._jointIndices&&(this._jointIndices.dimensions=this._jointsPerVertex),this._jointWeights&&(this._jointWeights.dimensions=this._jointsPerVertex))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions||this.setPositions(new Float3Attributes(this._concatenatedBuffer)),this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normals",{get:function(){return this._normals&&!this._verticesDirty[this._normals.id]||this.setNormals(this._normals),this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tangents",{get:function(){return this._tangents&&!this._verticesDirty[this._tangents.id]||this.setTangents(this._tangents),this._tangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceNormals",{get:function(){return this._faceNormalsDirty&&this.updateFaceNormals(),this._faceNormals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceTangents",{get:function(){return this._faceTangentsDirty&&this.updateFaceTangents(),this._faceTangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uvs",{get:function(){if(!this._uvs&&e.isIE){var t=new AttributesView(Float32Array,2);t.set(this._positions.get(this._positions.count));var i=t.attributesBuffer;this._uvs=new Float2Attributes(i),t.dispose()}return this._uvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jointIndices",{get:function(){return this._jointIndices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jointWeights",{get:function(){return this._jointWeights},enumerable:!0,configurable:!0}),e.prototype.getBoxBounds=function(t,e,i,r,n,o,s,a){return void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=0),void 0===a&&(a=0),TriangleElementsUtils.getBoxBounds(this.positions,this.indices,r,n,o,s||this._numElements||this._numVertices,a)},e.prototype.getSphereBounds=function(t,e,i,r,n,o,s,a){return void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=0),void 0===a&&(a=0),TriangleElementsUtils.getSphereBounds(this.positions,e,i,n,o,s||this._numVertices,a)},e.prototype.hitTestPoint=function(t,e,i,r,n,o,s,a,l,h){return void 0===s&&(s=0),void 0===a&&(a=0),TriangleElementsUtils.hitTest(i,r,0,o,this,s||this._numElements||this._numVertices,a)},e.prototype.setPositions=function(t,e){void 0===e&&(e=0),t!=this._positions&&(t instanceof AttributesView?(this.clearVertices(this._positions),this._positions=t):t?(this._positions||(this._positions=new Float3Attributes(this._concatenatedBuffer)),this._positions.set(t,e)):(this.clearVertices(this._positions),this._positions=new Float3Attributes(this._concatenatedBuffer)),this._numVertices=this._positions.count,this._autoDeriveNormals&&this.invalidateVertices(this._normals),this._autoDeriveTangents&&this.invalidateVertices(this._tangents),this.invalidateVertices(this._positions),this._verticesDirty[this._positions.id]=!1)},e.prototype.setNormals=function(t,e){if(void 0===e&&(e=0),this._autoDeriveNormals)this._normals=ElementsUtils.generateNormals(this.indices,this.faceNormals,this._normals,this._concatenatedBuffer);else{if(t==this._normals)return;if(t instanceof Float3Attributes)this.clearVertices(this._normals),this._normals=t;else if(t)this._normals||(this._normals=new Float3Attributes(this._concatenatedBuffer)),this._normals.set(t,e);else if(this._normals)return this.clearVertices(this._normals),void(this._normals=null)}this.invalidateVertices(this._normals),this._verticesDirty[this._normals.id]=!1},e.prototype.setTangents=function(t,e){if(void 0===e&&(e=0),this._autoDeriveTangents)this._tangents=ElementsUtils.generateTangents(this.indices,this.faceTangents,this.faceNormals,this._tangents,this._concatenatedBuffer);else{if(t==this._tangents)return;if(t instanceof Float3Attributes)this.clearVertices(this._tangents),this._tangents=t;else if(t)this._tangents||(this._tangents=new Float3Attributes(this._concatenatedBuffer)),this._tangents.set(t,e);else if(this._tangents)return this.clearVertices(this._tangents),void(this._tangents=null)}this.invalidateVertices(this._tangents),this._verticesDirty[this._tangents.id]=!1},e.prototype.setUVs=function(t,e){if(void 0===e&&(e=0),t!=this._uvs){if(t instanceof AttributesView)this.clearVertices(this._uvs),this._uvs=t;else if(t)this._uvs||(this._uvs=new Float2Attributes(this._concatenatedBuffer)),this._uvs.set(t,e);else if(this._uvs)return this.clearVertices(this._uvs),void(this._uvs=null);this.invalidateVertices(this._uvs),this._verticesDirty[this._uvs.id]=!1}},e.prototype.setJointIndices=function(t,e){if(void 0===e&&(e=0),t!=this._jointIndices){if(t instanceof AttributesView)this.clearVertices(this._jointIndices),this._jointIndices=t;else if(t){if(this._jointIndices||(this._jointIndices=new AttributesView(Float32Array,this._jointsPerVertex,this._concatenatedBuffer)),this._useCondensedIndices){var i,r=0,n=0,o=new Object;for(this._condensedIndexLookUp=new Array;r<t.length;)null==o[i=t[r]]&&(o[i]=n,this._condensedIndexLookUp[n++]=i),t[r++]=o[i]}this._jointIndices.set(t,e)}else if(this._jointIndices)return this.clearVertices(this._jointIndices),void(this._jointIndices=null);this.invalidateVertices(this._jointIndices),this._verticesDirty[this._jointIndices.id]=!1}},e.prototype.setJointWeights=function(t,e){if(void 0===e&&(e=0),t!=this._jointWeights){if(t instanceof AttributesView)this.clearVertices(this._jointWeights),this._jointWeights=t;else if(t)this._jointWeights||(this._jointWeights=new AttributesView(Float32Array,this._jointsPerVertex,this._concatenatedBuffer)),this._jointWeights.set(t,e);else if(this._jointWeights)return this.clearVertices(this._jointWeights),void(this._jointWeights=null);this.invalidateVertices(this._jointWeights),this._verticesDirty[this._jointWeights.id]=!1}},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._positions&&(this._positions.dispose(),this._positions=null),this._normals&&(this._normals.dispose(),this._normals=null),this._tangents&&(this._tangents.dispose(),this._tangents=null),this._uvs&&(this._uvs.dispose(),this._uvs=null),this._jointIndices&&(this._jointIndices.dispose(),this._jointIndices=null),this._jointWeights&&(this._jointWeights.dispose(),this._jointWeights=null),this._faceNormals&&(this._faceNormals.dispose(),this._faceNormals=null),this._faceTangents&&(this._faceTangents.dispose(),this._faceTangents=null)},e.prototype.setIndices=function(e,i){void 0===i&&(i=0),t.prototype.setIndices.call(this,e,i),this._faceNormalsDirty=!0,this._faceTangentsDirty=!0,this._autoDeriveNormals&&this.invalidateVertices(this._normals),this._autoDeriveTangents&&this.invalidateVertices(this._tangents)},e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e);var i=this._autoDeriveNormals,r=this._autoDeriveTangents;e.autoDeriveNormals=this._autoDeriveNormals=!1,e.autoDeriveTangents=this._autoDeriveTangents=!1,e.setPositions(this.positions.clone()),this.normals&&e.setNormals(this.normals.clone()),this.tangents&&e.setTangents(this.tangents.clone()),this.uvs&&e.setUVs(this.uvs.clone()),e.jointsPerVertex=this._jointsPerVertex,this.jointIndices&&e.setJointIndices(this.jointIndices.clone()),this.jointWeights&&e.setJointWeights(this.jointWeights.clone()),e.autoDeriveNormals=this._autoDeriveNormals=i,e.autoDeriveTangents=this._autoDeriveTangents=r,this.slice9Indices&&(e.originalSlice9Size=this.originalSlice9Size,e.slice9offsets=this.slice9offsets,e.slice9Indices=this.slice9Indices,e.initialSlice9Positions=this.initialSlice9Positions)},e.prototype.clone=function(){var t=new e(this._concatenatedBuffer?this._concatenatedBuffer.clone():null);return this.copyTo(t),t},e.prototype.scaleUV=function(t,e,i,r){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),this.uvs&&ElementsUtils.scale(t,e,0,this.uvs,i||this._numVertices,r)},e.prototype.scale=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),ElementsUtils.scale(t,t,t,this.positions,e||this._numVertices,i)},e.prototype.applyTransformation=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),ElementsUtils.applyTransformation(t,this.positions,this.normals,this.tangents,e||this._numVertices,i)},e.prototype.updateFaceTangents=function(){this._faceTangents=ElementsUtils.generateFaceTangents(this.indices,this.positions,this.uvs||this.positions,this._faceTangents,this.numElements),this._faceTangentsDirty=!1},e.prototype.updateFaceNormals=function(){this._faceNormals=ElementsUtils.generateFaceNormals(this.indices,this.positions,this._faceNormals,this.numElements),this._faceNormalsDirty=!1},e.prototype.testCollision=function(t,e,i,r,n,o,s){void 0===s&&(s=0);var a,l,h,c,u,p,d,f,_,g,m,y,v,b,x,A,E,S,T,P,C,w,D,M,O,I,L,N,F,R,B,V,k,U,j,G,z=e.rayPosition,X=e.rayDirection,H=-1,$=n.bothSides,W=this.positions.get(o,s),q=this.positions.dimensions,Y=this.positions.stride;this.indices&&(o=(G=this.indices.get(this.numElements)).length);for(var K=0;K<o;K+=3)if(G?(l=G[K]*Y,h=G[K+1]*Y,c=G[K+2]*Y):(l=K*Y,h=(K+1)*Y,c=(K+2)*Y),S=W[l],w=W[h]-S,O=W[c]-S,T=W[l+1],D=W[h+1]-T,I=W[c+1]-T,3==q?(P=W[l+2],C=W[h+2],f=D*(L=W[c+2]-P)-(M=C-P)*I,_=M*O-w*L,g=w*I-D*O,f*=N=1/Math.sqrt(f*f+_*_+g*g),_*=N,g*=N):(P=0,C=0,M=0,L=0,f=0,_=0,g=w*I-D*O>0?1:-1),F=f*X.x+_*+X.y+g*X.z,!$&&F<0||$&&0!=F){if(R=-(f*S+_*T+g*P),a=-(f*z.x+_*z.y+g*z.z+R)/F,U=(u=(m=z.x+a*X.x)-S)*w+(p=(y=z.y+a*X.y)-T)*D+(d=(v=z.z+a*X.z)-P)*M,j=u*O+p*I+d*L,b=1/((V=w*w+D*D+M*M)*(k=O*O+I*I+L*L)-(B=w*O+D*I+M*L)*B),!isFinite(b))continue;if(E=b*(-B*U+V*j),(A=b*(k*U-B*j))<0)continue;if(E<0)continue;if(!((x=1-A-E)<0)&&a>0&&a<e.rayEntryDistance){if(H=K/3,e.rayEntryDistance=a,e.position=new Vector3D(m,y,v),e.normal=new Vector3D(f,_,g),this.uvs){var Z=this.uvs.get(this.numVertices),J=this.uvs.stride,Q=G?G[K]*J:K*J,tt=new Vector3D(Z[Q],Z[Q+1]);Q=G?G[K+1]*J:(K+1)*J;var et=new Vector3D(Z[Q],Z[Q+1]);Q=G?G[K+2]*J:(K+2)*J;var it=new Vector3D(Z[Q],Z[Q+1]);e.uv=new Point(x*tt.x+A*et.x+E*it.x,x*tt.y+A*et.y+E*it.y)}if(e.elementIndex=H,!r)return!0}}return H>=0},e.isIE=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g),e.assetType="[asset TriangleElements]",e}(ElementsBase),_Stage_TriangleElements=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._triangleElements=e,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._triangleElements=null},e.prototype._setRenderState=function(e,i,r){t.prototype._setRenderState.call(this,e,i,r),i.normalIndex>=0&&this._triangleElements.autoDeriveNormals&&this._triangleElements.normals,i.tangentIndex>=0&&this._triangleElements.autoDeriveTangents&&this._triangleElements.tangents,i.curvesIndex>=0&&this.activateVertexBufferVO(i.curvesIndex,this._triangleElements.getCustomAtributes("curves")),i.uvIndex>=0&&this.activateVertexBufferVO(i.uvIndex,this._triangleElements.uvs||this._triangleElements.positions),i.secondaryUVIndex>=0&&this.activateVertexBufferVO(i.secondaryUVIndex,this._triangleElements.getCustomAtributes("secondaryUVs")||this._triangleElements.uvs||this._triangleElements.positions),i.normalIndex>=0&&this.activateVertexBufferVO(i.normalIndex,this._triangleElements.normals),i.tangentIndex>=0&&this.activateVertexBufferVO(i.tangentIndex,this._triangleElements.tangents),i.jointIndexIndex>=0&&this.activateVertexBufferVO(i.jointIndexIndex,this._triangleElements.jointIndices),i.jointWeightIndex>=0&&this.activateVertexBufferVO(i.jointIndexIndex,this._triangleElements.jointWeights),this.activateVertexBufferVO(0,this._triangleElements.positions)},e.prototype.draw=function(t,e,i,r,n){if(e.sceneMatrixIndex>=0)e.sceneMatrix.copyFrom(t.renderSceneTransform,!0),e.viewMatrix.copyFrom(i.viewMatrix3D,!0);else{var o=Matrix3D.CALCULATION_MATRIX;o.copyFrom(t.renderSceneTransform),o.append(i.viewMatrix3D),e.viewMatrix.copyFrom(o,!0)}var s=this._stage.context;s.setProgramConstantsFromArray(ContextGLProgramType.VERTEX,e.vertexConstantData),s.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,e.fragmentConstantData),this._indices?this.getIndexBufferGL().draw(ContextGLDrawMode.TRIANGLES,3*n,3*r||this.numIndices):this._stage.context.drawVertices(ContextGLDrawMode.TRIANGLES,n,r||this.numVertices)},e.prototype._pGetOverflowElements=function(){return new e(this._triangleElements,this._stage)},e}(_Stage_ElementsBase),_Render_TriangleElements=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._includeDependencies=function(t){},e.prototype._getVertexCode=function(t,e,i){var r="",n=t.globalPosDependencies>0?i.globalPositionVertex:i.animatedPosition,o=e.getFreeVertexConstant();if(e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),t.viewMatrixIndex=4*o.index,t.projectionDependencies>0){i.projectionFragment=e.getFreeVarying();var s=e.getFreeVertexVectorTemp();r+="m44 "+s+", "+n+", "+o+"\nmov "+i.projectionFragment+", "+s+"\nmov op, "+s+"\n"}else r+="m44 op, "+n+", "+o+"\n";return r},e.prototype._getFragmentCode=function(t,e,i){return""},e}(_Render_ElementsBase);RenderGroup.registerElements(_Render_TriangleElements,TriangleElements),Stage.registerAbstraction(_Stage_TriangleElements,TriangleElements);var LineElementsUtils=function(){function t(){}return t.hitTest=function(t,e,i,r,n,o,s,a){void 0===a&&(a=0);var l,h,c,u,p,d,f,_,g=o.positions,m=g.stride,y=g.get(s,a);o.indices?(l=o.indices.get(s,a),y=g.get(g.count),h=s*o.indices.dimensions):(y=g.get(s,a),h=s);var v=o.hitTestCache[a]||(o.hitTestCache[a]=new HitTestCache),b=v.lastCollisionIndex;if(-1!=b&&b<h){l?(c=l[b]*m,u=l[b+1]*m):(c=b*m,u=(b+1)*m),p=y[c],d=y[c+1],f=y[u];var x=p-t,A=d-e,E=(_=y[u+1])-d,S=-(f-p),T=Math.sqrt(E*E+S*S);if(!(Math.abs(x*E+A*S)>r*T))if(!((z=x*S-A*E)>T*T||z<0))return!0}if(h>150){var P=v.cells,C=P.length?v.divisions:v.divisions=Math.min(Math.ceil(Math.sqrt(h)),32),w=C/n.width,D=C/n.height,M=n.x,O=n.y;if(!P.length){P.length=C*C;for(var I=0;I<h;I+=3){l?(c=l[I]*m,u=l[I+1]*m):(c=I*m,u=(I+1)*m),p=y[c],d=y[c+1],f=y[u],_=y[u+1];for(var L=Math.floor((Math.min(p,f)-M)*w),N=Math.floor((Math.min(d,_)-O)*D),F=Math.floor((Math.max(p,f)-M)*w),R=Math.floor((Math.max(d,_)-O)*D),B=L;B<=F;B++)for(var V=N;V<=R;V++){var k,U=B+V*C;(k=P[U]||(P[U]=new Array)).push(I)}}}if(null==(k=P[Math.floor((t-M)*w)+Math.floor((e-O)*D)*C]))return v.lastCollisionIndex=-1,!1;for(var j=k.length,G=0;G<j;G++){I=k[G];l?(c=l[I]*m,u=l[I+1]*m):(c=I*m,u=(I+1)*m),p=y[c],d=y[c+1],f=y[u];x=p-t,A=d-e,E=(_=y[u+1])-d,S=-(f-p),T=Math.sqrt(E*E+S*S);if(!(Math.abs(x*E+A*S)>r*T))if(!((z=x*S-A*E)>T*T||z<0))return v.lastCollisionIndex=I,!0}return v.lastCollisionIndex=-1,!1}for(I=0;I<h;I+=6){l?(c=l[I]*m,u=l[I+1]*m):(c=I*m,u=(I+1)*m),p=y[c],d=y[c+1],f=y[u];var z;x=p-t,A=d-e,E=(_=y[u+1])-d,S=-(f-p),T=Math.sqrt(E*E+S*S);if(!(Math.abs(x*E+A*S)>r*T))if(!((z=x*S-A*E)>T*T||z<0))return v.lastCollisionIndex=I,!0}return v.lastCollisionIndex=-1,!1},t.getBoxBounds=function(t,e,i,r,n,o,s,a){var l;void 0===a&&(a=0);var h,c,u=t.dimensions,p=t.stride,d=0,f=0,_=0,g=0;if(e?(c=s*e.dimensions,h=e.get(s,a),l=t.get(t.count)):(c=s,l=t.get(s,a)),0==c)return o;var m,y,v,b,x=0;i&&(b=i._rawData);for(x=0;x<c;x+=3)m=h?h[x]*p:x*p,i?6==u?(y=l[m]*b[0]+l[m+1]*b[4]+l[m+2]*b[8]+b[12],v=l[m]*b[1]+l[m+1]*b[5]+l[m+2]*b[9]+b[13],l[m]*b[2]+l[m+1]*b[6]+l[m+2]*b[10]+b[14]):(y=l[m]*b[0]+l[m+1]*b[4]+b[12],v=l[m]*b[1]+l[m+1]*b[5]+b[13]):(y=l[m],v=l[m+1],6==u?l[m+2]:0),0==x?(_=d=y,g=f=v):(y<d?d=y:y>_&&(_=y),v<f?f=v:v>g&&(g=v));var A=i?r.x*b[0]+r.y*b[4]:r.x,E=i?r.x*b[1]+r.y*b[5]:r.y,S=new Box(d-A,f-E);return S.right=_+A,S.bottom=g+E,S.union(o,o||n)},t.getSphereBounds=function(t,e,i,r,n,o,s){void 0===s&&(s=0);for(var a,l,h,c,u=t.get(o,s),p=t.dimensions,d=t.stride,f=0,_=o*d,g=0;g<_;g+=d)f<(a=(l=u[g]-e.x)*l+(h=u[g+1]-e.y)*h+(c=6==p?u[g+2]-e.z:-e.z)*c)&&(f=a);return null==n&&(n=new Sphere),n.x=e.x,n.y=e.y,n.z=e.z,n.radius=Math.sqrt(f),n},t}(),LineElements=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this,e)||this;return i._thicknessScale=new Vector3D,i.hitTestCache=new Object,i._positions=new AttributesView(Float32Array,6,e),i}return __extends(e,t),e.prototype.getThicknessScale=function(t,e,i){return i||this.stroke.scaleMode!=LineScaleMode.HAIRLINE?(e?this._thicknessScale.copyFrom(e.transform.concatenatedMatrix3D.decompose()[3]):this._thicknessScale.identity(),this._thicknessScale.x*=t.focalLength*t.pixelRatio/1e3,this._thicknessScale.y*=t.focalLength/1e3,this.stroke&&this.stroke.scaleMode==LineScaleMode.NORMAL?(this._thicknessScale.x=!i||this.stroke.half_thickness*this._thicknessScale.x>.5?this.stroke.half_thickness:.5/this._thicknessScale.x,this._thicknessScale.y=!i||this.stroke.half_thickness*this._thicknessScale.y>.5?this.stroke.half_thickness:.5/this._thicknessScale.y):this.stroke&&this.stroke.scaleMode!=LineScaleMode.HAIRLINE||(this._thicknessScale.x=.5/this._thicknessScale.x,this._thicknessScale.y=.5/this._thicknessScale.y)):this._thicknessScale.identity(),this._thicknessScale},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colors",{get:function(){return this._colors||this.setColors(this._colors),this._colors},enumerable:!0,configurable:!0}),e.prototype.getBoxBounds=function(t,e,i,r,n,o,s,a){return void 0===e&&(e=null),void 0===i&&(i=!1),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=0),void 0===a&&(a=0),LineElementsUtils.getBoxBounds(this.positions,this.indices,r,this.getThicknessScale(t,e,i),n,o,s||this._numElements||this._numVertices,a)},e.prototype.getSphereBounds=function(t,e,i,r,n,o,s,a){return void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=0),void 0===a&&(a=0),LineElementsUtils.getSphereBounds(this.positions,e,i,n,o,s||this._numVertices,a)},e.prototype.hitTestPoint=function(t,e,i,r,n,o,s,a,l,h){void 0===s&&(s=0),void 0===a&&(a=0);var c=this.getThicknessScale(t,e,!0),u=(c.x+c.y)/2;return LineElementsUtils.hitTest(i,r,0,u,o,this,s||this._numElements||this._numVertices,a)},e.prototype.setPositions=function(t,e){if(void 0===e&&(e=0),t instanceof AttributesView)this.clearVertices(this._positions),this._positions=t;else if(t){for(var i=0,r=0,n=0,o=new Float32Array(4*t.length),s=new Uint16Array(t.length);i<t.length;)if(n/6&1?(o[n]=t[i+3],o[n+1]=t[i+4],o[n+2]=t[i+5],o[n+3]=t[i],o[n+4]=t[i+1],o[n+5]=t[i+2]):(o[n]=t[i],o[n+1]=t[i+1],o[n+2]=t[i+2],o[n+3]=t[i+3],o[n+4]=t[i+4],o[n+5]=t[i+5]),n+=6,4==++r){var a=n/6-4;s.set([a,a+1,a+2,a+3,a+2,a+1],i),r=0,i+=6}this._positions.set(o,4*e),this.setIndices(s,e)}else this.clearVertices(this._positions),this._positions=new AttributesView(Float32Array,6,this._concatenatedBuffer);this._numVertices=this._positions.count,this.invalidateVertices(this._positions),this._verticesDirty[this._positions.id]=!1},e.prototype.setThickness=function(t,e){if(void 0===e&&(e=0),t instanceof Float1Attributes)this._thickness=t;else if(t){this._thickness||(this._thickness=new Float1Attributes(this._concatenatedBuffer));for(var i=0,r=0,n=0,o=new Float32Array(4*t.length);i<t.length;)o[n]=1&Math.floor(.5*n+.5)?-t[i]:t[i],4==++r&&(r=0,i++),n++;this._thickness.set(o,4*e)}else this._thickness&&(this._thickness.dispose(),this._thickness=null);this.invalidateVertices(this._thickness),this._verticesDirty[this._thickness.id]=!1},e.prototype.setColors=function(t,e){if(void 0===e&&(e=0),t){if(t==this._colors)return;if(t instanceof Byte4Attributes)this.clearVertices(this._colors),this._colors=t;else{this._colors||(this._colors=new Byte4Attributes(this._concatenatedBuffer));for(var i=0,r=0,n=0,o=new Uint8Array(4*t.length);i<t.length;)n/4&1?(o[n]=t[i+4],o[n+1]=t[i+5],o[n+2]=t[i+6],o[n+3]=t[i+7]):(o[n]=t[i],o[n+1]=t[i+1],o[n+2]=t[i+2],o[n+3]=t[i+3]),4==++r&&(r=0,i+=8),n+=4;this._colors.set(o,4*e)}}else this._colors=ElementsUtils.generateColors(this.indices,this._colors,this._concatenatedBuffer,this._numVertices);this.invalidateVertices(this._colors),this._verticesDirty[this._colors.id]=!1},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._positions.dispose(),this._positions=null,this._thickness&&(this._thickness.dispose(),this._thickness=null),this._colors&&(this._colors.dispose(),this._colors=null)},e.prototype.clone=function(){var t=new e(this._concatenatedBuffer?this._concatenatedBuffer.clone():null);return t.setIndices(this.indices.clone()),t.setPositions(this._positions.clone()),t.setThickness(this._thickness.clone()),t.setColors(this._colors.clone()),t},e.prototype.testCollision=function(t,e,i,r,n,o,s){void 0===s&&(s=0);var a=this.getThicknessScale(t,e.entity,!0),l=(a.x+a.y)/2,h=-e.rayPosition.z/e.rayDirection.z,c=new Vector3D(e.rayPosition.x+h*e.rayDirection.x,e.rayPosition.y+h*e.rayDirection.y);return!!LineElementsUtils.hitTest(c.x,c.y,0,l,i,this,this._numElements,s)&&(e.rayEntryDistance=h,e.position=c,e.normal=new Vector3D(0,0,1),!0)},e.assetType="[asset LineElements]",e}(ElementsBase),_Stage_LineElements=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._scale=new Vector3D,r._thickness=1,r._lineElements=e,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._lineElements=null},e.prototype._setRenderState=function(e,i,r){t.prototype._setRenderState.call(this,e,i,r);var n=e.renderGroup.getRenderElements(e.stageElements.elements);i.colorBufferIndex>=0&&this.activateVertexBufferVO(i.colorBufferIndex,this._lineElements.colors),this.activateVertexBufferVO(0,this._lineElements.positions,3),this.activateVertexBufferVO(n.secondaryPositionIndex,this._lineElements.positions,3,12),this.activateVertexBufferVO(n.thicknessIndex,this._lineElements.thickness),i.uvIndex>=0&&this.activateVertexBufferVO(i.uvIndex,this._lineElements.positions,2);var o=n._dataIndex,s=i.vertexConstantData;s[o+4]=1,s[o+5]=1,s[o+6]=1,s[o+7]=1,s[o+10]=-1,this._scale.copyFrom(e.sourceEntity.transform.concatenatedMatrix3D.decompose()[3]);var a=this._lineElements.stroke;a&&a.scaleMode==LineScaleMode.NORMAL?(s[o+12]=a.half_thickness*this._scale.x*this._thickness/1e3>.5/(r.focalLength*r.pixelRatio)?this._scale.x*this._thickness/1e3:.5/(a.half_thickness*r.focalLength*r.pixelRatio),s[o+13]=a.half_thickness*this._scale.y*this._thickness/1e3>.5/r.focalLength?this._scale.y*this._thickness/1e3:.5/(a.half_thickness*r.focalLength)):a&&a.scaleMode!=LineScaleMode.HAIRLINE?(s[o+12]=this._thickness/Math.min(r.width,r.height),s[o+13]=this._thickness/Math.min(r.width,r.height)):(s[o+12]=this._thickness/(r.focalLength*r.pixelRatio),s[o+13]=this._thickness/r.focalLength),s[o+14]=r.projection.near;this._stage.context},e.prototype.draw=function(t,e,i,r,n){var o=this._stage.context;e.viewMatrix.copyFrom(i.frustumMatrix3D,!0);var s=Matrix3D.CALCULATION_MATRIX;s.copyFrom(t.sourceEntity.transform.concatenatedMatrix3D),s.append(i.projection.transform.inverseConcatenatedMatrix3D),e.sceneMatrix.copyFrom(s,!0),o.setProgramConstantsFromArray(ContextGLProgramType.VERTEX,e.vertexConstantData),o.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,e.fragmentConstantData),this._indices?this.getIndexBufferGL().draw(ContextGLDrawMode.TRIANGLES,3*n,3*r||this.numIndices):this._stage.context.drawVertices(ContextGLDrawMode.TRIANGLES,n,r||this.numVertices)},e.prototype._pGetOverflowElements=function(){return new e(this._lineElements,this._stage)},e}(_Stage_ElementsBase),_Render_LineElements=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.secondaryPositionIndex=-1,e.thicknessIndex=-1,e}return __extends(e,t),e.prototype._includeDependencies=function(t){},e.prototype._getVertexCode=function(t,e,i){var r=t.globalPosDependencies>0?i.globalPositionVertex:i.animatedPosition,n=e.getFreeVertexAttribute();this.secondaryPositionIndex=n.index;var o=e.getFreeVertexAttribute();this.thicknessIndex=o.index;var s=e.getFreeVertexConstant();e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),t.viewMatrixIndex=4*s.index;var a=e.getFreeVertexConstant();this._dataIndex=4*a.index;var l=e.getFreeVertexConstant(),h=e.getFreeVertexConstant(),c=e.getFreeVertexConstant(),u=e.getFreeVertexConstant();e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),t.sceneMatrixIndex=4*u.index;var p=e.getFreeVertexVectorTemp();e.addVertexTempUsages(p,1);var d=e.getFreeVertexVectorTemp();e.addVertexTempUsages(d,1);var f=e.getFreeVertexVectorTemp();e.addVertexTempUsages(f,1);var _=e.getFreeVertexVectorTemp();e.addVertexTempUsages(_,1);var g=e.getFreeVertexVectorTemp();e.addVertexTempUsages(g,1);var m=e.getFreeVertexVectorTemp();e.addVertexTempUsages(m,1);var y="m44 "+p+", "+r+", "+u+"\t\t\t\nm44 "+d+", "+n+", "+u+"\t\t\t\nsub "+f+", "+d+", "+p+" \t\t\t\nslt "+_+".x, "+p+".z, "+c+".z\t\t\t\nsub "+_+".y, "+l+".x, "+_+".x\t\t\t\nadd "+m+".x, "+p+".z, "+c+".z\t\t\t\nsub "+m+".y, "+p+".z, "+d+".z\t\t\t\nseq "+m+".z, "+m+".y "+h+".x\t\t\t\nadd "+m+".y, "+m+".y, "+m+".z\t\t\t\ndiv "+m+".z, "+m+".x, "+m+".y\t\t\t\nmul "+m+".xyz, "+m+".zzz, "+f+".xyz\t\nadd "+g+".xyz, "+p+".xyz, "+m+".xyz\t\nmov "+g+".w, "+l+".x\t\t\t\nmul "+p+", "+p+", "+_+".yyyy\t\t\t\nmul "+g+", "+g+", "+_+".xxxx\t\t\t\nadd "+p+", "+p+", "+g+"\t\t\t\t\nnrm "+f+".xyz, "+f+".xyz\t\t\t\nnrm "+_+".xyz, "+p+".xyz\t\t\t\nmov "+_+".w, "+l+".x\t\t\t\t\ncrs "+g+".xyz, "+f+", "+_+"\t\t\t\nnrm "+g+".xyz, "+g+".xyz\t\t\t\nmul "+g+".xyz, "+g+".xyz, "+o+".xxx\t\nmov "+g+".w, "+l+".x\t\t\t\ndp3 "+m+".x, "+p+", "+h+"\t\t\t\nmul "+g+".xyz, "+g+".xyz, "+m+".xxx\t\nmul "+g+".xyz, "+g+".xyz, "+c+".xy\t\nadd "+p+".xyz, "+p+".xyz, "+g+".xyz\t\nm44 op, "+p+", "+s+"\t\t\t\n";return e.removeVertexTempUsage(p),e.removeVertexTempUsage(d),e.removeVertexTempUsage(f),e.removeVertexTempUsage(_),e.removeVertexTempUsage(g),e.removeVertexTempUsage(m),y},e.prototype._getFragmentCode=function(t,e,i){return""},e}(_Render_ElementsBase);RenderGroup.registerElements(_Render_LineElements,LineElements),Stage.registerAbstraction(_Stage_LineElements,LineElements);var Shape=function(t){function e(e,i,r,n,o){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=0),void 0===o&&(o=0);var s=t.call(this)||this;return s.usages=0,s._onInvalidatePropertiesDelegate=function(t){return s._onInvalidateProperties(t)},s._onInvalidateVerticesDelegate=function(t){return s._onInvalidateVertices(t)},s._elements=e,s._material=i,s._style=r,s._style&&s._style.addEventListener(StyleEvent.INVALIDATE_PROPERTIES,s._onInvalidatePropertiesDelegate),s.count=n,s.offset=o,s}return __extends(e,t),e.getShape=function(t,i,r,n,o){if(void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=0),void 0===o&&(o=0),e._pool.length){var s=e._pool.pop();return s.elements=t,s.material=i,s.style=r,s.count=n,s.offset=o,s}return new e(t,i,r,n,o)},e.clearPool=function(){e._pool=[]},Object.defineProperty(e.prototype,"elements",{get:function(){return this._elements},set:function(t){this._elements!=t&&(this._elements&&(this._elements.removeEventListener(ElementsEvent.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate),this._elements.usages--,this._elements.usages||this._elements.dispose()),this._elements=t,this._elements&&(this._elements.addEventListener(ElementsEvent.INVALIDATE_VERTICES,this._onInvalidateVerticesDelegate),this._elements.usages++),this.invalidateElements())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(t){this._material!=t&&(this._material=t,this.invalidateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){this._style!=t&&(this._style&&this._style.removeEventListener(StyleEvent.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate),this._style=t,this._style&&this._style.addEventListener(StyleEvent.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate),this.invalidateStyle())},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.clear.call(this),this.usages=0,this.elements=null,this.material=null,this.style=null,this.particleCollection=null,e._pool.push(this)},e.prototype.invalidateElements=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_ELEMENTS,this))},e.prototype.invalidateMaterial=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_MATERIAL,this))},e.prototype.invalidateStyle=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_STYLE,this))},e.prototype._onInvalidateProperties=function(t){this.invalidateStyle()},e.prototype._onInvalidateVertices=function(t){t.attributesView==t.target.positions&&this.invalidate()},e.prototype.applyTransformation=function(t){this._elements.applyTransformation(t,this.count,this.offset)},e.prototype.scale=function(t){this._elements.scale(t,this.count,this.offset)},e.prototype.scaleUV=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1),this._elements.scaleUV(t,e,this.count,this.offset)},e._pool=new Array,e.assetType="[asset Shape]",e}(AssetBase),_Render_Shape=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.shape=e,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this.shape=null},e.prototype._getStageElements=function(){return this._offset=this.shape.offset,this._count=this.shape.count,this._stage.getAbstraction(this.sourceEntity.animator?this.sourceEntity.animator.getRenderableElements(this,this.shape.elements):this.shape.elements)},e.prototype._getRenderMaterial=function(){return this.renderGroup.getRenderElements(this.shape.elements).getAbstraction(this._asset.material||this.sourceEntity.material||this.getDefaultMaterial())},e.prototype._getStyle=function(){return this._asset.style||this.sourceEntity.style},e.prototype.getDefaultMaterial=function(){return this.stageElements.elements instanceof LineElements?MaterialUtils.getDefaultColorMaterial():MaterialUtils.getDefaultTextureMaterial()},e}(_Render_RenderableBase),_Pick_Shape=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._orientedBoxBoundsDirty=!0,r._orientedSphereBoundsDirty=!0,r._onInvalidateElementsDelegate=function(t){return r._onInvalidateElements(t)},r._asset.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,r._onInvalidateElementsDelegate),r}return __extends(e,t),e.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e),this._orientedBoxBoundsDirty=!0,this._orientedSphereBoundsDirty=!0},e.prototype._onInvalidateElements=function(t){this._orientedBoxBoundsDirty=!0,this._orientedSphereBoundsDirty=!0},e.prototype.onClear=function(e){this._asset.removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate),t.prototype.onClear.call(this,e)},e.prototype.hitTestPoint=function(t,e,i){var r=this.getBoxBounds();return!(null==r||!r.contains(t,e,i))&&this._asset.elements.hitTestPoint(this._view,this.sourceEntity,t,e,i,r,this._asset.count,this._asset.offset)},e.prototype.getBoxBounds=function(t,e,i,r){return void 0===t&&(t=null),void 0===e&&(e=!0),void 0===i&&(i=null),void 0===r&&(r=null),t?this._asset.elements.getBoxBounds(this._view,this.sourceEntity,e,t,i,r,this._asset.count,this._asset.offset):(this._orientedBoxBoundsDirty&&(this._orientedBoxBoundsDirty=!1,this._orientedBoxBounds=this._asset.elements.getBoxBounds(this._view,this.sourceEntity,e,null,this._orientedBoxBounds,null,this._asset.count,this._asset.offset)),null!=this._orientedBoxBounds&&(r=this._orientedBoxBounds.union(r,r||i)),r)},e.prototype.getSphereBounds=function(t,e,i,r,n){return void 0===e&&(e=null),void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=null),e?this._asset.elements.getSphereBounds(this._view,t,e,i,r,n,this._asset.count,this._asset.offset):(this._orientedSphereBoundsDirty&&(this._orientedSphereBoundsDirty=!1,this._orientedSphereBounds=this._asset.elements.getSphereBounds(this._view,t,null,i,this._orientedSphereBounds,null,this._asset.count,this._asset.offset)),null!=this._orientedSphereBounds&&(n=this._orientedSphereBounds.union(n,n||r)),n)},e.prototype.testCollision=function(t,e){var i=this.getBoxBounds();return!(null==i||!i.rayIntersection(t.rayPosition,t.rayDirection))&&this._asset.elements.testCollision(this._view,t,i,e,this._asset.material||t.entity.material,this._asset.count||this._asset.elements.numVertices,this._asset.offset)},e}(_Pick_PickableBase);RenderEntity.registerRenderable(_Render_Shape,Shape),PickEntity.registerPickable(_Pick_Shape,Shape);var GraphicsPathWinding=function(){function t(){}return t.EVEN_ODD="evenOdd",t.NON_ZERO="nonZero",t}(),GraphicsPathCommand=function(){function t(){}return t.NO_OP=0,t.MOVE_TO=1,t.LINE_TO=2,t.CURVE_TO=3,t.BUILD_JOINT=13,t.BUILD_ROUND_JOINT=14,t.WIDE_LINE_TO=4,t.WIDE_MOVE_TO=5,t.CUBIC_CURVE=6,t}(),GraphicsPath=function(){function t(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=GraphicsPathWinding.EVEN_ODD),this._orientedBoxBoundsDirty=!0,this._startMerge=-1,this._endMerge=-1,this._mergeSource=-1,this._mergetarget=-1,this._connectedIdx=[],this._positionOffset=[],this.forceClose=!1,this._cache={},this._cacheSharedSegments={},this._data=[],this._commands=[],this._style=null,this.verts=[],this._positions=[],null!=t&&null!=e?(this._data[0]=e,this._commands[0]=t):(this._data[0]=[],this._commands[0]=[]),this._startPoint=new Point,this._cur_point=new Point,this._winding_rule=i,this._winding_directions=[]}return Object.defineProperty(t.prototype,"data_type",{get:function(){return t.data_type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(t){this._style=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return null==this._style?null:this._style.data_type==GraphicsFillStyle.data_type?this._style:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return null==this._style?null:this._style.data_type==GraphicsStrokeStyle.data_type?this._style:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commands",{get:function(){return this._commands},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t.prototype.cacheSegment=function(t,e,i,r,n,o,s,a,l){void 0===a&&(a=null),void 0===l&&(l=null);var h=i.toString()+"#";h+=r>o?r.toString()+"#"+o.toString():o.toString()+"#"+r.toString(),h+=n>s?n.toString()+"#"+s.toString():s.toString()+"#"+n.toString(),null!=a&&null!=l&&(h+=a.toString()+"#"+l.toString());var c=this._cache[h];null==c&&(this._cache[h]=c=[]),c.push(t),c.push(e),c.length>2&&(this._cacheSharedSegments[h]=c)},t.prototype.curveTo=function(t,e,i,r){if(t!=i||e!=r)return this._cur_point.x!=i||this._cur_point.y!=r||this._cur_point.x==t&&this._cur_point.y==e?void((this._cur_point.x==i&&this._cur_point.y==r||this._cur_point.x!=t||this._cur_point.y!=e)&&(this._cur_point.x!=i||this._cur_point.y!=r||this._cur_point.x!=t||this._cur_point.y!=e)?(0==this._commands[this._commands.length-1].length&&(this._commands[this._commands.length-1].push(GraphicsPathCommand.MOVE_TO),this._data[this._data.length-1].push(this._cur_point.x),this._data[this._data.length-1].push(this._cur_point.y)),this._commands[this._commands.length-1].push(GraphicsPathCommand.CURVE_TO),this._data[this._data.length-1].push(t),this._data[this._data.length-1].push(e),this._data[this._data.length-1].push(i),this._data[this._data.length-1].push(r),this._cur_point.x=i,this._cur_point.y=r):this.lineTo(i,r)):(this.lineTo(t,e),void this.moveTo(i,r));this.lineTo(t,e)},t.prototype.cubicCurveTo=function(t,e,i,r,n,o){console.log("cubicCurveTo not yet fully supported."),this._cur_point.x==n&&this._cur_point.y==o||(0==this._commands[this._commands.length-1].length&&(this._commands[this._commands.length-1].push(GraphicsPathCommand.MOVE_TO),this._data[this._data.length-1].push(this._cur_point.x),this._data[this._data.length-1].push(this._cur_point.y)),this._commands[this._commands.length-1].push(GraphicsPathCommand.CURVE_TO),this._data[this._data.length-1].push(t),this._data[this._data.length-1].push(e),this._data[this._data.length-1].push(n),this._data[this._data.length-1].push(o),this._cur_point.x=n,this._cur_point.y=o)},t.prototype.lineTo=function(t,e){this._cur_point.x==t&&this._cur_point.y==e||(0==this._commands[this._commands.length-1].length&&(this._commands[this._commands.length-1].push(GraphicsPathCommand.MOVE_TO),this._data[this._data.length-1].push(this._cur_point.x),this._data[this._data.length-1].push(this._cur_point.y)),this._commands[this._commands.length-1].push(GraphicsPathCommand.LINE_TO),this._data[this._data.length-1].push(t),this._data[this._data.length-1].push(e),this._cur_point.x=t,this._cur_point.y=e)},t.prototype.moveTo=function(t,e){this._cur_point.x==t&&this._cur_point.y==e||(this._commands[this._commands.length-1].length>0&&(this._commands.push([GraphicsPathCommand.MOVE_TO]),this._data.push([t,e])),this._startPoint.x=t,this._startPoint.y=e,this._cur_point.x=t,this._cur_point.y=e)},t.prototype.wideLineTo=function(t,e){},t.prototype.wideMoveTo=function(t,e){},t.prototype.mergeContours=function(){var t=-1;if(this._startMerge==this._endMerge){var e=this._connectedIdx[this._mergetarget][this._startMerge],i=this.data[this._mergetarget][this._positionOffset[this._mergetarget][this._startMerge]-2],r=this.data[this._mergetarget][this._positionOffset[this._mergetarget][this._startMerge]-1],n=this.data[this._mergetarget][this._positionOffset[this._mergetarget][this._startMerge]],o=this.data[this._mergetarget][this._positionOffset[this._mergetarget][this._startMerge]+1],s=this.data[this._mergeSource][this._positionOffset[this._mergeSource][e]],a=this.data[this._mergeSource][this._positionOffset[this._mergeSource][e]+1],l=this.data[this._mergeSource][this._positionOffset[this._mergeSource][e]+2],h=this.data[this._mergeSource][this._positionOffset[this._mergeSource][e]+3];i==s&&r==a&&n==l&&o==h&&(t=1)}var c=this._connectedIdx[this._mergetarget][this._startMerge],u=this._connectedIdx[this._mergetarget][this._endMerge],p=Math.abs(this._startMerge-this._endMerge)+1,d=this._commands[this._mergeSource].length-p;t=-1;c>u&&(t=1);for(var f,_=c,g=0,m=0,y=0,v=0,b=0,x=0,A=0,E=0,S=(this._positionOffset[this._mergeSource][c],0);S<d;S++)switch((_+=t)>=this._commands[this._mergeSource].length&&(_-=this._commands[this._mergeSource].length),_<0&&(_+=this._commands[this._mergeSource].length),this._commands[this._mergeSource][_]){case GraphicsPathCommand.LINE_TO:g=this.data[this._mergeSource][this._positionOffset[this._mergeSource][_]],m=this.data[this._mergeSource][this._positionOffset[this._mergeSource][_]+1],this._positions[this._mergetarget].push(g),this._positions[this._mergetarget].push(m),y=g,v=m;break;case GraphicsPathCommand.CURVE_TO:for(b=this.data[this._mergeSource][this._positionOffset[this._mergeSource][_]],x=this.data[this._mergeSource][this._positionOffset[this._mergeSource][_]+1],g=this.data[this._mergeSource][this._positionOffset[this._mergeSource][_]+2],m=this.data[this._mergeSource][this._positionOffset[this._mergeSource][_]+3],f=[],GraphicsFactoryHelper.tesselateCurve(y,v,b,x,g,m,f),E=f.length,A=0;A<E;A+=2)this._positions[this._mergetarget].push(f[A]),this._positions[this._mergetarget].push(f[A+1]);y=g,v=m}this._startMerge=-1,this._endMerge=-1,this._mergetarget=-1,this._mergeSource=-1},t.prototype.prepare=function(){var t,e,i,r,n,o,s,a,l,h,c,u=[],p=[],d=0,f=0,_=0,g=this.commands.length;for(i=0;i<g;i++)t=this.commands[i],p[i]=!1,e=this.data[i],this._positions[i]=[],u[i]=[],this._connectedIdx[i]=[],this._positionOffset[i]=[],e[0]==e[e.length-2]&&e[1]==e[e.length-1]||this.forceClose&&(t[t.length]=GraphicsPathCommand.LINE_TO,e[e.length]=e[0],e[e.length]=e[1]);g=this.commands.length;for(i=0;i<g;i++)for(t=this.commands[i],f=0,o=(e=this.data[i])[f++],s=e[f++],a=0,l=0,h=0,_=0,this._positions[i].push(o),this._positions[i].push(s),this._startMerge=-1,this._endMerge=-1,this._mergetarget=-1,this._mergeSource=-1,f=0,o=e[f++],s=e[f++],r=1;r<t.length;r++)switch(t[r]){case GraphicsPathCommand.MOVE_TO:console.log("ERROR ! ONLY THE FIRST COMMAND FOR A CONTOUR IS ALLOWED TO BE A 'MOVE_TO' COMMAND");break;case GraphicsPathCommand.LINE_TO:a=e[f++],l=e[f++],this._positions[i].push(a),this._positions[i].push(l),o=a,s=l;break;case GraphicsPathCommand.CURVE_TO:for(h=e[f++],_=e[f++],a=e[f++],l=e[f++],c=[],GraphicsFactoryHelper.tesselateCurve(o,s,h,_,a,l,c),d=c.length,n=0;n<d;n+=2)this._positions[i].push(c[n]),this._positions[i].push(c[n+1]);o=a,s=l}},t.prototype.invalidate=function(){this._orientedBoxBoundsDirty=!0},t.prototype.getBoxBounds=function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),t?this._internalGetBoxBounds(t,e,i):(this._orientedBoxBoundsDirty&&(this._orientedBoxBoundsDirty=!1,this._orientedBoxBounds=this._internalGetBoxBounds(null,this._orientedBoxBounds,null)),null!=this._orientedBoxBounds&&(i=this._orientedBoxBounds.union(i,i||e)),i)},t.prototype._internalGetBoxBounds=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null);var r=0,n=0,o=0,s=0,a=this._positions.length;if(0==a)return i;var l,h,c,u=0,p=0,d=this._positions[p++],f=d.length;for(t&&(c=t._rawData),null==i?(i=e||new Box,t?(l=d[u]*c[0]+d[u+1]*c[4]+c[12],h=d[u]*c[1]+d[u+1]*c[5]+c[13]):(l=d[u],h=d[u+1]),o=r=l,s=n=h,u+=2):(o=(r=i.x)+i.width,s=(n=i.y)+i.height);u<f;u+=2)t?(l=d[u]*c[0]+d[u+1]*c[4]+c[12],h=d[u]*c[1]+d[u+1]*c[5]+c[13]):(l=d[u],h=d[u+1]),l<r?r=l:l>o&&(o=l),h<n?n=h:h>s&&(s=h),u>=f-2&&p<a&&(u=0,f=(d=this._positions[p++]).length);return i.width=o-(i.x=r),i.height=s-(i.y=n),i.depth=0,i},t.data_type="[graphicsdata path]",t}(),GraphicsFactoryStrokes=function(){function t(){}return t.draw_pathes=function(e){var i=e.queued_stroke_pathes.length,r=0;for(r=0;r<i;r++){var n,o=e.queued_stroke_pathes[r],s=o.style,a=Graphics.get_material_for_color(s.color,s.alpha),l=a.material;if(o.prepare(),n=t.getLineElements([o],l.curves,o.stroke.scaleMode)){n.stroke=o.stroke;var h=e.addShape(Shape.getShape(n,l));if(a.colorPos){h.style=new Style;var c=new ImageSampler;l.animateUVs=!0,h.style.addSamplerAt(c,l.getTextureAt(0)),h.style.uvMatrix=new Matrix(0,0,0,0,a.colorPos.x,a.colorPos.y)}}}e.queued_stroke_pathes.length=0},t.getLineElements=function(t,e,i){void 0===i&&(i=LineScaleMode.NORMAL);var r,n,o,s=[],a=[],l=t.length,h=0,c=0,u=0,p=0,d=0,f=0,_=0,g=0,m=0,y=0;for(y=0;y<l;y++)for(r=t[y]._positions,n=t[y].stroke,m=i!=LineScaleMode.HAIRLINE?n.half_thickness:.5,c=0;c<r.length;c++)for(d=(o=r[c])[0],f=o[1],h=2;h<o.length;h+=2)u=o[h],p=o[h+1],u==d&&p==f||(s[_++]=d,s[_++]=f,s[_++]=0,s[_++]=u,s[_++]=p,s[_++]=0,a[g++]=m),d=u,f=p;if(0!=s.length){var v=new LineElements(new AttributesBuffer);return v.setPositions(s),v.setThickness(a),v}},t.getTriangleElements=function(t,e,i){void 0===i&&(i=LineScaleMode.NORMAL);var r,n,o,s,a,l=[],h=t.length,c=0,u=0,p=new Point,d=new Point,f=new Point,_=new Point,g=new Point,m=0,y=0,v=0,b=0,x=0,A=0,E=0,S=0,T=0,P=0,C=0,w=0,D=0,M=0,O=0,I=0,L=0,N=0,F=0,R=0,B=0,V=0,k=0,U=0,j=0,G=0,z=0,X=0,H=!0,$=!1,W=!1,q=0,Y=0,K=0,Z=0,J=0,Q=0,tt=0,et=0,it=[],rt=[],nt=0,ot=0,st=0;for(st=0;st<h;st++)for(r=t[st]._positions,tt=(n=t[st].stroke).half_thickness,et=n.half_thickness,LineScaleMode.NORMAL,u=0;u<r.length;u++){for(W=!0,null,null,(o=r[u])[0]!=o[o.length-2]||o[1]!=o[o.length-1]?W=!1:(d.x=o[o.length-2]-o[o.length-4],d.y=o[o.length-1]-o[o.length-3],d.normalize(),K=Math.atan2(d.y,d.x)*MathConsts.RADIANS_TO_DEGREES,o[o.length-2],o[o.length-1]),v=o[0],b=o[1],it=[],rt=[],nt=0,ot=0,s=-1*d.y,a=d.x,c=2;c<o.length;c+=2)m=o[c],y=o[c+1],m==v&&y==b||(p.x=m-v,p.y=y-b,p.normalize(),(Y=(q=Math.atan2(p.y,p.x)*MathConsts.RADIANS_TO_DEGREES)-K)>180&&(Y-=360),Y<-180&&(Y+=360),K=q,f.x=-1*p.y,f.y=p.x,x=v+f.x*tt,A=b+f.y*et,E=v-f.x*tt,S=b-f.y*et,$=!1,2!=c||W?(Z=180-Y,Y<0&&(Z=-180-Y),0==Y||180==Math.abs(Y)?$=2==c:Math.abs(Z)<5?$=!0:($=!0,Z=-.5*Z*MathConsts.DEGREES_TO_RADIANS,_.x=p.x*Math.cos(Z)+p.y*Math.sin(Z),_.y=p.y*Math.cos(Z)-p.x*Math.sin(Z),_.normalize(),Math.abs(Y)<=1||Math.abs(Y)>=359||Math.abs(Y)>=179&&Math.abs(Y)<=181?(J=Y<0?tt:-tt,Q=Y<0?et:-et):(J=tt/Math.sin(Z),Q=et/Math.sin(Z)),T=v-_.x*J,P=b-_.y*Q,C=v+_.x*J,w=b+_.y*Q,Y>0?(O=v-s*tt,I=b-a*et,x=T,A=P,E=D=v-f.x*tt,S=M=b-f.y*et):(F=v+s*tt,R=b+a*et,E=C,S=w,x=L=v+f.x*tt,A=N=b+f.y*et),H=!0,n.jointstyle==JointStyle.MITER&&(Math.sqrt((J*J+Q*Q)/(tt*tt+et*et)-1)<=n.miter_limit?(H=!1,E=C,S=w,x=T,A=P):Y>0?(D-=p.x*(n.miter_limit*tt),M-=p.y*(n.miter_limit*et),g.x=-1*a,g.y=s,O-=g.x*(n.miter_limit*tt),I-=g.y*(n.miter_limit*et)):(L-=p.x*(n.miter_limit*tt),N-=p.y*(n.miter_limit*et),g.x=-1*a,g.y=s,F-=g.x*(n.miter_limit*tt),R-=g.y*(n.miter_limit*et))),H&&(it[nt++]=n.jointstyle!=JointStyle.ROUND?GraphicsPathCommand.BUILD_JOINT:GraphicsPathCommand.BUILD_ROUND_JOINT,Y>0?(rt[ot++]=T,rt[ot++]=P,rt[ot++]=O,rt[ot++]=I,rt[ot++]=D,rt[ot++]=M):(rt[ot++]=F,rt[ot++]=R,rt[ot++]=C,rt[ot++]=w,rt[ot++]=L,rt[ot++]=N),n.jointstyle==JointStyle.ROUND&&(rt[ot++]=v-_.x*Math.abs(tt),rt[ot++]=b-_.y*Math.abs(et),Y>0?(rt[ot++]=O,rt[ot++]=I,rt[ot++]=D,rt[ot++]=M):(rt[ot++]=F,rt[ot++]=R,rt[ot++]=L,rt[ot++]=N))))):$=!0,s=f.x,a=f.y,$&&(it[nt++]=GraphicsPathCommand.LINE_TO,rt[ot++]=x,rt[ot++]=A,rt[ot++]=E,rt[ot++]=S),v,b,v=m,b=y,c==o.length-2&&(it[nt++]=GraphicsPathCommand.NO_OP,W?(rt[ot++]=rt[0],rt[ot++]=rt[1],rt[ot++]=rt[2],rt[ot++]=rt[3]):(rt[ot++]=v+f.x*tt,rt[ot++]=b+f.y*et,rt[ot++]=v-f.x*tt,rt[ot++]=b-f.y*et)));for(nt=0,ot=0,c=0;c<it.length;c++)it[c]==GraphicsPathCommand.LINE_TO?(B=rt[ot++],V=rt[ot++],k=rt[ot++],U=rt[ot++],j=rt[ot],G=rt[ot+1],z=rt[ot+2],X=rt[ot+3],GraphicsFactoryHelper.addTriangle(B,V,j,G,k,U,0,l,e),GraphicsFactoryHelper.addTriangle(k,U,j,G,z,X,0,l,e)):it[c]>=GraphicsPathCommand.BUILD_JOINT&&(j=rt[ot++],G=rt[ot++],B=rt[ot++],V=rt[ot++],k=rt[ot++],U=rt[ot++],GraphicsFactoryHelper.addTriangle(B,V,k,U,j,G,0,l,e),it[c]==GraphicsPathCommand.BUILD_ROUND_JOINT&&(z=rt[ot++],X=rt[ot++],B=rt[ot++],V=rt[ot++],k=rt[ot++],U=rt[ot++],GraphicsFactoryHelper.tesselateCurve(B,V,z,X,k,U,l,!0)));W||(d.x=o[2]-o[0],d.y=o[3]-o[1],d.normalize(),GraphicsFactoryHelper.createCap(o[0],o[1],rt[0],rt[1],rt[2],rt[3],d.x,d.y,n.capstyle,-1,tt,et,l,e),d.x=o[o.length-2]-o[o.length-4],d.y=o[o.length-1]-o[o.length-3],d.normalize(),GraphicsFactoryHelper.createCap(o[o.length-2],o[o.length-1],rt[rt.length-4],rt[rt.length-3],rt[rt.length-2],rt[rt.length-1],d.x,d.y,n.capstyle,1,tt,et,l,e))}if(0!=l.length){var at=new AttributesView(Float32Array,e?3:2);at.set(l);var lt=at.attributesBuffer.cloneBufferView();at.dispose();var ht=new TriangleElements(lt);return ht.setPositions(new Float2Attributes(lt)),ht}},t}(),Graphics=function(t){function e(){var e=t.call(this)||this;return e._queuedShapeTags=[],e._shapes=[],e._current_position=new Point,e._scale=new Vector3D,e._scaleX=0,e._scaleY=0,e._drawingDirty=!1,e.usages=0,e.push=Array.prototype.push,e._drawingDirty=!1,e._current_position=new Point,e._queued_fill_pathes=[],e._queued_stroke_pathes=[],e._active_fill_path=null,e._active_stroke_path=null,e._fillStyle=null,e._lineStyle=null,e._onInvalidateDelegate=function(t){return e._onInvalidate(t)},e}return __extends(e,t),e.getGraphics=function(){return e._pool.length?e._pool.pop():new e},e.clearPool=function(){e._pool=[]},e.prototype.updateSlice9=function(t,e){if(this._scaleX!=t||this._scaleY!=e){this._scaleX=t,this._scaleY=e;for(var i=this._shapes.length,r=0;r<i;r++)TriangleElementsUtils.updateTriangleGraphicsSlice9(this._shapes[r].elements,this.originalSlice9Size,t,e);this.invalidate()}},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._shapes.length+this._queued_stroke_pathes.length+this._queued_fill_pathes.length+this._queuedShapeTags.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queued_stroke_pathes",{get:function(){return this._queued_stroke_pathes},set:function(t){this._queued_stroke_pathes=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queued_fill_pathes",{get:function(){return this._queued_fill_pathes},set:function(t){this._queued_fill_pathes=t},enumerable:!0,configurable:!0}),e.prototype.add_queued_path=function(t){t.style&&(t.style.data_type!=GraphicsFillStyle.data_type&&t.style.data_type!=GradientFillStyle.data_type&&t.style.data_type!=BitmapFillStyle.data_type||(this._drawingDirty=!0,this._queued_fill_pathes.push(t)),t.style.data_type==GraphicsStrokeStyle.data_type&&(this._queued_stroke_pathes.push(t),this.endFill()))},e.prototype.addShape=function(t){var e=this.getShapeIndex(t);return-1!=e&&this.removeShapeAt(e),this._shapes.push(t),t.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateDelegate),t.addEventListener(RenderableEvent.INVALIDATE_MATERIAL,this._onInvalidateDelegate),t.addEventListener(RenderableEvent.INVALIDATE_STYLE,this._onInvalidateDelegate),t.addEventListener(AssetEvent.INVALIDATE,this._onInvalidateDelegate),t.usages++,this._scaleX=0,this._scaleY=0,this.invalidate(),t},e.prototype.removeShape=function(t){var e=this.getShapeIndex(t);if(-1==e)throw new ArgumentError("Shape parameter is not a shape of the caller");this.removeShapeAt(e)},e.prototype.removeShapeAt=function(t){if(t<0||t>=this._shapes.length)throw new RangeError$1("Index is out of range");var e=this._shapes.splice(t,1)[0];e.removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateDelegate),e.removeEventListener(RenderableEvent.INVALIDATE_MATERIAL,this._onInvalidateDelegate),e.removeEventListener(RenderableEvent.INVALIDATE_STYLE,this._onInvalidateDelegate),e.removeEventListener(AssetEvent.INVALIDATE,this._onInvalidateDelegate),e.usages--,e.usages||e.dispose(),this.invalidate()},e.prototype.getShapeAt=function(t){return this._shapes[t]},e.prototype.getShapeIndex=function(t){return this._shapes.indexOf(t)},e.prototype.applyTransformation=function(t){for(var e=this._shapes.length,i=0;i<e;++i)this._shapes[i].applyTransformation(t)},e.prototype.copyTo=function(t,e){void 0===e&&(e=!1),this._drawingDirty&&this.endFill(),this.slice9Rectangle&&(t.slice9Rectangle=new Rectangle,t.slice9Rectangle.copyFrom(this.slice9Rectangle),t.originalSlice9Size=new Rectangle,t.originalSlice9Size.copyFrom(this.originalSlice9Size),t.minSlice9Width=this.minSlice9Width,t.minSlice9Height=this.minSlice9Height),t._addShapes(this._shapes,e)},e.prototype.scale=function(t){for(var e=this._shapes.length,i=0;i<e;++i)this._shapes[i].scale(t)},e.prototype.clear=function(){for(var t,e=this._shapes.length,i=0;i<e;i++)(t=this._shapes[i]).removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateDelegate),t.removeEventListener(RenderableEvent.INVALIDATE_MATERIAL,this._onInvalidateDelegate),t.removeEventListener(RenderableEvent.INVALIDATE_STYLE,this._onInvalidateDelegate),t.removeEventListener(AssetEvent.INVALIDATE,this._onInvalidateDelegate),t.usages--,t.usages||t.dispose();this._shapes.length=0,this.invalidate(),this._active_fill_path=null,this._active_stroke_path=null,this._queued_fill_pathes.length=0,this._queued_stroke_pathes.length=0,this._drawingDirty=!1,this._lineStyle=null,this._fillStyle=null},e.prototype.dispose=function(){this.clear(),e._pool.push(this)},e.prototype.scaleUV=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);for(var i=this._shapes.length,r=0;r<i;++r)this._shapes[r].scaleUV(t,e)},e.prototype._acceptTraverser=function(t){this._drawingDirty&&this.endFill();for(var e=this._shapes.length-1;e>=0;e--)t.applyTraversable(this._shapes[e])},e.prototype._onInvalidate=function(t){this.invalidate()},e.prototype.draw_fills=function(){GraphicsFactoryFills.draw_pathes(this),this._active_fill_path=null},e.prototype.draw_strokes=function(){GraphicsFactoryStrokes.draw_pathes(this),this._active_stroke_path=null},e.prototype.beginBitmapFill=function(t,e,i,r){this.draw_fills(),this._drawingDirty=!0,this._fillStyle=new GraphicsFillStyle(16777215,1)},e.prototype.beginFill=function(t,e){void 0===e&&(e=1),0==t&&(t=65793),this.draw_fills(),this._fillStyle=new GraphicsFillStyle(t,e)},e.prototype.beginGradientFill=function(t,e,i,r,n,o,s,a){void 0===n&&(n=null),void 0===o&&(o="pad"),void 0===s&&(s="rgb"),void 0===a&&(a=0),this.draw_fills(),this._drawingDirty=!0,this._fillStyle=new GradientFillStyle(t,e,i,r,n,o,s,a)},e.prototype.copyFrom=function(t){t.copyTo(this)},e.prototype.cubicCurveTo=function(t,e,i,r,n,o){throw new PartialImplementationError("cubicCurveTo")},e.prototype.curveTo=function(t,e,i,r){this._drawingDirty=!0,this._createGraphicPathes(),null!=this._active_fill_path&&this._active_fill_path.curveTo(t,e,i,r),null!=this._active_stroke_path&&this._active_stroke_path.curveTo(t,e,i,r),this._current_position.x=i,this._current_position.y=r,this.invalidate()},e.prototype.drawCircle=function(t,e,i){if(this._drawingDirty=!0,this._createGraphicPathes(),null!=this._active_fill_path){this._active_fill_path.moveTo(t,e);var r=i;null!=this._active_stroke_path&&(r-=this._active_stroke_path.style.thickness/2),GraphicsFactoryHelper.drawElipse(t,e,r,r,this._active_fill_path.verts,0,360,5,!1)}null!=this._active_stroke_path&&(this._active_stroke_path.moveTo(t,e),GraphicsFactoryHelper.drawElipseStrokes(t,e,i,i,this._active_stroke_path.verts,0,360,5,this._active_stroke_path.style.thickness/2,!1)),this.invalidate()},e.prototype.drawEllipse=function(t,e,i,r){if(this._drawingDirty=!0,this._createGraphicPathes(),null!=this._active_fill_path){this._active_fill_path.moveTo(t,e);var n=i,o=r;null!=this._active_stroke_path&&(n-=this._active_stroke_path.style.thickness/2,o-=this._active_stroke_path.style.thickness/2),GraphicsFactoryHelper.drawElipse(t,e,n,o,this._active_fill_path.verts,0,360,5,!1)}null!=this._active_stroke_path&&(this._active_stroke_path.moveTo(t,e),GraphicsFactoryHelper.drawElipseStrokes(t,e,i,r,this._active_stroke_path.verts,0,360,5,this._active_stroke_path.style.thickness/2,!1)),this.invalidate()},e.prototype.drawGraphicsData=function(t){},e.prototype.drawPath=function(t,e,i){},e.prototype.drawRect=function(t,e,i,r){if(this._drawingDirty=!0,this._createGraphicPathes(),null!=this._active_fill_path){this._active_fill_path.moveTo(t,e);var n=i,o=r,s=0;null!=this._active_stroke_path&&(s=this._active_stroke_path.style.thickness/2,n-=this._active_stroke_path.style.thickness,o-=this._active_stroke_path.style.thickness),GraphicsFactoryHelper.addTriangle(t+s,e+o+s,t+s,e+s,t+n+s,e+s,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+s,e+o+s,t+s+n,e+s,t+n+s,e+o+s,0,this._active_fill_path.verts,!1)}null!=this._active_stroke_path&&(this._active_stroke_path.moveTo(t,e),this._active_stroke_path.lineTo(t+i,e),this._active_stroke_path.lineTo(t+i,e+r),this._active_stroke_path.lineTo(t,e+r),this._active_stroke_path.lineTo(t,e)),this.invalidate()},e.prototype.drawRoundRect=function(t,e,i,r,n,o){void 0===o&&(o=NaN),this._drawingDirty=!0,this._createGraphicPathes(),isNaN(o)&&(o=n);var s=i,a=r,l=n/2,h=o/2,c=0;null!=this._active_fill_path&&(this._active_fill_path.moveTo(t,e),null!=this._active_stroke_path&&(c=this._active_stroke_path.style.thickness/2,s-=this._active_stroke_path.style.thickness,a-=this._active_stroke_path.style.thickness),GraphicsFactoryHelper.addTriangle(t+c,e+a-h,t+c,e+h,t+s-c,e+h,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e+a-h,t+s-c,e+h,t+s-c,e+a-h,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+c,t+s-l,e+h,t+l,e+h,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+c,t+s-l,e+c,t+s-l,e+h,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+a-h,t+s-l,e+a-c,t+l,e+a-c,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+a-h,t+s-l,e+a-h,t+s-l,e+a-c,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.drawElipse(t+l,e+h,l-c,h-c,this._active_fill_path.verts,180,270,5,!1),GraphicsFactoryHelper.drawElipse(t+s-l,e+h,l-c,h-c,this._active_fill_path.verts,270,360,5,!1),GraphicsFactoryHelper.drawElipse(t+s-l,e+a-h,l-c,h-c,this._active_fill_path.verts,0,90,5,!1),GraphicsFactoryHelper.drawElipse(t+l,e+a-h,l-c,h-c,this._active_fill_path.verts,90,180,5,!1)),null!=this._active_stroke_path&&(this._active_stroke_path.moveTo(t,e),c=this._active_stroke_path.style.thickness/2,GraphicsFactoryHelper.addTriangle(t-c,e+a-h,t-c,e+h,t+c,e+h,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t-c,e+a-h,t+c,e+a-h,t+c,e+h,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e-c,t+s-l,e-c,t+l,e+c,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+c,t+s-l,e-c,t+s-l,e+c,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+s-c,e+a-h,t+s-c,e+h,t+s+c,e+a-h,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+s+c,e+a-h,t+s+c,e+h,t+s-c,e+h,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+a+c,t+s-l,e+a+c,t+l,e+a-c,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l,e+a-c,t+s-l,e+a+c,t+s-l,e+a-c,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.drawElipseStrokes(t+l,e+h,l,h,this._active_stroke_path.verts,180,270,5,c,!1),GraphicsFactoryHelper.drawElipseStrokes(t+s-l,e+h,l,h,this._active_stroke_path.verts,270,360,5,c,!1),GraphicsFactoryHelper.drawElipseStrokes(t+s-l,e+a-h,l,h,this._active_stroke_path.verts,0,90,5,c,!1),GraphicsFactoryHelper.drawElipseStrokes(t+l,e+a-h,l,h,this._active_stroke_path.verts,90,180,5,c,!1)),this.invalidate()},e.prototype.drawRoundRectComplex=function(t,e,i,r,n,o,s,a){var l=i,h=r,c=n,u=o,p=s,d=a;this._drawingDirty=!0,this._createGraphicPathes();var f=0;null!=this._active_fill_path&&(this._active_fill_path.moveTo(t,e),null!=this._active_stroke_path&&(f=this._active_stroke_path.style.thickness/2,l-=this._active_stroke_path.style.thickness,h-=this._active_stroke_path.style.thickness),GraphicsFactoryHelper.addTriangle(t+c,e+c,t+l-u,e+u,t+l-d,e+h-d,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e+c,t+l-d,e+h-d,t+p,e+h-p,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+f,e+c,t+c,e+c,t+f,e+h-p,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e+c,t+f,e+h-p,t+p,e+h-p,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e+f,t+c,e+c,t+l-u,e+f,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e+c,t+l-u,e+u,t+l-u,e+f,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l-f,e+u,t+l-u,e+u,t+l-f,e+h-d,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l-u,e+u,t+l-d,e+h-d,t+l-f,e+h-d,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+p,e+h-f,t+l-d,e+h-f,t+p,e+h-p,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+p,e+h-p,t+l-d,e+h-f,t+l-d,e+h-d,0,this._active_fill_path.verts,!1),GraphicsFactoryHelper.drawElipse(t+c,e+c,c-f,c-f,this._active_fill_path.verts,180,270,5,!1),GraphicsFactoryHelper.drawElipse(t+l-u,e+u,u-f,u-f,this._active_fill_path.verts,270,360,5,!1),GraphicsFactoryHelper.drawElipse(t+l-d,e+h-d,d-f,d-f,this._active_fill_path.verts,0,90,5,!1),GraphicsFactoryHelper.drawElipse(t+p,e+h-p,p-f,p-f,this._active_fill_path.verts,90,180,5,!1)),null!=this._active_stroke_path&&(this._active_stroke_path.moveTo(t,e),f=this._active_stroke_path.style.thickness/2,GraphicsFactoryHelper.addTriangle(t-f,e+h-p,t-f,e+c,t+f,e+c,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t-f,e+h-p,t+f,e+h-p,t+f,e+c,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e-f,t+l-u,e-f,t+u,e+f,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+c,e+f,t+l-u,e-f,t+l-u,e+f,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l-f,e+h-d,t+l-f,e+u,t+l+f,e+h-d,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+l+f,e+h-d,t+l+f,e+u,t+l-f,e+u,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+p,e+h+f,t+l-d,e+h+f,t+p,e+h-f,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.addTriangle(t+p,e+h-f,t+l-d,e+h+f,t+l-d,e+h-f,0,this._active_stroke_path.verts,!1),GraphicsFactoryHelper.drawElipseStrokes(t+c,e+c,c,c,this._active_stroke_path.verts,180,270,5,f,!1),GraphicsFactoryHelper.drawElipseStrokes(t+l-u,e+u,u,u,this._active_stroke_path.verts,270,360,5,f,!1),GraphicsFactoryHelper.drawElipseStrokes(t+l-d,e+h-d,d,d,this._active_stroke_path.verts,0,90,5,f,!1),GraphicsFactoryHelper.drawElipseStrokes(t+p,e+h-p,p,p,this._active_stroke_path.verts,90,180,5,f,!1)),this.invalidate()},e.prototype.drawTriangles=function(t,e,i,r){this._drawingDirty=!0,this._active_fill_path,this._active_stroke_path},e.prototype.endFill=function(){if(this._queuedShapeTags.length){var t=this._queuedShapeTags,e=t.length;this._queuedShapeTags=[];for(var i=0;i<e;i++)this.convertRecordsToShapeData(t[i]);t.length=0}this._drawingDirty=!1,this._active_stroke_path&&this._active_fill_path&&(this._active_stroke_path.forceClose=!0),this.draw_fills(),this.draw_strokes(),this._active_fill_path=null,this._active_stroke_path=null,this._fillStyle=null},e.prototype.lineBitmapStyle=function(t,e,i,r){},e.prototype.lineGradientStyle=function(t,e,i,r,n,o,s,a){this._drawingDirty=!0,this._lineStyle=new GraphicsStrokeStyle(e[0],i[0],1)},e.prototype.lineStyle=function(t,e,i,r,n,o,s,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===o&&(o=CapsStyle.NONE),void 0===s&&(s=JointStyle.MITER),void 0===a&&(a=100),this._drawingDirty=!0,this._lineStyle=new GraphicsStrokeStyle(e,i,t,s,o,a)},e.prototype.lineTo=function(t,e){this._drawingDirty=!0,this._createGraphicPathes(),null!=this._active_fill_path&&this._active_fill_path.lineTo(t,e),null!=this._active_stroke_path&&this._active_stroke_path.lineTo(t,e),this._current_position.x=t,this._current_position.y=e,this.invalidate()},e.prototype.moveTo=function(t,e){this._drawingDirty=!0,this._createGraphicPathes(),null!=this._active_fill_path&&this._active_fill_path.moveTo(t,e),null!=this._active_stroke_path&&this._active_stroke_path.moveTo(t,e),this._current_position.x=t,this._current_position.y=e,this.invalidate()},e.prototype.queueShapeTag=function(t){this._queuedShapeTags.push(t),this._drawingDirty=!0},e.prototype._createGraphicPathes=function(){null==this._fillStyle||null!=this._active_fill_path&&this._active_fill_path.style==this._fillStyle||(this._active_fill_path=new GraphicsPath,this._active_fill_path.style=this._fillStyle,0==this._current_position.x&&0==this._current_position.y||this._active_fill_path.moveTo(this._current_position.x,this._current_position.y),this._queued_fill_pathes.push(this._active_fill_path)),null==this._lineStyle||null!=this._active_stroke_path&&this._active_stroke_path.style==this._lineStyle||(this._active_stroke_path=new GraphicsPath,this._active_stroke_path.style=this._lineStyle,0==this._current_position.x&&0==this._current_position.y||this._active_stroke_path.moveTo(this._current_position.x,this._current_position.y),this._queued_stroke_pathes.push(this._active_stroke_path))},e.prototype._addShapes=function(t,e){var i;void 0===e&&(e=!1);for(var r=t.length,n=0;n<r;n++)i=t[n],this.slice9Rectangle?i=Shape.getShape(TriangleElementsUtils.updateTriangleGraphicsSlice9(i.elements,this.originalSlice9Size,1,1,!1,!0),i.material,i.style):e&&(i=Shape.getShape(i.elements,i.material,i.style,i.count,i.offset)),i.particleCollection=t[n].particleCollection,i.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateDelegate),i.addEventListener(RenderableEvent.INVALIDATE_MATERIAL,this._onInvalidateDelegate),i.addEventListener(RenderableEvent.INVALIDATE_STYLE,this._onInvalidateDelegate),i.addEventListener(AssetEvent.INVALIDATE,this._onInvalidateDelegate),this._shapes.push(i),i.usages++;this._scaleX=0,this._scaleY=0,this._scale.identity(),this.invalidate()},e.prototype._isShapeMaterial=function(t){for(var e=this._shapes.length,i=0;i<e;i++)if(t==this._shapes[i].material)return!0;return!1},e.prototype.convertRecordsToShapeData=function(t){for(var e,i,r,n,o,s,a,l=t.records,h=t.fillStyles,c=t.lineStyles,u=t.recordsMorph||null,p=t.parser,d=createPathsList(h,!1,!!u,p),f=createPathsList(c,!0,!!u,p),_=null!==u,g={fill0:0,fill1:0,line:0},m=null,y=null,v=null,b=l.length,x=0,A=0,E=0,S=0,T=0,P=0;T<b;T++){var C,w=l[T];if(_&&(C=u[P++]),0===w.type)16&w.flags&&(e||(e=[]),this.push.apply(e,d),d=createPathsList(w.fillStyles,!1,_,p),this.push.apply(e,f),f=createPathsList(w.lineStyles,!0,_,p),i&&(e.push(i),i=null),g={fill0:0,fill1:0,line:0}),2&w.flags&&(g.fill0=w.fillStyle0),4&w.flags&&(g.fill1=w.fillStyle1),8&w.flags&&(g.line=w.lineStyle),r=n=o=null,m=y=v=null,g.fill0&&(r=d[g.fill0-1]),g.fill1&&(n=d[g.fill1-1]),g.line&&(o=f[g.line-1]),1&w.flags&&(x=0|w.moveX,A=0|w.moveY),g.fill1&&g.fill0&&g.fill0==g.fill1&&(m=null,y=null,r=null,n=null),r&&(m=PathSegment.FromDefaults(_),r.addSegment(m),_?(0===C.type?(E=0|C.moveX,S=0|C.moveY):(E=x,S=A,P--),m.morphMoveTo(x,A,E,S)):m.moveTo(x,A)),n&&(y=PathSegment.FromDefaults(_),n.addSegment(y),_?(0===C.type?(E=0|C.moveX,S=0|C.moveY):(E=x,S=A,P--),y.morphMoveTo(x,A,E,S)):y.moveTo(x,A)),o&&(v=PathSegment.FromDefaults(_),o.addSegment(v),_?(0===C.type?(E=0|C.moveX,S=0|C.moveY):(E=x,S=A,P--),v.morphMoveTo(x,A,E,S)):v.moveTo(x,A));else{if(assert(1===w.type),_){for(;C&&0===C.type;)C=u[P++];C||(C=w)}if(32&w.flags&&(!_||32&C.flags))x+=0|w.deltaX,A+=0|w.deltaY,m&&!_?m.lineTo(x,A):m&&(E+=0|C.deltaX,S+=0|C.deltaY,m.morphLineTo(x,A,E,S)),y&&!_?y.lineTo(x,A):y&&(E+=0|C.deltaX,S+=0|C.deltaY,y.morphLineTo(x,A,E,S)),v&&!_?v.lineTo(x,A):v&&(E+=0|C.deltaX,S+=0|C.deltaY,v.morphLineTo(x,A,E,S));else{var D,M,O,I;if(32&w.flags?(D=x+((O=0|w.deltaX)>>1),M=A+((I=0|w.deltaY)>>1),x+=O,A+=I):(D=x+w.controlDeltaX|0,M=A+w.controlDeltaY|0,x=D+w.anchorDeltaX|0,A=M+w.anchorDeltaY|0),m&&!_)m.curveTo(D,M,x,A);else if(m){if(32&C.flags){L=E+((O=0|C.deltaX)>>1),N=S+((I=0|C.deltaY)>>1);E+=O,S+=I}else{var L=E+C.controlDeltaX|0,N=S+C.controlDeltaY|0;E=L+C.anchorDeltaX|0,S=N+C.anchorDeltaY|0}m.morphCurveTo(D,M,x,A,L,N,E,S)}if(y&&!_)y.curveTo(D,M,x,A);else if(y){if(32&C.flags){L=E+((O=0|C.deltaX)>>1),N=S+((I=0|C.deltaY)>>1);E+=O,S+=I}else{var L=E+C.controlDeltaX|0,N=S+C.controlDeltaY|0;E=L+C.anchorDeltaX|0,S=N+C.anchorDeltaY|0}y.morphCurveTo(D,M,x,A,L,N,E,S)}if(v&&!_)v.curveTo(D,M,x,A);else if(v){if(32&C.flags){L=E+((O=0|C.deltaX)>>1),N=S+((I=0|C.deltaY)>>1);E+=O,S+=I}else{L=E+C.controlDeltaX|0,N=S+C.controlDeltaY|0;E=L+C.anchorDeltaX|0,S=N+C.anchorDeltaY|0}v.morphCurveTo(D,M,x,A,L,N,E,S)}}}}if(e?this.push.apply(e,d):e=d,this.push.apply(e,f),i&&e.push(i),_)for(this.start=[],this.end=[],T=0;T<e.length;T++)s=new GraphicsPath,a=new GraphicsPath,e[T].serializeAJS(s,a),this.start.push(s),this.end.push(a);else for(T=0;T<e.length;T++)s=new GraphicsPath,e[T].serializeAJS(s,null),this.add_queued_path(s)},e._pool=new Array,e.get_material_for_color=function(t,e){return{material:MaterialUtils.getDefaultColorMaterial()}},e.get_material_for_gradient=function(t){return{material:MaterialUtils.getDefaultTextureMaterial()}},e.assetType="[asset Graphics]",e}(AssetBase),IDENTITY_MATRIX={a:1,b:0,c:0,d:1,tx:0,ty:0};function processStyle(t,e,i,r){var n=t;if(i&&(n.morph=processMorphStyle(t,e)),e){if(n.miterLimit=2*(t.miterLimitFactor||1.5),!t.color&&t.hasFill){var o=processStyle(t.fillStyle,!1,!1,r);return n.type=o.type,n.transform=o.transform,n.colors=o.colors,n.ratios=o.ratios,n.focalPoint=o.focalPoint,n.bitmapId=o.bitmapId,n.material=o.material,n.repeat=o.repeat,t.fillStyle=null,n}return n.type=FillType.Solid,n}if(void 0===t.type||t.type===FillType.Solid)return n;switch(t.type){case FillType.LinearGradient:case FillType.RadialGradient:case FillType.FocalRadialGradient:for(var s=t.records,a=n.colors=[],l=n.ratios=[],h=0;h<s.length;h++){var c=s[h];0!=l.length&&l[l.length-1]==c.ratio||(a.push(c.color),l.push(c.ratio))}break;case FillType.RepeatingBitmap:case FillType.ClippedBitmap:case FillType.NonsmoothedRepeatingBitmap:case FillType.NonsmoothedClippedBitmap:n.smooth=t.type!==FillType.NonsmoothedRepeatingBitmap&&t.type!==FillType.NonsmoothedClippedBitmap,n.repeat=t.type!==FillType.ClippedBitmap&&t.type!==FillType.NonsmoothedClippedBitmap,n.material=r.getMaterial(t.bitmapId);break;default:console.log("shape parser encountered invalid fill style "+t.type)}if(!t.matrix)return n.transform=IDENTITY_MATRIX,n;var u=t.matrix;return n.transform={a:u.a,b:u.b,c:u.c,d:u.d,tx:u.tx/20,ty:u.ty/20},t.matrix=null,n}function processMorphStyle(t,e){var i=Object.create(t);if(e){if(i.width=t.widthMorph,!t.color&&t.hasFill){var r=processMorphStyle(t.fillStyle,!1);return i.transform=r.transform,i.colors=r.colors,i.ratios=r.ratios,i}return i.color=t.colorMorph,i}if(void 0===t.type)return i;if(t.type===FillType.Solid)return i.color=t.colorMorph,i;switch(t.type){case FillType.LinearGradient:case FillType.RadialGradient:case FillType.FocalRadialGradient:for(var n=t.records,o=i.colors=[],s=i.ratios=[],a=0;a<n.length;a++){var l=n[a];o.push(l.colorMorph),s.push(l.ratioMorph)}break;case FillType.RepeatingBitmap:case FillType.ClippedBitmap:case FillType.NonsmoothedRepeatingBitmap:case FillType.NonsmoothedClippedBitmap:break;default:console.log("shape parser encountered invalid fill style")}if(!t.matrix)return i.transform=IDENTITY_MATRIX,i;var h=t.matrixMorph;return i.transform={a:h.a,b:h.b,c:h.c,d:h.d,tx:h.tx/20,ty:h.ty/20},i}function createPathsList(t,e,i,r){for(var n=[],o=0;o<t.length;o++){var s=processStyle(t[o],e,i,r);n[o]=e?new SegmentedPath(null,s):new SegmentedPath(s,null)}return n}var GraphicsFactoryHelper=function(){function t(){}return t.drawRectangles=function(t,e,i){if(!(t.length%4>0)){var r=[];r.length=t.length/4*12;var n=0,o=0,s=t.length,a=0,l=0,h=0,c=0;for(n=0;n<s;n+=4)a=t[n],l=t[n+1],h=t[n+2],c=t[n+3],r[o++]=a,r[o++]=l,r[o++]=a+h,r[o++]=l,r[o++]=a+h,r[o++]=l+c,r[o++]=a,r[o++]=l,r[o++]=a,r[o++]=l+c,r[o++]=a+h,r[o++]=l+c;var u=Graphics.get_material_for_color(e,i),p=u.material,d=new AttributesView(Float32Array,p.curves?3:2);d.set(r);var f=d.attributesBuffer.cloneBufferView();d.dispose();var _=new TriangleElements(f);_.setPositions(new Float2Attributes(f));var g=Shape.getShape(_,p);if(u.colorPos){g.style=new Style;var m=new ImageSampler;p.animateUVs=!0,g.style.color=e,g.style.addSamplerAt(m,p.getTextureAt(0)),g.style.uvMatrix=new Matrix(0,0,0,0,u.colorPos.x,u.colorPos.y)}return g}console.log("GraphicsFactoryHelper.drawRectangles: inputRectangles.length is not a multiple of 4",t)},t.updateRectanglesShape=function(t,e){var i=[];i.length=e.length/4*12;var r=0,n=0,o=e.length,s=0,a=0,l=0,h=0;for(r=0;r<o;r+=4)s=e[r],a=e[r+1],l=e[r+2],h=e[r+3],i[n++]=s,i[n++]=a,i[n++]=s+l,i[n++]=a,i[n++]=s+l,i[n++]=a+h,i[n++]=s,i[n++]=a,i[n++]=s,i[n++]=a+h,i[n++]=s+l,i[n++]=a+h;var c=t.elements;c.concatenatedBuffer.count=i.length/2,c.setPositions(i),c.invalidate()},t.isClockWiseXY=function(t,e,i,r,n,o){return!((t-i)*(o-r)-(e-r)*(n-i)<0)},t.getSign=function(t,e,i,r,n,o){return(t-n)*(r-o)-(e-o)*(i-n)},t.pointInTri=function(e,i,r,n,o,s,a,l){var h=t.getSign(e,i,a,l,r,n)>0,c=t.getSign(r,n,a,l,o,s)>0,u=t.getSign(o,s,a,l,e,i)>0;return h==c&&c==u},t.getControlXForCurveX=function(t,e,i){return e},t.getControlYForCurveY=function(t,e,i){return e},t.drawPoint=function(e,i,r,n){t.addTriangle(e-2,i-2,e+2,i-2,e+2,i+2,0,r,n),t.addTriangle(e-2,i-2,e-2,i+2,e+2,i+2,0,r,n)},t.drawElipse=function(e,i,r,n,o,s,a,l,h){for(var c=(a-s)/l,u=e+r*Math.cos(s*(Math.PI/180)),p=i+n*Math.sin(s*(Math.PI/180)),d=1;d<=c;d++){var f=e+r*Math.cos((s+d*l)*(Math.PI/180)),_=i+n*Math.sin((s+d*l)*(Math.PI/180));t.addTriangle(e,i,f,_,u,p,0,o,h),u=f,p=_}},t.drawElipseStrokes=function(e,i,r,n,o,s,a,l,h,c){for(var u=(a-s)/l,p=e+(r+h)*Math.cos(s*(Math.PI/180)),d=i+(n+h)*Math.sin(s*(Math.PI/180)),f=e+(r-h)*Math.cos(s*(Math.PI/180)),_=i+(n-h)*Math.sin(s*(Math.PI/180)),g=1;g<=u;g++){var m=e+(r+h)*Math.cos((s+g*l)*(Math.PI/180)),y=i+(n+h)*Math.sin((s+g*l)*(Math.PI/180)),v=e+(r-h)*Math.cos((s+g*l)*(Math.PI/180)),b=i+(n-h)*Math.sin((s+g*l)*(Math.PI/180));t.addTriangle(m,y,v,b,p,d,0,o,c),t.addTriangle(f,_,v,b,p,d,0,o,c),p=m,d=y,f=v,_=b}},t.addTriangle=function(e,i,r,n,o,s,a,l,h){var c=e,u=i,p=r,d=n,f=o,_=s;t.isClockWiseXY(c,u,p,d,f,_)&&(e=f,i=_,r=p,n=d,o=c,s=u);var g=l.length;0==a?(l[g++]=e,l[g++]=i,h&&(l[g++]=45736980577097704e-57),l[g++]=r,l[g++]=n,h&&(l[g++]=45736980577097704e-57),l[g++]=o,l[g++]=s,h&&(l[g++]=45736980577097704e-57)):a<0?(l[g++]=e,l[g++]=i,h&&(l[g++]=11708844992641982e-54),l[g++]=r,l[g++]=n,h&&(l[g++]=22778106537599901e-57),l[g++]=o,l[g++]=s,h&&(l[g++]=17796490496925177e-59)):a>0&&(l[g++]=e,l[g++]=i,h&&(l[g++]=11708846393940446e-54),l[g++]=r,l[g++]=n,h&&(l[g++]=22779507836064226e-57),l[g++]=o,l[g++]=s,h&&(l[g++]=1793662034335766e-58))},t.createCap=function(e,i,r,n,o,s,a,l,h,c,u,p,d,f){if(a*=c,l*=c,h==CapsStyle.ROUND){var _=e+a*u,g=i+l*p,m=r+a*u,y=n+l*p,v=o+a*u,b=s+l*p;t.tesselateCurve(r,n,m,y,_,g,d,!0),t.tesselateCurve(_,g,v,b,o,s,d,!0),t.addTriangle(r,n,_,g,o,s,-1,d,f)}else if(h==CapsStyle.SQUARE){m=r+a*u,y=n+l*p,v=o+a*u,b=s+l*p;t.addTriangle(v,b,m,y,r,n,0,d,f),t.addTriangle(v,b,r,n,o,s,0,d,f)}},t.getLineFormularData=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=new Point;return 0!=i&&0!=r&&(n.x=r/i),n.y=-(n.x*t.x-t.y),n},t.getQuadricBezierPosition=function(t,e,i,r){var n=1-t;return n*n*e+2*n*t*i+t*t*r},t.subdivideCurve=function(e,i,r,n,o,s,a,l,h,c,u,p,d,f){var _=Math.atan2(n-i,r-e)*MathConsts.RADIANS_TO_DEGREES,g=Math.atan2(s-n,o-r)*MathConsts.RADIANS_TO_DEGREES-_;if(g>180&&(g-=360),g<-180&&(g+=360),Math.abs(g)>=175)return d.push(e,i,r,n,o,s),void f.push(a,l,h,c,u,p);var m=!1;if(g<0?(m=t.getSign(e,i,h,c,o,s)>0,t.getSign(e,i,r,n,o,s)>0,m=((i-s)*(r-e)+(o-e)*(n-i))*((i-s)*(h-e)+(o-e)*(c-i))<0):(m=t.getSign(a,l,h,c,u,p)>0,t.getSign(a,l,r,n,u,p)>0,m=((l-s)*(r-a)+(u-a)*(n-l))*((l-p)*(h-a)+(u-a)*(c-l))<0),m)return d.push(e,i,r,n,o,s),void f.push(a,l,h,c,u,p);var y=e+.5*(r-e),v=i+.5*(n-i),b=r+.5*(o-r),x=n+.5*(s-n),A=y+.5*(b-y),E=v+.5*(x-v),S=a+.5*(h-a),T=l+.5*(c-l),P=h+.5*(u-h),C=c+.5*(p-c),w=S+.5*(P-S),D=T+.5*(C-T);t.subdivideCurve(e,i,y,v,A,E,a,l,S,T,w,D,d,f),t.subdivideCurve(A,E,b,x,o,s,w,D,P,C,u,p,d,f)},t.tesselateCurve=function(e,i,r,n,o,s,a,l,h){void 0===l&&(l=!1),void 0===h&&(h=0);if(h>=6)return l?void a.push(e,i,r,n,o,s):void a.push(r,n,o,s);for(var c=Math.atan2(n-i,r-e)*MathConsts.RADIANS_TO_DEGREES,u=Math.atan2(s-n,o-r)*MathConsts.RADIANS_TO_DEGREES-c;u>180;)u-=360;for(;u<-180;)u+=360;var p=o-e,d=s-i,f=Math.sqrt(p*p+d*d),_=e+.5*(r-e),g=i+.5*(n-i),m=r+.5*(o-r),y=n+.5*(s-n),v=_+.5*(m-_),b=g+.5*(y-g);Math.abs(u)<=1||f<1?l?a.push(e,i,v,b,o,s):a.push(o,s):(l&&a.push(e,i,v,b,o,s),h++,t.tesselateCurve(e,i,_,g,v,b,a,l,h),t.tesselateCurve(v,b,m,y,o,s,a,l,h))},t}(),Tess2={},tess2=Tess2;Tess2.WINDING_ODD=0,Tess2.WINDING_NONZERO=1,Tess2.WINDING_POSITIVE=2,Tess2.WINDING_NEGATIVE=3,Tess2.WINDING_ABS_GEQ_TWO=4,Tess2.POLYGONS=0,Tess2.CONNECTED_POLYGONS=1,Tess2.BOUNDARY_CONTOURS=2,Tess2.tesselate=function(t){for(var e=t.debug||!1,i=new Tesselator,r=0;r<t.contours.length;r++)i.addContour(t.vertexSize||2,t.contours[r]);return i.tesselate(t.windingRule||Tess2.WINDING_ODD,t.elementType||Tess2.POLYGONS,t.polySize||3,t.vertexSize||2,t.normal||[0,0,1]),{vertices:i.vertices,vertexIndices:i.vertexIndices,vertexCount:i.vertexCount,elements:i.elements,elementCount:i.elementCount,mesh:e?i.mesh:void 0}};var assert$1=function(t){if(!t)throw"Assertion Failed!"};function TESSvertex(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function TESSface(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function TESShalfEdge(t){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=t}function TESSmesh(){var t=new TESSvertex,e=new TESSface,i=new TESShalfEdge(0),r=new TESShalfEdge(1);t.next=t.prev=t,t.anEdge=null,e.next=e.prev=e,e.anEdge=null,e.trail=null,e.marked=!1,e.inside=!1,i.next=i,i.Sym=r,i.Onext=null,i.Lnext=null,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.next=r,r.Sym=i,r.Onext=null,r.Lnext=null,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,this.vHead=t,this.fHead=e,this.eHead=i,this.eHeadSym=r}TESShalfEdge.prototype={get Rface(){return this.Sym.Lface},set Rface(t){this.Sym.Lface=t},get Dst(){return this.Sym.Org},set Dst(t){this.Sym.Org=t},get Oprev(){return this.Sym.Lnext},set Oprev(t){this.Sym.Lnext=t},get Lprev(){return this.Onext.Sym},set Lprev(t){this.Onext.Sym=t},get Dprev(){return this.Lnext.Sym},set Dprev(t){this.Lnext.Sym=t},get Rprev(){return this.Sym.Onext},set Rprev(t){this.Sym.Onext=t},get Dnext(){return this.Sym.Onext.Sym},set Dnext(t){this.Sym.Onext.Sym=t},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(t){this.Sym.Lnext.Sym=t}},TESSmesh.prototype={makeEdge_:function(t){var e=new TESShalfEdge(0),i=new TESShalfEdge(1);t.Sym.side<t.side&&(t=t.Sym);var r=t.Sym.next;return i.next=r,r.Sym.next=e,e.next=t,t.Sym.next=i,e.Sym=i,e.Onext=e,e.Lnext=i,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,i.Sym=e,i.Onext=i,i.Lnext=e,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,e},splice_:function(t,e){var i=t.Onext,r=e.Onext;i.Sym.Lnext=e,r.Sym.Lnext=t,t.Onext=r,e.Onext=i},makeVertex_:function(t,e,i){var r=t;assert$1(null!==r);var n=i.prev;r.prev=n,n.next=r,r.next=i,i.prev=r,r.anEdge=e;var o=e;do{o.Org=r,o=o.Onext}while(o!==e)},makeFace_:function(t,e,i){var r=t;assert$1(null!==r);var n=i.prev;r.prev=n,n.next=r,r.next=i,i.prev=r,r.anEdge=e,r.trail=null,r.marked=!1,r.inside=i.inside;var o=e;do{o.Lface=r,o=o.Lnext}while(o!==e)},killEdge_:function(t){t.Sym.side<t.side&&(t=t.Sym);var e=t.next,i=t.Sym.next;e.Sym.next=i,i.Sym.next=e},killVertex_:function(t,e){var i=t.anEdge,r=i;do{r.Org=e,r=r.Onext}while(r!==i);var n=t.prev,o=t.next;o.prev=n,n.next=o},killFace_:function(t,e){var i=t.anEdge,r=i;do{r.Lface=e,r=r.Lnext}while(r!==i);var n=t.prev,o=t.next;o.prev=n,n.next=o},makeEdge:function(){var t=new TESSvertex,e=new TESSvertex,i=new TESSface,r=this.makeEdge_(this.eHead);return this.makeVertex_(t,r,this.vHead),this.makeVertex_(e,r.Sym,this.vHead),this.makeFace_(i,r,this.fHead),r},splice:function(t,e){var i=!1,r=!1;if(t!==e){if(e.Org!==t.Org&&(r=!0,this.killVertex_(e.Org,t.Org)),e.Lface!==t.Lface&&(i=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(e,t),!r){var n=new TESSvertex;this.makeVertex_(n,e,t.Org),t.Org.anEdge=t}if(!i){var o=new TESSface;this.makeFace_(o,e,t.Lface),t.Lface.anEdge=t}}},delete:function(t){var e=t.Sym,i=!1;if(t.Lface!==t.Rface&&(i=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!i){var r=new TESSface;this.makeFace_(r,t,t.Lface)}e.Onext===e?(this.killVertex_(e.Org,null),this.killFace_(e.Lface,null)):(t.Lface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(t)},addEdgeVertex:function(t){var e=this.makeEdge_(t),i=e.Sym;this.splice_(e,t.Lnext),e.Org=t.Dst;var r=new TESSvertex;return this.makeVertex_(r,i,e.Org),e.Lface=i.Lface=t.Lface,e},splitEdge:function(t,e){var i=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,i),t.Dst=i.Org,i.Dst.anEdge=i.Sym,i.Rface=t.Rface,i.winding=t.winding,i.Sym.winding=t.Sym.winding,i},connect:function(t,e){var i=!1,r=this.makeEdge_(t),n=r.Sym;if(e.Lface!==t.Lface&&(i=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(r,t.Lnext),this.splice_(n,e),r.Org=t.Dst,n.Org=e.Org,r.Lface=n.Lface=t.Lface,t.Lface.anEdge=n,!i){var o=new TESSface;this.makeFace_(o,r,t.Lface)}return r},zapFace:function(t){var e,i,r,n,o,s=t.anEdge;i=s.Lnext;do{i=(e=i).Lnext,e.Lface=null,null===e.Rface&&(e.Onext===e?this.killVertex_(e.Org,null):(e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),(r=e.Sym).Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),this.killEdge_(e))}while(e!=s);n=t.prev,(o=t.next).prev=n,n.next=o},countFaceVerts_:function(t){var e=t.anEdge,i=0;do{i++,e=e.Lnext}while(e!==t.anEdge);return i},mergeConvexFaces:function(t){var e,i,r,n,o;for(e=this.fHead.next;e!==this.fHead;e=e.next)if(e.inside)for(o=(i=e.anEdge).Org;r=i.Lnext,(n=i.Sym)&&n.Lface&&n.Lface.inside&&this.countFaceVerts_(e)+this.countFaceVerts_(n.Lface)-2<=t&&Geom.vertCCW(i.Lprev.Org,i.Org,n.Lnext.Lnext.Org)&&Geom.vertCCW(n.Lprev.Org,n.Org,i.Lnext.Lnext.Org)&&(r=n.Lnext,this.delete(n),i=null,n=null),!i||i.Lnext.Org!==o;)i=r;return!0},check:function(){var t,e,i,r,n,o,s=this.fHead,a=this.vHead,l=this.eHead;for(e=s,e=s;(t=e.next)!==s;e=t){assert$1(t.prev===e),n=t.anEdge;do{assert$1(n.Sym!==n),assert$1(n.Sym.Sym===n),assert$1(n.Lnext.Onext.Sym===n),assert$1(n.Onext.Sym.Lnext===n),assert$1(n.Lface===t),n=n.Lnext}while(n!==t.anEdge)}for(assert$1(t.prev===e&&null===t.anEdge),r=a,r=a;(i=r.next)!==a;r=i){assert$1(i.prev===r),n=i.anEdge;do{assert$1(n.Sym!==n),assert$1(n.Sym.Sym===n),assert$1(n.Lnext.Onext.Sym===n),assert$1(n.Onext.Sym.Lnext===n),assert$1(n.Org===i),n=n.Onext}while(n!==i.anEdge)}for(assert$1(i.prev===r&&null===i.anEdge),o=l,o=l;(n=o.next)!==l;o=n)assert$1(n.Sym.next===o.Sym),assert$1(n.Sym!==n),assert$1(n.Sym.Sym===n),assert$1(null!==n.Org),assert$1(null!==n.Dst),assert$1(n.Lnext.Onext.Sym===n),assert$1(n.Onext.Sym.Lnext===n);assert$1(n.Sym.next===o.Sym&&n.Sym===this.eHeadSym&&n.Sym.Sym===n&&null===n.Org&&null===n.Dst&&null===n.Lface&&null===n.Rface)}};var Geom={};function DictNode(){this.key=null,this.next=null,this.prev=null}function Dict(t,e){this.head=new DictNode,this.head.next=this.head,this.head.prev=this.head,this.frame=t,this.leq=e}function PQnode(){this.handle=null}function PQhandleElem(){this.key=null,this.node=null}function PriorityQ(t,e){this.size=0,this.max=t,this.nodes=[],this.nodes.length=t+1;for(var i=0;i<this.nodes.length;i++)this.nodes[i]=new PQnode;this.handles=[],this.handles.length=t+1;for(i=0;i<this.handles.length;i++)this.handles[i]=new PQhandleElem;this.initialized=!1,this.freeList=0,this.leq=e,this.nodes[1].handle=1,this.handles[1].key=null}function ActiveRegion(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}Geom.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},Geom.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},Geom.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},Geom.edgeGoesLeft=function(t){return Geom.vertLeq(t.Dst,t.Org)},Geom.edgeGoesRight=function(t){return Geom.vertLeq(t.Org,t.Dst)},Geom.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},Geom.edgeEval=function(t,e,i){assert$1(Geom.vertLeq(t,e)&&Geom.vertLeq(e,i));var r=e.s-t.s,n=i.s-e.s;return r+n>0?r<n?e.t-t.t+(t.t-i.t)*(r/(r+n)):e.t-i.t+(i.t-t.t)*(n/(r+n)):0},Geom.edgeSign=function(t,e,i){assert$1(Geom.vertLeq(t,e)&&Geom.vertLeq(e,i));var r=e.s-t.s,n=i.s-e.s;return r+n>0?(e.t-i.t)*r+(e.t-t.t)*n:0},Geom.transEval=function(t,e,i){assert$1(Geom.transLeq(t,e)&&Geom.transLeq(e,i));var r=e.t-t.t,n=i.t-e.t;return r+n>0?r<n?e.s-t.s+(t.s-i.s)*(r/(r+n)):e.s-i.s+(i.s-t.s)*(n/(r+n)):0},Geom.transSign=function(t,e,i){assert$1(Geom.transLeq(t,e)&&Geom.transLeq(e,i));var r=e.t-t.t,n=i.t-e.t;return r+n>0?(e.s-i.s)*r+(e.s-t.s)*n:0},Geom.vertCCW=function(t,e,i){return t.s*(e.t-i.t)+e.s*(i.t-t.t)+i.s*(t.t-e.t)>=0},Geom.interpolate=function(t,e,i,r){return(t=t<0?0:t)<=(i=i<0?0:i)?0==i?(e+r)/2:e+t/(t+i)*(r-e):r+i/(t+i)*(e-r)},Geom.intersect=function(t,e,i,r,n){var o,s,a;Geom.vertLeq(t,e)||(a=t,t=e,e=a),Geom.vertLeq(i,r)||(a=i,i=r,r=a),Geom.vertLeq(t,i)||(a=t,t=i,i=a,a=e,e=r,r=a),Geom.vertLeq(i,e)?Geom.vertLeq(e,r)?((o=Geom.edgeEval(t,i,e))+(s=Geom.edgeEval(i,e,r))<0&&(o=-o,s=-s),n.s=Geom.interpolate(o,i.s,s,e.s)):((o=Geom.edgeSign(t,i,e))+(s=-Geom.edgeSign(t,r,e))<0&&(o=-o,s=-s),n.s=Geom.interpolate(o,i.s,s,r.s)):n.s=(i.s+e.s)/2,Geom.transLeq(t,e)||(a=t,t=e,e=a),Geom.transLeq(i,r)||(a=i,i=r,r=a),Geom.transLeq(t,i)||(a=t,t=i,i=a,a=e,e=r,r=a),Geom.transLeq(i,e)?Geom.transLeq(e,r)?((o=Geom.transEval(t,i,e))+(s=Geom.transEval(i,e,r))<0&&(o=-o,s=-s),n.t=Geom.interpolate(o,i.t,s,e.t)):((o=Geom.transSign(t,i,e))+(s=-Geom.transSign(t,r,e))<0&&(o=-o,s=-s),n.t=Geom.interpolate(o,i.t,s,r.t)):n.t=(i.t+e.t)/2},Dict.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(t){return this.insertBefore(this.head,t)},search:function(t){var e=this.head;do{e=e.next}while(null!==e.key&&!this.leq(this.frame,t,e.key));return e},insertBefore:function(t,e){do{t=t.prev}while(null!==t.key&&!this.leq(this.frame,t.key,e));var i=new DictNode;return i.key=e,i.next=t.next,t.next.prev=i,i.prev=t,t.next=i,i},delete:function(t){t.next.prev=t.prev,t.prev.next=t.next}},PriorityQ.prototype={floatDown_:function(t){var e,i,r,n=this.nodes,o=this.handles;for(e=n[t].handle;;){if((r=t<<1)<this.size&&this.leq(o[n[r+1].handle].key,o[n[r].handle].key)&&++r,assert$1(r<=this.max),i=n[r].handle,r>this.size||this.leq(o[e].key,o[i].key)){n[t].handle=e,o[e].node=t;break}n[t].handle=i,o[i].node=t,t=r}},floatUp_:function(t){var e,i,r,n=this.nodes,o=this.handles;for(e=n[t].handle;;){if(i=n[r=t>>1].handle,0==r||this.leq(o[i].key,o[e].key)){n[t].handle=e,o[e].node=t;break}n[t].handle=i,o[i].node=t,t=r}},init:function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){this.size},insert:function(t){var e,i;if(2*(e=++this.size)>this.max){var r;this.max*=2,r=this.nodes.length,this.nodes.length=this.max+1;for(var n=r;n<this.nodes.length;n++)this.nodes[n]=new PQnode;r=this.handles.length,this.handles.length=this.max+1;for(n=r;n<this.handles.length;n++)this.handles[n]=new PQhandleElem}return 0===this.freeList?i=e:(i=this.freeList,this.freeList=this.handles[i].node),this.nodes[e].handle=i,this.handles[i].node=e,this.handles[i].key=t,this.initialized&&this.floatUp_(e),i},extractMin:function(){var t=this.nodes,e=this.handles,i=t[1].handle,r=e[i].key;return this.size>0&&(t[1].handle=t[this.size].handle,e[t[1].handle].node=1,e[i].key=null,e[i].node=this.freeList,this.freeList=i,--this.size,this.size>0&&this.floatDown_(1)),r},delete:function(t){var e,i=this.nodes,r=this.handles;assert$1(t>=1&&t<=this.max&&null!==r[t].key),i[e=r[t].node].handle=i[this.size].handle,r[i[e].handle].node=e,--this.size,e<=this.size&&(e<=1||this.leq(r[i[e>>1].handle].key,r[i[e].handle].key)?this.floatDown_(e):this.floatUp_(e)),r[t].key=null,r[t].node=this.freeList,this.freeList=t}};var Sweep={};function Tesselator(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Tess2.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}Sweep.regionBelow=function(t){return t.nodeUp.prev.key},Sweep.regionAbove=function(t){return t.nodeUp.next.key},Sweep.debugEvent=function(t){},Sweep.addWinding=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},Sweep.edgeLeq=function(t,e,i){var r=t.event,n=e.eUp,o=i.eUp;return n.Dst===r?o.Dst===r?Geom.vertLeq(n.Org,o.Org)?Geom.edgeSign(o.Dst,n.Org,o.Org)<=0:Geom.edgeSign(n.Dst,o.Org,n.Org)>=0:Geom.edgeSign(o.Dst,r,o.Org)<=0:o.Dst===r?Geom.edgeSign(n.Dst,r,n.Org)>=0:Geom.edgeEval(n.Dst,r,n.Org)>=Geom.edgeEval(o.Dst,r,o.Org)},Sweep.deleteRegion=function(t,e){e.fixUpperEdge&&assert$1(0===e.eUp.winding),e.eUp.activeRegion=null,t.dict.delete(e.nodeUp)},Sweep.fixUpperEdge=function(t,e,i){assert$1(e.fixUpperEdge),t.mesh.delete(e.eUp),e.fixUpperEdge=!1,e.eUp=i,i.activeRegion=e},Sweep.topLeftRegion=function(t,e){var i,r=e.eUp.Org;do{e=Sweep.regionAbove(e)}while(e.eUp.Org===r);if(e.fixUpperEdge){if(null===(i=t.mesh.connect(Sweep.regionBelow(e).eUp.Sym,e.eUp.Lnext)))return null;Sweep.fixUpperEdge(t,e,i),e=Sweep.regionAbove(e)}return e},Sweep.topRightRegion=function(t){var e=t.eUp.Dst;t=null;do{t=Sweep.regionAbove(t)}while(t.eUp.Dst===e);return t},Sweep.addRegionBelow=function(t,e,i){var r=new ActiveRegion;return r.eUp=i,r.nodeUp=t.dict.insertBefore(e.nodeUp,r),r.fixUpperEdge=!1,r.sentinel=!1,r.dirty=!1,i.activeRegion=r,r},Sweep.isWindingInside=function(t,e){switch(t.windingRule){case Tess2.WINDING_ODD:return 0!=(1&e);case Tess2.WINDING_NONZERO:return 0!=e;case Tess2.WINDING_POSITIVE:return e>0;case Tess2.WINDING_NEGATIVE:return e<0;case Tess2.WINDING_ABS_GEQ_TWO:return e>=2||e<=-2}return assert$1(!1),!1},Sweep.computeWinding=function(t,e){e.windingNumber=Sweep.regionAbove(e).windingNumber+e.eUp.winding,e.inside=Sweep.isWindingInside(t,e.windingNumber)},Sweep.finishRegion=function(t,e){var i=e.eUp,r=i.Lface;r.inside=e.inside,r.anEdge=i,Sweep.deleteRegion(t,e)},Sweep.finishLeftRegions=function(t,e,i){for(var r,n=null,o=e,s=e.eUp;o!==i;){if(o.fixUpperEdge=!1,(r=(n=Sweep.regionBelow(o)).eUp).Org!=s.Org){if(!n.fixUpperEdge){Sweep.finishRegion(t,o);break}r=t.mesh.connect(s.Lprev,r.Sym),Sweep.fixUpperEdge(t,n,r)}s.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(s,r)),Sweep.finishRegion(t,o),s=n.eUp,o=n}return s},Sweep.addRightEdges=function(t,e,i,r,n,o){var s,a,l,h,c=!0;l=i;do{assert$1(Geom.vertLeq(l.Org,l.Dst)),Sweep.addRegionBelow(t,e,l.Sym),l=l.Onext}while(l!==r);for(null===n&&(n=Sweep.regionBelow(e).eUp.Rprev),a=e,h=n;(l=(s=Sweep.regionBelow(a)).eUp.Sym).Org===h.Org;)l.Onext!==h&&(t.mesh.splice(l.Oprev,l),t.mesh.splice(h.Oprev,l)),s.windingNumber=a.windingNumber-l.winding,s.inside=Sweep.isWindingInside(t,s.windingNumber),a.dirty=!0,!c&&Sweep.checkForRightSplice(t,a)&&(Sweep.addWinding(l,h),Sweep.deleteRegion(t,a),t.mesh.delete(h)),c=!1,a=s,h=l;a.dirty=!0,assert$1(a.windingNumber-l.winding===s.windingNumber),o&&Sweep.walkDirtyRegions(t,a)},Sweep.spliceMergeVertices=function(t,e,i){t.mesh.splice(e,i)},Sweep.vertexWeights=function(t,e,i){var r=Geom.vertL1dist(e,t),n=Geom.vertL1dist(i,t),o=.5*n/(r+n),s=.5*r/(r+n);t.coords[0]+=o*e.coords[0]+s*i.coords[0],t.coords[1]+=o*e.coords[1]+s*i.coords[1],t.coords[2]+=o*e.coords[2]+s*i.coords[2]},Sweep.getIntersectData=function(t,e,i,r,n,o){e.coords[0]=e.coords[1]=e.coords[2]=0,e.idx=-1,Sweep.vertexWeights(e,i,r),Sweep.vertexWeights(e,n,o)},Sweep.checkForRightSplice=function(t,e){var i=Sweep.regionBelow(e),r=e.eUp,n=i.eUp;if(Geom.vertLeq(r.Org,n.Org)){if(Geom.edgeSign(n.Dst,r.Org,n.Org)>0)return!1;Geom.vertEq(r.Org,n.Org)?r.Org!==n.Org&&(t.pq.delete(r.Org.pqHandle),Sweep.spliceMergeVertices(t,n.Oprev,r)):(t.mesh.splitEdge(n.Sym),t.mesh.splice(r,n.Oprev),e.dirty=i.dirty=!0)}else{if(Geom.edgeSign(r.Dst,n.Org,r.Org)<0)return!1;Sweep.regionAbove(e).dirty=e.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(n.Oprev,r)}return!0},Sweep.checkForLeftSplice=function(t,e){var i,r=Sweep.regionBelow(e),n=e.eUp,o=r.eUp;if(assert$1(!Geom.vertEq(n.Dst,o.Dst)),Geom.vertLeq(n.Dst,o.Dst)){if(Geom.edgeSign(n.Dst,o.Dst,n.Org)<0)return!1;Sweep.regionAbove(e).dirty=e.dirty=!0,i=t.mesh.splitEdge(n),t.mesh.splice(o.Sym,i),i.Lface.inside=e.inside}else{if(Geom.edgeSign(o.Dst,n.Dst,o.Org)>0)return!1;e.dirty=r.dirty=!0,i=t.mesh.splitEdge(o),t.mesh.splice(n.Lnext,o.Sym),i.Rface.inside=e.inside}return!0},Sweep.checkForIntersect=function(t,e){var i,r,n=Sweep.regionBelow(e),o=e.eUp,s=n.eUp,a=o.Org,l=s.Org,h=o.Dst,c=s.Dst,u=new TESSvertex;if(assert$1(!Geom.vertEq(c,h)),assert$1(Geom.edgeSign(h,t.event,a)<=0),assert$1(Geom.edgeSign(c,t.event,l)>=0),assert$1(a!==t.event&&l!==t.event),assert$1(!e.fixUpperEdge&&!n.fixUpperEdge),a===l)return!1;if(Math.min(a.t,h.t)>Math.max(l.t,c.t))return!1;if(Geom.vertLeq(a,l)){if(Geom.edgeSign(c,a,l)>0)return!1}else if(Geom.edgeSign(h,l,a)<0)return!1;return Sweep.debugEvent(t),Geom.intersect(h,a,c,l,u),assert$1(Math.min(a.t,h.t)<=u.t),assert$1(u.t<=Math.max(l.t,c.t)),assert$1(Math.min(c.s,h.s)<=u.s),assert$1(u.s<=Math.max(l.s,a.s)),Geom.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t),i=Geom.vertLeq(a,l)?a:l,Geom.vertLeq(i,u)&&(u.s=i.s,u.t=i.t),Geom.vertEq(u,a)||Geom.vertEq(u,l)?(Sweep.checkForRightSplice(t,e),!1):!Geom.vertEq(h,t.event)&&Geom.edgeSign(h,t.event,u)>=0||!Geom.vertEq(c,t.event)&&Geom.edgeSign(c,t.event,u)<=0?c===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(s.Sym,o),e=Sweep.topLeftRegion(t,e),o=Sweep.regionBelow(e).eUp,Sweep.finishLeftRegions(t,Sweep.regionBelow(e),n),Sweep.addRightEdges(t,e,o.Oprev,o,o,!0),TRUE):h===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Lnext,s.Oprev),n=e,e=Sweep.topRightRegion(e),r=Sweep.regionBelow(e).eUp.Rprev,n.eUp=s.Oprev,s=Sweep.finishLeftRegions(t,n,null),Sweep.addRightEdges(t,e,s.Onext,o.Rprev,r,!0),!0):(Geom.edgeSign(h,t.event,u)>=0&&(Sweep.regionAbove(e).dirty=e.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),Geom.edgeSign(c,t.event,u)<=0&&(e.dirty=n.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(o.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,o),o.Org.s=u.s,o.Org.t=u.t,o.Org.pqHandle=t.pq.insert(o.Org),Sweep.getIntersectData(t,o.Org,a,h,l,c),Sweep.regionAbove(e).dirty=e.dirty=n.dirty=!0,!1)},Sweep.walkDirtyRegions=function(t,e){for(var i,r,n=Sweep.regionBelow(e);;){for(;n.dirty;)e=n,n=Sweep.regionBelow(n);if(!e.dirty&&(n=e,null==(e=Sweep.regionAbove(e))||!e.dirty))return;if(e.dirty=!1,i=e.eUp,r=n.eUp,i.Dst!==r.Dst&&Sweep.checkForLeftSplice(t,e)&&(n.fixUpperEdge?(Sweep.deleteRegion(t,n),t.mesh.delete(r),r=(n=Sweep.regionBelow(e)).eUp):e.fixUpperEdge&&(Sweep.deleteRegion(t,e),t.mesh.delete(i),i=(e=Sweep.regionAbove(n)).eUp)),i.Org!==r.Org)if(i.Dst===r.Dst||e.fixUpperEdge||n.fixUpperEdge||i.Dst!==t.event&&r.Dst!==t.event)Sweep.checkForRightSplice(t,e);else if(Sweep.checkForIntersect(t,e))return;i.Org===r.Org&&i.Dst===r.Dst&&(Sweep.addWinding(r,i),Sweep.deleteRegion(t,e),t.mesh.delete(i),e=Sweep.regionAbove(n))}},Sweep.connectRightVertex=function(t,e,i){var r,n=i.Onext,o=Sweep.regionBelow(e),s=e.eUp,a=o.eUp,l=!1;s.Dst!==a.Dst&&Sweep.checkForIntersect(t,e),Geom.vertEq(s.Org,t.event)&&(t.mesh.splice(n.Oprev,s),e=Sweep.topLeftRegion(t,e),n=Sweep.regionBelow(e).eUp,Sweep.finishLeftRegions(t,Sweep.regionBelow(e),o),l=!0),Geom.vertEq(a.Org,t.event)&&(t.mesh.splice(i,a.Oprev),i=Sweep.finishLeftRegions(t,o,null),l=!0),l?Sweep.addRightEdges(t,e,i.Onext,n,n,!0):(r=Geom.vertLeq(a.Org,s.Org)?a.Oprev:s,r=t.mesh.connect(i.Lprev,r),Sweep.addRightEdges(t,e,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,Sweep.walkDirtyRegions(t,e))},Sweep.connectLeftDegenerate=function(t,e,i){var r,n,o,s,a;return r=e.eUp,Geom.vertEq(r.Org,i)?(assert$1(!1),void Sweep.spliceMergeVertices(t,r,i.anEdge)):Geom.vertEq(r.Dst,i)?(assert$1(!1),e=Sweep.topRightRegion(e),n=s=(o=(a=Sweep.regionBelow(e)).eUp.Sym).Onext,a.fixUpperEdge&&(assert$1(n!==o),Sweep.deleteRegion(t,a),t.mesh.delete(o),o=n.Oprev),t.mesh.splice(i.anEdge,o),Geom.edgeGoesLeft(n)||(n=null),void Sweep.addRightEdges(t,e,o.Onext,s,n,!0)):(t.mesh.splitEdge(r.Sym),e.fixUpperEdge&&(t.mesh.delete(r.Onext),e.fixUpperEdge=!1),t.mesh.splice(i.anEdge,r),void Sweep.sweepEvent(t,i))},Sweep.connectLeftVertex=function(t,e){var i,r,n,o,s,a,l=new ActiveRegion;if(l.eUp=e.anEdge.Sym,i=t.dict.search(l).key,r=Sweep.regionBelow(i))if(o=i.eUp,s=r.eUp,0!==Geom.edgeSign(o.Dst,e,o.Org))if(n=Geom.vertLeq(s.Dst,o.Dst)?i:r,i.inside||n.fixUpperEdge){if(n===i)a=t.mesh.connect(e.anEdge.Sym,o.Lnext);else a=t.mesh.connect(s.Dnext,e.anEdge).Sym;n.fixUpperEdge?Sweep.fixUpperEdge(t,n,a):Sweep.computeWinding(t,Sweep.addRegionBelow(t,i,a)),Sweep.sweepEvent(t,e)}else Sweep.addRightEdges(t,i,e.anEdge,e.anEdge,null,!0);else Sweep.connectLeftDegenerate(t,i,e)},Sweep.sweepEvent=function(t,e){t.event=e,Sweep.debugEvent(t);for(var i=e.anEdge;null===i.activeRegion;)if((i=i.Onext)==e.anEdge)return void Sweep.connectLeftVertex(t,e);var r=Sweep.topLeftRegion(t,i.activeRegion);assert$1(null!==r);var n=Sweep.regionBelow(r),o=n.eUp,s=Sweep.finishLeftRegions(t,n,null);s.Onext===o?Sweep.connectRightVertex(t,r,s):Sweep.addRightEdges(t,r,s.Onext,o,o,!0)},Sweep.addSentinel=function(t,e,i,r){var n=new ActiveRegion,o=t.mesh.makeEdge();o.Org.s=i,o.Org.t=r,o.Dst.s=e,o.Dst.t=r,t.event=o.Dst,n.eUp=o,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=t.dict.insert(n)},Sweep.initEdgeDict=function(t){t.dict=new Dict(t,Sweep.edgeLeq);var e=t.bmax[0]-t.bmin[0],i=t.bmax[1]-t.bmin[1],r=t.bmin[0]-e,n=t.bmax[0]+e,o=t.bmin[1]-i,s=t.bmax[1]+i;Sweep.addSentinel(t,r,n,o),Sweep.addSentinel(t,r,n,s)},Sweep.doneEdgeDict=function(t){for(var e,i=0;null!==(e=t.dict.min().key);)e.sentinel||(assert$1(e.fixUpperEdge),assert$1(1==++i)),assert$1(0==e.windingNumber),Sweep.deleteRegion(t,e)},Sweep.removeDegenerateEdges=function(t){var e,i,r,n=t.mesh.eHead;for(e=n.next;e!==n;e=i)i=e.next,r=e.Lnext,Geom.vertEq(e.Org,e.Dst)&&e.Lnext.Lnext!==e&&(Sweep.spliceMergeVertices(t,r,e),t.mesh.delete(e),r=(e=r).Lnext),r.Lnext===e&&(r!==e&&(r!==i&&r!==i.Sym||(i=i.next),t.mesh.delete(r)),e!==i&&e!==i.Sym||(i=i.next),t.mesh.delete(e))},Sweep.initPriorityQ=function(t){var e,i,r,n=0;for(i=(r=t.mesh.vHead).next;i!==r;i=i.next)n++;for(n+=8,e=t.pq=new PriorityQ(n,Geom.vertLeq),i=(r=t.mesh.vHead).next;i!==r;i=i.next)i.pqHandle=e.insert(i);return i===r&&(e.init(),!0)},Sweep.donePriorityQ=function(t){t.pq=null},Sweep.removeDegenerateFaces=function(t,e){var i,r,n;for(i=e.fHead.next;i!==e.fHead;i=r)r=i.next,n=i.anEdge,assert$1(n.Lnext!==n),n.Lnext.Lnext===n&&(Sweep.addWinding(n.Onext,n),t.mesh.delete(n));return!0},Sweep.computeInterior=function(t){var e,i;if(Sweep.removeDegenerateEdges(t),!Sweep.initPriorityQ(t))return!1;for(Sweep.initEdgeDict(t);null!==(e=t.pq.extractMin());){for(;null!==(i=t.pq.min())&&Geom.vertEq(i,e);)i=t.pq.extractMin(),Sweep.spliceMergeVertices(t,e.anEdge,i.anEdge);Sweep.sweepEvent(t,e)}return t.event=t.dict.min().key.eUp.Org,Sweep.debugEvent(t),Sweep.doneEdgeDict(t),Sweep.donePriorityQ(t),!!Sweep.removeDegenerateFaces(t,t.mesh)&&(t.mesh.check(),!0)},Tesselator.prototype={dot_:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},normalize_:function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];assert$1(e>0),e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},longAxis_:function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},computeNormal_:function(t){var e,i,r,n,o,s,a,l=[0,0,0],h=[0,0,0],c=[0,0,0],u=[0,0,0],p=[0,0,0],d=[null,null,null],f=[null,null,null],_=this.mesh.vHead;for(e=_.next,a=0;a<3;++a)n=e.coords[a],h[a]=n,f[a]=e,l[a]=n,d[a]=e;for(e=_.next;e!==_;e=e.next)for(a=0;a<3;++a)(n=e.coords[a])<h[a]&&(h[a]=n,f[a]=e),n>l[a]&&(l[a]=n,d[a]=e);if(a=0,l[1]-h[1]>l[0]-h[0]&&(a=1),l[2]-h[2]>l[a]-h[a]&&(a=2),h[a]>=l[a])return t[0]=0,t[1]=0,void(t[2]=1);for(s=0,i=f[a],r=d[a],c[0]=i.coords[0]-r.coords[0],c[1]=i.coords[1]-r.coords[1],c[2]=i.coords[2]-r.coords[2],e=_.next;e!==_;e=e.next)u[0]=e.coords[0]-r.coords[0],u[1]=e.coords[1]-r.coords[1],u[2]=e.coords[2]-r.coords[2],p[0]=c[1]*u[2]-c[2]*u[1],p[1]=c[2]*u[0]-c[0]*u[2],p[2]=c[0]*u[1]-c[1]*u[0],(o=p[0]*p[0]+p[1]*p[1]+p[2]*p[2])>s&&(s=o,t[0]=p[0],t[1]=p[1],t[2]=p[2]);s<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(c)]=1)},checkOrientation_:function(){var t,e,i,r,n=this.mesh.fHead,o=this.mesh.vHead;for(t=0,e=n.next;e!==n;e=e.next)if(!((r=e.anEdge).winding<=0))do{t+=(r.Org.s-r.Dst.s)*(r.Org.t+r.Dst.t),r=r.Lnext}while(r!==e.anEdge);if(t<0){for(i=o.next;i!==o;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var t,e,i,r,n,o=this.mesh.vHead,s=[0,0,0],a=!1;for(s[0]=this.normal[0],s[1]=this.normal[1],s[2]=this.normal[2],0===s[0]&&0===s[1]&&0===s[2]&&(this.computeNormal_(s),a=!0),e=this.sUnit,i=this.tUnit,e[r=this.longAxis_(s)]=0,e[(r+1)%3]=1,e[(r+2)%3]=0,i[r]=0,i[(r+1)%3]=0,i[(r+2)%3]=s[r]>0?1:-1,t=o.next;t!==o;t=t.next)t.s=this.dot_(t.coords,e),t.t=this.dot_(t.coords,i);for(a&&this.checkOrientation_(),n=!0,t=o.next;t!==o;t=t.next)n?(this.bmin[0]=this.bmax[0]=t.s,this.bmin[1]=this.bmax[1]=t.t,n=!1):(t.s<this.bmin[0]&&(this.bmin[0]=t.s),t.s>this.bmax[0]&&(this.bmax[0]=t.s),t.t<this.bmin[1]&&(this.bmin[1]=t.t),t.t>this.bmax[1]&&(this.bmax[1]=t.t))},addWinding_:function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},tessellateMonoRegion_:function(t,e){var i,r;for(i=e.anEdge,assert$1(i.Lnext!==i&&i.Lnext.Lnext!==i);Geom.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;Geom.vertLeq(i.Org,i.Dst);i=i.Lnext);for(r=i.Lprev;i.Lnext!==r;)if(Geom.vertLeq(i.Dst,r.Org)){for(;r.Lnext!==i&&(Geom.edgeGoesLeft(r.Lnext)||Geom.edgeSign(r.Org,r.Dst,r.Lnext.Dst)<=0);){r=t.connect(r.Lnext,r).Sym}r=r.Lprev}else{for(;r.Lnext!=i&&(Geom.edgeGoesRight(i.Lprev)||Geom.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0);){i=t.connect(i,i.Lprev).Sym}i=i.Lnext}for(assert$1(r.Lnext!==i);r.Lnext.Lnext!==i;){r=t.connect(r.Lnext,r).Sym}return!0},tessellateInterior_:function(t){var e,i;for(e=t.fHead.next;e!==t.fHead;e=i)if(i=e.next,e.inside&&!this.tessellateMonoRegion_(t,e))return!1;return!0},discardExterior_:function(t){var e,i;for(e=t.fHead.next;e!==t.fHead;e=i)i=e.next,e.inside||t.zapFace(e)},setWindingNumber_:function(t,e,i){var r,n;for(r=t.eHead.next;r!==t.eHead;r=n)n=r.next,r.Rface.inside!==r.Lface.inside?r.winding=r.Lface.inside?e:-e:i?t.delete(r):r.winding=0},getNeighbourFace_:function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},outputPolymesh_:function(t,e,i,r){var n,o,s,a,l,h=0,c=0;for(i>3&&t.mergeConvexFaces(i),n=t.vHead.next;n!==t.vHead;n=n.next)n.n=-1;for(o=t.fHead.next;o!=t.fHead;o=o.next)if(o.n=-1,o.inside){s=o.anEdge,a=0;do{-1===(n=s.Org).n&&(n.n=c,c++),a++,s=s.Lnext}while(s!==o.anEdge);assert$1(a<=i),o.n=h,++h}for(this.elementCount=h,e==Tess2.CONNECTED_POLYGONS&&(h*=2),this.elements=[],this.elements.length=h*i,this.vertexCount=c,this.vertices=[],this.vertices.length=c*r,this.vertexIndices=[],this.vertexIndices.length=c,n=t.vHead.next;n!==t.vHead;n=n.next)if(-1!=n.n){var u=n.n*r;this.vertices[u+0]=n.coords[0],this.vertices[u+1]=n.coords[1],r>2&&(this.vertices[u+2]=n.coords[2]),this.vertexIndices[n.n]=n.idx}var p=0;for(o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){s=o.anEdge,a=0;do{n=s.Org,this.elements[p++]=n.n,a++,s=s.Lnext}while(s!==o.anEdge);for(l=a;l<i;++l)this.elements[p++]=-1;if(e==Tess2.CONNECTED_POLYGONS){s=o.anEdge;do{this.elements[p++]=this.getNeighbourFace_(s),s=s.Lnext}while(s!==o.anEdge);for(l=a;l<i;++l)this.elements[p++]=-1}}},outputContours_:function(t,e){var i,r,n,o=0,s=0;for(this.vertexCount=0,this.elementCount=0,i=t.fHead.next;i!==t.fHead;i=i.next)if(i.inside){n=r=i.anEdge;do{this.vertexCount++,r=r.Lnext}while(r!==n);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*e,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var a=0,l=0,h=0;for(o=0,i=t.fHead.next;i!==t.fHead;i=i.next)if(i.inside){s=0,n=r=i.anEdge;do{this.vertices[a++]=r.Org.coords[0],this.vertices[a++]=r.Org.coords[1],e>2&&(this.vertices[a++]=r.Org.coords[2]),this.vertexIndices[l++]=r.Org.idx,s++,r=r.Lnext}while(r!==n);this.elements[h++]=o,this.elements[h++]=s,o+=s}},addContour:function(t,e){var i,r;for(null===this.mesh&&(this.mesh=new TESSmesh),t<2&&(t=2),t>3&&(t=3),i=null,r=0;r<e.length;r+=t)null==i?(i=this.mesh.makeEdge(),this.mesh.splice(i,i.Sym)):(this.mesh.splitEdge(i),i=i.Lnext),i.Org.coords[0]=e[r+0],i.Org.coords[1]=e[r+1],i.Org.coords[2]=t>2?e[r+2]:0,i.Org.idx=this.vertexIndexCounter++,i.winding=1,i.Sym.winding=-1},tesselate:function(t,e,i,r,n){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,n&&(this.normal[0]=n[0],this.normal[1]=n[1],this.normal[2]=n[2]),this.windingRule=t,r<2&&(r=2),r>3&&(r=3),!this.mesh)return!1;this.projectPolygon_(),Sweep.computeInterior(this);var o=this.mesh;return e==Tess2.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),o.check(),e==Tess2.BOUNDARY_CONTOURS?this.outputContours_(o,r):this.outputPolymesh_(o,e,i,r),!0}};var tess2$1=tess2,GraphicsFactoryFills=function(){function t(){}return t.draw_pathes=function(e){var i=e.queued_fill_pathes.length,r=0;for(r=0;r<i;r++){var n=t.pathToAttributesBuffer(e.queued_fill_pathes[r]);if(n&&n.length>0){var o,s=new TriangleElements(n);if(s.setPositions(new Float2Attributes(n)),e.queued_fill_pathes[r].style.data_type==GraphicsFillStyle.data_type){u=(l=Graphics.get_material_for_color(e.queued_fill_pathes[r].style.color,e.queued_fill_pathes[r].style.alpha)).material;var a=e.addShape(Shape.getShape(s,u));l.colorPos&&(a.style=new Style,o=new ImageSampler,u.animateUVs=!0,a.style.addSamplerAt(o,u.getTextureAt(0)),a.style.uvMatrix=new Matrix(0,0,0,0,l.colorPos.x,l.colorPos.y))}else if(e.queued_fill_pathes[r].style.data_type==GradientFillStyle.data_type){var l,h=e.queued_fill_pathes[r].style;u=(l=Graphics.get_material_for_gradient(h)).material,(a=e.addShape(Shape.getShape(s,u))).style=new Style,o=new ImageSampler,a.style.addSamplerAt(o,u.getTextureAt(0)),u.animateUVs=!0,a.style.uvMatrix=h.getUVMatrix(),h.type==GradientType.LINEAR?u.getTextureAt(0).mappingMode=MappingMode.LINEAR:h.type==GradientType.RADIAL&&(o.imageRect=h.uvRectangle,u.imageRect=!0,u.getTextureAt(0).mappingMode=MappingMode.RADIAL)}else if(e.queued_fill_pathes[r].style.data_type==BitmapFillStyle.data_type){var c=e.queued_fill_pathes[r].style,u=c.material;(a=e.addShape(Shape.getShape(s,u))).style=new Style,(o=new ImageSampler).mipmap=!0,o.smooth=!0,o.repeat=c.repeat,a.style.addSamplerAt(o,u.getTextureAt(0)),u.animateUVs=!0,a.style.uvMatrix=c.getUVMatrix()}}}e.queued_fill_pathes.length=0},t.pathToAttributesBuffer=function(t,e){t.prepare();var i,r,n,o,s=t._positions,a=0,l=0,h=[],c=0,u=[],p=0,d=0,f=0,_=0,g=0,m=0,y=0;for(l=0;l<s.length;l++)(i=s[l])[0]==i[i.length-2]&&i[1]==i[i.length-1]&&(i.pop(),i.pop()),i.length>5&&(u[u.length]=i);try{for(p=(r=tess2$1.tesselate({contours:u,windingRule:tess2$1.WINDING_ODD,elementType:tess2$1.POLYGONS,polySize:3,vertexSize:2})).elements.length/3,d=0,f=0,_=0,g=0,m=0,y=0,a=0;a<p;++a)d=r.vertices[2*r.elements[3*a]],f=r.vertices[2*r.elements[3*a]+1],_=r.vertices[2*r.elements[3*a+1]],g=r.vertices[2*r.elements[3*a+1]+1],m=r.vertices[2*r.elements[3*a+2]],y=r.vertices[2*r.elements[3*a+2]+1],GraphicsFactoryHelper.isClockWiseXY(d,f,_,g,m,y)?(h[c++]=m,h[c++]=y,h[c++]=_,h[c++]=g,h[c++]=d,h[c++]=f):(h[c++]=d,h[c++]=f,h[c++]=_,h[c++]=g,h[c++]=m,h[c++]=y)}catch(t){console.log("error when trying to tesselate",u)}return(h=h.concat(t.verts)).length>0?((n=new AttributesView(Float32Array,2)).set(h),o=n.attributesBuffer.cloneBufferView(),n.dispose(),o):null},t}(),ElementsType=function(){function t(){}return t.TRIANGLE="triangle",t.LINE="line",t}(),TextureAtlas=function(){function t(){this.availableRows=256,this.gradient_row=-1,this.color_row=255,this.color_position=256,this.availableGradients=256,this.availableColors=0,this.bitmap=new BitmapImage2D(256,256,!1,16711680),this.availableRows=256,this.availableColors=0}return t.clearAllMaterials=function(){for(var e in t._allColors)t._allColors[e].material=null;for(var e in t._allGradients)t._allGradients[e].material=null},t.getTextureForColor=function(e,i){var r=e.toString()+"#"+i.toString();if(t._allColors.hasOwnProperty(r))return t._allColors[r];var n,o=t._allTextureAtlas.length,s=0;for(s=0;s<o;s++)if(t._allTextureAtlas[s].fit_color()){n=t._allTextureAtlas[s];break}n||(n=new t,t._allTextureAtlas.push(n));var a={};return a.colorPos=n.draw_color(e,i),a.bitmap=n.bitmap,t._allColors[r]=a,a},t.getTextureForGradient=function(e){var i=e.toString();if(t._allGradients.hasOwnProperty(i))return e.uvRectangle=t._allGradients[i].uvRectangle,t._allGradients[i];var r,n=t._allTextureAtlas.length,o=0;for(o=0;o<n;o++)if(t._allTextureAtlas[o].fit_gradient()){r=t._allTextureAtlas[o];break}r||(r=new t,t._allTextureAtlas.push(r));var s={};return r.draw_gradient(e),s.uvRectangle=new Rectangle,s.uvRectangle.copyFrom(e.uvRectangle),s.bitmap=r.bitmap,t._allGradients[i]=s,s},t.prototype.fit_gradient=function(){return this.availableRows>0},t.prototype.fit_color=function(){return this.availableColors>0||this.availableRows>0},t.prototype.draw_gradient=function(t){if(!(this.availableRows<0)){var e;for(this.gradient_row++,this.availableRows--,e=0;e<256;e++)this.bitmap.setPixelFromArray(e,this.gradient_row,t.getColorAtPosition(e));return this.bitmap.invalidate(),t.uvRectangle.x=1/512,t.uvRectangle.y=1/512+this.gradient_row/256,t.uvRectangle.width=1-1/512,t.uvRectangle.height=t.uvRectangle.y,this.availableRows}console.log("error in TextureAtlasManager.draw_color")},t.prototype.draw_color=function(t,e){void 0===e&&(e=1),this.color_position--,this.color_position<0&&(this.availableRows>0?(this.color_row--,this.availableRows--,this.color_position=255):console.log("error in TextureAtlasManager.draw_color"));var i=ColorUtils.float32ColorToARGB(t);return i[0]=e,this.bitmap.setPixelFromArray(this.color_position,this.color_row,i),this.bitmap.invalidate(),new Point(1/512+this.color_position/256,1/512+this.color_row/256)},t._allTextureAtlas=[],t._allGradients={},t._allColors={},t}(),ParticleGraphicsTransform=function(){function t(){}return Object.defineProperty(t.prototype,"vertexTransform",{get:function(){return this._defaultVertexTransform},set:function(t){this._defaultVertexTransform=t,this._defaultInvVertexTransform=t.clone(),this._defaultInvVertexTransform.invert(),this._defaultInvVertexTransform.transpose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UVTransform",{get:function(){return this._defaultUVTransform},set:function(t){this._defaultUVTransform=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invVertexTransform",{get:function(){return this._defaultInvVertexTransform},enumerable:!0,configurable:!0}),t}();console.debug("AwayJS - Graphics - 0.4.21");var DisplayObjectEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._object=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"object",{get:function(){return this._object},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._object)},e.VISIBLITY_UPDATED="visiblityUpdated",e.SCENETRANSFORM_CHANGED="scenetransformChanged",e.PARTITION_CHANGED="partitionChanged",e}(EventBase),FocusEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.clone=function(){var t=new e(this.type);return t.view=this.view,t.entity=this.entity,t},e.FOCUS_IN="focusIn3d",e.FOCUS_OUT="focusOut3d",e}(EventBase),PrefabBase=function(t){function e(){var e=t.call(this)||this;return e._pObjects=new Array,e}return __extends(e,t),e.prototype.getNewObject=function(){var t=this._pCreateObject();return this._pObjects.push(t),t},e.prototype._pCreateObject=function(){throw new AbstractMethodError},e.prototype._iValidate=function(){},e}(AssetBase),PrimitivePrefabBase=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i="triangle");var r=t.call(this)||this;if(r._primitiveDirty=!0,r._uvDirty=!0,r._scaleU=1,r._scaleV=1,r._material=e,r._elementsType=i,r._elementsType==ElementsType.TRIANGLE){var n=new TriangleElements(new AttributesBuffer);n.autoDeriveNormals=!1,n.autoDeriveTangents=!1,r._elements=n}else r._elementsType==ElementsType.LINE&&(r._elements=new LineElements(new AttributesBuffer));return r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsType",{get:function(){return this._elementsType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(t){if(t!=this._material){this._material=t;for(var e=this._pObjects.length,i=0;i<e;i++)this._pObjects[i].material=this._material}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleU",{get:function(){return this._scaleU},set:function(t){this._scaleU!=t&&(this._scaleU=t,this._pInvalidateUVs())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleV",{get:function(){return this._scaleV},set:function(t){this._scaleV!=t&&(this._scaleV=t,this._pInvalidateUVs())},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){throw new AbstractMethodError},e.prototype._pBuildUVs=function(t,e){throw new AbstractMethodError},e.prototype._pInvalidatePrimitive=function(){this._primitiveDirty=!0},e.prototype._pInvalidateUVs=function(){this._uvDirty=!0},e.prototype.updateGraphics=function(){this._pBuildGraphics(this._elements,this._elementsType),this._primitiveDirty=!1},e.prototype.updateUVs=function(){this._pBuildUVs(this._elements,this._elementsType),this._uvDirty=!1},e.prototype._iValidate=function(){this._primitiveDirty&&this.updateGraphics(),this._uvDirty&&this.updateUVs()},e.prototype._pCreateObject=function(){var t=new Sprite(null,this._material);return t.graphics.addShape(Shape.getShape(this._elements)),t._iSourcePrefab=this,t},e.assetType="[asset PrimitivePrefab]",e}(PrefabBase),PrimitiveCubePrefab=function(t){function e(e,i,r,n,o,s,a,l,h){void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=100),void 0===n&&(n=100),void 0===o&&(o=100),void 0===s&&(s=1),void 0===a&&(a=1),void 0===l&&(l=1),void 0===h&&(h=!0);var c=t.call(this,e,i)||this;return c._width=r,c._height=n,c._depth=o,c._segmentsW=s,c._segmentsH=a,c._segmentsD=l,c._tile6=h,c}return __extends(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tile6",{get:function(){return this._tile6},set:function(t){this._tile6=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsD",{get:function(){return this._segmentsD},set:function(t){this._segmentsD=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){var i,r,n,o,s,a,l,h,c,u,p,d,f,_,g,m,y,v,b,x,A=0;if(_=this._width/2,g=this._height/2,m=this._depth/2,e==ElementsType.TRIANGLE){var E=t,S=2*((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1)),T=12*(this._segmentsW*this._segmentsH+this._segmentsW*this._segmentsD+this._segmentsH*this._segmentsD);for(S==E.numVertices&&null!=E.indices?(E.invalidateIndices(),E.invalidateVertices(E.positions),E.invalidateVertices(E.normals),E.invalidateVertices(E.tangents)):(E.setIndices(new Uint16Array(T)),E.setPositions(new Float32Array(3*S)),E.setNormals(new Float32Array(3*S)),E.setTangents(new Float32Array(3*S)),this._pInvalidateUVs()),i=E.indices.get(E.numElements),r=E.positions.get(S),n=E.normals.get(S),o=E.tangents.get(S),s=E.concatenatedBuffer.stride/4,d=0,f=0,y=this._width/this._segmentsW,v=this._height/this._segmentsH,b=this._depth/this._segmentsD,u=0;u<=this._segmentsW;u++)for(x=u*y-_,p=0;p<=this._segmentsH;p++)r[d]=x,r[d+1]=p*v-g,r[d+2]=-m,n[d]=0,n[d+1]=0,n[d+2]=-1,o[d]=1,o[d+1]=0,o[d+2]=0,r[d+=s]=x,r[d+1]=p*v-g,r[d+2]=m,n[d]=0,n[d+1]=0,n[d+2]=1,o[d]=-1,o[d+1]=0,o[d+2]=0,d+=s,u&&p&&(h=(a=2*((u-1)*(this._segmentsH+1)+(p-1)))+2,c=(l=2*(u*(this._segmentsH+1)+(p-1)))+2,i[f++]=a,i[f++]=h,i[f++]=c,i[f++]=a,i[f++]=c,i[f++]=l,i[f++]=l+1,i[f++]=c+1,i[f++]=h+1,i[f++]=l+1,i[f++]=h+1,i[f++]=a+1);for(A+=2*(this._segmentsW+1)*(this._segmentsH+1),u=0;u<=this._segmentsW;u++)for(x=u*y-_,p=0;p<=this._segmentsD;p++)r[d]=x,r[d+1]=g,r[d+2]=p*b-m,n[d]=0,n[d+1]=1,n[d+2]=0,o[d]=1,o[d+1]=0,o[d+2]=0,r[d+=s]=x,r[d+1]=-g,r[d+2]=p*b-m,n[d]=0,n[d+1]=-1,n[d+2]=0,o[d]=1,o[d+1]=0,o[d+2]=0,d+=s,u&&p&&(h=(a=A+2*((u-1)*(this._segmentsD+1)+(p-1)))+2,c=(l=A+2*(u*(this._segmentsD+1)+(p-1)))+2,i[f++]=a,i[f++]=h,i[f++]=c,i[f++]=a,i[f++]=c,i[f++]=l,i[f++]=l+1,i[f++]=c+1,i[f++]=h+1,i[f++]=l+1,i[f++]=h+1,i[f++]=a+1);for(A+=2*(this._segmentsW+1)*(this._segmentsD+1),u=0;u<=this._segmentsD;u++)for(x=m-u*b,p=0;p<=this._segmentsH;p++)r[d]=-_,r[d+1]=p*v-g,r[d+2]=x,n[d]=-1,n[d+1]=0,n[d+2]=0,o[d]=0,o[d+1]=0,o[d+2]=-1,r[d+=s]=_,r[d+1]=p*v-g,r[d+2]=x,n[d]=1,n[d+1]=0,n[d+2]=0,o[d]=0,o[d+1]=0,o[d+2]=1,d+=s,u&&p&&(h=(a=A+2*((u-1)*(this._segmentsH+1)+(p-1)))+2,c=(l=A+2*(u*(this._segmentsH+1)+(p-1)))+2,i[f++]=a,i[f++]=h,i[f++]=c,i[f++]=a,i[f++]=c,i[f++]=l,i[f++]=l+1,i[f++]=c+1,i[f++]=h+1,i[f++]=l+1,i[f++]=h+1,i[f++]=a+1)}else if(e==ElementsType.LINE){var P,C=t,w=4*this._segmentsH+4*this._segmentsW+4*this._segmentsD;for(r=new Float32Array(6*w),P=new Float32Array(w),d=0,f=0,u=0;u<this._segmentsH;++u)r[d++]=-_,r[d++]=u*this._height/this._segmentsH-g,r[d++]=-m,r[d++]=_,r[d++]=u*this._height/this._segmentsH-g,r[d++]=-m,P[f++]=1,r[d++]=-_,r[d++]=g-u*this._height/this._segmentsH,r[d++]=m,r[d++]=_,r[d++]=g-u*this._height/this._segmentsH,r[d++]=m,P[f++]=1;for(u=0;u<this._segmentsW;++u)r[d++]=u*this._width/this._segmentsW-_,r[d++]=-g,r[d++]=-m,r[d++]=u*this._width/this._segmentsW-_,r[d++]=g,r[d++]=-m,P[f++]=1,r[d++]=_-u*this._width/this._segmentsW,r[d++]=-g,r[d++]=m,r[d++]=_-u*this._width/this._segmentsW,r[d++]=g,r[d++]=m,P[f++]=1;for(u=0;u<this._segmentsH;++u)r[d++]=-_,r[d++]=u*this._height/this._segmentsH-g,r[d++]=-m,r[d++]=-_,r[d++]=u*this._height/this._segmentsH-g,r[d++]=m,P[f++]=1,r[d++]=_,r[d++]=g-u*this._height/this._segmentsH,r[d++]=-m,r[d++]=_,r[d++]=g-u*this._height/this._segmentsH,r[d++]=m,P[f++]=1;for(u=0;u<this._segmentsD;++u)r[d++]=_,r[d++]=-g,r[d++]=u*this._depth/this._segmentsD-m,r[d++]=_,r[d++]=g,r[d++]=u*this._depth/this._segmentsD-m,P[f++]=1,r[d++]=-_,r[d++]=-g,r[d++]=m-u*this._depth/this._segmentsD,r[d++]=-_,r[d++]=g,r[d++]=m-u*this._depth/this._segmentsD,P[f++]=1;for(u=0;u<this._segmentsD;++u)r[d++]=-_,r[d++]=-g,r[d++]=m-u*this._depth/this._segmentsD,r[d++]=_,r[d++]=-g,r[d++]=m-u*this._depth/this._segmentsD,P[f++]=1,r[d++]=-_,r[d++]=g,r[d++]=u*this._depth/this._segmentsD-m,r[d++]=_,r[d++]=g,r[d++]=u*this._depth/this._segmentsD-m,P[f++]=1;for(u=0;u<this._segmentsW;++u)r[d++]=_-u*this._width/this._segmentsW,r[d++]=-g,r[d++]=-m,r[d++]=_-u*this._width/this._segmentsW,r[d++]=-g,r[d++]=m,P[f++]=1,r[d++]=u*this._width/this._segmentsW-_,r[d++]=g,r[d++]=-m,r[d++]=u*this._width/this._segmentsW-_,r[d++]=g,r[d++]=m,P[f++]=1;C.setPositions(r),C.setThickness(P)}},e.prototype._pBuildUVs=function(t,e){var i,r,n,o,s,a,l,h,c,u,p,d,f,_,g,m;if(e==ElementsType.TRIANGLE){m=2*((this._segmentsW+1)*(this._segmentsH+1)+(this._segmentsW+1)*(this._segmentsD+1)+(this._segmentsH+1)*(this._segmentsD+1));var y=t;for(y.uvs&&m==y.numVertices?y.invalidateVertices(y.uvs):y.setUVs(new Float32Array(2*m)),o=y.uvs.get(m),s=y.uvs.stride,this._tile6?(a=h=1/3,l=c=.5):(a=l=1,h=c=0),n=0,u=1*h,p=1*c,d=2*h,f=0*c,_=a/this._segmentsW,g=l/this._segmentsH,i=0;i<=this._segmentsW;i++)for(r=0;r<=this._segmentsH;r++)o[n]=(u+i*_)*this._scaleU,o[n+1]=(p+(l-r*g))*this._scaleV,o[n+=s]=(d+(a-i*_))*this._scaleU,o[n+1]=(f+(l-r*g))*this._scaleV,n+=s;for(u=1*h,p=0*c,d=0*h,f=0*c,_=a/this._segmentsW,g=l/this._segmentsD,i=0;i<=this._segmentsW;i++)for(r=0;r<=this._segmentsD;r++)o[n]=(u+i*_)*this._scaleU,o[n+1]=(p+(l-r*g))*this._scaleV,o[n+=s]=(d+i*_)*this._scaleU,o[n+1]=(f+r*g)*this._scaleV,n+=s;for(u=0*h,p=1*c,d=2*h,f=1*c,_=a/this._segmentsD,g=l/this._segmentsH,i=0;i<=this._segmentsD;i++)for(r=0;r<=this._segmentsH;r++)o[n]=(u+i*_)*this._scaleU,o[n+1]=(p+(l-r*g))*this._scaleV,o[n+=s]=(d+(a-i*_))*this._scaleU,o[n+1]=(f+(l-r*g))*this._scaleV,n+=s}},e}(PrimitivePrefabBase),PrimitiveSpherePrefab=function(t){function e(e,i,r,n,o,s){void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=50),void 0===n&&(n=16),void 0===o&&(o=12),void 0===s&&(s=!0);var a=t.call(this,e,i)||this;return a._radius=r,a._segmentsW=n,a._segmentsH=o,a._yUp=s,a}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){var i,r,n,o,s,a,l,h,c,u,p;if(e==ElementsType.TRIANGLE){var d,f,_,g=t;for((p=(this._segmentsH+1)*(this._segmentsW+1))==g.numVertices&&null!=g.indices?(g.invalidateIndices(),g.invalidateVertices(g.positions),g.invalidateVertices(g.normals),g.invalidateVertices(g.tangents)):(g.setIndices(new Uint16Array((this._segmentsH-1)*this._segmentsW*6)),g.setPositions(new Float32Array(3*p)),g.setNormals(new Float32Array(3*p)),g.setTangents(new Float32Array(3*p)),this._pInvalidateUVs()),i=g.indices.get(g.numElements),O=g.positions.get(p),r=g.normals.get(p),n=g.tangents.get(p),o=g.concatenatedBuffer.stride/4,l=0,h=0,a=0;a<=this._segmentsH;++a){d=l;var m=Math.PI*a/this._segmentsH,y=-this._radius*Math.cos(m),v=this._radius*Math.sin(m);for(s=0;s<=this._segmentsW;++s){var b=2*Math.PI*s/this._segmentsW,x=v*Math.cos(b),A=v*Math.sin(b),E=1/Math.sqrt(x*x+A*A+y*y),S=Math.sqrt(A*A+x*x);if(this._yUp?(f=0,_=S>.007?x/S:0,c=-y,u=A):(f=S>.007?x/S:0,_=0,c=A,u=y),s==this._segmentsW?(O[l]=O[d],O[l+1]=O[d+1],O[l+2]=O[d+2],r[l]=r[d]+x*E*.5,r[l+1]=r[d+1]+c*E*.5,r[l+2]=r[d+2]+u*E*.5,n[l]=S>.007?-A/S:1,n[l+1]=f,n[l+2]=_):(O[l]=x,O[l+1]=c,O[l+2]=u,r[l]=x*E,r[l+1]=c*E,r[l+2]=u*E,n[l]=S>.007?-A/S:1,n[l+1]=f,n[l+2]=_),s>0&&a>0){var T=(this._segmentsW+1)*a+s,P=(this._segmentsW+1)*a+s-1,C=(this._segmentsW+1)*(a-1)+s-1,w=(this._segmentsW+1)*(a-1)+s;a==this._segmentsH?(O[l]=O[d],O[l+1]=O[d+1],O[l+2]=O[d+2],i[h++]=T,i[h++]=C,i[h++]=w):1==a?(i[h++]=T,i[h++]=P,i[h++]=C):(i[h++]=T,i[h++]=P,i[h++]=C,i[h++]=T,i[h++]=C,i[h++]=w)}l+=o}}}else if(e==ElementsType.LINE){var D=t,M=this._segmentsH*this._segmentsW*2+this._segmentsW,O=new Float32Array(6*M),I=new Float32Array(M);for(l=0,h=0,a=0;a<=this._segmentsH;++a){m=Math.PI*a/this._segmentsH,y=-this._radius*Math.cos(m),v=this._radius*Math.sin(m);for(s=0;s<=this._segmentsW;++s){b=2*Math.PI*s/this._segmentsW,x=v*Math.cos(b),A=v*Math.sin(b);if(this._yUp?(c=-y,u=A):(c=A,u=y),s>0&&(O[l++]=x,O[l++]=c,O[l++]=u,I[h++]=1,a>0)){var L=1==a?3-(6*(this._segmentsW-s)+12*s):3-12*this._segmentsW;O[l]=O[l+++L],O[l]=O[l+++L],O[l]=O[l+++L],O[l++]=x,O[l++]=c,O[l++]=u,I[h++]=1}s<this._segmentsW&&(O[l++]=x,O[l++]=c,O[l++]=u)}}D.setPositions(O),D.setThickness(I)}},e.prototype._pBuildUVs=function(t,e){var i,r,n,o,s=(this._segmentsH+1)*(this._segmentsW+1);if(e==ElementsType.TRIANGLE){s=(this._segmentsH+1)*(this._segmentsW+1);var a=t;a.uvs&&s==a.numVertices?a.invalidateVertices(a.uvs):a.setUVs(new Float32Array(2*s)),n=a.uvs.get(s),o=a.uvs.stride;var l=0;for(r=0;r<=this._segmentsH;++r)for(i=0;i<=this._segmentsW;++i)n[l]=i/this._segmentsW*this._scaleU,n[l+1]=r/this._segmentsH*this._scaleV,l+=o}},e}(PrimitivePrefabBase),DisplayObject=function(t){function e(){var e=t.call(this)||this;return e._queuedEvents=new Array,e._concatenatedMatrix3D=new Matrix3D,e._sessionID=-1,e._depthID=-16384,e._scenePosition=new Vector3D,e._explicitVisibility=!0,e._explicitMaskId=-1,e._implicitVisibility=!0,e._implicitMaskId=-1,e._explicitMouseEnabled=!0,e._implicitMouseEnabled=!0,e._orientationMatrix=new Matrix3D,e._inheritColorTransform=!0,e._maskMode=!1,e._renderMode=!0,e.isSlice9ScaledMC=!1,e.isSlice9ScaledSprite=!1,e.instanceID="",e.addedOnFrame=0,e.isAVMScene=!1,e.placeObjectTag=null,e.alignmentMode=AlignmentMode.REGISTRATION_POINT,e.castsShadows=!0,e.orientationMode=OrientationMode.DEFAULT,e.zOffset=0,e.cursorType="",e._isInFocus=!1,e._tabEnabled=!1,e._tabIndex=-1,e._onInvalidatePropertiesDelegate=function(t){return e._onInvalidateProperties(t)},e._transform=new Transform(null,e._concatenatedMatrix3D),e._transform.addEventListener(TransformEvent.INVALIDATE_MATRIX3D,(function(t){return e._onInvalidateMatrix3D(t)})),e._transform.addEventListener(TransformEvent.UPDATE_CONCATENATED_MATRIX3D,(function(t){return e._onUpdateConcatenatedMatrix3D(t)})),e._transform.addEventListener(TransformEvent.INVALIDATE_COLOR_TRANSFORM,(function(t){return e._onInvalidateColorTransform(t)})),e._defaultBoundingVolume=e._getDefaultBoundingVolume(),e}return __extends(e,t),e.prototype.getScriptPrecedence=function(){if(!this._parent)return[];var t=this._parent.getScriptPrecedence();return this.placeObjectTag&&t.push(this.placeObjectTag.actionBlocksPrecedence),t},e.prototype.dispatchFrameEvents=function(t){this.dispatchEvent(t[0]),this.dispatchEvent(t[1])},e.prototype.dispatchEnterFrame=function(t){this.dispatchEvent(t)},e.prototype.dispatchExitFrame=function(t){this.dispatchEvent(t)},e.prototype.getMouseCursor=function(){return"initial"},Object.defineProperty(e.prototype,"tabEnabled",{get:function(){return this._tabEnabled},set:function(t){this._tabEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabIndex",{get:function(){return this._tabIndex},set:function(t){this._tabIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInFocus",{get:function(){return this._isInFocus},set:function(t){this._isInFocus=t},enumerable:!0,configurable:!0}),e.prototype.setFocus=function(t,i,r){this._isInFocus!=t&&(this._isInFocus=t,this._isInFocus?e.focusEvent.type=FocusEvent.FOCUS_IN:e.focusEvent.type=FocusEvent.FOCUS_OUT,this.dispatchEnterFrame(e.focusEvent))},Object.defineProperty(e.prototype,"inheritColorTransform",{get:function(){return this._inheritColorTransform},set:function(t){this._inheritColorTransform!=t&&(this._inheritColorTransform=t,this._invalidateHierarchicalProperties(HierarchicalProperties.COLOR_TRANSFORM))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._transform.colorTransform.alphaMultiplier},set:function(t){this._transform.colorTransform.alphaMultiplier=t,this._transform.invalidateColorTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultBoundingVolume",{get:function(){return this._defaultBoundingVolume},set:function(t){this._defaultBoundingVolume!=t&&(this._defaultBoundingVolume=t,this._boundsPrimitive&&(this._boundsPrimitive.dispose(),this._boundsPrimitive=null),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eulers",{get:function(){return this._eulers||(this._eulers=new Vector3D),this._eulers.x=this.rotationX,this._eulers.y=this.rotationY,this._eulers.z=this.rotationZ,this._eulers},set:function(t){this._transform.rotation.x=t.x,this._transform.rotation.y=t.y,this._transform.rotation.z=t.z,this._transform.invalidateMatrix3D()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._parent?this._parent.getChildIndex(this):0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRenderable",{get:function(){return this._renderMode&&this._iAssignedColorTransform()._isRenderable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaderInfo",{get:function(){return this._loaderInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{set:function(t){t&&(t.maskMode=!0),this.masks||(this.masks=[]),this.masks.push(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maskMode",{get:function(){return this._maskMode},set:function(t){var e;this._maskMode!=t&&(this._partition&&(e=this._partition.parent)&&e.removeChild(this._partition),this._implicitPartition&&this._implicitPartition.clearEntity(this),this._maskMode=t,this._partition&&e&&e.addChild(this._partition),this._implicitPartition&&this._implicitPartition.invalidateEntity(this),this._explicitMaskId=t?this.id:-1,this._updateMaskMode())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pickObject",{get:function(){return this._pickObject&&this._pickObjectDirty&&this._updatePickObject(),this._pickObject},set:function(t){this._pickObject!=t&&(this._pickObject&&(this._pickObject.partition=null),this._pickObject=t.clone(),this._pickObject&&(this._pickObject.partition=new BasicPartition(this._pickObject),this._pickObject.mouseChildren=!1,this._pickObject.mouseEnabled=!1,this._updatePickObject()))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseEnabled",{get:function(){return this._explicitMouseEnabled},set:function(t){this._explicitMouseEnabled!=t&&(this._explicitMouseEnabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseX",{get:function(){return this._mouseX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseY",{get:function(){return this._mouseY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._pName?this._pName:""},set:function(t){this._pName=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"partition",{get:function(){return this._partition},set:function(t){this._partition!=t&&(this._partition&&this._partition.parent&&this._partition.parent.removeChild(this._partition),this._partition=t,this._setPartition(this._parent?this._parent._implicitPartition:null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"registrationPoint",{get:function(){return this._registrationMatrix3D?new Vector3D(-this._registrationMatrix3D._rawData[12]*this.scaleX,-this._registrationMatrix3D._rawData[13]*this.scaleY,-this._registrationMatrix3D._rawData[14]*this.scaleZ):null},set:function(t){if(t)this._registrationMatrix3D||(this._registrationMatrix3D=new Matrix3D),this._registrationMatrix3D._rawData[12]=-t.x/this._transform.scale.x,this._registrationMatrix3D._rawData[13]=-t.y/this._transform.scale.y,this._registrationMatrix3D._rawData[14]=-t.z/this._transform.scale.z;else{if(!this._registrationMatrix3D)return;this._registrationMatrix3D._rawData[12]=0,this._registrationMatrix3D._rawData[13]=0,this._registrationMatrix3D._rawData[14]=0,this._registrationMatrix3D.isIdentity()&&(this._registrationMatrix3D=null)}this._registrationMatrix3D.invalidatePosition(),this._invalidateHierarchicalProperties(HierarchicalProperties.SCENE_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"registrationScale",{get:function(){return this._registrationMatrix3D?new Vector3D(this._registrationMatrix3D._rawData[0],this._registrationMatrix3D._rawData[5],this._registrationMatrix3D._rawData[10]):null},set:function(t){if(t)this._registrationMatrix3D||(this._registrationMatrix3D=new Matrix3D),this._registrationMatrix3D._rawData[0]=t.x,this._registrationMatrix3D._rawData[5]=t.y,this._registrationMatrix3D._rawData[10]=t.z;else{if(!this._registrationMatrix3D)return;this._registrationMatrix3D._rawData[0]=1,this._registrationMatrix3D._rawData[5]=1,this._registrationMatrix3D._rawData[10]=1,this._registrationMatrix3D.isIdentity()&&(this._registrationMatrix3D=null)}this._invalidateHierarchicalProperties(HierarchicalProperties.SCENE_TRANSFORM)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._transform.rotation.x*MathConsts.RADIANS_TO_DEGREES},set:function(t){this.rotationX!=t&&(this._transform.rotation.x=t*MathConsts.DEGREES_TO_RADIANS,this._transform.invalidateMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._transform.rotation.y*MathConsts.RADIANS_TO_DEGREES},set:function(t){this.rotationY!=t&&(this._transform.rotation.y=t*MathConsts.DEGREES_TO_RADIANS,this._transform.invalidateMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._transform.rotation.z*MathConsts.RADIANS_TO_DEGREES},set:function(t){this.rotationZ!=t&&(this._transform.rotation.z=t*MathConsts.DEGREES_TO_RADIANS,this._transform.invalidateMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._transform.scale.x},set:function(t){this._setScaleX(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._transform.scale.y},set:function(t){this._setScaleY(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleZ",{get:function(){return this._transform.scale.z},set:function(t){this._setScaleZ(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewX",{get:function(){return this._transform.skew.x},set:function(t){this.skewX!=t&&(this._transform.skew.x=t,this._transform.invalidateMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:function(){return this._transform.skew.y},set:function(t){this.skewY!=t&&(this._transform.skew.y=t,this._transform.invalidateMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewZ",{get:function(){return this._transform.skew.z},set:function(t){this.skewZ!=t&&(this._transform.skew.z=t,this._transform.invalidateMatrix3D())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenePosition",{get:function(){return this._scenePositionDirty&&(this._registrationMatrix3D&&this.alignmentMode==AlignmentMode.REGISTRATION_POINT?(this._scenePosition.x=-this._registrationMatrix3D._rawData[12],this._scenePosition.y=-this._registrationMatrix3D._rawData[13],this._scenePosition.z=-this._registrationMatrix3D._rawData[14],this._scenePosition=this._transform.concatenatedMatrix3D.transformVector(this._scenePosition,this._scenePosition)):this._transform.concatenatedMatrix3D.copyColumnTo(3,this._scenePosition),this._scenePositionDirty=!1),this._scenePosition},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animator",{get:function(){return this._animator},set:function(t){this._animator&&this._animator.removeOwner(this),this._animator=t,this._animator&&this._animator.addOwner(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(t){this._material!=t&&(this._material=t,this._invalidateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){this._style!=t&&(this._style&&this._style.removeEventListener(StyleEvent.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate),this._style=t,this._style&&this._style.addEventListener(StyleEvent.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate),this._invalidateStyle())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundsVisible",{get:function(){return this._boundsVisible},set:function(t){t!=this._boundsVisible&&(this._boundsVisible=t,this._boundsVisible&&!this.partition&&(this.partition=new BasicPartition(this)),this.invalidate())},enumerable:!0,configurable:!0}),e.prototype.getBoundsPrimitive=function(t){if(null==this._boundsPrimitive){switch(this._defaultBoundingVolume){case BoundingVolumeType.BOX:case BoundingVolumeType.BOX_BOUNDS:case BoundingVolumeType.BOX_BOUNDS_FAST:case BoundingVolumeType.BOX_FAST:this._boundsPrefab=new PrimitiveCubePrefab(null,ElementsType.LINE),this._boundsPrimitive=this._boundsPrefab.getNewObject();break;case BoundingVolumeType.SPHERE:case BoundingVolumeType.SPHERE_BOUNDS:case BoundingVolumeType.SPHERE_BOUNDS_FAST:case BoundingVolumeType.SPHERE_FAST:this._boundsPrefab=new PrimitiveSpherePrefab(null,ElementsType.LINE),this._boundsPrimitive=this._boundsPrefab.getNewObject()}this._boundsPrefabDirty=!0,this._boundsPrimitiveDirty=!0}return this._boundsPrefabDirty&&this._updateBoundsPrefab(t),this._boundsPrimitiveDirty&&this._updateBoundsPrimitive(),this._boundsPrimitive},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._explicitVisibility},set:function(t){this._explicitVisibility!=t&&(this._explicitVisibility=t,this._invalidateHierarchicalProperties(HierarchicalProperties.VISIBLE))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masks",{get:function(){return this._explicitMasks},set:function(t){if(this._explicitMasks!=t){if(this._explicitMasks=t,null!=t&&t.length)for(var e=t.length,i=0;i<e;i++)t[i].maskMode=!0;this._invalidateHierarchicalProperties(HierarchicalProperties.MASKS)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._transform.position.x},set:function(t){this._transform.position.x!=t&&(this._transform.matrix3D._rawData[12]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._transform.position.y},set:function(t){this._transform.position.y!=t&&(this._transform.matrix3D._rawData[13]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._transform.position.z},set:function(t){this._transform.position.z!=t&&(this._transform.matrix3D._rawData[14]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),e.prototype.isEntity=function(){return!1},e.prototype.addEventListener=function(e,i){switch(t.prototype.addEventListener.call(this,e,i),e){case DisplayObjectEvent.SCENETRANSFORM_CHANGED:this._listenToSceneTransformChanged=!0}},e.prototype.clone=function(){var t=new e;return this.copyTo(t),t},e.prototype.copyTo=function(t){t.defaultBoundingVolume=this._defaultBoundingVolume,this._registrationMatrix3D&&(t._registrationMatrix3D=this._registrationMatrix3D.clone()),t.material=this._material,t.style=this._style,t.pickObject=this._pickObject,t.boundsVisible=this._boundsVisible,t.name=this._pName,t.mouseEnabled=this._explicitMouseEnabled,t.extra=this.extra,t.maskMode=this._maskMode,t.castsShadows=this.castsShadows,t.isSlice9ScaledMC=this.isSlice9ScaledMC,t.assetNamespace=this.assetNamespace,t._symbol=this._symbol,t.avm1Symbol=this.avm1Symbol,this._explicitMasks&&(t.masks=this._explicitMasks),this._animator&&(t.animator=this._animator.clone()),this._transform.copyRawDataTo(t._transform)},e.prototype.dispose=function(){this.disposeValues()},e.prototype.disposeValues=function(){this._parent&&this._parent.removeChild(this),this.material=null,this._animator&&this._animator.dispose(),this._adapter&&(this._adapter.dispose(),this._adapter=null),this._pickObject=null,this._explicitMasks=null},e.prototype.lookAt=function(t,e){void 0===e&&(e=null),this.transform.lookAt(t,e)},e.prototype.localToGlobal3D=function(t){return this._transform.concatenatedMatrix3D.transformVector(t)},e.prototype.movePivot=function(t,e,i){0==t&&0==e&&0==i||(this._registrationMatrix3D||(this._registrationMatrix3D=new Matrix3D),this._registrationMatrix3D._rawData[12]-=t/this._transform.scale.x,this._registrationMatrix3D._rawData[13]-=e/this._transform.scale.y,this._registrationMatrix3D._rawData[14]-=i/this._transform.scale.z,this._invalidateHierarchicalProperties(HierarchicalProperties.SCENE_TRANSFORM))},e.prototype.reset=function(){this.visible=!0,this.noTimelineUpdate||this._transform.clearMatrix3D(),this._transform.clearColorTransform(),this.masks=null,this.maskMode=!1},e.prototype.getRenderSceneTransform=function(t){if(this.orientationMode==OrientationMode.CAMERA_PLANE){var e=t.decompose();return e[0].copyFrom(this.scenePosition),e[3].copyFrom(this._transform.scale),this._orientationMatrix.recompose(e),this._registrationMatrix3D&&(this._orientationMatrix.prepend(this._registrationMatrix3D),this.alignmentMode!=AlignmentMode.REGISTRATION_POINT&&this._orientationMatrix.appendTranslation(-this._registrationMatrix3D._rawData[12]*this._transform.scale.x,-this._registrationMatrix3D._rawData[13]*this._transform.scale.y,-this._registrationMatrix3D._rawData[14]*this._transform.scale.z)),this._orientationMatrix}return this._transform.concatenatedMatrix3D},e.prototype.removeEventListener=function(e,i){if(t.prototype.removeEventListener.call(this,e,i),!this.hasEventListener(e))switch(e){case DisplayObjectEvent.SCENETRANSFORM_CHANGED:this._listenToSceneTransformChanged=!0}},e.prototype._setParent=function(t){this._partition&&(!t&&this._parent&&this._parent._implicitPartition?(this._parent._implicitPartition.removeChild(this._partition),this.clear()):this._implicitPartition&&this._implicitPartition==this._partition&&this.isEntity()&&this._implicitPartition.invalidateEntity(this)),this._parent=t,this._setPartition(t&&t._implicitPartition?t._implicitPartition:null),this._invalidateHierarchicalProperties(HierarchicalProperties.ALL)},e.prototype._invalidateHierarchicalProperties=function(t){var e=(this._hierarchicalPropsDirty^t)&t;return!e||(this._hierarchicalPropsDirty|=t,e&HierarchicalProperties.SCENE_TRANSFORM&&(this.transform.invalidateConcatenatedMatrix3D(),this._scenePositionDirty=!0,this._boundsPrimitiveDirty=!0,this._pickObjectDirty=!0,this._implicitPartition&&this.isEntity()&&this._implicitPartition.invalidateEntity(this),this._listenToSceneTransformChanged&&this.queueDispatch(this._sceneTransformChanged||(this._sceneTransformChanged=new DisplayObjectEvent(DisplayObjectEvent.SCENETRANSFORM_CHANGED,this)))),!1)},e.prototype._setPartition=function(t){t&&null==this._partition&&(this._partition=t.getPartition(this)||this._partition),this._partition&&t&&t.addChild(this._partition);var e=this._partition||t;return this._implicitPartition==e||(this._implicitPartition&&this.clear(),this._implicitPartition=e,this._implicitPartition&&this.isEntity()&&this._implicitPartition.invalidateEntity(this),this.dispatchEvent(new DisplayObjectEvent(DisplayObjectEvent.PARTITION_CHANGED,this)),!1)},e.prototype._onUpdateConcatenatedMatrix3D=function(t){this._concatenatedMatrix3D.copyFrom(this._transform.matrix3D),this._registrationMatrix3D&&(this._concatenatedMatrix3D.prepend(this._registrationMatrix3D),this.alignmentMode!=AlignmentMode.REGISTRATION_POINT&&this._concatenatedMatrix3D.appendTranslation(-this._registrationMatrix3D._rawData[12]*this._transform.scale.x,-this._registrationMatrix3D._rawData[13]*this._transform.scale.y,-this._registrationMatrix3D._rawData[14]*this._transform.scale.z)),this._parent&&this._concatenatedMatrix3D.append(this._parent._transform.concatenatedMatrix3D),this._matrix3DDirty=!1,this._hierarchicalPropsDirty^=HierarchicalProperties.SCENE_TRANSFORM,this._iController&&this._iController.updateController()},e.prototype._iInternalUpdate=function(){this._iController&&this._iController.update();for(var t=this._queuedEvents.length,e=0;e<t;++e)this.dispatchEvent(this._queuedEvents[e]);this._queuedEvents.length=0},e.prototype._iIsVisible=function(){return this._hierarchicalPropsDirty&HierarchicalProperties.VISIBLE&&this._updateVisible(),this._implicitVisibility},Object.defineProperty(e.prototype,"maskId",{get:function(){return this._hierarchicalPropsDirty&HierarchicalProperties.MASK_ID&&this._updateMaskId(),this._implicitMaskId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maskOwners",{get:function(){return this._hierarchicalPropsDirty&HierarchicalProperties.MASKS&&this._updateMaskOwners(),this._maskOwners},enumerable:!0,configurable:!0}),e.prototype._iAssignedColorTransform=function(){return this._hierarchicalPropsDirty&HierarchicalProperties.COLOR_TRANSFORM&&this._updateColorTransform(),this._pImplicitColorTransform||(this._pImplicitColorTransform=new ColorTransform)},e.prototype._startDrag=function(){this._isDragEntity=!0},e.prototype._stopDrag=function(){this._isDragEntity=!1},e.prototype.isDragEntity=function(){return this._isDragEntity},e.prototype._iIsMouseEnabled=function(){return this._hierarchicalPropsDirty&HierarchicalProperties.MOUSE_ENABLED&&this._updateMouseEnabled(),this._implicitMouseEnabled&&this._explicitMouseEnabled},e.prototype.isDescendant=function(t){for(var e=this;e.parent;)if((e=e.parent)==t)return!0;return!1},e.prototype.isAncestor=function(t){return t.isDescendant(this)},e.prototype._acceptTraverser=function(t){},e.prototype._onInvalidateMatrix3D=function(t){this._matrix3DDirty||(this._matrix3DDirty=!0,this._invalidateHierarchicalProperties(HierarchicalProperties.SCENE_TRANSFORM))},e.prototype._onInvalidateColorTransform=function(t){this._invalidateHierarchicalProperties(HierarchicalProperties.COLOR_TRANSFORM)},e.prototype.queueDispatch=function(t){this._queuedEvents.push(t)},e.prototype._setScaleX=function(t){this.scaleX!=t&&(this._transform.scale.x=t,this._transform.invalidateMatrix3D())},e.prototype._setScaleY=function(t){this.scaleY!=t&&(this._transform.scale.y=t,this._transform.invalidateMatrix3D())},e.prototype._setScaleZ=function(t){this.scaleZ!=t&&(this._transform.scale.z=t,this._transform.invalidateMatrix3D())},e.prototype._updateMouseEnabled=function(){this._implicitMouseEnabled=!this._parent||this._parent.mouseChildren&&this._parent._implicitMouseEnabled,this._hierarchicalPropsDirty^=HierarchicalProperties.MOUSE_ENABLED},e.prototype._updateVisible=function(){this._implicitVisibility=this._parent?this._explicitVisibility&&this._parent._iIsVisible():this._explicitVisibility,this._hierarchicalPropsDirty^=HierarchicalProperties.VISIBLE},e.prototype._updateMaskId=function(){this._implicitMaskId=-1!=this._explicitMaskId?this._explicitMaskId:this._parent&&-1!=this._parent.maskId?this._parent.maskId:-1,this._hierarchicalPropsDirty^=HierarchicalProperties.MASK_ID},e.prototype._updateMaskOwners=function(){this._maskOwners=this._parent&&this._parent.maskOwners&&-1==this.maskId?this._explicitMasks?this._parent.maskOwners.concat([this]):this._parent.maskOwners.concat():null!=this._explicitMasks?[this]:null,this._hierarchicalPropsDirty^=HierarchicalProperties.MASKS},e.prototype._updateColorTransform=function(){this._pImplicitColorTransform||(this._pImplicitColorTransform=new ColorTransform),this._inheritColorTransform&&this._parent&&this._parent._iAssignedColorTransform()?(this._pImplicitColorTransform.copyFrom(this._parent._iAssignedColorTransform()),this._pImplicitColorTransform.prepend(this._transform.colorTransform)):this._pImplicitColorTransform.copyFrom(this._transform.colorTransform),this._hierarchicalPropsDirty^=HierarchicalProperties.COLOR_TRANSFORM},e.prototype._updateBoundsPrefab=function(t){if(this._boundsPrefab instanceof PrimitiveCubePrefab){var e=t.getBoundsPicker(this.partition).getBoundingVolume(null,this._defaultBoundingVolume).getBox();if(null==e)return;this._boundsPrefab.width=e.width,this._boundsPrefab.height=e.height,this._boundsPrefab.depth=e.depth,this._boundsPrimitive.registrationPoint=new Vector3D(-(e.x+e.width/2)*this._boundsPrimitive.transform.scale.x,-(e.y+e.height/2)*this._boundsPrimitive.transform.scale.y,-(e.z+e.depth/2)*this._boundsPrimitive.transform.scale.z)}else if(this._boundsPrefab instanceof PrimitiveSpherePrefab){var i=t.getBoundsPicker(this.partition).getBoundingVolume(null,this._defaultBoundingVolume).getSphere();if(console.log(i),null==i)return;this._boundsPrefab.radius=i.radius,this._boundsPrimitive.registrationPoint=new Vector3D(-i.x*this._boundsPrimitive.transform.scale.x,-i.y*this._boundsPrimitive.transform.scale.y,-i.z*this._boundsPrimitive.transform.scale.z)}},e.prototype._updatePickObject=function(){this._pickObject.transform.matrix3D=this.transform.concatenatedMatrix3D},e.prototype._updateBoundsPrimitive=function(){this._boundsPrimitiveDirty=!1,this._boundsPrimitive.transform.matrix3D=this.transform.concatenatedMatrix3D},e.prototype._updateMaskMode=function(){this.maskMode&&(this.mouseEnabled=!1),this._invalidateHierarchicalProperties(HierarchicalProperties.MASK_ID)},e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._implicitPartition&&this.isEntity()&&this._implicitPartition.invalidateEntity(this)},e.prototype.clear=function(){t.prototype.clear.call(this),this._pImplicitColorTransform=null,this._maskOwners=null},e.prototype._invalidateMaterial=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_MATERIAL,this))},e.prototype._invalidateStyle=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_STYLE,this))},e.prototype.invalidateElements=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_ELEMENTS,this))},e.prototype._onInvalidateProperties=function(t){this._invalidateStyle()},e.prototype._getDefaultBoundingVolume=function(){return BoundingVolumeType.BOX_BOUNDS_FAST},e.focusEvent=new FocusEvent(FocusEvent.FOCUS_IN),e}(AssetBase),DisplayObjectContainer=function(t){function e(){var e=t.call(this)||this;return e._mouseChildren=!0,e._depth_childs={},e._nextHighestDepth=0,e._children=new Array,e.doingSwap=!1,e.tabChildren=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.dispatchFrameEvents=function(t){this.dispatchEvent(t[0]);for(var e=this._children.length;e>0;)e--,this._children[e].dispatchFrameEvents(t);this.dispatchEvent(t[1])},e.prototype.dispatchEnterFrame=function(t){for(var e=this._children.length;e>0;)--e<this._children.length&&this._children[e].dispatchEnterFrame(t);this.dispatchEvent(t)},e.prototype.dispatchExitFrame=function(t){for(var e=this._children.length;e>0;)--e<this._children.length&&this._children[e].dispatchExitFrame(t);this.dispatchEvent(t)},Object.defineProperty(e.prototype,"mouseChildren",{get:function(){return this._hierarchicalPropsDirty&HierarchicalProperties.MOUSE_ENABLED&&this._updateMouseEnabled(),this._mouseChildren},set:function(t){this._mouseChildren!=t&&(this._mouseChildren=t,this._invalidateHierarchicalProperties(HierarchicalProperties.MOUSE_ENABLED))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._children.length},enumerable:!0,configurable:!0}),e.prototype.addChild=function(t){return this.addChildAt(t,this._children.length)},e.prototype.addChildAtDepth=function(t,e,i){if(void 0===i&&(i=!0),this.doingSwap||t.adapter&&t.adapter.noReset||t.reset(),null==t)throw new ArgumentError("Parameter child cannot be null.");t.parent&&t.parent.removeChildAtInternal(t.parent.getChildIndex(t)),this.isSlice9ScaledMC&&"[asset Sprite]"==t.assetType&&(t.isSlice9ScaledSprite=!0);var r=this.getDepthIndexInternal(e);return-1!=r&&(i?this.removeChildAt(r):this.addChildAtDepth(this._children[r],e+1,!1)),this._nextHighestDepth<e+1&&(this._nextHighestDepth=e+1),this._depth_childs[e]=t,this._children.push(t),t._depthID=e,t._setParent(this),this.doingSwap||t.adapter!=t&&t.adapter.initAdapter(),t},e.prototype.addChildAt=function(t,e){return this.addChildAtDepth(t,e<this._children.length?this._children[e]._depthID:this.getNextHighestDepth(),!1)},e.prototype.addChildren=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t.length,r=0;r<i;r++)this.addChild(t[r])},e.prototype.clone=function(){var t=new e;return this.copyTo(t),t},e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.mouseChildren=this._mouseChildren;for(var i=this._children.length,r=0;r<i;++r)e.addChild(this._children[r].adapter.clone().adaptee)},e.prototype.contains=function(t){return this._children.indexOf(t)>=0},e.prototype.disposeValues=function(){for(var e=this._children.length-1;e>=0;e--)this.removeChild(this._children[e]);t.prototype.disposeValues.call(this)},e.prototype.getChildAtDepth=function(t){return this._depth_childs[t]},e.prototype.getChildAt=function(t){var e=this._children[t];if(null==e)throw new RangeError$1("Index does not exist in the child list of the caller");return e},e.prototype.getChildByName=function(t){for(var e=this._children.length,i=0;i<e;++i)if(this._children[i].name==t)return this._children[i];return null},e.prototype.getChildIndex=function(t){var e=this._children.indexOf(t);if(-1==e)throw new ArgumentError("Child parameter is not a child of the caller");return e},e.prototype.getNextHighestDepth=function(){return this._nextHighestDepthDirty&&this._updateNextHighestDepth(),this._nextHighestDepth},e.prototype.getObjectsUnderPoint=function(t){return new Array},e.prototype.removeChild=function(t){if(null==t)throw new ArgumentError("Parameter child cannot be null");return this.removeChildAt(this.getChildIndex(t)),t},e.prototype.removeChildAtDepth=function(t){return this.removeChildAt(this.getDepthIndexInternal(t))},e.prototype.removeChildAt=function(t){var e=this.removeChildAtInternal(t);return e._setParent(null),e},e.prototype.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),t<0)throw new RangeError$1("beginIndex is out of range of the child list");if(e>this._children.length)throw new RangeError$1("endIndex is out of range of the child list");for(var i=e-1;i>=t;i--)this.removeChildAtInternal(i)._setParent(null)},e.prototype.setChildIndex=function(t,e){},e.prototype.swapChildren=function(t,e){t.parent==this&&e.parent==this&&this.swapChildrenAt(this.getChildIndex(t),this.getChildIndex(e))},e.prototype.swapChildrenAt=function(t,e){var i=this._children[e]._depthID,r=this._children[t];this.addChildAtDepth(this._children[e],this._children[t]._depthID),this.addChildAtDepth(r,i)},e.prototype._invalidateHierarchicalProperties=function(e){if(t.prototype._invalidateHierarchicalProperties.call(this,e))return!0;for(var i=this._children.length,r=0;r<i;++r)this._children[r]._invalidateHierarchicalProperties(e);return!1},e.prototype._setPartition=function(e){if(t.prototype._setPartition.call(this,e))return!0;for(var i=this._children.length,r=0;r<i;++r)this._children[r]._setPartition(this._implicitPartition);return!1},e.prototype.removeChildAtInternal=function(t){var e=this._children.splice(t,1)[0];return this._nextHighestDepth==e._depthID+1&&(this._nextHighestDepthDirty=!0),delete this._depth_childs[e._depthID],e._depthID=-16384,e},e.prototype.getDepthIndexInternal=function(t){return this._depth_childs[t]?this._children.indexOf(this._depth_childs[t]):-1},e.prototype._updateNextHighestDepth=function(){this._nextHighestDepthDirty=!1,this._nextHighestDepth=0;for(var t=this._children.length,e=0;e<t;e++)this._nextHighestDepth<this._children[e]._depthID&&(this._nextHighestDepth=this._children[e]._depthID);this._nextHighestDepth+=1},e.prototype._updateMaskMode=function(){this.maskMode&&(this.mouseChildren=!1),t.prototype._updateMaskMode.call(this)},e.assetType="[asset DisplayObjectContainer]",e}(DisplayObject),Sprite=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this)||this;return r._isEntity=!1,r._onGraphicsInvalidateDelegate=function(t){return r._onGraphicsInvalidate(t)},r.graphics=e||Graphics.getGraphics(),r.material=i,r}return __extends(e,t),e.getNewSprite=function(t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),e._sprites.length){var r=e._sprites.pop();return r.graphics=t||Graphics.getGraphics(),r.material=i,r}return new e(t,i)},e.clearPool=function(){e._sprites=[]},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this._iSourcePrefab&&this._iSourcePrefab._iValidate(),this.isSlice9ScaledSprite&&this._graphics.updateSlice9(this.parent.scaleX,this.parent.scaleY),this._graphics},set:function(t){this._graphics!=t&&(this._graphics&&(this._graphics.removeEventListener(AssetEvent.INVALIDATE,this._onGraphicsInvalidateDelegate),this._graphics.usages--),this._graphics=t,this._graphics&&(this._graphics.addEventListener(AssetEvent.INVALIDATE,this._onGraphicsInvalidateDelegate),this._graphics.usages++),this.invalidate())},enumerable:!0,configurable:!0}),e.prototype.isEntity=function(){return Boolean(this._graphics&&this._graphics.count)},e.prototype.dispose=function(){this.disposeValues(),e._sprites.push(this)},e.prototype.disposeValues=function(){t.prototype.disposeValues.call(this),this.graphics=null},e.prototype.clone=function(){var t=e.getNewSprite();return this.copyTo(t),t},e.prototype.copyTo=function(e,i){void 0===i&&(i=!1),t.prototype.copyTo.call(this,e),e._iSourcePrefab=this._iSourcePrefab,this._graphics.copyTo(e.graphics,i)},e.prototype._iInternalUpdate=function(){t.prototype._iInternalUpdate.call(this)},e.prototype._onGraphicsInvalidate=function(t){var e=this.isEntity();this._isEntity!=e&&(!e&&this._implicitPartition&&this._implicitPartition.clearEntity(this),this._isEntity=e),this.invalidate()},e.prototype._acceptTraverser=function(t){this.graphics._acceptTraverser(t)},e.prototype.bakeTransformations=function(){this._graphics.applyTransformation(this.transform.matrix3D),this.transform.clearMatrix3D()},e._sprites=new Array,e.assetType="[asset Sprite]",e}(DisplayObjectContainer);PartitionBase.registerAbstraction(EntityNode,Sprite);var MorphSprite=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.getNewMorphSprite=function(t,i){if(void 0===t&&(t=null),void 0===i&&(i=null),e._morphSprites.length){var r=e._morphSprites.pop();return r.graphics=t||Graphics.getGraphics(),r.material=i,r}return new e(t,i)},e.interpolateColor=function(t,e,i){var r=1-i;return((4278190080&t)>>>24)*r+((4278190080&e)>>>24)*i<<24|((16711680&t)>>>16)*r+((16711680&e)>>>16)*i<<16|((65280&t)>>>8)*r+((65280&e)>>>8)*i<<8|(255&t)*r+(255&e)*i},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.reset=function(){t.prototype.reset.call(this),this.setRatio(0)},e.prototype.setRatio=function(t){var e=Math.round(16777215*t).toString();this._ratio!=e&&(this._ratio=e,this._graphics.endFill(),this._graphics.clear(),this._graphics.endFill())},e.prototype.dispose=function(){this.disposeValues(),e._morphSprites.push(this)},e.prototype.clone=function(){var t=e.getNewMorphSprite();return this.copyTo(t),t},e.assetType="[asset MorphSprite]",e._morphSprites=new Array,e}(Sprite);PartitionBase.registerAbstraction(EntityNode,MorphSprite);var MouseEvent=function(t){function e(e){var i=t.call(this,e)||this;return i._iAllowedToPropagate=!0,i}return __extends(e,t),Object.defineProperty(e.prototype,"bubbles",{get:function(){var t=this._iAllowedToPropagate;return this._iAllowedToPropagate=!0,t},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this._iAllowedToPropagate=!1,this._iParentEvent&&this._iParentEvent.stopPropagation()},e.prototype.stopImmediatePropagation=function(){this._iAllowedToPropagate=!1,this._iParentEvent&&this._iParentEvent.stopImmediatePropagation()},e.prototype.clone=function(){var t=new e(this.type);return t.screenX=this.screenX,t.screenY=this.screenY,t.view=this.view,t.entity=this.entity,t.pickerEntity=this.pickerEntity,t.traversable=this.traversable,t.material=this.material,t.uv=this.uv,t.position=this.position,t.normal=this.normal,t.elementIndex=this.elementIndex,t.delta=this.delta,t.ctrlKey=this.ctrlKey,t.shiftKey=this.shiftKey,t._iParentEvent=this,t._iAllowedToPropagate=this._iAllowedToPropagate,t},Object.defineProperty(e.prototype,"scenePosition",{get:function(){return this.entity.transform.concatenatedMatrix3D.transformVector(this.position)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneNormal",{get:function(){var t=this.entity.transform.concatenatedMatrix3D.deltaTransformVector(this.normal);return t.normalize(),t},enumerable:!0,configurable:!0}),e.MOUSE_OVER="mouseOver3d",e.MOUSE_OUT="mouseOut3d",e.MOUSE_UP="mouseUp3d",e.MOUSE_UP_OUTSIDE="mouseUpOutside3d",e.MOUSE_DOWN="mouseDown3d",e.MOUSE_MOVE="mouseMove3d",e.DRAG_MOVE="dragMove3d",e.DRAG_OUT="dragOut3d",e.DRAG_OVER="dragOver3d",e.DRAG_START="dragStart3d",e.DRAG_STOP="dragStop3d",e.FOCUS_IN="focusIn3d",e.FOCUS_OUT="focusOut3d",e.CLICK="click3d",e.DOUBLE_CLICK="doubleClick3d",e.MOUSE_WHEEL="mouseWheel3d",e}(EventBase),LightEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.type)},e.CASTS_SHADOW_CHANGE="castsShadowChange",e}(EventBase),TextureProjectorEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.type)},e.TEXTURE_CHANGE="textureChange",e}(EventBase),MethodEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.SHADER_INVALIDATED="shaderInvalidated",e}(EventBase),TextureBase=function(t){function e(){var e=t.call(this)||this;return e._numImages=0,e._images=new Array,e._samplers=new Array,e}return __extends(e,t),Object.defineProperty(e.prototype,"mappingMode",{get:function(){return this._mappingMode},set:function(t){this._mappingMode!=t&&(this._mappingMode=t)},enumerable:!0,configurable:!0}),e.prototype.getNumImages=function(){return this._numImages},e.prototype.setNumImages=function(t){this._numImages!=t&&(this._numImages=t,this._images.length=t,this._samplers.length=t,this.invalidate())},e.prototype.getImageAt=function(t){return this._images[t]},e.prototype.setImageAt=function(t,e){this._images[e]=t,this.invalidate()},e.prototype.getSamplerAt=function(t){return this._samplers[t]},e.prototype.setSamplerAt=function(t,e){this._samplers[e]=t,this.invalidate()},e.prototype.invalidateShaderProgram=function(){this.invalidate(),this.dispatchEvent(new MethodEvent(MethodEvent.SHADER_INVALIDATED))},e}(AssetBase),Texture2D=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._mappingMode=e||MappingMode.LINEAR,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[texture Texture2D]",e}(TextureBase),TextureCube=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[texture TextureCube]",e}(TextureBase),ImageTextureCube=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i.setNumImages(1),i.image=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sampler",{get:function(){return this._samplers[0]},set:function(t){this._samplers[0]!=t&&this.setSamplerAt(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._images[0]},set:function(t){this._images[0]!=t&&this.setImageAt(t,0)},enumerable:!0,configurable:!0}),e.assetType="[texture ImageTextureCube]",e}(TextureCube),_Shader_ImageTexture=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getFragmentCode=function(t,e,i,r){this._imageIndex=this._shader.renderMaterial.getImageIndex(this._texture,0);var n=this.getTextureReg(this._imageIndex,e,i);return this._textureIndex=n.index,"tex "+t+", "+r+", "+n+" <"+this._shader.renderMaterial.images[this._imageIndex].getType()+",linear,miplinear,wrap>\n"},e.prototype.activate=function(){var t=this._shader.renderMaterial.samplers[this._imageIndex];this._shader.renderMaterial.images[this._imageIndex].activate(this._textureIndex,t)},e.prototype._setRenderState=function(t){var e=t.samplers[this._imageIndex],i=t.images[this._imageIndex];i&&e&&i.activate(this._textureIndex,e)},e}(_Shader_TextureBase);ShaderBase.registerAbstraction(_Shader_ImageTexture,ImageTextureCube);var ImageTexture2D=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,i)||this;return r.setNumImages(1),r.image=e,r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sampler",{get:function(){return this._samplers[0]},set:function(t){this._samplers[0]!=t&&this.setSamplerAt(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._images[0]},set:function(t){if(this._images[0]!=t){if(!ImageUtils.isImage2DValid(t))throw new ErrorBase("Invalid imageData: Width and height must be power of 2 and cannot exceed 2048");this.setImageAt(t,0)}},enumerable:!0,configurable:!0}),e.assetType="[texture ImageTexture2D]",e}(Texture2D),_Shader_ImageTexture2D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getFragmentCode=function(e,i,r,n){var o,s="";if(this._texture.mappingMode==MappingMode.RADIAL&&(s+="mul "+(o=i.getFreeFragmentVectorTemp())+".xy, "+n+", "+n+"\n",s+="add "+o+".x, "+o+".x, "+o+".y\n",s+="sub "+o+".y, "+o+".y, "+o+".y\n",s+="sqt "+o+".x, "+o+".x, "+o+".x\n",n=o),this._shader.useImageRect){var a=i.getFreeFragmentConstant();this._samplerIndex=4*a.index,s+="mul "+(o=i.getFreeFragmentVectorTemp())+", "+n+", "+a+".xy\n",s+="add "+o+", "+o+", "+a+".zw\n",n=o}return s+=t.prototype._getFragmentCode.call(this,e,i,r,n)},e.prototype.activate=function(){t.prototype.activate.call(this);var e=this._shader.renderMaterial.samplers[this._imageIndex];if(this._shader.useImageRect){var i=this._samplerIndex,r=this._shader.fragmentConstantData;e.imageRect?(r[i]=e.imageRect.width,r[i+1]=e.imageRect.height,r[i+2]=e.imageRect.x,r[i+3]=e.imageRect.y):(r[i]=1,r[i+1]=1,r[i+2]=0,r[i+3]=0)}},e.prototype._setRenderState=function(e){t.prototype._setRenderState.call(this,e);var i=e.samplers[this._imageIndex];if(this._shader.useImageRect&&i){var r=this._samplerIndex,n=this._shader.fragmentConstantData;i.imageRect?(n[r]=i.imageRect.width,n[r+1]=i.imageRect.height,n[r+2]=i.imageRect.x,n[r+3]=i.imageRect.y):(n[r]=1,n[r+1]=1,n[r+2]=0,n[r+3]=0)}},e}(_Shader_ImageTexture);ShaderBase.registerAbstraction(_Shader_ImageTexture2D,ImageTexture2D);var DepthTextureCube=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[texture DepthTextureCube]",e}(ImageTextureCube),_Shader_DepthTexture=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initVO=function(t){this._decodeReg=null,this._decodeIndex=-1},e.prototype._initConstants=function(){var t=this._shader.fragmentConstantData,e=this._decodeIndex;t[e]=1,t[e+1]=1/255,t[e+2]=1/65025,t[e+3]=1/16581375},e.prototype._getFragmentCode=function(e,i,r,n){-1==this._decodeIndex&&(this._decodeIndex=4*(this._decodeReg=i.getFreeFragmentConstant()).index);var o=i.getFreeFragmentVectorTemp();return t.prototype._getFragmentCode.call(this,o,i,r,n)+"dp4 "+e+".w, "+o+", "+this._decodeReg+"\n"},e}(_Shader_ImageTexture);ShaderBase.registerAbstraction(_Shader_DepthTexture,DepthTextureCube);var ShadowTexture2D=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[texture ShadowTexture2D]",e}(ImageTexture2D),_Shader_ShadowTexture2D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getFragmentCode=function(e,i,r,n){return t.prototype._getFragmentCode.call(this,e,i,r,n)+"slt "+e+".w, "+n+".z, "+e+".w\n"},e}(_Shader_DepthTexture);ShaderBase.registerAbstraction(_Shader_ShadowTexture2D,ShadowTexture2D);var MethodBase=function(t){function e(){var e=t.call(this)||this;return e._textures=new Array,e._owners=new Array,e._counts=new Array,e}return __extends(e,t),e.prototype.dispose=function(){},e.prototype.iAddOwner=function(t){var e=this._owners.indexOf(t);if(-1!=e)this._counts[e]++;else{this._owners.push(t),this._counts.push(1);for(var i=this._textures.length,r=0;r<i;r++)t.addTexture(this._textures[r])}},e.prototype.iRemoveOwner=function(t){var e=this._owners.indexOf(t);if(1!=this._counts[e])this._counts[e]--;else{this._owners.splice(e,1),this._counts.splice(e,1);for(var i=this._textures.length,r=0;r<i;r++)t.removeTexture(this._textures[r])}},e.prototype.iAddTexture=function(t){this._textures.push(t);for(var e=this._owners.length,i=0;i<e;i++)this._owners[i].addTexture(t)},e.prototype.iRemoveTexture=function(t){this._textures.splice(this._textures.indexOf(t),1);for(var e=this._owners.length,i=0;i<e;i++)this._owners[i].removeTexture(t)},e.prototype.invalidateShaderProgram=function(){this.invalidate(),this.dispatchEvent(new MethodEvent(MethodEvent.SHADER_INVALIDATED))},e.prototype.copyFrom=function(t){},e}(AssetBase),_Shader_MethodBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.chunkVO=new ChunkVO,r}return __extends(e,t),e.prototype._isUsed=function(){return!0},e.prototype._usesTangentSpace=function(){return!0},e.prototype._initVO=function(t){},e.prototype._initConstants=function(){},e.prototype._reset=function(t){this._invalid=!0,t.useChunk=!1,t.needsProjection=!1,t.needsView=!1,t.needsNormals=!1,t.needsTangents=!1,t.needsGlobalVertexPos=!1,t.needsGlobalFragmentPos=!1,this._cleanCompilationData()},e.prototype._cleanCompilationData=function(){},e.prototype._getVertexCode=function(t,e){return""},e.prototype._getFragmentCode=function(t,e,i){return""},e.prototype._activate=function(){},e.prototype._setRenderState=function(t,e){},e.prototype._deactivate=function(){this._invalid=!1},e}(AbstractionBase),ShadowMapperBase=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._epsilon=.02,e._alpha=1,e.autoUpdate=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"textureMap",{get:function(){return this._textureMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"light",{get:function(){return this._light},set:function(t){this._light!=t&&(this._light=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"epsilon",{get:function(){return this._epsilon},set:function(t){this._epsilon=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size!=t&&(this._size=t,this._updateSize())},enumerable:!0,configurable:!0}),e.prototype.update=function(t,e){this._updateProjection(e.view.projection),this._renderMap(t,e)},e.prototype._updateProjection=function(t){throw new AbstractMethodError},e.prototype._renderMap=function(t,e){throw new AbstractMethodError},e.prototype._updateSize=function(){throw new AbstractMethodError},e.prototype.dispose=function(){this._light=null},e}(MethodBase),_Shader_ShadowMapperBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.autoUpdate=!0,r._mapper=e,r._shader=i,r._shader.renderMaterial.renderGroup._addMapper(r._mapper),r}return __extends(e,t),e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._depthMapCoordReg=null},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMapCoordReg",{get:function(){return this._depthMapCoordReg},enumerable:!0,configurable:!0}),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._shader.renderMaterial.renderGroup._removeMapper(this._mapper)},e.prototype._initVO=function(t){this._texture=this._shader.getAbstraction(this._mapper.textureMap),this._texture._initVO(t)},e.prototype._initConstants=function(){this._texture._initConstants()},e.prototype._getFragmentCode=function(t,e,i){var r=e.getFreeFragmentConstant();return this._fragmentAlphaIndex=4*r.index,"add "+t+".w, "+t+".w, "+r+".x\nsat "+t+".w, "+t+".w\n"},e.prototype._activate=function(){this._shader.fragmentConstantData[this._fragmentAlphaIndex]=1-this._mapper.alpha,this._texture.activate()},e.prototype._setRenderState=function(t,e){this._texture._setRenderState(t)},e}(_Shader_MethodBase),DirectionalShadowMapper=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._lightOffset=1e4,i._snap=64,i._size=2048,i._image2D=e||new Image2D(i._size,i._size),i._textureMap=new ShadowTexture2D(i._image2D),i.iAddTexture(i._textureMap),i._cullPlanes=[],i._overallDepthProjection=new OrthographicProjection,i._overallDepthProjection.transform=new Transform,i._localFrustum=[],i._matrix=new Matrix3D,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._textureMap.image=null,this._textureMap=null,this._image2D=null},Object.defineProperty(e.prototype,"snap",{get:function(){return this._snap},set:function(t){this._snap=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightOffset",{get:function(){return this._lightOffset},set:function(t){this._lightOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthProjection",{get:function(){return this._overallDepthProjection.viewMatrix3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._maxZ-this._minZ},enumerable:!0,configurable:!0}),e.prototype._updateSize=function(){this._image2D._setSize(this._size,this._size)},e.prototype._updateProjection=function(t){this._updateProjectionFromFrustumCorners(t,t.viewFrustumCorners,this._matrix),this._overallDepthProjection.frustumMatrix3D=this._matrix,this._updateCullPlanes(t)},e.prototype._renderMap=function(t,e){var i=e.depthRenderGroup.getRenderer(t);i.cullPlanes=this._cullPlanes,i.view.preservePixelRatio=!1,i.view.target=this._image2D,i.view.projection=this._overallDepthProjection,i.render()},e.prototype._updateCullPlanes=function(t){var e=this._overallDepthProjection.viewFrustumPlanes,i=t.viewFrustumPlanes;this._cullPlanes.length=4,this._cullPlanes[0]=e[0],this._cullPlanes[1]=e[1],this._cullPlanes[2]=e[2],this._cullPlanes[3]=e[3];for(var r=this._light.sceneDirection,n=r.x,o=r.y,s=r.z,a=4,l=0;l<6;++l){var h=i[l];h.a*n+h.b*o+h.c*s<0&&(this._cullPlanes[a++]=h)}},e.prototype._updateProjectionFromFrustumCorners=function(t,e,i){var r,n,o,s,a,l,h,c,u=t.transform.concatenatedMatrix3D.position,p=this._light.sceneDirection;for(this._overallDepthProjection.transform.matrix3D=this._light.transform.concatenatedMatrix3D,r=Math.floor((u.x-p.x*this._lightOffset)/this._snap)*this._snap,n=Math.floor((u.y-p.y*this._lightOffset)/this._snap)*this._snap,o=Math.floor((u.z-p.z*this._lightOffset)/this._snap)*this._snap,this._overallDepthProjection.transform.moveTo(r,n,o),this._overallDepthProjection.transform.inverseConcatenatedMatrix3D.transformVectors(e,this._localFrustum),s=l=this._localFrustum[0],a=h=this._localFrustum[1],this._maxZ=this._localFrustum[2],c=3;c<24;)(r=this._localFrustum[c])<s&&(s=r),r>l&&(l=r),(n=this._localFrustum[c+1])<a&&(a=n),n>h&&(h=n),(o=this._localFrustum[c+2])>this._maxZ&&(this._maxZ=o),c+=3;this._minZ=1;var d=l-s,f=h-a,_=1/(this._maxZ-this._minZ);s<0&&(s-=this._snap),a<0&&(a-=this._snap),s=Math.floor(s/this._snap)*this._snap,a=Math.floor(a/this._snap)*this._snap;var g=2*this._snap;l=s+(d=Math.floor(d/g+2)*g),h=a+(f=Math.floor(f/g+2)*g),d=1/d,f=1/f;var m=i._rawData;m[0]=2*d,m[5]=2*f,m[10]=_,m[12]=-(l+s)*d,m[13]=-(h+a)*f,m[14]=-this._minZ*_,m[15]=1,m[1]=m[2]=m[3]=m[4]=m[6]=m[7]=m[8]=m[9]=m[11]=0,i.invalidatePosition()},e.assetType="[asset DirectionalShadowMapper]",e}(ShadowMapperBase),_Shader_DirectionalShadowMapper=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),e.needsView=!0,e.needsGlobalVertexPos=!0},e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._shader.vertexConstantData,i=this._vertexScalingIndex;e[i]=.5,e[i+1]=.5,e[i+2]=0,e[i+3]=1,this._depthProjectionMatrix=new Matrix3D(new Float32Array(this._shader.vertexConstantData.buffer,4*(i+4),16))},e.prototype._getVertexCode=function(t,e){var i="",r=t.getFreeVertexVectorTemp(),n=t.getFreeVertexConstant();this._vertexScalingIndex=4*n.index;var o=t.getFreeVertexConstant();return t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),this._depthMapCoordReg=t.getFreeVarying(),i+="m44 "+r+", "+e.globalPositionVertex+", "+o+"\ndiv "+r+", "+r+", "+r+".w\nmul "+r+".xy, "+r+".xy, "+n+".xy\nadd "+this._depthMapCoordReg+", "+r+", "+n+".xxwz\n"},e.prototype._activate=function(){t.prototype._activate.call(this);var e=this._shader.vertexConstantData;this._vertexScalingIndex;e[this._vertexScalingIndex+3]=-1/(this._mapper.depth*this._mapper.epsilon),this._depthProjectionMatrix.copyFrom(this._mapper.depthProjection,!0)},e}(_Shader_ShadowMapperBase);ShaderBase.registerAbstraction(_Shader_DirectionalShadowMapper,DirectionalShadowMapper);var LightBase=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._color=16777215,i._colorR=1,i._colorG=1,i._colorB=1,i._ambientColor=16777215,i._ambient=0,i._specular=1,i._diffuse=1,i._shadowsEnabled=!1,i._ambientR=0,i._ambientG=0,i._ambientB=0,i._specularR=1,i._specularG=1,i._specularB=1,i._diffuseR=1,i._diffuseG=1,i._diffuseB=1,i._onInvalidateConcatenatedMatrix3DDelegate=function(t){return i._onInvalidateConcatenatedMatrix3D(t)},i.transform=e||new Transform,i}return __extends(e,t),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform!=t&&(this._transform&&this._transform.removeEventListener(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateConcatenatedMatrix3DDelegate),this._transform=t,this._transform&&this._transform.addEventListener(TransformEvent.INVALIDATE_CONCATENATED_MATRIX3D,this._onInvalidateConcatenatedMatrix3DDelegate))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){this._shadowsEnabled!=t&&(this._shadowsEnabled=t,t&&null==this._shadowMapper?(this._shadowMapper=this._createShadowMapper(),this._shadowMapper.light=this):t||(this._shadowMapper.dispose(),this._shadowMapper=null),this.dispatchEvent(new LightEvent(LightEvent.CASTS_SHADOW_CHANGE)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specular",{get:function(){return this._specular},set:function(t){t<0&&(t=0),this._specular=t,this._updateSpecular()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuse",{get:function(){return this._diffuse},set:function(t){t<0&&(t=0),this._diffuse=t,this._updateDiffuse()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._colorR=(this._color>>16&255)/255,this._colorG=(this._color>>8&255)/255,this._colorB=(255&this._color)/255,this._updateDiffuse(),this._updateSpecular()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambient",{get:function(){return this._ambient},set:function(t){t<0?t=0:t>1&&(t=1),this._ambient=t,this._updateAmbient()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientColor",{get:function(){return this._ambientColor},set:function(t){this._ambientColor!=t&&(this._ambientColor=t,this._updateAmbient())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowMapper",{get:function(){return this.shadowsEnabled=!0,this._shadowMapper},set:function(t){this._shadowMapper!=t&&(this._shadowMapper=t,this._shadowMapper.light=this)},enumerable:!0,configurable:!0}),e.prototype._createShadowMapper=function(){throw new AbstractMethodError},e.prototype._updateSpecular=function(){this._specularR=this._colorR*this._specular,this._specularG=this._colorG*this._specular,this._specularB=this._colorB*this._specular},e.prototype._updateDiffuse=function(){this._diffuseR=this._colorR*this._diffuse,this._diffuseG=this._colorG*this._diffuse,this._diffuseB=this._colorB*this._diffuse},e.prototype._updateAmbient=function(){this._ambientR=(this._ambientColor>>16&255)/255*this._ambient,this._ambientG=(this._ambientColor>>8&255)/255*this._ambient,this._ambientB=(255&this._ambientColor)/255*this._ambient},e.prototype._onInvalidateConcatenatedMatrix3D=function(t){},e}(AssetBase),DirectionalLight=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,i)||this;return r._sceneDirectionDirty=!0,e&&(r.direction=e),r._sceneDirection=new Vector3D,r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneDirection",{get:function(){return this._sceneDirectionDirty&&this._updateSceneDirection(),this._sceneDirection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction=t,this._tmpLookAt||(this._tmpLookAt=new Vector3D),this._tmpLookAt.x=this.transform.position.x+this._direction.x,this._tmpLookAt.y=this.transform.position.y+this._direction.y,this._tmpLookAt.z=this.transform.position.z+this._direction.z,this.transform.lookAt(this._tmpLookAt)},enumerable:!0,configurable:!0}),e.prototype._onInvalidateConcatenatedMatrix3D=function(t){this._sceneDirectionDirty=!0},e.prototype._updateSceneDirection=function(){this._sceneDirectionDirty=!1,this.transform.concatenatedMatrix3D.copyColumnTo(2,this._sceneDirection),this._sceneDirection.normalize()},e.prototype._createShadowMapper=function(){return new DirectionalShadowMapper},e.assetType="[light DirectionalLight]",e}(LightBase),LightProbe=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this)||this;return r.diffuseSampler=new ImageSampler,r.specularSampler=new ImageSampler,r.diffuseMap=e,r.specularMap=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[light LightProbe]",e}(LightBase),ShadowTextureCube=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this,i)||this;return r._mapper=e,r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapper",{get:function(){return this._mapper},enumerable:!0,configurable:!0}),e.assetType="[texture ShadowTextureCube]",e}(ImageTextureCube),_Shader_ShadowTextureCube=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getFragmentCode=function(e,i,r,n){var o=i.getFreeFragmentConstant();this._positionIndex=4*o.index;var s=i.getFreeFragmentConstant(),a="",l=i.getFreeFragmentVectorTemp();return a+="sub "+l+", "+n+", "+o+"\ndp3 "+l+".w, "+l+".xyz, "+l+".xyz\nnrm "+l+".xyz, "+l+".xyz\n",a+=t.prototype._getFragmentCode.call(this,e,i,r,l)+"add "+l+".w, "+l+".w, "+s+".x\nmul "+l+".w, "+l+".w, "+o+".w\nslt "+e+".w, "+l+".w, "+e+".w\n"},e.prototype._activate=function(){t.prototype.activate.call(this);var e=this._shader.fragmentConstantData,i=this._positionIndex,r=this._texture.mapper.light.transform.concatenatedMatrix3D.position,n=this._texture.mapper.light.fallOff;e[i]=r.x,e[i+1]=r.y,e[i+2]=r.z,e[i+3]=1/(2*n*n),e[i+4]=-Math.pow(1/(n*this._texture.mapper.epsilon),2)},e}(_Shader_DepthTexture);ShaderBase.registerAbstraction(_Shader_ShadowTextureCube,ShadowTextureCube);var PointShadowMapper=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._needsRender=new Array,i._size=512,i._imageCube=e||new ImageCube(i._size),i._textureMap=new ShadowTextureCube(i,i._imageCube),i.iAddTexture(i._textureMap),i.initCameras(),i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._textureMap.image=null,this._textureMap=null,this._imageCube=null},e.prototype.initCameras=function(){this._depthProjections=new Array,this.addProjection(0,90,0),this.addProjection(0,-90,0),this.addProjection(-90,0,0),this.addProjection(90,0,0),this.addProjection(0,0,0),this.addProjection(0,180,0)},e.prototype.addProjection=function(t,e,i){var r=new PerspectiveProjection;r.transform=new Transform,r.transform.rotateTo(t,e,i),r.near=.01,r.fieldOfView=90,this._depthProjections.push(r)},e.prototype._updateSize=function(){this._imageCube._setSize(this._size)},e.prototype._updateProjection=function(t){for(var e=this._light.fallOff,i=this._light.transform.concatenatedMatrix3D.position,r=0;r<6;++r)this._depthProjections[r].far=e,this._depthProjections[r].transform.moveTo(i.x,i.y,i.z),this._needsRender[r]=!0},e.prototype._renderMap=function(t,e){for(var i=e.distanceRenderGroup.getRenderer(t),r=0;r<6;++r)this._needsRender[r]&&(i.view.target=this._imageCube,i.view.projection=this._depthProjections[r],i.render(null,r))},e.assetType="[asset PointShadowMapper]",e}(ShadowMapperBase),_Shader_PointShadowMapper=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),e.needsGlobalFragmentPos=!0},e.prototype._getVertexCode=function(t,e){return this._depthMapCoordReg=e.globalPositionVarying,""},e}(_Shader_ShadowMapperBase);ShaderBase.registerAbstraction(_Shader_PointShadowMapper,PointShadowMapper);var PointLight=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,i)||this;return r._radius=9e4,r._fallOff=1e5,e&&(r._transform.matrix3D._rawData[12]=e.x,r._transform.matrix3D._rawData[13]=e.y,r._transform.matrix3D._rawData[14]=e.z,r._transform.invalidatePosition()),r._fallOffFactor=1/(r._fallOff*r._fallOff-r._radius*r._radius),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._radius<0?this._radius=0:this._radius>this._fallOff&&(this._fallOff=this._radius),this._fallOffFactor=1/(this._fallOff*this._fallOff-this._radius*this._radius)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallOff",{get:function(){return this._fallOff},set:function(t){this._fallOff=t,this._fallOff<0&&(this._fallOff=0),this._fallOff<this._radius&&(this._radius=this._fallOff),this._fallOffFactor=1/(this._fallOff*this._fallOff-this._radius*this._radius)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallOffFactor",{get:function(){return this._fallOffFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._transform.position.x},set:function(t){this._transform.position.x!=t&&(this._transform.matrix3D._rawData[12]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._transform.position.y},set:function(t){this._transform.position.y!=t&&(this._transform.matrix3D._rawData[13]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._transform.position.z},set:function(t){this._transform.position.z!=t&&(this._transform.matrix3D._rawData[14]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenePosition",{get:function(){return this._transform.concatenatedMatrix3D.position},enumerable:!0,configurable:!0}),e.prototype._createShadowMapper=function(){return new PointShadowMapper},e.assetType="[light PointLight]",e}(LightBase),TextureProjector=function(t){function e(e,i){void 0===i&&(i=null);var r=t.call(this)||this;r._transform=i||new Transform,r._projection=new PerspectiveProjection,r._projection.transform=r._transform,r._texture=e;e.getImageAt(0).width,e.getImageAt(0).height;return r}return __extends(e,t),Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},set:function(t){this._transform!=t&&(this._transform=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){if(t!=this._texture){this._texture=t;t.getImageAt(0).width,t.getImageAt(0).height;this.dispatchEvent(new TextureProjectorEvent(TextureProjectorEvent.TEXTURE_CHANGE))}},enumerable:!0,configurable:!0}),e.assetType="[asset TextureProjector]",e}(AssetBase),AmbientBasicMethod=function(t){function e(){var e=t.call(this)||this;return e._alpha=1,e._strength=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength!=t&&(this._strength=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!=t&&(this._alpha=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.iRemoveTexture(this._texture),this._texture=t,this._texture&&this.iAddTexture(this._texture),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(t){},e.assetType="[asset AmbientBasicMethod]",e}(MethodBase),_Shader_AmbientBasicMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._method=null,this._shader=null,this._texture&&(this._texture.onClear(new AssetEvent(AssetEvent.CLEAR,this._method.texture)),this._texture=null)},e.prototype._initVO=function(t){this._method.texture?(this._texture=this._shader.getAbstraction(this._method.texture),this._texture._initVO(t),this._method.texture instanceof TextureCube?t.needsNormals=!0:this._shader.uvDependencies++):this._texture&&(this._texture=null)},e.prototype._initConstants=function(){this._texture&&this._texture._initConstants()},e.prototype._getFragmentCode=function(t,e,i){var r="";if(this._texture){if(r+=this._texture._getFragmentCode(t,e,i,this._method.texture instanceof TextureCube?i.normalFragment:i.uvVarying),this._shader.alphaThreshold>0){var n=e.getFreeFragmentConstant();this._colorIndex=4*n.index,r+="sub "+t+".w, "+t+".w, "+n+".x\nkil "+t+".w\nadd "+t+".w, "+t+".w, "+n+".x\n"}}else{var o=e.getFreeFragmentConstant();this._colorIndex=4*o.index,r+="mov "+t+", "+o+"\n"}return r},e.prototype._activate=function(){if(this._texture)this._texture.activate(),this._invalid&&this._shader.alphaThreshold>0&&(this._shader.fragmentConstantData[this._colorIndex]=this._shader.alphaThreshold);else if(this._invalid){var t=this._colorIndex,e=this._shader.fragmentConstantData,i=this._shader.numLights?16777215:this._shader.renderMaterial.style.color;e[t]=(i>>16&255)/255*this._method.strength,e[t+1]=(i>>8&255)/255*this._method.strength,e[t+2]=(255&i)/255*this._method.strength,e[t+3]=this._method.alpha}},e.prototype._setRenderState=function(t,e){this._texture&&this._texture._setRenderState(t)},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_AmbientBasicMethod,AmbientBasicMethod);var AmbientDepthMethod=function(t){function e(e){var i=t.call(this)||this;return i._castingLight=e,e.shadowsEnabled=!0,i._shadowMapper=e.shadowMapper,i.iAddTexture(e.shadowMapper.textureMap),i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castingLight",{get:function(){return this._castingLight},enumerable:!0,configurable:!0}),e.assetType="[asset AmbientDepthMethod]",e}(AmbientBasicMethod),_Shader_AmbientDepthMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shadowTexture=i.getAbstraction(e.castingLight.shadowMapper.textureMap),r}return __extends(e,t),e.prototype._initVO=function(t){this._shadowTexture._initVO(t)},e.prototype._initConstants=function(){this._shadowTexture._initConstants();var t=this._shader.fragmentConstantData,e=this._decRegIndex;t[e]=1,t[e+1]=1/255,t[e+2]=1/65025,t[e+3]=1/16581375},e.prototype._getFragmentCode=function(t,e,i){var r="",n=e.getFreeFragmentConstant();return this._decRegIndex=4*n.index,r+=this._shadowTexture._getFragmentCode(t,e,i,i.uvVarying)+"dp4 "+t+".x, "+t+", "+n+"\nmov "+t+".yz, "+t+".xx\t\t\t\nmov "+t+".w, "+n+".x\nsub "+t+".xyz, "+n+".xxx, "+t+".xyz\n"},e}(_Shader_AmbientBasicMethod);ShaderBase.registerAbstraction(_Shader_AmbientDepthMethod,AmbientDepthMethod);var CompositeMethodBase=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._onShaderInvalidatedDelegate=function(t){return i.onShaderInvalidated(t)},i._baseMethod=e||i.createBaseMethod(),i._baseMethod.addEventListener(MethodEvent.SHADER_INVALIDATED,i._onShaderInvalidatedDelegate),i}return __extends(e,t),Object.defineProperty(e.prototype,"baseMethod",{get:function(){return this._baseMethod},set:function(t){this._baseMethod!=t&&(this._baseMethod.removeEventListener(MethodEvent.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this._baseMethod=t,this._baseMethod.addEventListener(MethodEvent.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.createBaseMethod=function(){throw new AbstractMethodError},e.prototype.iAddOwner=function(e){t.prototype.iAddOwner.call(this,e),this._baseMethod.iAddOwner(e)},e.prototype.iRemoveOwner=function(e){t.prototype.iRemoveOwner.call(this,e),this._baseMethod.iRemoveOwner(e)},e.prototype.dispose=function(){this._baseMethod.removeEventListener(MethodEvent.SHADER_INVALIDATED,this._onShaderInvalidatedDelegate)},e.prototype.onShaderInvalidated=function(t){this.invalidateShaderProgram()},e}(MethodBase),_Shader_CompositeMethodBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.chunkVO=new ChunkVO,r._baseChunk=i.getAbstraction(e.baseMethod),r}return __extends(e,t),e.prototype._isUsed=function(){return!0},e.prototype._usesTangentSpace=function(){return this._baseChunk._usesTangentSpace()},e.prototype._initVO=function(t){this._baseChunk._initVO(t)},e.prototype._initConstants=function(){this._baseChunk._initConstants()},e.prototype._activate=function(){this._baseChunk._activate()},e.prototype._setRenderState=function(t,e){this._baseChunk._setRenderState(t,e)},e.prototype._deactivate=function(){this._baseChunk._deactivate(),this._invalid=!1},e.prototype._getVertexCode=function(t,e){return this._baseChunk._getVertexCode(t,e)},e.prototype._getFragmentCode=function(t,e,i){return this._baseChunk._getFragmentCode(t,e,i)},e.prototype._reset=function(t){this._baseChunk._reset(t),this._invalid=!0,this._cleanCompilationData()},e.prototype._cleanCompilationData=function(){this._baseChunk._cleanCompilationData()},e}(AbstractionBase),_Shader_LightingCompositeMethod=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getFragmentPreLightingCode=function(t,e){return this._baseChunk._getFragmentPreLightingCode(t,e)},e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n=this._baseChunk._getFragmentCodePerLight(t,e,i,r);return this._totalLightColorReg=this._baseChunk._totalLightColorReg,n},e.prototype._getFragmentCodePerProbe=function(t,e,i,r){var n=this._baseChunk._getFragmentCodePerProbe(t,e,i,r);return this._totalLightColorReg=this._baseChunk._totalLightColorReg,n},e}(_Shader_CompositeMethodBase),DiffuseBasicMethod=function(t){function e(){var e=t.call(this)||this;return e._multiply=!0,e._ambientColorR=1,e._ambientColorG=1,e._ambientColorB=1,e._color=16777215,e._colorR=1,e._colorG=1,e._colorB=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiply",{get:function(){return this._multiply},set:function(t){this._multiply!=t&&(this._multiply=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.iRemoveTexture(this._texture),this._texture=t,this._texture&&this.iAddTexture(this._texture),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._texture=null},e.prototype.copyFrom=function(t){var e=t;this.texture=e.texture,this.multiply=e.multiply,this.color=e.color},e.assetType="[asset DiffuseBasicMethod]",e}(MethodBase),_Shader_DiffuseBasicMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._ambientColorR=1,r._ambientColorG=1,r._ambientColorB=1,r._color=16777215,r._colorR=1,r._colorG=1,r._colorB=1,r._method=e,r._shader=i,r}return __extends(e,t),e.prototype.onInvalidate=function(e){t.prototype.onInvalidate.call(this,e),this._updateProperties()},e.prototype._isUsed=function(){return Boolean(this._shader.numLights)},e.prototype._initVO=function(t){this._method.texture?(this._texture=this._shader.getAbstraction(this._method.texture),this._texture._initVO(t),this._method.texture instanceof TextureCube?t.needsNormals=!0:this._shader.uvDependencies++):this._texture&&(this._texture=null),this._shader.numLights&&(this._shader.usesCommonData=!0,t.needsNormals=!0)},e.prototype._initConstants=function(){this._texture&&this._texture._initConstants(),this._updateProperties()},e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._totalLightColorReg=null},e.prototype._getFragmentPreLightingCode=function(t,e){return this._pIsFirstLight=!0,t.addFragmentTempUsages(this._totalLightColorReg=t.getFreeFragmentVectorTemp(),1),""},e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n,o="";return this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1)),o+="dp3 "+n+".x, "+t+", "+r.normalFragment+"\nmax "+n+".w, "+n+".x, "+r.commons+".y\n",this._shader.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+t+".w\n"),null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),o+="mul "+n+", "+n+".w, "+e+"\n",this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+n+"\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e.prototype._getFragmentCodePerProbe=function(t,e,i,r){var n,o="";return this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1)),o+="tex "+n+", "+r.normalFragment+", "+t+" <cube,linear,miplinear>\nmul "+n+".xyz, "+n+".xyz, "+e+"\n",null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+n+"\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e.prototype._getFragmentCode=function(t,e,i){var r,n="";i.shadowTarget&&(n+=this._applyShadow(e,i)),e.addFragmentTempUsages(r=e.getFreeFragmentVectorTemp(),1);var o=e.getFreeFragmentConstant();if(this._ambientColorRegister=4*o.index,this._texture)n+=this._texture._getFragmentCode(r,e,i,this._method.texture instanceof TextureCube?i.normalFragment:i.uvVarying);else{var s=e.getFreeFragmentConstant();this._diffuseColorRegister=4*s.index,n+="mov "+r+", "+s+"\n"}return n+="sat "+this._totalLightColorReg+", "+this._totalLightColorReg+"\nmul "+r+".xyz, "+r+", "+this._totalLightColorReg+"\n",this._method.multiply?n+="add "+r+".xyz, "+r+", "+o+"\nmul "+t+".xyz, "+t+", "+r+"\n":this._texture?n+="mul "+t+".xyz, "+t+", "+o+"\nmul "+this._totalLightColorReg+".xyz, "+t+", "+this._totalLightColorReg+"\nsub "+t+".xyz, "+t+", "+this._totalLightColorReg+"\nadd "+t+".xyz, "+t+", "+r+"\n":n+="mul "+this._totalLightColorReg+".xyz, "+o+", "+this._totalLightColorReg+"\nsub "+this._totalLightColorReg+".xyz, "+o+", "+this._totalLightColorReg+"\nadd "+r+".xyz, "+r+", "+this._totalLightColorReg+"\nmul "+t+".xyz, "+t+", "+r+"\n",e.removeFragmentTempUsage(this._totalLightColorReg),e.removeFragmentTempUsage(r),n},e.prototype._applyShadow=function(t,e){return"mul "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+e.shadowTarget+".w\n"},e.prototype._activate=function(){if(this._texture)this._texture.activate();else{var t=this._diffuseColorRegister,e=this._shader.fragmentConstantData;this._method.multiply?(e[t]=this._colorR*this._ambientColorR,e[t+1]=this._colorG*this._ambientColorG,e[t+2]=this._colorB*this._ambientColorB):(e[t]=this._colorR,e[t+1]=this._colorG,e[t+2]=this._colorB),e[t+3]=1}},e.prototype._updateProperties=function(){this._ambientColor=this._shader.renderMaterial.style.color,this._ambientColorR=(this._ambientColor>>16&255)/255,this._ambientColorG=(this._ambientColor>>8&255)/255,this._ambientColorB=(255&this._ambientColor)/255,this._color=this._method.color,this._colorR=(this._color>>16&255)/255,this._colorG=(this._color>>8&255)/255,this._colorB=(255&this._color)/255},e.prototype._setRenderState=function(t,e){this._texture&&this._texture._setRenderState(t);var i=this._ambientColorRegister,r=this._shader.fragmentConstantData;r[i]=this._shader.ambientR*this._ambientColorR,r[i+1]=this._shader.ambientG*this._ambientColorG,r[i+2]=this._shader.ambientB*this._ambientColorB,r[i+3]=1},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_DiffuseBasicMethod,DiffuseBasicMethod);var DiffuseCompositeMethod=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),e.prototype.createBaseMethod=function(){return new DiffuseBasicMethod},Object.defineProperty(e.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(t){this._baseMethod.texture=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._baseMethod.color},set:function(t){this._baseMethod.color=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiply",{get:function(){return this._baseMethod.multiply},set:function(t){this._baseMethod.multiply=t},enumerable:!0,configurable:!0}),e}(CompositeMethodBase),DiffuseCelMethod=function(t){function e(e,i,r){void 0===e&&(e=3),void 0===i&&(i=.1),void 0===r&&(r=null);var n=t.call(this,r)||this;return n._levels=e,n._smoothness=i,n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},set:function(t){this._levels=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness=t},enumerable:!0,configurable:!0}),e.assetType="[asset DiffuseCelMethod]",e}(DiffuseCompositeMethod),_Shader_DiffuseCelMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r._baseChunk._modulateFunction=function(t,e,i){return r.clampDiffuse(t,e,i)},r}return __extends(e,t),e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._shader.fragmentConstantData,i=this._clampDataIndex;e[i+1]=1,e[i+2]=0},e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._clampDataRegister=null},e.prototype._getFragmentPreLightingCode=function(e,i){return this._clampDataRegister=e.getFreeFragmentConstant(),this._clampDataIndex=4*this._clampDataRegister.index,t.prototype._getFragmentPreLightingCode.call(this,e,i)},e.prototype._activate=function(){if(t.prototype._activate.call(this),this._invalid){var e=this._shader.fragmentConstantData,i=this._clampDataIndex;e[i]=this._method.levels,e[i+3]=this._method.smoothness}},e.prototype.clampDiffuse=function(t,e,i){return"mul "+t+".w, "+t+".w, "+this._clampDataRegister+".x\nfrc "+t+".z, "+t+".w\nsub "+t+".y, "+t+".w, "+t+".z\nmov "+t+".x, "+this._clampDataRegister+".x\nsub "+t+".x, "+t+".x, "+this._clampDataRegister+".y\nrcp "+t+".x,"+t+".x\nmul "+t+".w, "+t+".y, "+t+".x\nsub "+t+".y, "+t+".w, "+t+".x\ndiv "+t+".z, "+t+".z, "+this._clampDataRegister+".w\nsat "+t+".z, "+t+".z\nmul "+t+".w, "+t+".w, "+t+".z\nsub "+t+".z, "+this._clampDataRegister+".y, "+t+".z\nmul "+t+".y, "+t+".y, "+t+".z\nadd "+t+".w, "+t+".w, "+t+".y\nsat "+t+".w, "+t+".w\n"},e}(_Shader_LightingCompositeMethod);ShaderBase.registerAbstraction(_Shader_DiffuseCelMethod,DiffuseCelMethod);var DiffuseGradientMethod=function(t){function e(e){var i=t.call(this)||this;return i._gradient=e,i.iAddTexture(i._gradient),i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gradient",{get:function(){return this._gradient},set:function(t){this._gradient!=t&&(this._gradient&&this.iRemoveTexture(this._gradient),this._gradient=t,this._gradient&&this.iAddTexture(this._gradient),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.assetType="[asset DiffuseGradientMethod]",e}(DiffuseBasicMethod),_Shader_DiffuseGradientMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),this._gradient=this._shader.getAbstraction(this._method.gradient||new ImageTexture2D),this._gradient._initVO(e)},e.prototype._initConstants=function(){this._gradient._initConstants()},e.prototype._getFragmentPreLightingCode=function(e,i){var r=t.prototype._getFragmentPreLightingCode.call(this,e,i);return this._pIsFirstLight=!0,r},e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n,o="";return this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1)),o+="dp3 "+n+".w, "+t+".xyz, "+r.normalFragment+".xyz\nmul "+n+".w, "+n+".w, "+r.commons+".x\nadd "+n+".w, "+n+".w, "+r.commons+".x\nmul "+n+".xyz, "+n+".w, "+t+".w\n",null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),o+=this._gradient._getFragmentCode(n,i,r,n)+"mul "+n+".xyz, "+n+".xyz, "+e+".xyz\n",this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+".xyz, "+n+".xyz\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e.prototype._activate=function(){t.prototype._activate.call(this),this._gradient.activate()},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),this._gradient._setRenderState(e)},e}(_Shader_DiffuseBasicMethod);ShaderBase.registerAbstraction(_Shader_DiffuseGradientMethod,DiffuseGradientMethod);var DiffuseLightMapMethod=function(t){function e(e,i,r,n){void 0===i&&(i="multiply"),void 0===r&&(r=!1),void 0===n&&(n=null);var o=t.call(this,n)||this;return o._lightMap=e,o.blendMode=i,o._useSecondaryUV=r,o._lightMap&&o.iAddTexture(o._lightMap),o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(t!=e.ADD&&t!=e.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode!=t&&(this._blendMode=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightMap",{get:function(){return this._lightMap},set:function(t){this._lightMap!=t&&(this._lightMap&&this.iRemoveTexture(this._lightMap),this._lightMap=t,this._lightMap&&this.iAddTexture(this._lightMap),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){this._useSecondaryUV!=t&&(this._useSecondaryUV=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.MULTIPLY="multiply",e.ADD="add",e.assetType="[asset DiffuseLightMapMethod]",e}(DiffuseCompositeMethod),_Shader_DiffuseLightMapMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){this._lightMap=this._shader.getAbstraction(this._method.lightMap||new ImageTexture2D),this._lightMap._initVO(t),this._method.useSecondaryUV?this._shader.secondaryUVDependencies++:this._shader.uvDependencies++},e.prototype._initConstants=function(){this._lightMap._initConstants()},e.prototype._getFragmentCode=function(e,i,r){var n,o=i.getFreeFragmentVectorTemp();switch(n=this._lightMap._getFragmentCode(o,i,r,this._method.useSecondaryUV?r.secondaryUVVarying:r.uvVarying),this._method.blendMode){case DiffuseLightMapMethod.MULTIPLY:n+="mul "+this._totalLightColorReg+", "+this._totalLightColorReg+", "+o+"\n";break;case DiffuseLightMapMethod.ADD:n+="add "+this._totalLightColorReg+", "+this._totalLightColorReg+", "+o+"\n"}return n+=t.prototype._getFragmentCode.call(this,e,i,r)},e.prototype._activate=function(){t.prototype._activate.call(this),this._lightMap.activate()},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),this._lightMap._setRenderState(e)},e}(_Shader_LightingCompositeMethod);ShaderBase.registerAbstraction(_Shader_DiffuseLightMapMethod,DiffuseLightMapMethod);var DiffuseWrapMethod=function(t){function e(e){void 0===e&&(e=.5);var i=t.call(this)||this;return i.wrapFactor=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapFactor",{get:function(){return this._wrapFactor},set:function(t){this._wrapFactor=t,this._wrapFactor=1/(t+1),this.invalidate()},enumerable:!0,configurable:!0}),e.assetType="[asset DiffuseWrapMethod]",e}(DiffuseBasicMethod),_Shader_DiffuseWrapMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._wrapDataRegister=null},e.prototype._getFragmentPreLightingCode=function(e,i){var r=t.prototype._getFragmentPreLightingCode.call(this,e,i);return this._pIsFirstLight=!0,this._wrapDataRegister=e.getFreeFragmentConstant(),this._wrapDataIndex=4*this._wrapDataRegister.index,r},e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n,o="";return this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1)),o+="dp3 "+n+".x, "+t+".xyz, "+r.normalFragment+".xyz\nadd "+n+".y, "+n+".x, "+this._wrapDataRegister+".x\nmul "+n+".y, "+n+".y, "+this._wrapDataRegister+".y\nsat "+n+".w, "+n+".y\nmul "+n+".xz, "+n+".w, "+t+".wz\n",null!=this._modulateFunction&&(o+=this._modulateFunction(t,i,r)),o+="mul "+n+", "+n+".x, "+e+"\n",this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+".xyz, "+n+".xyz\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e.prototype._activate=function(){if(t.prototype._activate.call(this),this._invalid){var e=this._wrapDataIndex,i=this._shader.fragmentConstantData;i[e]=this._method.wrapFactor,i[e+1]=1/(this._method.wrapFactor+1)}},e}(_Shader_DiffuseBasicMethod);ShaderBase.registerAbstraction(_Shader_DiffuseWrapMethod,DiffuseWrapMethod);var EffectAlphaMaskMethod=function(t){function e(e,i){void 0===i&&(i=!1);var r=t.call(this)||this;return r._texture=e,r._useSecondaryUV=i,r._texture&&r.iAddTexture(r._texture),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.iRemoveTexture(this._texture),this._texture=t,this._texture&&this.iAddTexture(this._texture),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){this._useSecondaryUV!=t&&(this._useSecondaryUV=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.assetType="[asset EffectAlphaMaskMethod]",e}(MethodBase),_Shader_EffectAlphaMaskMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){this._alphaMask=this._shader.getAbstraction(this._method.texture||new ImageTexture2D),this._alphaMask._initVO(t),this._method.useSecondaryUV?this._shader.secondaryUVDependencies++:this._shader.uvDependencies++},e.prototype._initConstants=function(){this._alphaMask._initConstants()},e.prototype._getFragmentCode=function(t,e,i){var r=e.getFreeFragmentVectorTemp();return this._alphaMask._getFragmentCode(r,e,i,this._method.useSecondaryUV?i.secondaryUVVarying:i.uvVarying)+"mul "+t+", "+t+", "+r+".x\n"},e.prototype._activate=function(){t.prototype._activate.call(this),this._alphaMask.activate()},e.prototype._setRenderState=function(t,e){this._alphaMask._setRenderState(t)},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectAlphaMaskMethod,EffectAlphaMaskMethod);var EffectColorMatrixMethod=function(t){function e(e){var i=t.call(this)||this;if(20!=e.length)throw new Error("Matrix length must be 20!");return i._matrix=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this._matrix},set:function(t){if(20!=t.length)throw new Error("Matrix length must be 20!");this._matrix=t,this.invalidate()},enumerable:!0,configurable:!0}),e.assetType="[asset EffectColorMatrixMethod]",e}(MethodBase),_Shader_EffectColorMatrixMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._getFragmentCode=function(t,e,i){var r="",n=e.getFreeFragmentConstant();e.getFreeFragmentConstant(),e.getFreeFragmentConstant(),e.getFreeFragmentConstant();var o=e.getFreeFragmentConstant();this._colorMatrixIndex=4*n.index;var s=e.getFreeFragmentVectorTemp();return r+="m44 "+s+", "+t+", "+n+"\nadd "+t+", "+s+", "+o+"\n"},e.prototype._activate=function(){if(this._invalid){var t=this._method.matrix,e=this._colorMatrixIndex,i=this._shader.fragmentConstantData;i[e]=t[0],i[e+1]=t[1],i[e+2]=t[2],i[e+3]=t[3],i[e+4]=t[5],i[e+5]=t[6],i[e+6]=t[7],i[e+7]=t[8],i[e+8]=t[10],i[e+9]=t[11],i[e+10]=t[12],i[e+11]=t[13],i[e+12]=t[15],i[e+13]=t[16],i[e+14]=t[17],i[e+15]=t[18],i[e+16]=t[4],i[e+17]=t[9],i[e+18]=t[14],i[e+19]=t[19]}},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectColorMatrixMethod,EffectColorMatrixMethod);var EffectColorTransformMethod=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._colorTransform=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){this._colorTransform=t,this.invalidate()},enumerable:!0,configurable:!0}),e.assetType="[asset EffectColorTransformMethod]",e}(MethodBase),_Shader_EffectColorTransformMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._getFragmentCode=function(t,e,i){var r="",n=e.getFreeFragmentConstant(),o=e.getFreeFragmentConstant();return this._colorTransformIndex=4*n.index,r+="mul "+t+", "+t+", "+n+"\nadd "+t+", "+t+", "+o+"\n"},e.prototype._activate=function(){if(this._invalid){var t=this._colorTransformIndex,e=this._shader.fragmentConstantData,i=this._method.colorTransform._rawData;e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7]}},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectColorTransformMethod,EffectColorTransformMethod);var EffectEnvMapMethod=function(t){function e(e,i){void 0===i&&(i=1);var r=t.call(this)||this;return r._envMap=e,r._alpha=i,r.iAddTexture(r._envMap),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"envMap",{get:function(){return this._envMap},set:function(t){this._envMap!=t&&(this._envMap&&this.iRemoveTexture(this._envMap),this._envMap=t,this._envMap&&this.iAddTexture(this._envMap),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){t!=this._mask&&(this._mask&&this.iRemoveTexture(this._mask),this._mask=t,this._mask&&this.iAddTexture(this._mask),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=t,this.invalidate()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},e.assetType="[asset EffectEnvMapMethod]",e}(MethodBase),_Shader_EffectEnvMapMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){t.needsNormals=!0,t.needsView=!0,this._envMap=this._shader.getAbstraction(this._method.envMap),this._envMap._initVO(t),this._method.mask?(this._maskMap=this._shader.getAbstraction(this._method.mask),this._shader.uvDependencies++):this._maskMap&&(this._maskMap=null)},e.prototype._initConstants=function(){this._envMap._initConstants()},e.prototype.dispose=function(){this._envMap=null,this._maskMap=null},e.prototype._activate=function(){this._envMap.activate(),this._maskMap&&this._maskMap.activate(),this._invalid&&this._updateProperties()},e.prototype._setRenderState=function(t,e){this._envMap._setRenderState(t),this._maskMap&&this._maskMap._setRenderState(t)},e.prototype._getFragmentCode=function(t,e,i){var r=e.getFreeFragmentConstant(),n="";this._fragmentIndex=4*r.index;var o=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(o,1);var s=e.getFreeFragmentVectorTemp();return e.addFragmentTempUsages(s,1),n+="dp3 "+o+".w, "+i.viewDirFragment+".xyz, "+i.normalFragment+".xyz\nadd "+o+".w, "+o+".w, "+o+".w\nmul "+o+".xyz, "+i.normalFragment+".xyz, "+o+".w\nsub "+o+".xyz, "+o+".xyz, "+i.viewDirFragment+".xyz\n"+this._envMap._getFragmentCode(o,e,i,o)+"sub "+s+".w, "+o+".w, fc0.x\nkil "+s+".w\nsub "+o+", "+o+", "+t+"\n",this._maskMap&&(n+=this._maskMap._getFragmentCode(s,e,i,i.uvVarying)+"mul "+o+", "+s+", "+o+"\n"),n+="mul "+o+", "+o+", "+r+".x\nadd "+t+", "+t+", "+o+"\n",e.removeFragmentTempUsage(o),e.removeFragmentTempUsage(s),n},e.prototype._updateProperties=function(){this._shader.fragmentConstantData[this._fragmentIndex]=this._method.alpha},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectEnvMapMethod,EffectEnvMapMethod);var EffectFogMethod=function(t){function e(e,i,r){void 0===e&&(e=0),void 0===i&&(i=1e3),void 0===r&&(r=8421504);var n=t.call(this)||this;return n._minDistance=e,n._maxDistance=i,n._fogColor=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minDistance",{get:function(){return this._minDistance},set:function(t){this._minDistance=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(t){this._maxDistance=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogColor",{get:function(){return this._fogColor},set:function(t){this._fogColor=t,this.invalidate()},enumerable:!0,configurable:!0}),e.assetType="[asset EffectFogMethod]",e}(MethodBase),_Shader_EffectFogMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){t.needsProjection=!0},e.prototype._activate=function(){if(this._invalid){var t=this._shader.fragmentConstantData,e=this._fogColorIndex,i=this._method.fogColor;t[e]=(i>>16&255)/255,t[e+1]=(i>>8&255)/255,t[e+2]=(255&i)/255,t[e+3]=1,t[e+4]=this._method.minDistance,t[e+5]=1/(this._method.maxDistance-this._method.minDistance),t[e+6]=0,t[e+7]=0}},e.prototype._getFragmentCode=function(t,e,i){var r=e.getFreeFragmentConstant(),n=e.getFreeFragmentConstant(),o=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(o,1);var s=e.getFreeFragmentVectorTemp(),a="";return this._fogColorIndex=4*r.index,a+="sub "+s+".w, "+i.projectionFragment+".z, "+n+".x\nmul "+s+".w, "+s+".w, "+n+".y\nsat "+s+".w, "+s+".w\nsub "+o+", "+r+", "+t+"\nmul "+o+", "+o+", "+s+".w\nadd "+t+", "+t+", "+o+"\n",e.removeFragmentTempUsage(o),a},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectFogMethod,EffectFogMethod);var EffectFresnelEnvMapMethod=function(t){function e(e,i,r,n){void 0===i&&(i=1),void 0===r&&(r=5),void 0===n&&(n=0);var o=t.call(this,e,i)||this;return o._fresnelPower=r,o._normalReflectance=n,o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance!=t&&(this._normalReflectance=t,this.invalidate())},enumerable:!0,configurable:!0}),e.assetType="[asset EffectFresnelEnvMapMethod]",e}(EffectEnvMapMethod),_Shader_EffectFresnelEnvMapMethod=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getFragmentCode=function(t,e,i){var r=e.getFreeFragmentConstant(),n="",o=i.viewDirFragment,s=i.normalFragment;this._fragmentIndex=4*r.index;var a=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(a,1);var l=e.getFreeFragmentVectorTemp();return e.addFragmentTempUsages(l,1),n+="dp3 "+a+".w, "+o+".xyz, "+s+".xyz\nadd "+a+".w, "+a+".w, "+a+".w\nmul "+a+".xyz, "+s+".xyz, "+a+".w\nsub "+a+".xyz, "+a+".xyz, "+o+".xyz\n"+this._envMap._getFragmentCode(a,e,i,a)+"sub "+l+".w, "+a+".w, fc0.x\nkil "+l+".w\nsub "+a+", "+a+", "+t+"\n",n+="dp3 "+o+".w, "+o+".xyz, "+s+".xyz\nsub "+o+".w, "+r+".w, "+o+".w\npow "+o+".w, "+o+".w, "+r+".z\nsub "+s+".w, "+r+".w, "+o+".w\nmul "+s+".w, "+r+".y, "+s+".w\nadd "+o+".w, "+o+".w, "+s+".w\nmul "+o+".w, "+r+".x, "+o+".w\n",this._maskMap&&(n+=this._maskMap._getFragmentCode(l,e,i,i.uvVarying)+"mul "+o+".w, "+l+".x, "+o+".w\n"),n+="mul "+a+", "+a+", "+o+".w\nadd "+t+", "+t+", "+a+"\n",e.removeFragmentTempUsage(a),e.removeFragmentTempUsage(l),n},e.prototype._updateProperties=function(){var t=this._fragmentIndex,e=this._shader.fragmentConstantData;e[t]=this._method.alpha,e[t+1]=this._method.normalReflectance,e[t+2]=this._method.fresnelPower},e}(_Shader_EffectEnvMapMethod);ShaderBase.registerAbstraction(_Shader_EffectFresnelEnvMapMethod,EffectFresnelEnvMapMethod);var EffectLightMapMethod=function(t){function e(i,r,n){void 0===r&&(r="multiply"),void 0===n&&(n=!1);var o=t.call(this)||this;if(r!=e.ADD&&r!=e.MULTIPLY)throw new Error("Unknown blendmode!");return o._lightMap=i,o._blendMode=r,o._useSecondaryUV=n,o._lightMap&&o.iAddTexture(o._lightMap),o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){if(this._blendMode!=t){if(t!=e.ADD&&t!=e.MULTIPLY)throw new Error("Unknown blendmode!");this._blendMode=t,this.invalidateShaderProgram()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightMap",{get:function(){return this._lightMap},set:function(t){this._lightMap!=t&&(this._lightMap&&this.iRemoveTexture(this._lightMap),this._lightMap=t,this._lightMap&&this.iAddTexture(this._lightMap),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useSecondaryUV",{get:function(){return this._useSecondaryUV},set:function(t){this._useSecondaryUV!=t&&(this._useSecondaryUV=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.MULTIPLY="multiply",e.ADD="add",e.assetType="[asset EffectLightMapMethod]",e}(MethodBase),_Shader_EffectLightMapMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){this._lightMap=this._shader.getAbstraction(this._method.lightMap),this._lightMap._initVO(t),this._method.useSecondaryUV?this._shader.secondaryUVDependencies++:this._shader.uvDependencies++},e.prototype._initConstants=function(){this._lightMap._initConstants()},e.prototype._getFragmentCode=function(t,e,i){var r,n=e.getFreeFragmentVectorTemp();switch(r=this._lightMap._getFragmentCode(n,e,i,this._method.useSecondaryUV?i.secondaryUVVarying:i.uvVarying),this._method.blendMode){case EffectLightMapMethod.MULTIPLY:r+="mul "+t+", "+t+", "+n+"\n";break;case EffectLightMapMethod.ADD:r+="add "+t+", "+t+", "+n+"\n"}return r},e.prototype._activate=function(){this._lightMap.activate()},e.prototype._setRenderState=function(t,e){this._lightMap._setRenderState(t)},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectLightMapMethod,EffectLightMapMethod);var EffectProjectiveTextureMethod=function(t){function e(e,i,r){void 0===i&&(i="multiply"),void 0===r&&(r=1);var n=t.call(this)||this;return n._onTextureChangedDelegate=function(t){return n._onTextureChanged(t)},n._projector=e,n._exposure=r,n._mode=i,n._projector.addEventListener(TextureProjectorEvent.TEXTURE_CHANGE,n._onTextureChangedDelegate),n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(t){this._exposure!=t&&(this._exposure=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode!=t&&(this._mode=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projector",{get:function(){return this._projector},set:function(t){this._projector!=t&&(this._projector&&this._projector.removeEventListener(TextureProjectorEvent.TEXTURE_CHANGE,this._onTextureChangedDelegate),this._projector=t,this._projector&&this._projector.addEventListener(TextureProjectorEvent.TEXTURE_CHANGE,this._onTextureChangedDelegate),this.updateTexture())},enumerable:!0,configurable:!0}),e.prototype._onTextureChanged=function(t){this.updateTexture()},e.prototype.updateTexture=function(){this._texture&&this.iRemoveTexture(this._texture),this._texture=this._projector?this._projector.texture:null,this._texture&&this.iAddTexture(this._texture),this.invalidateShaderProgram()},e.OVERLAY="overlay",e.MULTIPLY="multiply",e.ADD="add",e.MIX="mix",e.assetType="[asset EffectProjectiveTextureMethod]",e}(MethodBase),_Shader_EffectProjectiveTextureMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){this._texture=this._shader.getAbstraction(this._method.projector.texture),this._texture._initVO(t)},e.prototype._initConstants=function(){this._texture._initConstants();var t=this._exposureIndex,e=this._shader.fragmentConstantData;e[t]=this._method.exposure,e[t+1]=.5,e[t+2]=4,e[t+3]=-1,this._projectionMatrix=new Matrix3D(new Float32Array(this._shader.vertexConstantData.buffer,4*this._projectionIndex,16))},e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._uvVarying=null,this._projectionMatrix=null},e.prototype._getVertexCode=function(t,e){var i="",r=t.getFreeVertexConstant();return t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),this._projectionIndex=4*r.index,this._uvVarying=t.getFreeVarying(),i+="m44 "+this._uvVarying+", "+e.animatedPosition+", "+r+"\n"},e.prototype._getFragmentCode=function(t,e,i){var r="",n=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(n,1);var o=e.getFreeFragmentVectorTemp(),s=e.getFreeFragmentConstant();if(this._exposureIndex=4*s.index,r+=this._texture._getFragmentCode(n,e,i,this._uvVarying),r+="mul "+n+", "+n+", "+s+".xxx\nadd "+n+", "+n+", "+s+".xxx\n",this._method.mode==EffectProjectiveTextureMethod.MULTIPLY)r+="mul "+t+".xyz, "+t+".xyz, "+n+".xyz\t\t\t\n";else if(this._method.mode==EffectProjectiveTextureMethod.ADD)r+="add "+t+".xyz, "+t+".xyz, "+n+".xyz\t\t\t\n";else if(this._method.mode==EffectProjectiveTextureMethod.MIX)r+="sub "+n+".xyz, "+n+".xyz, "+t+".xyz\t\t\t\t\nmul "+n+".xyz, "+n+".xyz, "+n+".w\t\t\t\t\t\t\nadd "+t+".xyz, "+t+".xyz, "+n+".xyz\t\t\t\n";else{if(this._method.mode!=EffectProjectiveTextureMethod.OVERLAY)throw new ErrorBase('Unknown mode "'+this._method.mode+'"');r+="sge "+o+", "+t+", "+s+".yyy\n",r+="sub "+t+", "+t+", "+o+"\n",r+="sub "+n+", "+n+", "+o+"\n",r+="mul "+n+", "+n+", "+t+"\n",r+="sub "+t+", "+s+".yyy, "+o+"\n",r+="mul "+t+", "+s+".zzz, "+t+"\n",r+="mul "+n+", "+n+", "+t+"\n",r+="add "+t+", "+n+", "+o+"\n"}return e.removeFragmentTempUsage(n),r},e.prototype._setRenderState=function(t,e){var i=Matrix3D.CALCULATION_MATRIX;i.copyFrom(this._method.projector.projection.viewMatrix3D),i.prepend(t.renderSceneTransform),this._projectionMatrix.copyFrom(i,!0),this._texture._setRenderState(t)},e.prototype._activate=function(){this._texture.activate(),this._invalid&&(this._shader.fragmentConstantData[this._exposureIndex]=this._method.exposure)},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectProjectiveTextureMethod,EffectProjectiveTextureMethod);var EffectRefractionEnvMapMethod=function(t){function e(e,i,r,n,o,s){void 0===i&&(i=1),void 0===r&&(r=.1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0);var a=t.call(this,e,i)||this;return a._dispersionR=0,a._dispersionG=0,a._dispersionB=0,a._refractionIndex=r,a._dispersionR=n,a._dispersionG=o,a._dispersionB=s,a}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refractionIndex",{get:function(){return this._refractionIndex},set:function(t){this._refractionIndex=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispersionR",{get:function(){return this._dispersionR},set:function(t){this._dispersionR!=t&&(this._dispersionR=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispersionG",{get:function(){return this._dispersionG},set:function(t){this._dispersionG!=t&&(this._dispersionG=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dispersionB",{get:function(){return this._dispersionB},set:function(t){this._dispersionB!=t&&(this._dispersionB=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.assetType="[asset EffectRefractionEnvMapMethod]",e}(EffectEnvMapMethod),_Shader_EffectRefractionEnvMapMethod=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),this._useDispersion=!(this._method.dispersionR==this._method.dispersionB&&this._method.dispersionR==this._method.dispersionG)},e.prototype._getFragmentCode=function(t,e,i){var r,n,o,s=e.getFreeFragmentConstant(),a=e.getFreeFragmentConstant(),l="";this._fragmentIndex=4*s.index,r=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(r,1),n=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(n,1),o=e.getFreeFragmentVectorTemp(),e.addFragmentTempUsages(o,1);var h=i.viewDirFragment,c=i.normalFragment;return l+="neg "+h+".xyz, "+h+".xyz\n",l+="dp3 "+o+".x, "+h+".xyz, "+c+".xyz\nmul "+o+".w, "+o+".x, "+o+".x\nsub "+o+".w, "+a+".x, "+o+".w\nmul "+o+".w, "+s+".x, "+o+".w\nmul "+o+".w, "+s+".x, "+o+".w\nsub "+o+".w, "+a+".x, "+o+".w\nsqt "+o+".y, "+o+".w\nmul "+o+".x, "+s+".x, "+o+".x\nadd "+o+".x, "+o+".x, "+o+".y\nmul "+o+".xyz, "+o+".x, "+c+".xyz\nmul "+r+", "+s+".x, "+h+"\nsub "+r+".xyz, "+r+".xyz, "+o+".xyz\nnrm "+r+".xyz, "+r+".xyz\n"+this._envMap._getFragmentCode(n,e,i,r)+"sub "+n+".w, "+n+".w, fc0.x\t\nkil "+n+".w\n",this._useDispersion&&(l+="dp3 "+o+".x, "+h+".xyz, "+c+".xyz\nmul "+o+".w, "+o+".x, "+o+".x\nsub "+o+".w, "+a+".x, "+o+".w\nmul "+o+".w, "+s+".y, "+o+".w\nmul "+o+".w, "+s+".y, "+o+".w\nsub "+o+".w, "+a+".x, "+o+".w\nsqt "+o+".y, "+o+".w\nmul "+o+".x, "+s+".y, "+o+".x\nadd "+o+".x, "+o+".x, "+o+".y\nmul "+o+".xyz, "+o+".x, "+c+".xyz\nmul "+r+", "+s+".y, "+h+"\nsub "+r+".xyz, "+r+".xyz, "+o+".xyz\nnrm "+r+".xyz, "+r+".xyz\n"+this._envMap._getFragmentCode(o,e,i,r)+"mov "+n+".y, "+o+".y\n",l+="dp3 "+o+".x, "+h+".xyz, "+c+".xyz\nmul "+o+".w, "+o+".x, "+o+".x\nsub "+o+".w, "+a+".x, "+o+".w\nmul "+o+".w, "+s+".z, "+o+".w\nmul "+o+".w, "+s+".z, "+o+".w\nsub "+o+".w, "+a+".x, "+o+".w\nsqt "+o+".y, "+o+".w\nmul "+o+".x, "+s+".z, "+o+".x\nadd "+o+".x, "+o+".x, "+o+".y\nmul "+o+".xyz, "+o+".x, "+c+".xyz\nmul "+r+", "+s+".z, "+h+"\nsub "+r+".xyz, "+r+".xyz, "+o+".xyz\nnrm "+r+".xyz, "+r+".xyz\n"+this._envMap._getFragmentCode(o,e,i,r)+"mov "+n+".z, "+o+".z\n"),l+="sub "+n+".xyz, "+n+".xyz, "+t+".xyz\nmul "+n+".xyz, "+n+".xyz, "+s+".w\nadd "+t+".xyz, "+t+".xyz, "+n+".xyz\n",e.removeFragmentTempUsage(o),e.removeFragmentTempUsage(r),e.removeFragmentTempUsage(n),l+="neg "+h+".xyz, "+h+".xyz\n"},e.prototype._updateProperties=function(){var t=this._fragmentIndex,e=this._shader.fragmentConstantData,i=this._method.refractionIndex;e[t]=this._method.dispersionR+i,this._useDispersion&&(e[t+1]=this._method.dispersionG+i,e[t+2]=this._method.dispersionB+i),e[t+3]=this._method.alpha},e}(_Shader_EffectEnvMapMethod);ShaderBase.registerAbstraction(_Shader_EffectRefractionEnvMapMethod,EffectRefractionEnvMapMethod);var EffectRimLightMethod=function(t){function e(e,i,r,n){void 0===e&&(e=16777215),void 0===i&&(i=.4),void 0===r&&(r=2),void 0===n&&(n="mix");var o=t.call(this)||this;return o._blendMode=n,o._strength=i,o._power=r,o._color=e,o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._power!=t&&(this._color=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength!=t&&(this._strength=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"power",{get:function(){return this._power},set:function(t){this._power!=t&&(this._power=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this._blendMode!=t&&(this._blendMode=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.ADD="add",e.MULTIPLY="multiply",e.MIX="mix",e.assetType="[asset EffectRimLightMethod]",e}(MethodBase),_Shader_EffectRimLightMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(t){t.needsNormals=!0,t.needsView=!0},e.prototype._activate=function(){if(this._invalid){var t=this._rimColorIndex,e=this._shader.fragmentConstantData,i=this._method.color;e[t]=(i>>16&255)/255,e[t+1]=(i>>8&255)/255,e[t+2]=(255&i)/255,e[t+3]=1,e[t+4]=this._method.strength,e[t+5]=this._method.power}},e.prototype._getFragmentCode=function(t,e,i){var r=e.getFreeFragmentConstant(),n=e.getFreeFragmentConstant(),o=e.getFreeFragmentVectorTemp(),s="";return this._rimColorIndex=4*r.index,s+="dp3 "+o+".x, "+i.viewDirFragment+".xyz, "+i.normalFragment+".xyz\nsat "+o+".x, "+o+".x\nsub "+o+".x, "+r+".w, "+o+".x\npow "+o+".x, "+o+".x, "+n+".y\nmul "+o+".x, "+o+".x, "+n+".x\nsub "+o+".x, "+r+".w, "+o+".x\nmul "+t+".xyz, "+t+".xyz, "+o+".x\nsub "+o+".w, "+r+".w, "+o+".x\n",this._method.blendMode==EffectRimLightMethod.ADD?s+="mul "+o+".xyz, "+o+".w, "+r+".xyz\nadd "+t+".xyz, "+t+".xyz, "+o+".xyz\n":this._method.blendMode==EffectRimLightMethod.MULTIPLY?s+="mul "+o+".xyz, "+o+".w, "+r+".xyz\nmul "+t+".xyz, "+t+".xyz, "+o+".xyz\n":s+="sub "+o+".xyz, "+r+".xyz, "+t+".xyz\nmul "+o+".xyz, "+o+".xyz, "+o+".w\nadd "+t+".xyz, "+t+".xyz, "+o+".xyz\n",s},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_EffectRimLightMethod,EffectRimLightMethod);var NormalBasicMethod=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._texture=e,i._texture&&i.iAddTexture(i._texture),i}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.iRemoveTexture(this._texture),this._texture=t,this._texture&&this.iAddTexture(this._texture),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(t){var e=t;null!=e.texture&&(this.texture=e.texture)},e.prototype.dispose=function(){this._texture&&(this._texture=null)},e.assetType="[asset NormalBasicMethod]",e}(MethodBase),_Shader_NormalBasicMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._isUsed=function(){return!(!this._texture||!this._shader.normalDependencies)},e.prototype._initVO=function(t){this._method.texture&&(this._texture=this._shader.getAbstraction(this._method.texture),this._texture._initVO(t),this._shader.uvDependencies++)},e.prototype._initConstants=function(){this._method.texture&&this._texture._initConstants()},e.prototype._outputsTangentNormals=function(){return!0},e.prototype._activate=function(){this._texture&&this._texture.activate()},e.prototype._setRenderState=function(t,e){this._texture&&this._texture._setRenderState(t)},e.prototype._getFragmentCode=function(t,e,i){var r="";return this._texture&&(r+=this._texture._getFragmentCode(t,e,i,i.uvVarying)),r+="sub "+t+".xyz, "+t+".xyz, "+i.commons+".xxx\nnrm "+t+".xyz, "+t+"\n"},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_NormalBasicMethod,NormalBasicMethod);var NormalHeightMapMethod=function(t){function e(e,i,r,n){var o=t.call(this)||this;return o.texture=e,o._worldXYRatio=i/r,o._worldXZRatio=n/r,o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldXYRatio",{get:function(){return this._worldXYRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldXZRatio",{get:function(){return this._worldXZRatio},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){t.prototype.copyFrom.call(this,e),this._worldXYRatio=e._worldXYRatio,this._worldXZRatio=e._worldXZRatio},e.assetType="[asset NormalHeightMapMethod]",e}(NormalBasicMethod),_Shader_NormalHeightMapMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._fragmentConstantsIndex,i=this._shader.fragmentConstantData,r=this._method.texture.image;i[e]=1/r.width,i[e+1]=1/r.height,i[e+2]=0,i[e+3]=1,i[e+4]=this._method.worldXYRatio,i[e+5]=this._method.worldXZRatio},Object.defineProperty(e.prototype,"tangentSpace",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._getFragmentCode=function(t,e,i){var r="",n=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(n,1);var o=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant();return this._fragmentConstantsIndex=4*o.index,r+=this._texture._getFragmentCode(t,e,i,i.uvVarying)+"add "+n+", "+i.uvVarying+", "+o+".xzzz\n"+this._texture._getFragmentCode(n,e,i,n)+"sub "+t+".x, "+t+".x, "+n+".x\nadd "+n+", "+i.uvVarying+", "+o+".zyzz\n"+this._texture._getFragmentCode(n,e,i,n)+"sub "+t+".z, "+t+".z, "+n+".x\nmov "+t+".y, "+o+".w\nmul "+t+".xz, "+t+".xz, "+s+".xy\nnrm "+t+".xyz, "+t+".xyz\n",e.removeFragmentTempUsage(n),r},e}(_Shader_NormalBasicMethod);ShaderBase.registerAbstraction(_Shader_NormalHeightMapMethod,NormalHeightMapMethod);var NormalSimpleWaterMethod=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,e)||this;return r._water1OffsetX=0,r._water1OffsetY=0,r._water2OffsetX=0,r._water2OffsetY=0,r._secondaryNormalMap=i,r._secondaryNormalMap&&r.iAddTexture(r._secondaryNormalMap),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water1OffsetX",{get:function(){return this._water1OffsetX},set:function(t){this._water1OffsetX=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water1OffsetY",{get:function(){return this._water1OffsetY},set:function(t){this._water1OffsetY=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water2OffsetX",{get:function(){return this._water2OffsetX},set:function(t){this._water2OffsetX=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"water2OffsetY",{get:function(){return this._water2OffsetY},set:function(t){this._water2OffsetY=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryNormalMap",{get:function(){return this._secondaryNormalMap},set:function(t){this._secondaryNormalMap!=t&&(this._secondaryNormalMap&&this.iRemoveTexture(this._secondaryNormalMap),this._secondaryNormalMap=t,this._secondaryNormalMap&&this.iAddTexture(this._secondaryNormalMap),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._secondaryNormalMap=null},e.assetType="[asset NormalSimpleWaterMethod]",e}(NormalBasicMethod),_Shader_NormalSimpleWaterMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._fragmentConstantsIndex,i=this._shader.fragmentConstantData;i[e]=.5,i[e+1]=0,i[e+2]=0,i[e+3]=1},e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),this._method.secondaryNormalMap&&(this._secondaryNormalMap=this._shader.getAbstraction(this._method.secondaryNormalMap),this._shader.uvDependencies++)},e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._secondaryNormalMap=null},e.prototype._activate=function(){if(t.prototype._activate.call(this),this._invalid){var e=this._shader.fragmentConstantData,i=this._fragmentConstantsIndex;e[i+4]=this._method.water1OffsetX,e[i+5]=this._method.water1OffsetY,e[i+6]=this._method.water2OffsetX,e[i+7]=this._method.water2OffsetY}this._secondaryNormalMap&&this._secondaryNormalMap.activate()},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),this._secondaryNormalMap&&this._secondaryNormalMap._setRenderState(e)},e.prototype._getFragmentCode=function(t,e,i){var r="",n=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(n,1);var o=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant();return this._fragmentConstantsIndex=4*o.index,r+="add "+n+", "+i.uvVarying+", "+s+".xyxy\n",this._texture&&(r+=this._texture._getFragmentCode(t,e,i,n)),r+="add "+n+", "+i.uvVarying+", "+s+".zwzw\n",this._secondaryNormalMap&&(r+=this._secondaryNormalMap._getFragmentCode(n,e,i,n)),r+="add "+t+", "+t+", "+n+"\t\t\nmul "+t+", "+t+", "+o+".x\t\nsub "+t+".xyz, "+t+".xyz, "+i.commons+".xxx\t\nnrm "+t+".xyz, "+t+".xyz\t\t\t\t\t\t\t\n"},e}(_Shader_NormalBasicMethod);ShaderBase.registerAbstraction(_Shader_NormalSimpleWaterMethod,NormalSimpleWaterMethod);var ShadowMethodBase=function(t){function e(e){var i=t.call(this,e.shadowMapper)||this;return i._castingLight=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"castingLight",{get:function(){return this._castingLight},enumerable:!0,configurable:!0}),e}(CompositeMethodBase),_Shader_ShadowMethodBase=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),this._baseTexture=this._baseChunk.texture},e}(_Shader_CompositeMethodBase),ShadowDitheredMethod=function(t){function e(i,r,n){void 0===r&&(r=4),void 0===n&&(n=1);var o=t.call(this,i)||this;return o._depthMapSize=o._castingLight.shadowMapper.size,o.numSamples=r,o.range=n,++e._grainUsages,e._grainTexture||o.initGrainTexture(),o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){t<1?t=1:t>24&&(t=24),this._numSamples!=t&&(this._numSamples=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return 2*this._range},set:function(t){this._range=t/2},enumerable:!0,configurable:!0}),e.prototype.initGrainTexture=function(){e._grainBitmapImage2D=new BitmapImage2D(64,64,!1);for(var t,i,r=new Array,n=1/(this._depthMapSize*this._range),o=0;o<4096;++o)(t=2*(Math.random()-.5))<0?t-=n:t+=n,(i=2*(Math.random()-.5))<0?i-=n:i+=n,t>1?t=1:t<-1&&(t=-1),i>1?i=1:i<-1&&(i=-1),r[o]=Math.floor(255*(.5*t+.5))<<16|Math.floor(255*(.5*i+.5))<<8;e._grainBitmapImage2D.setArray(e._grainBitmapImage2D.rect,r),e._grainTexture=new ImageTexture2D(e._grainBitmapImage2D)},e.prototype.dispose=function(){0==--e._grainUsages&&(e._grainTexture.dispose(),e._grainBitmapImage2D.dispose(),e._grainTexture=null)},e.assetType="[asset ShadowDitheredMethod]",e}(ShadowMethodBase),_Shader_ShadowDitheredMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),e.needsProjection=!0,this._grainMap=this._shader.getAbstraction(ShadowDitheredMethod._grainTexture)},e.prototype._initConstants=function(){t.prototype._initConstants.call(this),this._shader.fragmentConstantData[this._fragmentConstantsIndex]=1/this._method.numSamples},e.prototype._activate=function(){t.prototype._activate.call(this);var e=this._shader.fragmentConstantData,i=this._fragmentConstantsIndex;e[i+1]=(this._shader.renderMaterial.renderGroup.view.width-1)/63,e[i+2]=(this._shader.renderMaterial.renderGroup.view.height-1)/63,e[i+3]=2*this._method.range/this._method.castingLight.shadowMapper.size,this._grainMap.activate()},e.prototype._getFragmentCode=function(e,i,r){var n=i.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var o="",s=this._method.numSamples,a=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(a,1);var l=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(l,1);var h=r.projectionFragment;o+="div "+a+", "+h+", "+h+".w\nmul "+a+".xy, "+a+".xy, "+n+".yz\n";for(var c=s;c>0;)o+=c==s?this._grainMap._getFragmentCode(a,i,r,a):"mov "+l+", "+a+".zwxy \n"+this._grainMap._getFragmentCode(a,i,r,l),o+="sub "+a+".zw, "+a+".xy, fc0.xx\nmul "+a+".zw, "+a+".zw, "+n+".w\n",o+=c==s?"add "+a+".xy, "+a+".zw, "+this._baseChunk.depthMapCoordReg+".xy\n"+this._baseTexture._getFragmentCode(e,i,r,a):this._addSample(a,e,i,r),c>4&&(o+="add "+a+".xy, "+a+".xy, "+a+".zw\n"+this._addSample(a,e,i,r)),c>1&&(o+="sub "+a+".xy, "+this._baseChunk.depthMapCoordReg+".xy, "+a+".zw\n"+this._addSample(a,e,i,r)),c>5&&(o+="sub "+a+".xy, "+a+".xy, "+a+".zw\n"+this._addSample(a,e,i,r)),c>2&&(o+="neg "+a+".w, "+a+".w\nadd "+a+".xy, "+a+".wz, "+this._baseChunk.depthMapCoordReg+".xy\n"+this._addSample(a,e,i,r)),c>6&&(o+="add "+a+".xy, "+a+".xy, "+a+".wz\n"+this._addSample(a,e,i,r)),c>3&&(o+="sub "+a+".xy, "+this._baseChunk.depthMapCoordReg+".xy, "+a+".wz\n"+this._addSample(a,e,i,r)),c>7&&(o+="sub "+a+".xy, "+a+".xy, "+a+".wz\n"+this._addSample(a,e,i,r)),c-=8;return i.removeFragmentTempUsage(l),i.removeFragmentTempUsage(a),o+="mul "+e+".w, "+e+".w, "+n+".x\n"+t.prototype._getFragmentCode.call(this,e,i,r)},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),this._grainMap._setRenderState(e)},e.prototype._addSample=function(t,e,i,r){var n=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(n,1);var o=this._baseTexture._getFragmentCode(n,i,r,t)+"add "+e+".w, "+e+".w, "+n+".w\n";return i.removeFragmentTempUsage(n),o},e}(_Shader_ShadowMethodBase);ShaderBase.registerAbstraction(_Shader_ShadowDitheredMethod,ShadowDitheredMethod);var ShadowFilteredMethod=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset ShadowFilteredMethod]",e}(ShadowMethodBase),_Shader_ShadowFilteredMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._shader.fragmentConstantData,i=this._fragmentConstantsIndex;e[i]=.5;var r=this._method.castingLight.shadowMapper.size;e[i+1]=r,e[i+2]=1/r},e.prototype._getFragmentCode=function(e,i,r){var n=i.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var o="",s=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(s,1);var a=i.getFreeFragmentVectorTemp();return i.addFragmentTempUsages(a,1),o+="mov "+s+", "+this._baseChunk.depthMapCoordReg+"\n"+this._baseTexture._getFragmentCode(a,i,r,s)+"mov "+s+".w, "+a+".w\nadd "+s+".x, "+this._baseChunk.depthMapCoordReg+".x, "+n+".z\n"+this._baseTexture._getFragmentCode(a,i,r,s)+"mul "+a+".x, "+this._baseChunk.depthMapCoordReg+".x, "+n+".y\nfrc "+a+".x, "+a+".x\nsub "+a+".w, "+a+".w, "+s+".w\nmul "+a+".w, "+a+".w, "+a+".x\nadd "+e+".w, "+s+".w, "+a+".w\nmov "+s+".x, "+this._baseChunk.depthMapCoordReg+".x\nadd "+s+".y, "+this._baseChunk.depthMapCoordReg+".y, "+n+".z\n"+this._baseTexture._getFragmentCode(a,i,r,s)+"mov "+s+".w, "+a+".w\nadd "+s+".x, "+this._baseChunk.depthMapCoordReg+".x, "+n+".z\n"+this._baseTexture._getFragmentCode(a,i,r,s)+"mul "+a+".x, "+this._baseChunk.depthMapCoordReg+".x, "+n+".y\nfrc "+a+".x, "+a+".x\nsub "+a+".w, "+a+".w, "+s+".w\nmul "+a+".w, "+a+".w, "+a+".x\nadd "+s+".w, "+s+".w, "+a+".w\nmul "+a+".x, "+this._baseChunk.depthMapCoordReg+".y, "+n+".y\nfrc "+a+".x, "+a+".x\nsub "+s+".w, "+s+".w, "+e+".w\nmul "+s+".w, "+s+".w, "+a+".x\nadd "+e+".w, "+e+".w, "+s+".w\n",i.removeFragmentTempUsage(a),i.removeFragmentTempUsage(s),t.prototype._getFragmentCode.call(this,e,i,r),o},e}(_Shader_ShadowMethodBase);ShaderBase.registerAbstraction(_Shader_ShadowFilteredMethod,ShadowFilteredMethod);var ShadowHardMethod=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset ShadowHardMethod]",e}(ShadowMethodBase),_Shader_ShadowHardMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._getFragmentCode=function(e,i,r){var n=this._baseTexture._getFragmentCode(e,i,r,this._baseChunk.depthMapCoordReg);return n+=t.prototype._getFragmentCode.call(this,e,i,r)},e}(_Shader_ShadowMethodBase);ShaderBase.registerAbstraction(_Shader_ShadowHardMethod,ShadowHardMethod);var ShadowSoftMethod=function(t){function e(e,i,r){void 0===i&&(i=5),void 0===r&&(r=1);var n=t.call(this,e)||this;return n.numSamples=i,n.range=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offsets",{get:function(){return this._offsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numSamples",{get:function(){return this._numSamples},set:function(t){this._numSamples=t,this._numSamples<1?this._numSamples=1:this._numSamples>32&&(this._numSamples=32),this._offsets=PoissonLookup.getDistribution(this._numSamples),this.invalidateShaderProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t},enumerable:!0,configurable:!0}),e.assetType="[asset ShadowSoftMethod]",e}(ShadowMethodBase),_Shader_ShadowSoftMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initConstants=function(){t.prototype._initConstants.call(this),this._shader.fragmentConstantData[this._fragmentConstantsIndex]=1/this._method.numSamples,this._shader.fragmentConstantData[this._fragmentConstantsIndex+1]=0},e.prototype._activate=function(){t.prototype._activate.call(this);for(var e=.5*this._method.range/this._method.castingLight.shadowMapper.size,i=this._shader.fragmentConstantData,r=this._fragmentConstantsIndex+2,n=this._method.numSamples<<1,o=0;o<n;++o)i[r+o]=this._method.offsets[o]*e},e.prototype._getFragmentCode=function(e,i,r){var n=i.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var o="",s=i.getFreeFragmentVectorTemp();i.addFragmentTempUsages(s,1);for(var a=new Array(n+".zw"),l=this._method.numSamples>>1,h=0;h<l;++h){var c=i.getFreeFragmentConstant();a.push(c+".xy"),a.push(c+".zw")}var u=i.getFreeFragmentVectorTemp();for(h=0;h<this._method.numSamples;++h)o+=0==h?"add "+s+", "+this._baseChunk.depthMapCoordReg+", "+n+".zwyy\n"+this._baseTexture._getFragmentCode(e,i,r,s):"add "+s+".xy, "+this._baseChunk.depthMapCoordReg+".xy, "+a[h]+"\n"+this._baseTexture._getFragmentCode(u,i,r,s)+"add "+e+".w, "+e+".w, "+u+".w\n";return i.removeFragmentTempUsage(s),o+="mul "+e+".w, "+e+".w, "+n+".x\n"+t.prototype._getFragmentCode.call(this,e,i,r)},e}(_Shader_ShadowMethodBase);ShaderBase.registerAbstraction(_Shader_ShadowSoftMethod,ShadowSoftMethod);var SpecularBasicMethod=function(t){function e(){var e=t.call(this)||this;return e._gloss=50,e._strength=1,e._color=16777215,e}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gloss",{get:function(){return this._gloss},set:function(t){this._gloss!=t&&(this._gloss=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength!=t&&(this._strength=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color!=t&&(this._color=t,0==this._color||0==t?this.invalidateShaderProgram():this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.iRemoveTexture(this._texture),this._texture=t,this._texture&&this.iAddTexture(this._texture),this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._texture=null},e.prototype.copyFrom=function(t){var e=t;this.texture=e.texture,this.strength=e.strength,this.color=e.color,this.gloss=e.gloss},e.assetType="[asset SpecularBasicMethod]",e}(MethodBase),_Shader_SpecularBasicMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r}return __extends(e,t),e.prototype._isUsed=function(){return!!this._shader.numLights},e.prototype._initVO=function(t){t.needsNormals=this._shader.numLights>0,t.needsView=this._shader.numLights>0,this._method.texture?(this._texture=this._shader.getAbstraction(this._method.texture),this._texture._initVO(t),this._shader.uvDependencies++):this._texture&&(this._texture=null)},e.prototype._initConstants=function(){this._method.texture&&this._texture._initConstants()},e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._totalLightColorReg=null,this._specularTexData=null,this._specularDataRegister=null},e.prototype._getFragmentPreLightingCode=function(t,e){var i="";return this._pIsFirstLight=!0,this._specularDataRegister=t.getFreeFragmentConstant(),this._specularDataIndex=4*this._specularDataRegister.index,this._texture&&(this._specularTexData=t.getFreeFragmentVectorTemp(),t.addFragmentTempUsages(this._specularTexData,1),i+=this._texture._getFragmentCode(this._specularTexData,t,e,e.uvVarying)),this._totalLightColorReg=t.getFreeFragmentVectorTemp(),t.addFragmentTempUsages(this._totalLightColorReg,1),i},e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n,o="";return this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1)),o+="add "+n+", "+t+", "+r.viewDirFragment+"\nnrm "+n+".xyz, "+n+"\ndp3 "+n+".w, "+r.normalFragment+", "+n+"\nsat "+n+".w, "+n+".w\n",this._texture?o+="mul "+this._specularTexData+".w, "+this._specularTexData+".y, "+this._specularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._specularTexData+".w\n":o+="pow "+n+".w, "+n+".w, "+this._specularDataRegister+".w\n",this._shader.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+t+".w\n"),null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),o+="mul "+n+".xyz, "+e+", "+n+".w\n",this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+n+"\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e.prototype._getFragmentCodePerProbe=function(t,e,i,r){var n,o="";this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1));var s=r.normalFragment,a=r.viewDirFragment;return o+="dp3 "+n+".w, "+s+", "+a+"\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+", "+n+".w, "+s+"\nsub "+n+", "+n+", "+a+"\ntex "+n+", "+n+", "+t+" <cube,linear,miplinear>\nmul "+n+".xyz, "+n+", "+e+"\n",null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+n+"\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e.prototype._getFragmentCode=function(t,e,i){var r="";return i.shadowTarget&&(r+="mul "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+i.shadowTarget+".w\n"),this._texture&&(r+="mul "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+this._specularTexData+".x\n",e.removeFragmentTempUsage(this._specularTexData)),r+="mul "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+", "+this._specularDataRegister+"\nadd "+t+".xyz, "+t+", "+this._totalLightColorReg+"\n",e.removeFragmentTempUsage(this._totalLightColorReg),r},e.prototype._activate=function(){if(this._texture&&this._texture.activate(),this._invalid){var t=this._specularDataIndex,e=this._shader.fragmentConstantData;e[t]=(this._method.color>>16&255)/255*this._method.strength,e[t+1]=(this._method.color>>8&255)/255*this._method.strength,e[t+2]=(255&this._method.color)/255*this._method.strength,e[t+3]=this._method.gloss}},e.prototype._setRenderState=function(t,e){this._texture&&this._texture._setRenderState(t)},e}(_Shader_MethodBase);ShaderBase.registerAbstraction(_Shader_SpecularBasicMethod,SpecularBasicMethod);var SpecularAnisotropicMethod=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset SpecularAnisotropicMethod]",e}(SpecularBasicMethod),_Shader_SpecularAnisotropicMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),e.needsTangents=this._shader.numLights>0},e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n,o="";return this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1)),o+="nrm "+n+".xyz, "+r.tangentVarying+".xyz\ndp3 "+n+".w, "+n+".xyz, "+t+".xyz\ndp3 "+n+".z, "+n+".xyz, "+r.viewDirFragment+".xyz\n",o+="sin "+n+".x, "+n+".w\nsin "+n+".y, "+n+".z\nmul "+n+".x, "+n+".x, "+n+".y\ncos "+n+".z, "+n+".z\ncos "+n+".w, "+n+".w\nmul "+n+".w, "+n+".w, "+n+".z\nsub "+n+".w, "+n+".x, "+n+".w\n",this._texture?o+="mul "+this._specularTexData+".w, "+this._specularTexData+".y, "+this._specularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._specularTexData+".w\n":o+="pow "+n+".w, "+n+".w, "+this._specularDataRegister+".w\n",o+="mul "+n+".w, "+n+".w, "+t+".w\n",null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),o+="mul "+n+".xyz, "+e+".xyz, "+n+".w\n",this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+".xyz, "+n+".xyz\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e}(_Shader_SpecularBasicMethod);ShaderBase.registerAbstraction(_Shader_SpecularAnisotropicMethod,SpecularAnisotropicMethod);var SpecularCompositeMethod=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),e.prototype.createBaseMethod=function(){return new SpecularBasicMethod},Object.defineProperty(e.prototype,"gloss",{get:function(){return this._baseMethod.gloss},set:function(t){this._baseMethod.gloss=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._baseMethod.strength},set:function(t){this._baseMethod.strength=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._baseMethod.color},set:function(t){this._baseMethod.color=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._baseMethod.texture},set:function(t){this._baseMethod.texture=t},enumerable:!0,configurable:!0}),e}(CompositeMethodBase),SpecularCelMethod=function(t){function e(e,i,r){void 0===e&&(e=.5),void 0===i&&(i=.1),void 0===r&&(r=null);var n=t.call(this,r)||this;return n._specularCutOff=e,n._smoothness=i,n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smoothness",{get:function(){return this._smoothness},set:function(t){this._smoothness!=t&&(this._smoothness=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularCutOff",{get:function(){return this._specularCutOff},set:function(t){this._specularCutOff!=t&&(this._specularCutOff=t,this.invalidate())},enumerable:!0,configurable:!0}),e.assetType="[asset SpecularCelMethod]",e}(SpecularCompositeMethod),_Shader_SpecularCelMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r._baseChunk._modulateFunction=function(t,e,i){return r.clampSpecular(t,e,i)},r}return __extends(e,t),e.prototype._activate=function(){if(t.prototype._activate.call(this),this._invalid){var e=this._cutoffDataIndex,i=this._shader.fragmentConstantData;i[e]=this._method.smoothness,i[e+1]=this._method.specularCutOff}},e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._cutoffDataRegister=null},e.prototype.clampSpecular=function(t,e,i){return"sub "+t+".y, "+t+".w, "+this._cutoffDataRegister+".y\ndiv "+t+".y, "+t+".y, "+this._cutoffDataRegister+".x\nsat "+t+".y, "+t+".y\nsge "+t+".w, "+t+".w, "+this._cutoffDataRegister+".y\nmul "+t+".w, "+t+".w, "+t+".y\n"},e.prototype._getFragmentPreLightingCode=function(e,i){return this._cutoffDataRegister=e.getFreeFragmentConstant(),this._cutoffDataIndex=4*this._cutoffDataRegister.index,t.prototype._getFragmentPreLightingCode.call(this,e,i)},e}(_Shader_LightingCompositeMethod);ShaderBase.registerAbstraction(_Shader_SpecularCelMethod,SpecularCelMethod);var SpecularFresnelMethod=function(t){function e(e,i,r,n){void 0===e&&(e=!0),void 0===i&&(i=5),void 0===r&&(r=.028),void 0===n&&(n=null);var o=t.call(this,n)||this;return o._basedOnSurface=e,o._fresnelPower=i,o._normalReflectance=r,o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"basedOnSurface",{get:function(){return this._basedOnSurface},set:function(t){this._basedOnSurface!=t&&(this._basedOnSurface=t,this.invalidateShaderProgram())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fresnelPower",{get:function(){return this._fresnelPower},set:function(t){this._fresnelPower!=t&&(this._fresnelPower=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalReflectance",{get:function(){return this._normalReflectance},set:function(t){this._normalReflectance!=t&&(this._normalReflectance=t,this.invalidate())},enumerable:!0,configurable:!0}),e.assetType="[asset SpecularFresnelMethod]",e}(SpecularCompositeMethod),_Shader_SpecularFresnelMethod=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._method=e,r._shader=i,r._baseChunk._modulateFunction=function(t,e,i){return r.modulateSpecular(t,e,i)},r}return __extends(e,t),e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._fresnelDataRegister=null},e.prototype._activate=function(){if(t.prototype._activate.call(this),this._invalid){var e=this._shader.fragmentConstantData,i=this._fresnelDataIndex;e[i]=this._method.normalReflectance,e[i+1]=this._method.fresnelPower,e[i+2]=1,e[i+3]=0}},e.prototype._getFragmentPreLightingCode=function(e,i){return this._fresnelDataRegister=e.getFreeFragmentConstant(),this._fresnelDataIndex=4*this._fresnelDataRegister.index,t.prototype._getFragmentPreLightingCode.call(this,e,i)},e.prototype.modulateSpecular=function(t,e,i){return"dp3 "+t+".y, "+i.viewDirFragment+".xyz, "+(this._method.basedOnSurface?i.normalFragment:t)+".xyz\nsub "+t+".y, "+this._fresnelDataRegister+".z, "+t+".y\npow "+t+".x, "+t+".y, "+this._fresnelDataRegister+".y\nsub "+t+".y, "+this._fresnelDataRegister+".z, "+t+".y\nmul "+t+".y, "+this._fresnelDataRegister+".x, "+t+".y\nadd "+t+".y, "+t+".x, "+t+".y\nmul "+t+".w, "+t+".w, "+t+".y\n"},e}(_Shader_LightingCompositeMethod);ShaderBase.registerAbstraction(_Shader_SpecularFresnelMethod,SpecularFresnelMethod);var SpecularPhongMethod=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset SpecularPhongMethod]",e}(SpecularBasicMethod),_Shader_SpecularPhongMethod=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype._getFragmentCodePerLight=function(t,e,i,r){var n,o="";this._pIsFirstLight?n=this._totalLightColorReg:(n=i.getFreeFragmentVectorTemp(),i.addFragmentTempUsages(n,1));var s=r.viewDirFragment,a=r.normalFragment;return o+="dp3 "+n+".w, "+t+", "+a+"\nadd "+n+".w, "+n+".w, "+n+".w\nmul "+n+".xyz, "+a+", "+n+".w\nsub "+n+".xyz, "+n+", "+t+"\nadd "+n+".w, "+n+".w, "+r.commons+".w\nsat "+n+".w, "+n+".w\nmul "+n+".xyz, "+n+", "+n+".w\ndp3 "+n+".w, "+n+", "+s+"\nsat "+n+".w, "+n+".w\n",this._texture?o+="mul "+this._specularTexData+".w, "+this._specularTexData+".y, "+this._specularDataRegister+".w\npow "+n+".w, "+n+".w, "+this._specularTexData+".w\n":o+="pow "+n+".w, "+n+".w, "+this._specularDataRegister+".w\n",this._shader.usesLightFallOff&&(o+="mul "+n+".w, "+n+".w, "+t+".w\n"),null!=this._modulateFunction&&(o+=this._modulateFunction(n,i,r)),o+="mul "+n+".xyz, "+e+".xyz, "+n+".w\n",this._pIsFirstLight||(o+="add "+this._totalLightColorReg+".xyz, "+this._totalLightColorReg+".xyz, "+n+".xyz\n",i.removeFragmentTempUsage(n)),this._pIsFirstLight=!1,o},e}(_Shader_SpecularBasicMethod);ShaderBase.registerAbstraction(_Shader_SpecularPhongMethod,SpecularPhongMethod);var LightSources=function(){function t(){}return t.LIGHTS=1,t.PROBES=2,t.ALL=3,t}(),PassBase=function(t){function e(e,i){var r=t.call(this)||this;return r._preserveAlpha=!0,r._forceSeparateMVP=!1,r._renderMaterial=e,r._renderElements=i,r._stage=i.stage,r}return __extends(e,t),Object.defineProperty(e.prototype,"shader",{get:function(){return this._shader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){this._preserveAlpha!=t&&(this._preserveAlpha=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forceSeparateMVP",{get:function(){return this._forceSeparateMVP},set:function(t){this._forceSeparateMVP!=t&&(this._forceSeparateMVP=t,this.invalidate())},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){this._shader.invalidateProgram(),this.dispatchEvent(new PassEvent(PassEvent.INVALIDATE,this))},e.prototype.dispose=function(){this._renderMaterial=null,this._renderElements=null,this._stage=null,this._shader&&(this._shader.dispose(),this._shader=null)},e.prototype._setRenderState=function(t,e){this._shader._setRenderState(t,e.projection)},e.prototype._activate=function(t){this._shader._activate(t.projection)},e.prototype._deactivate=function(){this._shader._deactivate()},e.prototype._includeDependencies=function(t){t.alphaThreshold=this._renderMaterial.material.alphaThreshold,t.useImageRect=this._renderMaterial.material.imageRect,t.usesCurves=this._renderMaterial.material.curves,t.useAlphaPremultiplied=this._renderMaterial.material.alphaPremultiplied,t.useBothSides=this._renderMaterial.material.bothSides,t.usesUVTransform=this._renderMaterial.material.animateUVs,t.usesColorTransform=this._renderMaterial.material.useColorTransform,this._forceSeparateMVP&&this._shader.globalPosDependencies++},e.prototype._initConstantData=function(){},e.prototype._getVertexCode=function(t,e){return""},e.prototype._getFragmentCode=function(t,e){return""},e.prototype._getPostAnimationFragmentCode=function(t,e){return""},e.prototype._getNormalVertexCode=function(t,e){return""},e.prototype._getNormalFragmentCode=function(t,e){return""},e}(EventDispatcher),LightingShader=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r,n)||this;return o._includeCasters=!0,o._lightingPass=r,o}return __extends(e,t),e.prototype._includeDependencies=function(){this.numPointLights=this._lightingPass.numPointLights,this.numDirectionalLights=this._lightingPass.numDirectionalLights,this.numLightProbes=this._lightingPass.numLightProbes;var e=this._lightingPass.numPointLights+this._lightingPass.numDirectionalLights,i=this._lightingPass.numLightProbes,r=this._lightingPass._iUsesDiffuse(this)?this._lightingPass.diffuseLightSources:0,n=this._lightingPass._iUsesSpecular(this)?this._lightingPass.specularLightSources:0,o=r|n;this.usesLightFallOff=this._lightingPass.enableLightFallOff&&this.profile!=ContextGLProfile.BASELINE_CONSTRAINED,this.usesCommonData=this.usesLightFallOff||this.usesCommonData,this.numLights=e+i,this.usesLights=e>0&&0!=(o&LightSources.LIGHTS),this.usesProbes=i>0&&0!=(o&LightSources.PROBES),this.usesLightsForSpecular=e>0&&0!=(n&LightSources.LIGHTS),this.usesProbesForSpecular=i>0&&0!=(n&LightSources.PROBES),this.usesLightsForDiffuse=e>0&&0!=(r&LightSources.LIGHTS),this.usesProbesForDiffuse=i>0&&0!=(r&LightSources.PROBES),this.usesShadows=this._lightingPass._iUsesShadows(this),t.prototype._includeDependencies.call(this)},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),this._lightingPass.lightPicker&&this._lightingPass.lightPicker.collectLights(e.sourceEntity),this.usesLights&&this.updateLights(),this.usesProbes&&this.updateProbes()},e.prototype._initRegisterIndices=function(){if(t.prototype._initRegisterIndices.call(this),this.lightVertexConstantIndex=-1,this.lightFragmentConstantIndex=-1,this.probeWeightsIndex=-1,this._numProbeRegisters=Math.ceil(this.numLightProbes/4),this.usesTangentSpace||!this.usesGlobalPosFragment?(this._pointLightVertexConstants=new Array(this.numPointLights),this._pointLightFragmentConstants=new Array(2*this.numPointLights)):(this._pointLightVertexConstants=null,this._pointLightFragmentConstants=new Array(3*this.numPointLights)),this.usesTangentSpace?(this._dirLightVertexConstants=new Array(this.numDirectionalLights),this._dirLightFragmentConstants=new Array(2*this.numDirectionalLights)):(this._dirLightVertexConstants=null,this._dirLightFragmentConstants=new Array(3*this.numDirectionalLights)),this.usesLights){var e,i;if(this._dirLightVertexConstants)for(i=this._dirLightVertexConstants.length,e=0;e<i;++e)this._dirLightVertexConstants[e]=this._registerCache.getFreeVertexConstant(),-1==this.lightVertexConstantIndex&&(this.lightVertexConstantIndex=4*this._dirLightVertexConstants[e].index);if(this._pointLightVertexConstants)for(i=this._pointLightVertexConstants.length,e=0;e<i;++e)this._pointLightVertexConstants[e]=this._registerCache.getFreeVertexConstant(),-1==this.lightVertexConstantIndex&&(this.lightVertexConstantIndex=4*this._pointLightVertexConstants[e].index);for(i=this._dirLightFragmentConstants.length,e=0;e<i;++e)this._dirLightFragmentConstants[e]=this._registerCache.getFreeFragmentConstant(),-1==this.lightFragmentConstantIndex&&(this.lightFragmentConstantIndex=4*this._dirLightFragmentConstants[e].index);for(i=this._pointLightFragmentConstants.length,e=0;e<i;++e)this._pointLightFragmentConstants[e]=this._registerCache.getFreeFragmentConstant(),-1==this.lightFragmentConstantIndex&&(this.lightFragmentConstantIndex=4*this._pointLightFragmentConstants[e].index)}},e.prototype._compileDependencies=function(){t.prototype._compileDependencies.call(this),this._vertexCode+=this._lightingPass._getPreLightingVertexCode(this._registerCache,this._sharedRegisters),this._postAnimationFragmentCode+=this._lightingPass._getPreLightingFragmentCode(this._registerCache,this._sharedRegisters),this.usesShadows&&this._compileShadowCode(),this.usesLights&&this._compileLightCode(),this.usesProbes&&this._compileLightProbeCode()},e.prototype._compileShadowCode=function(){this.normalDependencies>0?this._sharedRegisters.shadowTarget=this._sharedRegisters.normalFragment:(this._sharedRegisters.shadowTarget=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(this._sharedRegisters.shadowTarget,1))},e.prototype._compileLightCode=function(){for(var t,e,i,r,n=0,o=0,s=this.usesLightsForSpecular,a=this.usesLightsForDiffuse,l=0;l<this.numDirectionalLights;++l){if(this.usesTangentSpace){r=this._dirLightVertexConstants[n++];var h=this._registerCache.getFreeVarying();this._vertexCode+="m33 "+h+".xyz, "+r+", "+this._sharedRegisters.animatedTangent+"\nmov "+h+".w, "+r+".w\n",r=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addVertexTempUsages(r,1),this._postAnimationFragmentCode+="nrm "+r+".xyz, "+h+"\nmov "+r+".w, "+h+".w\n"}else r=this._dirLightFragmentConstants[o++];t=this._dirLightFragmentConstants[o++],e=this._dirLightFragmentConstants[o++],a&&(this._postAnimationFragmentCode+=this._lightingPass._getPerLightDiffuseFragmentCode(r,t,this._registerCache,this._sharedRegisters)),s&&(this._postAnimationFragmentCode+=this._lightingPass._getPerLightSpecularFragmentCode(r,e,this._registerCache,this._sharedRegisters)),this.usesTangentSpace&&this._registerCache.removeVertexTempUsage(r)}n=0,o=0;for(l=0;l<this.numPointLights;++l){if(i=this.usesTangentSpace||!this.usesGlobalPosFragment?this._pointLightVertexConstants[n++]:this._pointLightFragmentConstants[o++],t=this._pointLightFragmentConstants[o++],e=this._pointLightFragmentConstants[o++],r=this._registerCache.getFreeFragmentVectorTemp(),this._registerCache.addFragmentTempUsages(r,1),this.usesTangentSpace){h=this._registerCache.getFreeVarying();var c=this._registerCache.getFreeVertexVectorTemp();this._vertexCode+="sub "+c+", "+i+", "+this._sharedRegisters.animatedPosition+"\nm33 "+h+".xyz, "+c+", "+this._sharedRegisters.animatedTangent+"\nmov "+h+".w, "+this._sharedRegisters.animatedPosition+".w\n"}else this.usesGlobalPosFragment?(h=r,this._postAnimationFragmentCode+="sub "+r+", "+i+", "+this._sharedRegisters.globalPositionVarying+"\n"):(h=this._registerCache.getFreeVarying(),this._vertexCode+="sub "+h+", "+i+", "+this._sharedRegisters.globalPositionVertex+"\n");this.usesLightFallOff?this._postAnimationFragmentCode+="dp3 "+r+".w, "+h+", "+h+"\nsub "+r+".w, "+r+".w, "+t+".w\nmul "+r+".w, "+r+".w, "+e+".w\nsat "+r+".w, "+r+".w\nsub "+r+".w, "+this._sharedRegisters.commons+".w, "+r+".w\nnrm "+r+".xyz, "+h+"\n":this._postAnimationFragmentCode+="nrm "+r+".xyz, "+h+"\nmov "+r+".w, "+h+".w\n",-1==this.lightFragmentConstantIndex&&(this.lightFragmentConstantIndex=4*i.index),a&&(this._postAnimationFragmentCode+=this._lightingPass._getPerLightDiffuseFragmentCode(r,t,this._registerCache,this._sharedRegisters)),s&&(this._postAnimationFragmentCode+=this._lightingPass._getPerLightSpecularFragmentCode(r,e,this._registerCache,this._sharedRegisters)),this._registerCache.removeFragmentTempUsage(r)}},e.prototype._compileLightProbeCode=function(){var t,e,i,r=[".x",".y",".z",".w"],n=new Array,o=this.usesProbesForSpecular,s=this.usesProbesForDiffuse;for(s&&(this.lightProbeDiffuseIndices=new Array),o&&(this.lightProbeSpecularIndices=new Array),e=0;e<this._numProbeRegisters;++e)n[e]=this._registerCache.getFreeFragmentConstant(),0==e&&(this.probeWeightsIndex=4*n[e].index);for(e=0;e<this.numLightProbes;++e)t=n[Math.floor(e/4)].toString()+r[e%4],s&&(i=this._registerCache.getFreeTextureReg(),this.lightProbeDiffuseIndices[e]=i.index,this._postAnimationFragmentCode+=this._lightingPass._getPerProbeDiffuseFragmentCode(i,t,this._registerCache,this._sharedRegisters)),o&&(i=this._registerCache.getFreeTextureReg(),this.lightProbeSpecularIndices[e]=i.index,this._postAnimationFragmentCode+=this._lightingPass._getPerProbeSpecularFragmentCode(i,t,this._registerCache,this._sharedRegisters))},e.prototype.updateLights=function(){var t,e,i,r,n,o,s=0,a=0,l=0,h=this.usesShadows?2:1;this.ambientR=this.ambientG=this.ambientB=0,n=this.lightVertexConstantIndex,a=this.lightFragmentConstantIndex;var c=0,u=this._lightingPass.lightPicker.directionalLights;for((o=this._lightingPass.directionalLightsOffset)>(i=this._lightingPass.lightPicker.directionalLights.length)&&(c=1,o-=i);c<h;++c)for(c&&(u=this._lightingPass.lightPicker.castingDirectionalLights),(i=u.length)>this.numDirectionalLights&&(i=this.numDirectionalLights),s=0;s<i;++s){if(r=(t=u[o+s]).sceneDirection,this.ambientR+=t._ambientR,this.ambientG+=t._ambientG,this.ambientB+=t._ambientB,this.usesTangentSpace){var p=-r.x,d=-r.y,f=-r.z;this.vertexConstantData[n++]=this._pInverseSceneMatrix[0]*p+this._pInverseSceneMatrix[4]*d+this._pInverseSceneMatrix[8]*f,this.vertexConstantData[n++]=this._pInverseSceneMatrix[1]*p+this._pInverseSceneMatrix[5]*d+this._pInverseSceneMatrix[9]*f,this.vertexConstantData[n++]=this._pInverseSceneMatrix[2]*p+this._pInverseSceneMatrix[6]*d+this._pInverseSceneMatrix[10]*f,this.vertexConstantData[n++]=1}else this.fragmentConstantData[a++]=-r.x,this.fragmentConstantData[a++]=-r.y,this.fragmentConstantData[a++]=-r.z,this.fragmentConstantData[a++]=1;this.fragmentConstantData[a++]=t._diffuseR,this.fragmentConstantData[a++]=t._diffuseG,this.fragmentConstantData[a++]=t._diffuseB,this.fragmentConstantData[a++]=1,this.fragmentConstantData[a++]=t._specularR,this.fragmentConstantData[a++]=t._specularG,this.fragmentConstantData[a++]=t._specularB,this.fragmentConstantData[a++]=1,++l==this.numDirectionalLights&&(s=i,c=h)}if(this.numDirectionalLights>l)for(s=a+12*(this.numDirectionalLights-l);a<s;)this.fragmentConstantData[a++]=0;l=0;var _=this._lightingPass.lightPicker.pointLights;for((o=this._lightingPass.pointLightsOffset)>(i=this._lightingPass.lightPicker.pointLights.length)?(c=1,o-=i):c=0;c<h;++c)for(c&&(_=this._lightingPass.lightPicker.castingPointLights),i=_.length,s=0;s<i;++s){r=(e=_[o+s]).transform.concatenatedMatrix3D.position,this.ambientR+=e._ambientR,this.ambientG+=e._ambientG,this.ambientB+=e._ambientB,this.usesTangentSpace?(p=r.x,d=r.y,f=r.z,this.vertexConstantData[n++]=this._pInverseSceneMatrix[0]*p+this._pInverseSceneMatrix[4]*d+this._pInverseSceneMatrix[8]*f+this._pInverseSceneMatrix[12],this.vertexConstantData[n++]=this._pInverseSceneMatrix[1]*p+this._pInverseSceneMatrix[5]*d+this._pInverseSceneMatrix[9]*f+this._pInverseSceneMatrix[13],this.vertexConstantData[n++]=this._pInverseSceneMatrix[2]*p+this._pInverseSceneMatrix[6]*d+this._pInverseSceneMatrix[10]*f+this._pInverseSceneMatrix[14],this.vertexConstantData[n++]=1):this.usesGlobalPosFragment?(this.fragmentConstantData[a++]=r.x,this.fragmentConstantData[a++]=r.y,this.fragmentConstantData[a++]=r.z,this.fragmentConstantData[a++]=1):(this.vertexConstantData[n++]=r.x,this.vertexConstantData[n++]=r.y,this.vertexConstantData[n++]=r.z,this.vertexConstantData[n++]=1),this.fragmentConstantData[a++]=e._diffuseR,this.fragmentConstantData[a++]=e._diffuseG,this.fragmentConstantData[a++]=e._diffuseB;var g=e.radius;this.fragmentConstantData[a++]=g*g,this.fragmentConstantData[a++]=e._specularR,this.fragmentConstantData[a++]=e._specularG,this.fragmentConstantData[a++]=e._specularB,this.fragmentConstantData[a++]=e.fallOffFactor,++l==this.numPointLights&&(s=i,c=h)}if(this.numPointLights>l)for(s=a+12*(l-this.numPointLights);a<s;++a)this.fragmentConstantData[a]=0},e.prototype.updateProbes=function(){var t,e=this._lightingPass.lightPicker.lightProbes,i=this._lightingPass.lightPicker.lightProbeWeights,r=e.length-this._lightingPass.lightProbesOffset,n=this.usesProbesForDiffuse,o=this.usesProbesForSpecular;if(n||o){r>this.numLightProbes&&(r=this.numLightProbes);for(var s=0;s<r;++s)t=e[this._lightingPass.lightProbesOffset+s],n&&this._stage.getAbstraction(t.diffuseMap).activate(this.lightProbeDiffuseIndices[s],t.diffuseSampler),o&&this._stage.getAbstraction(t.specularMap).activate(this.lightProbeSpecularIndices[s],t.diffuseSampler);for(s=0;s<r;++s)this.fragmentConstantData[this.probeWeightsIndex+s]=i[this._lightingPass.lightProbesOffset+s]}},e}(ShaderBase),MethodPassMode=function(){function t(){}return t.EFFECTS=1,t.LIGHTING=2,t.SUPER_SHADER=3,t}(),MethodPass=function(t){function e(e,i,r){var n=t.call(this,i,r)||this;return n._maxLights=3,n._mode=3,n._includeCasters=!0,n._chunks=new Array,n._methods=new Array,n._numEffectDependencies=0,n.numDirectionalLights=0,n.numPointLights=0,n.numLightProbes=0,n.pointLightsOffset=0,n.directionalLightsOffset=0,n.lightProbesOffset=0,n._mode=e,n._onLightsChangeDelegate=function(t){return n.onLightsChange(t)},n._onMethodInvalidatedDelegate=function(t){return n.onMethodInvalidated(t)},n.lightPicker=i.lightPicker,null==n._shader&&n._updateShader(),n}return __extends(e,t),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode!=t&&(this._mode=t,this._updateLights())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"includeCasters",{get:function(){return this._includeCasters},set:function(t){this._includeCasters!=t&&(this._includeCasters=t,this._updateLights())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightPicker",{get:function(){return this._lightPicker},set:function(t){this._lightPicker&&this._lightPicker.removeEventListener(AssetEvent.INVALIDATE,this._onLightsChangeDelegate),this._lightPicker=t,this._lightPicker&&this._lightPicker.addEventListener(AssetEvent.INVALIDATE,this._onLightsChangeDelegate),this._updateLights()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableLightFallOff",{get:function(){return this._renderMaterial.enableLightFallOff},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseLightSources",{get:function(){return this._renderMaterial.diffuseLightSources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularLightSources",{get:function(){return this._renderMaterial.specularLightSources},enumerable:!0,configurable:!0}),e.prototype._updateShader=function(){!(this.numDirectionalLights||this.numPointLights||this.numLightProbes)||this._shader instanceof LightingShader?null==this._shader&&(null!=this._shader&&(this._shader.dispose(),this._shader=null),this._shader=new ShaderBase(this._renderElements,this._renderMaterial,this,this._stage)):(null!=this._shader&&(this._shader.dispose(),this._shader=null),this._shader=new LightingShader(this._renderElements,this._renderMaterial,this,this._stage))},e.prototype._initConstantData=function(){for(var t=this._chunks.length,e=0;e<t;++e)this._chunks[e]._initConstants()},Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this.colorTransformMethod?this.colorTransformMethod.colorTransform:null},set:function(t){t?(null==this.colorTransformMethod&&(this.colorTransformMethod=new EffectColorTransformMethod),this.colorTransformMethod.colorTransform=t):t||this.colorTransformMethod&&(this.colorTransformMethod=null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTransformMethod",{get:function(){return this._colorTransformMethod},set:function(t){this._colorTransformMethod!=t&&(this._colorTransformMethod&&(this._removeDependency(this._colorTransformMethod),this._colorTransformChunk=null),this._colorTransformMethod=t,t&&(this._colorTransformChunk=this._shader.getAbstraction(t),this._addDependency(t)))},enumerable:!0,configurable:!0}),e.prototype._removeDependency=function(t,e){void 0===e&&(e=!1);var i=this._methods.indexOf(t);-1!=i&&(e||this._numEffectDependencies--,t.removeEventListener(MethodEvent.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate),this._methods.splice(i,1),this._chunks.splice(i,1),this.invalidate())},e.prototype._addDependency=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=-1),t.addEventListener(MethodEvent.SHADER_INVALIDATED,this._onMethodInvalidatedDelegate);var r=this._shader.getAbstraction(t);e?(-1!=i?(this._methods.splice(i+this._methods.length-this._numEffectDependencies,0,t),this._chunks.splice(i+this._chunks.length-this._numEffectDependencies,0,r)):(this._methods.push(t),this._chunks.push(r)),this._numEffectDependencies++):(this._methods.splice(this._methods.length-this._numEffectDependencies,0,t),this._chunks.splice(this._chunks.length-this._numEffectDependencies,0,r)),this.invalidate()},e.prototype.addEffectMethod=function(t){this._addDependency(t,!0)},Object.defineProperty(e.prototype,"numEffectMethods",{get:function(){return this._numEffectDependencies},enumerable:!0,configurable:!0}),e.prototype.hasEffectMethod=function(t){return-1!=this._methods.indexOf(t)},e.prototype.getEffectMethodAt=function(t){return t<0||t>this._numEffectDependencies-1?null:this._methods[t+this._methods.length-this._numEffectDependencies]},e.prototype.addEffectMethodAt=function(t,e){this._addDependency(t,!0,e)},e.prototype.removeEffectMethod=function(t){this._removeDependency(t,!0)},e.prototype.removeEffectMethodAt=function(t){var e=this.getEffectMethodAt(t);null!=e&&this._removeDependency(e,!0)},Object.defineProperty(e.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(t){this._normalMethod!=t&&(this._normalMethod&&(this._removeDependency(this._normalMethod),this._normalChunk=null),this._normalMethod=t,t&&(this._normalChunk=this._shader.getAbstraction(t),this._addDependency(t)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(t){this._ambientMethod!=t&&(this._ambientMethod&&(this._removeDependency(this._ambientMethod),this._ambientChunk=null),this._ambientMethod=t,t&&(this._ambientChunk=this._shader.getAbstraction(t),this._addDependency(t)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(t){this._shadowMethod!=t&&(this._shadowMethod&&(this._removeDependency(this._shadowMethod),this._shadowChunk=null),this._shadowMethod=t,t&&(this._shadowChunk=this._shader.getAbstraction(t),this._addDependency(t)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(t){this._diffuseMethod!=t&&(this._diffuseMethod&&(this._removeDependency(this._diffuseMethod),this._diffuseChunk=null),t&&(this._diffuseChunk=this._shader.getAbstraction(t),this._addDependency(t)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(t){this._specularMethod!=t&&(this._specularMethod&&(this._removeDependency(this._specularMethod),this._specularChunk=null),t&&(this._specularChunk=this._shader.getAbstraction(t),this._addDependency(t)))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(this._lightPicker&&this._lightPicker.removeEventListener(AssetEvent.INVALIDATE,this._onLightsChangeDelegate);this._methods.length;)this._removeDependency(this._methods[0]);t.prototype.dispose.call(this),this._chunks=null,this._methods=null},e.prototype.onMethodInvalidated=function(t){this.invalidate()},e.prototype._activate=function(e){var i;t.prototype._activate.call(this,e);for(var r=this._chunks.length,n=0;n<r;++n)(i=this._chunks[n]).chunkVO.useChunk&&i._activate()},e.prototype._setRenderState=function(e,i){var r;t.prototype._setRenderState.call(this,e,i);for(var n=this._chunks.length,o=0;o<n;++o)(r=this._chunks[o]).chunkVO.useChunk&&r._setRenderState(e,i)},e.prototype._deactivate=function(){var e;t.prototype._deactivate.call(this);for(var i=this._chunks.length,r=0;r<i;++r)(e=this._chunks[r]).chunkVO.useChunk&&e._deactivate()},e.prototype._includeDependencies=function(e){var i;t.prototype._includeDependencies.call(this,e),e.usesFragmentAnimation=Boolean(this._mode==MethodPassMode.SUPER_SHADER),e.useAlphaPremultiplied&&e.usesBlending&&(e.usesCommonData=!0);var r=this._chunks.length;for(i=0;i<r;++i)this.setupAndCountDependencies(e,this._chunks[i]);var n,o=!0;for(i=0;i<r;++i)((n=this._chunks[i]).chunkVO.useChunk=n._isUsed())&&!n._usesTangentSpace()&&(o=!1);e.outputsNormals=this._normalChunk&&this._normalChunk.chunkVO.useChunk,e.outputsTangentNormals=e.outputsNormals&&this._normalChunk._outputsTangentNormals(),e.usesTangentSpace=e.outputsTangentNormals&&!e.usesProbes&&o,e.usesTangentSpace||(e.viewDirDependencies>0?e.globalPosDependencies++:this.numPointLights>0&&e.usesLights&&(e.globalPosDependencies++,Boolean(this._mode&MethodPassMode.EFFECTS)&&(e.usesGlobalPosFragment=!0)))},e.prototype.setupAndCountDependencies=function(t,e){var i=e.chunkVO;e._reset(i),e._initVO(i),i.needsProjection&&t.projectionDependencies++,(i.needsGlobalVertexPos||i.needsGlobalFragmentPos)&&(t.globalPosDependencies++,i.needsGlobalFragmentPos&&(t.usesGlobalPosFragment=!0)),i.needsNormals&&t.normalDependencies++,i.needsTangents&&t.tangentDependencies++,i.needsView&&t.viewDirDependencies++},e.prototype._getPreLightingVertexCode=function(t,e){return""},e.prototype._getPreLightingFragmentCode=function(t,e){var i="";return this._diffuseChunk&&this._diffuseChunk.chunkVO.useChunk&&(i+=this._diffuseChunk._getFragmentPreLightingCode(t,e)),this._specularChunk&&this._specularChunk.chunkVO.useChunk&&(i+=this._specularChunk._getFragmentPreLightingCode(t,e)),i},e.prototype._getPerLightDiffuseFragmentCode=function(t,e,i,r){return this._diffuseChunk._getFragmentCodePerLight(t,e,i,r)},e.prototype._getPerLightSpecularFragmentCode=function(t,e,i,r){return this._specularChunk._getFragmentCodePerLight(t,e,i,r)},e.prototype._getPerProbeDiffuseFragmentCode=function(t,e,i,r){return this._diffuseChunk._getFragmentCodePerProbe(t,e,i,r)},e.prototype._getPerProbeSpecularFragmentCode=function(t,e,i,r){return this._specularChunk._getFragmentCodePerProbe(t,e,i,r)},e.prototype._getNormalVertexCode=function(t,e){return this._normalChunk._getVertexCode(t,e)},e.prototype._getNormalFragmentCode=function(t,e){var i=this._normalChunk._getFragmentCode(e.normalFragment,t,e);return this._normalChunk.chunkVO.needsView&&t.removeFragmentTempUsage(e.viewDirFragment),(this._normalChunk.chunkVO.needsGlobalFragmentPos||this._normalChunk.chunkVO.needsGlobalVertexPos)&&t.removeVertexTempUsage(e.globalPositionVertex),i},e.prototype._getVertexCode=function(t,e){var i,r="";this._ambientChunk&&this._ambientChunk.chunkVO.useChunk&&(r+=this._ambientChunk._getVertexCode(t,e)),this._shadowChunk&&(r+=this._shadowChunk._getVertexCode(t,e)),this._diffuseChunk&&this._diffuseChunk.chunkVO.useChunk&&(r+=this._diffuseChunk._getVertexCode(t,e)),this._specularChunk&&this._specularChunk.chunkVO.useChunk&&(r+=this._specularChunk._getVertexCode(t,e));for(var n=this._chunks.length,o=n-this._numEffectDependencies;o<n;o++)(i=this._chunks[o]).chunkVO.useChunk&&(r+=i._getVertexCode(t,e),(i.chunkVO.needsGlobalVertexPos||i.chunkVO.needsGlobalFragmentPos)&&t.removeVertexTempUsage(e.globalPositionVertex));return this._colorTransformChunk&&this._colorTransformChunk.chunkVO.useChunk&&(r+=this._colorTransformChunk._getVertexCode(t,e)),r},e.prototype._getFragmentCode=function(t,e){var i="";return this._ambientChunk&&this._ambientChunk.chunkVO.useChunk&&(i+=this._ambientChunk._getFragmentCode(e.shadedTarget,t,e),this._ambientChunk.chunkVO.needsNormals&&t.removeFragmentTempUsage(e.normalFragment),this._ambientChunk.chunkVO.needsView&&t.removeFragmentTempUsage(e.viewDirFragment)),i},e.prototype._getPostAnimationFragmentCode=function(t,e){var i,r,n="";this._shader.useAlphaPremultiplied&&this._shader.usesBlending&&(n+="add "+e.shadedTarget+".w, "+e.shadedTarget+".w, "+e.commons+".z\ndiv "+e.shadedTarget+".xyz, "+e.shadedTarget+", "+e.shadedTarget+".w\nsub "+e.shadedTarget+".w, "+e.shadedTarget+".w, "+e.commons+".z\nsat "+e.shadedTarget+".xyz, "+e.shadedTarget+"\n"),this._shadowChunk&&(n+=this._shadowChunk._getFragmentCode(e.shadowTarget,t,e)),this._diffuseChunk&&this._diffuseChunk.chunkVO.useChunk&&(n+=this._diffuseChunk._getFragmentCode(e.shadedTarget,t,e),this._diffuseChunk.chunkVO.needsNormals&&t.removeFragmentTempUsage(e.normalFragment),this._diffuseChunk.chunkVO.needsView&&t.removeFragmentTempUsage(e.viewDirFragment)),this._specularChunk&&this._specularChunk.chunkVO.useChunk&&(n+=this._specularChunk._getFragmentCode(e.shadedTarget,t,e),this._specularChunk.chunkVO.needsNormals&&t.removeFragmentTempUsage(e.normalFragment),this._specularChunk.chunkVO.needsView&&t.removeFragmentTempUsage(e.viewDirFragment)),this._shadowChunk&&!this._shader.normalDependencies&&t.removeFragmentTempUsage(e.shadowTarget),this.preserveAlpha&&this._numEffectDependencies>0&&(i=t.getFreeFragmentSingleTemp(),t.addFragmentTempUsages(i,1),n+="mov "+i+", "+e.shadedTarget+".w\n");for(var o=this._chunks.length,s=o-this._numEffectDependencies;s<o;s++)(r=this._chunks[s]).chunkVO.useChunk&&(n+=r._getFragmentCode(e.shadedTarget,t,e),r.chunkVO.needsNormals&&t.removeFragmentTempUsage(e.normalFragment),r.chunkVO.needsView&&t.removeFragmentTempUsage(e.viewDirFragment));return this.preserveAlpha&&this._numEffectDependencies>0&&(n+="mov "+e.shadedTarget+".w, "+i+"\n",t.removeFragmentTempUsage(i)),this._colorTransformChunk&&this._colorTransformChunk.chunkVO.useChunk&&(n+=this._colorTransformChunk._getFragmentCode(e.shadedTarget,t,e)),n},e.prototype._iUsesShadows=function(t){return Boolean(this._shadowChunk&&(this._lightPicker.castingDirectionalLights.length>0||this._lightPicker.castingPointLights.length>0))},e.prototype._iUsesSpecular=function(t){return Boolean(this._specularChunk)},e.prototype._iUsesDiffuse=function(t){return Boolean(this._diffuseChunk)},e.prototype.onLightsChange=function(t){this._updateLights()},e.prototype._updateLights=function(){var t=this.numDirectionalLights,e=this.numPointLights,i=this.numLightProbes;this._lightPicker&&this._mode&MethodPassMode.LIGHTING?(this.numDirectionalLights=this.calculateNumDirectionalLights(this._lightPicker.numDirectionalLights),this.numPointLights=this.calculateNumPointLights(this._lightPicker.numPointLights),this.numLightProbes=this.calculateNumProbes(this._lightPicker.numLightProbes),this._includeCasters&&(this.numDirectionalLights+=this._lightPicker.numCastingDirectionalLights,this.numPointLights+=this._lightPicker.numCastingPointLights)):(this.numDirectionalLights=0,this.numPointLights=0,this.numLightProbes=0),t==this.numDirectionalLights&&e==this.numPointLights&&i==this.numLightProbes||(this._updateShader(),this.invalidate())},e.prototype.calculateNumDirectionalLights=function(t){return Math.min(t-this.directionalLightsOffset,this._maxLights)},e.prototype.calculateNumPointLights=function(t){var e=this._maxLights-this.numDirectionalLights;return Math.min(t-this.pointLightsOffset,e)},e.prototype.calculateNumProbes=function(t){var e=0;return 0!=(this._renderMaterial.specularLightSources&LightSources.PROBES)&&++e,0!=(this._renderMaterial.diffuseLightSources&LightSources.PROBES)&&++e,Math.min(t-this.lightProbesOffset,4/e|0)},e}(PassBase),BasicMaterialPass=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._diffuseR=1,r._diffuseG=1,r._diffuseB=1,r._diffuseA=1,r._shader=new ShaderBase(i,e,r,r._stage),r.invalidate(),r}return __extends(e,t),e.prototype._includeDependencies=function(e){t.prototype._includeDependencies.call(this,e),null!=this._shaderTexture&&e.uvDependencies++},e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._shaderTexture=this._renderMaterial.material.getTextureAt(0)?this._shader.getAbstraction(this._renderMaterial.material.getTextureAt(0)):null},e.prototype.dispose=function(){this._shaderTexture&&(this._shaderTexture.onClear(new AssetEvent(AssetEvent.CLEAR,this._renderMaterial.material.getTextureAt(0))),this._shaderTexture=null),t.prototype.dispose.call(this)},e.prototype._getFragmentCode=function(t,e){var i,r="";this.preserveAlpha&&(i=t.getFreeFragmentSingleTemp(),t.addFragmentTempUsages(i,1),r+="mov "+i+", "+e.shadedTarget+".w\n");var n=e.shadedTarget;if(null!=this._shaderTexture){if(r+=this._shaderTexture._getFragmentCode(n,t,e,e.uvVarying),this._shader.alphaThreshold>0){var o=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*o.index,r+="sub "+n+".w, "+n+".w, "+o+".x\nkil "+n+".w\nadd "+n+".w, "+n+".w, "+o+".x\n"}}else if(-1!=this._shader.colorBufferIndex)r+="mov "+n+", "+e.colorVarying+"\n";else{var s=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*s.index,r+="mov "+n+", "+s+"\n"}return this.preserveAlpha&&(r+="mul "+e.shadedTarget+".w, "+e.shadedTarget+".w, "+i+"\n",t.removeFragmentTempUsage(i)),r},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),null!=this._shaderTexture&&this._shaderTexture._setRenderState(e)},e.prototype._activate=function(e){if(t.prototype._activate.call(this,e),null!=this._shaderTexture)this._shaderTexture.activate(),this._shader.alphaThreshold>0&&(this._shader.fragmentConstantData[this._fragmentConstantsIndex]=this._shader.alphaThreshold);else if(-1==this._shader.colorBufferIndex){var i=this._fragmentConstantsIndex,r=this._shader.fragmentConstantData;r[i]=this._diffuseR,r[i+1]=this._diffuseG,r[i+2]=this._diffuseB,r[i+3]=this._diffuseA}},e}(PassBase),LightPickerBase=function(t){function e(){var e=t.call(this)||this;return e._numPointLights=0,e._numDirectionalLights=0,e._numCastingPointLights=0,e._numCastingDirectionalLights=0,e._numLightProbes=0,e}return __extends(e,t),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numDirectionalLights",{get:function(){return this._numDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numPointLights",{get:function(){return this._numPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numCastingDirectionalLights",{get:function(){return this._numCastingDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numCastingPointLights",{get:function(){return this._numCastingPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numLightProbes",{get:function(){return this._numLightProbes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointLights",{get:function(){return this._pointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalLights",{get:function(){return this._directionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castingPointLights",{get:function(){return this._castingPointLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"castingDirectionalLights",{get:function(){return this._castingDirectionalLights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightProbes",{get:function(){return this._lightProbes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightProbeWeights",{get:function(){return this._lightProbeWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allPickedLights",{get:function(){return this._allPickedLights},enumerable:!0,configurable:!0}),e.prototype.collectLights=function(t){this.updateProbeWeights(t)},e.prototype.updateProbeWeights=function(t){var e,i,r,n,o,s,a=t.scenePosition,l=a.x,h=a.y,c=a.z,u=0;for(s=0;s<this._numLightProbes;++s)o=(o=(i=l-(e=this._lightProbes[s].transform.concatenatedMatrix3D.position).x)*i+(r=h-e.y)*r+(n=c-e.z)*n)>1e-5?1/o:5e7,this._lightProbeWeights[s]=o,u+=o;for(u=1/u,s=0;s<this._numLightProbes;++s)this._lightProbeWeights[s]*=u},e.assetType="[asset LightPicker]",e}(AssetBase),StaticLightPicker=function(t){function e(e){var i=t.call(this)||this;return i._onCastShadowChangeDelegate=function(t){return i.onCastShadowChange(t)},i.lights=e,i}return __extends(e,t),Object.defineProperty(e.prototype,"lights",{get:function(){return this._lights},set:function(t){var e,i=0,r=0,n=0,o=0,s=0;this._lights&&this.clearListeners(),this._lights=t,this._allPickedLights=t,this._pointLights=new Array,this._castingPointLights=new Array,this._directionalLights=new Array,this._castingDirectionalLights=new Array,this._lightProbes=new Array;for(var a=t.length,l=0;l<a;++l)(e=t[l]).addEventListener(LightEvent.CASTS_SHADOW_CHANGE,this._onCastShadowChangeDelegate),e instanceof PointLight?e.shadowsEnabled?this._castingPointLights[n++]=e:this._pointLights[i++]=e:e instanceof DirectionalLight?e.shadowsEnabled?this._castingDirectionalLights[o++]=e:this._directionalLights[r++]=e:e instanceof LightProbe&&(this._lightProbes[s++]=e);this._numDirectionalLights==r&&this._numPointLights==i&&this._numLightProbes==s&&this._numCastingPointLights==n&&this._numCastingDirectionalLights==o||(this._numDirectionalLights=r,this._numCastingDirectionalLights=o,this._numPointLights=i,this._numCastingPointLights=n,this._numLightProbes=s,this._lightProbeWeights=new Array(4*Math.ceil(s/4)),this.dispatchEvent(new AssetEvent(AssetEvent.INVALIDATE,this)))},enumerable:!0,configurable:!0}),e.prototype.clearListeners=function(){for(var t=this._lights.length,e=0;e<t;++e)this._lights[e].removeEventListener(LightEvent.CASTS_SHADOW_CHANGE,this._onCastShadowChangeDelegate)},e.prototype.onCastShadowChange=function(t){var e=t.target;e instanceof PointLight?this.updatePointCasting(e):e instanceof DirectionalLight&&this.updateDirectionalCasting(e),this.dispatchEvent(new AssetEvent(AssetEvent.INVALIDATE,this))},e.prototype.updateDirectionalCasting=function(t){var e=t;t.shadowsEnabled?(--this._numDirectionalLights,++this._numCastingDirectionalLights,this._directionalLights.splice(this._directionalLights.indexOf(e),1),this._castingDirectionalLights.push(t)):(++this._numDirectionalLights,--this._numCastingDirectionalLights,this._castingDirectionalLights.splice(this._castingDirectionalLights.indexOf(e),1),this._directionalLights.push(t))},e.prototype.updatePointCasting=function(t){var e=t;t.shadowsEnabled?(--this._numPointLights,++this._numCastingPointLights,this._pointLights.splice(this._pointLights.indexOf(e),1),this._castingPointLights.push(t)):(++this._numPointLights,--this._numCastingPointLights,this._castingPointLights.splice(this._castingPointLights.indexOf(e),1),this._pointLights.push(t))},e}(LightPickerBase),CascadeShadowMapper=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=3);var r=t.call(this,e)||this;if(r._scissorRectsInvalid=!0,r._onClearDelegate=function(t){return r.onClear(t)},e.addEventListener(AssetEvent.CLEAR,r._onClearDelegate),i<1||i>4)throw new Error("numCascades must be an integer between 1 and 4");return r._numCascades=i,r.init(),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._image2D.removeEventListener(AssetEvent.CLEAR,this._onClearDelegate),t.prototype.dispose.call(this)},e.prototype.getSplitRatio=function(t){return this._splitRatios[t]},e.prototype.setSplitRatio=function(t,e){if(e<0?e=0:e>1&&(e=1),t>=this._numCascades)throw new Error("index must be smaller than the number of cascades!");this._splitRatios[t]=e},e.prototype.getDepthProjections=function(t){return this._depthProjections[t].viewMatrix3D},e.prototype.init=function(){this._splitRatios=new Array(this._numCascades),this._nearPlaneDistances=new Array(this._numCascades);for(var t=1,e=this._numCascades-1;e>=0;--e)this._splitRatios[e]=t,t*=.4;for(this._texOffsetsX=Array(-1,1,-1,1),this._texOffsetsY=Array(1,1,-1,-1),this._pScissorRects=new Array(4),this._depthProjections=new Array,e=0;e<this._numCascades;++e)this._depthProjections[e]=new PerspectiveProjection},e.prototype.onClear=function(t){this._scissorRectsInvalid=!0},Object.defineProperty(e.prototype,"numCascades",{get:function(){return this._numCascades},set:function(t){if(t!=this._numCascades){if(t<1||t>4)throw new Error("numCascades must be an integer between 1 and 4");this._numCascades=t,this._scissorRectsInvalid=!0,this.init(),this.dispatchEvent(new AssetEvent(AssetEvent.INVALIDATE,this))}},enumerable:!0,configurable:!0}),e.prototype._renderMap=function(t,e){this._scissorRectsInvalid&&this.updateScissorRects(),e.depthRenderGroup.getRenderer(t).cullPlanes=this._cullPlanes},e.prototype.updateScissorRects=function(){var t=.5*this._image2D.width;this._pScissorRects[0]=new Rectangle(0,0,t,t),this._pScissorRects[1]=new Rectangle(t,0,t,t),this._pScissorRects[2]=new Rectangle(0,t,t,t),this._pScissorRects[3]=new Rectangle(t,t,t,t),this._scissorRectsInvalid=!1},e.prototype._updateProjection=function(t){var e,i=t.near,r=t.far-i;this._updateProjectionFromFrustumCorners(t,t.viewFrustumCorners,this._matrix),this._matrix.appendScale(.96,.96,1),this._overallDepthProjection.frustumMatrix3D=this._matrix,this._updateCullPlanes(t);for(var n=0;n<this._numCascades;++n)e=this._depthProjections[n].frustumMatrix3D,this._nearPlaneDistances[n]=i+this._splitRatios[n]*r,this._depthProjections[n].transform.matrix3D=this._overallDepthProjection.transform.matrix3D,this.updateProjectionPartition(e,this._splitRatios[n],this._texOffsetsX[n],this._texOffsetsY[n]),this._depthProjections[n].frustumMatrix3D=e},e.prototype.updateProjectionPartition=function(t,e,i,r){for(var n,o,s,a,l,h,c=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY,_=0;_<12;)(n=this._localFrustum[_])<c&&(c=n),n>p&&(p=n),(o=this._localFrustum[_+1])<u&&(u=o),o>d&&(d=o),(s=this._localFrustum[_+2])>f&&(f=s),(a=n+(this._localFrustum[_+12]-n)*e)<c&&(c=a),a>p&&(p=a),(l=o+(this._localFrustum[_+13]-o)*e)<u&&(u=l),l>d&&(d=l),(h=s+(this._localFrustum[_+14]-s)*e)>f&&(f=h),_+=3;var g=p-c,m=d-u,y=1/(f-1);c<0&&(c-=this._snap),u<0&&(u-=this._snap),c=Math.floor(c/this._snap)*this._snap,u=Math.floor(u/this._snap)*this._snap;var v=2*this._snap;p=c+(g=Math.floor(g/v+1)*v),d=u+(m=Math.floor(m/v+1)*v),g=1/g,m=1/m;var b=t._rawData;b[0]=2*g,b[5]=2*m,b[10]=y,b[12]=-(p+c)*g,b[13]=-(d+u)*m,b[14]=-1*y,b[15]=1,b[1]=b[2]=b[3]=b[4]=b[6]=b[7]=b[8]=b[9]=b[11]=0,t.appendScale(.96,.96,1),t.appendTranslation(i,r,0),t.appendScale(.5,.5,1)},Object.defineProperty(e.prototype,"_iNearPlaneDistances",{get:function(){return this._nearPlaneDistances},enumerable:!0,configurable:!0}),e.assetType="[asset CascadeShadowMapper]",e}(DirectionalShadowMapper),_Shader_CascadeShadowMapper=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),e.needsProjection=!0},e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._shader.fragmentConstantData,i=this._shader.vertexConstantData,r=this._fragmentConstantsIndex;e[r]=1,e[r+1]=1/255,e[r+2]=1/65025,e[r+3]=1/16581375,e[r+6]=.5,e[r+7]=-.5,i[r=this._vertexConstantsIndex]=.5,i[r+1]=-.5,i[r+2]=0;var n=this._mapper.numCascades;this._projectionMatrices=new Array(n);for(var o=0;o<n;++o)this._projectionMatrices[o]=new Matrix3D(new Float32Array(this._shader.vertexConstantData.buffer,4*(this._vertexConstantsIndex+4+16*o),16))},e.prototype._cleanCompilationData=function(){t.prototype._cleanCompilationData.call(this),this._cascadeProjections=null,this._depthMapCoordVaryings=null,this._projectionMatrices=null},e.prototype._getVertexCode=function(t,e){var i="",r=t.getFreeVertexConstant();this._vertexConstantsIndex=4*r.index,this._cascadeProjections=new Array(this._mapper.numCascades),this._depthMapCoordVaryings=new Array(this._mapper.numCascades);for(var n=0;n<this._mapper.numCascades;++n)this._depthMapCoordVaryings[n]=t.getFreeVarying(),this._cascadeProjections[n]=t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant(),t.getFreeVertexConstant();var o=t.getFreeVertexVectorTemp();for(n=0;n<this._mapper.numCascades;++n)i+="m44 "+o+", "+e.globalPositionVertex+", "+this._cascadeProjections[n]+"\nadd "+this._depthMapCoordVaryings[n]+", "+o+", "+r+".zzwz\n";return i},e.prototype._getFragmentCode=function(t,e,i){var r,n=this._mapper.numCascades,o=e.getFreeFragmentConstant(),s=e.getFreeFragmentConstant(),a=e.getFreeFragmentConstant(),l=Array(a+".x",a+".y",a+".z",a+".w");this._fragmentConstantsIndex=4*o.index;var h=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(h,1);var c=e.getFreeFragmentVectorTemp();e.addFragmentTempUsages(c,1),r="mov "+c+", "+this._depthMapCoordVaryings[n-1]+"\n";for(var u=n-2;u>=0;--u){var p=this._depthMapCoordVaryings[u];r+="slt "+h+".z, "+i.projectionFragment+".z, "+l[u]+"\n";var d=e.getFreeFragmentVectorTemp();r+="sub "+d+", "+p+", "+c+"\nmul "+d+", "+d+", "+h+".z\nadd "+c+", "+c+", "+d+"\n"}return e.removeFragmentTempUsage(h),r+="div "+c+", "+c+", "+c+".w\nmul "+c+".xy, "+c+".xy, "+s+".zw\nadd "+c+".xy, "+c+".xy, "+s+".zz\n",e.removeFragmentTempUsage(c),r},e.prototype._activate=function(){this._shader.vertexConstantData[this._vertexConstantsIndex+3]=-1/(this._mapper.depth*this._mapper.epsilon);for(var t=this._mapper.numCascades,e=0;e<t;++e)this._projectionMatrices[e].copyFrom(this._mapper.getDepthProjections(e),!0);var i=this._shader.fragmentConstantData,r=this._fragmentConstantsIndex;i[r+5]=1-this._mapper.alpha;var n=this._mapper._iNearPlaneDistances;r+=8;for(var o=0;o<t;++o)i[r+o]=n[o]},e.prototype._setRenderState=function(t,e){},e}(_Shader_DirectionalShadowMapper);ShaderBase.registerAbstraction(_Shader_CascadeShadowMapper,CascadeShadowMapper);var NearDirectionalShadowMapper=function(t){function e(e,i,r){void 0===e&&(e=null),void 0===i&&(i=.5),void 0===r&&(r=.1);var n=t.call(this,e)||this;return n.coverageRatio=i,n._fadeRatio=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coverageRatio",{get:function(){return this._coverageRatio},set:function(t){t>1?t=1:t<0&&(t=0),this._coverageRatio=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fadeRatio",{get:function(){return this._fadeRatio},set:function(t){this._fadeRatio=t},enumerable:!0,configurable:!0}),e.prototype._updateProjection=function(t){for(var e=t.viewFrustumCorners,i=0;i<12;++i){var r=e[i];this._localFrustum[i]=r,this._localFrustum[i+12]=r+(e[i+12]-r)*this._coverageRatio}this._updateProjectionFromFrustumCorners(t,this._localFrustum,this._matrix),this._overallDepthProjection.frustumMatrix3D=this._matrix},e.assetType="[asset NearDirectionalShadowMapper]",e}(DirectionalShadowMapper),_Shader_NearDirectionalShadowMapper=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initConstants=function(){t.prototype._initConstants.call(this);var e=this._shader.fragmentConstantData,i=this._fragmentDistanceIndex;e[i+2]=0,e[i+3]=1},e.prototype._initVO=function(e){t.prototype._initVO.call(this,e),e.needsProjection=!0},e.prototype._getFragmentCode=function(e,i,r){var n=t.prototype._getFragmentCode.call(this,e,i,r),o=i.getFreeFragmentConstant(),s=i.getFreeFragmentSingleTemp();return this._fragmentDistanceIndex=4*o.index,n+="abs "+s+", "+r.projectionFragment+".w\nsub "+s+", "+s+", "+o+".x\nmul "+s+", "+s+", "+o+".y\nsat "+s+", "+s+"\nsub "+s+", "+o+".w,"+s+"\nsub "+e+".w, "+o+".w,"+e+".w\nmul "+e+".w, "+e+".w, "+s+"\nsub "+e+".w, "+o+".w,"+e+".w\n"},e.prototype._setRenderState=function(e,i){var r=i.projection.near,n=i.projection.far-r,o=this._mapper.coverageRatio,s=o*(1-this._mapper.fadeRatio);o=r+o*n,s=r+s*n;var a=this._shader.fragmentConstantData,l=this._fragmentDistanceIndex;a[l]=s,a[l+1]=1/(o-s),t.prototype._setRenderState.call(this,e,i)},e}(_Shader_DirectionalShadowMapper);ShaderBase.registerAbstraction(_Shader_NearDirectionalShadowMapper,NearDirectionalShadowMapper);var DepthTexture2D=function(t){function e(e){return void 0===e&&(e=null),t.call(this,e)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[texture DepthTexture2D]",e}(ImageTexture2D);ShaderBase.registerAbstraction(_Shader_DepthTexture,DepthTexture2D);var VideoTexture=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[texture VideoTexture]",e}(ImageTexture2D),MaterialBase=function(t){function e(e,i){void 0===e&&(e=16777215),void 0===i&&(i=1);var r=t.call(this)||this;return r._textures=new Array,r._pUseColorTransform=!1,r._alphaBlending=!1,r._alpha=1,r._pAlphaThreshold=0,r._pAnimateUVs=!1,r._style=new Style,r._iBaseScreenPassIndex=0,r._bothSides=!1,r._pBlendMode=BlendMode.NORMAL,r._imageRect=!1,r._curves=!1,r._onInvalidatePropertiesDelegate=function(t){return r._onInvalidateProperties(t)},r._style.addEventListener(StyleEvent.INVALIDATE_PROPERTIES,r._onInvalidatePropertiesDelegate),e instanceof ImageBase?r._style.image=e:r._style.color=Number(e),r.alpha=i,r._onTextureInvalidateDelegate=function(t){return r.onTextureInvalidate(t)},r.alphaPremultiplied=!1,r}return __extends(e,t),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t>1?t=1:t<0&&(t=0),this._alpha!=t&&(this._alpha=t,null==this._colorTransform&&(this._colorTransform=new ColorTransform),this._colorTransform.alphaMultiplier=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTransform",{get:function(){return this._colorTransform},set:function(t){this._colorTransform=t,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlending",{get:function(){return this._alphaBlending},set:function(t){this._alphaBlending!=t&&(this._alphaBlending=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curves",{get:function(){return this._curves},set:function(t){this._curves!=t&&(this._curves=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageRect",{get:function(){return this._imageRect},set:function(t){this._imageRect!=t&&(this._imageRect=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){this._style!=t&&(this._style&&this._style.removeEventListener(StyleEvent.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate),this._style=t,this._style&&this._style.addEventListener(StyleEvent.INVALIDATE_PROPERTIES,this._onInvalidatePropertiesDelegate),this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animateUVs",{get:function(){return this._pAnimateUVs},set:function(t){this._pAnimateUVs!=t&&(this._pAnimateUVs=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useColorTransform",{get:function(){return this._pUseColorTransform},set:function(t){this._pUseColorTransform!=t&&(this._pUseColorTransform=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bothSides",{get:function(){return this._bothSides},set:function(t){(this._bothSides=t)||(this._bothSides=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._pBlendMode},set:function(t){this._pBlendMode!=t&&(this._pBlendMode=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaPremultiplied",{get:function(){return this._alphaPremultiplied},set:function(t){this._alphaPremultiplied!=t&&(this._alphaPremultiplied=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaThreshold",{get:function(){return this._pAlphaThreshold},set:function(t){t<0?t=0:t>1&&(t=1),this._pAlphaThreshold!=t&&(this._pAlphaThreshold=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),e.prototype.getNumTextures=function(){return this._textures.length},e.prototype.getTextureAt=function(t){return this._textures[t]},e.prototype.dispose=function(){this.clear()},e.prototype.invalidatePasses=function(){this.dispatchEvent(new MaterialEvent(MaterialEvent.INVALIDATE_PASSES,this))},e.prototype.invalidateTextures=function(){this.dispatchEvent(new MaterialEvent(MaterialEvent.INVALIDATE_TEXTURES,this))},e.prototype.addTextureAt=function(t,e){var i=this._textures.indexOf(t);i!=e&&(-1!=i&&this._textures.splice(i,1),this._textures.splice(e,0,t),t.addEventListener(AssetEvent.INVALIDATE,this._onTextureInvalidateDelegate),this.onTextureInvalidate())},e.prototype.addTexture=function(t){-1==this._textures.indexOf(t)&&(this._textures.push(t),t.addEventListener(AssetEvent.INVALIDATE,this._onTextureInvalidateDelegate),this.onTextureInvalidate())},e.prototype.removeTexture=function(t){this._textures.splice(this._textures.indexOf(t),1),t.removeEventListener(AssetEvent.INVALIDATE,this._onTextureInvalidateDelegate),this.onTextureInvalidate()},e.prototype.onTextureInvalidate=function(t){this.invalidatePasses(),this.invalidateTextures()},e.prototype._onInvalidateProperties=function(t){this.invalidatePasses(),this.invalidateTextures()},e}(AssetBase),_Render_MaterialPassBase=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"shader",{get:function(){return this._shader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedStreams",{get:function(){return this._shader.numUsedStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUsedTextures",{get:function(){return this._shader.numUsedTextures},enumerable:!0,configurable:!0}),e.prototype._includeDependencies=function(t){t.alphaThreshold=this._material.alphaThreshold,t.useImageRect=this._material.imageRect,t.usesCurves=this._material.curves,t.useAlphaPremultiplied=this._material.alphaPremultiplied,t.useBothSides=this._material.bothSides,t.usesUVTransform=this._material.animateUVs,t.usesColorTransform=this._material.useColorTransform},e.prototype.invalidate=function(){this._shader.invalidateProgram(),this.dispatchEvent(new PassEvent(PassEvent.INVALIDATE,this))},e.prototype.dispose=function(){this._shader&&(this._shader.dispose(),this._shader=null)},e.prototype._setRenderState=function(t,e){this._shader._setRenderState(t,e.projection)},e.prototype._activate=function(t){this._shader._activate(t.projection)},e.prototype._deactivate=function(){this._shader._deactivate()},e.prototype._initConstantData=function(){},e.prototype._getVertexCode=function(t,e){return""},e.prototype._getFragmentCode=function(t,e){return""},e.prototype._getPostAnimationFragmentCode=function(t,e){return""},e.prototype._getNormalVertexCode=function(t,e){return""},e.prototype._getNormalFragmentCode=function(t,e){return""},e}(_Render_MaterialBase),_Render_DepthMaterial=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shader=new ShaderBase(i,r,r,r._stage),r._pAddPass(r),r.invalidate(),r}return __extends(e,t),e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._shaderTexture=this._material.getTextureAt(0)?this._shader.getAbstraction(this._material.getTextureAt(0)):null},e.prototype._includeDependencies=function(e){t.prototype._includeDependencies.call(this,e),e.projectionDependencies++,e.alphaThreshold>0&&e.uvDependencies++},e.prototype._initConstantData=function(){var t=this._fragmentConstantsIndex,e=this._shader.fragmentConstantData;e[t]=1,e[t+1]=255,e[t+2]=65025,e[t+3]=16581375,e[t+4]=1/255,e[t+5]=1/255,e[t+6]=1/255,e[t+7]=0},e.prototype._getFragmentCode=function(t,e){var i="",r=e.shadedTarget,n=t.getFreeFragmentConstant(),o=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var s=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(s,1);var a=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(a,1),i+="div "+s+", "+e.projectionFragment+", "+e.projectionFragment+".w\nmul "+s+", "+n+", "+s+".z\nfrc "+s+", "+s+"\nmul "+a+", "+s+".yzww, "+o+"\n",this._shaderTexture&&this._shader.alphaThreshold>0){var l=t.getFreeFragmentVectorTemp();i+=this._shaderTexture._getFragmentCode(l,t,e,e.uvVarying),i+="sub "+l+".w, "+l+".w, "+t.getFreeFragmentConstant()+".x\nkil "+l+".w\n"}return i+="sub "+r+", "+s+", "+a+"\n",t.removeFragmentTempUsage(s),t.removeFragmentTempUsage(a),i},e.prototype._activate=function(e){t.prototype._activate.call(this,e),this._shaderTexture&&this._shader.alphaThreshold>0&&(this._shaderTexture.activate(),this._shader.fragmentConstantData[this._fragmentConstantsIndex+8]=this._shader.alphaThreshold)},e}(_Render_MaterialPassBase),_Render_DistanceMaterial=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._shader=new ShaderBase(i,r,r,r._stage),r._pAddPass(r),r.invalidate(),r}return __extends(e,t),e.prototype.invalidate=function(){t.prototype.invalidate.call(this),this._shaderTexture=this._material.getTextureAt(0)?this._shader.getAbstraction(this._material.getTextureAt(0)):null},e.prototype._initConstantData=function(){var t=this._fragmentConstantsIndex,e=this._shader.fragmentConstantData;e[t+4]=1/255,e[t+5]=1/255,e[t+6]=1/255,e[t+7]=0},e.prototype._includeDependencies=function(e){t.prototype._includeDependencies.call(this,e),e.projectionDependencies++,e.viewDirDependencies++,e.alphaThreshold>0&&e.uvDependencies++,e.viewDirDependencies>0&&e.globalPosDependencies++},e.prototype._getFragmentCode=function(t,e){var i,r=e.shadedTarget,n=t.getFreeFragmentConstant(),o=t.getFreeFragmentConstant();this._fragmentConstantsIndex=4*n.index;var s=t.getFreeFragmentVectorTemp();t.addFragmentTempUsages(s,1);var a=t.getFreeFragmentVectorTemp();if(t.addFragmentTempUsages(a,1),i="dp3 "+s+".z, "+e.viewDirVarying+".xyz, "+e.viewDirVarying+".xyz\nmul "+s+", "+n+", "+s+".z\nfrc "+s+", "+s+"\nmul "+a+", "+s+".yzww, "+o+"\n",this._shaderTexture&&this._shader.alphaThreshold>0){var l=t.getFreeFragmentVectorTemp();i+=this._shaderTexture._getFragmentCode(l,t,e,e.uvVarying),i+="sub "+l+".w, "+l+".w, "+t.getFreeFragmentConstant()+".x\nkil "+l+".w\n"}return i+="sub "+r+", "+s+", "+a+"\n"},e.prototype._activate=function(e){t.prototype._activate.call(this,e);var i=e.projection.far;i=1/(2*i*i);var r=this._fragmentConstantsIndex,n=this._shader.fragmentConstantData;n[r]=1*i,n[r+1]=255*i,n[r+2]=65025*i,n[r+3]=16581375*i,this._shaderTexture&&this._shader.alphaThreshold>0&&(this._shaderTexture.activate(),n[r+8]=this._shader.alphaThreshold)},e}(_Render_MaterialPassBase),BasicMaterial=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=1);var r=t.call(this,e,i)||this;return r._preserveAlpha=!1,e instanceof ImageBase&&(r.texture=new ImageTexture2D),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){this._preserveAlpha!=t&&(this._preserveAlpha=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.removeTexture(this._texture),this._texture=t,this._texture&&this.addTexture(this._texture))},enumerable:!0,configurable:!0}),e.assetType="[materials BasicMaterial]",e}(MaterialBase),_Render_BasicMaterial=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._basicMaterial=e,r._pAddPass(r._pass=new BasicMaterialPass(r,i)),r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._basicMaterial=null},e.prototype._pUpdateRender=function(){t.prototype._pUpdateRender.call(this),this.requiresBlending=this._basicMaterial.blendMode!=BlendMode.NORMAL||this._basicMaterial.alphaBlending||this._basicMaterial.colorTransform&&this._basicMaterial.colorTransform.alphaMultiplier<1,this._pass.preserveAlpha=this._basicMaterial.preserveAlpha,this._pass.shader.setBlendMode(this._basicMaterial.blendMode==BlendMode.NORMAL&&this.requiresBlending?BlendMode.LAYER:this._basicMaterial.blendMode)},e}(_Render_MaterialBase);RenderGroup.registerDefaultMaterial(_Render_BasicMaterial,BasicMaterial),RenderGroup.registerDepthMaterial(_Render_DepthMaterial,BasicMaterial),RenderGroup.registerDistanceMaterial(_Render_DistanceMaterial,BasicMaterial),MaterialUtils.setDefaultMaterialClass(BasicMaterial);var MethodMaterialMode=function(){function t(){}return t.SINGLE_PASS="singlePass",t.MULTI_PASS="multiPass",t}(),MethodMaterial=function(t){function e(e,i){void 0===e&&(e=16777215),void 0===i&&(i=1);var r=t.call(this,e,i)||this;return r._effectMethods=new Array,r._enableLightFallOff=!0,r._specularLightSources=1,r._diffuseLightSources=3,r._ambientMethod=new AmbientBasicMethod,r._diffuseMethod=new DiffuseBasicMethod,r._normalMethod=new NormalBasicMethod,r._specularMethod=new SpecularBasicMethod,r._depthCompareMode=ContextGLCompareMode.LESS_EQUAL,r._mode=MethodMaterialMode.SINGLE_PASS,r._ambientMethod.iAddOwner(r),r._diffuseMethod.iAddOwner(r),r._normalMethod.iAddOwner(r),r._specularMethod.iAddOwner(r),r._onLightChangeDelegate=function(t){return r.onLightsChange(t)},e instanceof ImageBase&&(r._ambientMethod.texture=new ImageTexture2D),r}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightPicker",{get:function(){return this._pLightPicker},set:function(t){this._pLightPicker!=t&&(this._pLightPicker&&this._pLightPicker.removeEventListener(AssetEvent.INVALIDATE,this._onLightChangeDelegate),this._pLightPicker=t,this._pLightPicker&&this._pLightPicker.addEventListener(AssetEvent.INVALIDATE,this._onLightChangeDelegate),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableLightFallOff",{get:function(){return this._enableLightFallOff},set:function(t){this._enableLightFallOff!=t&&(this._enableLightFallOff=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseLightSources",{get:function(){return this._diffuseLightSources},set:function(t){this._diffuseLightSources!=t&&(this._diffuseLightSources=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularLightSources",{get:function(){return this._specularLightSources},set:function(t){this._specularLightSources!=t&&(this._specularLightSources=t,this.invalidatePasses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode!=t&&(this._mode=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthCompareMode",{get:function(){return this._depthCompareMode},set:function(t){this._depthCompareMode!=t&&(this._depthCompareMode=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ambientMethod",{get:function(){return this._ambientMethod},set:function(t){this._ambientMethod!=t&&(this._ambientMethod&&this._ambientMethod.iRemoveOwner(this),this._ambientMethod=t,this._ambientMethod&&this._ambientMethod.iAddOwner(this),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowMethod",{get:function(){return this._shadowMethod},set:function(t){this._shadowMethod!=t&&(this._shadowMethod&&this._shadowMethod.iRemoveOwner(this),this._shadowMethod=t,this._shadowMethod&&this._shadowMethod.iAddOwner(this),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseMethod",{get:function(){return this._diffuseMethod},set:function(t){this._diffuseMethod!=t&&(this._diffuseMethod&&this._diffuseMethod.iRemoveOwner(this),this._diffuseMethod=t,this._diffuseMethod&&this._diffuseMethod.iAddOwner(this),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularMethod",{get:function(){return this._specularMethod},set:function(t){this._specularMethod!=t&&(this._specularMethod&&this._specularMethod.iRemoveOwner(this),this._specularMethod=t,this._specularMethod&&this._specularMethod.iAddOwner(this),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalMethod",{get:function(){return this._normalMethod},set:function(t){this._normalMethod!=t&&(this._normalMethod&&this._normalMethod.iRemoveOwner(this),this._normalMethod=t,this._normalMethod&&this._normalMethod.iAddOwner(this),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numEffectMethods",{get:function(){return this._effectMethods.length},enumerable:!0,configurable:!0}),e.prototype.addEffectMethod=function(t){t.iAddOwner(this),this._effectMethods.push(t),this.invalidate()},e.prototype.getEffectMethodAt=function(t){return this._effectMethods[t]},e.prototype.addEffectMethodAt=function(t,e){t.iAddOwner(this),this._effectMethods.splice(e,0,t),this.invalidate()},e.prototype.removeEffectMethod=function(t){t.iRemoveOwner(this),this._effectMethods.splice(this._effectMethods.indexOf(t),1),this.invalidate()},e.prototype.onLightsChange=function(t){this.invalidate()},e.assetType="[materials MethodMaterial]",e}(MaterialBase),_Render_MethodMaterial=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._methodMaterial=e,r._renderElements=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"numLights",{get:function(){return this._methodMaterial.lightPicker?this._methodMaterial.lightPicker.numLightProbes+this._methodMaterial.lightPicker.numDirectionalLights+this._methodMaterial.lightPicker.numPointLights+this._methodMaterial.lightPicker.numCastingDirectionalLights+this._methodMaterial.lightPicker.numCastingPointLights:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numNonCasters",{get:function(){return this._methodMaterial.lightPicker?this._methodMaterial.lightPicker.numLightProbes+this._methodMaterial.lightPicker.numDirectionalLights+this._methodMaterial.lightPicker.numPointLights:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lightPicker",{get:function(){return this._methodMaterial.lightPicker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableLightFallOff",{get:function(){return this._methodMaterial.enableLightFallOff},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"diffuseLightSources",{get:function(){return this._methodMaterial.diffuseLightSources},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specularLightSources",{get:function(){return this._methodMaterial.specularLightSources},enumerable:!0,configurable:!0}),e.prototype._pUpdateRender=function(){if(t.prototype._pUpdateRender.call(this),this.initPasses(),this.setBlendAndCompareModes(),this._pClearPasses(),this._methodMaterial.mode==MethodMaterialMode.MULTI_PASS&&(this._casterLightPass&&this._pAddPass(this._casterLightPass),this._nonCasterLightPasses))for(var e=0;e<this._nonCasterLightPasses.length;++e)this._pAddPass(this._nonCasterLightPasses[e]);this._pass&&this._pAddPass(this._pass)},e.prototype.initPasses=function(){0==this.numLights||this._methodMaterial.numEffectMethods>0||this._methodMaterial.mode==MethodMaterialMode.SINGLE_PASS?this.initEffectPass():this._pass&&this.removeEffectPass(),this._methodMaterial.shadowMethod&&this._methodMaterial.mode==MethodMaterialMode.MULTI_PASS?this.initCasterLightPass():this._casterLightPass&&this.removeCasterLightPass(),this.numNonCasters>0&&this._methodMaterial.mode==MethodMaterialMode.MULTI_PASS?this.initNonCasterLightPasses():this._nonCasterLightPasses&&this.removeNonCasterLightPasses()},e.prototype.setBlendAndCompareModes=function(){var t=Boolean(this._casterLightPass||this._pass);if(this._casterLightPass&&(this._casterLightPass.forceSeparateMVP=t,this._casterLightPass.shader.setBlendMode(BlendMode.NORMAL),this._casterLightPass.shader.depthCompareMode=this._methodMaterial.depthCompareMode),this._nonCasterLightPasses){var e=0;this._casterLightPass||(this._nonCasterLightPasses[0].forceSeparateMVP=t,this._nonCasterLightPasses[0].shader.setBlendMode(BlendMode.NORMAL),this._nonCasterLightPasses[0].shader.depthCompareMode=this._methodMaterial.depthCompareMode,e=1);for(var i=e;i<this._nonCasterLightPasses.length;++i)this._nonCasterLightPasses[i].forceSeparateMVP=t,this._nonCasterLightPasses[i].shader.setBlendMode(BlendMode.ADD),this._nonCasterLightPasses[i].shader.depthCompareMode=ContextGLCompareMode.LESS_EQUAL}this._casterLightPass||this._nonCasterLightPasses?(this.requiresBlending=!1,this._pass&&(this._pass.mode=MethodPassMode.EFFECTS,this._pass.forceSeparateMVP=t,this._pass.shader.depthCompareMode=ContextGLCompareMode.LESS_EQUAL,this._pass.shader.setBlendMode(BlendMode.LAYER))):this._pass&&(this.requiresBlending=this._methodMaterial.blendMode!=BlendMode.NORMAL||this._methodMaterial.alphaBlending||this._methodMaterial.colorTransform&&this._methodMaterial.colorTransform.alphaMultiplier<1,this._pass.mode=MethodPassMode.SUPER_SHADER,this._pass.preserveAlpha=this.requiresBlending,this._pass.forceSeparateMVP=!1,this._pass.colorTransform=this._methodMaterial.colorTransform,this._pass.shader.setBlendMode(this._methodMaterial.blendMode==BlendMode.NORMAL&&this.requiresBlending?BlendMode.LAYER:this._methodMaterial.blendMode),this._pass.shader.depthCompareMode=this._methodMaterial.depthCompareMode)},e.prototype.initCasterLightPass=function(){null==this._casterLightPass&&(this._casterLightPass=new MethodPass(MethodPassMode.LIGHTING,this,this._renderElements)),this._casterLightPass.lightPicker=new StaticLightPicker([this._methodMaterial.shadowMethod.castingLight]),this._casterLightPass.shadowMethod=this._methodMaterial.shadowMethod,this._casterLightPass.diffuseMethod=this._methodMaterial.diffuseMethod,this._casterLightPass.ambientMethod=this._methodMaterial.ambientMethod,this._casterLightPass.normalMethod=this._methodMaterial.normalMethod,this._casterLightPass.specularMethod=this._methodMaterial.specularMethod},e.prototype.removeCasterLightPass=function(){this._casterLightPass.dispose(),this._pRemovePass(this._casterLightPass),this._casterLightPass=null},e.prototype.initNonCasterLightPasses=function(){var t;this.removeNonCasterLightPasses();var e=this._methodMaterial.lightPicker.numDirectionalLights,i=this._methodMaterial.lightPicker.numPointLights,r=this._methodMaterial.lightPicker.numLightProbes,n=0,o=0,s=0;for(this._casterLightPass||(e+=this._methodMaterial.lightPicker.numCastingDirectionalLights,i+=this._methodMaterial.lightPicker.numCastingPointLights),this._nonCasterLightPasses=new Array;n<e||o<i||s<r;)(t=new MethodPass(MethodPassMode.LIGHTING,this,this._renderElements)).includeCasters=null==this._methodMaterial.shadowMethod,t.directionalLightsOffset=n,t.pointLightsOffset=o,t.lightProbesOffset=s,t.lightPicker=this._methodMaterial.lightPicker,t.diffuseMethod=this._methodMaterial.diffuseMethod,t.ambientMethod=this._methodMaterial.ambientMethod,t.normalMethod=this._methodMaterial.normalMethod,t.specularMethod=this._methodMaterial.specularMethod,this._nonCasterLightPasses.push(t),n+=t.numDirectionalLights,o+=t.numPointLights,s+=t.numLightProbes},e.prototype.removeNonCasterLightPasses=function(){if(this._nonCasterLightPasses){for(var t=0;t<this._nonCasterLightPasses.length;++t)this._pRemovePass(this._nonCasterLightPasses[t]);this._nonCasterLightPasses=null}},e.prototype.removeEffectPass=function(){this._pass.ambientMethod!=this._methodMaterial.ambientMethod&&this._pass.ambientMethod.dispose(),this._pass.diffuseMethod!=this._methodMaterial.diffuseMethod&&this._pass.diffuseMethod.dispose(),this._pass.specularMethod!=this._methodMaterial.specularMethod&&this._pass.specularMethod.dispose(),this._pass.normalMethod!=this._methodMaterial.normalMethod&&this._pass.normalMethod.dispose(),this._pRemovePass(this._pass),this._pass=null},e.prototype.initEffectPass=function(){null==this._pass&&(this._pass=new MethodPass(MethodPassMode.SUPER_SHADER,this,this._renderElements)),this._methodMaterial.mode==MethodMaterialMode.SINGLE_PASS?(this._pass.ambientMethod=this._methodMaterial.ambientMethod,this._pass.diffuseMethod=this._methodMaterial.diffuseMethod,this._pass.specularMethod=this._methodMaterial.specularMethod,this._pass.normalMethod=this._methodMaterial.normalMethod,this._pass.shadowMethod=this._methodMaterial.shadowMethod):this._methodMaterial.mode==MethodMaterialMode.MULTI_PASS&&(0==this.numLights?this._pass.ambientMethod=this._methodMaterial.ambientMethod:this._pass.ambientMethod=null,this._pass.preserveAlpha=!1,this._pass.normalMethod=this._methodMaterial.normalMethod);for(var t,e=0,i=Math.max(this._methodMaterial.numEffectMethods,this._pass.numEffectMethods);e<i;)(t=this._methodMaterial.getEffectMethodAt(e))!=this._pass.getEffectMethodAt(e)&&(this._pass.removeEffectMethodAt(e),null!=t&&(e<this._pass.numEffectMethods?this._pass.addEffectMethodAt(t,e):this._pass.addEffectMethod(t))),e++},e.prototype.onClear=function(e){t.prototype.onClear.call(this,e)},e}(_Render_MaterialBase);RenderGroup.registerDefaultMaterial(_Render_MethodMaterial,MethodMaterial),RenderGroup.registerDepthMaterial(_Render_DepthMaterial,MethodMaterial),RenderGroup.registerDistanceMaterial(_Render_DistanceMaterial,MethodMaterial),console.debug("AwayJS - Materials - 0.5.6");var TesselatedFontChar=function(){function t(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),this.fnt_channel=0,this.kerningCharCodes=[],this.kerningValues=[],this.fill_data=t,this.stroke_data=e,this.fill_data_path=i}return t.prototype.dispose=function(){this.stroke_data&&(this.stroke_data=null),this.fill_data&&(this.fill_data=null),this.fill_data_path&&(this.fill_data_path=null)},t}(),BitmapFontChar=function(t,e,i,r,n,o,s,a,l,h){this.id=t,this.x=e,this.y=i,this.width=r,this.height=n,this.x_offset=o,this.y_offset=s,this.x_advance=a,this.page=l,this.channel=h},BitmapFontTable=function(t){function e(){var e=t.call(this)||this;return e._font_chars=[],e._materials=[],e._font_chars_dic=new Object,e._ascent=0,e._descent=0,e._current_size=0,e._size_multiply=0,e._init_size=0,e._texture_width=0,e._texture_height=0,e._adjust_size=0,e}return __extends(e,t),e.prototype.getGlyphCount=function(){return this._font_chars.length},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.initFontSize=function(t){this.fallbackTable&&this.fallbackTable.initFontSize(t),this._adjust_size&&(t*=this._adjust_size),this._current_size!=t&&(this._current_size=t,this._size_multiply=t/this._init_size)},e.prototype.getCharDataCanvas=function(t){var e=this._font_chars_dic[t];return e?[e.x,e.y,e.width,e.height,e.x_offset*this._size_multiply,e.y_offset*this._size_multiply]:[]},e.prototype.getCharData=function(t){var e=this._font_chars_dic[t];if(e){var i=e.height/this._init_size*this._current_size,r=e.width/this._init_size*this._current_size;return[e.x/this._texture_width,e.y/this._texture_height,e.width/this._texture_width,e.height/this._texture_height,e.x_offset*this._size_multiply,e.y_offset*this._size_multiply,i,r]}return[]},e.prototype.getCharVertCnt=function(t){return 24},Object.defineProperty(e.prototype,"texture_width",{get:function(){return this._texture_width},set:function(t){this._texture_width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture_height",{get:function(){return this._texture_height},set:function(t){this._texture_height=t},enumerable:!0,configurable:!0}),e.prototype.hasChar=function(t){return null!=this._font_chars_dic[t]},e.prototype.getCharWidth=function(t){var e=this._font_chars_dic[t];return e?this._size_multiply*e.x_advance:0},e.prototype.fillTextRun=function(t,e,i,r){},e.prototype.getLineHeight=function(){return this._current_size},e.prototype.dispose=function(){for(var t=this._materials.length,e=0;e<t;++e)this._materials[e].dispose();this._materials.length=0,this._font_chars.length=0,this._font_chars_dic=null},e.prototype.addMaterial=function(t){this._materials.push(t)},e.prototype.getMaterial=function(t){return void 0===t&&(t=0),this._materials[t]},Object.defineProperty(e.prototype,"ascent",{get:function(){return this._ascent},set:function(t){this._ascent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._descent},set:function(t){this._descent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset_x",{get:function(){return this._offset_x},set:function(t){this._offset_x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset_y",{get:function(){return this._offset_y},set:function(t){this._offset_y=t},enumerable:!0,configurable:!0}),e.prototype.get_font_chars=function(){return this._font_chars},e.prototype.get_font_em_size=function(){return this._font_em_size},e.prototype.set_whitespace_width=function(t){this._whitespace_width=t},e.prototype.get_whitespace_width=function(){return this._whitespace_width},e.prototype.set_font_em_size=function(t){this._font_em_size=t},e.prototype.getChar=function(t){return this._font_chars_dic[t]},e.prototype.setChar=function(t,e,i,r,n,o,s,a,l,h){var c=new BitmapFontChar(t,e,i,r,n,o,s,a,l,h);this._font_chars.push(c),this._font_chars_dic[t]=c},e.assetType="[asset BitmapFontTable]",e}(AssetBase),Font=function(t){function e(){var e=t.call(this)||this;return e._font_styles=[],e.fontName=null,e.regularFontStyle=null,e}return __extends(e,t),e.registerFont=function(t){},Object.defineProperty(e.prototype,"font_styles",{get:function(){return this._font_styles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var t=this._font_styles.length,e=0;e<t;++e)this._font_styles[e].dispose();this._font_styles.length=0},e.prototype.replace_font_table=function(t,e){for(var i=this._font_styles.length,r=0;r<i;++r)this._font_styles[r].name==t&&(this._font_styles[r]=e)},e.prototype.get_font_table=function(t,e,i,r){void 0===e&&(e=TesselatedFontTable.assetType),void 0===i&&(i=null),void 0===r&&(r=!0);for(var n=this._font_styles.length,o=0;o<n;++o)if(this._font_styles[o].assetType==e&&this._font_styles[o].name==t)return this._font_styles[o];if(!r)return null;var s=null;return e==TesselatedFontTable.assetType?s=new TesselatedFontTable(i):e==BitmapFontTable.assetType&&(s=new BitmapFontTable),s.name=t,s.font=this,this._font_styles.push(s),s},e.assetType="[asset Font]",e}(AssetBase),DefaultFontManager=function(){function t(){}return t.getDefaultFont=function(){return null==t._default_font&&t.setDefaultFont(),t._default_font},t.applySharedFonts=function(e){if(e!=t.shared_fonts_ns){t._registered_fonts[e]||(t._registered_fonts[e]={}),t._registered_fonts[t.shared_fonts_ns]||(t._registered_fonts[t.shared_fonts_ns]={}),t._default_font||t._registered_fonts[t.shared_fonts_ns].arial&&(t._default_font=t._registered_fonts[t.shared_fonts_ns].arial);var i=t._registered_fonts[t.shared_fonts_ns];for(var r in i){if(t._registered_fonts[e][r])for(var n=t._registered_fonts[t.shared_fonts_ns][r].font_styles.length,o=0;o<n;o++){var s=t._registered_fonts[t.shared_fonts_ns][r].font_styles[o],a=t._registered_fonts[e][r].get_font_table(s.name,TesselatedFontTable.assetType,null,!1);a?0==a.getGlyphCount()&&t._registered_fonts[e][r].replace_font_table(s.name,s):t._registered_fonts[e][r].font_styles.push(s)}else t._registered_fonts[e][r]=i[r];t._registered_fonts[e][r].font&&(t._registered_fonts[e][r]=i[r])}}},t.getFont=function(e,i){if(void 0===i&&(i=AssetBase.DEFAULT_NAMESPACE),!e)return t.getDefaultFont();if(e=e.toString().toLowerCase(),t._registered_fonts[i]||(t._registered_fonts[i]={}),i==AssetBase.DEFAULT_NAMESPACE){if(t._registered_fonts[t.shared_fonts_ns]||(t._registered_fonts[t.shared_fonts_ns]={}),t._registered_fonts[t.shared_fonts_ns][e])return t._registered_fonts[t.shared_fonts_ns][e];for(var r in t._registered_fonts)if(t._registered_fonts[r][e])return t._registered_fonts[r][e]}if(t._registered_fonts[i][e])return t._registered_fonts[i][e];var n=new Font;return n.name=e,t._registered_fonts[i][e]=n,n},t.setDefaultFont=function(e){void 0===e&&(e=null),e||(e=new Font),t._default_font=e},t.clearAll=function(){t._default_font=null,t._registered_fonts={},t.shared_fonts_ns=null},t._registered_fonts={},t.deviceFont=null,t}(),TesselatedFontTable=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;if(i._fntSizeLimit=-1,i._font_chars=[],i._font_chars_dic=new Object,i._current_size=0,i._size_multiply=0,i._ascent=0,i._descent=0,i._usesCurves=!1,i._glyphIdxToChar={},i._whitespace_width=0,i._fnt_channels=[],i.vertical_glyph_offset=0,e){i._opentype_font=e,i._font_em_size=72,i._ascent=e.tables.hhea.ascender/(i._opentype_font.unitsPerEm/72),i._descent=e.tables.hhea.descender/(i._opentype_font.unitsPerEm/72)-2,i._current_size=0,i._size_multiply=0;var r=i._opentype_font.charToGlyph(String.fromCharCode(32));return r&&(i._whitespace_width=r.advanceWidth/(i._opentype_font.unitsPerEm/72)),i}return i}return __extends(e,t),Object.defineProperty(e.prototype,"fallbackTable",{get:function(){return DefaultFontManager.deviceFont&&DefaultFontManager.deviceFont.font_styles[0]!=this?DefaultFontManager.deviceFont.font_styles[0]:null},enumerable:!0,configurable:!0}),e.prototype.addFNTChannel=function(t){this._fnt_channels.push(t)},e.prototype.getGlyphCount=function(){return this._font_chars.length},e.prototype._drawDebugRect=function(t,e,i,r,n){t[t.length]=e,t[t.length]=r,t[t.length]=e+1,t[t.length]=n,t[t.length]=e,t[t.length]=n,t[t.length]=e,t[t.length]=r,t[t.length]=e+1,t[t.length]=r,t[t.length]=e+1,t[t.length]=n,t[t.length]=i,t[t.length]=r,t[t.length]=i-1,t[t.length]=n,t[t.length]=i,t[t.length]=n,t[t.length]=i,t[t.length]=r,t[t.length]=i-1,t[t.length]=r,t[t.length]=i-1,t[t.length]=n,t[t.length]=e+1,t[t.length]=r,t[t.length]=e+1,t[t.length]=r+1,t[t.length]=i-1,t[t.length]=r,t[t.length]=e+1,t[t.length]=r+1,t[t.length]=i-1,t[t.length]=r+1,t[t.length]=i-1,t[t.length]=r,t[t.length]=e+1,t[t.length]=n,t[t.length]=e+1,t[t.length]=n-1,t[t.length]=i-1,t[t.length]=n,t[t.length]=e+1,t[t.length]=n-1,t[t.length]=i-1,t[t.length]=n-1,t[t.length]=i-1,t[t.length]=n},e.prototype.generateFNTTextures=function(t,e,i){if(console.log("generateFNTTextures"),e&&(this._fntSizeLimit=.5*e,this.initFontSize(e)),this._opentype_font)for(var r=0;r<this._opentype_font.glyphs.length;r++){var n=this._opentype_font.charToGlyph(String.fromCharCode(this._opentype_font.glyphs.glyphs[r].unicode));if(n){var o=n.getPath(),s=new GraphicsPath,a=0,l=o.commands.length,h=0,c=0,u=this._ascent;for(a=0;a<l;a++){var p=o.commands[a];"M"===p.type?(s.moveTo(p.x,p.y+u),h=p.x,c=p.y+u):"L"===p.type?s.lineTo(p.x,p.y+u):"Q"===p.type?s.curveTo(p.x1,p.y1+u,p.x,p.y+u):"C"===p.type?s.cubicCurveTo(p.x1,p.y1+u,p.x2,p.y2+u,p.x,p.y+u):"Z"===p.type&&s.lineTo(h,c)}var d=new TesselatedFontChar(null,null,s);d.char_width=n.advanceWidth*(1/n.path.unitsPerEm*72),d.fill_data=GraphicsFactoryFills.pathToAttributesBuffer(s,!0),d.fill_data?(this._font_chars.push(d),this._font_chars_dic[this._opentype_font.glyphs.glyphs[r].unicode]=d):console.log("error tesselating opentype glyph",this._opentype_font.glyphs.glyphs[r])}else console.log("no char found for",this._opentype_font.glyphs.glyphs[r])}var f,_,g,m,y=0,v=0,b=[[]],x=0,A=[],E=Number.MIN_VALUE,S=Number.MIN_VALUE,T=Number.MAX_VALUE,P=Number.MAX_VALUE,C=0,w=0,D=0;for(a=0;a<this._font_chars.length;a++){for(f=this._font_chars[a].fill_data,_=new Float32Array(f.buffer),E=Number.MIN_VALUE,S=Number.MIN_VALUE,T=Number.MAX_VALUE,P=Number.MAX_VALUE,C=0,w=0,g=0;g<f.count;g++)(C=_[2*g])<P&&(P=C),C>S&&(S=C),(w=_[2*g+1])<T&&(T=w),w>E&&(E=w);this._font_chars[a].fnt_rect=new Rectangle(P/this._font_chars[a].char_width,T/this._font_em_size,(S-P)/this._font_chars[a].char_width,(E-T)/this._font_em_size),D+=(S-P+t+t)*(E-T+t+t),A[A.length]={idx:a,minx:P,miny:T,width:S-P,height:E-T}}A.sort((function(t,e){return t.height>e.height?-1:1}));var M=0;m=i;var O,I=1;if(e)this.initFontSize(e),I=this._size_multiply;else{I=m/Math.sqrt(D)*1.2;for(var L=!0,N=0;L;){L=!1,y=0,v=t;for(a=0;a<A.length;a++){if(N=A[a].height*I,C=0,w=0,(y+=t)+A[a].width*I+t>=m&&(y=t,v+=M+2*t,M=0),N>M&&(M=N),v+N+2*t>=m){L=!0,I*=.995;break}y+=A[a].width*I+t}}}this._fntSizeLimit=I*this._font_em_size*.5,y=0,v=t;for(a=0;a<A.length;a++){for(f=(O=this._font_chars[A[a].idx]).fill_data,_=new Float32Array(f.buffer),P=A[a].minx,S=Number.MIN_VALUE,T=A[a].miny,E=Number.MIN_VALUE,C=0,w=0,(y+=t)+A[a].width*I+t>=m&&(y=t,v+=M+2*t,M=0),A[a].height*=I,A[a].height>M&&(M=A[a].height),v+M+2*t>=m&&(y=t,v=t,M=0,b[++x]=[]),O.fnt_channel=x,g=0;g<f.count;g++)C=(_[2*g]-P)*I+y,w=(_[2*g+1]-T)*I+v,b[x][b[x].length]=C,b[x][b[x].length]=w,C>S&&(S=C),w>E&&(E=w);O.fnt_uv=new Rectangle(y/m,1-v/m,(S-y)/m,(E-v)/m),y+=A[a].width*I+t}var F=[];for(a=0;a<b.length;a++){var R=new AttributesView(Float32Array,2);R.set(b[a]);var B=R.attributesBuffer.cloneBufferView();R.dispose();var V=new TriangleElements(B);V.setPositions(new Float2Attributes(B));var k=Shape.getShape(V),U=new ImageSampler;k.style=new Style;var j=Graphics.get_material_for_color(16777215,1);k.material=j.material,j.colorPos&&(k.style.addSamplerAt(U,k.material.getTextureAt(0)),k.material.animateUVs=!0,k.style.uvMatrix=new Matrix(0,0,0,0,j.colorPos.x,j.colorPos.y)),F[a]=k}return F},e.prototype.getRatio=function(t){return this._size_multiply},e.prototype.hasChar=function(t){if(null==this._font_chars_dic[name]&&(this._opentype_font&&this._opentype_font.charToGlyph(String.fromCharCode(parseInt(name)))))return!0;return null!=this._font_chars_dic[t]},e.prototype.changeOpenTypeFont=function(t,e){void 0===e&&(e=!0),e&&this._opentype_font,this._opentype_font=t},e.prototype.initFontSize=function(t){this.fallbackTable&&this.fallbackTable.initFontSize(t),this._current_size!=t&&(this._current_size=t,this._size_multiply=t/this._font_em_size)},e.prototype.getCharVertCnt=function(t){var e=this._font_chars_dic[t];return e?e.fill_data.length:0},e.prototype.getCharWidth=function(t){if("32"==t)return Math.floor(this._whitespace_width*this._size_multiply*20)/20;if("9"==t)return Math.floor(this._whitespace_width*this._size_multiply*8*20)/20;var e=this.getChar(t);return e?Math.floor(e.char_width*this._size_multiply*20)/20:"9679"==t?(e=this.createPointGlyph_9679(),Math.floor(e.char_width*this._size_multiply*20)/20):this.fallbackTable?this.fallbackTable.getCharWidth(t):0},Object.defineProperty(e.prototype,"usesCurves",{get:function(){return this._usesCurves},enumerable:!0,configurable:!0}),e.prototype.getLineHeight=function(){return this._size_multiply*(this._ascent-this.descent)},e.prototype.getUnderLineHeight=function(){return this._size_multiply*(this._ascent-this.descent/2)},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var t=0;t<this._font_chars.length;t++)this._font_chars[t].dispose();this._font_chars.length=0,this._font_chars_dic=null},Object.defineProperty(e.prototype,"fntSizeLimit",{get:function(){return this._fntSizeLimit},set:function(t){this._fntSizeLimit=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this._ascent},set:function(t){this._ascent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._descent},set:function(t){this._descent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset_x",{get:function(){return this._offset_x},set:function(t){this._offset_x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset_y",{get:function(){return this._offset_y},set:function(t){this._offset_y=t},enumerable:!0,configurable:!0}),e.prototype.get_font_chars=function(){return this._font_chars},e.prototype.get_font_em_size=function(){return this._font_em_size},e.prototype.set_whitespace_width=function(t){this._whitespace_width=t},e.prototype.get_whitespace_width=function(){return this._whitespace_width},e.prototype.set_font_em_size=function(t){this._font_em_size=t},e.prototype.buildTextLineFromIndices=function(t,e,i,r,n,o){var s,a,l,h,c,u=t.getTextShapeForIdentifierAndFormat(e.color.toString(),e),p=i;r-=this._ascent*this._size_multiply;var d=0,f=0,_=n.length;if(null==this._glyphIdxToChar[t.fileurl])return console.log("no glyphIdx-map for textfield",t.adaptee.assetNamespace),new Point(0,0);for(f=0;f<_;f++){if(d=n[f],s=this._glyphIdxToChar[t.fileurl][d],c=this._size_multiply,s){if(null==s.fill_data&&(1==s.fill_data_path.commands[0][0]&&0==s.fill_data_path.data[0][0]&&0==s.fill_data_path.data[0][1]&&(s.fill_data_path.data[0].shift(),s.fill_data_path.data[0].shift(),s.fill_data_path.commands[0].shift(),s.fill_data_path.commands[0][0]=2),s.fill_data=GraphicsFactoryFills.pathToAttributesBuffer(s.fill_data_path,!0)),a=s.fill_data)if(l=new Float32Array(a.buffer),this.usesCurves)for(h=0;h<a.count;h++)u.verts[u.verts.length]=l[3*h]*c+i,u.verts[u.verts.length]=l[3*h+1]*c+r,u.verts[u.verts.length]=l[3*h+2];else for(h=0;h<a.count;h++)u.verts[u.verts.length]=l[2*h]*c+i,u.verts[u.verts.length]=l[2*h+1]*c+r}else;i+=o[f]}return new Point(i-p,this.getLineHeight())},e.prototype.fillTextRun=function(t,e,i,r){var n=this._fntSizeLimit>=0&&(0==this._fntSizeLimit||this._fntSizeLimit>=e.size),o=t.getTextShapeForIdentifierAndFormat(e.color.toString()+n.toString()+"0",e),s={},a={},l=ColorUtils.float32ColorToARGB(e.color);(M=new MethodMaterial(this._fnt_channels[0])).colorTransform=new ColorTransform(l[1]/255,l[2]/255,l[3]/255),M.bothSides=!0,M.alphaBlending=!0,M.alphaPremultiplied=!0,M.useColorTransform=!0,M.style.sampler=new ImageSampler(!1,!0,!0),o.fntMaterial=n?M:null,s[e.color.toString()+n.toString()+"0"]=o;var h=e.clone();h.color=16777215;var c=t.getTextShapeForIdentifierAndFormat(n.toString()+"0",h);a[n.toString()+"0"]=c,(M=new MethodMaterial(this._fnt_channels[0])).bothSides=!0,M.alphaBlending=!0,M.alphaPremultiplied=!0,M.useColorTransform=!0,M.style.sampler=new ImageSampler(!1,!0,!0),c.fntMaterial=n?M:null;var u,p,d,f,_,g=null,m=0,y=i+5*r,v=0,b=0,x=0,A=0,E=0,S=!1,T=t.selectionBeginIndex,P=t.selectionEndIndex;t.selectionEndIndex<t.selectionBeginIndex&&(T=t.selectionEndIndex,P=t.selectionBeginIndex);var C=0;for(h.underline&&i+1<t.words.length&&(C=t.words[i+1]),m=i;m<y;m+=5){for(E=t.words[m],x=t.words[m+1],A=t.words[m+2],"BoldStyle"==this.name&&(A-=.2*this.getLineHeight()),"DJB Get Digital"==e.font_name&&(A-=2),b=E+t.words[m+4],v=E;v<b;v++)if(S=!1,t.chars_codes[v],g=t.isInFocus&&v>=T&&v<P?c:o,32!=t.chars_codes[v]&&9!=t.chars_codes[v])if(u=this.getChar(t.chars_codes[v].toString()),_=this._size_multiply,!u&&this.fallbackTable&&(u=this.fallbackTable.getChar(t.chars_codes[v].toString()),_=this.fallbackTable._size_multiply),u){if(n){var w=g.format,D=t.isInFocus&&v>=T&&v<P?a[n.toString()+u.fnt_channel]:s[w.color.toString()+n.toString()+u.fnt_channel];if(!D){var M,O=t.getTextShapeForIdentifierAndFormat(w.color.toString()+n.toString()+u.fnt_channel.toString(),w);l=ColorUtils.float32ColorToARGB(w.color);(M=new MethodMaterial(this._fnt_channels[u.fnt_channel])).colorTransform=new ColorTransform(l[1]/255,l[2]/255,l[3]/255),M.bothSides=!0,M.alphaBlending=!0,M.alphaPremultiplied=!0,M.useColorTransform=!0,M.style.sampler=new ImageSampler(!1,!0,!0),O.fntMaterial=M,s[w.color.toString()+n.toString()+u.fnt_channel]=O,D=O}var I=x+u.char_width*_*u.fnt_rect.x,L=I+u.char_width*_*u.fnt_rect.width,N=A+this._font_em_size*_*u.fnt_rect.y,F=N+this._font_em_size*_*u.fnt_rect.height;D.verts[D.verts.length]=I,D.verts[D.verts.length]=N,D.verts[D.verts.length]=u.fnt_uv.x,D.verts[D.verts.length]=u.fnt_uv.y,D.verts[D.verts.length]=L,D.verts[D.verts.length]=N,D.verts[D.verts.length]=u.fnt_uv.x+u.fnt_uv.width,D.verts[D.verts.length]=u.fnt_uv.y,D.verts[D.verts.length]=L,D.verts[D.verts.length]=F,D.verts[D.verts.length]=u.fnt_uv.x+u.fnt_uv.width,D.verts[D.verts.length]=u.fnt_uv.y-u.fnt_uv.height,D.verts[D.verts.length]=I,D.verts[D.verts.length]=N,D.verts[D.verts.length]=u.fnt_uv.x,D.verts[D.verts.length]=u.fnt_uv.y,D.verts[D.verts.length]=I,D.verts[D.verts.length]=F,D.verts[D.verts.length]=u.fnt_uv.x,D.verts[D.verts.length]=u.fnt_uv.y-u.fnt_uv.height,D.verts[D.verts.length]=L,D.verts[D.verts.length]=F,D.verts[D.verts.length]=u.fnt_uv.x+u.fnt_uv.width,D.verts[D.verts.length]=u.fnt_uv.y-u.fnt_uv.height}else if(p=u.fill_data,d=new Float32Array(p.buffer),this.usesCurves)for(f=0;f<p.count;f++)g.verts[g.verts.length]=d[3*f]*_+x,g.verts[g.verts.length]=d[3*f+1]*_+A,g.verts[g.verts.length]=d[3*f+2];else if(S)for(f=0;f<p.count;f++)g.verts[g.verts.length]=(u.char_width-d[2*f])*_+x,g.verts[g.verts.length]=(d[2*f+1]-this.vertical_glyph_offset)*_+A;else for(f=0;f<p.count;f++)g.verts[g.verts.length]=d[2*f]*_+x,g.verts[g.verts.length]=(d[2*f+1]-this.vertical_glyph_offset)*_+A;x+=u.char_width*_}else console.log("TesselatedFontTable: Error: char not found in fontTable",t.chars_codes[v],t.chars_codes[v].toString());var R=.25*t.internalScale.y,B=A+this.getUnderLineHeight()+R,V=A+this.getUnderLineHeight()-R;h.underline&&i+1<t.words.length&&(g.verts[g.verts.length]=C,g.verts[g.verts.length]=V,g.verts[g.verts.length]=C,g.verts[g.verts.length]=B,g.verts[g.verts.length]=x,g.verts[g.verts.length]=B,g.verts[g.verts.length]=x,g.verts[g.verts.length]=B,g.verts[g.verts.length]=x,g.verts[g.verts.length]=V,g.verts[g.verts.length]=C,g.verts[g.verts.length]=V)}d=null},e.prototype.createPointGlyph_9679=function(){var t=[];GraphicsFactoryHelper.drawElipse(this._font_em_size/2,this._font_em_size/2,this._font_em_size/8,this._font_em_size/8,t,0,360,5,!1);var e=new AttributesView(Float32Array,2);e.set(t);var i=e.attributesBuffer.cloneBufferView();e.dispose();var r=new TesselatedFontChar(i,null,null);return r.char_width=this._font_em_size,this._font_chars.push(r),this._font_chars_dic[9679]=r,r},e.prototype.getChar=function(t){if(null==(i=this._font_chars_dic[t])){if(this._opentype_font){var e=this._opentype_font.charToGlyph(String.fromCharCode(parseInt(t)));if(e){var i,r=e.getPath(),n=new GraphicsPath,o=0,s=r.commands.length,a=0,l=0,h=this._ascent;for(o=0;o<s;o++){var c=r.commands[o];"M"===c.type?(n.moveTo(c.x,c.y+h),a=c.x,l=c.y+h):"L"===c.type?n.lineTo(c.x,c.y+h):"Q"===c.type?n.curveTo(c.x1,c.y1+h,c.x,c.y+h):"C"===c.type?n.cubicCurveTo(c.x1,c.y1+h,c.x2,c.y2+h,c.x,c.y+h):"Z"===c.type&&n.lineTo(a,l)}if((i=new TesselatedFontChar(null,null,n)).char_width=e.advanceWidth*(1/e.path.unitsPerEm*72),i.fill_data=GraphicsFactoryFills.pathToAttributesBuffer(n,!0),!i.fill_data)return console.log("error tesselating opentype glyph"),null;this._font_chars.push(i),this._font_chars_dic[t]=i}}"9679"==t&&(i=this.createPointGlyph_9679())}else if(null==i.fill_data&&null==i.stroke_data&&null!=i.fill_data_path&&(1==i.fill_data_path.commands[0][0]&&0==i.fill_data_path.data[0][0]&&0==i.fill_data_path.data[0][1]&&(i.fill_data_path.data[0].shift(),i.fill_data_path.data[0].shift(),i.fill_data_path.commands[0].shift(),i.fill_data_path.commands[0][0]=2),i.fill_data=GraphicsFactoryFills.pathToAttributesBuffer(i.fill_data_path,!0),!i.fill_data))return console.log("error tesselating glyph"),null;return i},e.prototype.setChar=function(t,e,i,r,n,o,s,a){if(void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===s&&(s=null),void 0===a&&(a=""),e=Math.floor(20*e)/20,null==i&&null==r&&null==s)throw"TesselatedFontTable: trying to create a TesselatedFontChar with no data (fills_data, stroke_data and fill_data_path is null)";if(this._font_chars.length>0){if(n!=this._usesCurves)throw"TesselatedFontTable: Can not set different types of graphic-glyphs (curves vs non-cuves) on the same FontTable!"}else this._usesCurves=n;var l=new TesselatedFontChar(i,r,s);l.char_width=e,l.glyph_idx=o,l.name=t,null==this._glyphIdxToChar[a]&&(this._glyphIdxToChar[a]={}),this._glyphIdxToChar[a][o]=l,this._font_chars.push(l),this._font_chars_dic[t]=l},e.prototype.buildTextRuns=function(t,e){if(2*t.length!=e.length)throw"Invalid data passed to TesselatedFontTable.buildTextRuns(). output_verts.length is not double textRuns.length.";var i,r=0,n=0,o=0,s=0,a=0,l=t.length;for(r=0;r<l;r++)for((i=t[r])[0],n=i[1],i[2],a=i.length,s=3;s<a;s+=2){if(o=i[s],i[s+1],this.getChar(o.toString()),(n==DrawMode.BOTH||n==DrawMode.STROKE)&&null==e[2*r])throw"Trying to render strokes for a textrun, but no output_vert list was set for this textrun strokes";if((n==DrawMode.BOTH||n==DrawMode.FILL)&&null==e[2*r+1])throw"Trying to render fills for a textrun, but no output_vert list was set for this textrun fills"}},e.assetType="[asset TesselatedFontTable]",e}(AssetBase),TextFieldAutoSize=function(){function t(){}return t.CENTER="center",t.LEFT="left",t.NONE="none",t.RIGHT="right",t}(),TextFieldType=function(){function t(){}return t.DYNAMIC="dynamic",t.INPUT="input",t.STATIC="input",t}(),FontStyleName=function(){function t(){}return t.STANDART="standart",t.BOLD="bold",t.ITALIC="italic",t.BOLDITALIC="boldItalic",t}(),TextFormatAlign=function(){function t(){}return t.CENTER="center",t.JUSTIFY="justify",t.LEFT="left",t.RIGHT="right",t}(),TextFormat=function(t){function e(e,i,r,n,o,s,a,l,h,c,u,p,d){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===p&&(p=null),void 0===d&&(d=null);var f=t.call(this)||this;return f.tabStops=[],f._align=h,f._leftMargin=c,f._rightMargin=u,f._indent=p,f._font_name=e,f._size=i,f._color=r,f._bold=n,f._italic=o,f._underline=s,f._leading=d,f._letterSpacing=null,f.url=a,f.link_target=l,f._font=null,f._font_table=null,f._style_name=FontStyleName.STANDART,f}return __extends(e,t),e.prototype.hasPropertySet=function(t){return null!==this["_"+t]},Object.defineProperty(e.prototype,"align",{get:function(){return this._align?this._align:TextFormatAlign.LEFT},set:function(t){this._align=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockIndent",{get:function(){return this._blockIndent?this._blockIndent:0},set:function(t){this._blockIndent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftMargin",{get:function(){return this._leftMargin?this._leftMargin:0},set:function(t){this._leftMargin=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightMargin",{get:function(){return this._rightMargin?this._rightMargin:0},set:function(t){this._rightMargin=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indent",{get:function(){return this._indent?this._indent:0},set:function(t){this._indent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return null!==this._color?this._color:0},set:function(t){this._color=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kerning",{get:function(){return!!this._kerning&&this._kerning},set:function(t){this._kerning=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leading",{get:function(){return this._leading?this._leading:0},set:function(t){this._leading=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing?this._letterSpacing:0},set:function(t){this._letterSpacing=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size?this._size:12},set:function(t){this._size=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{get:function(){return!!this._bold&&this._bold},set:function(t){this._bold=t,this._font&&(this.font_table=this.font.get_font_table(this.style_name,TesselatedFontTable.assetType))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"italic",{get:function(){return!!this._italic&&this._italic},set:function(t){this._italic=t,this._font&&(this.font_table=this.font.get_font_table(this.style_name,TesselatedFontTable.assetType))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"underline",{get:function(){return!!this._underline&&this._underline},set:function(t){this._underline=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font_table",{get:function(){return this._font_table||(this.font_table=this.font.get_font_table(this.style_name,TesselatedFontTable.assetType)),this._font_table},set:function(t){this._font_table=t,this._style_name=this._font_table.name,this._style_name==FontStyleName.ITALIC&&(this._italic=!0),this._style_name==FontStyleName.BOLD&&(this._bold=!0),this._style_name==FontStyleName.BOLDITALIC&&(this._bold=!0,this._italic=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font_name",{get:function(){return this._font_name?this._font_name:""},set:function(t){var e=DefaultFontManager.getFont(t);e?(this._font=e,this.font_table=e.get_font_table(FontStyleName.STANDART,TesselatedFontTable.assetType),this.font_table||console.log("could not find font-table on font",t,this._font),0==this.font_table.get_font_chars().length&&(this.font_table=e.get_font_table(FontStyleName.STANDART,TesselatedFontTable.assetType),this.font_table||console.log("could not find font-table on font",t,this._font)),this._font_name=t):console.log("could not find font for name ",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style_name",{get:function(){return this._italic||this._bold?this._italic&&!this._bold?this._style_name=FontStyleName.ITALIC:!this._italic&&this._bold?this._style_name=FontStyleName.BOLD:this._italic&&this._bold&&(this._style_name=FontStyleName.BOLDITALIC):this._style_name=FontStyleName.STANDART,this._style_name},set:function(t){this._style_name=t,this._style_name!=FontStyleName.BOLD&&this._style_name!=FontStyleName.BOLDITALIC||(this._bold=!0),this._style_name!=FontStyleName.ITALIC&&this._style_name!=FontStyleName.BOLDITALIC||(this._italic=!0),this._font&&(this.font_table=this.font.get_font_table(this._style_name,TesselatedFontTable.assetType))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font?this._font:(this._font=DefaultFontManager.getFont(null),this._font_table=this._font.get_font_table(FontStyleName.STANDART,TesselatedFontTable.assetType),this._font)},set:function(t){this._font_name=t.name,this._font=t,this._font_table=this._font.get_font_table(this._style_name,TesselatedFontTable.assetType)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return this.applyToFormat(t),t},e.prototype.applyToFormat=function(t){return null!==this._font&&(t.font=this._font),null!==this._align&&(t.align=this._align),null!==this._leftMargin&&(t.leftMargin=this._leftMargin),null!==this._rightMargin&&(t.rightMargin=this._rightMargin),null!==this._indent&&(t.indent=this._indent),null!==this._size&&(t.size=this._size),null!==this._color&&(t.color=this._color),null!==this._bold&&(t.bold=this._bold),null!==this._italic&&(t.italic=this._italic),null!==this._underline&&(t.underline=this._underline),null!==this._leading&&(t.leading=this._leading),null!==this._letterSpacing&&(t.letterSpacing=this._letterSpacing),t},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset TextFormat]",e}(AssetBase),TextLineMetrics=function(){function t(t,e,i,r,n,o){}return t.prototype.axCallPublicProperty=function(t,e){return null},t.prototype.axGetPublicProperty=function(t){return null},t.prototype.axSetPublicProperty=function(t){return null},t}(),KeyboardEvent=function(t){function e(e,i,r){void 0===r&&(r=0);var n=t.call(this,e)||this;return n._char=i,n._charCode=r,n.isShift=!1,n.isCTRL=!1,n.isAlt=!1,n}return __extends(e,t),Object.defineProperty(e.prototype,"char",{get:function(){return this._char},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"charCode",{get:function(){return this._charCode},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._char,this._charCode)},e.KEYDOWN="keydown",e.KEYUP="keyup",e}(EventBase),TextfieldEvent=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.type)},e.CHANGED="onChanged",e}(EventBase),TextSprite=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._acceptTraverser=function(t){var e=this.parentTextField;if(e.reConstruct(!0),e._textFormat&&!e._textFormat.font_table.isAsset(TesselatedFontTable)&&!e._textFormat.material){e.transform.colorTransform||(e.transform.colorTransform=new ColorTransform);this.transform.colorTransform.color=null!=e.textColor?e.textColor:e._textFormat.color,this._invalidateHierarchicalProperties(HierarchicalProperties.COLOR_TRANSFORM)}this._graphics._acceptTraverser(t)},e}(Sprite),TextShape=function(){this.verts=[]},HTMLTextProcessor=function(){function t(){}return t.get=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.processHTML=function(t,e){e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(new RegExp("&nbsp;","g")," ")).replace(new RegExp("","g"),String.fromCharCode(8730))).replace(new RegExp("","g"),String.fromCharCode(215))).replace(new RegExp("<\\\\","g"),"</")).replace(new RegExp("<br>","g"),"<br/>")).replace(new RegExp("<BR>","g"),"<br/>")).replace(new RegExp("<BR/>","g"),"<br/>")).replace(new RegExp("<B","g"),"<b")).replace(new RegExp("</B>","g"),"</b>")).replace(new RegExp("<I","g"),"<i")).replace(new RegExp("</I>","g"),"</i>")).replace(new RegExp("<P","g"),"<p")).replace(new RegExp("</P>","g"),"</p>")).replace(new RegExp("<U","g"),"<u")).replace(new RegExp("</U>","g"),"</u>")).replace(new RegExp("<LI","g"),"<li")).replace(new RegExp("</LI>","g"),"</li>")).replace(new RegExp("<FONT","g"),"<font")).replace(new RegExp("</FONT>","g"),"</font>")).replace(new RegExp("& ","g"),"&amp; ");for(var i=0,r=[],n=[],o=[];i<e.length;)if("<"==e[i]){if("p"==e[i+1])r[r.length]="p";else if("b"==e[i+1]&&"r"!=e[i+2])r[r.length]="b";else if("i"==e[i+1])r[r.length]="i";else if("u"==e[i+1])r[r.length]="u";else if("f"==e[i+1]&&"o"==e[i+2]&&"n"==e[i+3]&&"t"==e[i+4])r[r.length]="font",i+=2;else if("l"==e[i+1]&&"i"==e[i+2])r[r.length]="li",i++;else if("/"==e[i+1]&&"p"==e[i+2]){for(var s=r.length,a=-1;s>0;)if("p"==r[--s]){a=s;break}if(a<0)n[n.length]=i,o[o.length]=4;else{for(s=r.length-1;s>a;)n[n.length]=i,o[o.length]="</"+r[s]+">",r.pop(),s--;r.pop()}}else if("/"==e[i+1]&&"b"==e[i+2]){for(s=r.length,a=-1;s>0;)if("b"==r[--s]){a=s;break}if(a<0)n[n.length]=i,o[o.length]=4;else{for(s=r.length-1;s>a;)n[n.length]=i,o[o.length]="</"+r[s]+">",r.pop(),s--;r.pop()}}else if("/"==e[i+1]&&"i"==e[i+2]){for(s=r.length,a=-1;s>0;)if("i"==r[--s]){a=s;break}if(a<0)n[n.length]=i,o[o.length]=4;else{for(s=r.length-1;s>a;)n[n.length]=i,o[o.length]="</"+r[s]+">",r.pop(),s--;r.pop()}}else if("/"==e[i+1]&&"u"==e[i+2]){for(s=r.length,a=-1;s>0;)if("u"==r[--s]){a=s;break}if(a<0)n[n.length]=i,o[o.length]=4;else{for(s=r.length-1;s>a;)n[n.length]=i,o[o.length]="</"+r[s]+">",r.pop(),s--;r.pop()}}else if("/"==e[i+1]&&"l"==e[i+2]&&"i"==e[i+3]){for(s=r.length,a=-1;s>0;)if("li"==r[--s]){a=s;break}if(a<0)n[n.length]=i,o[o.length]=7;else{for(s=r.length-1;s>a;)n[n.length]=i,o[o.length]="</"+r[s]+">",r.pop(),s--;r.pop()}}else if("/"==e[i+1]&&"f"==e[i+2]&&"o"==e[i+3]&&"n"==e[i+4]&&"t"==e[i+5]){for(s=r.length,a=-1;s>0;)if("font"==r[--s]){a=s;break}if(a<0)n[n.length]=i,o[o.length]=7;else{for(s=r.length-1;s>a;)n[n.length]=i,o[o.length]="</"+r[s]+">",r.pop(),s--;r.pop()}}i++}else i++;for(s=r.length;s>0;)s--,n[n.length]=i,o[o.length]="</"+r[s]+">";for(var l=0,h=o.length,c=0;c<h;c++)"number"==typeof o[c]?(e=e.slice(0,n[c]+l)+e.slice(n[c]+l+o[c]),l-=o[c]):(e=e.slice(0,n[c]+l)+o[c]+e.slice(n[c]+l),l+=o[c].length);var u={text:""};t._textFormat.italic=!1,t._textFormat.bold=!1,t._textFormat.align=TextFormatAlign.LEFT,t._textFormats=[t._textFormat],t._textFormatsIdx=[0];var p=(new DOMParser).parseFromString("<p>"+e+"</p>","application/xml");if(p&&p.firstChild){u.multiline=p.firstChild.childNodes.length>0;var d=p;p.firstChild.childNodes.length>0&&"parsererror"==p.firstChild.childNodes[0].nodeName&&(d=p.firstChild.childNodes[1]),this.readHTMLTextPropertiesRecursive(t,d,u,t._textFormat)}return""==u.text||13!=u.text.charCodeAt(u.text.length-1)&&10!=u.text.charCodeAt(u.text.length-1)||(u.text=u.text.slice(0,u.text.length-1)),""!=u.text&&u.text.length>=3&&"n"==u.text[u.text.length-1]&&"\\"==u.text[u.text.length-2]&&"\\"==u.text[u.text.length-3]?u.text=u.text.slice(0,u.text.length-3):""!=u.text&&u.text.length>=2&&"n"==u.text[u.text.length-1]&&"\\"==u.text[u.text.length-2]&&(u.text=u.text.slice(0,u.text.length-2)),""!=u.text&&u.text.length>=3&&"n"==u.text[u.text.length-1]&&"\\"==u.text[u.text.length-2]&&"\\"==u.text[u.text.length-3]?u.text=u.text.slice(0,u.text.length-3):""!=u.text&&u.text.length>=2&&"n"==u.text[u.text.length-1]&&"\\"==u.text[u.text.length-2]&&(u.text=u.text.slice(0,u.text.length-2)),t._textFormatsIdx[t._textFormatsIdx.length-1]=u.text.length,u.text},t.prototype.readHTMLTextPropertiesRecursive=function(t,e,i,r){var n=[],o=[];if(e.attributes){if(e.attributes.size||e.attributes.SIZE)s=(s=e.attributes.size?e.attributes.size.nodeValue:e.attributes.SIZE.nodeValue).replace(/[^0-9.]/g,""),n[n.length]=parseInt(s),o[o.length]="size";if(e.attributes.color||e.attributes.COLOR)s=(s=e.attributes.color?e.attributes.color.nodeValue:e.attributes.COLOR.nodeValue).replace("#","0x"),n[n.length]=parseInt(s),o[o.length]="color";if(e.attributes.indent||e.attributes.INDENT)s=(s=e.attributes.indent?e.attributes.indent.nodeValue:e.attributes.INDENT.nodeValue).replace(/[^0-9.]/g,""),n[n.length]=parseInt(s),o[o.length]="indent";if(e.attributes.leftMargin||e.attributes.LEFTMARGIN)s=(s=e.attributes.leftMargin?e.attributes.leftMargin.nodeValue:e.attributes.LEFTMARGIN.nodeValue).replace(/[^0-9.]/g,""),n[n.length]=parseInt(s),o[o.length]="leftMargin";if(e.attributes.rightMargin||e.attributes.RIGHTMARGIN)s=(s=e.attributes.rightMargin?e.attributes.rightMargin.nodeValue:e.attributes.RIGHTMARGIN.nodeValue).replace(/[^0-9.]/g,""),n[n.length]=parseInt(s),o[o.length]="rightMargin";if(e.attributes.align||e.attributes.ALIGN){var s=e.attributes.align?e.attributes.align.nodeValue:e.attributes.ALIGN.nodeValue;n[n.length]=s,o[o.length]="align"}if(e.attributes.face||e.attributes.FACE){s=e.attributes.face?e.attributes.face.nodeValue:e.attributes.FACE.nodeValue;n[n.length]=s,o[o.length]="font_name"}}for(var a=n.length,l=!1;a>0;)if(r[o[--a]]!=n[a]){l=!0;break}"p"==e.tagName||("b"==e.tagName?r.bold||(l=!0,n[n.length]=!0,o[o.length]="bold"):"i"==e.tagName?r.italic||(l=!0,n[n.length]=!0,o[o.length]="italic"):"u"==e.tagName?r.underline||(l=!0,n[n.length]=!0,o[o.length]="underline"):"font"==e.tagName?l=!0:"li"==e.tagName?i.text+="        ":"br"==e.tagName&&(i.text+="\\n"));var h=r;if(l){for(h=r.clone(),a=n.length;a>0;)h[o[--a]]=n[a];t._textFormats.push(h),t._textFormatsIdx[t._textFormatsIdx.length-1]=i.text.length,t._textFormatsIdx.push(i.text.length)}if(e.childNodes&&e.childNodes.length>0)for(var c=0;c<e.childNodes.length;c++)t._textFormats[t._textFormats.length-1]!=h&&(t._textFormats.push(h),t._textFormatsIdx[t._textFormatsIdx.length-1]=i.text.length,t._textFormatsIdx.push(i.text.length)),this.readHTMLTextPropertiesRecursive(t,e.childNodes[c],i,h);else e.nodeValue&&""!=e.nodeValue.replace(/[\s\r\n]/gi,"")&&(i.text+=e.nodeValue.replace("\n","\\n"));"li"!=e.tagName&&"p"!=e.tagName||(i.text+="\\n")},t}(),TextField=function(t){function e(){var e=t.call(this)||this;return e._isEntity=!1,e.textOffsetX=0,e.textOffsetY=0,e._selectionBeginIndex=0,e._selectionEndIndex=0,e._biggestLine=0,e._iText="",e._text="",e.inMaskMode=!1,e.cursorIntervalID=-1,e.cursorBlinking=!1,e.showSelection=!1,e._textDirty=!1,e._positionsDirty=!1,e._glyphsDirty=!1,e._shapesDirty=!1,e.chars_codes=[],e.chars_width=[],e.tf_per_char=[],e.words=[],e._textRuns_formats=[],e._textRuns_words=[],e._paragraph_textRuns_indices=[],e._maxWidthLine=0,e._labelData=null,e.lines_wordStartIndices=[],e.lines_wordEndIndices=[],e.lines_start_y=[],e.lines_start_x=[],e.lines_charIdx_start=[],e.lines_charIdx_end=[],e.lines_width=[],e.lines_height=[],e.lines_numSpacesPerline=[],e.char_positions_x=[],e.char_positions_y=[],e.sourceTextField=null,e._maskWidth=0,e._maskHeight=0,e._maskTextOffsetX=0,e._maskTextOffsetY=0,e.isStatic=!1,e._internalScale=new Vector3D(1,1,1),e.onKeyDelegate=function(t){return e.onKey(t)},e.startSelectionByMouseDelegate=function(t){return e.startSelectionByMouse(t)},e.stopSelectionByMouseDelegate=function(t){return e.stopSelectionByMouse(t)},e.updateSelectionByMouseDelegate=function(t){return e.updateSelectionByMouse(t)},e._onGraphicsInvalidateDelegate=function(t){return e._onGraphicsInvalidate(t)},e.cursorIntervalID=-1,e._tabEnabled=!0,e.cursorType="text",e.textOffsetX=0,e.textOffsetY=0,e.textShapes={},e._textColor=0,e._width=100,e._height=100,e._textWidth=0,e._textHeight=0,e._type=TextFieldType.DYNAMIC,e._selectable=!1,e._numLines=0,e.multiline=!1,e._autoSize=TextFieldAutoSize.NONE,e._wordWrap=!1,e._background=!1,e._backgroundColor=16777215,e._border=!1,e._borderColor=0,e.html=!1,e.maxChars=0,e._selectionBeginIndex=0,e._selectionEndIndex=0,e._graphics=Graphics.getGraphics(),e._graphics.addEventListener(AssetEvent.INVALIDATE,e._onGraphicsInvalidateDelegate),e.mouseEnabled=e._selectable,e}return __extends(e,t),e.getNewTextField=function(){return e._textFields.length?e._textFields.pop():new e},e.clearPool=function(){e._textFields=[]},e.prototype.updateMaskMode=function(){if(this.inMaskMode&&(this._maskWidth==this._width&&this._maskHeight==this._height&&this._maskTextOffsetX==this.textOffsetX&&this._maskTextOffsetY==this.textOffsetY||(this._maskWidth=this._width,this._maskHeight=this._height,this._maskTextOffsetX=this.textOffsetX,this._maskTextOffsetY=this.textOffsetY,this.maskChild.graphics.clear(),this.maskChild.graphics.beginFill(16777215),this.maskChild.graphics.drawRect(this.textOffsetX,this.textOffsetY,this._width,this._height),this.maskChild.graphics.endFill()),this._graphics.clear()),!this.inMaskMode)return this.inMaskMode=!0,this.maskChild||(this.maskChild=new Sprite),this.textChild||(this.textChild=new TextSprite),this.textChild.mouseEnabled=!1,this.textChild.parentTextField=this,this.maskChild.mouseEnabled=!1,this.maskChild.graphics.beginFill(16777215),this.maskChild.graphics.drawRect(this.textOffsetX,this.textOffsetY,this._width,this._height),this.maskChild.graphics.endFill(),this.addChild(this.maskChild),this.addChild(this.textChild),this.maskChild.maskMode=!0,this.textChild.masks=[this.maskChild],this._graphics.clear(),void(this.targetGraphics=this.textChild.graphics)},e.prototype.getMouseCursor=function(){return this.cursorType},Object.defineProperty(e.prototype,"isInFocus",{get:function(){return this._isInFocus},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.setFocus=function(e,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0),this._isInFocus!=e&&(t.prototype.setFocus.call(this,e,i,r),this.enableInput(e),e?this.setSelection(0,this._iText.length):this.setSelection(0,0),e&&r&&this.adapter!=this&&this.adapter.selectTextField(i),this._glyphsDirty=!0,this._implicitPartition&&this._implicitPartition.invalidateEntity(this))},e.prototype.enableInput=function(t){if(void 0===t&&(t=!0),this.cursorIntervalID>=0&&(window.clearInterval(this.cursorIntervalID),this.cursorIntervalID=-1),t&&this._isInFocus&&this.selectable){this.drawSelectionGraphics();var e=this;this.cursorIntervalID=window.setInterval((function(){e.cursorBlinking=!e.cursorBlinking,e.selectable||(e.cursorBlinking=!0),e._shapesDirty=!0,e.invalidate()}),500)}},e.prototype.findCharIdxForMouse=function(t){var e=this.textChild.transform.globalToLocal(new Point(t.scenePosition.x,t.scenePosition.y)),i=this.getLineIndexAtPoint(e.x,e.y),r=this.getCharIndexAtPoint(e.x,e.y,i);return i>=this.lines_start_x.length&&(i=this.lines_start_x.length-1),i>=0&&r<0&&this.lines_start_x[i]&&(r=e.x<=this.lines_start_x[i]?this.lines_charIdx_start[i]:this.lines_charIdx_end[i]),(i<0||r<0)&&(r=0),r},e.prototype.startSelectionByMouse=function(t){this._selectionBeginIndex=this.findCharIdxForMouse(t),this._selectionEndIndex=this._selectionBeginIndex,this._glyphsDirty=!0,this.reConstruct(),this.cursorBlinking=!1,this.drawSelectionGraphics()},e.prototype.stopSelectionByMouse=function(t){this._selectionEndIndex=this.findCharIdxForMouse(t),this._glyphsDirty=!0,this.reConstruct(),this.drawSelectionGraphics()},e.prototype.updateSelectionByMouse=function(t){this._selectionEndIndex=this.findCharIdxForMouse(t),this._glyphsDirty=!0,this.reConstruct(),this.drawSelectionGraphics()},e.prototype.drawSelectionGraphics=function(){this._selectionBeginIndex<0&&(this._selectionBeginIndex=0),this._selectionBeginIndex>this.char_positions_x.length&&(this._selectionBeginIndex=this.char_positions_x.length),this._selectionEndIndex<0&&(this._selectionEndIndex=0),this._selectionEndIndex>this.char_positions_x.length&&(this._selectionEndIndex=this.char_positions_x.length),this._selectionBeginIndex==this._selectionEndIndex?(this.bgShapeSelect=null,this.drawCursor()):(this.showSelection=!0,this.drawSelectedBG())},e.prototype.scrollToCursor=function(t,e){},e.prototype.drawCursor=function(){if(this._shapesDirty=!0,!this.cursorBlinking&&this.selectable&&this.selectionBeginIndex==this.selectionEndIndex){var t=0,e=0,i=this.newTextFormat;0==this.char_positions_x.length?(t=this.textOffsetX+this._width/2+this._textWidth/2,"justify"==i.align||"center"==i.align||("right"==i.align?t=this.textOffsetX+this._width-2:"left"==i.align&&(t=this.textOffsetX+4+this._textWidth))):this._selectionBeginIndex==this.char_positions_x.length?(t=this.char_positions_x[this._selectionBeginIndex-1]+this.chars_width[this._selectionBeginIndex-1],e=this.char_positions_y[this._selectionBeginIndex-1],i=this.tf_per_char[this._selectionBeginIndex-1]):(t=this.char_positions_x[this._selectionBeginIndex],e=this.char_positions_y[this._selectionBeginIndex],i=this.tf_per_char[this._selectionBeginIndex]),i.font_table.initFontSize(i.size);var r=i.font_table.getLineHeight(),n=this.getTextColorForTextFormat(i),o=this.internalScale.x;if(o<=0&&(o=1),this.cursorShape=GraphicsFactoryHelper.drawRectangles([t-.5*o,e,o,r],n,1),this.cursorShape.usages++,this.cursorShape.style.color!=n){var s=ColorUtils.float32ColorToARGB(n)[0];0==s&&(s=255);var a=Graphics.get_material_for_color(n,s/255);if(a.colorPos){this.cursorShape.style=new Style;var l=new ImageSampler;a.material.animateUVs=!0,this.cursorShape.style.color=n,this.cursorShape.style.addSamplerAt(l,a.material.getTextureAt(0)),this.cursorShape.style.uvMatrix=new Matrix(0,0,0,0,a.colorPos.x,a.colorPos.y)}}this.scrollToCursor(t,e)}else this.cursorShape=null},e.prototype.drawSelectedBG=function(){this._shapesDirty=!0,this._selectionBeginIndex<0&&(this._selectionBeginIndex=0),this._selectionBeginIndex>this.char_positions_x.length&&(this._selectionBeginIndex=this.char_positions_x.length);var t=this._selectionBeginIndex,e=this._selectionEndIndex;this._selectionEndIndex<this._selectionBeginIndex&&(t=this._selectionEndIndex,e=this._selectionBeginIndex);var i=0,r=0,n=-1,o=null,s=-1,a=0,l=0,h=[];if(0!=this.char_positions_x.length&&this._selectionEndIndex!=this._selectionBeginIndex)for(var c=e>this.char_positions_x.length?this.char_positions_x.length:e,u=t;u<c;u++)u==this.char_positions_x.length?(i=this.char_positions_x[u-1]+this.chars_width[u-1],r=this.char_positions_y[u-1],o=this.tf_per_char[u-1]):(i=this.char_positions_x[u],r=this.char_positions_y[u],o=this.tf_per_char[u]),s<0&&(s=i),n>=0&&n!=r&&(h.push(s,n,a,l),a=0,s=i),a+=this.chars_width[u],n=r,o.font_table.initFontSize(o.size),l=o.font_table.getLineHeight();if(a>0)return h.push(s,n,a,l),this.bgShapeSelect=GraphicsFactoryHelper.drawRectangles(h,0,1),void this.bgShapeSelect.usages++;this.scrollToCursor(s+a,n+l)},e.prototype.drawBG=function(){this._graphics.beginFill(this.backgroundColor,this._background||this._type!=TextFieldType.INPUT?1:0),this._graphics.drawRect(this.textOffsetX,this.textOffsetY,this.width,this.height),this._graphics.endFill()},e.prototype.drawBorder=function(){var t=this.border?.25*this.internalScale.x:0,e=this.border?.25*this.internalScale.y:0;this._graphics.beginFill(this._borderColor,1),this._graphics.drawRect(this.textOffsetX,this.textOffsetY,this._width,2*e),this._graphics.drawRect(this.textOffsetX,this.textOffsetY+this._height-2*e,this._width,2*e),this._graphics.drawRect(this.textOffsetX,this.textOffsetY+2*e,2*t,this._height-2*e),this._graphics.drawRect(this.textOffsetX+this._width-2*t,this.textOffsetY+2*e,2*t,this._height-2*e),this._graphics.endFill()},e.prototype.getTextShapeForIdentifierAndFormat=function(t,e){return this.textShapes.hasOwnProperty(t)?this.textShapes[t]:(this.textShapes[t]=new TextShape,this.textShapes[t].format=e,this.textShapes[t])},Object.defineProperty(e.prototype,"autoSize",{get:function(){return this._autoSize},set:function(t){if(this._autoSize!=t){if("string"==typeof t){if(t!=TextFieldAutoSize.CENTER&&t!=TextFieldAutoSize.NONE&&t!=TextFieldAutoSize.LEFT&&t!=TextFieldAutoSize.RIGHT)return}else"boolean"==typeof t&&(t=t?TextFieldAutoSize.LEFT:TextFieldAutoSize.NONE),"number"==typeof t&&(t=t>0?TextFieldAutoSize.LEFT:TextFieldAutoSize.NONE);this._autoSize=t,this._positionsDirty=!0,this._autoSize!=TextFieldAutoSize.NONE&&this.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalScale",{get:function(){return this._internalScale},enumerable:!0,configurable:!0}),e.prototype._iInternalUpdate=function(){t.prototype._iInternalUpdate.call(this),this.reConstruct(!0),!this._textFormat||this._textFormat.font_table.isAsset(TesselatedFontTable)||this._textFormat.material||(this.transform.colorTransform||(this.transform.colorTransform=new ColorTransform),this.transform.colorTransform.color=null!=this.textColor?this.textColor:this._textFormat.color,this._invalidateHierarchicalProperties(HierarchicalProperties.COLOR_TRANSFORM));this._internalScale.x,this._internalScale.y},e.prototype._onGraphicsInvalidate=function(t){var e=this.isEntity();this._isEntity!=e&&(!e&&this._implicitPartition&&this._implicitPartition.clearEntity(this),this._isEntity=e),this.invalidate()},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!=t&&(this._background=t,this._shapesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._shapesDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"border",{get:function(){return this._border},set:function(t){t!=this._border&&(this._border=t,this._shapesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){t!=this.borderColor&&(this._borderColor=t,this._shapesDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomScrollV",{get:function(){return this._bottomScrollV},set:function(t){t!=this._bottomScrollV&&(this._bottomScrollV=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caretIndex",{get:function(){return this._caretIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultTextFormat",{get:function(){return null==this._defaultTextFormat&&(this._defaultTextFormat=new TextFormat),this._defaultTextFormat},set:function(t){this._defaultTextFormat!=t&&(this._defaultTextFormat=t,this._textDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._autoSize!=TextFieldAutoSize.NONE&&this.reConstruct(),this._height},set:function(t){this._height!=t&&this._autoSize==TextFieldAutoSize.NONE&&(this._height=t,this._positionsDirty=!0,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"htmlText",{get:function(){return this._htmlText},set:function(t){if(t!=this._htmlText){this._htmlText=t;var e=HTMLTextProcessor.get().processHTML(this,t);this._labelData=null,this._text=e,this._iText=e,this._textDirty=!0,this._autoSize!=TextFieldAutoSize.NONE?this.invalidate():this._implicitPartition&&this._implicitPartition.invalidateEntity(this)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._iText.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollH",{get:function(){return this.reConstruct(),this._maxScrollH},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollV",{get:function(){return this.reConstruct(),this._maxScrollV},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numLines",{get:function(){return this.reConstruct(),this._numLines},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restrict",{get:function(){return this._restrict},set:function(t){t!=this._restrict&&(this._restrict=t,this._restrictRegex=null,void 0!==t&&((t=t.toString()).length>=2&&"-"==t[0]&&!isNaN(parseInt(t[1]))&&(t="0"+t),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\\/g,"")).replace(/\^/g,"")).replace(/([^a-zA-Z0-9])\-/g,"$1\\-")).replace(/\./g,"\\.")).replace(/\</g,"\\<")).replace(/\>/g,"\\>")).replace(/\+/g,"\\+")).replace(/\*/g,"\\*")).replace(/\?/g,"\\?")).replace(/\[/g,"\\[")).replace(/\]/g,"\\]")).replace(/\$/g,"\\$")).replace(/\(/g,"\\(")).replace(/\)/g,"\\)")).replace(/\{/g,"\\{")).replace(/\}/g,"\\}")).replace(/\=/g,"\\=")).replace(/\!/g,"\\!")).replace(/\:/g,"\\:")).replace(/\|/g,"\\|")).replace(/\//g,"\\/")).replace(/\%/g,"\\%"),this._restrictRegex=new RegExp("[^"+t+"]","g")))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollH",{get:function(){return this._scrollH},set:function(t){t!=this._scrollH&&(this._scrollH=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollV",{get:function(){return this._scrollV},set:function(t){Math.floor(t)!=this._scrollH&&(this._scrollV=Math.floor(t),this._scrollV>this._maxScrollV&&(this._scrollV=this._maxScrollV),this.textChild&&(this.textChild.y=-this.lines_start_y[this._scrollV]))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectable",{get:function(){return this._selectable},set:function(t){this.selectable!=t&&(this._selectable=t,this.mouseEnabled=t,t?(this.addEventListener(MouseEvent.DRAG_START,this.startSelectionByMouseDelegate),this.addEventListener(MouseEvent.DRAG_STOP,this.stopSelectionByMouseDelegate),this.addEventListener(MouseEvent.DRAG_MOVE,this.updateSelectionByMouseDelegate)):(this.removeEventListener(MouseEvent.DRAG_START,this.startSelectionByMouseDelegate),this.removeEventListener(MouseEvent.DRAG_STOP,this.stopSelectionByMouseDelegate),this.removeEventListener(MouseEvent.DRAG_MOVE,this.updateSelectionByMouseDelegate)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionBeginIndex",{get:function(){return this._selectionBeginIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionEndIndex",{get:function(){return this._selectionEndIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=(t=void 0===t?"":t.toString()).replace(String.fromCharCode(160)," "),this._text!=t&&(this._labelData=null,this._text=t,""==t||13!=t.charCodeAt(t.length-1)&&10!=t.charCodeAt(t.length-1)||(t=t.slice(0,t.length-1)),""!=t&&t.length>=3&&"n"==t[t.length-1]&&"\\"==t[t.length-2]&&"\\"==t[t.length-3]&&(t=t.slice(0,t.length-3)),""!=t&&t.length>=3&&"n"==t[t.length-1]&&"\\"==t[t.length-2]&&(t=t.slice(0,t.length-2)),this._iText=t,this._textFormats=[this.newTextFormat],this._textFormatsIdx=[this._iText.length],this._textDirty=!0,this._autoSize!=TextFieldAutoSize.NONE?this.invalidate():this._implicitPartition&&this._implicitPartition.invalidateEntity(this))},enumerable:!0,configurable:!0}),e.prototype.setLabelData=function(t){this._labelData=t,this.isStatic=!0,this._iText="",this._textDirty=!1,this._positionsDirty=!1,this._glyphsDirty=!0,this._autoSize!=TextFieldAutoSize.NONE?this.invalidate():this._implicitPartition&&this._implicitPartition.invalidateEntity(this)},Object.defineProperty(e.prototype,"newTextFormat",{get:function(){return this._newTextFormat?this._newTextFormat:this._textFormat?this._textFormat:new TextFormat},set:function(t){this._newTextFormat=t?t.applyToFormat(this._textFormat.clone()):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textFormat",{get:function(){return null==this._textFormat&&(this._textFormat=new TextFormat),this._textFormat},set:function(t){this._textFormat!=t&&(this._textDirty=!0,this._textFormat=t,this._autoSize!=TextFieldAutoSize.NONE?this.invalidate():this._implicitPartition&&this._implicitPartition.invalidateEntity(this))},enumerable:!0,configurable:!0}),e.prototype._acceptTraverser=function(t){this.maskMode||this._graphics._acceptTraverser(t)},Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._transform.scale.x},set:function(t){this._transform.scale.x!=t&&this._setScaleX(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._transform.scale.y},set:function(t){this._transform.scale.y!=t&&this._setScaleY(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textColor",{get:function(){return this._textColor},set:function(t){if(this._textColor!=t){if(this._textColor=t,this._textFormats){for(var e=this._textFormats.length;e>0;)e--,this._textFormats[e]&&(this._textFormats[e].color=t);this._textDirty=!0}!this._textFormat||this._textFormat.font_table.isAsset(TesselatedFontTable)||this._textFormat.material?(this._glyphsDirty=!0,this._implicitPartition&&this._implicitPartition.invalidateEntity(this)):(this.transform.colorTransform||(this.transform.colorTransform=new ColorTransform),this.transform.colorTransform.color=t,this._invalidateHierarchicalProperties(HierarchicalProperties.COLOR_TRANSFORM))}},enumerable:!0,configurable:!0}),e.prototype.getTextColorForTextFormat=function(t){return t.hasPropertySet("color")?t.color:this._textColor},Object.defineProperty(e.prototype,"textInteractionMode",{get:function(){return this._textInteractionMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.reConstruct(),this._textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.reConstruct(),this._textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type!=t&&(this._type=t,t==TextFieldType.INPUT?(this.enableInput(!0),this.addEventListener(KeyboardEvent.KEYDOWN,this.onKeyDelegate)):(this.enableInput(!1),this.removeEventListener(KeyboardEvent.KEYDOWN,this.onKeyDelegate)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._autoSize==TextFieldAutoSize.NONE||this._wordWrap||this.reConstruct(),this._transform.position.x},set:function(t){this._autoSize==TextFieldAutoSize.NONE||this._wordWrap||this.reConstruct(),this._transform.position.x!=t&&(this._transform.matrix3D._rawData[12]=t,this._transform.invalidatePosition())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._autoSize==TextFieldAutoSize.NONE||this._wordWrap||this.reConstruct(),this._width},set:function(t){this._width!=t&&(this._width=t,this._positionsDirty=!0,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!=t&&(this._wordWrap=t,this._positionsDirty=!0,t||this.invalidate())},enumerable:!0,configurable:!0}),e.prototype.isEntity=function(){return!0},e.prototype.clear=function(){t.prototype.clear.call(this)},e.prototype.dispose=function(){this.disposeValues(),e._textFields.push(this)},e.prototype.disposeValues=function(){t.prototype.disposeValues.call(this),this.maskChild&&(this.maskChild.dispose(),this.maskChild=null),this.textChild&&(this.textChild.dispose(),this.textChild=null),this.cursorShape&&(this.cursorShape.dispose(),this.cursorShape=null),this.bgShapeSelect&&(this.bgShapeSelect.dispose(),this.bgShapeSelect=null),this._labelData&&(this._labelData=null),this._clearTextShapes(),this._textFormat=null},e.prototype.reConstruct=function(t){void 0===t&&(t=!1),(this._textDirty||this._positionsDirty||this._glyphsDirty||this._shapesDirty)&&(this._textDirty&&(this._positionsDirty=!0,this.chars_codes.length=0,this.chars_width.length=0,this.char_positions_x.length=0,this.char_positions_y.length=0,this.tf_per_char.length=0,this.words.length=0,this._textRuns_words.length=0,this._textRuns_formats.length=0,this._paragraph_textRuns_indices.length=0,this.lines_wordStartIndices.length=0,this.lines_wordEndIndices.length=0,this.lines_start_y.length=0,this.lines_start_x.length=0,this.lines_charIdx_start.length=0,this.lines_charIdx_end.length=0,this.lines_width.length=0,this.lines_height.length=0,this.lines_numSpacesPerline.length=0,this._maxScrollH=0,this._maxScrollV=0,this._maxWidthLine=0,""!=this._iText&&null!=this._textFormat&&this.buildParagraphs()),this._positionsDirty&&(this._glyphsDirty=!0,""!=this._iText&&null!=this._textFormat?this.getWordPositions():(this._textWidth=0,this._textHeight=0,this._autoSize!=TextFieldAutoSize.NONE&&(this.wordWrap||this.adjustPositionForAutoSize(0),this._height=4,this._type==TextFieldType.INPUT&&(this.newTextFormat.font_table.initFontSize(this.newTextFormat.size),this._height=this.newTextFormat.font_table.getLineHeight()+4)),this._type==TextFieldType.INPUT&&this.drawSelectionGraphics()),this.updateMaskMode()),this._textDirty=!1,this._positionsDirty=!1,t&&(this._glyphsDirty&&(this._labelData?this.buildGlyphsForLabelData():this.buildGlyphs()),this._glyphsDirty=!1,this._labelData||(this.buildShapes(),this._shapesDirty=!1)))},e.prototype.reset=function(){t.prototype.reset.call(this),this.sourceTextField&&(this.sourceTextField.copyTo(this),this._textFormats=[this.newTextFormat],this._textFormatsIdx=[this._iText.length])},e.prototype.buildParagraphs=function(){var t,e=this._iText.toString(),i=0,r=this._textFormatsIdx.length,n=0,o=0,s=0,a=0,l=!0,h=0,c=0,u=0;this._paragraph_textRuns_indices[this._paragraph_textRuns_indices.length]=this._textRuns_formats.length,c=0;var p=0,d=0;for(i=0;i<r;i++){h=0,u=0,l=!0,t=this._textFormats[i];var f=this._width-(t.indent+t.leftMargin+t.rightMargin);for(t.font_table.initFontSize(t.size),d=i==r-1?e.length:this._textFormatsIdx[i],this._textRuns_formats[this._textRuns_formats.length]=t,this._textRuns_words[this._textRuns_words.length]=this.words.length,n=p;n<d;n++)(92==(o=e.charCodeAt(n))||10==o||13==o)&&(10==o||13==o||n<e.length-1)&&(a=e.charCodeAt(n+1),10==o||13==o||10==a||110==a||114==a||92==a&&n<e.length-2&&110==e.charCodeAt(n+2))?(this._textRuns_words[this._textRuns_words.length]=h,this._textRuns_words[this._textRuns_words.length]=c,this._textRuns_words[this._textRuns_words.length]=u,this._paragraph_textRuns_indices[this._paragraph_textRuns_indices.length]=this._textRuns_formats.length,this._textRuns_formats[this._textRuns_formats.length]=t,this._textRuns_words[this._textRuns_words.length]=this.words.length,n+=10==o||13==o?0:110==a||114==a?1:2,this.chars_codes[this.chars_codes.length]=55,this.chars_width[this.chars_width.length]=0,this.tf_per_char[this.tf_per_char.length]=t,l=!0,u=0,h=0,this._maxWidthLine<c&&(this._maxWidthLine=c),c=0):(this.chars_codes[this.chars_codes.length]=o,this.tf_per_char[this.tf_per_char.length]=t,(s=t.font_table.getCharWidth(o.toString()))<=0&&(s=t.font_table.getCharWidth("32")),32!=o&&9!=o&&n<d-1&&(s+=32==e.charCodeAt(n+1)||9==e.charCodeAt(n+1)?0:t.letterSpacing),c+=s,this.chars_width[this.chars_width.length]=s,32==o||9==o?(u++,this.words[this.words.length]=this.chars_codes.length-1,this.words[this.words.length]=0,this.words[this.words.length]=0,this.words[this.words.length]=s,this.words[this.words.length]=1,h++,l=!0):(this.multiline&&this._autoSize==TextFieldAutoSize.NONE&&this._wordWrap&&this.words[this.words.length-2]+s>=f&&(l=!0),l?(this.words[this.words.length]=this.chars_codes.length-1,this.words[this.words.length]=0,this.words[this.words.length]=0,this.words[this.words.length]=s,this.words[this.words.length]=1,h++):(this.words[this.words.length-2]+=s,this.words[this.words.length-1]++),l=!1));this._textRuns_words[this._textRuns_words.length]=h,this._textRuns_words[this._textRuns_words.length]=c,this._textRuns_words[this._textRuns_words.length]=u,this._maxWidthLine<c&&(this._maxWidthLine=c),p=d}},e.prototype.adjustPositionForAutoSize=function(t){var e=this._width;this._width=4+t,this._autoSize==TextFieldAutoSize.RIGHT?(this._transform.matrix3D._rawData[12]-=this._width-e,this._transform.invalidatePosition()):this._autoSize==TextFieldAutoSize.CENTER&&(this._transform.matrix3D._rawData[12]-=(this._width-e)/2,this._transform.invalidatePosition())},e.prototype.getWordPositions=function(){var t,e=0,i=this._textRuns_formats.length,r=0,n=0,o=0,s=0,a=0;this._numLines=0;var l=0,h=0,c=0,u=this.textOffsetY+2;if(this._autoSize!=TextFieldAutoSize.NONE&&!this._wordWrap&&this._textDirty){var p=this._maxWidthLine+this._textFormat.indent+this._textFormat.leftMargin+this._textFormat.rightMargin;this.adjustPositionForAutoSize(p)}var d=this._width-(this._textFormat.indent+this._textFormat.leftMargin+this._textFormat.rightMargin),f=0,_=this._paragraph_textRuns_indices.length;l=0,this.lines_wordStartIndices.length=0,this.lines_wordEndIndices.length=0,this.lines_start_y.length=0,this.lines_start_x.length=0,this.lines_width.length=0,this.lines_height.length=0,this.lines_numSpacesPerline.length=0,this.lines_charIdx_start.length=0,this.lines_charIdx_end.length=0;var g=[],m=[];for(f=0;f<_;f++){for(i=f==_-1?this._textRuns_formats.length:this._paragraph_textRuns_indices[f+1],o=0,g[g.length]=0,e=this._paragraph_textRuns_indices[f];e<i;e++)(t=this._textRuns_formats[e]).font_table.initFontSize(t.size),g[g.length-1]<t.font_table.getLineHeight()+t.leading&&(g[g.length-1]=t.font_table.getLineHeight()+t.leading),n=this._textRuns_words[4*e]+5*this._textRuns_words[4*e+1],o+=this._textRuns_words[4*e+2];this.lines_wordStartIndices[this.lines_wordStartIndices.length]=this._textRuns_words[4*this._paragraph_textRuns_indices[f]],this.lines_wordEndIndices[this.lines_wordEndIndices.length]=n,this.lines_width[this.lines_width.length]=0,this.lines_numSpacesPerline[this.lines_numSpacesPerline.length]=0;var y=0;this.lines_height[this.lines_height.length]=g[y],m[l]=t;var v=0;for(e=this._paragraph_textRuns_indices[f];e<i;e++)if((t=this._textRuns_formats[e]).font_table.initFontSize(t.size),a=t.indent,n=this._textRuns_words[4*e]+5*this._textRuns_words[4*e+1],!this.multiline||o<=d||!this.wordWrap)for(r=this._textRuns_words[4*e];r<n;r+=5)h+=c=this.words[r+3],this.lines_wordEndIndices[l]=r+5,this.lines_width[l]+=c,m[l]=t,32!=this.chars_codes[this.words[r]]&&9!=this.chars_codes[this.words[r]]||(this.lines_numSpacesPerline[l]+=1);else for(c=0,a=0,r=this._textRuns_words[4*e];r<n;r+=5){c=this.words[r+3];var b=!1;32!=this.chars_codes[this.words[r]]&&9!=this.chars_codes[this.words[r]]||(this.lines_numSpacesPerline[l]+=1,b=!0),b||this.lines_width[l]+c<=d-a-1*t.font_table.getCharWidth("32")||0==this.lines_width[l]?(this.lines_wordEndIndices[l]=r+5,this.lines_width[l]+=c,m[l]=t):(l++,this.lines_wordStartIndices[l]=r,this.lines_wordEndIndices[l]=r+5,this.lines_width[l]=c,this.lines_numSpacesPerline[l]=0,this.lines_height[this.lines_height.length]=g[y],m[l]=t,a=t.indent)}y++,l++}var x,A,E,S,T,P=this.textOffsetX,C=this.lines_wordStartIndices.length,w=0;for(this._biggestLine=0,this._numLines=C,T=0;T<C;T++){h=this.lines_width[T],A=this.lines_height[T],x=this.lines_wordStartIndices[T],E=this.lines_wordEndIndices[T],this.lines_numSpacesPerline[T],t=m[T],S=d-h,P=this.textOffsetX+t.leftMargin+t.indent,t.align==TextFormatAlign.JUSTIFY?0!=T&&(P-=t.indent):t.align==TextFormatAlign.CENTER?P+=S>0?S/2:2:t.align==TextFormatAlign.RIGHT?P+=S>0?S-2:2:t.align==TextFormatAlign.LEFT&&(P+=2);var D=0,M=0,O=P;this.lines_start_x[T]=P,this.lines_start_y[T]=u,this.lines_charIdx_start[T]=w;v=0;for(r=x;r<E;r+=5){this.words[r+1]=P,O=0,D=(x=this.words[r])+this.words[r+4];var I=this.tf_per_char[x];I.font_table.initFontSize(I.size);var L=A-(I.font_table.getLineHeight()+I.leading);for(L=L>0?L-2:0,this.words[r+2]=u+L,M=x;M<D;M++)this.char_positions_x[this.char_positions_x.length]=P+O,this.char_positions_y[this.char_positions_y.length]=u+L,O+=this.chars_width[M],w++;P+=O,v+=O}this.lines_charIdx_end[T]=w,u+=A,v>s&&(this._biggestLine=T,s=v)}if(this._textWidth=s,this._textHeight=u,this.autoSize!=TextFieldAutoSize.NONE&&(this._height=this._textHeight+4),this._textWidth>this._width){x=this.lines_charIdx_start[this._biggestLine],M=this.lines_charIdx_end[this._biggestLine];for(var N=0;M>x;)if(M--,(N+=this.chars_width[M])>this._width){this._maxScrollH=M;break}}if(this._textHeight>this._height){var F=this.lines_height.length;for(N=4;F>0;)if(F--,(N+=this.lines_height[F])>this._height){this._maxScrollV=F+1;break}}this.updateMaskMode()},e.prototype.buildGlyphsForLabelData=function(){this._clearTextShapes();for(var t,e,i=[],r=[],n=[],o=[],s=this.staticMatrix.tx/20,a=this.staticMatrix.ty/20,l=0,h=0;h<this._labelData.records.length;h++){i[h]=new TextFormat,r[h]=[],n[h]=[],(t=this._labelData.records[h]).font_table?i[h].font_table=t.font_table:h>0?i[h].font_table=i[h-1].font_table:console.log("error - no font for label"),t.fontHeight?i[h].size=t.fontHeight/20:h>0&&(i[h].size=i[h-1].size),t.color?i[h].color=ColorUtils.f32_RGBA_To_f32_ARGB(t.color):h>0&&(i[h].color=i[h-1].color),null!=t.moveY&&(l=a+=t.moveY/20-l),null!=t.moveX&&(s=this.staticMatrix.tx/20+t.moveX/20),o.push(s),o.push(a);for(var c=0;c<t.entries.length;c++)r[h][c]=t.entries[c].glyphIndex,n[h][c]=t.entries[c].advance/20,s+=t.entries[c].advance/20}var u,p=0,d=i.length,f=0,_=0;for(p=0;p<d;p++)i[p].font_table.initFontSize(i[p].size),_+=(u=i[p].font_table.buildTextLineFromIndices(this,i[p],o[2*p],o[2*p+1],r[p],n[p])).y,f=u.x>f?u.x:f;for(var g in this._textWidth=f,this._textHeight=_,this.targetGraphics=this._graphics,this.targetGraphics.clear(),(this._background||this._type==TextFieldType.INPUT)&&this.drawBG(),(this.border||!this._background&&this._type!=TextFieldType.INPUT)&&this.drawBorder(),this.textShapes){e=this.textShapes[g];var m=new AttributesView(Float32Array,2);m.set(e.verts);var y=m.attributesBuffer.cloneBufferView();m.dispose(),e.elements=new TriangleElements(y),e.elements.setPositions(new Float2Attributes(y)),e.shape=this.targetGraphics.addShape(Shape.getShape(e.elements)),e.shape.usages++;var v=new ImageSampler;if(e.shape.style=new Style,e.format.material&&0==this._textColor)e.shape.material=this._textFormat.material,e.shape.style.addSamplerAt(v,e.shape.material.getTextureAt(0)),e.shape.material.animateUVs=!0,e.shape.style.uvMatrix=new Matrix(0,0,0,0,e.format.uv_values[0],e.format.uv_values[1]);else{var b=this.getTextColorForTextFormat(e.format),x=ColorUtils.float32ColorToARGB(b)[0];0==x&&(x=255);var A=Graphics.get_material_for_color(b,x/255);e.shape.material=A.material,A.colorPos&&(e.shape.style.addSamplerAt(v,e.shape.material.getTextureAt(0)),e.shape.material.animateUVs=!0,e.shape.style.uvMatrix=new Matrix(0,0,0,0,A.colorPos.x,A.colorPos.y))}}},e.prototype.buildGlyphs=function(){this._clearTextShapes();var t,e=0,i=this._textRuns_formats.length;for(e=0;e<i;e++)this._textRuns_formats[e].font_table.initFontSize(this._textRuns_formats[e].size),this._textRuns_formats[e].font_table.fillTextRun(this,this._textRuns_formats[e],this._textRuns_words[4*e],this._textRuns_words[4*e+1]);for(var r in this.textShapes){t=this.textShapes[r];var n=this.getTextColorForTextFormat(t.format),o=ColorUtils.float32ColorToARGB(n)[0];0==o&&(o=255);var s=t.fntMaterial?4:2,a=new AttributesView(Float32Array,s);a.set(t.verts);var l=a.attributesBuffer.cloneBufferView();a.dispose(),t.elements=new TriangleElements(l),t.elements.setPositions(new Float2Attributes(l)),t.fntMaterial&&t.elements.setUVs(new Float2Attributes(l)),t.shape=Shape.getShape(t.elements),t.shape.usages++;var h=new ImageSampler(!1,!0,!0);if(t.shape.style=new Style,t.fntMaterial)t.shape.material=t.fntMaterial,t.shape.style.addSamplerAt(h,t.shape.material.getTextureAt(0));else if(t.format.material&&0==this._textColor)t.shape.material=this._textFormat.material,t.shape.style.addSamplerAt(h,t.shape.material.getTextureAt(0)),t.shape.material.animateUVs=!0,t.shape.style.uvMatrix=new Matrix(0,0,0,0,t.format.uv_values[0],t.format.uv_values[1]);else{var c=Graphics.get_material_for_color(n,o/255);t.shape.material=c.material,c.colorPos&&(t.shape.style.addSamplerAt(h,t.shape.material.getTextureAt(0)),t.shape.material.animateUVs=!0,t.shape.style.uvMatrix=new Matrix(0,0,0,0,c.colorPos.x,c.colorPos.y))}}},e.prototype.buildShapes=function(){var t;for(var e in this.targetGraphics?this._graphics.clear():this.targetGraphics=this._graphics,this.targetGraphics.clear(),(this._background||this._type==TextFieldType.INPUT)&&this.drawBG(),!this._border&&this._background||this.drawBorder(),this.drawSelectionGraphics(),this.bgShapeSelect&&this.isInFocus&&this.targetGraphics.addShape(this.bgShapeSelect),this.textShapes)t=this.textShapes[e],this.targetGraphics.addShape(t.shape);this.type==TextFieldType.INPUT&&this.isInFocus&&this.cursorShape&&this.targetGraphics.addShape(this.cursorShape)},e.prototype.appendText=function(t){this._iText+=t,this._textDirty=!0,this._autoSize!=TextFieldAutoSize.NONE?this.invalidate():this._implicitPartition&&this._implicitPartition.invalidateEntity(this)},e.prototype.closeParagraph=function(){this._iText+="\n",this._textDirty=!0,this._autoSize!=TextFieldAutoSize.NONE?this.invalidate():this._implicitPartition&&this._implicitPartition.invalidateEntity(this)},e.prototype.getCharBoundaries=function(t){return console.log("Textfield.getCharBoundaries() not implemented"),this._charBoundaries},e.prototype.getCharIndexAtPoint=function(t,e,i){void 0===i&&(i=-1),i<0&&(i=this.getLineIndexAtPoint(t,e));for(var r=this.lines_charIdx_start[i],n=this.lines_charIdx_end[i],o=r;o<n;o++)if(t>=this.char_positions_x[o]){if(t<=this.char_positions_x[o]+this.chars_width[o]/2)return o;if(t<=this.char_positions_x[o]+this.chars_width[o])return o+1}return-1},e.prototype.getFirstCharInParagraph=function(t){return console.log("Textfield.getFirstCharInParagraph() not implemented"),this._firstCharInParagraph},e.prototype.getImageReference=function(t){return console.log("TextField.getImageReference() not implemented"),this._imageReference},e.prototype.getLineIndexAtPoint=function(t,e){for(var i=this.lines_start_y.length,r=0;r<i-1;r++)if(e>=this.lines_start_y[r]&&e<=this.lines_start_y[r+1])return r;return e>=this.lines_start_y[i-1]?i-1:0},e.prototype.getLineIndexOfChar=function(t){for(var e,i=this.lines_charIdx_start.length-1;e<i;e++)if(t>=this.lines_charIdx_start[e]&&t<=this.lines_charIdx_end[e+1])return e;return i},e.prototype.getLineLength=function(t){return 0==this.lines_width.length?0:t>=this.lines_width.length?this.lines_width[this.lines_width.length-1]:this.lines_width[t]},e.prototype.getLineMetrics=function(t){var e=new TextLineMetrics;return 0==this.lines_width.length?e:(t>=this.lines_width.length&&(t=this.lines_width.length-1),e.x=this.lines_start_x[t],e.width=this.lines_width[t],this._lineMetrics)},e.prototype.getLineOffset=function(t){return 0==this.lines_charIdx_start.length?0:t>=this.lines_charIdx_start.length?this.lines_charIdx_start[this.lines_charIdx_start.length-1]:this.lines_charIdx_start[t]},e.prototype.getLineText=function(t){return 0==this.lines_charIdx_start.length?"":(t>=this.lines_width.length&&(t=this.lines_width.length-1),this._iText.slice(this.lines_charIdx_start[t],this.lines_charIdx_end[t]))},e.prototype.getParagraphLength=function(t){return this._paragraphLength},e.prototype.getTextFormat=function(t,e){return void 0===t&&(t=-1),void 0===e&&(e=-1),(t>=0||e>=0)&&console.warn("Textfield.getTextFormat() not correctly implemented for multi-formatted text"),this._textFormat},e.prototype.replaceSelectedText=function(t){var e=this._selectionBeginIndex,i=this._selectionEndIndex;if(i!=e){i<e&&(e=this._selectionEndIndex,i=this._selectionBeginIndex);var r=this._iText.slice(0,e-1),n=this._iText.slice(i,this._iText.length);return this.text=r+t+n,this._selectionBeginIndex=e,void(this._selectionEndIndex=this._selectionBeginIndex+t.length)}r=this._iText.slice(0,e),n=this._iText.slice(i,this._iText.length);this.text=r+t+n,this._selectionBeginIndex=e+1,this._selectionEndIndex=this._selectionBeginIndex},e.prototype.replaceText=function(t,e,i){var r=this._iText.slice(0,t-1),n=this._iText.slice(e,this._iText.length);this.text=r+i+n,this._selectionEndIndex=this._selectionBeginIndex+i.length},e.prototype.setSelection=function(t,e){this._selectionBeginIndex==t&&this._selectionBeginIndex==e||(this._selectionBeginIndex=t,this._selectionEndIndex=e,this._glyphsDirty=!0,this.reConstruct(),this.drawSelectionGraphics())},e.prototype.setTextFormat=function(t,e,i){if(void 0===e&&(e=-1),void 0===i&&(i=-1),this._textDirty&&this.reConstruct(),0!=this.chars_codes.length&&t){var r=0;if(-1==e&&-1==i||0==e&&-1==i||(-1==e||0==e)&&i>=this.chars_codes.length){for(r=0;r<this._textFormats.length;r++)this._textFormats[r]=this._textFormats[r].clone(),t.applyToFormat(this._textFormats[r]);this._textDirty=!0}else{var n,o=[],s=[],a=0,l=-1,h=this._textFormats.length,c=this.chars_codes.length;if(-1==e&&(e=0),-1==i&&(i=c),i<e){var u=i;i=e,e=u}for(i==e&&i++,r=0;r<h;r++)if(r>0&&(a=l),l=this._textFormatsIdx[r],n=this._textFormats[r],a<=e&&l>e){for(a<e&&(o.push(n),s.push(e));l<i;){var p=this._textFormats[r].clone();t.applyToFormat(p),o.push(p),s.push(l),++r<h?(l=this._textFormatsIdx[r],n=this._textFormats[r]):l=i+1}if(l==i){p=n.clone();t.applyToFormat(p),o.push(p),s.push(i)}if(l>i){p=n.clone();t.applyToFormat(p),o.push(p),s.push(i),o.push(n),s.push(l)}}else o.push(this._textFormats[r]),s.push(this._textFormatsIdx[r]);for(this._textFormats.length=0,this._textFormatsIdx.length=0,r=0;r<o.length;r++)this._textFormats[r]=o[r],this._textFormatsIdx[r]=s[r];this._textDirty=!0}}},e.isFontCompatible=function(t,e){return!1},e.prototype.onKey=function(t){var e=t;this.addChar(e.char,e.isShift,e.isCTRL,e.isAlt)},e.prototype.addCharCode=function(t){this.addChar(String.fromCharCode(t))},e.prototype.deleteSelectedText=function(t){if(void 0===t&&(t="Backspace"),0!=this.text.length){if(this._selectionBeginIndex!=this._selectionEndIndex){var e=0!=this._selectionBeginIndex?this._iText.slice(0,this._selectionBeginIndex):"",i=this._selectionEndIndex<this._iText.length?this._iText.slice(this._selectionEndIndex,this._iText.length):"";return this.text=e+i,void(this._selectionEndIndex=this._selectionBeginIndex)}if("Backspace"==t){if(0==this._selectionBeginIndex)return;e=this._iText.slice(0,this._selectionBeginIndex-1),i=this._iText.slice(this._selectionEndIndex,this._iText.length);this.text=e+i,this._selectionBeginIndex-=1,this._selectionEndIndex=this._selectionBeginIndex}else if("Delete"==t){e=this._iText.slice(0,this._selectionBeginIndex),i=this._iText.slice(this._selectionEndIndex+1,this._iText.length);this.text=e+i,this._selectionEndIndex=this._selectionBeginIndex}}},e.prototype.addChar=function(t,i,r,n){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=!1);var o=this._iText;if(this._selectionBeginIndex||(this._selectionBeginIndex=0),this._selectionEndIndex||(this._selectionEndIndex=0),this._selectionEndIndex<this._selectionBeginIndex){var s=this._selectionEndIndex;this._selectionEndIndex=this._selectionBeginIndex,this._selectionBeginIndex=s}if("Backspace"==t||"Delete"==t)this.deleteSelectedText(t);else if("ArrowRight"==t)i||this._selectionEndIndex==this._selectionBeginIndex?this._selectionEndIndex>this._selectionBeginIndex?(this._selectionEndIndex+=1,i||(this._selectionBeginIndex=this._selectionEndIndex)):(this._selectionBeginIndex+=1,i||(this._selectionEndIndex=this._selectionBeginIndex)):this._selectionEndIndex>this._selectionBeginIndex?this._selectionBeginIndex=this._selectionEndIndex:this._selectionEndIndex=this._selectionBeginIndex;else if("ArrowLeft"==t)i||this._selectionEndIndex==this._selectionBeginIndex?this._selectionEndIndex>this._selectionBeginIndex?(this._selectionBeginIndex-=1,i||(this._selectionEndIndex=this._selectionBeginIndex)):(this._selectionEndIndex-=1,i||(this._selectionBeginIndex=this._selectionEndIndex)):this._selectionEndIndex>this._selectionBeginIndex?this._selectionEndIndex=this._selectionBeginIndex:this._selectionBeginIndex=this._selectionEndIndex;else if("Enter"==t&&this.multiline)this._insertNewText("\n");else if(1==t.length){if(this._restrictRegex){var a=t.replace(this._restrictRegex,"");if(a.length<t.length){var l=t.toUpperCase().replace(this._restrictRegex,""),h=t.toLowerCase().replace(this._restrictRegex,"");t=l,l.length<h.length&&(t=h),a.length>t.length&&(t=a)}if(""==t)return}if(this.newTextFormat.font_table&&!this.newTextFormat.font_table.hasChar(t.charCodeAt(0).toString())&&(t=t.toUpperCase(),!this.newTextFormat.font_table.hasChar(t.charCodeAt(0).toString())&&(t=t.toLowerCase(),!this.newTextFormat.font_table.hasChar(t.charCodeAt(0).toString()))))return;this._insertNewText(t)}else t.length>1&&console.log("invalid keyboard input: ",t);if(this._glyphsDirty=!0,this.reConstruct(),this.drawSelectionGraphics(),this.invalidate(),o!==this._iText&&this.dispatchEvent(e._onChangedEvent),t&&t.length>0&&this.adapter!=this){var c;switch(t){case"Backspace":c=8;break;case"Delete":c=46;break;case"ArrowRight":c=39;break;case"ArrowLeft":c=37;break;case".":c=189;break;default:c=t.charCodeAt(0)}this.adapter.dispatchKeyEvent(c,i,r,n)}},e.prototype._insertNewText=function(t){if(this._selectionBeginIndex!=this._selectionEndIndex){var e=this._iText.slice(0,this._selectionBeginIndex),i=this._iText.slice(this._selectionEndIndex,this._iText.length);if(this.maxChars>0&&e.length+i.length+t.length>this.maxChars){var r=this.maxChars-e.length+i.length;r>0&&(t=t.slice(0,r))}this.text=e+t+i,this._selectionBeginIndex+=1,this._selectionEndIndex=this._selectionBeginIndex}else if(this.maxChars>0&&this._iText.length>=this.maxChars);else{e=this._iText.slice(0,this._selectionBeginIndex),i=this._iText.slice(this._selectionEndIndex,this._iText.length);this.text=e+t+i,this._selectionBeginIndex+=1,this._selectionEndIndex=this._selectionBeginIndex}},e.prototype.clone=function(){var t=e.getNewTextField();return this.copyTo(t),t},e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.autoSize=this.autoSize,e.type=this._type,e.html=this.html,e.width=this._width,e.height=this._height,this._textFormat&&(e.textFormat=this._textFormat.clone()),e.textColor=this._textColor,e.border=this._border,e.borderColor=this._borderColor,e.background=this._background,e.backgroundColor=this._backgroundColor,e.textOffsetX=this.textOffsetX,e.textOffsetY=this.textOffsetY,e.staticMatrix=this.staticMatrix,e.selectable=this._selectable,e.multiline=this.multiline,e.wordWrap=this.wordWrap,e.maxChars=this.maxChars,e.sourceTextField=this,e.fileurl=this.fileurl,e.html?e.htmlText=this.htmlText:e.text=this.text,this._labelData&&e.setLabelData(this._labelData)},e.prototype._clearTextShapes=function(){var t;for(var e in this.targetGraphics&&this.targetGraphics.clear(),this.textShapes)(t=this.textShapes[e]).shape.dispose(),t.shape=null,t.elements=null,t.verts.length=0,delete this.textShapes[e]},e._textFields=[],e.assetType="[asset TextField]",e._onChangedEvent=new TextfieldEvent(TextfieldEvent.CHANGED),e}(DisplayObjectContainer);PartitionBase.registerAbstraction(EntityNode,TextField);var MovieClip=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i.preventScript=!1,i.symbolID=0,i._buttonMode=!1,i._isButton=!1,i._time=0,i._currentFrameIndex=-1,i._isPlaying=!0,i._isInit=!0,i._potentialInstances={},i._depth_sessionIDs={},i._sessionID_childs={},i._sounds={},i.buttonEnabled=!0,i.loop=!0,i.constructedKeyFrameIndex=-1,i._skipFramesForStream=0,i.timelineMC=!1,i._soundVolume=1,i._parentSoundVolume=1,i.doingSwap=!1,i._isButton=!1,i._buttonMode=!1,i._useHandCursor=!0,i.cursorType="pointer",i._enterFrame=new AssetEvent(AssetEvent.ENTER_FRAME,i),i.inheritColorTransform=!0,i._onMouseOver=function(t){i.buttonEnabled?i.currentFrameIndex=1:i.currentFrameIndex=0},i._onMouseOut=function(t){i.currentFrameIndex=0},i._onMouseDown=function(t){i.buttonEnabled?i.currentFrameIndex=2:i.currentFrameIndex=0},i._onMouseUp=function(t){i.currentFrameIndex=0==i.currentFrameIndex?0:1},i._onDragOver=function(t){i.buttonEnabled?i.currentFrameIndex=2:i.currentFrameIndex=0},i._onDragOut=function(t){i.currentFrameIndex=1},i._timeline=e||new Timeline,i}return __extends(e,t),e.getNewMovieClip=function(t){if(void 0===t&&(t=null),e._movieClips.length){var i=e._movieClips.pop();return i.timeline=t||new Timeline,i.graphics=Graphics.getGraphics(),i}return new e(t)},e.clearPool=function(){e._movieClips=[]},e.prototype.initSoundStream=function(t,i){this._soundStreams||(this._soundStreams=new e.movieClipSoundsManagerClass(this)),this._soundStreams.initSoundStream(t,i)},e.prototype.addSoundStreamBlock=function(t,i){this._soundStreams||(this._soundStreams=new e.movieClipSoundsManagerClass(this)),this._soundStreams.addSoundStreamBlock(t,i)},e.prototype._syncSounds=function(t){return this._soundStreams?this._soundStreams.syncSounds(t,this._isPlaying,this.parent):0},e.prototype.startSound=function(t,i,r){this._sounds[t]&&this._sounds[t].stop(),i.loopsToPlay=r,i.play(0,!1),this._sounds[t]=i,e._activeSounds[t]||(e._activeSounds[t]=[]),e._activeSounds[t].push(i)},e.prototype.stopSounds=function(t){if(void 0===t&&(t=null),t)this._sounds[t]&&(this._sounds[t].stop(),delete this._sounds[t]);else{for(var i in this._sounds)this._sounds[i].stop();this._sounds={}}for(var r,n=this._children.length,o=0;o<n;++o)(r=this._children[o]).isAsset(e)&&r.stopSounds(t);e._activeSounds={},this._soundStreams&&this._soundStreams.syncSounds(0,!1,this.parent)},Object.defineProperty(e.prototype,"soundVolume",{get:function(){return this._soundVolume},set:function(t){if(this._soundVolume!=t){for(var i in this._soundVolume=t,this._sounds)this._sounds[i].volume=t;for(var r,n=this._children.length,o=0;o<n;++o)(r=this._children[o]).isAsset(e)&&(r.soundVolume=t)}},enumerable:!0,configurable:!0}),e.prototype.stopSound=function(t){if(this._sounds[t]&&(this._sounds[t].stop(),delete this._sounds[t]),e._activeSounds[t]){for(var i=0;i<e._activeSounds[t].length;i++)e._activeSounds[t][i].stop();delete e._activeSounds[t]}},e.prototype.buttonReset=function(){this._isButton&&!this.buttonEnabled&&(this.currentFrameIndex=0)},e.prototype.getMouseCursor=function(){return"scene"==this.name?"initial":this._useHandCursor?this.cursorType:"initial"},e.prototype.registerScriptObject=function(t){this[t.name]=t,t.isAsset(e)&&t.removeButtonListeners()},e.prototype.unregisterScriptObject=function(t){delete this[t.name],t.isAsset(e)&&t.removeButtonListeners()},e.prototype.dispose=function(){this.disposeValues(),e._movieClips.push(this)},e.prototype.disposeValues=function(){t.prototype.disposeValues.call(this),this._potentialInstances={},this._depth_sessionIDs={},this._sessionID_childs={},this._timeline=null},e.prototype.reset_textclones=function(){if(this.timeline)for(var t in this._potentialInstances)null!=this._potentialInstances[t]&&(this._potentialInstances[t].isAsset(TextField)?this._potentialInstances[t].text=this.timeline.getPotentialChildPrototype(parseInt(t)).text:this._potentialInstances[t].isAsset(e)&&this._potentialInstances[t].reset_textclones())},Object.defineProperty(e.prototype,"useHandCursor",{get:function(){return this._useHandCursor},set:function(t){this._useHandCursor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonMode",{get:function(){return this._buttonMode},set:function(t){this._buttonMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isButton",{get:function(){return this._isButton},set:function(t){this._isButton=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInit",{get:function(){return this._isInit},set:function(t){this._isInit=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeline",{get:function(){return this._timeline},set:function(t){this._timeline!=t&&(this._timeline=t,this.reset(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFrames",{get:function(){return this._timeline.numFrames},enumerable:!0,configurable:!0}),e.prototype.jumpToLabel=function(t,e){void 0===e&&(e=0),this._timeline.jumpToLabel(this,t,e)},e.prototype.reset=function(e){if(void 0===e&&(e=!0),this.timelineMC){t.prototype.reset.call(this),this._time=0,this._adapter&&this.adapter.freeFromScript(),this.constructedKeyFrameIndex=-1;for(var i=this.numChildren-1;i>=0;i--)this.removeChildAt(i);if(this.graphics.clear(),e){var r=this._timeline.keyframe_indices.length;this._isPlaying=Boolean(r>1),r?(this._currentFrameIndex=0,this._timeline.constructNextFrame(this,e&&!this.doingSwap&&!this.preventScript,!0)):this._currentFrameIndex=-1}this._skipAdvance=!0}},e.prototype.resetSessionIDs=function(){this._depth_sessionIDs={}},Object.defineProperty(e.prototype,"currentFrameIndex",{get:function(){return this._currentFrameIndex},set:function(t){var e=!0,i=this._timeline.keyframe_indices.length;i&&(t<0?t=0:t>=i&&(t=i-1,e=!1),this._skipAdvance=!1,this._currentFrameIndex!=t&&(this._currentFrameIndex=t,this._timeline.gotoFrame(this,t,e,!1,!0)))},enumerable:!0,configurable:!0}),e.prototype.addButtonListeners=function(){this._isButton=!0,this.stop(),this.addEventListener(MouseEvent.MOUSE_OVER,this._onMouseOver),this.addEventListener(MouseEvent.MOUSE_OUT,this._onMouseOut),this.addEventListener(MouseEvent.MOUSE_DOWN,this._onMouseDown),this.addEventListener(MouseEvent.MOUSE_UP,this._onMouseUp),this.addEventListener(MouseEvent.DRAG_OVER,this._onDragOver),this.addEventListener(MouseEvent.DRAG_OUT,this._onDragOut),this.mouseChildren=!1},e.prototype.removeButtonListeners=function(){this.removeEventListener(MouseEvent.MOUSE_OVER,this._onMouseOver),this.removeEventListener(MouseEvent.MOUSE_OUT,this._onMouseOut),this.removeEventListener(MouseEvent.MOUSE_DOWN,this._onMouseDown),this.removeEventListener(MouseEvent.MOUSE_UP,this._onMouseUp),this.removeEventListener(MouseEvent.DRAG_OVER,this._onDragOver),this.removeEventListener(MouseEvent.DRAG_OUT,this._onDragOut)},e.prototype.getChildAtSessionID=function(t){return this._sessionID_childs[t]},e.prototype.getSessionIDDepths=function(){return this._depth_sessionIDs},e.prototype.swapChildrenAt=function(t,e){var i=this._children[e]._depthID,r=this._children[t];this.doingSwap=!0,this.addChildAtDepth(this._children[e],this._children[t]._depthID),this.addChildAtDepth(r,i),this._depth_sessionIDs[i]=r._sessionID,this._depth_sessionIDs[this._children[t]._depthID]=this._children[e]._sessionID,this.doingSwap=!1},e.prototype.swapDepths=function(e,i){var r=this.getChildAtDepth(i),n=e._depthID;n!=i&&(delete this._depth_sessionIDs[n],this._depth_sessionIDs[i]=e._sessionID,this.doingSwap=!0,t.prototype.removeChildAtDepth.call(this,n),r&&(t.prototype.removeChildAtDepth.call(this,i),t.prototype.addChildAtDepth.call(this,r,n)),t.prototype.addChildAtDepth.call(this,e,i),this.doingSwap=!1)},e.prototype._addTimelineChildAt=function(t,e,i){this._depth_sessionIDs[e]=t._sessionID=i,t.adapter!=t&&t.adapter.deleteOwnProperties&&t.adapter.deleteOwnProperties();var r=this.addChildAtDepth(t,e);return this._sessionID_childs[i]=t,t.adapter&&t.adapter.dispatchStaticEvent&&(t.adapter.dispatchStaticEvent("added"),t.adapter.dispatchStaticEvent("addedToStage")),r},e.prototype.removeChildAtInternal=function(e){var i=this._children[e];return this.doingSwap||(i._adapter&&i.adapter.freeFromScript(),this.adapter.unregisterScriptObject(i)),delete this._sessionID_childs[i._sessionID],this.doingSwap?i._sessionID=-2:i._sessionID=-1,t.prototype.removeChildAtInternal.call(this,e)},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.play=function(){this._timeline.keyframe_indices.length>1&&(this._isPlaying=!0)},e.prototype.update=function(t,i){void 0===t&&(t=null),e._skipAdvance=!0,this.advanceFrame(t),e._skipAdvance=!1},e.prototype.getPotentialChildInstance=function(t,e,i){return void 0===i&&(i=!1),(!this._potentialInstances[t]||-2==this._potentialInstances[t]._sessionID||this._potentialInstances[t].cloneForEveryInstance&&i)&&(this._potentialInstances[t]=this._timeline.getPotentialChildInstance(t,e)),this._timeline.initChildInstance(this._potentialInstances[t],e),this._potentialInstances[t]},e.prototype.stop=function(){this._isPlaying=!1},e.prototype.clone=function(){var t=e.getNewMovieClip(this._timeline);return this.copyTo(t),t},e.prototype.copyTo=function(e){t.prototype.copyTo.call(this,e),e.timelineMC=this.timelineMC,e.loop=this.loop,e._soundStreams=this._soundStreams,e.symbolID=this.symbolID},e.prototype.advanceFrameInternal=function(t){var i;void 0===t&&(t=null),this._timeline&&this._timeline.numFrames>0&&this._isPlaying&&!this._skipAdvance&&(this._currentFrameIndex==this._timeline.keyframe_indices.length-1?this.loop?0==this._currentFrameIndex||(this._currentFrameIndex=0,this._timeline.gotoFrame(this,0,!0,!0,!0)):this._isPlaying=!1:(this._currentFrameIndex++,this._timeline.constructNextFrame(this)));for(var r=0;r<this._children.length;r++)(i=this._children[r])&&i.isAsset(e)&&i.advanceFrame(t),i&&i.isAsset(Sprite)&&i.numChildren&&i.adapter.advanceFrame&&i.adapter.advanceFrame(t);t&&this.adapter.dispatchEvent(t[0]),this._skipAdvance=!1},e.prototype.advanceFrame=function(t){for(void 0===t&&(t=null),0==this._skipFramesForStream&&this.advanceFrameInternal(t),this._skipFramesForStream=this._syncSounds(this._currentFrameIndex);this._skipFramesForStream>0;)FrameScriptManager.execute_queue(),this.advanceFrameInternal(t),this._skipFramesForStream=this._syncSounds(this._currentFrameIndex)},e.prototype.logHierarchy=function(t){void 0===t&&(t=0),this.printHierarchyName(t,this);for(var i,r=this._children.length,n=0;n<r;n++)(i=this._children[n]).isAsset(e)?i.logHierarchy(t+1):this.printHierarchyName(t+1,i)},e.prototype.printHierarchyName=function(t,e){for(var i="",r=0;r<t;++r)i+="--";i+=" "+e.name+" = "+e.id,console.log(i)},e.prototype.clear=function(){for(var e in this._potentialInstances){var i=this._potentialInstances[e];i&&!i.name&&(i.isAsset(Sprite)||FrameScriptManager.add_child_to_dispose(i),delete this._potentialInstances[e])}t.prototype.clear.call(this)},e.avm1ScriptQueue=[],e.avm1ScriptQueueScripts=[],e.avm1LoadedActions=[],e._movieClips=new Array,e._activeSounds={},e.assetType="[asset MovieClip]",e.movieClipSoundsManagerClass=null,e}(Sprite);PartitionBase.registerAbstraction(EntityNode,MovieClip);var FrameScriptManager=function(){function t(){}return t.setInterval=function(t,e){return this._intervalID++,e<4&&(e=4),this._active_intervals[this._intervalID]={f:t,t:e,dt:0,isTimeout:!1},this._intervalID},t.setTimeOut=function(t,e){return this._intervalID++,e<4&&(e=4),this._active_intervals[this._intervalID]={f:t,t:e,dt:0,isTimeout:!0},this._intervalID},t.clearInterval=function(t){delete this._active_intervals[t]},t.clearTimeout=function(t){delete this._active_intervals[t]},t.execute_intervals=function(t){var e;for(var i in void 0===t&&(t=0),this._active_intervals)for((e=this._active_intervals[i]).dt+=t;this._active_intervals[i]&&e.dt>=e.t;)e.dt-=e.t,e.f(),e.isTimeout&&delete this._active_intervals[i]},t.add_child_to_dispose=function(t){this._queued_dispose.push(t)},t.add_script_to_queue=function(t,e){for(var i=this._queued_mcs_pass2.length;i>0;)i--,this._queued_mcs.push(this._queued_mcs_pass2[i]),this._queued_scripts.push(this._queued_scripts_pass2[i]);this._queued_mcs_pass2.length=0,this._queued_scripts_pass2.length=0,this._queued_mcs.push(t),this._queued_scripts.push(e)},t.add_loaded_action_to_queue=function(t){for(var e=this._queued_mcs_pass2.length;e>0;)e--,this._queued_mcs.push(this._queued_mcs_pass2[e]),this._queued_scripts.push(this._queued_scripts_pass2[e]);this._queued_mcs_pass2.length=0,this._queued_scripts_pass2.length=0,this._queued_mcs[this._queued_mcs.length-1]!=t&&(this._queued_mcs.push(t),this._queued_scripts.push(null))},t.add_script_to_queue_pass2=function(t,e){this._queued_mcs_pass2.push(t),this._queued_scripts_pass2.push(e)},t.queue_as3_constructor=function(t){this._as3_constructor_queue.push(t)},t.execute_as3_constructors=function(){if(0!=this._as3_constructor_queue.length)for(;this._as3_constructor_queue.length>0;){var e,i=this._as3_constructor_queue.concat();this._as3_constructor_queue.length=0;var r=0,n=i.length;for(r=0;r<n;r++)if((e=i[r])._implicitPartition&&e._implicitPartition.root&&e.adapter.executeConstructor){var o=e.adapter.executeConstructor;if(e.adapter.executeConstructor=null,o(),e.isAsset(MovieClip)){var s=e.timeline.get_script_for_frame(e,e.currentFrameIndex);s&&t.add_script_to_queue(e,s)}}i.length=0}},t.execute_queue=function(){if(0!=this._queued_mcs.length||0!=this._queued_mcs_pass2.length)for(;this._queued_mcs.length>0||this._queued_mcs_pass2.length>0;){var t=this._queued_mcs.concat(),e=this._queued_scripts.concat();this._queued_mcs.length=0,this._queued_scripts.length=0;for(var i,r=this._queued_mcs_pass2.length;r>0;)r--,t.push(this._queued_mcs_pass2[r]),e.push(this._queued_scripts_pass2[r]);for(this._queued_mcs_pass2.length=0,this._queued_scripts_pass2.length=0,r=0;r<t.length;r++)if((i=t[r])._implicitPartition&&i._implicitPartition.root){if(i.adapter.onLoaded){var n=i.adapter.onLoaded;i.adapter.onLoaded=null,n()}if(i.adapter.executeConstructor){n=i.adapter.executeConstructor;i.adapter.executeConstructor=null,n()}null!=e[r]&&(this.execute_as3_constructors(),i&&i.adapter&&i.adapter.executeScript&&i.adapter.executeScript(e[r]))}}},t.execute_dispose=function(){for(var t=this._queued_dispose.length,e=0;e<t;e++)this._queued_dispose[e].dispose();this._queued_dispose.length=0},t.frameScriptDebug=void 0,t._queued_dispose=[],t._queued_mcs=[],t._queued_scripts=[],t._queued_mcs_pass2=[],t._queued_scripts_pass2=[],t._active_intervals=new Object,t._as3_constructor_queue=[],t._intervalID=0,t}(),Timeline=function(){function t(){this._functions=[],this._update_indices=[],this._update_frames=[],this.isButton=!1,this.numKeyFrames=0,this.keyframe_indices=[],this.avm1Exports={},this.avm1InitActions={},this.avm1ButtonActions=[],this.graphicsPool={},this.audioPool={},this.potentialPrototypesInitEventsMap={},this._potentialPrototypes=[],this._labels={},this._framescripts={},this._framescripts_translated={},this.keyframe_to_frameidx={},this._functions[1]=this.update_mtx_all,this._functions[2]=this.update_colortransform,this._functions[3]=this.update_masks,this._functions[4]=this.update_name,this._functions[5]=this.update_button_name,this._functions[6]=this.update_visibility,this._functions[7]=this.update_blendmode,this._functions[8]=this.update_rendermode,this._functions[11]=this.update_mtx_scale_rot,this._functions[12]=this.update_mtx_pos,this._functions[200]=this.enable_maskmode,this._functions[201]=this.remove_masks,this._functions[202]=this.swap_graphics,this._functions[203]=this.set_ratio,this._functions[204]=this.start_audio}return t.prototype.resetScripts=function(){this._framescripts={},this._framescripts_translated={}},t.prototype.init=function(){if(null!=this.frame_command_indices&&null!=this.frame_recipe&&null!=this.keyframe_durations){this.keyframe_firstframes=[],this.keyframe_constructframes=[],this.keyframe_indices=[];var t=0,e=0,i=0,r=0,n=0;this.keyframe_to_frameidx={},this.keyframe_to_frameidx[0]=0;var o=0;for(e=0;e<this.numKeyFrames;e++){this.keyframe_to_frameidx[e]=o;var s=this.keyframe_durations[e];for(o+=s,1&this.frame_recipe[e]&&(n=r),this.keyframe_firstframes[r]=t,this.keyframe_constructframes[r++]=n,i=0;i<s;i++)this.keyframe_indices[t++]=e}}},t.prototype.get_framescript=function(t){if(null==this._framescripts[t])return"";if("string"==typeof this._framescripts[t])return this._framescripts[t];throw new Error("Framescript is already translated to Function!!!")},t.prototype.add_framescript=function(t,e){this._framescripts[e]||(this._framescripts[e]=[]),this._framescripts[e].push(t)},t.prototype.regexIndexOf=function(t,e,i){var r=t.substring(i||0).search(e);return r>=0?r+(i||0):r},t.prototype.get_deferred_script=function(t,e){},t.prototype.add_script_for_postcontruct=function(t,e,i){void 0===i&&(i=!1),null!=this._framescripts[e]&&(null==this._framescripts_translated[e]&&(this._framescripts[e]=t.adapter.addScript(this._framescripts[e],e),this._framescripts_translated[e]=!0),i?FrameScriptManager.add_script_to_queue(t,this._framescripts[e]):FrameScriptManager.add_script_to_queue_pass2(t,this._framescripts[e]))},t.prototype.get_script_for_frame=function(t,e){if(e>=0&&null!=this._framescripts[e])return null==this._framescripts_translated[e]&&(this._framescripts[e]=t.adapter.addScript(this._framescripts[e],e),this._framescripts_translated[e]=!0),this._framescripts[e]},Object.defineProperty(t.prototype,"numFrames",{get:function(){return this.keyframe_indices.length},enumerable:!0,configurable:!0}),t.prototype.getPotentialChildPrototype=function(t){return this._potentialPrototypes[t]},t.prototype.getKeyframeIndexForFrameIndex=function(t){return this.keyframe_indices[t]},t.prototype.getPotentialChildInstance=function(e,i){void 0===i&&(i=null);var r=this._potentialPrototypes[e];if(r.isAsset(Sprite)){var n=Sprite.getNewSprite(r.graphics);return n.mouseEnabled=!1,n}if(r.isAsset(MorphSprite)){var o=MorphSprite.getNewMorphSprite(r.graphics);return o.mouseEnabled=!1,o}if(i){var s=this.potentialPrototypesInitEventsMap[i];s&&s.name&&(t.currentInstanceName=s.name),s&&s.matrix&&(t.currentInstanceMatrix=s.matrix)}return r.adapter.clone(!1).adaptee},t.prototype.initChildInstance=function(t,e){var i=this.potentialPrototypesInitEventsMap[e];t.adapter.placeObjectTag=null,t.adapter.initEvents=null,t.instanceID=e,t.addedOnFrame=parseInt(e.split("#")[1]),i&&(i.variableName||i.events&&i.events.length>0)&&(t.adapter.placeObjectTag=i,t.adapter.initEvents=this.potentialPrototypesInitEventsMap[e])},t.prototype.registerPotentialChild=function(t){var e=this._potentialPrototypes.length;return this._potentialPrototypes[e]=t,e},t.prototype.extractHitArea=function(t){t.reset(!1),this.gotoFrame(t,this.numFrames-1,!1);for(var e,i,r=t.numChildren,n=new DisplayObjectContainer;r>0;)r--,(e=(i=t.getChildAt(r)).clone()).x=i.x,e.scaleX=i.scaleX,e.y=i.y,e.scaleY=i.scaleY,e.rotationZ=i.rotationZ,n.addChild(e);return t.pickObject=n,t.reset(!1),n},t.prototype.getCurrentFrameLabel=function(t){for(var e in this._labels)if(this._labels[e]==t.constructedKeyFrameIndex)return null;return null},t.prototype.getCurrentLabel=function(t){var e=null,i=-1;for(var r in this._labels)this._labels[r]>i&&this._labels[r]<=t.constructedKeyFrameIndex&&(i=this._labels[r],e=r);return e},t.prototype.jumpToLabel=function(t,e,i){void 0===i&&(i=0);var r=this._labels[e];r>=0&&(t.currentFrameIndex=this.keyframe_firstframes[r]+i)},t.prototype.getScriptForLabel=function(t,e){var i=this._labels[e.toLowerCase()];if(i<0)return null;var r=this.keyframe_firstframes[i];return r>=0&&null!=this._framescripts[r]?(null==this._framescripts_translated[r]&&(this._framescripts[r]=t.adapter.addScript(this._framescripts[r],r),this._framescripts_translated[r]=!0),this._framescripts[r]):void 0},t.prototype.gotoFrame=function(t,e,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=!1);var o,s,a=t.constructedKeyFrameIndex,l=this.keyframe_indices[e],h=!1;if(a==l){if(!n)return;h=!0}if(a+1!=l){var c=this.keyframe_constructframes[l],u=l>a;h&&(u=!1);var p=c>a,d=u&&!p?a+1:c;if(p)for(o=t.numChildren-1;o>=0;o--)t._children[o]._depthID<0&&t.removeChildAt(o);t.adapter&&t.adapter.$Bg__setPropDict&&t.adapter.clearPropsDic&&t.adapter.clearPropsDic();var f={},_={};if(u){var g={};for(var m in f=t.getSessionIDDepths())g[m]={id:f[m],instanceID:"oldID"};f=g}for(this.pass1(t,d,l,f,_,r),o=t.numChildren-1;o>=0;o--)(s=t._children[o])._depthID<0&&(f[s._depthID]?"oldID"==f[s._depthID].instanceID||(f[s._depthID].instanceID==s.instanceID?u||(s._adapter?(s.adapter.isColorTransformByScript()||s.transform.clearColorTransform(),s.adapter.isBlockedByScript()||s.noTimelineUpdate||(s.transform.clearMatrix3D(),s.masks=null,s.maskMode=!1),s.adapter.isVisibilityByScript()||(s.visible=!0)):(s.transform.clearColorTransform(),s.transform.clearMatrix3D(),s.visible=!0,s.masks=null,s.maskMode=!1)):f[s._depthID].instanceID!=s.instanceID&&t.removeChildAt(o)):t.removeChildAt(o));for(var m in t.preventScript=!0,f)_[m]||"oldID"==f[m].instanceID||-1==(s=t.getPotentialChildInstance(f[m].id,f[m].instanceID,!1))._sessionID&&(s=t.getPotentialChildInstance(f[m].id,f[m].instanceID,!0),t._addTimelineChildAt(s,Number(m),f[m].id));for(var m in t.preventScript=!1,i&&this._framescripts[e]&&this.add_script_for_postcontruct(t,e,!r),f)_[m]&&"oldID"!=f[m].instanceID&&-1==(s=t.getPotentialChildInstance(f[m].id,f[m].instanceID,!1))._sessionID&&(s=t.getPotentialChildInstance(f[m].id,f[m].instanceID,!0),t._addTimelineChildAt(s,Number(m),f[m].id));this.pass2(t),t.constructedKeyFrameIndex=l}else this.constructNextFrame(t,i,!0)},t.prototype.pass1=function(t,e,i,r,n,o){var s,a;this._update_indices.length=0,this._update_frames.length=0;var l,h,c=0;for(a=e;a<=i;a++){var u=this.frame_command_indices[a],p=this.frame_recipe[a];if(2&p)for(h=(l=this.command_index_stream[u])+this.command_length_stream[u++],s=l;s<h;s++)delete r[this.remove_child_stream[s]-16383];if(4&p){if(h=(l=this.command_index_stream[u])+this.command_length_stream[u++],o)for(s=h-1;s>=l;s--)r[this.add_child_stream[2*s+1]-16383]={id:this.add_child_stream[2*s],instanceID:this.add_child_stream[2*s]+"#"+this.keyframe_firstframes[a]};else for(s=l;s<h;s++)r[this.add_child_stream[2*s+1]-16383]={id:this.add_child_stream[2*s],instanceID:this.add_child_stream[2*s]+"#"+this.keyframe_firstframes[a]};if(a==i)if(o)for(s=h-1;s>=l;s--)n[this.add_child_stream[2*s+1]-16383]=!0;else for(s=l;s<h;s++)n[this.add_child_stream[2*s+1]-16383]=!0}8&p&&(this._update_frames[c]=this.keyframe_firstframes[a],this._update_indices[c++]=u++),16&p&&a==i&&this.start_sounds(t,u)}},t.prototype.pass2=function(t){var e,i=this._update_indices.length;for(e=0;e<i;e++)this.update_childs(t,this._update_indices[e],this._update_frames[e])},t.prototype.constructNextFrame=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1);var r=t.currentFrameIndex,n=this.keyframe_indices[r];if(e&&this._framescripts[r]&&this.add_script_for_postcontruct(t,r,i),t.constructedKeyFrameIndex!=n){t.constructedKeyFrameIndex=n;var o=this.frame_command_indices[n],s=this.frame_recipe[n];if(1&s)for(var a=t.numChildren-1;a>=0;a--)t._children[a]._depthID<0&&t.removeChildAt(a);else 2&s&&this.remove_childs_continous(t,o++);4&s&&this.add_childs_continous(t,o++),8&s&&this.update_childs(t,o++),16&s&&this.start_sounds(t,o++)}},t.prototype.remove_childs_continous=function(t,e){for(var i,r=this.command_index_stream[e],n=r+this.command_length_stream[e],o=r;o<n;o++){i=this.remove_child_stream[o]-16383;var s=t.getDepthIndexInternal(i);s>=0&&t.removeChildAt(s)}},t.prototype.add_childs_continous=function(t,e){for(var i,r=this.command_index_stream[e],n=r+this.command_length_stream[e],o=r;o<n;o++)if(i=2*o,void 0!==this.add_child_stream[i]){var s=t.getPotentialChildInstance(this.add_child_stream[i],this.add_child_stream[i]+"#"+t.currentFrameIndex,!0);t._addTimelineChildAt(s,this.add_child_stream[i+1]-16383,this.add_child_stream[i])}else console.log("ERROR in timeline. could not find child-id in child_stream for idx",i,this.add_child_stream)},t.prototype.start_sounds=function(t,e){for(var i=this.command_index_stream[e],r=i+this.command_length_stream[e],n=i;n<r;n++){var o=this.audioPool[this.add_sounds_stream[n]];if(o)if(15==o.cmd){var s=o.sound;o.props.loopCount>0?s.loopsToPlay=o.props.loopCount:s.loopsToPlay=0,t.startSound(o.id,s,s.loopsToPlay)}else 16==o.cmd&&t.stopSound(o.id)}},t.prototype.update_childs=function(t,e,i){var r,n,o;void 0===i&&(i=-1);for(var s,a=this.command_index_stream[e],l=a+this.command_length_stream[e],h=a;h<l;h++)if(s=t.getChildAtSessionID(this.update_child_stream[h])){if(i>0&&s.addedOnFrame>i)continue;for(this._blocked=Boolean(s._adapter&&s.adapter.isBlockedByScript()),o=(n=this.update_child_props_indices_stream[h])+this.update_child_props_length_stream[h],r=n;r<o;r++)this._functions[this.property_type_stream[r]].call(this,s,t,this.property_index_stream[r])}},t.prototype.update_mtx_all=function(t,e,i){if(!this._blocked&&!t.noTimelineUpdate){i*=6;var r=t.transform.matrix3D;r._rawData[0]=this.properties_stream_f32_mtx_all[i++],r._rawData[1]=this.properties_stream_f32_mtx_all[i++],r._rawData[4]=this.properties_stream_f32_mtx_all[i++],r._rawData[5]=this.properties_stream_f32_mtx_all[i++],r._rawData[12]=this.properties_stream_f32_mtx_all[i++],r._rawData[13]=this.properties_stream_f32_mtx_all[i],t.transform.invalidateComponents()}},t.prototype.update_colortransform=function(t,e,i){if(!Boolean(t._adapter&&t.adapter.isColorTransformByScript())){i*=8;var r=t.transform.colorTransform||(t.transform.colorTransform=new ColorTransform);r._rawData[0]=this.properties_stream_f32_ct[i++],r._rawData[1]=this.properties_stream_f32_ct[i++],r._rawData[2]=this.properties_stream_f32_ct[i++],r._rawData[3]=this.properties_stream_f32_ct[i++],r._rawData[4]=this.properties_stream_f32_ct[i++],r._rawData[5]=this.properties_stream_f32_ct[i++],r._rawData[6]=this.properties_stream_f32_ct[i++],r._rawData[7]=this.properties_stream_f32_ct[i],t.transform.invalidateColorTransform()}},t.prototype.update_masks=function(t,e,i){var r,n=new Array,o=this.properties_stream_int[i++];if(0!=o){for(var s=0;s<o;s++)(r=e.getChildAtSessionID(this.properties_stream_int[i++]))&&n.push(r);t.masks=n}else t.masks=null},t.prototype.update_name=function(t,e,i){t.name=this.properties_stream_strings[i],e.adapter.registerScriptObject(t)},t.prototype.update_button_name=function(t,e,i){t.name=this.properties_stream_strings[i],t.addButtonListeners(),e.adapter.registerScriptObject(t)},t.prototype.update_visibility=function(t,e,i){t._adapter&&t.adapter.isVisibilityByScript()||(t.visible=Boolean(i))},t.prototype.update_mtx_scale_rot=function(t,e,i){if(!this._blocked&&!t.noTimelineUpdate){i*=4;var r=t.transform.matrix3D;r._rawData[0]=this.properties_stream_f32_mtx_scale_rot[i++],r._rawData[1]=this.properties_stream_f32_mtx_scale_rot[i++],r._rawData[4]=this.properties_stream_f32_mtx_scale_rot[i++],r._rawData[5]=this.properties_stream_f32_mtx_scale_rot[i],t.transform.invalidateComponents(),t._invalidateHierarchicalProperties(HierarchicalProperties.SCENE_TRANSFORM)}},t.prototype.update_mtx_pos=function(t,e,i){if(!this._blocked&&!t.noTimelineUpdate){i*=2;var r=t.transform.matrix3D;r._rawData[12]=this.properties_stream_f32_mtx_pos[i++],r._rawData[13]=this.properties_stream_f32_mtx_pos[i],t.transform.invalidatePosition()}},t.prototype.enable_maskmode=function(t,e,i){t.maskMode=!0},t.prototype.remove_masks=function(t,e,i){t.masks=null},t.prototype.swap_graphics=function(t,e,i){if(t.isAsset(Sprite)){var r=this.graphicsPool[this.properties_stream_int[i]];t.graphics=r}},t.prototype.start_audio=function(t,e,i){},t.prototype.set_ratio=function(t,e,i){t.setRatio(this.properties_stream_int[i]/65535)},t.prototype.update_blendmode=function(t,e,i){console.log("update blendmode "+i)},t.prototype.update_rendermode=function(t,e,i){console.log("update rendermode "+i)},t.prototype.dispose=function(){for(var t=0;t<this._potentialPrototypes.length;t++)this._potentialPrototypes[t].dispose&&this._potentialPrototypes[t].dispose();this.keyframe_indices=[],this.avm1Exports={},this.avm1InitActions={},this.avm1ButtonActions=[],this.graphicsPool={},this.audioPool={},this.potentialPrototypesInitEventsMap={},this._potentialPrototypes=[],this._labels={},this._framescripts={},this._framescripts_translated={}},t.currentInstanceName=null,t.currentInstanceMatrix=null,t}(),TouchPoint=function(t,e,i){this.x=t,this.y=e,this.id=i},ControllerBase=function(){function t(t){void 0===t&&(t=null),this._pAutoUpdate=!0,this.targetObject=t}return t.prototype.pNotifyUpdate=function(){this._pTargetObject&&this._pTargetObject._invalidateHierarchicalProperties(HierarchicalProperties.SCENE_TRANSFORM)},Object.defineProperty(t.prototype,"targetObject",{get:function(){return this._pTargetObject},set:function(t){this._pTargetObject!=t&&(this._pTargetObject&&this._pAutoUpdate&&(this._pTargetObject._iController=null),this._pTargetObject=t,this._pTargetObject&&this._pAutoUpdate&&(this._pTargetObject._iController=this),this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._pAutoUpdate},set:function(t){this._pAutoUpdate!=t&&(this._pAutoUpdate=t,this._pTargetObject&&(this._pAutoUpdate?this._pTargetObject._iController=this:this._pTargetObject._iController=null))},enumerable:!0,configurable:!0}),t.prototype.update=function(t){throw new AbstractMethodError},t.prototype.updateController=function(){this._pControllerDirty&&this._pAutoUpdate&&(this._pControllerDirty=!1,this.pNotifyUpdate())},t}(),FirstPersonController=function(t){function e(e,i,r,n,o,s,a){void 0===e&&(e=null),void 0===i&&(i=0),void 0===r&&(r=90),void 0===n&&(n=-90),void 0===o&&(o=90),void 0===s&&(s=8),void 0===a&&(a=!1);var l=t.call(this,e)||this;return l._iCurrentPanAngle=0,l._iCurrentTiltAngle=90,l._panAngle=0,l._tiltAngle=90,l._minTiltAngle=-90,l._maxTiltAngle=90,l._steps=8,l._walkIncrement=0,l._strafeIncrement=0,l._wrapPanAngle=!1,l.fly=!1,l.panAngle=i,l.tiltAngle=r,l.minTiltAngle=n,l.maxTiltAngle=o,l.steps=s,l.wrapPanAngle=a,l._iCurrentPanAngle=l._panAngle,l._iCurrentTiltAngle=l._tiltAngle,l}return __extends(e,t),Object.defineProperty(e.prototype,"steps",{get:function(){return this._steps},set:function(t){t=t<1?1:t,this._steps!=t&&(this._steps=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){this._panAngle!=t&&(this._panAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if(void 0===t&&(t=!0),this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){if(this._pControllerDirty=!0,this._wrapPanAngle){for(this._panAngle<0?(this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._iCurrentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle=this._panAngle%360);this._panAngle-this._iCurrentPanAngle<-180;)this._iCurrentPanAngle-=360;for(;this._panAngle-this._iCurrentPanAngle>180;)this._iCurrentPanAngle+=360}t?(this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1),this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)):(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle),Math.abs(this.tiltAngle-this._iCurrentTiltAngle)<.01&&Math.abs(this._panAngle-this._iCurrentPanAngle)<.01&&(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle)}this.targetObject.rotationX=this._iCurrentTiltAngle,this.targetObject.rotationY=this._iCurrentPanAngle,this._walkIncrement&&(this.fly?this.targetObject.transform.moveForward(this._walkIncrement):(this.targetObject.x+=this._walkIncrement*Math.sin(this._panAngle*MathConsts.DEGREES_TO_RADIANS),this.targetObject.z+=this._walkIncrement*Math.cos(this._panAngle*MathConsts.DEGREES_TO_RADIANS)),this._walkIncrement=0),this._strafeIncrement&&(this.targetObject.transform.moveRight(this._strafeIncrement),this._strafeIncrement=0)},e.prototype.incrementWalk=function(t){0!=t&&(this._walkIncrement+=t,this.pNotifyUpdate())},e.prototype.incrementStrafe=function(t){0!=t&&(this._strafeIncrement+=t,this.pNotifyUpdate())},e}(ControllerBase),LookAtController=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=null);var r=t.call(this,e)||this;return r._pOrigin=new Vector3D(0,0,0),r._onLookAtObjectChangedDelegate=function(t){return r.onLookAtObjectChanged(t)},i?r.lookAtObject=i:r.lookAtPosition=new Vector3D,r}return __extends(e,t),Object.defineProperty(e.prototype,"lookAtPosition",{get:function(){return this._pLookAtPosition},set:function(t){this._pLookAtObject&&(this._pLookAtObject.removeEventListener(DisplayObjectEvent.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate),this._pLookAtObject=null),this._pLookAtPosition=t,this.pNotifyUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookAtObject",{get:function(){return this._pLookAtObject},set:function(t){this._pLookAtPosition&&(this._pLookAtPosition=null),this._pLookAtObject!=t&&(this._pLookAtObject&&this._pLookAtObject.removeEventListener(DisplayObjectEvent.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate),this._pLookAtObject=t,this._pLookAtObject&&this._pLookAtObject.addEventListener(DisplayObjectEvent.SCENETRANSFORM_CHANGED,this._onLookAtObjectChangedDelegate),this.pNotifyUpdate())},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this._pTargetObject&&(this._pLookAtPosition?this._pTargetObject.lookAt(this._pLookAtPosition):this._pLookAtObject&&this._pTargetObject.lookAt(this._pLookAtObject.transform.concatenatedMatrix3D.position))},e.prototype.onLookAtObjectChanged=function(t){this.pNotifyUpdate()},e}(ControllerBase),HoverController=function(t){function e(e,i,r,n,o,s,a,l,h,c,u,p){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=0),void 0===n&&(n=90),void 0===o&&(o=1e3),void 0===s&&(s=-90),void 0===a&&(a=90),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=8),void 0===u&&(u=2),void 0===p&&(p=!1);var d=t.call(this,e,i)||this;return d._iCurrentPanAngle=0,d._iCurrentTiltAngle=90,d._panAngle=0,d._tiltAngle=90,d._distance=1e3,d._minPanAngle=-1/0,d._maxPanAngle=1/0,d._minTiltAngle=-90,d._maxTiltAngle=90,d._steps=8,d._yFactor=2,d._wrapPanAngle=!1,d._upAxis=new Vector3D,d.distance=o,d.panAngle=r,d.tiltAngle=n,d.minPanAngle=null!=l?l:-1/0,d.maxPanAngle=null!=h?h:1/0,d.minTiltAngle=s,d.maxTiltAngle=a,d.steps=c,d.yFactor=u,d.wrapPanAngle=p,d._iCurrentPanAngle=d._panAngle,d._iCurrentTiltAngle=d._tiltAngle,d}return __extends(e,t),Object.defineProperty(e.prototype,"steps",{get:function(){return this._steps},set:function(t){t=t<1?1:t,this._steps!=t&&(this._steps=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panAngle",{get:function(){return this._panAngle},set:function(t){t=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,t)),this._panAngle!=t&&(this._panAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(t){t=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,t)),this._tiltAngle!=t&&(this._tiltAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance!=t&&(this._distance=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPanAngle",{get:function(){return this._minPanAngle},set:function(t){this._minPanAngle!=t&&(this._minPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPanAngle",{get:function(){return this._maxPanAngle},set:function(t){this._maxPanAngle!=t&&(this._maxPanAngle=t,this.panAngle=Math.max(this._minPanAngle,Math.min(this._maxPanAngle,this._panAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minTiltAngle",{get:function(){return this._minTiltAngle},set:function(t){this._minTiltAngle!=t&&(this._minTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxTiltAngle",{get:function(){return this._maxTiltAngle},set:function(t){this._maxTiltAngle!=t&&(this._maxTiltAngle=t,this.tiltAngle=Math.max(this._minTiltAngle,Math.min(this._maxTiltAngle,this._tiltAngle)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yFactor",{get:function(){return this._yFactor},set:function(t){this._yFactor!=t&&(this._yFactor=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapPanAngle",{get:function(){return this._wrapPanAngle},set:function(t){this._wrapPanAngle!=t&&(this._wrapPanAngle=t,this.pNotifyUpdate())},enumerable:!0,configurable:!0}),e.prototype.update=function(t){if(void 0===t&&(t=!0),this._tiltAngle!=this._iCurrentTiltAngle||this._panAngle!=this._iCurrentPanAngle){if(this._pControllerDirty=!0,this._wrapPanAngle){for(this._panAngle<0?(this._iCurrentPanAngle+=this._panAngle%360+360-this._panAngle,this._panAngle=this._panAngle%360+360):(this._iCurrentPanAngle+=this._panAngle%360-this._panAngle,this._panAngle=this._panAngle%360);this._panAngle-this._iCurrentPanAngle<-180;)this._iCurrentPanAngle-=360;for(;this._panAngle-this._iCurrentPanAngle>180;)this._iCurrentPanAngle+=360}t?(this._iCurrentTiltAngle+=(this._tiltAngle-this._iCurrentTiltAngle)/(this.steps+1),this._iCurrentPanAngle+=(this._panAngle-this._iCurrentPanAngle)/(this.steps+1)):(this._iCurrentPanAngle=this._panAngle,this._iCurrentTiltAngle=this._tiltAngle),Math.abs(this.tiltAngle-this._iCurrentTiltAngle)<.01&&Math.abs(this._panAngle-this._iCurrentPanAngle)<.01&&(this._iCurrentTiltAngle=this._tiltAngle,this._iCurrentPanAngle=this._panAngle)}var e=this.lookAtObject?this.lookAtObject.transform.position:this.lookAtPosition?this.lookAtPosition:this._pOrigin;this.targetObject.x=e.x+this.distance*Math.sin(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS),this.targetObject.y=e.y+this.distance*Math.sin(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS)*this.yFactor,this.targetObject.z=e.z+this.distance*Math.cos(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.cos(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS),this._upAxis.x=-Math.sin(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS),this._upAxis.y=Math.cos(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS),this._upAxis.z=-Math.cos(this._iCurrentPanAngle*MathConsts.DEGREES_TO_RADIANS)*Math.sin(this._iCurrentTiltAngle*MathConsts.DEGREES_TO_RADIANS),this._pTargetObject&&(this._pLookAtPosition?this._pTargetObject.lookAt(this._pLookAtPosition,this._upAxis):this._pLookAtObject&&this._pTargetObject.lookAt(this._pLookAtObject.transform.concatenatedMatrix3D.position,this._upAxis))},e}(LookAtController),FollowController=function(t){function e(e,i,r,n){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=45),void 0===n&&(n=700),t.call(this,e,i,0,r,n)||this}return __extends(e,t),e.prototype.update=function(e){this.lookAtObject&&(this.panAngle=this._pLookAtObject.rotationY-180,t.prototype.update.call(this))},e}(HoverController),SpringController=function(t){function e(e,i,r,n,o){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=1),void 0===n&&(n=40),void 0===o&&(o=4);var s=t.call(this,e,i)||this;return s.positionOffset=new Vector3D(0,500,-1e3),s.stiffness=r,s.damping=o,s.mass=n,s._velocity=new Vector3D,s._dv=new Vector3D,s._stretch=new Vector3D,s._force=new Vector3D,s._acceleration=new Vector3D,s._desiredPosition=new Vector3D,s}return __extends(e,t),e.prototype.update=function(e){var i;if(this._pLookAtObject&&this._pTargetObject){this._pControllerDirty=!0,i=this._pLookAtObject.transform.matrix3D.deltaTransformVector(this.positionOffset),this._desiredPosition.x=this._pLookAtObject.x+i.x,this._desiredPosition.y=this._pLookAtObject.y+i.y,this._desiredPosition.z=this._pLookAtObject.z+i.z,this._stretch=this._pTargetObject.transform.position.add(this._desiredPosition),this._stretch.scaleBy(-this.stiffness),this._dv.copyFrom(this._velocity),this._dv.scaleBy(this.damping),this._force.x=this._stretch.x-this._dv.x,this._force.y=this._stretch.y-this._dv.y,this._force.z=this._stretch.z-this._dv.z,this._acceleration.copyFrom(this._force),this._acceleration.scaleBy(1/this.mass),this._velocity.incrementBy(this._acceleration);var r=this._pTargetObject.transform.position.add(this._velocity);this._pTargetObject.transform.moveTo(r.x,r.y,r.z),t.prototype.update.call(this)}},e}(LookAtController),Billboard=function(t){function e(e,i,r){var n=t.call(this)||this;return n.preserveDimensions=!1,n._onInvalidateTextureDelegate=function(t){return n._onInvalidateTexture(t)},n.material=e,n._updateDimensions(),n}return __extends(e,t),e.getNewBillboard=function(t,i,r){if(void 0===i&&(i="auto"),void 0===r&&(r=!1),e._billboards.length){var n=e._billboards.pop();return n.material=t,n}return new e(t,i,r)},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"billboardRect",{get:function(){return this._billboardRect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"billboardHeight",{get:function(){return this._billboardHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"billboardWidth",{get:function(){return this._billboardWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(t){t!=this._material&&(this._material&&this._material.removeEventListener(MaterialEvent.INVALIDATE_TEXTURES,this._onInvalidateTextureDelegate),this._material=t,this._material&&this._material.addEventListener(MaterialEvent.INVALIDATE_TEXTURES,this._onInvalidateTextureDelegate),this._updateDimensions(),this._invalidateMaterial())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width!=t&&(this._width=t,this.scaleX=this._width/this._billboardRect.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height!=t&&(this._height=t,this.scaleY=this._height/this._billboardRect.height)},enumerable:!0,configurable:!0}),e.prototype.isEntity=function(){return!0},e.prototype.dispose=function(){this.disposeValues(),e._billboards.push(this)},e.prototype.clone=function(){var t=e.getNewBillboard(this._material);return this.copyTo(t),t},e.prototype._acceptTraverser=function(t){t.applyTraversable(this)},e.prototype._updateDimensions=function(){var t=this.material.getTextureAt(0),e=t?(this._style?this._style.getImageAt(t):null)||(this.material.style?this.material.style.getImageAt(t):null)||t.getImageAt(0):null;if(e){var i=(this._style?this._style.getSamplerAt(t):null)||(this.material.style?this.material.style.getSamplerAt(t):null)||t.getSamplerAt(0)||ImageUtils.getDefaultSampler();i.imageRect?(this._billboardWidth=i.imageRect.width*e.width,this._billboardHeight=i.imageRect.height*e.height):(this._billboardWidth=e.rect.width,this._billboardHeight=e.rect.height),this._billboardRect=i.frameRect||new Rectangle(0,0,this._billboardWidth,this._billboardHeight)}else this._billboardWidth=1,this._billboardHeight=1,this._billboardRect=new Rectangle(0,0,1,1);this.invalidate(),this.invalidateElements(),this.preserveDimensions?(this.scaleX=this._width/this._billboardRect.width,this.scaleY=this._height/this._billboardRect.height):(this._width=this._billboardRect.width*this.scaleX,this._height=this._billboardRect.height*this.scaleY)},e.prototype._onInvalidateProperties=function(e){void 0===e&&(e=null),t.prototype._onInvalidateProperties.call(this,e),this._updateDimensions()},e.prototype._onInvalidateTexture=function(t){this._updateDimensions()},e._billboards=new Array,e.assetType="[asset Billboard]",e}(DisplayObjectContainer),_Render_Billboard=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getStageElements=function(){var t=this._asset.billboardWidth,i=this._asset.billboardHeight,r=this._asset.billboardRect,n=t.toString()+i.toString()+r.toString();this._id=n;var o=e._samplerElements[n];return o?o.setPositions(Array(-r.x,i-r.y,0,t-r.x,i-r.y,0,t-r.x,-r.y,0,-r.x,-r.y,0)):((o=e._samplerElements[n]=new TriangleElements(new AttributesBuffer(11,4))).autoDeriveNormals=!1,o.autoDeriveTangents=!1,o.setIndices(Array(0,1,2,0,2,3)),o.setPositions(Array(-r.x,i-r.y,0,t-r.x,i-r.y,0,t-r.x,-r.y,0,-r.x,-r.y,0)),o.setNormals(Array(1,0,0,1,0,0,1,0,0,1,0,0)),o.setTangents(Array(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o.setUVs(Array(0,1,1,1,1,0,0,0))),this._stage.getAbstraction(o)},e.prototype._getRenderMaterial=function(){return this.renderGroup.getRenderElements(this.stageElements.elements).getAbstraction(this._asset.material||MaterialUtils.getDefaultColorMaterial())},e.prototype._getStyle=function(){return this._asset.style},e._samplerElements=new Object,e}(_Render_RenderableBase),_Pick_Billboard=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._billboardBoxDirty=!0,r._onInvalidateElementsDelegate=function(t){return r._onInvalidateElements(t)},r._asset.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,r._onInvalidateElementsDelegate),r}return __extends(e,t),e.prototype._onInvalidateElements=function(t){this._billboardBoxDirty=!0},e.prototype.onClear=function(e){this._asset.removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate),t.prototype.onClear.call(this,e)},e.prototype.hitTestPoint=function(t,e,i){return!0},e.prototype.getBoxBounds=function(t,e,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._billboardBoxDirty){this._billboardBoxDirty=!1;var n=this._asset.billboardRect;this._billboardBox=new Box(n.x,n.y,0,n.width,n.height,0)}return(t?t.transformBox(this._billboardBox):this._billboardBox).union(r,r||i)},e.prototype.getSphereBounds=function(t,e,i,r,n){return void 0===n&&(n=null),n},e.prototype.testCollision=function(t,e){return t.pickable=null,!1},e}(_Pick_PickableBase);RenderEntity.registerRenderable(_Render_Billboard,Billboard),PickEntity.registerPickable(_Pick_Billboard,Billboard),PartitionBase.registerAbstraction(EntityNode,Billboard);var CameraEvent=function(t){function e(e,i){var r=t.call(this,e)||this;return r._camera=i,r}return __extends(e,t),Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._camera)},e.PROJECTION_CHANGED="projectionChanged",e}(EventBase),Camera=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._projection=e||new PerspectiveProjection,i._projection.transform=i._transform,i.z=-1e3,i}return __extends(e,t),e.prototype.isEntity=function(){return!0},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection},set:function(t){if(this._projection!=t){if(!t)throw new Error("Projection cannot be null!");this._projection.transform=null,this._projection=t,this._projection.transform=this._transform,this.dispatchEvent(new CameraEvent(CameraEvent.PROJECTION_CHANGED,this))}},enumerable:!0,configurable:!0}),e.prototype.project=function(t,e){return void 0===e&&(e=null),this._projection.project(this._transform.inverseConcatenatedMatrix3D.transformVector(t,e),e)},e.prototype.unproject=function(t,e,i,r){return void 0===r&&(r=null),this._transform.concatenatedMatrix3D.transformVector(this._projection.unproject(t,e,i,r))},e.prototype._getDefaultBoundingVolume=function(){return BoundingVolumeType.NULL},e.assetType="[asset Camera]",e}(DisplayObjectContainer),CameraNode=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.acceptTraverser=function(t){},e}(EntityNode);PartitionBase.registerAbstraction(CameraNode,Camera);var LineSegment=function(t){function e(e,i,r,n){void 0===n&&(n=1);var o=t.call(this)||this;return o.material=e,o._startPosition=i,o._endPosition=r,o._halfThickness=.5*n,o}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startPosition",{get:function(){return this._startPosition},set:function(t){this._startPosition!=t&&(this._startPosition=t,this.invalidateElements())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endPosition",{get:function(){return this._endPosition},set:function(t){this._endPosition!=t&&(this._endPosition=t,this.invalidateElements())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return 2*this._halfThickness},set:function(t){this._halfThickness!=t&&(this._halfThickness=.5*t,this.invalidateElements())},enumerable:!0,configurable:!0}),e.prototype.isEntity=function(){return!0},e.prototype._acceptTraverser=function(t){t.applyTraversable(this)},e.assetType="[asset LineSegment]",e}(DisplayObject),_Render_LineSegment=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getStageElements=function(){var t=e._lineGraphics[this._asset.id]||(e._lineGraphics[this._asset.id]=new LineElements),i=this._asset.startPosition,r=this._asset.endPosition,n=new Float32Array(6),o=new Float32Array(1);return n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=r.x,n[4]=r.y,n[5]=r.z,o[0]=this._asset.thickness,t.setPositions(n),t.setThickness(o),this._stage.getAbstraction(t)},e.prototype._getRenderMaterial=function(){return this.renderGroup.getRenderElements(this.stageElements.elements).getAbstraction(this._asset.material||MaterialUtils.getDefaultColorMaterial())},e.prototype._getStyle=function(){return this._asset.style},e._lineGraphics=new Object,e}(_Render_RenderableBase),_Pick_LineSegment=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._lineSegmentBoxDirty=!0,r._lineSegmentSphereDirty=!0,r._onInvalidateElementsDelegate=function(t){return r._onInvalidateElements(t)},r._asset.addEventListener(RenderableEvent.INVALIDATE_ELEMENTS,r._onInvalidateElementsDelegate),r}return __extends(e,t),e.prototype._onInvalidateElements=function(t){this._lineSegmentBoxDirty=!0,this._lineSegmentSphereDirty=!0},e.prototype.onClear=function(e){this._asset.removeEventListener(RenderableEvent.INVALIDATE_ELEMENTS,this._onInvalidateElementsDelegate),t.prototype.onClear.call(this,e)},e.prototype.hitTestPoint=function(t,e,i){return!0},e.prototype.getBoxBounds=function(t,e,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._lineSegmentBoxDirty){this._lineSegmentBoxDirty=!1;var n=this._asset.startPosition,o=this._asset.endPosition;this._lineSegmentBox=new Box(Math.min(n.x,o.x),Math.min(n.y,o.y),Math.min(n.z,o.z),Math.abs(n.x-o.x),Math.abs(n.y-o.y),Math.abs(n.z-o.z))}return(t?t.transformBox(this._lineSegmentBox):this._lineSegmentBox).union(r,r||i)},e.prototype.getSphereBounds=function(t,e,i,r,n){if(void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=null),this._lineSegmentSphereDirty){this._lineSegmentSphereDirty=!1;var o=this._asset.startPosition,s=this._asset.endPosition,a=(s.x-o.x)/2,l=(s.y-o.y)/2,h=(s.z-o.z)/2;this._lineSegmentSphere=new Sphere(o.x+a,o.y+l,o.z+h,Math.sqrt(a*a+l*l+h*h))}return(e?e.transformSphere(this._lineSegmentSphere):this._lineSegmentSphere).union(n,n||r)},e.prototype.testCollision=function(t,e){return t.pickable=null,!1},e}(_Pick_PickableBase);RenderEntity.registerRenderable(_Render_LineSegment,LineSegment),PickEntity.registerPickable(_Pick_LineSegment,LineSegment),PartitionBase.registerAbstraction(EntityNode,LineSegment);var LoaderContainer=function(t){function e(e,i){void 0===e&&(e=!0),void 0===i&&(i=null);var r=t.call(this)||this;return r._useAssetLib=e,r._assetLibId=i,r._onAssetCompleteDelegate=function(t){return r.onAssetComplete(t)},r._onTextureSizeErrorDelegate=function(t){return r.onTextureSizeError(t)},r._onLoadCompleteDelegate=function(t){return r.onLoadComplete(t)},r._onLoadErrorDelegate=function(t){return r.onLoadError(t)},r._onParseErrorDelegate=function(t){return r.onParseError(t)},r}return __extends(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),e.prototype.close=function(){if(this._loader){if(this._useAssetLib)AssetLibraryBundle.getInstance(this._assetLibId).disposeLoader(this._loader);this._disposeLoader()}},e.prototype.load=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this._getLoader().load(t,e,i,r)},e.prototype.loadData=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this._getLoader().loadData(t,"",e,i,r)},e.prototype._getLoader=function(){if(this._useAssetLib){var t=AssetLibraryBundle.getInstance(this._assetLibId);this._loader=t.getLoader()}else this._loader=new Loader;return this._loader.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),this._loader.addEventListener(AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),this._loader.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),this._loader._iAddErrorHandler(this._onLoadErrorDelegate),this._loader._iAddParseErrorHandler(this._onParseErrorDelegate),this._loader},e.prototype._disposeLoader=function(){this._loader.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),this._loader.removeEventListener(AssetEvent.TEXTURE_SIZE_ERROR,this._onTextureSizeErrorDelegate),this._loader.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),this._useAssetLib||this._loader.stop(),this._loader=null},e.prototype.unload=function(){},e.enableParser=function(t){Loader.enableParser(t)},e.enableParsers=function(t){Loader.enableParsers(t)},e.prototype.onAssetComplete=function(t){this.dispatchEvent(t)},e.prototype.onLoadError=function(t){return!!this.hasEventListener(URLLoaderEvent.LOAD_ERROR)&&(this.dispatchEvent(t),!0)},e.prototype.onParseError=function(t){return!!this.hasEventListener(ParserEvent.PARSE_ERROR)&&(this.dispatchEvent(t),!0)},e.prototype.onTextureSizeError=function(t){this.dispatchEvent(t)},e.prototype.onLoadComplete=function(t){this._content=t.content,this._content&&this.addChild(this._content),this.dispatchEvent(t),this._disposeLoader()},e}(DisplayObjectContainer),SimpleButton=function(t){function e(e,i,r,n){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"downState",{get:function(){return this._downState},set:function(t){this._downState=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this.enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitTestState",{get:function(){return this._hitTestState},set:function(t){this._hitTestState=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overState",{get:function(){return this._overState},set:function(t){this._overState=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"soundTransform",{get:function(){return console.log("soundTransform not implemented yet in flash/SimpleButton"),null},set:function(t){console.log("soundTransform not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackAsMenu",{get:function(){return console.log("trackAsMenu not implemented yet in flash/SimpleButton"),!1},set:function(t){console.log("trackAsMenu not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upState",{get:function(){return this._upState},set:function(t){this._upState=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useHandCursor",{get:function(){return console.log("useHandCursor not implemented yet in flash/SimpleButton"),!1},set:function(t){console.log("useHandCursor not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),e}(Sprite),SkyboxElements=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.assetType="[asset SkyboxElements]",e}(TriangleElements),_Render_SkyboxElements=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._includeDependencies=function(t){},e.prototype._getVertexCode=function(t,e,i){var r="",n=t.globalPosDependencies>0?i.globalPositionVertex:i.animatedPosition,o=e.getFreeVertexConstant();e.getFreeVertexConstant(),e.getFreeVertexConstant(),e.getFreeVertexConstant(),t.viewMatrixIndex=4*o.index;var s=e.getFreeVertexConstant();t.scenePositionIndex=4*s.index;var a=e.getFreeVertexConstant(),l=e.getFreeVertexVectorTemp();return r+="mul "+l+", "+n+", "+a+"\nadd "+l+", "+l+", "+s+"\n",t.projectionDependencies>0?(i.projectionFragment=e.getFreeVarying(),r+="m44 "+l+", "+l+", "+o+"\nmov "+i.projectionFragment+", "+l+"\nmov op, "+l+"\n"):r+="m44 op, "+l+", "+o+"\n",r},e.prototype._getFragmentCode=function(t,e,i){return""},e}(_Render_ElementsBase),_Stage_SkyboxElements=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._skyboxProjection=new Matrix3D,e}return __extends(e,t),e.prototype.draw=function(t,e,i,r,n){var o=e.scenePositionIndex,s=i.projection.transform.concatenatedMatrix3D.position;e.vertexConstantData[o++]=2*s.x,e.vertexConstantData[o++]=2*s.y,e.vertexConstantData[o++]=2*s.z,e.vertexConstantData[o++]=1,e.vertexConstantData[o++]=e.vertexConstantData[o++]=e.vertexConstantData[o++]=i.projection.far/Math.sqrt(3),e.vertexConstantData[o]=1;var a=new Vector3D;this._skyboxProjection.copyFrom(i.viewMatrix3D),this._skyboxProjection.copyRowTo(2,a);var l=a.x,h=a.y,c=a.z,u=-(a.x*s.x+a.y*s.y+a.z*s.z+Math.sqrt(l*l+h*h+c*c)),p=new Vector3D(l>=0?1:-1,h>=0?1:-1,1,1),d=this._skyboxProjection.clone();d.invert();var f=d.transformVector(p);this._skyboxProjection.copyRowTo(3,p);var _=(f.x*p.x+f.y*p.y+f.z*p.z+f.w*p.w)/(l*f.x+h*f.y+c*f.z+u*f.w);this._skyboxProjection.copyRowFrom(2,new Vector3D(l*_,h*_,c*_,u*_)),e.sceneMatrixIndex>=0&&e.sceneMatrix.copyFrom(t.renderSceneTransform,!0),e.viewMatrix.copyFrom(this._skyboxProjection,!0);var g=this._stage.context;g.setProgramConstantsFromArray(ContextGLProgramType.VERTEX,e.vertexConstantData),g.setProgramConstantsFromArray(ContextGLProgramType.FRAGMENT,e.fragmentConstantData),this._indices?this.getIndexBufferGL().draw(ContextGLDrawMode.TRIANGLES,0,this.numIndices):this._stage.context.drawVertices(ContextGLDrawMode.TRIANGLES,n,r||this.numVertices)},e}(_Stage_TriangleElements);RenderGroup.registerElements(_Render_SkyboxElements,SkyboxElements),Stage.registerAbstraction(_Stage_SkyboxElements,SkyboxElements);var Skybox=function(t){function e(e,i){void 0===e&&(e=16777215);var r=t.call(this)||this;return r._textures=new Array,r._pBlendMode=BlendMode.NORMAL,r.animateUVs=!1,r.bothSides=!1,r.curves=!1,r.imageRect=!1,r._onTextureInvalidateDelegate=function(t){return r.onTextureInvalidate(t)},r._owners=[r],r.style=new Style,e instanceof ImageCube?(r._style.image=e,r.texture=new ImageTextureCube):r._style.color=Number(e),r}return __extends(e,t),Object.defineProperty(e.prototype,"animationSet",{get:function(){return this._animationSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this._pBlendMode},set:function(t){this._pBlendMode!=t&&(this._pBlendMode=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iOwners",{get:function(){return this._owners},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this.removeTexture(this._texture),this._texture=t,this._texture&&this.addTexture(this._texture),this.invalidatePasses())},enumerable:!0,configurable:!0}),e.prototype.getNumTextures=function(){return this._textures.length},e.prototype.getTextureAt=function(t){return this._textures[t]},e.prototype.isEntity=function(){return!0},Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.invalidatePasses=function(){this.dispatchEvent(new MaterialEvent(MaterialEvent.INVALIDATE_PASSES,this))},e.prototype.invalidateElements=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_ELEMENTS,this))},e.prototype.invalidateMaterial=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_MATERIAL,this))},e.prototype.invalidateStyle=function(){this.dispatchEvent(new RenderableEvent(RenderableEvent.INVALIDATE_STYLE,this))},e.prototype.addTexture=function(t){this._textures.push(t),t.addEventListener(AssetEvent.INVALIDATE,this._onTextureInvalidateDelegate),this.onTextureInvalidate()},e.prototype.removeTexture=function(t){this._textures.splice(this._textures.indexOf(t),1),t.removeEventListener(AssetEvent.INVALIDATE,this._onTextureInvalidateDelegate),this.onTextureInvalidate()},e.prototype.onTextureInvalidate=function(t){this.invalidate()},e.prototype._onInvalidateProperties=function(t){this.invalidateMaterial(),this.invalidatePasses()},e.prototype._acceptTraverser=function(t){t.applyTraversable(this)},e.prototype.iAddOwner=function(t){},e.prototype.iRemoveOwner=function(t){},e.prototype._getDefaultBoundingVolume=function(){return BoundingVolumeType.NULL},e.prototype.testCollision=function(t,e){return t.pickable=null,!1},e.assetType="[asset Skybox]",e}(DisplayObject),_Render_SkyboxMaterial=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._skybox=e,r._shader=new ShaderBase(i,r,r,r._stage),r._texture=r._shader.getAbstraction(r._skybox.texture),r._pAddPass(r),r}return __extends(e,t),e.prototype.onClear=function(e){t.prototype.onClear.call(this,e),this._texture.onClear(new AssetEvent(AssetEvent.CLEAR,this._skybox.texture)),this._texture=null,this._skybox=null},e.prototype._pUpdateRender=function(){t.prototype._pUpdateRender.call(this),this.requiresBlending=this._material.blendMode!=BlendMode.NORMAL,this.shader.setBlendMode(this._material.blendMode==BlendMode.NORMAL&&this.requiresBlending?BlendMode.LAYER:this._material.blendMode)},e.prototype._includeDependencies=function(e){t.prototype._includeDependencies.call(this,e),e.usesPositionFragment=!0},e.prototype._getFragmentCode=function(t,e){return this._texture._getFragmentCode(e.shadedTarget,t,e,e.positionVarying)},e.prototype._setRenderState=function(e,i){t.prototype._setRenderState.call(this,e,i),this._texture._setRenderState(e)},e.prototype._activate=function(e){t.prototype._activate.call(this,e),this._stage.context.setDepthTest(!1,ContextGLCompareMode.LESS),this._texture.activate()},e}(_Render_MaterialPassBase),_Render_Skybox=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getStageElements=function(){var t=e._elements;return t||((t=new SkyboxElements(new AttributesBuffer(11,4))).autoDeriveNormals=!1,t.autoDeriveTangents=!1,t.setIndices(Array(0,1,2,2,3,0,6,5,4,4,7,6,2,6,7,7,3,2,4,5,1,1,0,4,4,0,3,3,7,4,2,1,5,5,6,2)),t.setPositions(Array(-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1))),this._stage.getAbstraction(t)},e.prototype._getRenderMaterial=function(){return this.renderGroup.getRenderElements(this.stageElements.elements).getAbstraction(this._asset)},e.prototype._getStyle=function(){return this._asset.style},e}(_Render_RenderableBase),SkyboxNode=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.isInFrustum=function(t,e){return!!this.isVisible()},e.prototype.isCastingShadow=function(){return!1},e}(EntityNode);RenderGroup.registerDefaultMaterial(_Render_SkyboxMaterial,Skybox),RenderEntity.registerRenderable(_Render_Skybox,Skybox),PartitionBase.registerAbstraction(SkyboxNode,Skybox);var CastError=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ErrorBase),ResizeEvent=function(t){function e(e,i,r){void 0===i&&(i=NaN),void 0===r&&(r=NaN);var n=t.call(this,e)||this;return n._oldHeight=i,n._oldWidth=r,n}return __extends(e,t),Object.defineProperty(e.prototype,"oldHeight",{get:function(){return this._oldHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldWidth",{get:function(){return this._oldWidth},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this._oldHeight,this._oldWidth)},e.RESIZE="resize",e}(EventBase),DefaultSceneGraphFactory=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createMovieClip=function(t,e){return void 0===t&&(t=null),new MovieClip(t)},e.prototype.createSprite=function(t,e,i){return void 0===t&&(t=null),t?t.getNewObject():new Sprite},e.prototype.createDisplayObjectContainer=function(t){return new DisplayObjectContainer},e.prototype.createTextField=function(t){return new TextField},e.prototype.createBillboard=function(t,e){return new Billboard(t)},e.prototype.createMaterial=function(t,e,i){return new MethodMaterial(t,e)},e}(DefaultGraphicsFactory),SceneGraphNode=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numNodes=0,e._pChildNodes=new Array,e._childDepths=new Array,e}return __extends(e,t),e.prototype.acceptTraverser=function(t){var e;if((this._partition.root==this._entity&&this._partition.updateEntities(),t.partition==this._partition||t==t.getTraverser(this._partition))&&t.enterNode(this))for(e=this._numNodes-1;e>=0;e--)this._pChildNodes[e].acceptTraverser(t)},e.prototype.iAddNode=function(t){t.parent=this;for(var e=this._entity!=t.entity?t.entity._depthID:-16384,i=this._childDepths.length,r=i;r--&&!(this._childDepths[r]<e););++r<i?(this._pChildNodes.splice(r,0,t),this._childDepths.splice(r,0,e)):(this._pChildNodes.push(t),this._childDepths.push(e)),this._numNodes++},e.prototype.isVisible=function(){return this._entity._iIsVisible()},e.prototype.iRemoveNode=function(t){var e=this._pChildNodes.indexOf(t);this._pChildNodes.splice(e,1),this._childDepths.splice(e,1),this._numNodes--},e}(NodeBase),SceneGraphPartition=function(t){function e(e,i){void 0===i&&(i=!1);var r=t.call(this,e,i)||this;return r._rootNode=new SceneGraphNode(e,r),r}return __extends(e,t),e.prototype.getPartition=function(t){return new e(t)},e}(PartitionBase),SceneImage2D=function(t){function e(e,i,r,n,o,s){return void 0===r&&(r=!0),void 0===n&&(n=4294967295),void 0===o&&(o=!0),void 0===s&&(s=null),t.call(this,e,i,r,n,o,s)||this}return __extends(e,t),Object.defineProperty(e.prototype,"assetType",{get:function(){return e.assetType},enumerable:!0,configurable:!0}),e.prototype.createRenderer=function(){var t=new PerspectiveProjection;t.coordinateSystem=CoordinateSystem.RIGHT_HANDED,t.originX=-1,t.originY=1,e._root=new DisplayObjectContainer,e._renderer=RenderGroup.getInstance(new View(t,this._stage,null,null,null,!0),RendererType.DEFAULT).getRenderer(new SceneGraphPartition(e._root)),e._root.partition=e._renderer.partition,e._renderer.disableClear=!0,e._renderer.view.backgroundAlpha=0,e._renderer.view.projection=t,e._renderer.view.projection.transform=new Transform,e._renderer.view.projection.transform.moveTo(0,0,-1e3),e._renderer.view.projection.transform.lookAt(new Vector3D),e._renderer.renderableSorter=null},e.prototype.createBillboardRenderer=function(){var t=new PerspectiveProjection;t.coordinateSystem=CoordinateSystem.RIGHT_HANDED,t.originX=-1,t.originY=1,e._billboardRoot=new DisplayObjectContainer,e._billboardRenderer=RenderGroup.getInstance(new View(t,this._stage,null,null,null,!0),RendererType.DEFAULT).getRenderer(new SceneGraphPartition(e._billboardRoot)),e._billboardRoot.partition=e._billboardRenderer.partition,e._billboardRenderer.disableClear=!0,e._billboardRenderer.view.backgroundAlpha=0,e._billboardRenderer.view.projection=t,e._billboardRenderer.view.projection.transform=new Transform,e._billboardRenderer.view.projection.transform.moveTo(0,0,-1e3),e._billboardRenderer.view.projection.transform.lookAt(new Vector3D),e._billboardRenderer.renderableSorter=null;var i=new MethodMaterial(new BitmapImage2D(128,128,!1,0));i.bothSides=!0,i.alphaBlending=!0,i.alphaPremultiplied=!0,e._billboard=new Billboard(i),e._billboard.style=new Style,e._billboardRoot.addChild(e._billboard)},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.fillRect=function(t,i){e._renderer||this.createRenderer(),e._renderer.view.target=this,e._renderer.view.projection.scale=1e3/this.rect.height,e._renderer.view.x=t.x,e._renderer.view.y=t.y,e._renderer.view.width=t.width,e._renderer.view.height=t.height,e._renderer.view.backgroundAlpha=this._transparent?(i>>24)/255:1,e._renderer.view.backgroundColor=16777215&i,e._renderer.view.clear(!0,!0),this._imageDataDirty=!0},e.prototype.copyPixels=function(t,e,i,r,n,o){this._stage.context.setCulling(ContextGLTriangleFace.NONE),this._stage.context.setBlendFactors(ContextGLBlendFactor.ONE,ContextGLBlendFactor.ONE_MINUS_SOURCE_ALPHA),this._stage.copyPixels(t,this,e,i,r,n,o),this._imageDataDirty=!0},e.prototype.draw=function(t,i,r,n,o,s){if(t instanceof DisplayObject){e._renderer||this.createRenderer();var a=t.parent,l=a?a.getChildIndex(t):0,h=t.x,c=t.y,u=t.visible,p=t.transform.colorTransform.clone();return i?(e._root.transform.scaleTo(i.a,-i.d,1),e._root.transform.moveTo(i.tx,this.rect.height-i.ty,0)):(e._root.transform.scaleTo(1,-1,1),e._root.transform.moveTo(0,this.rect.height,0)),e._renderer.view.target=this,e._renderer.view.projection.scale=1e3/this.rect.height,e._renderer.view.x=0,e._renderer.view.y=0,e._renderer.view.width=this.width,e._renderer.view.height=this.height,e._root.removeChildren(0,e._root.numChildren),t.adapter.noReset=!0,e._root.addChild(t),t.adapter.noReset=!1,t.x=0,t.y=0,t.visible=!0,t.transform.colorTransform=null,e._renderer.render(),a&&(a.adapter&&a.adapter!=a&&t.adapter&&t.adapter!=t?(t.adapter.noReset=!0,a.adapter.addChildAt(t.adapter,l),t.adapter.noReset=!1):(t.adapter.noReset=!0,a.addChildAt(t,l),t.adapter.noReset=!1)),t.x=h,t.y=c,t.visible=u,t.transform.colorTransform=p,void(this._imageDataDirty=!0)}e._billboardRenderer||this.createBillboardRenderer(),e._billboardRenderer.disableClear=!0,e._billboardRenderer.view.target=this,e._billboardRenderer.view.projection.scale=1e3/this.rect.height,e._billboard.material.style.image=t,i?(e._billboardRoot.transform.scaleTo(i.a,-i.d,1),e._billboardRoot.transform.moveTo(i.tx,this.rect.height-i.ty,0)):(e._billboardRoot.transform.scaleTo(1,-1,1),e._billboardRoot.transform.moveTo(0,this.rect.height,0)),e._billboardRenderer.render(),this._imageDataDirty=!0},e.assetType="[image SceneImage2D]",e}(BitmapImage2D);Stage.registerAbstraction(_Stage_BitmapImage2D,SceneImage2D);var MouseManager=function(){function t(t){var e=this;this._sceneLookup=new Array,this._containerLookup=new Array,this.allowKeyInput=!0,this._collisionIsEnabledButton=!1,this._eventBubbling=!0,this._allowFocusOnUnfocusable=!0,this._nullVector=new Vector3D,this._queuedEvents=new Array,this._mouseUp=new MouseEvent(MouseEvent.MOUSE_UP),this._mouseUpOutside=new MouseEvent(MouseEvent.MOUSE_UP_OUTSIDE),this._mouseClick=new MouseEvent(MouseEvent.CLICK),this._mouseOut=new MouseEvent(MouseEvent.MOUSE_OUT),this._dragOut=new MouseEvent(MouseEvent.DRAG_OUT),this._dragOver=new MouseEvent(MouseEvent.DRAG_OVER),this._mouseDown=new MouseEvent(MouseEvent.MOUSE_DOWN),this._mouseMove=new MouseEvent(MouseEvent.MOUSE_MOVE),this._mouseOver=new MouseEvent(MouseEvent.MOUSE_OVER),this._mouseWheel=new MouseEvent(MouseEvent.MOUSE_WHEEL),this._mouseDoubleClick=new MouseEvent(MouseEvent.DOUBLE_CLICK),this._dragMove=new MouseEvent(MouseEvent.DRAG_MOVE),this._dragStart=new MouseEvent(MouseEvent.DRAG_START),this._dragStop=new MouseEvent(MouseEvent.DRAG_STOP),this._useSoftkeyboard=!1,this.isAVM1Dragging=!1,this._isDown=!1,this._pickGroup=t,this.onClickDelegate=function(t){return e.onClick(t)},this.onDoubleClickDelegate=function(t){return e.onDoubleClick(t)},this.onMouseDownDelegate=function(t){return e.onMouseDown(t)},this.onMouseMoveDelegate=function(t){return e.onMouseMove(t)},this.onMouseUpDelegate=function(t){return e.onMouseUp(t)},this.onMouseWheelDelegate=function(t){return e.onMouseWheel(t)},this.onMouseOverDelegate=function(t){return e.onMouseOver(t)},this.onMouseOutDelegate=function(t){return e.onMouseOut(t)},this.onKeyDownDelegate=function(t){return e.onKeyDown(t)},this.onKeyUpDelegate=function(t){return e.onKeyUp(t)},this.onFirstTouchDelegate=function(t){return e.onFirstTouch(t)},this.buttonEnabledDirty=!1,this._isTouch=!1,this._showCursor=!0,this._mouseDragging=!1,window.addEventListener("touchstart",this.onFirstTouchDelegate,!1)}return Object.defineProperty(t.prototype,"showCursor",{get:function(){return this._showCursor},set:function(t){this._showCursor=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventBubbling",{get:function(){return this._eventBubbling},set:function(t){this._eventBubbling=t},enumerable:!0,configurable:!0}),t.prototype.onFirstTouch=function(t){this._isTouch=!0,window.removeEventListener("touchstart",this.onFirstTouchDelegate,!1)},Object.defineProperty(t.prototype,"useSoftkeyboard",{get:function(){return this._useSoftkeyboard},set:function(t){this._useSoftkeyboard=t,t||BuildMode.mode!=BuildMode.AVM1?t&&(window.removeEventListener("keydown",this.onKeyDownDelegate),window.removeEventListener("keyup",this.onKeyUpDelegate)):(window.addEventListener("keydown",this.onKeyDownDelegate),window.addEventListener("keyup",this.onKeyUpDelegate))},enumerable:!0,configurable:!0}),t.prototype.registerContainer=function(t){t&&-1==this._containerLookup.indexOf(t)&&(t.addEventListener("click",this.onClickDelegate),t.addEventListener("dblclick",this.onDoubleClickDelegate),t.addEventListener("touchstart",this.onMouseDownDelegate),t.addEventListener("mousedown",this.onMouseDownDelegate),t.addEventListener("touchmove",this.onMouseMoveDelegate),t.addEventListener("mousemove",this.onMouseMoveDelegate),t.addEventListener("mouseup",this.onMouseUpDelegate),t.addEventListener("touchend",this.onMouseUpDelegate),t.addEventListener("touchend",this.onClickDelegate),t.addEventListener("mousewheel",this.onMouseWheelDelegate),t.addEventListener("mouseover",this.onMouseOverDelegate),t.addEventListener("mouseout",this.onMouseOutDelegate),window.addEventListener("keydown",this.onKeyDownDelegate),window.addEventListener("keyup",this.onKeyUpDelegate),this._containerLookup.push(t))},t.prototype.unregisterContainer=function(t){t&&-1!=this._containerLookup.indexOf(t)&&(t.removeEventListener("click",this.onClickDelegate),t.removeEventListener("dblclick",this.onDoubleClickDelegate),t.removeEventListener("touchstart",this.onMouseDownDelegate),t.removeEventListener("mousedown",this.onMouseDownDelegate),t.removeEventListener("touchmove",this.onMouseMoveDelegate),t.removeEventListener("mousemove",this.onMouseMoveDelegate),t.removeEventListener("mouseup",this.onMouseUpDelegate),t.removeEventListener("touchend",this.onMouseUpDelegate),t.removeEventListener("touchend",this.onClickDelegate),t.removeEventListener("mousewheel",this.onMouseWheelDelegate),t.removeEventListener("mouseover",this.onMouseOverDelegate),t.removeEventListener("mouseout",this.onMouseOutDelegate),window.removeEventListener("keydown",this.onKeyDownDelegate),window.removeEventListener("keyup",this.onKeyUpDelegate),this._containerLookup.splice(this._containerLookup.indexOf(t),1))},t.prototype.dispose=function(){this._stage=null,this.onClickDelegate=null,this.onDoubleClickDelegate=null,this.onMouseDownDelegate=null,this.onMouseMoveDelegate=null,this.onMouseUpDelegate=null,this.onMouseWheelDelegate=null,this.onMouseOverDelegate=null,this.onMouseOutDelegate=null,this.onKeyDownDelegate=null,this.onKeyUpDelegate=null,window.removeEventListener("touchstart",this.onFirstTouchDelegate),this.onFirstTouchDelegate=null,this._mouseMoveEvent=null,this._mouseUp=null,this._mouseUpOutside=null,this._mouseClick=null,this._mouseOut=null,this._dragOut=null,this._dragOver=null,this._mouseDown=null,this._mouseMove=null,this._mouseOver=null,this._mouseWheel=null,this._mouseDoubleClick=null,this._dragMove=null,this._dragStart=null,this._dragStop=null},t.clearInstance=function(){this._instance&&(this._instance.dispose(),this._instance=null)},t.getInstance=function(e){return this._instance?this._instance:e?this._instance=new t(e):new t(e)},t.prototype.setFocus=function(t){this._currentFocusEntity!=t&&(this._currentFocusEntity&&this._currentFocusEntity.setFocus(!1,!1),this._currentFocusEntity=t,this._currentFocusEntity&&this._currentFocusEntity.setFocus(!0,!1))},t.prototype.getFocus=function(){return this._currentFocusEntity},t.prototype.focusNextTab=function(){if(0!=this._sceneLookup.length){var t=this._sceneLookup[0].tabPicker.getNextTabEntity(this._currentFocusEntity);t!=this._currentFocusEntity&&(this._currentFocusEntity&&this._currentFocusEntity.setFocus(!1,!1),this._currentFocusEntity=t,this._currentFocusEntity.setFocus(!0,!1))}},t.prototype.focusPreviousTab=function(){if(0!=this._sceneLookup.length){var t=this._sceneLookup[0].tabPicker.getPrevTabEntity(this._currentFocusEntity);t!=this._currentFocusEntity&&(this._currentFocusEntity&&this._currentFocusEntity.setFocus(!1,!1),this._currentFocusEntity=t,this._currentFocusEntity.setFocus(!0,!1))}},t.prototype.dispatchEvent=function(t,e){if(this._eventBubbling)for(;e;)e._iIsMouseEnabled()&&e.dispatchEvent(t),e=e.parent;else e&&(e.dispatchEvent(t),FrameScriptManager.execute_queue())},t.prototype.setupAndDispatchEvent=function(t,e,i){t=this.setUpEvent(t,e,i),this.dispatchEvent(t,t.pickerEntity)},t.prototype.fireMouseEvents=function(t){if(this._iCollisionEntity=this._iCollision?this._iCollision.pickerEntity:null,this._iCollisionEntity!=this._prevICollisionEntity)this._prevICollisionEntity&&(this._isTouch||this._mouseDragging?this._mouseDragging&&this._mouseDragPickerEntity&&this._mouseDragPickerEntity==this._prevICollisionEntity&&this.queueDispatch(this._dragOut,this._mouseMoveEvent,this._prevICollision):this.queueDispatch(this._mouseOut,this._mouseMoveEvent,this._prevICollision)),this._collisionIsEnabledButton=!!this._iCollisionEntity&&this._iCollisionEntity.buttonEnabled,this._iCollisionEntity&&(this._isTouch||this._mouseDragging?this._mouseDragging&&this._mouseDragPickerEntity&&this._mouseDragPickerEntity==this._iCollisionEntity&&this.queueDispatch(this._dragOver,this._mouseMoveEvent,this._iCollision):this.queueDispatch(this._mouseOver,this._mouseMoveEvent,this._iCollision)),this._prevICollision=this._iCollision,this._prevICollisionEntity=this._iCollisionEntity;else{var e=!!this._iCollisionEntity&&this._iCollisionEntity.buttonEnabled;this._collisionIsEnabledButton!=e&&e&&(this._isTouch?this._mouseDragPickerEntity&&this._mouseDragPickerEntity==this._iCollisionEntity&&this.queueDispatch(this._dragOver,this._mouseMoveEvent,this._iCollision):this.queueDispatch(this._mouseOver,this._mouseMoveEvent,this._iCollision)),this._collisionIsEnabledButton=e}var i,r;this._mouseDragging||(document.body.style.cursor=this._showCursor?this._iCollisionEntity?this._iCollisionEntity.getMouseCursor():"initial":"none");for(var n=this._queuedEvents.length,o=0;o<n;++o)if(r=(i=this._queuedEvents[o]).pickerEntity,i.type==MouseEvent.MOUSE_DOWN)this._mouseDragging=!0,!this._eventBubbling&&this._stage&&this._stage.dispatchEvent(i),this._isTouch&&this.setupAndDispatchEvent(this._mouseOver,this._mouseMoveEvent,this._iCollision),this._mouseDragEntity=i.entity,this._mouseDragPickerEntity=i.pickerEntity,r&&this.dispatchEvent(i,r),(this._allowFocusOnUnfocusable||this._mouseDragPickerEntity&&this._mouseDragPickerEntity.tabEnabled)&&(this._currentFocusEntity&&this._currentFocusEntity.setFocus(!1,!0),this._currentFocusEntity=this._mouseDragPickerEntity,this._currentFocusEntity&&this._currentFocusEntity.setFocus(!0,!0)),this._mouseDragEntity&&this.setupAndDispatchEvent(this._dragStart,i,this._pickGroup.getAbstraction(this._mouseDragEntity).pickingCollision);else if(i.type==MouseEvent.MOUSE_UP){!this._eventBubbling&&this._stage&&this._stage.dispatchEvent(i);var s=null,a=null;this.isAVM1Dragging&&this._mouseDragPickerEntity?(a=this._mouseDragPickerEntity,s=this._mouseDragEntity):this._mouseDragging&&this._mouseDragPickerEntity&&this._mouseDragPickerEntity!=r?(this._mouseDragPickerEntity.buttonEnabled&&this.setupAndDispatchEvent(this._mouseOut,i,this._pickGroup.getAbstraction(this._mouseDragEntity).pickingCollision),this.setupAndDispatchEvent(this._mouseUpOutside,i,this._pickGroup.getAbstraction(this._mouseDragEntity).pickingCollision)):this._mouseDragging&&this._mouseDragPickerEntity&&this._mouseDragPickerEntity==r&&(a=this._mouseDragPickerEntity,s=this._mouseDragEntity),this._mouseDragging&&r&&this.setupAndDispatchEvent(this._mouseOver,i,this._iCollision),this._isTouch&&s&&this.setupAndDispatchEvent(this._mouseOut,this._mouseMoveEvent,this._pickGroup.getAbstraction(s).pickingCollision),a&&this.dispatchEvent(i,a),s&&this.setupAndDispatchEvent(this._dragStop,i,this._pickGroup.getAbstraction(s).pickingCollision),this._mouseDragPickerEntity=null,this._mouseDragEntity=null,this._mouseDragging=!1,this.isAVM1Dragging=!1}else i.type==MouseEvent.MOUSE_MOVE?(this._eventBubbling?this.dispatchEvent(i,i.pickerEntity):this._stage&&this._stage.dispatchEvent(i),this._mouseDragEntity&&this.setupAndDispatchEvent(this._dragMove,i,this._pickGroup.getAbstraction(this._mouseDragEntity).pickingCollision)):this.dispatchEvent(i,r);this._queuedEvents.length=0,this._iUpdateDirty=!1},t.prototype.registerScene=function(t){t&&this._sceneLookup.push(t)},t.prototype.unregisterScene=function(t){t&&this._sceneLookup.splice(this._sceneLookup.indexOf(t),1)},t.prototype.addEventsForSceneBinary=function(t,e){var i={clientX:null,clientY:null,touches:[],changedTouches:[],preventDefault:function(){}},r=new Float32Array(t),n=0,o=0;o++;var s=r[o++],a=r[o++],l=r[o++];if(1!=a&&6!=a&&12!=a&&262!=a&&518!=a){for(n=0;n<s;n++){(h={}).identifier=r[o++],h.clientX=r[o++],h.clientY=r[o++],i.touches[n]=h}i.changedTouches[0]=i.touches[l],i.changedTouches[0].clientX,i.changedTouches[0].clientY}else{if(1==s)(h={}).identifier=r[o++],h.clientX=r[o++],h.clientY=r[o++],i.clientX=h.clientX,i.clientY=h.clientY,i.clientX,i.clientY;else for(n=0;n<s;n++){var h;(h={}).identifier=r[o++],h.clientX=r[o++],h.clientY=r[o++],n!=l?i.touches[0]=h:(i.clientX=h.clientX,i.clientY=h.clientY,i.clientX,i.clientY)}}0==a||5==a||11==a||261==a||517==a?this.onMouseDown(i):1==a||6==a||12==a||262==a||518==a?this.onMouseUp(i):2==a?this.onMouseMove(i):console.log("recieved unknown touch event-type: "+a)},t.prototype.fireEventsForSceneFromString=function(t,e){var i={clientX:null,clientY:null,preventDefault:function(){}},r=t.split(","),n=0,o=0,s=parseInt(r[o++]),a=parseInt(r[o++]),l=parseInt(r[o++]);if(i.touches=[],i.changedTouches=[],1!=a&&6!=a){for(n=0;n<s;n++){(h={}).identifier=r[o++],h.clientX=r[o++],h.clientY=r[o++],i.touches[n]=h,i.changedTouches[n]=h}i.changedTouches[n]=i.touches[l]}else for(n=0;n<s;n++){var h;if(n!=l)(h={}).identifier=r[o++],h.clientX=r[o++],h.clientY=r[o++],i.touches[n]=h,i.changedTouches[n]=h;else i.clientX=r[o++],i.clientY=r[o++],o++}0==a?this.onMouseDown(i):1==a?this.onMouseUp(i):2==a?this.onMouseMove(i):261==a?this.onMouseDown(i):6==a&&this.onMouseUp(i)},t.prototype.setUpEvent=function(t,e,i){return e&&(t.delta=e.wheelDelta,t.ctrlKey=e.ctrlKey,t.altKey=e.altKey,t.shiftKey=e.shiftKey,t.screenX=null!=e.clientX?e.clientX:e.changedTouches?e.changedTouches[0].clientX:0,t.screenY=null!=e.clientY?e.clientY:e.changedTouches?e.changedTouches[0].clientY:0),i?(t.entity=i.entity,t.pickerEntity=i.pickerEntity,t.traversable=i.pickable,t.uv=i.uv,t.position=i.position?i.position.clone():null,t.normal=i.normal?i.normal.clone():null,t.elementIndex=i.elementIndex):(t.entity=null,t.pickerEntity=null,t.traversable=null,t.uv=null,t.position=this._nullVector,t.normal=this._nullVector,t.elementIndex=0),t},t.prototype.queueDispatch=function(t,e,i){this._queuedEvents.push(this.setUpEvent(t,e,i))},t.prototype.onKeyDown=function(t){if(this.allowKeyInput&&(t.preventDefault(),this._currentFocusEntity||this._stage)){var e=new KeyboardEvent(KeyboardEvent.KEYDOWN,t.key,t.code);e.isShift=t.shiftKey,e.isCTRL=t.ctrlKey,e.isAlt=t.altKey,e.keyCode=t.keyCode,this._currentFocusEntity&&this._currentFocusEntity.dispatchEvent(e),this._stage&&this._stage.dispatchEvent(e)}},t.prototype.onKeyUp=function(t){if(this.allowKeyInput&&(t.preventDefault(),this._currentFocusEntity||this._stage)){var e=new KeyboardEvent(KeyboardEvent.KEYUP,t.key,t.code);e.isShift=t.shiftKey,e.isCTRL=t.ctrlKey,e.isAlt=t.altKey,e.keyCode=t.keyCode,this._currentFocusEntity&&this._currentFocusEntity.dispatchEvent(e),this._stage&&this._stage.dispatchEvent(e)}},t.prototype.onMouseMove=function(t){this._isTouch="mousemove"!=t.type,this.updateColliders(t),this.queueDispatch(this._mouseMove,this._mouseMoveEvent=t,this._iCollision)},t.prototype.onMouseOut=function(t){this.updateColliders(t),this.queueDispatch(this._mouseOut,t,this._iCollision)},t.prototype.onMouseOver=function(t){this.updateColliders(t),this.queueDispatch(this._mouseOver,t,this._iCollision)},t.prototype.onClick=function(t){this.updateColliders(t),this.queueDispatch(this._mouseClick,t,this._iCollision)},t.prototype.onDoubleClick=function(t){this.updateColliders(t),this.queueDispatch(this._mouseDoubleClick,t,this._iCollision)},t.prototype.onMouseDown=function(t){if(!this._isDown){if(this._isDown=!0,this.updateColliders(t),this._isTouch)for(var e in t.preventDefault(),this._containerLookup)this._containerLookup[e].focus();this.queueDispatch(this._mouseDown,t,this._iCollision)}},t.prototype.onMouseUp=function(t){if(this._isDown){if(this._isDown=!1,this.updateColliders(t),this._isTouch)for(var e in t.preventDefault(),this._containerLookup)this._containerLookup[e].focus();this.queueDispatch(this._mouseUp,t,this._iCollision)}},t.prototype.onMouseWheel=function(t){this.updateColliders(t),this.queueDispatch(this._mouseWheel,t,this._iCollision)},t.prototype.updateColliders=function(t){for(var e,i=null!=t.clientX?t.clientX:t.changedTouches[0].clientX,r=null!=t.clientY?t.clientY:t.changedTouches[0].clientY,n=this._sceneLookup.length,o=0;o<n;o++){if((e=this._sceneLookup[o])._touchPoints.length=0,t.touches)for(var s,a=t.touches.length,l=0;l<a;l++)s=t.touches[l],e._touchPoints.push(new TouchPoint(s.clientX+e.view.x,s.clientY+e.view.y,s.identifier));if(!this._iUpdateDirty&&(e._mouseX=i<e.view.x?e.view.x:i>e.view.x+e.view.width?e.view.x+e.view.width:i-e.view.x,e._mouseY=r<e.view.y?e.view.y:r>e.view.y+e.view.height?e.view.y+e.view.height:r-e.view.y,e.updateCollider(),e.layeredView&&this._iCollision))break}this._iUpdateDirty=!0},t}(),PrimitiveCapsulePrefab=function(t){function e(e,i,r,n,o,s,a){void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=50),void 0===n&&(n=100),void 0===o&&(o=16),void 0===s&&(s=15),void 0===a&&(a=!0);var l=t.call(this,e,i)||this;return l._numVertices=0,l._radius=r,l._height=n,l._segmentsW=o,l._segmentsH=s%2==0?s+1:s,l._yUp=a,l}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t%2==0?t+1:t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){var i,r,n,o,s,a,l,h,c,u,p,d,f=0,_=0,g=0;if(e==ElementsType.TRIANGLE){var m=t;for(this._numVertices=(this._segmentsH+1)*(this._segmentsW+1),g=(this._segmentsH-1)*this._segmentsW*6,this._numVertices==m.numVertices?(m.invalidateIndices(),m.invalidateVertices(m.positions),m.invalidateVertices(m.normals),m.invalidateVertices(m.tangents)):(m.setIndices(new Uint16Array(g)),m.setPositions(new Float32Array(3*this._numVertices)),m.setNormals(new Float32Array(3*this._numVertices)),m.setTangents(new Float32Array(3*this._numVertices)),this._pInvalidateUVs()),i=m.indices.get(m.numElements),r=m.positions.get(this._numVertices),n=m.normals.get(this._numVertices),o=m.tangents.get(this._numVertices),s=m.concatenatedBuffer.stride/4,l=0;l<=this._segmentsH;++l){var y=Math.PI*l/this._segmentsH,v=-this._radius*Math.cos(y),b=this._radius*Math.sin(y);for(h=_,a=0;a<=this._segmentsW;++a){var x=2*Math.PI*a/this._segmentsW,A=b*Math.cos(x),E=l>this._segmentsH/2?this._height/2:-this._height/2,S=b*Math.sin(x),T=1/Math.sqrt(A*A+S*S+v*v),P=Math.sqrt(S*S+A*A);if(this._yUp?(p=0,d=P>.007?A/P:0,c=-v,u=S):(p=P>.007?A/P:0,d=0,c=S,u=v),a==this._segmentsW?(r[_]=r[h],r[_+1]=r[h+1],r[_+2]=r[h+2],n[_]=.5*(n[h]+A*T),n[_+1]=.5*(n[h+1]+c*T),n[_+2]=.5*(n[h+2]+u*T),o[_]=.5*(o[h]+(P>.007?-S/P:1)),o[_+1]=.5*(o[h+1]+p),o[_+2]=.5*(o[h+2]+d)):(r[_]=A,r[_+1]=this._yUp?c-E:c,r[_+2]=this._yUp?u:u+E,n[_]=A*T,n[_+1]=c*T,n[_+2]=u*T,o[_]=P>.007?-S/P:1,o[_+1]=p,o[_+2]=d),a>0&&l>0){var C=(this._segmentsW+1)*l+a,w=(this._segmentsW+1)*l+a-1,D=(this._segmentsW+1)*(l-1)+a-1,M=(this._segmentsW+1)*(l-1)+a;l==this._segmentsH?(r[_]=r[h],r[_+1]=r[h+1],r[_+2]=r[h+2],i[f++]=C,i[f++]=D,i[f++]=M):1==l?(i[f++]=C,i[f++]=w,i[f++]=D):(i[f++]=C,i[f++]=w,i[f++]=D,i[f++]=C,i[f++]=D,i[f++]=M)}_+=s}}}},e.prototype._pBuildUVs=function(t,e){var i,r,n,o;if(e==ElementsType.TRIANGLE){var s=t;s.uvs&&this._numVertices==s.numVertices?s.invalidateVertices(s.uvs):s.setUVs(new Float32Array(2*this._numVertices)),n=s.uvs.get(this._numVertices),o=s.uvs.stride;var a=0;for(r=0;r<=this._segmentsH;++r)for(i=0;i<=this._segmentsW;++i)n[a]=i/this._segmentsW*this._scaleU,n[a+1]=r/this._segmentsH*this._scaleV,a+=o}},e}(PrimitivePrefabBase),PrimitiveCylinderPrefab=function(t){function e(e,i,r,n,o,s,a,l,h,c,u){void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=50),void 0===n&&(n=50),void 0===o&&(o=100),void 0===s&&(s=16),void 0===a&&(a=1),void 0===l&&(l=!0),void 0===h&&(h=!0),void 0===c&&(c=!0),void 0===u&&(u=!0);var p=t.call(this,e,i)||this;return p._numVertices=0,p._topRadius=r,p._pBottomRadius=n,p._height=o,p._pSegmentsW=s,p._pSegmentsH=a,p._topClosed=l,p._bottomClosed=h,p._surfaceClosed=c,p._yUp=u,p}return __extends(e,t),Object.defineProperty(e.prototype,"topRadius",{get:function(){return this._topRadius},set:function(t){this._topRadius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRadius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._pSegmentsW},set:function(t){this.setSegmentsW(t)},enumerable:!0,configurable:!0}),e.prototype.setSegmentsW=function(t){this._pSegmentsW=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._pSegmentsH},set:function(t){this.setSegmentsH(t)},enumerable:!0,configurable:!0}),e.prototype.setSegmentsH=function(t){this._pSegmentsH=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},Object.defineProperty(e.prototype,"topClosed",{get:function(){return this._topClosed},set:function(t){this._topClosed=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomClosed",{get:function(){return this._bottomClosed},set:function(t){this._bottomClosed=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){var i,r,n,o,s,a,l,h,c,u,p,d,f,_,g,m,y,v,b,x,A,E=0,S=0,T=0,P=0;this._numVertices=0;var C=2*Math.PI/this._pSegmentsW;if(e==ElementsType.TRIANGLE){var w,D,M,O,I,L,N,F,R=t;if(this._surfaceClosed&&(this._numVertices+=(this._pSegmentsH+1)*(this._pSegmentsW+1),E+=this._pSegmentsH*this._pSegmentsW*6),this._topClosed&&(this._numVertices+=2*(this._pSegmentsW+1),E+=3*this._pSegmentsW),this._bottomClosed&&(this._numVertices+=2*(this._pSegmentsW+1),E+=3*this._pSegmentsW),this._numVertices==R.numVertices?(R.positions.invalidate(),R.normals.invalidate(),R.tangents.invalidate(),R.indices.invalidate()):(R.setIndices(new Uint16Array(E)),R.setPositions(new Float32Array(3*this._numVertices)),R.setNormals(new Float32Array(3*this._numVertices)),R.setTangents(new Float32Array(3*this._numVertices)),this._pInvalidateUVs()),i=R.indices.get(R.numElements),r=R.positions.get(this._numVertices),n=R.normals.get(this._numVertices),o=R.tangents.get(this._numVertices),s=R.concatenatedBuffer.stride/4,p=0,d=0,this._topClosed&&this._topRadius>0)for(u=-.5*this._height,this._yUp?(x=1,A=0,v=-u,b=0):(x=0,A=-1,v=0,b=u),r[p]=0,r[p+1]=v,r[p+2]=b,n[p]=0,n[p+1]=x,n[p+2]=A,o[p]=1,o[p+1]=0,o[p+2]=0,p+=s,T++,a=0;a<=this._pSegmentsW;++a)_=a*C,h=this._topRadius*Math.cos(_),c=this._topRadius*Math.sin(_),this._yUp?(v=-u,b=c):(v=c,b=u),a==this._pSegmentsW?(r[p]=r[S+s],r[p+1]=r[S+s+1],r[p+2]=r[S+s+2]):(r[p]=h,r[p+1]=v,r[p+2]=b),n[p]=0,n[p+1]=x,n[p+2]=A,o[p]=1,o[p+1]=0,o[p+2]=0,p+=s,a>0&&(i[d++]=T-1,i[d++]=P,i[d++]=T),T++;if(this._bottomClosed&&this._pBottomRadius>0)for(u=.5*this._height,S=T*s,P=T,this._yUp?(x=-1,A=0,v=-u,b=0):(x=0,A=1,v=0,b=u),a>0&&(r[p]=0,r[p+1]=v,r[p+2]=b,n[p]=0,n[p+1]=x,n[p+2]=A,o[p]=1,o[p+1]=0,o[p+2]=0,p+=s),T++,a=0;a<=this._pSegmentsW;++a)_=a*C,h=this._pBottomRadius*Math.cos(_),c=this._pBottomRadius*Math.sin(_),this._yUp?(v=-u,b=c):(v=c,b=u),a==this._pSegmentsW?(r[p]=r[S+s],r[p+1]=r[S+s+1],r[p+2]=r[S+s+2]):(r[p]=h,r[p+1]=v,r[p+2]=b),n[p]=0,n[p+1]=x,n[p+2]=A,o[p]=1,o[p+1]=0,o[p+2]=0,p+=s,a>0&&(i[d++]=T-1,i[d++]=T,i[d++]=P),T++;if(y=0==(m=(g=this._pBottomRadius-this._topRadius)/this._height)?1:this._height/g,this._surfaceClosed)for(l=0;l<=this._pSegmentsH;++l)for(f=this._topRadius-l/this._pSegmentsH*(this._topRadius-this._pBottomRadius),u=-this._height/2+l/this._pSegmentsH*this._height,S=T*s,a=0;a<=this._pSegmentsW;++a)_=a*C,h=f*Math.cos(_),c=f*Math.sin(_),I=y*Math.cos(_),L=y*Math.sin(_),this._yUp?(x=0,A=-I,v=-u,b=c,N=m,F=L):(x=-I,A=0,v=c,b=u,N=L,F=m),a==this._pSegmentsW?(r[p]=r[S],r[p+1]=r[S+1],r[p+2]=r[S+2],n[p]=I,n[p+1]=m,n[p+2]=L,o[p]=L,o[p+1]=x,o[p+2]=A):(r[p]=h,r[p+1]=v,r[p+2]=b,n[p]=I,n[p+1]=N,n[p+2]=F,o[p]=-L,o[p+1]=x,o[p+2]=A),p+=s,a>0&&l>0&&(w=T,M=(D=T-1)-this._pSegmentsW-1,O=w-this._pSegmentsW-1,i[d++]=w,i[d++]=D,i[d++]=M,i[d++]=w,i[d++]=M,i[d++]=O),T++}else if(e==ElementsType.LINE){var B=t,V=this._pSegmentsH*this._pSegmentsW*2+this._pSegmentsW;r=new Float32Array(6*V);var k=new Float32Array(V);for(p=0,d=0,l=0;l<=this._pSegmentsH;++l)for(f=this._topRadius-l/this._pSegmentsH*(this._topRadius-this._pBottomRadius),u=-this._height/2+l/this._pSegmentsH*this._height,a=0;a<=this._pSegmentsW;++a){if(_=a*C,h=f*Math.cos(_),c=f*Math.sin(_),this._yUp?(v=-u,b=c):(v=c,b=u),a>0&&(r[p++]=h,r[p++]=v,r[p++]=b,k[d++]=1,l>0)){var U=1==l?3-(6*(this._pSegmentsW-a)+12*a):3-12*this._pSegmentsW;r[p]=r[p+++U],r[p]=r[p+++U],r[p]=r[p+++U],r[p++]=h,r[p++]=v,r[p++]=b,k[d++]=1}a<this._pSegmentsW&&(r[p++]=h,r[p++]=v,r[p++]=b)}B.setPositions(r),B.setThickness(k)}},e.prototype._pBuildUVs=function(t,e){var i,r,n,o,s,a,l;if(e==ElementsType.TRIANGLE){var h=t;h.uvs&&this._numVertices==h.numVertices?h.invalidateVertices(h.uvs):h.setUVs(new Float32Array(2*this._numVertices)),a=h.uvs.get(this._numVertices),l=h.uvs.stride;var c=2*Math.PI/this._pSegmentsW,u=0;if(this._topClosed)for(a[u]=.5*this._scaleU,a[u+1]=.5*this._scaleV,u+=l,i=0;i<=this._pSegmentsW;++i)s=i*c,n=.5+.5*-Math.cos(s),o=.5+.5*Math.sin(s),a[u]=n*this._scaleU,a[u+1]=o*this._scaleV,u+=l;if(this._bottomClosed)for(a[u]=.5*this._scaleU,a[u+1]=.5*this._scaleV,u+=l,i=0;i<=this._pSegmentsW;++i)s=i*c,n=.5+.5*Math.cos(s),o=.5+.5*Math.sin(s),a[u]=n*this._scaleU,a[u+1]=o*this._scaleV,u+=l;if(this._surfaceClosed)for(r=0;r<=this._pSegmentsH;++r)for(i=0;i<=this._pSegmentsW;++i)a[u]=i/this._pSegmentsW*this._scaleU,a[u+1]=r/this._pSegmentsH*this._scaleV,u+=l}},e}(PrimitivePrefabBase),PrimitiveConePrefab=function(t){function e(e,i,r,n,o,s,a,l){return void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=50),void 0===n&&(n=100),void 0===o&&(o=16),void 0===s&&(s=1),void 0===a&&(a=!0),void 0===l&&(l=!0),t.call(this,e,i,0,r,n,o,s,!1,a,!0,l)||this}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),e}(PrimitiveCylinderPrefab),PrimitivePlanePrefab=function(t){function e(e,i,r,n,o,s,a,l){void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=100),void 0===n&&(n=100),void 0===o&&(o=1),void 0===s&&(s=1),void 0===a&&(a=!0),void 0===l&&(l=!1);var h=t.call(this,e,i)||this;return h._segmentsW=o,h._segmentsH=s,h._yUp=a,h._width=r,h._height=n,h._doubleSided=l,h}return __extends(e,t),Object.defineProperty(e.prototype,"segmentsW",{get:function(){return this._segmentsW},set:function(t){this._segmentsW=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsH",{get:function(){return this._segmentsH},set:function(t){this._segmentsH=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleSided",{get:function(){return this._doubleSided},set:function(t){this._doubleSided=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){var i,r,n,o,s,a,l,h,c,u,p=this._segmentsW+1;if(e==ElementsType.TRIANGLE){var d,f,_=t,g=(this._segmentsH+1)*p;for(this._doubleSided&&(g*=2),o=this._segmentsH*this._segmentsW*6,this._doubleSided&&(o*=2),null!=_.indices&&o==_.indices.length?_.invalidateIndices():(_.setIndices(new Uint16Array(o)),this._pInvalidateUVs()),i=_.indices.get(_.numElements),g==_.numVertices?(_.invalidateVertices(_.positions),_.invalidateVertices(_.normals),_.invalidateVertices(_.tangents)):(_.setPositions(new Float32Array(3*g)),_.setNormals(new Float32Array(3*g)),_.setTangents(new Float32Array(3*g)),this._pInvalidateUVs()),v=_.positions.get(g),d=_.normals.get(g),f=_.tangents.get(g),s=_.concatenatedBuffer.stride/4,h=0,l=0,u=0;u<=this._segmentsH;++u)for(c=0;c<=this._segmentsW;++c){if(r=(c/this._segmentsW-.5)*this._width,n=(u/this._segmentsH-.5)*this._height,v[l]=r,this._yUp?(v[l+1]=0,v[l+2]=n):(v[l+1]=n,v[l+2]=0),d[l]=0,this._yUp?(d[l+1]=1,d[l+2]=0):(d[l+1]=0,d[l+2]=-1),f[l]=1,f[l+1]=0,f[l+2]=0,l+=s,this._doubleSided){for(var m=l;m<l+3;++m)v[m]=v[m-3],d[m]=-d[m-3],f[m]=-f[m-3];l+=s}if(c!=this._segmentsW&&u!=this._segmentsH){a=c+u*p;var y=this._doubleSided?2:1;i[h++]=a*y,i[h++]=(a+p)*y,i[h++]=(a+p+1)*y,i[h++]=a*y,i[h++]=(a+p+1)*y,i[h++]=(a+1)*y,this._doubleSided&&(i[h++]=(a+p+1)*y+1,i[h++]=(a+p)*y+1,i[h++]=a*y+1,i[h++]=(a+1)*y+1,i[h++]=(a+p+1)*y+1,i[h++]=a*y+1)}}}else if(e==ElementsType.LINE){var v,b,x=t,A=this._segmentsH+1+p,E=this._width/2,S=this._height/2;for(v=new Float32Array(6*A),b=new Float32Array(A),h=0,l=0,u=0;u<=this._segmentsH;++u)v[l++]=-E,v[l++]=0,v[l++]=u*this._height-S,v[l++]=E,v[l++]=0,v[l++]=u*this._height-S,b[h++]=1;for(c=0;c<=this._segmentsW;++c)v[l++]=c*this._width-E,v[l++]=0,v[l++]=-S,v[l++]=c*this._width-E,v[l++]=0,v[l++]=S,b[h++]=1;x.setPositions(v),x.setThickness(b)}},e.prototype._pBuildUVs=function(t,e){var i,r,n;if(e==ElementsType.TRIANGLE){n=(this._segmentsH+1)*(this._segmentsW+1),this._doubleSided&&(n*=2);var o=t;o.uvs&&n==o.numVertices?o.invalidateVertices(o.uvs):o.setUVs(new Float32Array(2*n)),i=o.uvs.get(n),r=o.uvs.stride;for(var s=0,a=0;a<=this._segmentsH;++a)for(var l=0;l<=this._segmentsW;++l)i[s]=l/this._segmentsW*this._scaleU,i[s+1]=(1-a/this._segmentsH)*this._scaleV,s+=r,this._doubleSided&&(i[s]=l/this._segmentsW*this._scaleU,i[s+1]=(1-a/this._segmentsH)*this._scaleV,s+=r)}},e}(PrimitivePrefabBase),PrimitivePolygonPrefab=function(t){function e(e,i,r,n,o){return void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=100),void 0===n&&(n=16),void 0===o&&(o=!0),t.call(this,e,i,r,0,0,n,1,!0,!1,!1,o)||this}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._pBottomRadius},set:function(t){this._pBottomRadius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sides",{get:function(){return this._pSegmentsW},set:function(t){this.setSegmentsW(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisions",{get:function(){return this._pSegmentsH},set:function(t){this.setSegmentsH(t)},enumerable:!0,configurable:!0}),e}(PrimitiveCylinderPrefab),PrimitiveTorusPrefab=function(t){function e(e,i,r,n,o,s,a){void 0===e&&(e=null),void 0===i&&(i="triangle"),void 0===r&&(r=50),void 0===n&&(n=50),void 0===o&&(o=16),void 0===s&&(s=8),void 0===a&&(a=!0);var l=t.call(this,e,i)||this;return l._numVertices=0,l._radius=r,l._tubeRadius=n,l._segmentsR=o,l._segmentsT=s,l._yUp=a,l}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tubeRadius",{get:function(){return this._tubeRadius},set:function(t){this._tubeRadius=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsR",{get:function(){return this._segmentsR},set:function(t){this._segmentsR=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentsT",{get:function(){return this._segmentsT},set:function(t){this._segmentsT=t,this._pInvalidatePrimitive(),this._pInvalidateUVs()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yUp",{get:function(){return this._yUp},set:function(t){this._yUp=t,this._pInvalidatePrimitive()},enumerable:!0,configurable:!0}),e.prototype._pBuildGraphics=function(t,e){var i,r,n,o,s,a,l,h,c,u,p,d,f,_,g,m,y,v=0;if(e==ElementsType.TRIANGLE){var b=t;this._numVertices=(this._segmentsT+1)*(this._segmentsR+1),v=this._segmentsT*this._segmentsR*6,this._numVertices==b.numVertices?(b.invalidateIndices(),b.invalidateVertices(b.positions),b.invalidateVertices(b.normals),b.invalidateVertices(b.tangents)):(b.setIndices(new Uint16Array(v)),b.setPositions(new Float32Array(3*this._numVertices)),b.setNormals(new Float32Array(3*this._numVertices)),b.setTangents(new Float32Array(3*this._numVertices)),this._pInvalidateUVs()),i=b.indices.get(b.numElements),r=b.positions.get(this._numVertices),n=b.normals.get(this._numVertices),o=b.tangents.get(this._numVertices),s=b.concatenatedBuffer.stride/4,m=0,y=0;var x,A,E,S,T,P,C,w,D,M,O,I=2*Math.PI/this._segmentsR,L=2*Math.PI/this._segmentsT,N=0,F=0;for(l=0;l<=this._segmentsT;++l)for(N=m,a=0;a<=this._segmentsR;++a)_=a*I,g=l*L,p=(O=Math.cos(g))*Math.cos(_),d=O*Math.sin(_),f=Math.sin(g),h=this._radius*Math.cos(_)+this._tubeRadius*p,c=this._radius*Math.sin(_)+this._tubeRadius*d,u=l==this._segmentsT?0:this._tubeRadius*f,this._yUp?(T=-f,P=d,E=0,S=O?p/O:h/this._radius,x=-u,A=c):(T=d,P=f,E=O?p/O:h/this._radius,S=0,x=c,A=u),a==this._segmentsR?(r[m]=h,r[m+1]=r[N+1],r[m+2]=r[N+2]):(r[m]=h,r[m+1]=x,r[m+2]=A),n[m]=p,n[m+1]=T,n[m+2]=P,o[m]=-(O?d/O:c/this._radius),o[m+1]=E,o[m+2]=S,m+=s,a>0&&l>0&&(C=F,D=(w=F-1)-this._segmentsR-1,M=C-this._segmentsR-1,i[y++]=C,i[y++]=w,i[y++]=D,i[y++]=C,i[y++]=D,i[y++]=M),F++}},e.prototype._pBuildUVs=function(t,e){var i,r,n,o;if(e==ElementsType.TRIANGLE){var s=t;s.uvs&&this._numVertices==s.numVertices?s.invalidateVertices(s.uvs):s.setUVs(new Float32Array(2*this._numVertices)),n=s.uvs.get(this._numVertices),o=s.uvs.stride;var a=0;for(r=0;r<=this._segmentsT;++r)for(i=0;i<=this._segmentsR;++i)n[a]=i/this._segmentsR*this._scaleU,n[a+1]=r/this._segmentsT*this._scaleV,a+=o}},e}(PrimitivePrefabBase),Merge=function(){function t(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),this._keepMaterial=t,this._disposeSources=e,this._objectSpace=i}return Object.defineProperty(t.prototype,"disposeSources",{get:function(){return this._disposeSources},set:function(t){this._disposeSources=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keepMaterial",{get:function(){return this._keepMaterial},set:function(t){this._keepMaterial=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"objectSpace",{get:function(){return this._objectSpace},set:function(t){this._objectSpace=t},enumerable:!0,configurable:!0}),t.prototype.applyToContainer=function(t,e){this.reset(),this.parseContainer(t,e),this.collect(t,!1),this.merge(t,this._disposeSources)},t.prototype.applyToSprites=function(t,e){if(this.reset(),e.length){for(var i=0;i<e.length;i++)e[i]!=t&&this.collect(e[i],this._disposeSources);this.collect(t,!1),this.merge(t,this._disposeSources)}},t.prototype.apply=function(t,e){this.reset(),this.collect(e,this._disposeSources),this.collect(t,!1),this.merge(t,this._disposeSources)},t.prototype.reset=function(){this._toDispose=new Array,this._shapeVOs=new Array},t.prototype.merge=function(t,e){var i,r;for(i=t.graphics,r=this._shapeVOs.length>1,s=0;s<this._shapeVOs.length;s++){var n=new TriangleElements(new AttributesBuffer);n.autoDeriveNormals=!1,n.autoDeriveTangents=!1;var o=this._shapeVOs[s];n.setIndices(o.indices),n.setPositions(o.vertices),n.setNormals(o.normals),n.setTangents(o.tangents),n.setUVs(o.uvs),this._keepMaterial&&r?i.addShape(Shape.getShape(n,o.material)):i.addShape(Shape.getShape(n))}if(this._keepMaterial&&!r&&this._shapeVOs.length&&(t.material=this._shapeVOs[0].material),e)for(var s,a=this._toDispose.length;s<a;s++)this._toDispose[s].dispose();this._toDispose=null},t.prototype.collect=function(t,e){var i,r;for(i=0;i<t.graphics.count;i++){var n,o,s,a,l,h,c,u,p,d,f,_,g,m;for(p=t.graphics.getShapeAt(i).elements,d=this.getShapeData(t.graphics.getShapeAt(i).material),f=this._objectSpace?d.vertices:new Array,_=this._objectSpace?d.normals:new Array,g=this._objectSpace?d.tangents:new Array,a=f.length,l=_.length,h=g.length,c=d.uvs.length,this.copyAttributes(p.positions,f,p.numVertices,a),this.copyAttributes(p.normals,_,p.numVertices,l),this.copyAttributes(p.tangents,g,p.numVertices,h),this.copyAttributes(p.uvs,d.uvs,p.numVertices,c),u=this._objectSpace?0:d.vertices.length/3,s=d.indices.length,o=p.numElements,m=p.indices.get(o),n=0;n<o;n++)r=3*n,d.indices[s++]=m[r]+u,d.indices[s++]=m[r+1]+u,d.indices[s++]=m[r+2]+u;if(!this._objectSpace)for(t.transform.concatenatedMatrix3D.transformVectors(f,f),t.transform.concatenatedMatrix3D.deltaTransformVectors(_,_),t.transform.concatenatedMatrix3D.deltaTransformVectors(g,g),a=d.vertices.length,l=d.normals.length,h=d.tangents.length,o=f.length,n=0;n<o;n++)d.vertices[a++]=f[n],d.normals[l++]=_[n],d.tangents[h++]=g[n]}e&&this._toDispose.push(t)},t.prototype.copyAttributes=function(t,e,i,r){for(var n=t.get(i),o=t.dimensions,s=t.stride,a=i*s,l=0;l<a;l+=s)for(var h=0;h<o;h++)e[r++]=n[l+h]},t.prototype.getShapeData=function(t){var e,i,r;if(this._keepMaterial){for(r=this._shapeVOs.length,i=0;i<r;i++)if(this._shapeVOs[i].material==t){e=this._shapeVOs[i];break}}else this._shapeVOs.length&&(e=this._shapeVOs[0]);return e||((e=new ShapeVO).vertices=new Array,e.normals=new Array,e.tangents=new Array,e.uvs=new Array,e.indices=new Array,e.material=t,this._shapeVOs.push(e)),e},t.prototype.parseContainer=function(t,e){var i,r;for(e instanceof Sprite&&e!=t&&this.collect(e,this._disposeSources),r=0;r<e.numChildren;++r)i=e.getChildAt(r),this.parseContainer(t,i)},t}(),ShapeVO=function(){},Scene=function(){function t(t,e,i,r){var n=this;void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),this._time=0,this._deltaTime=0,this._touchPoints=new Array,this._onProjectionChangedDelegate=function(t){return n._onProjectionChanged(t)},this._rendererType=r||RendererType.DEFAULT,this.view=i||new View,this.partition=t||new BasicPartition(new DisplayObjectContainer),this.camera=e||new Camera}return Object.defineProperty(t.prototype,"partition",{get:function(){return this._partition},set:function(t){this._partition!=t&&(this._partition=t,this._mousePicker=this._pickGroup.getRaycastPicker(this._partition),this._tabPicker=this._pickGroup.getTabPicker(this._partition),this._mousePicker.findClosestCollision=!0,this._camera&&(this._camera.clear(),this._partition.invalidateEntity(this._camera),this._camera.partition=this._partition),this._mousePicker=this._pickGroup.getRaycastPicker(this._partition),this._tabPicker=this._pickGroup.getTabPicker(this._partition),this._mousePicker.findClosestCollision=!0,this._partition.root.partition=this._partition)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},set:function(t){this._view!=t&&(this._view&&this._mouseManager.unregisterContainer(this._view.stage.container),this._view=t,this._pickGroup=PickGroup.getInstance(this._view),this._mouseManager=MouseManager.getInstance(this._pickGroup),this._mouseManager.registerContainer(this._view.stage.container),this._mouseManager.registerScene(this),this._camera&&(this._view.projection=this._camera.projection),this._disposeRenderer())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer||(this._renderer=RenderGroup.getInstance(this._view,this._rendererType).getRenderer(this._partition)),this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._partition.root},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseX",{get:function(){return this._mouseX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseY",{get:function(){return this._mouseY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchPoints",{get:function(){return this._touchPoints},enumerable:!0,configurable:!0}),t.prototype.getLocalMouseX=function(t){return t.transform.inverseConcatenatedMatrix3D.transformVector(this._renderer.view.unproject(this._mouseX,this._mouseY,1e3)).x},t.prototype.getLocalMouseY=function(t){return t.transform.inverseConcatenatedMatrix3D.transformVector(this._renderer.view.unproject(this._mouseX,this._mouseY,1e3)).y},t.prototype.getLocalTouchPoints=function(t){for(var e,i=new Array,r=this._touchPoints.length,n=0;n<r;n++)e=t.transform.inverseConcatenatedMatrix3D.transformVector(this._renderer.view.unproject(this._touchPoints[n].x,this._touchPoints[n].y,1e3)),i.push(new TouchPoint(e.x,e.y,this._touchPoints[n].id));return i},Object.defineProperty(t.prototype,"rendererType",{get:function(){return this._rendererType},set:function(t){this._rendererType!=t&&(this._rendererType=t,this._disposeRenderer())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera!=t&&(this._camera&&(this._camera.clear(),this._camera.removeEventListener(CameraEvent.PROJECTION_CHANGED,this._onProjectionChangedDelegate)),this._camera=t,this._camera.addEventListener(CameraEvent.PROJECTION_CHANGED,this._onProjectionChangedDelegate),this._view&&(this._view.projection=this._camera.projection),this._partition.invalidateEntity(this._camera),this._camera.partition=this._partition)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this._deltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseManager",{get:function(){return this._mouseManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mousePicker",{get:function(){return this._mousePicker},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabPicker",{get:function(){return this._tabPicker},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderedFacesCount",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype.render=function(){this._updateTime(),this._renderer||(this._renderer=RenderGroup.getInstance(this._view,this._rendererType).getRenderer(this._partition)),this.disableMouseEvents||(this.forceMouseMove&&!this._mouseManager._iUpdateDirty&&(this._mouseManager._iCollision=this.getViewCollision(this._mouseX,this._mouseY,this._view)),this._mouseManager.fireMouseEvents(this.forceMouseMove)),this.beforeRenderCallback&&this.beforeRenderCallback(),this._renderer.render()},t.prototype._updateTime=function(){var t=getTimer();0==this._time&&(this._time=t),this._deltaTime=t-this._time,this._time=t},t.prototype._disposeRenderer=function(){this._renderer&&(this._renderer.dispose(),this._renderer=null)},t.prototype.dispose=function(){this._disposeRenderer(),this._mouseManager.unregisterScene(this),this._mouseManager=null},t.prototype._onProjectionChanged=function(t){this._view.projection=this._camera.projection},t.prototype.updateCollider=function(){this.disableMouseEvents||(this._mouseManager._iCollision=this.getViewCollision(this._mouseX,this._mouseY,this._view))},t.prototype.getViewCollision=function(t,e,i){var r=i.unproject(t,e,0),n=i.unproject(t,e,1).subtract(r);return this._mousePicker.getCollision(r,n)},t}();console.debug("AwayJS - Scene - 0.12.59");var SOUND_SIZE_16_BIT=1,SOUND_TYPE_STEREO=1,SOUND_FORMAT_PCM_BE=0,SOUND_FORMAT_ADPCM=1,SOUND_FORMAT_MP3=2,SOUND_FORMAT_PCM_LE=3,SOUND_RATES=[5512,11250,22500,44100],WaveHeader=new Uint8Array([82,73,70,70,0,0,0,0,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,0,0,0,0]);function packageWave(t,e,i,r,n){var o=r>>3,s=i*e*o,a=i*o,l=t.length+(1&t.length),h=new ArrayBuffer(WaveHeader.length+l),c=new Uint8Array(h);if(c.set(WaveHeader),n)for(var u=0,p=WaveHeader.length;u<t.length;u+=2,p+=2)c[p]=t[u+1],c[p+1]=t[u];else c.set(t,WaveHeader.length);var d=new DataView(h);return d.setUint32(4,l+36,!0),d.setUint16(22,i,!0),d.setUint32(24,e,!0),d.setUint32(28,s,!0),d.setUint16(32,a,!0),d.setUint16(34,r,!0),d.setUint32(40,l,!0),{data:c,mimeType:"audio/wav"}}function defineSound(t){var e,i,r=t.soundType==SOUND_TYPE_STEREO?2:1,n=t.samplesCount,o=SOUND_RATES[t.soundRate],s=t.soundData;switch(t.soundFormat){case SOUND_FORMAT_PCM_BE:if(e=new Float32Array(n*r),t.soundSize==SOUND_SIZE_16_BIT){for(var a=0,l=0;a<e.length;a++,l+=2)e[a]=(s[l]<<24|s[l+1]<<16)/2147483648;i=packageWave(s,o,r,16,!0)}else{for(a=0;a<e.length;a++)e[a]=(s[a]-128)/128;i=packageWave(s,o,r,8,!1)}break;case SOUND_FORMAT_PCM_LE:if(e=new Float32Array(n*r),t.soundSize==SOUND_SIZE_16_BIT){for(a=0,l=0;a<e.length;a++,l+=2)e[a]=(s[l+1]<<24|s[l]<<16)/2147483648;i=packageWave(s,o,r,16,!1)}else{for(a=0;a<e.length;a++)e[a]=(s[a]-128)/128;i=packageWave(s,o,r,8,!1)}break;case SOUND_FORMAT_MP3:i={data:new Uint8Array(s.subarray(2)),mimeType:"audio/mpeg"};break;case SOUND_FORMAT_ADPCM:var h=new Int16Array(n*r);decodeACPCMSoundData(s,h,r),e=new Float32Array(n*r);for(a=0;a<e.length;a++)e[a]=h[a]/32768;i=packageWave(new Uint8Array(h.buffer),o,r,16,!new Uint8Array(new Uint16Array([1]).buffer)[0]);break;default:console.log("Unsupported audio format: "+t.soundFormat)}var c={type:"sound",id:t.id,sampleRate:o,channels:r,pcm:e,packaged:null};return i&&(c.packaged=i),c}var ACPCMIndexTables=[[-1,2],[-1,-1,2,4],[-1,-1,-1,-1,2,4,6,8],[-1,-1,-1,-1,-1,-1,-1,-1,1,2,4,6,8,10,13,16]],ACPCMStepSizeTable=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];function decodeACPCMSoundData(t,e,i){function r(e){for(;s<e;)o=o<<8|t[n++],s+=8;return o>>>(s-=e)&(1<<e)-1}for(var n=0,o=0,s=0,a=0,l=r(2),h=ACPCMIndexTables[l];a<e.length;){var c,u,p=e[a++]=r(16)<<16>>16,d=r(6);i>1&&(c=e[a++]=r(16)<<16>>16,u=r(6));for(var f=1<<l+1,_=0;_<4095;_++){for(var g=r(l+2),m=ACPCMStepSizeTable[d],y=0,v=f>>1;v;v>>=1,m>>=1)g&v&&(y+=m);if(p+=(g&f?-1:1)*(y+m),e[a++]=p=p<-32768?-32768:p>32767?32767:p,d=(d+=h[g&~f])<0?0:d>88?88:d,i>1){g=r(l+2),m=ACPCMStepSizeTable[u],y=0;for(v=f>>1;v;v>>=1,m>>=1)g&v&&(y+=m);c+=(g&f?-1:1)*(y+m),e[a++]=c=c<-32768?-32768:c>32767?32767:c,u=(u+=h[g&~f])<0?0:u>88?88:u}}}}var nextSoundStreamId=0,SoundStream=function(){function t(t,e,i,r){this.streamId=nextSoundStreamId++,this.samplesCount=t,this.sampleRate=e,this.channels=i,this.streamSize=r,this.format=null,this.currentSample=0,this.allChunks=[]}return t.FromTag=function(e){var i=e.streamType==SOUND_TYPE_STEREO?2:1,r=new t(e.samplesCount,SOUND_RATES[e.streamRate],i,e.streamSize);switch(e.streamCompression){case SOUND_FORMAT_PCM_BE:case SOUND_FORMAT_PCM_LE:r.format="wave",e.soundSize==SOUND_SIZE_16_BIT?r.decode=e.streamCompression===SOUND_FORMAT_PCM_BE?SwfSoundStream_decode_PCM_be:SwfSoundStream_decode_PCM_le:r.decode=SwfSoundStream_decode_PCM;break;case SOUND_FORMAT_MP3:r.format="mp3",r.decode=SwfSoundStream_decode_MP3;break;default:return console.log("Unsupported audio stream format: "+e.streamCompression),null}return r},t}();function SwfSoundStream_decode_PCM(t){for(var e=new Float32Array(t.length),i=0;i<e.length;i++)e[i]=(t[i]-128)/128;return this.currentSample+=e.length/this.channels,{streamId:this.streamId,samplesCount:e.length/this.channels,pcm:e,data:t,seek:0}}function SwfSoundStream_decode_PCM_be(t){for(var e=new Float32Array(t.length/2),i=0,r=0;i<e.length;i++,r+=2)e[i]=(t[r]<<24|t[r+1]<<16)/2147483648;return this.currentSample+=e.length/this.channels,{streamId:this.streamId,samplesCount:e.length/this.channels,pcm:e,data:t,seek:0}}function SwfSoundStream_decode_PCM_le(t){for(var e=new Float32Array(t.length/2),i=0,r=0;i<e.length;i++,r+=2)e[i]=(t[r+1]<<24|t[r]<<16)/2147483648;return this.currentSample+=e.length/this.channels,{streamId:this.streamId,samplesCount:e.length/this.channels,pcm:e,data:t,seek:0}}function SwfSoundStream_decode_MP3(t){var e=t[1]<<8|t[0],i=t[3]<<8|t[2];return this.currentSample+=e,{streamId:this.streamId,samplesCount:e,data:new Uint8Array(t.subarray(4)),seek:i}}for(var WebAudioAdapter=function(){function t(t){this._sound=null,this._frameData=[],this._data=t,this._position=0}return Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._sound.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sound",{get:function(){return this._sound},enumerable:!0,configurable:!0}),t.prototype.playFrom=function(t){this.stop(),this._sound.play(t)},t.prototype.stop=function(){this._sound&&this._sound.stop()},Object.defineProperty(t.prototype,"paused",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._sound.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReady",{get:function(){return!!this._sound},enumerable:!0,configurable:!0}),t.prototype.queueData=function(t){t.pcm?this._frameData.push(t):console.log("error in WebAudioAdapter.queueData - frame does not provide pcm data")},t.prototype.finish=function(){for(var t=0,e=0;e<this._frameData.length;e++)t+=this._frameData[e].data.length;var i=new Int8Array(t);for(e=0;e<this._frameData.length;e++)i.set(this._frameData[e].data,this._position),this._position+=this._frameData[e].data.length;var r=packageWave(i,this._data.sampleRate,this._data.channels,this._data.streamSize,!1),n=new WaveAudio(new WaveAudioData(r.data.buffer));this._sound=n},t}(),WebAudioMP3Adapter=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.queueData=function(t){t.data?this._frameData.push(t):console.log("error in WebAudioAdapter.queueData - frame does not provide data")},e.prototype.finish=function(){for(var t=0,e=0;e<this._frameData.length;e++)t+=this._frameData[e].data.length;var i=new Uint8Array(t);for(e=0;e<this._frameData.length;e++)i.set(this._frameData[e].data,this._position),this._position+=this._frameData[e].data.length;var r=new WaveAudio(new WaveAudioData(i.buffer));this._sound=r},e}(WebAudioAdapter),MovieClipSoundStream=function(){function t(t){this.decode=t.decode.bind(t),this.data={sampleRate:t.sampleRate,channels:t.channels,streamSize:t.streamSize},this.seekIndex=[],this.position=0,this.isMP3="mp3"===t.format,this.soundStreamAdapter=this.isMP3?new WebAudioMP3Adapter(this.data):new WebAudioAdapter(this.data)}return t.prototype.appendBlock=function(t,e){var i=this.decode(e),r=this.position;this.seekIndex[t]=r+i.seek;this.seekIndex[t],this.data.channels,this.data.sampleRate;this.isMP3&&this.data.channels,this.position=r+i.samplesCount,this.soundStreamAdapter.queueData(i)},t.prototype.stop=function(){this.soundStreamAdapter.stop()},t.prototype.playFrame=function(e){if(isNaN(this.seekIndex[e]))return 0;this.isPlaying=!0,this.finalized||(this.finalized=!0,this.soundStreamAdapter.finish());var i=this.data,r=this.seekIndex[e]/i.channels/i.sampleRate,n=this.soundStreamAdapter.currentTime;return this.isMP3&&(r*=i.channels),MovieClipSoundsManager.addActiveSound(this.soundStreamAdapter.sound),this.soundStreamAdapter.isPlaying||this.soundStreamAdapter.playFrom(r),n-r<0?Math.ceil(1e3*(n-r)/(1e3/t.frameRate)):Math.floor(1e3*(n-r)/(1e3/t.frameRate))},t.frameRate=25,t}(),MovieClipSoundsManager=function(){function t(){this.lastFrameNum=-2,this._soundStreams=[]}return t.addActiveSound=function(e){t.activeSounds[e.id]||(t.activeSounds[e.id]={}),t.activeSounds[e.id].active=!0,t.activeSounds[e.id].sound=e},t.enterFrame=function(){for(var e in t.activeSounds){t.activeSounds[e].active=!1}},t.exitFrame=function(){for(var e in t.activeSounds){var i=t.activeSounds[e];i.active||(i.sound.stop(),delete t.activeSounds[e])}},t.prototype.initSoundStream=function(t){this.soundStreamHead=t},t.prototype.addSoundStreamBlock=function(t,e){this.soundStreamHead?((0==this._soundStreams.length||t-this.lastFrameNum>1)&&this._soundStreams.push(new MovieClipSoundStream(this.soundStreamHead)),this.lastFrameNum=t,this._soundStreams[this._soundStreams.length-1].appendBlock(t,e)):console.log("can not add soundstreamblock if no soundstreamHead exists")},t.prototype.syncSounds=function(t,e,i){for(var r=0,n=0;n<this._soundStreams.length;n++)if(e&&i){var o=this._soundStreams[n].playFrame(t);Math.abs(o)>Math.abs(r)&&(r=o)}return r},t.activeSounds={},t}(),StreamNoDataError={},masks=new Uint32Array(33),i$1=1,mask$1=0;i$1<=32;++i$1)masks[i$1]=mask$1=mask$1<<1|1;var Stream=function(){function t(t,e,i,r){void 0===e&&(e=0),t.buffer instanceof ArrayBuffer&&(e+=t.byteOffset,t=t.buffer),void 0===i&&(i=t.byteLength-e),void 0===r&&(r=i),this.bytes=new Uint8Array(t,e,r),this.view=new DataView(t,e,r),this.pos=0,this.end=i,this.bitBuffer=0,this.bitLength=0}return t.prototype.align=function(){this.bitBuffer=this.bitLength=0},t.prototype.ensure=function(t){if(this.pos+t>this.end)throw StreamNoDataError},t.prototype.remaining=function(){return this.end-this.pos},t.prototype.substream=function(e,i){var r=new t(this.bytes);return r.pos=e,r.end=i,r},t.prototype.push=function(t){var e=this.bytes,i=this.end+t.length;if(i>e.length)throw"stream buffer overfow";e.set(t,this.end),this.end=i},t.prototype.readSi8=function(){return this.view.getInt8(this.pos++)},t.prototype.readSi16=function(){var t=this.view.getInt16(this.pos,!0);return this.pos+=2,t},t.prototype.readSi32=function(){var t=this.view.getInt32(this.pos,!0);return this.pos+=4,t},t.prototype.readUi8=function(){return this.bytes[this.pos++]},t.prototype.readUi16=function(){var t=this.view.getUint16(this.pos,!0);return this.pos+=2,t},t.prototype.readUi32=function(){var t=this.view.getUint32(this.pos,!0);return this.pos+=4,t},t.prototype.readFixed=function(){var t=this.view.getInt32(this.pos,!0)/65536;return this.pos+=4,t},t.prototype.readFixed8=function(){var t=this.view.getInt16(this.pos,!0)/256;return this.pos+=2,t},t.prototype.readFloat16=function(){var t=this.view.getUint16(this.pos,!1);this.pos+=2;var e=t>>15?-1:1,i=(31744&t)>>10,r=1023&t;return i?31===i?r?NaN:e*(1/0):e*Math.pow(2,i-15)*(1+r/1024):e*Math.pow(2,-14)*(r/1024)},t.prototype.readFloat=function(){var t=this.view.getFloat32(this.pos,!0);return this.pos+=4,t},t.prototype.readDouble=function(){var t=this.view.getFloat64(this.pos,!0);return this.pos+=8,t},t.prototype.readEncodedU32=function(){var t=this.bytes,e=t[this.pos++];return 128&e&&16384&(e=127&e|t[this.pos++]<<7)&&2097152&(e=16383&e|t[this.pos++]<<14)&&268435456&(e=2097151&e|t[this.pos++]<<21)?268435455&e|t[this.pos++]<<28:e},t.prototype.readBool=function(){return!!this.bytes[this.pos++]},t.prototype.readSb=function(t){return this.readUb(t)<<32-t>>32-t},t.prototype.readUb=function(t){for(var e=this.bitBuffer,i=this.bitLength,r=0;t>i;)i>24&&(r=e<<(t-=i),i=0),e=e<<8|this.bytes[this.pos++],i+=8;return r|=e>>>(i-=t)&masks[t],this.bitBuffer=e,this.bitLength=i,r},t.prototype.readFb=function(t){return this.readSb(t)/65536},t.prototype.readString=function(t){var e,i=this.bytes,r=this.pos;if(t>-1)e=i.subarray(r,r+=t);else{t=0;for(var n=r;i[n];n++)t++;e=i.subarray(r,r+=t),r++}this.pos=r;var o=utf8encode(e);return o.indexOf("\0")>=0&&(o=o.split("\0").join("")),o},t}();function parseBbox(t){t.align();var e=t.readUb(5),i=t.readSb(e),r=t.readSb(e),n=t.readSb(e),o=t.readSb(e);return t.align(),{xMin:i,xMax:r,yMin:n,yMax:o}}function parseRgb(t){return(t.readUi8()<<24|t.readUi8()<<16|t.readUi8()<<8|255)>>>0}function parseRgba(t){return t.readUi8()<<24|t.readUi8()<<16|t.readUi8()<<8|t.readUi8()}function parseArgb(t){return t.readUi8()|t.readUi8()<<24|t.readUi8()<<16|t.readUi8()<<8}function parseMatrix(t){var e={a:1,b:0,c:0,d:1,tx:0,ty:0};if(t.align(),t.readUb(1)){var i=t.readUb(5);e.a=t.readFb(i),e.d=t.readFb(i)}if(t.readUb(1)){i=t.readUb(5);e.b=t.readFb(i),e.c=t.readFb(i)}i=t.readUb(5);return e.tx=t.readSb(i),e.ty=t.readSb(i),t.align(),e}function parseColorTransform(t,e){var i={redMultiplier:255,greenMultiplier:255,blueMultiplier:255,alphaMultiplier:255,redOffset:0,greenOffset:0,blueOffset:0,alphaOffset:0};t.align();var r=t.readUb(1),n=t.readUb(1),o=t.readUb(4);return n&&(i.redMultiplier=t.readSb(o),i.greenMultiplier=t.readSb(o),i.blueMultiplier=t.readSb(o),e&&(i.alphaMultiplier=t.readSb(o))),r&&(i.redOffset=t.readSb(o),i.greenOffset=t.readSb(o),i.blueOffset=t.readSb(o),e&&(i.alphaOffset=t.readSb(o))),t.align(),i}function parsePlaceObjectTag(t,e,i,r){var n={code:i};if(n.actionBlocksPrecedence=t.pos,4===i)return n.symbolId=t.readUi16(),n.depth=t.readUi16(),n.flags|=4,n.matrix=parseMatrix(t),t.pos<r&&(n.flags|=8,n.cxform=parseColorTransform(t,!1)),n;var o=n.flags=i>26?t.readUi16():t.readUi8();if(n.depth=t.readUi16(),2048&o&&(n.className=t.readString(-1)),2&o&&(n.symbolId=t.readUi16()),4&o&&(n.matrix=parseMatrix(t)),8&o&&(n.cxform=parseColorTransform(t,!0)),16&o&&(n.ratio=t.readUi16()),32&o&&(n.name=t.readString(-1)),64&o&&(n.clipDepth=t.readUi16()),256&o)for(var s=t.readUi8(),a=n.filters=[];s--;)a.push(parseFilter(t));if(512&o&&(n.blendMode=t.readUi8()),1024&o&&(n.bmpCache=t.readUi8()),8192&o&&(n.visibility=t.readBool()),16384&o&&(n.backgroundColor=parseArgb(t)),128&o){t.readUi16(),e>=6?t.readUi32():t.readUi16();for(var l,h=n.events=[];l=parseEvents(t,e);){if(t.pos>r){console.log("PlaceObject handler attempted to read clip events beyond tag end"),t.pos=r;break}h.push(l)}}return n}function parseEvents(t,e){var i=e>=6?t.readUi32():t.readUi16();if(!i)return null;var r={};6===e&&(i&=-262145),r.flags=i;var n=t.readUi32();131072&i&&(r.keyCode=t.readUi8(),n--);var o=t.pos+n;return r.actionsBlock=t.bytes.subarray(t.pos,o),t.pos=o,r}function parseFilter(t){var e={},i=e.type=t.readUi8();switch(i){case 0:case 2:case 3:case 4:case 7:var r,n=e;r=4===i||7===i?t.readUi8():3===i?2:1;for(var o=n.colors=[],s=r;s--;)o.push(parseRgba(t));if(4===i||7===i){var a=n.ratios=[];for(s=r;s--;)a.push(t.readUi8())}return n.blurX=t.readFixed(),n.blurY=t.readFixed(),2!==i&&(n.angle=t.readFixed(),n.distance=t.readFixed()),n.strength=t.readFixed8(),n.inner=!!t.readUb(1),n.knockout=!!t.readUb(1),n.compositeSource=!!t.readUb(1),3===i||4===i||7===i?(n.onTop=!!t.readUb(1),n.quality=t.readUb(4)):n.quality=t.readUb(5),n;case 1:var l=e;return l.blurX=t.readFixed(),l.blurY=t.readFixed(),l.quality=t.readUb(5),t.readUb(3),l;case 5:var h=e,c=h.matrixX=t.readUi8(),u=h.matrixY=t.readUi8();h.divisor=t.readFloat(),h.bias=t.readFloat();var p=h.matrix=[];for(s=c*u;s--;)p.push(t.readFloat());h.color=parseRgba(t);t.readUb(6);return h.clamp=!!t.readUb(1),h.preserveAlpha=!!t.readUb(1),h;case 6:var d=e;for(p=d.matrix=[],s=20;s--;)p.push(t.readFloat());return d}return e}function parseRemoveObjectTag(t,e,i){var r={code:i};return 5===i?(r.depth=t.readUi16(),r.symbolId=t.readUi16()):r.depth=t.readUi16(),r}function parseDefineImageTag(t,e,i,r,n){var o,s={code:i};if(s.id=t.readUi16(),i>21){var a=t.readUi32();90===i&&(s.deblock=t.readFixed8()),a+=t.pos,o=s.imgData=t.bytes.subarray(t.pos,a),s.alphaData=t.bytes.subarray(a,r),t.pos=r}else o=s.imgData=t.bytes.subarray(t.pos,r),t.pos=r;switch(o[0]<<8|o[1]){case 65496:case 65497:s.mimeType="image/jpeg";break;case 35152:s.mimeType="image/png";break;case 18249:s.mimeType="image/gif";break;default:s.mimeType="application/octet-stream"}return 6===i&&(s.jpegTables={data:n}),s}function parseDefineButtonTag(t,e,i,r){var n={code:i};n.id=t.readUi16();var o,s=n.characters=[];if(7==i){for(;o=parseButtonCharacter(t,e,i);)s.push(o);n.actionsData=t.bytes.subarray(t.pos,r),t.pos=r}else{var a=t.readUi8();n.trackAsMenu=!!(a>>7&1);for(var l=t.readUi16();o=parseButtonCharacter(t,e,i);)s.push(o);if(l){for(var h=n.buttonActions=[];t.pos<r;){var c=parseButtonCondAction(t,r);if(t.pos>r)break;h.push(c)}t.pos=r}}return n}function parseButtonCharacter(t,e,i){var r=t.readUi8();if(!r)return null;var n={};if(e<8&&(r&=-769),n.flags=r,n.symbolId=t.readUi16(),n.depth=t.readUi16(),n.matrix=parseMatrix(t),34===i&&(n.cxform=parseColorTransform(t,!0)),16&n.flags)for(var o=t.readUi8(),s=n.filters=[],a=o;a--;)s.push(parseFilter(t));return 32&n.flags&&(n.blendMode=t.readUi8()),n}function parseButtonCondAction(t,e){var i=t.pos,r=t.readUi16(),n=r?i+r:e,o=t.readUi16();return t.pos=n,{keyCode:(65024&o)>>9,stateTransitionFlags:511&o,actionsData:t.bytes.subarray(i+4,n)}}function parseDefineBinaryDataTag(t,e,i,r){var n={code:i};return n.id=t.readUi16(),t.pos+=4,n.data=t.bytes.subarray(t.pos,r),t.pos=r,n}function parseDefineFontTag(t,e,i){var r={code:i};r.id=t.readUi16();for(var n=t.readUi16(),o=n/2,s=[],a=o-1;a--;)s.push(t.readUi16());r.offsets=[n].concat(s);var l=r.glyphs=[];for(a=o;a--;)l.push(parseGlyph(t,e,i));return r}function parseGlyph(t,e,i){t.align();var r=t.readUb(4),n=t.readUb(4);return parseShapeRecords(t,e,i,!1,r,n,!1)}function parseDefineTextTag(t,e,i){var r={code:i};r.id=t.readUi16(),r.bbox=parseBbox(t),r.matrix=parseMatrix(t);for(var n,o=t.readUi8(),s=t.readUi8(),a=r.records=[];n=parseTextRecord(t,e,i,o,s);)a.push(n);return r}function parseTextRecord(t,e,i,r,n){t.align();var o=t.readUb(8);if(!o)return null;var s={};s.flags=o,8&o&&(s.fontId=t.readUi16()),4&o&&(s.color=33===i?parseRgba(t):parseRgb(t)),1&o&&(s.moveX=t.readSi16()),2&o&&(s.moveY=t.readSi16()),8&o&&(s.fontHeight=t.readUi16());var a=t.readUi8();e<=6&&(a=a);for(var l=s.entries=[],h=a;h--;)l.push({glyphIndex:t.readUb(r),advance:t.readSb(n)});return s}function parseDefineSoundTag(t,e,i,r){var n={code:i};n.id=t.readUi16();var o=t.readUi8();return n.soundFormat=o>>4&15,n.soundRate=o>>2&3,n.soundSize=o>>1&1,n.soundType=1&o,n.samplesCount=t.readUi32(),n.soundData=t.bytes.subarray(t.pos,r),t.pos=r,n}function parseStartSoundTag(t,e,i){var r={code:i};return 15==i&&(r.soundId=t.readUi16()),89==i&&(r.soundClassName=t.readString(-1)),r.soundInfo=parseSoundInfo(t),r}function parseSoundInfo(t){var e={},i=e.flags=t.readUi8();if(1&i&&(e.inPoint=t.readUi32()),2&i&&(e.outPoint=t.readUi32()),4&i&&(e.loopCount=t.readUi16()),8&i)for(var r=t.readUi8(),n=e.envelopes=[],o=r;o--;)n.push({pos44:t.readUi32(),volumeLeft:t.readUi16(),volumeRight:t.readUi16()});return e}function parseSoundStreamHeadTag(t,e){var i={},r=t.readUi8();i.playbackRate=r>>2&3,i.playbackSize=r>>1&1,i.playbackType=1&r;var n=t.readUi8(),o=i.streamCompression=n>>4&15;return i.streamRate=n>>2&3,i.streamSize=0==(n>>1&1)?8:16,i.streamType=1&n,i.samplesCount=t.readUi16(),2==o&&e-t.pos>=2&&(i.latencySeek=t.readSi16()),i}function parseDefineBitmapTag(t,e,i,r){var n={code:i};n.id=t.readUi16();var o=n.format=t.readUi8();return n.width=t.readUi16(),n.height=t.readUi16(),n.hasAlpha=36===i,3===o&&(n.colorTableSize=t.readUi8()),n.bmpData=t.bytes.subarray(t.pos,r),t.pos=r,n}function parseDefineEditTextTag(t,e,i){var r={code:i};r.id=t.readUi16(),r.bbox=parseBbox(t);var n=r.flags=t.readUi16();return 1&n&&(r.fontId=t.readUi16()),32768&n&&(r.fontClass=t.readString(-1)),1&n&&(r.fontHeight=t.readUi16()),4&n&&(r.color=parseRgba(t)),2&n&&(r.maxLength=t.readUi16()),8192&n&&(r.align=t.readUi8(),r.leftMargin=t.readUi16(),r.rightMargin=t.readUi16(),r.indent=t.readSi16(),r.leading=t.readSi16()),r.variableName=t.readString(-1),128&n&&(r.initialText=t.readString(-1)),r}function parseDefineFont2Tag(t,e,i,r){var n={code:i};n.id=t.readUi16();var o=n.flags=t.readUi8(),s=!!(4&o);e>5?n.language=t.readUi8():(o=n.flags=-65&o,t.pos+=1,n.language=0);var a=t.readUi8();n.name=t.readString(a),75===i&&(n.resolution=20);var l=t.readUi16();if(0===l)return n;var h=t.pos,c=n.offsets=[],u=l;if(8&o){for(;u--;)c.push(t.readUi32());n.mapOffset=t.readUi32()}else{for(;u--;)c.push(t.readUi16());n.mapOffset=t.readUi16()}var p=n.glyphs=[];for(u=l;u--;){1!==n.offsets[l-u]+h-t.pos?p.push(parseGlyph(t,e,i)):(t.pos+=1,p.push([]))}var d=n.codes=[];for(u=l;u--;)d.push(s?t.readUi16():t.readUi8());if(128&o){n.ascent=t.readUi16(),n.descent=t.readUi16(),n.leading=t.readSi16();var f=n.advance=[];for(u=l;u--;)f.push(t.readSi16());var _=n.bbox=[];for(u=l;u--;)_.push(parseBbox(t));var g=t.readUi16(),m=n.kerning=[];for(u=g;u--&&r-t.pos>=2+(s?4:2);)m.push(parseKerning(t,s))}return n}function parseKerning(t,e){var i={};return e?(i.code1=t.readUi16(),i.code2=t.readUi16()):(i.code1=t.readUi8(),i.code2=t.readUi8()),i.adjustment=t.readUi16(),i}function parseDefineFont4Tag(t,e,i,r){var n={code:i};n.id=t.readUi16();var o=n.flags=t.readUi8();return n.name=t.readString(-1),4&o&&(n.data=t.bytes.subarray(t.pos,r),t.pos=r),n}function parseDefineScalingGridTag(t,e,i){var r={code:i};return r.symbolId=t.readUi16(),r.splitter=parseBbox(t),r}function parseDefineSceneTag(t,e){for(var i={code:e},r=t.readEncodedU32(),n=i.scenes=[],o=r;o--;)n.push({offset:t.readEncodedU32(),name:t.readString(-1)});var s=t.readEncodedU32(),a=i.labels=[];for(o=s;o--;)a.push({frame:t.readEncodedU32(),name:t.readString(-1)});return i}function parseDefineShapeTag(t,e,i){var r={code:i};r.id=t.readUi16(),r.lineBounds=parseBbox(t);var n=0,o=46===i||84===i;o&&(n|=8,r.lineBoundsMorph=parseBbox(t));var s=83===i||84===i;if(s){r.fillBounds=parseBbox(t);o&&(r.fillBoundsMorph=parseBbox(t)),n|=7&t.readUi8()}r.flags=n,o&&(t.pos+=4),r.fillStyles=parseFillStyles(t,e,i,o),r.lineStyles=parseLineStyles(t,e,i,o,s),t.align();var a=t.readUb(4),l=t.readUb(4);return r.records=parseShapeRecords(t,e,i,o,a,l,s),o&&(t.align(),a=t.readUb(4),l=t.readUb(4),r.recordsMorph=parseShapeRecords(t,e,i,o,a,l,s)),r}function parseShapeRecords(t,e,i,r,n,o,s){for(var a=[];;){var l={},h=l.type=t.readUb(1),c=t.readUb(5);if(!h&&!c)break;if(h){var u=2+(15&c);if(32&(c=(240&c)<<1))if(l.isGeneral=t.readUb(1))c|=64,l.deltaX=t.readSb(u),l.deltaY=t.readSb(u);else(l.isVertical=t.readUb(1))?(c|=128,l.deltaY=t.readSb(u)):l.deltaX=t.readSb(u);else l.controlDeltaX=t.readSb(u),l.controlDeltaY=t.readSb(u),l.anchorDeltaX=t.readSb(u),l.anchorDeltaY=t.readSb(u)}else i<=2&&(c&=-17),1&c&&(u=t.readUb(5),l.moveX=t.readSb(u),l.moveY=t.readSb(u)),2&c&&(l.fillStyle0=t.readUb(n)),4&c&&(l.fillStyle1=t.readUb(n)),8&c&&(l.lineStyle=t.readUb(o)),16&c&&(l.fillStyles=parseFillStyles(t,e,i,r),l.lineStyles=parseLineStyles(t,e,i,r,s),t.align(),n=t.readUb(4),o=t.readUb(4));l.flags=c,a.push(l)}return a}function parseFillStyles(t,e,i,r){var n=t.readUi8();i>2&&255===n&&(n=t.readUi16());for(var o=[],s=n;s--;)o.push(parseFillStyle(t,e,i,r));return o}function parseFillStyle(t,e,i,r){var n={},o=n.type=t.readUi8();switch(o){case 0:var s=n;return s.color=i>22||r?parseRgba(t):parseRgb(t),r&&(s.colorMorph=parseRgba(t)),s;case 16:case 18:case 19:var a=n;a.matrix=parseMatrix(t),r&&(a.matrixMorph=parseMatrix(t)),83===i?(a.spreadMode=t.readUb(2),a.interpolationMode=t.readUb(2)):t.readUb(4);for(var l=t.readUb(4),h=a.records=[],c=l;c--;)h.push(parseGradientRecord(t,i,r));return 19===o&&(a.focalPoint=t.readSi16(),r&&(a.focalPointMorph=t.readSi16())),a;case 64:case 65:case 66:case 67:var u=n;return u.bitmapId=t.readUi16(),u.condition=64===o||67===o,u.matrix=parseMatrix(t),r&&(u.matrixMorph=parseMatrix(t)),u}return n}function parseGradientRecord(t,e,i){var r={};return r.ratio=t.readUi8(),r.color=e>22?parseRgba(t):parseRgb(t),i&&(r.ratioMorph=t.readUi8(),r.colorMorph=parseRgba(t)),r}function parseLineStyles(t,e,i,r,n){var o=t.readUi8();i>2&&255===o&&(o=t.readUi16());for(var s=[],a=o;a--;){var l={};if(l.width=t.readUi16(),r&&(l.widthMorph=t.readUi16()),n){t.align(),l.startCapsStyle=t.readUb(2);var h=l.jointStyle=t.readUb(2),c=l.hasFill=t.readUb(1);l.noHscale=!!t.readUb(1),l.noVscale=!!t.readUb(1),l.pixelHinting=!!t.readUb(1),t.readUb(5),l.noClose=!!t.readUb(1),l.endCapsStyle=t.readUb(2),2===h&&(l.miterLimitFactor=t.readFixed8()),c?l.fillStyle=parseFillStyle(t,e,i,r):(l.color=parseRgba(t),r&&(l.colorMorph=parseRgba(t)))}else l.color=i>22?parseRgba(t):parseRgb(t),r&&(l.colorMorph=parseRgba(t));s.push(l)}return s}function parseDefineVideoStreamTag(t,e,i){var r={code:i};return r.id=t.readUi16(),r.numFrames=t.readUi16(),r.width=t.readUi16(),r.height=t.readUi16(),t.readUb(4),r.deblocking=t.readUb(3),r.smoothing=!!t.readUb(1),r.codecId=t.readUi8(),r}function parseVideoFrameTag(t,e,i,r){var n={code:i};return n.streamId=t.readUi16(),n.frameNum=t.readUi16(),n.videoData=t.bytes.subarray(t.pos,r),t.pos=r,n}var tagHandlers={0:void 0,1:void 0,2:parseDefineShapeTag,4:parsePlaceObjectTag,5:parseRemoveObjectTag,6:parseDefineImageTag,7:parseDefineButtonTag,8:void 0,9:void 0,10:parseDefineFontTag,11:parseDefineTextTag,12:void 0,13:void 0,14:parseDefineSoundTag,15:parseStartSoundTag,17:void 0,18:void 0,19:void 0,20:parseDefineBitmapTag,21:parseDefineImageTag,22:parseDefineShapeTag,23:void 0,24:void 0,26:parsePlaceObjectTag,28:parseRemoveObjectTag,32:parseDefineShapeTag,33:parseDefineTextTag,34:parseDefineButtonTag,35:parseDefineImageTag,36:parseDefineBitmapTag,37:parseDefineEditTextTag,39:void 0,43:void 0,45:void 0,46:parseDefineShapeTag,48:parseDefineFont2Tag,56:void 0,57:void 0,58:void 0,59:void 0,60:parseDefineVideoStreamTag,61:parseVideoFrameTag,62:void 0,64:void 0,65:void 0,66:void 0,69:void 0,70:parsePlaceObjectTag,71:void 0,72:void 0,73:void 0,74:void 0,75:parseDefineFont2Tag,76:void 0,77:void 0,78:parseDefineScalingGridTag,82:void 0,83:parseDefineShapeTag,84:parseDefineShapeTag,86:parseDefineSceneTag,87:parseDefineBinaryDataTag,88:void 0,89:parseStartSoundTag,90:parseDefineImageTag,91:parseDefineFont4Tag};function parseHeader(t){var e=t.readUb(5),i=t.readSb(e),r=t.readSb(e),n=t.readSb(e),o=t.readSb(e);t.align();var s=t.readUi8();return{frameRate:t.readUi8()+s/256,frameCount:t.readUi16(),bounds:new Bounds(i,n,r,o)}}function defineShape(t,e){t.parser=e;var i=new Graphics;return i.queueShapeTag(t),{type:t.recordsMorph?"morphshape":"shape",id:t.id,fillBounds:t.fillBounds,lineBounds:t.lineBounds,morphFillBounds:t.fillBoundsMorph||null,morphLineBounds:t.lineBoundsMorph||null,shape:t.recordsMorph?new MorphSprite(i):i,require:null}}var pow=Math.pow,logE=Math.log,fromCharCode=String.fromCharCode;function maxPower2(t){for(var e=0,i=t;i>=2;)i/=2,++e;return pow(2,e)}function toString16(t){return fromCharCode(t>>8&255,255&t)}function isScaledFont2(t){for(var e=0,i=0,r=0,n=0,o=0;o<t.length;o++){var s=t[o];if(s)for(var a,l=0,h=0,c=0;c<s.length;c++)(a=s[c]).type?32&a.flags?(l+=a.deltaX||0,h+=-(a.deltaY||0)):(l+=a.controlDeltaX,h+=-a.controlDeltaY,l+=a.anchorDeltaX,h+=-a.anchorDeltaY):1&a.flags&&(l=a.moveX,h=-a.moveY),e>l&&(e=l),i>h&&(i=h),r<l&&(r=l),n<h&&(n=h)}return Math.max(r-e,n-i)>5e3}function defineFont(t,e){var i="swf-font-"+t.id,r=t.name||i;"Helvetica"==r&&(r="arial");var n=DefaultFontManager.getFont(r,e),o={type:"font",id:t.id,name:r,bold:!!(1&t.flags),italic:!!(2&t.flags),codes:null,metrics:null,data:t.data,originalSize:!1,away:n,fontStyleName:FontStyleName.STANDART};n.name=r;var s=FontStyleName.STANDART;o.bold&&!o.italic?s=FontStyleName.BOLD:!o.bold&&o.italic?s=FontStyleName.ITALIC:o.bold&&o.italic&&(s=FontStyleName.BOLDITALIC),o.fontStyleName=s;var a=n.get_font_table(s,TesselatedFontTable.assetType),l=t.glyphs,h=l?l.length:0;if(!h)return o;var c=[],u={},p=[],d=!("advance"in t),f=48===t.code,_=75===t.code;d&&(t.advance=[]);var g=Math.max.apply(null,t.codes)||35;if(t.codes){for(var m=0;m<t.codes.length;m++){((P=t.codes[m])<32||P in u)&&(8232==++g&&(g=8240),P=g),c.push(P),u[P]=m}c.sort((function(t,e){return t-e}));var y;for(m=0;void 0!==(P=c[m++]);){var v=T=P;for(y=[m-1];void 0!==(P=c[m])&&v+1===P;)++v,y.push(m),++m;p.push([T,v,y])}}else{y=[];for(m=0;m<h;m++)P=57344+m,c.push(P),u[P]=m,y.push(m);p.push([57344,57344+h-1,y])}var b=t.resolution||1;f&&isScaledFont2(l)&&(b=20,o.originalSize=!0);var x=Math.ceil(t.ascent/b)||1024,A=-Math.ceil(t.descent/b)||0;0!=a.ascent||(a.ascent=x,a.descent=A);var E,S=a.ascent;for(t.leading,m=0;E=p[m++];)var T=E[0],P=(v=E[1],E[2][0]);for(var C=2*maxPower2(p.length+1),w=[],D=(m=0,{});void 0!==(P=c[m++]);){for(var M=l[u[P]],O=0,I=0,L=[],N=-1,F=0;F<M.length;F++){if((et=M[F]).type)if(N<0&&(L[N=0]={data:[],commands:[],xMin:0,xMax:0,yMin:0,yMax:0}),32&et.flags)L[N].commands.push(2),O+=(et.deltaX||0)/b,I+=-(et.deltaY||0)/b,L[N].data.push(O,I);else L[N].commands.push(3),O+=Z=et.controlDeltaX/b,I+=J=-et.controlDeltaY/b,L[N].data.push(O,I),O+=et.anchorDeltaX/b,I+=-et.anchorDeltaY/b,L[N].data.push(O,I);else if(1&et.flags){L[++N]={data:[],commands:[],xMin:0,xMax:0,yMin:0,yMax:0},L[N].commands.push(1);var R=et.moveX/b,B=-et.moveY/b;O=R,I=B,L[N].data.push(O,I)}N>-1&&(L[N].xMin>O&&(L[N].xMin=O),L[N].yMin>I&&(L[N].yMin=I),L[N].xMax<O&&(L[N].xMax=O),L[N].yMax<I&&(L[N].yMax=I))}_||L.sort((function(t,e){return(e.xMax-e.xMin)*(e.yMax-e.yMin)-(t.xMax-t.xMin)*(t.yMax-t.yMin)})),D[P]=L}var V=0;for(m=0;void 0!==(P=c[m++]);){var k=new GraphicsPath,U=(M=l[u[P]],u[P]);L=D[P];O=0,I=0;var j=0,G=-1024,z=0,X=-1024,H=(N=-1,[]),$=[];for(F=0;F<L.length;F++)H=H.concat(L[F].data),$=$.concat(L[F].commands);O=0,I=0;var W=0,q=0,Y=0;for(F=0;F<$.length;F++){var K=$[F];if(1===K){W=H[Y++],q=H[Y++];k.moveTo(W,-1*q+S),O=W,I=q}else if(2===K){W=H[Y++],q=H[Y++];O=W,I=q,k.lineTo(W,-1*q+S)}else if(3===K){var Z=(W=H[Y++])-O,J=(q=H[Y++])-I;O=W,I=q;Z=W,J=q,W=H[Y++],q=H[Y++];O=W,I=q,k.curveTo(Z,-1*J+S,W,-1*q+S)}j>O&&(j=O),z>I&&(z=I),G<O&&(G=O),X<I&&(X=I)}F||(j=G=z=X=0),w.push(z);var Q=0;d?(t.advance.push((G-j)*b*1.3),Q=G-j):Q=t.advance[m-1]/b,32==P&&(V=t.advance[m-1]/b),a.setChar(P.toString(),Q,null,null,!1,U,k,t.fileURL)}if(!_){var tt=Math.min.apply(null,w);tt<0&&(A=A||tt)}if(t.kerning&&t.kerning.length){var et,it=t.kerning,rt=it.length;for(C=2*maxPower2(rt),toString16(14+6*rt),toString16(rt),toString16(C),toString16(logE(rt)/logE(2)),toString16(2*rt-C),m=0;et=it[m++];)toString16(u[et.code1])+toString16(u[et.code2])+toString16(et.adjustment)}return a.set_font_em_size(1024),0==a.get_whitespace_width()&&a.set_whitespace_width(V),o}function defineText(t){return{type:"text",id:t.id,fillBounds:t.bbox,variableName:t.variableName,tag:t,bold:!1,italic:!1}}function defineButton(t,e){for(var i,r=t.characters,n={up:[],over:[],down:[],hitTest:[]},o=0;i=r[o++];){var s=e[i.symbolId];if(s){var a={symbolId:s.id,code:4,depth:i.depth,flags:0,matrix:null,cxform:null};i.matrix&&(a.flags|=4,a.matrix=i.matrix),i.cxform&&(a.flags|=8,a.cxform=i.cxform),1&i.flags&&n.up.push(a),2&i.flags&&n.over.push(a),4&i.flags&&n.down.push(a),8&i.flags&&n.hitTest.push(a)}else console.log("undefined character in button "+t.id)}return{type:"button",id:t.id,buttonActions:t.buttonActions,states:n}}function parseColorMapped(t){var e=t.width,i=t.height,r=t.hasAlpha,n=roundToMultipleOfFour(e)-e,o=r?4:3,s=roundToMultipleOfFour((t.colorTableSize+1)*o),a=o*((e+n)*i),l=Inflate.inflate(t.bmpData,a,!0),h=new Uint8ClampedArray(e*i*4),c=s,u=0,p=0;if(r)for(var d=0;d<i;d++){for(var f=0;f<e;f++)p=l[c++]<<2,h[u++]=l[p+0],h[u++]=l[p+1],h[u++]=l[p+2],h[u++]=l[p+3];c+=n}else for(d=0;d<i;d++){for(f=0;f<e;f++)p=l[c++]*o,h[u++]=l[p+0],h[u++]=l[p+1],h[u++]=l[p+2],h[u++]=255;c+=n}return h}function parse24BPP(t){for(var e=t.width,i=t.height,r=(t.hasAlpha,i*e*4),n=Inflate.inflate(t.bmpData,r,!0),o=new Uint8ClampedArray(r),s=0,a=0;a<r;a+=4)o[s++]=n[a+1],o[s++]=n[a+2],o[s++]=n[a+3],o[s++]=n[a];return assert(s===r,"We should be at the end of the data buffer now."),o}function parse15BPP(t){return console.log("parse15BPP"),null}function defineBitmap(t){var e,i=ImageType.None;switch(t.format){case 3:e=parseColorMapped(t),i=ImageType.PremultipliedAlphaARGB;break;case 5:e=parse24BPP(t),i=ImageType.PremultipliedAlphaARGB;break;case 4:e=parse15BPP(),i=ImageType.PremultipliedAlphaARGB;break;default:console.log("invalid bitmap format")}return{definition:{type:"image",id:t.id,width:t.width,height:t.height,mimeType:"application/octet-stream",data:e,dataType:i,image:null},type:"image"}}function readUint16(t,e){return t[e]<<8|t[e+1]}function readInt32(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function parseJpegChunks(t,e){for(var i=0,r=t.length;i<r&&(255!==t[i]||i+1<r&&(0===t[i+1]||255===t[i+1]));)++i;if(!(i>=r))do{var n=i++,o=t[i++];if(o>=192&&o<=199||o>=201&&o<=207||o>=218&&o<=239||254===o)i+=readUint16(t,i);for(;i<r&&(255!==t[i]||i+1<r&&(0===t[i+1]||255===t[i+1]));)++i;216!==o&&217!==o&&e.push(t.subarray(n,i))}while(i<r)}function parsePngHeaders(t,e){if(73===e[12]&&72===e[13]&&68===e[14]&&82===e[15]){t.width=readInt32(e,16),t.height=readInt32(e,20);var i=e[26];t.hasAlpha=4===i||6===i}}function joinChunks(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].length;var r=new Uint8Array(e),n=0;for(i=0;i<t.length;i++){var o=t[i];r.set(o,n),n+=o.length}return r}function injectJPEGTables(t,e){if(!e.parsedChunks){var i=[];parseJpegChunks(e.data,i),e.parsedChunks=i}for(var r=0;r<t.length&&!(t[r][1]>=192&&t[r][1]<=192);)r++;Array.prototype.splice.apply(t,Array.prototype.concat.call([r,0],e.parsedChunks))}var JPEG_SOI=new Uint8Array([255,216]),JPEG_EOI=new Uint8Array([255,217]);function defineImage(t){var e={type:"image",id:t.id,mimeType:t.mimeType},i=t.imgData;if("image/jpeg"===t.mimeType){var r=[];r.push(JPEG_SOI),parseJpegChunks(i,r),t.jpegTables&&injectJPEGTables(r,t.jpegTables),r.push(JPEG_EOI),r.forEach((function(t){var i=t[1];i>=192&&i<=195&&(e.height=readUint16(t,5),e.width=readUint16(t,7))})),e.data=joinChunks(r),e.dataType=ImageType.JPEG;var n=t.alphaData;if(n){var o=e.width*e.height;try{e.alphaData=Inflate.inflate(n,o,!0)}catch(t){e.alphaData=new Uint8Array(o)}}}else parsePngHeaders(e,i),e.data=i,e.dataType=ImageType.PNG;return e}function defineLabel(t){return{type:"label",id:t.id,fillBounds:t.bbox,matrix:t.matrix,tag:{hasText:!0,initialText:"",html:!0,readonly:!0},records:t.records,coords:null,static:!0,require:null}}var SWFFrame=function(t,e,i,r,n,o,s){t&&Object.freeze(t),this.controlTags=t,this.labelNames=e,n&&Object.freeze(n),this.soundStreamHead=i,this.soundStreamBlock=r,this.actionBlocks=n,o&&Object.freeze(o),this.initActionBlocks=o,this.buttonStateName="",s&&Object.freeze(s),this.exports=s},CompressionMethod;!function(t){t[t.None=0]="None",t[t.Deflate=1]="Deflate",t[t.LZMA=2]="LZMA"}(CompressionMethod||(CompressionMethod={}));var SWFFile=function(){this.compression=CompressionMethod.None,this.swfVersion=0,this.useAVM1=!0,this.backgroundColor=4294967295,this.bounds=null,this.frameRate=0,this.frameCount=0,this.attributes=null,this.sceneAndFrameLabelData=null,this.bytesLoaded=0,this.bytesTotal=length,this.pendingUpdateDelays=0,this.framesLoaded=0},SwfTagCodeNames=["CODE_END","CODE_SHOW_FRAME","CODE_DEFINE_SHAPE","CODE_FREE_CHARACTER","CODE_PLACE_OBJECT","CODE_REMOVE_OBJECT","CODE_DEFINE_BITS","CODE_DEFINE_BUTTON","CODE_JPEG_TABLES","CODE_SET_BACKGROUND_COLOR","CODE_DEFINE_FONT","CODE_DEFINE_TEXT","CODE_DO_ACTION","CODE_DEFINE_FONT_INFO","CODE_DEFINE_SOUND","CODE_START_SOUND","CODE_STOP_SOUND","CODE_DEFINE_BUTTON_SOUND","CODE_SOUND_STREAM_HEAD","CODE_SOUND_STREAM_BLOCK","CODE_DEFINE_BITS_LOSSLESS","CODE_DEFINE_BITS_JPEG2","CODE_DEFINE_SHAPE2","CODE_DEFINE_BUTTON_CXFORM","CODE_PROTECT","CODE_PATHS_ARE_POSTSCRIPT","CODE_PLACE_OBJECT2","INVALID","CODE_REMOVE_OBJECT2","CODE_SYNC_FRAME","INVALID","CODE_FREE_ALL","CODE_DEFINE_SHAPE3","CODE_DEFINE_TEXT2","CODE_DEFINE_BUTTON2","CODE_DEFINE_BITS_JPEG3","CODE_DEFINE_BITS_LOSSLESS2","CODE_DEFINE_EDIT_TEXT","CODE_DEFINE_VIDEO","CODE_DEFINE_SPRITE","CODE_NAME_CHARACTER","CODE_PRODUCT_INFO","CODE_DEFINE_TEXT_FORMAT","CODE_FRAME_LABEL","CODE_DEFINE_BEHAVIOUR","CODE_SOUND_STREAM_HEAD2","CODE_DEFINE_MORPH_SHAPE","CODE_GENERATE_FRAME","CODE_DEFINE_FONT2","CODE_GEN_COMMAND","CODE_DEFINE_COMMAND_OBJECT","CODE_CHARACTER_SET","CODE_EXTERNAL_FONT","CODE_DEFINE_FUNCTION","CODE_PLACE_FUNCTION","CODE_GEN_TAG_OBJECTS","CODE_EXPORT_ASSETS","CODE_IMPORT_ASSETS","CODE_ENABLE_DEBUGGER","CODE_DO_INIT_ACTION","CODE_DEFINE_VIDEO_STREAM","CODE_VIDEO_FRAME","CODE_DEFINE_FONT_INFO2","CODE_DEBUG_ID","CODE_ENABLE_DEBUGGER2","CODE_SCRIPT_LIMITS","CODE_SET_TAB_INDEX","CODE_DEFINE_SHAPE4","INVALID","CODE_FILE_ATTRIBUTES","CODE_PLACE_OBJECT3","CODE_IMPORT_ASSETS2","CODE_DO_ABC_DEFINE","CODE_DEFINE_FONT_ALIGN_ZONES","CODE_CSM_TEXT_SETTINGS","CODE_DEFINE_FONT3","CODE_SYMBOL_CLASS","CODE_METADATA","CODE_DEFINE_SCALING_GRID","INVALID","INVALID","INVALID","CODE_DO_ABC","CODE_DEFINE_SHAPE4","CODE_DEFINE_MORPH_SHAPE2","INVALID","CODE_DEFINE_SCENE_AND_FRAME_LABEL_DATA","CODE_DEFINE_BINARY_DATA","CODE_DEFINE_FONT_NAME","CODE_START_SOUND2","CODE_DEFINE_BITS_JPEG4","CODE_DEFINE_FONT4","CODE_TELEMETRY"],DefinitionTags,ImageDefinitionTags,FontDefinitionTags,ControlTags;function getSwfTagCodeName(t){return SwfTagCodeNames[t]}!function(t){t[t.CODE_DEFINE_SHAPE=2]="CODE_DEFINE_SHAPE",t[t.CODE_DEFINE_BITS=6]="CODE_DEFINE_BITS",t[t.CODE_DEFINE_BUTTON=7]="CODE_DEFINE_BUTTON",t[t.CODE_DEFINE_FONT=10]="CODE_DEFINE_FONT",t[t.CODE_DEFINE_TEXT=11]="CODE_DEFINE_TEXT",t[t.CODE_DEFINE_SOUND=14]="CODE_DEFINE_SOUND",t[t.CODE_DEFINE_BITS_LOSSLESS=20]="CODE_DEFINE_BITS_LOSSLESS",t[t.CODE_DEFINE_BITS_JPEG2=21]="CODE_DEFINE_BITS_JPEG2",t[t.CODE_DEFINE_SHAPE2=22]="CODE_DEFINE_SHAPE2",t[t.CODE_DEFINE_SHAPE3=32]="CODE_DEFINE_SHAPE3",t[t.CODE_DEFINE_TEXT2=33]="CODE_DEFINE_TEXT2",t[t.CODE_DEFINE_BUTTON2=34]="CODE_DEFINE_BUTTON2",t[t.CODE_DEFINE_BITS_JPEG3=35]="CODE_DEFINE_BITS_JPEG3",t[t.CODE_DEFINE_BITS_LOSSLESS2=36]="CODE_DEFINE_BITS_LOSSLESS2",t[t.CODE_DEFINE_EDIT_TEXT=37]="CODE_DEFINE_EDIT_TEXT",t[t.CODE_DEFINE_SPRITE=39]="CODE_DEFINE_SPRITE",t[t.CODE_DEFINE_MORPH_SHAPE=46]="CODE_DEFINE_MORPH_SHAPE",t[t.CODE_DEFINE_FONT2=48]="CODE_DEFINE_FONT2",t[t.CODE_DEFINE_VIDEO_STREAM=60]="CODE_DEFINE_VIDEO_STREAM",t[t.CODE_DEFINE_FONT3=75]="CODE_DEFINE_FONT3",t[t.CODE_DEFINE_SHAPE4=83]="CODE_DEFINE_SHAPE4",t[t.CODE_DEFINE_MORPH_SHAPE2=84]="CODE_DEFINE_MORPH_SHAPE2",t[t.CODE_DEFINE_BINARY_DATA=87]="CODE_DEFINE_BINARY_DATA",t[t.CODE_DEFINE_BITS_JPEG4=90]="CODE_DEFINE_BITS_JPEG4",t[t.CODE_DEFINE_FONT4=91]="CODE_DEFINE_FONT4"}(DefinitionTags||(DefinitionTags={})),function(t){t[t.CODE_DEFINE_BITS=6]="CODE_DEFINE_BITS",t[t.CODE_DEFINE_BITS_JPEG2=21]="CODE_DEFINE_BITS_JPEG2",t[t.CODE_DEFINE_BITS_JPEG3=35]="CODE_DEFINE_BITS_JPEG3",t[t.CODE_DEFINE_BITS_JPEG4=90]="CODE_DEFINE_BITS_JPEG4"}(ImageDefinitionTags||(ImageDefinitionTags={})),function(t){t[t.CODE_DEFINE_FONT=10]="CODE_DEFINE_FONT",t[t.CODE_DEFINE_FONT2=48]="CODE_DEFINE_FONT2",t[t.CODE_DEFINE_FONT3=75]="CODE_DEFINE_FONT3",t[t.CODE_DEFINE_FONT4=91]="CODE_DEFINE_FONT4"}(FontDefinitionTags||(FontDefinitionTags={})),function(t){t[t.CODE_PLACE_OBJECT=4]="CODE_PLACE_OBJECT",t[t.CODE_PLACE_OBJECT2=26]="CODE_PLACE_OBJECT2",t[t.CODE_PLACE_OBJECT3=70]="CODE_PLACE_OBJECT3",t[t.CODE_REMOVE_OBJECT=5]="CODE_REMOVE_OBJECT",t[t.CODE_REMOVE_OBJECT2=28]="CODE_REMOVE_OBJECT2",t[t.CODE_START_SOUND=15]="CODE_START_SOUND",t[t.CODE_START_SOUND2=89]="CODE_START_SOUND2",t[t.CODE_VIDEO_FRAME=61]="CODE_VIDEO_FRAME"}(ControlTags||(ControlTags={}));var SWFParser=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this,URLLoaderDataFormat.ARRAY_BUFFER)||this;return i._parsed_header=!1,i._debug=!1,i._startedParsing=!1,i.soundExports={},i.externalDependenciesCount=0,i._buttonIds={},i._mcIds={},i.textFormatAlignMap=[TextFormatAlign.LEFT,TextFormatAlign.RIGHT,TextFormatAlign.CENTER,TextFormatAlign.JUSTIFY],i._buttonSounds={},i._swfFile=new SWFFile,i._factory=e||new DefaultSceneGraphFactory,i}return __extends(e,t),Object.defineProperty(e.prototype,"swfFile",{get:function(){return this._swfFile},enumerable:!0,configurable:!0}),e.supportsType=function(t){return t=t.toLowerCase(),console.log("SWFParser supportsType extension: ",t,"result: ","swf"==t),"swf"==t},e.supportsData=function(t){var e=t[0]<<16|t[1]<<8|t[2];return console.log("SWFParser supportsData data: ",t),22355==(65535&e)?(console.log("SWFParser supportsData result: ",!0),!0):(console.log("SWFParser supportsData result: ",!1),!1)},e.prototype._iResolveDependency=function(t){if(1!=t.assets.length)throw"SWFParser: error when resolving dependency";var e=this.eagerlyParsedSymbolsMap[t.id];if(e)switch(e.type){case"image":var i=t.assets[0];this._awaySymbols[t.id]=i;break;case"font":break;case"sound":var r=t.assets[0];this._awaySymbols[t.id]=r;break;default:console.log("finished unknown parsing",t)}else console.log("no eagerlyParsedSymbolsMap for id",t.id);this.externalDependenciesCount--,0==this.externalDependenciesCount&&this.parseSymbolsToAwayJS()},e.prototype._iResolveDependencyFailure=function(t){this.externalDependenciesCount--,0==this.externalDependenciesCount&&this.parseSymbolsToAwayJS()},e.prototype._iResolveDependencyName=function(t,e){var i=e.name,r=e.name;return e.name=i,r},e.prototype._pProceedParsing=function(){if(!this._startedParsing){this._factory.url=this._iFileName,this._startedParsing=!0;var t=this._pGetByteData(),e=new Uint8Array(t.arraybytes);if(this.initSWFLoading(e,e.length),this._awaySymbols={},this._mapMatsForBitmaps={},this.abcBlocks.length&&this._factory.executeABCBytes&&this._factory.executeABCBytes(this.abcBlocks),this.externalDependenciesCount=0,this.eagerlyParsedSymbolsList.length>0)for(var i=0;i<this.eagerlyParsedSymbolsList.length;i++){var r=this.eagerlyParsedSymbolsList[i];if(r)switch(r.type){case"image":this._pAddDependency(r.id.toString(),null,new Image2DParser(this._factory,r.definition.alphaData),new Blob([r.definition.data],{type:r.definition.mimeType}),!1,!0),this.externalDependenciesCount++;break;case"sound":this._pAddDependency(r.id.toString(),null,new WaveAudioParser,new Blob([r.definition.packaged.data],{type:r.definition.packaged.mimeType}),!1,!0),this.externalDependenciesCount++;break;case"font":break;default:console.log("encountered eagerly parsed unknown type: ",r)}}this.externalDependenciesCount>0?this._pPauseAndRetrieveDependencies():this.parseSymbolsToAwayJS()}return this.externalDependenciesCount>0?ParserBase.MORE_TO_PARSE:ParserBase.PARSING_DONE},e.prototype.getMaterial=function(t){var e=this._mapMatsForBitmaps[t];if(!e){e=new MethodMaterial;var i=this._awaySymbols[t];i&&(i.isAsset(BitmapImage2D)||i.isAsset(SceneImage2D))||(console.log("error: can not find image for bitmapfill",i),i=new BitmapImage2D(512,512,!1,4278190335,!0)),e.ambientMethod.texture=new ImageTexture2D(i),e.alphaBlending=!0,e.useColorTransform=!0,e.bothSides=!0,this._mapMatsForBitmaps[t]=e}return e},e.prototype.parseSymbolsToAwayJS=function(){new DOMParser;for(var t=this.dictionary,e={},i=0;i<t.length;i++)if(t[i]){performance.now();var r=this.getSymbol(t[i].id);switch(r.type){case"morphshape":r.shape.name=r.id,r.shape.name="AwayJS_morphshape_"+r.id.toString(),r.shape.className=r.className,this._awaySymbols[t[i].id]=r.shape,e[t[i].id]=r.shape;break;case"shape":r.shape.name="AwayJS_shape_"+r.id.toString(),r.shape.className=r.className,this._awaySymbols[t[i].id]=r.shape,e[t[i].id]=r.shape;break;case"font":r.away.className=r.className,this._awaySymbols[t[i].id]=r,e[r.name]=r.away;break;case"sprite":(d=this.framesToTimeline(r,r.frames,null,null)).className=r.className,d.buttonMode?this._buttonIds[r.id]=!0:this._mcIds[r.id]=!0,d.name="AwayJS_mc_"+r.id.toString(),this._awaySymbols[t[i].id]=d,e[t[i].id]=d;break;case"text":(s=this._factory.createTextField(r))._symbol=r,s.textFormat=new TextFormat,s.className=r.className;var n=this._awaySymbols[r.tag.fontId];n&&(s.textFormat.font=n.away,s.textFormat.font_table=n.away.get_font_table(n.fontStyleName,TesselatedFontTable.assetType)),s.textFormat.size=r.tag.fontHeight/20,s.textColor=4&r.tag.flags?ColorUtils.f32_RGBA_To_f32_ARGB(r.tag.color):16777215,s.textFormat.leftMargin=r.tag.leftMargin/20,s.textFormat.rightMargin=r.tag.rightMargin/20,s.textFormat.letterSpacing=r.tag.letterSpacing/20,s.textFormat.leading=r.tag.leading/20,s.textFormat.align=this.textFormatAlignMap[r.tag.align],s.textOffsetX=r.fillBounds.xMin/20,s.textOffsetY=r.fillBounds.yMin/20,s.width=(r.fillBounds.xMax-r.fillBounds.xMin)/20,s.height=(r.fillBounds.yMax-r.fillBounds.yMin)/20,s.border=!!(2048&r.tag.flags),s.background=s.border,s.multiline=!!(32&r.tag.flags),s.wordWrap=!!(64&r.tag.flags),s.selectable=!!r.tag.flags&&!(4096&r.tag.flags),r.tag.maxLength&&r.tag.maxLength>0&&(s.maxChars=r.tag.maxLength),8&r.tag.flags?s.type="dynamic":s.type="input",512&r.tag.flags?(s.html=!0,r.tag.initialText&&""!=r.tag.initialText&&(s.htmlText=r.tag.initialText)):(s.html=!1,r.tag.initialText&&""!=r.tag.initialText&&(s.text=r.tag.initialText)),s.name="tf_"+r.id.toString(),e[t[i].id]=s,this._awaySymbols[t[i].id]=s;break;case"sound":var o=this._awaySymbols[t[i].id];o?(o.className=this.symbolClassesMap[r.id]?this.symbolClassesMap[r.id]:null,o.name=o.className,e[t[i].id]=o):console.warn("SWF-parser: no sound loaded for sound-id:",t[i].id);break;case"button":(d=this.framesToTimeline(r,null,r.states,r.buttonActions,this._buttonSounds[r.id])).name="AwayJS_button_"+r.id.toString(),d.className=r.className,e[t[i].id]=d,this._awaySymbols[t[i].id]=d,this._buttonIds[r.id]=!0;break;case"label":var s,a=null,l=!1;(s=this._factory.createTextField(r)).className=r.className;for(var h=0;h<r.records.length;h++){var c=r.records[h];c.fontId&&(a=this._awaySymbols[c.fontId])&&(c.font_table=a.away.get_font_table(a.fontStyleName,TesselatedFontTable.assetType),c.font_table||(l=!0,console.log("no font_table set")))}s.staticMatrix=r.matrix,s.textOffsetX=r.fillBounds.xMin/20,s.textOffsetY=r.fillBounds.yMin/20,s.width=r.fillBounds.xMax/20-r.fillBounds.xMin/20-1,s.height=r.fillBounds.yMax/20-r.fillBounds.yMin/20-1,l||s.setLabelData(r),s.name="AwayJS_label_"+r.id.toString(),e[t[i].id]=s,this._awaySymbols[t[i].id]=s,s.selectable=!!r.tag.flags&&!(4096&r.tag.flags);break;case"image":var u=this._awaySymbols[t[i].id];!u&&r.definition&&(u=new BitmapImage2D(r.definition.width,r.definition.height,!0,16711680,!1),r.definition.data.length!=4*r.definition.width*r.definition.height&&r.definition.data.length!=3*r.definition.width*r.definition.height&&(r.definition.data=new Uint8ClampedArray(4*r.definition.width*r.definition.height)),u.setPixels(new Rectangle(0,0,r.definition.width,r.definition.height),r.definition.data)),u&&(this._awaySymbols[t[i].id]=u,u.className=this.symbolClassesMap[r.id]?this.symbolClassesMap[r.id]:r.className,u.name=u.className,e[t[i].id]=u);break;case"binary":this._factory.createBinarySymbol&&this._factory.createBinarySymbol(r);break;default:console.log("unknown symbol type:",r.type,r)}}var p=this.dictionary[0];p||(p={id:0,className:this.symbolClassesMap[0]});var d=this.framesToTimeline(p,this._swfFile.frames,null,null);for(var f in e)e[f].fileurl=this._iFileName,this._pFinalizeAsset(e[f]);d.isAVMScene=!0,this._pFinalizeAsset(d,"scene"),DefaultFontManager.applySharedFonts(this._iFileName)},e.prototype.framesToTimeline=function(t,e,i,r,n){if(void 0===n&&(n=null),!i&&!e)throw"error when creating timeline - neither movieclip frames nor button-states present";var o=!1;if(t.isButton=!1,i&&!e)for(pt in o=!0,t.isButton=!0,e=[],i){var s=new SWFFrame;s.controlTags=i[pt],s.buttonStateName=pt,e[e.length]=s}var a=this._factory.createMovieClip(null,t);a.symbolID=t.id;var l,h,c,u,p,d,f,_,g,m,y,v,b,x,A,E,S=a.timeline,T=[],P=[],C=[],w=[],D=[],M=[],O=[],I=[],L=[],N=[],F=[],R=[],B=[],V=[],k=[],U=[],j=[],G={},z={},X=0,H=[],$=[],W=[],q=[],Y=[],K=[],Z={},J=0,Q=e.length,tt=0,et=0,it=null,rt=-1,nt=-1,ot=-1,st=!0;for(MovieClip.movieClipSoundsManagerClass=MovieClipSoundsManager,u=0;u<Q;u++){if(H.length=0,$.length=0,W.length=0,q.length=0,Y.length=0,K.length=0,e[u].soundStreamHead&&a.initSoundStream(e[u].soundStreamHead,Q),e[u].soundStreamBlock&&a.addSoundStreamBlock(u,e[u].soundStreamBlock),e[u].initActionBlocks&&(S.avm1InitActions[u]=e[u].initActionBlocks),e[u].exports)for(pt in S.avm1Exports[u]=e[u].exports,e[u].exports){var at=e[u].exports[pt],lt=this._awaySymbols[at.symbolId];lt?lt.isAsset?lt.name=at.className.toLowerCase():lt.away:console.log("\n\nerror: no away-asset for export\n\n",e[u].exports[pt])}if(_=!(e[u].controlTags&&0!=e[u].controlTags.length||e[u].labelNames&&0!=e[u].labelNames.length||e[u].actionBlocks&&0!=e[u].actionBlocks.length),0!=T.length&&_)if(o){for(pt in tt=0,tt|=1,P.push(D.length),T[T.length]=1,C.push(tt),G)(c=z[(l=G[pt]).id])||(c=z[l.id]={}),c[h=l.name]||(c[h]=[]),c[h].push(l.sessionID);G={},X++}else T[T.length-1]+=1;else{if(tt=0,o){for(pt in tt|=1,G)(c=z[(l=G[pt]).id])||(c=z[l.id]={}),c[h=l.name]||(c[h]=[]),c[h].push(l.sessionID);G={}}if(P.push(D.length),T[T.length]=1,!_&&e[u].labelNames&&e[u].labelNames.length>0)for(f=e[u].labelNames.length,d=0;d<f;d++)p=e[u].labelNames[d],this.swfFile.swfVersion<=9&&(p=p.toLowerCase()),S._labels[p]||(S._labels[p]=X);if(!_&&e[u].actionBlocks&&e[u].actionBlocks.length>0&&S.add_framescript(e[u].actionBlocks,u),n&&n[X]&&0!=n[X].id&&(it=this._awaySymbols[n[X].id])&&(S.audioPool[et]={cmd:15,id:n[X].id,sound:it,props:n[X].info},q.push(et++)),X++,!_&&e[u].controlTags&&e[u].controlTags.length>0){for(g=e[u].controlTags.length,m=0;m<g;m++)switch((E=void 0===(y=e[u].controlTags[m]).tagCode?y:this.getParsedTag(y)).code){case 15:it=this._awaySymbols[E.soundId],E.soundInfo&&32&E.soundInfo.flags?S.audioPool[et]={cmd:16,id:E.soundId,sound:this._awaySymbols[E.soundId],props:E.soundInfo}:S.audioPool[et]={cmd:15,id:E.soundId,sound:this._awaySymbols[E.soundId],props:E.soundInfo},q.push(et++);break;case 16:S.audioPool[et]={cmd:16,id:E.soundId,sound:this._awaySymbols[E.soundId],props:E.soundInfo},q.push(et++);break;case 5:case 28:(l=G[E.depth])||console.log("Error in timeline. remove cant find the obejct to remove"),H[H.length]={depth:0|E.depth},G[E.depth]=null,Z[E.depth.toString()]=null,(c=z[l.id])||(c=z[l.id]={}),c[h=l.name]||(c[h]=[]),c[h].push(l.sessionID),delete G[E.depth];break;case 4:case 26:case 70:if(v=E,l=G[E.depth],b=v.symbolId>-1,1&v.flags&&!l)break;if(it=null,rt=-1,nt=-1,ot=-1,b)if(it=this._awaySymbols[v.symbolId],x=this.dictionary[v.symbolId],it.isAsset(Graphics))if(nt=v.symbolId,S.graphicsPool[v.symbolId]||(S.graphicsPool[v.symbolId]=it),(A=this._factory.createSprite(null,it,x)).mouseEnabled=!1,l&&l.awayChild.isAsset(Sprite))rt=l.sessionID;else{if(null!=v&&(v.name&&""!=v.name||this._buttonIds[v.symbolId]||this._mcIds[v.symbolId])&&(v.name&&""!=v.name||(v.name="instance"+v.symbolId+"_"+J++)),l&&(H[H.length]={depth:0|E.depth},(c=z[l.id])||(c=z[l.id]={}),c[h=l.name]||(c[h]=[]),c[h].push(l.sessionID),G[E.depth]=null,Z[E.depth.toString()]=null,delete G[E.depth]),z[v.symbolId])if(h=v.name?v.name:"noname",z[v.symbolId][h]&&z[v.symbolId][h].length>0)rt=z[v.symbolId][h].shift();else for(pt in z[v.symbolId])if(z[v.symbolId][pt].length>0){rt=z[v.symbolId][pt].shift();break}-1==rt&&(rt=S.registerPotentialChild(A)),(v.name||v.variableName||v.events&&v.events.length>0)&&(S.potentialPrototypesInitEventsMap[rt+"#"+u]=v),l=G[E.depth]={sessionID:rt,id:v.symbolId,masks:[],isMask:!1,clipDepth:0,depth:0,awayChild:A,name:v.name?v.name:"noname"},$[$.length]={sessionID:rt,depth:E.depth,id:v.symbolId,name:v.name}}else{if(v.name&&""!=v.name||(v.name="instance"+v.symbolId+"_"+J++),z[v.symbolId])if(h=v.name?v.name:"noname",z[v.symbolId][h]&&z[v.symbolId][h].length>0)rt=z[v.symbolId][h].shift();else for(pt in z[v.symbolId])if(z[v.symbolId][pt].length>0){rt=z[v.symbolId][pt].shift();break}-1==rt&&(rt=S.registerPotentialChild(it)),(v.name||v.variableName||v.events&&v.events.length>0)&&(S.potentialPrototypesInitEventsMap[rt+"#"+u]=v),st=!0,G[E.depth]&&G[E.depth].id==v.symbolId&&(st=!1),l=G[E.depth]={sessionID:rt,id:v.symbolId,masks:[],isMask:!1,clipDepth:0,depth:0,awayChild:it,name:v.name?v.name:"noname"},st&&($[$.length]={sessionID:rt,depth:E.depth,id:v.symbolId,name:v.name})}if(16&v.flags&&(it||(it=this._awaySymbols[l.id]),it.isAsset(MorphSprite)&&(ot=v.ratio)),!l)throw"error in add command";W[W.length]={child:l,placeObjectTag:v,swapGraphicsID:nt,ratio:ot,depth:E.depth};break;default:console.log("unknown timeline command tag",E)}var ht=I.length;if(ut=H.length){ht=I.length;for(var ct=0;ct<ut;ct++)I.push(H[ct].depth);tt|=2,w.push(I.length-ht),D.push(ht)}if(ut=$.length){ht=M.length;for(ct=0;ct<ut;ct++)M.push($[ct].sessionID),M.push($[ct].depth);tt|=4,w.push(ut),D.push(ht/2)}var ut=W.length;for(var pt in G)G[pt].oldMasks=G[pt].masks,G[pt].masks=[],G[pt].maskingChanged=!1;if(ut)for(ct=0;ct<ut;ct++)v=W[ct].placeObjectTag,(l=W[ct].child).maskingChanged=!0,64&v.flags&&(G[v.depth].isMask=!0,G[v.depth].clipDepth=v.clipDepth-1,G[v.depth].depth=v.depth);for(var pt in G)if(G[pt].isMask)for(var dt=G[pt].clipDepth;dt>G[pt].depth;)G[dt]&&G[dt].masks.push(G[pt].sessionID),dt--;var ft=0,_t=0,gt=[];for(var pt in G){var mt=G[pt];if(mt.masks.sort(),mt.oldMasks.sort(),mt.masks.length!=mt.oldMasks.length)gt.push(mt),mt.maskingChanged=!0;else for(ft=0,_t=mt.masks.length,ft=0;ft<_t;ft++)if(mt.masks[ft]!=mt.oldMasks[ft]){gt.push(mt),mt.maskingChanged=!0;break}}for(_t=gt.length,ft=0;ft<_t;ft++){var yt=!1;if(ut)for(ct=0;ct<ut;ct++)W[ct].child==gt[ft]&&(yt=!0);yt||(W[W.length]={child:gt[ft],placeObjectTag:null,swapGraphicsID:null,ratio:null,depth:null})}if(ut=W.length){ht=L.length;var vt,bt=0;for(ct=0;ct<ut;ct++){v=(vt=W[ct]).placeObjectTag,l=vt.child;var xt=R.length,At=0;if(null!=vt.swapGraphicsID&&vt.swapGraphicsID>=0&&(At++,R.push(202),B.push(V.length),V.push(vt.swapGraphicsID)),null!=v&&(v.name&&""!=v.name||this._buttonIds[v.symbolId]||this._mcIds[v.symbolId])&&(At++,this._buttonIds[v.symbolId]?R.push(5):R.push(4),B.push(j.length),j.push(v.name)),null!=v&&4&v.flags)At++,R.push(1),B.push(k.length/6),0==v.matrix.a&&0==v.matrix.b&&0==v.matrix.c&&0!=v.matrix.d?v.matrix.a=1:0==v.matrix.d&&0==v.matrix.b&&0==v.matrix.c&&0!=v.matrix.a&&(v.matrix.d=1),k[k.length]=v.matrix.a,k[k.length]=v.matrix.b,k[k.length]=v.matrix.c,k[k.length]=v.matrix.d,k[k.length]=v.matrix.tx/20,k[k.length]=v.matrix.ty/20,Z[vt.depth.toString()]=v.matrix;else if(null!=vt.depth){var Et=Z[vt.depth.toString()];Et&&(At++,R.push(1),B.push(k.length/6),k[k.length]=Et.a,k[k.length]=Et.b,k[k.length]=Et.c,k[k.length]=Et.d,k[k.length]=Et.tx/20,k[k.length]=Et.ty/20)}if(null!=v&&8&v.flags&&(R.push(2),B.push(U.length/8),At++,U[U.length]=v.cxform.redMultiplier/255,U[U.length]=v.cxform.greenMultiplier/255,U[U.length]=v.cxform.blueMultiplier/255,U[U.length]=v.cxform.alphaMultiplier/255,U[U.length]=v.cxform.redOffset,U[U.length]=v.cxform.greenOffset,U[U.length]=v.cxform.blueOffset,U[U.length]=v.cxform.alphaOffset),null!=vt.ratio&&vt.ratio>=0&&(At++,R.push(203),B.push(V.length),V.push(0|vt.ratio)),l.maskingChanged){At++,R.push(3),B.push(V.length),V.push(l.masks.length);for(var St=0,Tt=l.masks;St<Tt.length;St++){var Pt=Tt[St];V.push(Pt)}}null!=v&&64&v.flags&&(At++,R.push(200),B.push(0)),null!=v&&v.flags,null!=v&&8192&v.flags&&(At++,R.push(6),B.push(v.visibility?1:0)),At>0&&(bt++,L.push(l.sessionID),N.push(xt),F.push(At))}bt>0&&(tt|=8,w.push(ut),D.push(ht))}if(ut=q.length){tt|=16,ht=O.length;for(ct=0;ct<ut;ct++)O.push(q[ct]);w.push(ut),D.push(ht)}}0==C.length&&(tt|=1),C.push(tt)}}var Ct=["_up","_over","_down","_hit"];if(4==Q){var wt=0;for(u=0;u<Q;u++)e[u].labelNames&&e[u].labelNames.length>0&&e[u].labelNames[0]==Ct[u]&&wt++;4==wt&&(o=!0)}return S.numKeyFrames=X,S.keyframe_durations=new Uint32Array(T),S.frame_command_indices=new Uint32Array(P),S.frame_recipe=new Uint32Array(C),S.command_length_stream=new Uint32Array(w),S.command_index_stream=new Uint32Array(D),S.add_child_stream=new Uint32Array(M),S.add_sounds_stream=new Uint32Array(O),S.remove_child_stream=new Uint32Array(I),S.update_child_stream=new Uint32Array(L),S.update_child_props_indices_stream=new Uint32Array(N),S.update_child_props_length_stream=new Uint32Array(F),S.property_type_stream=new Uint32Array(R),S.property_index_stream=new Uint32Array(B),S.properties_stream_int=new Uint32Array(V),S.properties_stream_f32_mtx_scale_rot=new Float32Array([]),S.properties_stream_f32_mtx_pos=new Float32Array([]),S.properties_stream_f32_mtx_all=new Float32Array(k),S.properties_stream_f32_ct=new Float32Array(U),S.properties_stream_strings=j,S.init(),o?(a.buttonMode=!0,S.isButton=!0,r&&(S.avm1ButtonActions=r),S.extractHitArea(a)):a.mouseEnabled=!1,a},e.prototype._pStartParsing=function(e){this._pContent=this._factory.createDisplayObjectContainer(),t.prototype._pStartParsing.call(this,e)},e.prototype.dispose=function(){this.swfData=null,this._dataStream=null},e.prototype.updateTimers=function(t){},e.prototype.initSWFLoading=function(t,e){assert(67===t[0]||70===t[0]||90===t[0],"Unsupported compression format: "+t[0]),assert(87===t[1]),assert(83===t[2]),assert(t.length>=30,"At least the header must be complete here."),this._swfFile.bytesTotal=e,this._swfFile.frames=[],this.abcBlocks=[],this.dictionary=[],this.fonts=[],this.symbolClassesMap=[],this.symbolClassesList=[],this.eagerlyParsedSymbolsMap=[],this.eagerlyParsedSymbolsList=[],this._jpegTables=null,this._currentFrameLabels=[],this._currentSoundStreamHead=null,this._currentSoundStreamBlock=null,this._currentControlTags=null,this._currentActionBlocks=null,this._currentInitActionBlocks=null,this._currentExports=null,this._endTagEncountered=!1,this.readHeaderAndInitialize(t)},e.prototype.finishLoading=function(){this._swfFile.compression!==CompressionMethod.None&&(this._decompressor.close(),this._decompressor=null,this.scanLoadedData())},e.prototype.getSymbol=function(t){if(this.eagerlyParsedSymbolsMap[t])return this.eagerlyParsedSymbolsMap[t];var e,i=this.dictionary[t];return i?((e=39===i.tagCode?this.parseSpriteTimeline(i):this.getParsedTag(i)).className=this.symbolClassesMap[t]||null,e.env=this.env,e):null},e.prototype.getParsedTag=function(t){this._dataStream.align(),this._dataStream.pos=t.byteOffset;var e=tagHandlers[t.tagCode],i=Math.min(t.byteOffset+t.byteLength,this._dataStream.end),r=e(this._dataStream,this._swfFile.swfVersion,t.tagCode,i,this._jpegTables);return r.fileURL=this._iFileName,this._dataStream.pos!==i&&this.emitTagSlopWarning(t,i),defineSymbol(r,this.dictionary,this)},e.prototype.readHeaderAndInitialize=function(t){var e=67===t[0],i=90===t[0];e?this._swfFile.compression=CompressionMethod.Deflate:i&&(this._swfFile.compression=CompressionMethod.LZMA),this._swfFile.swfVersion=t[3],this._swfFile.swfVersion,this._loadStarted=Date.now(),this._uncompressedLength=readSWFLength(t),this._swfFile.bytesLoaded=t.length,this.swfData=new Uint8Array(this._swfFile.compression===CompressionMethod.None?this._swfFile.bytesTotal:this._uncompressedLength),this._dataStream=new Stream(this.swfData.buffer),this._dataStream.pos=8,this._dataView=this._dataStream.view,e?(this.swfData.set(t.subarray(0,8)),this._uncompressedLoadedLength=8,this._decompressor=Inflate.create(!0),this._decompressor.onData=this.processFirstBatchOfDecompressedData.bind(this),this._decompressor.onError=function(t){throw new Error(t)},this._decompressor.push(t.subarray(8))):i?(this.swfData.set(t.subarray(0,8)),this._uncompressedLoadedLength=8,this._decompressor=new LzmaDecoder(!0),this._decompressor.onData=this.processFirstBatchOfDecompressedData.bind(this),this._decompressor.onError=function(t){},this._decompressor.push(t)):(this.swfData.set(t),this._uncompressedLoadedLength=t.length,this._decompressor=null,this.parseHeaderContents()),this._lastScanPosition=this._dataStream.pos,this.scanLoadedData()},e.prototype.parseHeaderContents=function(){var t=parseHeader(this._dataStream);this._swfFile.bounds=this._swfFile.bounds=t.bounds,this._swfFile.frameRate=this._swfFile.frameRate=t.frameRate,this._swfFile.frameCount=this._swfFile.frameCount=t.frameCount},e.prototype.processFirstBatchOfDecompressedData=function(t){this.processDecompressedData(t),this.parseHeaderContents(),this._decompressor.onData=this.processDecompressedData.bind(this)},e.prototype.processDecompressedData=function(t){var e=Math.min(t.length,this._uncompressedLength-this._uncompressedLoadedLength);memCopy(this.swfData,t,this._uncompressedLoadedLength,0,e),this._uncompressedLoadedLength+=e},e.prototype.scanLoadedData=function(){this._dataStream.pos=this._lastScanPosition,this.scanTagsToOffset(this._uncompressedLoadedLength,!0),this._lastScanPosition=this._dataStream.pos},e.prototype.scanTagsToOffset=function(t,e){for(var i,r=new UnparsedTag(0,0,0);(i=this._dataStream.pos)<t-1&&this.parseNextTagHeader(r);){if(0===r.tagCode)return void(e&&(this._endTagEncountered=!0));var n=r.byteOffset+r.byteLength;if(n>t)return void(this._dataStream.pos=i);this.scanTag(r,e),this._dataStream.pos!==n&&this.emitTagSlopWarning(r,n)}},e.prototype.parseNextTagHeader=function(t){var e=this._dataStream.pos,i=this._dataView.getUint16(e,!0);e+=2,t.tagCode=i>>6;var r=63&i;if(63===r){if(e+4>this._uncompressedLoadedLength)return!1;r=this._dataView.getUint32(e,!0),e+=4}return this._dataStream.pos=e,t.byteOffset=e,t.byteLength=r,!0},e.prototype.Utf8ArrayToStr=function(t){var e,i,r,n,o,s;for(e="",r=t.length,i=0;i<r;)switch((n=t[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:o=t[i++],e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t[i++],s=t[i++],e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return e},e.prototype.scanTag=function(t,e){var i=this._dataStream,r=i.pos;assert(r===t.byteOffset);var n=t.tagCode,o=t.byteLength;if(39===n){this.addLazySymbol(n,r,o);var s=r+o;return i.pos+=4,this.scanTagsToOffset(s,!1),void(this._dataStream.pos!==s&&this.emitTagSlopWarning(t,s))}if(ImageDefinitionTags[n]){var a=this.addLazySymbol(n,r,o);this.decodeEmbeddedImage(a)}else{if(14===n){a=this.addLazySymbol(n,r,o);var l=this.getParsedTag(a),h=new EagerlyParsedDictionaryEntry(l.id,a,"sound",l);return this.eagerlyParsedSymbolsMap[h.id]=h,void this.eagerlyParsedSymbolsList.push(h)}if(FontDefinitionTags[n]){a=this.addLazySymbol(n,r,o);this.registerEmbeddedFont(a)}else{if(DefinitionTags[n])return this.addLazySymbol(n,r,o),void this.jumpToNextTag(o);if(e||76===n||56===n)if(ControlTags[n])this.addControlTag(n,r,o);else switch(n){case 69:this.setFileAttributes(o);break;case 86:this.setSceneAndFrameLabelData(o);break;case 9:this._swfFile.backgroundColor=this._swfFile.backgroundColor=parseRgb(this._dataStream);break;case 8:this._jpegTables||(this._jpegTables=0===o?new Uint8Array(0):this.swfData.subarray(i.pos,i.pos+o-2)),this.jumpToNextTag(o);break;case 82:case 72:if(this._swfFile.useAVM1)this.jumpToNextTag(o);else{var c=r+o,u=new ABCBlock;82===n?(u.flags=i.readUi32(),u.name=i.readString(-1)):(u.flags=0,u.name=""),u.data=this.swfData.subarray(i.pos,c),this.abcBlocks.push(u),i.pos=c}break;case 76:c=r+o;for(var p=i.readUi16();p--;){var d=i.readUi16(),f=i.readString(-1);this.symbolClassesMap[d]=f,this.symbolClassesList.push({id:d,className:f})}i.pos=c;break;case 59:if(this._swfFile.useAVM1){var _=this._currentInitActionBlocks||(this._currentInitActionBlocks=[]),g=this._dataView.getUint16(i.pos,!0),m=this.swfData.subarray(r+2,r+o);_.push({spriteId:g,actionsData:m})}this.jumpToNextTag(o);break;case 12:if(this._swfFile.useAVM1){var y=this._currentActionBlocks||(this._currentActionBlocks=[]);m=this.swfData.subarray(i.pos,i.pos+o);y.push({actionsData:m,precedence:i.pos})}this.jumpToNextTag(o);break;case 18:case 45:var v=parseSoundStreamHeadTag(this._dataStream,r+o);this._currentSoundStreamHead=SoundStream.FromTag(v);break;case 19:this._currentSoundStreamBlock=this.swfData.subarray(i.pos,i.pos+=o);break;case 43:c=i.pos+o;this._currentFrameLabels[this._currentFrameLabels.length]=i.readString(-1),i.pos=c;break;case 1:this.finishFrame();break;case 0:return;case 56:c=i.pos+o;for(var b=i.readUi16(),x=this._currentExports||(this._currentExports=[]);b--;){d=i.readUi16();var A=i.readString(-1);if(i.pos>c){i.pos=c;break}x.push(new SymbolExport(d,A))}i.pos=c;break;case 17:c=i.pos+o;var E=i.readUi16();this._buttonSounds[E]={};for(var S=0;S<4;S++)this._buttonSounds[E][S]={},this._buttonSounds[E][S].id=i.readUi16(),0!=this._buttonSounds[E][S].id&&(this._buttonSounds[E][S].info=parseSoundInfo(i));i.pos=c;break;case 23:case 13:case 62:case 78:case 57:case 71:this.jumpToNextTag(o);break;case 77:this.parseMetaData(o);break;case 74:case 73:case 65:case 66:case 58:case 64:case 63:case 88:case 40:case 41:case 24:case 25:case 93:case 55:case 49:this.jumpToNextTag(o);break;case 51:case 44:case 50:case 53:case 42:case 38:case 52:case 3:case 31:case 47:case 16:case 29:this.jumpToNextTag(o);break;default:n>100?console.log("Encountered undefined tag "+n+", probably used for AVM1 obfuscation. See http://ijs.mtasa.com/files/swfdecrypt.cpp."):console.log("Tag not handled by the parser: "+n+": "+getSwfTagCodeName(n)),this.jumpToNextTag(o)}else this.jumpToNextTag(o)}}},e.prototype.parseSpriteTimeline=function(t){var e=this.swfData,i=this._dataStream,r=this._dataView,n={id:t.id,type:"sprite",frames:[]},o=t.byteOffset+t.byteLength,s=n.frames,a=[],l=[],h=null,c=null,u=null,p=null;i.pos=t.byteOffset+2,n.frameCount=r.getUint16(i.pos,!0),i.pos+=2;for(var d=new UnparsedTag(0,0,0);i.pos<o;){this.parseNextTagHeader(d);var f=d.byteLength,_=d.tagCode;if(i.pos+f>o){console.log("DefineSprite child tags exceed DefineSprite tag length and are dropped");break}if(ControlTags[_])l.push(new UnparsedTag(_,i.pos,f)),i.pos+=f;else{switch(_){case 12:if(this._swfFile.useAVM1){u||(u=[]);var g=e.subarray(i.pos,i.pos+f);u.push({actionsData:g,precedence:i.pos})}break;case 59:if(this._swfFile.useAVM1){p||(p=[]);var m=r.getUint16(i.pos,!0);i.pos+=2;g=e.subarray(i.pos,i.pos+f);p.push({spriteId:m,actionsData:g})}break;case 43:var y=i.pos+f;a[a.length]=i.readString(-1),i.pos=y,f=0;break;case 1:s.push(new SWFFrame(l,a.concat(),h,c,u,p,null)),a.length=0,l=[],h=null,c=null,u=null,p=null;break;case 0:i.pos=o,f=0;break;case 18:case 45:var v=i.pos,b=parseSoundStreamHeadTag(i,y=i.pos+f);h=SoundStream.FromTag(b),i.pos=v;break;case 19:v=i.pos,y=i.pos+f;c=this.swfData.subarray(i.pos,y),i.pos=v}i.pos+=f,assert(i.pos<=o)}}return n},e.prototype.parseMetaData=function(t){this._dataStream.pos+=t},e.prototype.jumpToNextTag=function(t){this._dataStream.pos+=t},e.prototype.emitTagSlopWarning=function(t,e){this._dataStream.pos,t.byteOffset;this._dataStream.pos=e},e.prototype.finishFrame=function(){0===this.pendingUpdateDelays&&this._swfFile.framesLoaded++,this._swfFile.frames.push(new SWFFrame(this._currentControlTags,this._currentFrameLabels.concat(),this._currentSoundStreamHead,this._currentSoundStreamBlock,this._currentActionBlocks,this._currentInitActionBlocks,this._currentExports)),this._currentFrameLabels.length=0,this._currentControlTags=null,this._currentSoundStreamHead=null,this._currentSoundStreamBlock=null,this._currentActionBlocks=null,this._currentInitActionBlocks=null,this._currentExports=null},e.prototype.setFileAttributes=function(t){this._swfFile.attributes&&this.jumpToNextTag(t);var e=this.swfData[this._dataStream.pos];this._dataStream.pos+=4,this._swfFile.attributes={network:1&e,relativeUrls:2&e,noCrossDomainCaching:4&e,doAbc:8&e,hasMetadata:16&e,useGpu:32&e,useDirectBlit:64&e},this._swfFile.useAVM1=!this._swfFile.attributes.doAbc},e.prototype.setSceneAndFrameLabelData=function(t){this._swfFile.sceneAndFrameLabelData?this.jumpToNextTag(t):this._swfFile.sceneAndFrameLabelData=this._swfFile.sceneAndFrameLabelData=parseDefineSceneTag(this._dataStream,86)},e.prototype.addControlTag=function(t,e,i){(this._currentControlTags||(this._currentControlTags=[])).push(new UnparsedTag(t,e,i)),this.jumpToNextTag(i)},e.prototype.addLazySymbol=function(t,e,i){var r=this._dataView.getUint16(this._dataStream.pos,!0),n=new DictionaryEntry(r,t,e,i);return this.dictionary[r]=n,n},e.prototype.decodeEmbeddedFont=function(t){var e=this.getParsedTag(t),i=new EagerlyParsedDictionaryEntry(e.id,t,"font",e);this.eagerlyParsedSymbolsMap[i.id]=i,this.eagerlyParsedSymbolsList.push(i);var r=flagsToFontStyle(e.bold,e.italic);this.fonts.push({name:e.name,id:e.id,style:r})},e.prototype.registerEmbeddedFont=function(t){var e,i,r=this._dataStream,n=this._dataView.getUint16(r.pos,!0);if(10===t.tagCode)i="__autofont__"+t.byteOffset,e="regular";else{var o=this.swfData[r.pos+2];e=flagsToFontStyle(!!(1&o),!!(2&o));var s=this.swfData[r.pos+4];r.pos+=5,i=r.readString(s)}this.fonts.push({name:i,id:n,style:e}),r.pos=t.byteOffset+t.byteLength},e.prototype.decodeEmbeddedImage=function(t){var e=this.getParsedTag(t),i=new EagerlyParsedDictionaryEntry(e.id,t,"image",e);this.eagerlyParsedSymbolsMap[i.id]=i,this.eagerlyParsedSymbolsList.push(i)},e}(ParserBase);function flagsToFontStyle(t,e){return t&&e?"boldItalic":t?"bold":e?"italic":"regular"}function readSWFLength(t){return(t[4]|t[5]<<8|t[6]<<16|t[7]<<24)>>>0}function defineSymbol(t,e,i){switch(t.code){case 6:case 21:case 35:case 90:return defineImage(t);case 20:case 36:return defineBitmap(t);case 7:case 34:return defineButton(t,e);case 37:return defineText(t);case 10:case 48:case 75:case 91:return defineFont(t,i._iFileName);case 46:case 84:case 2:case 22:case 32:case 83:return defineShape(t,i);case 14:return defineSound(t);case 60:return{type:"video",id:t.id,width:t.width,height:t.height,deblocking:t.deblocking,smoothing:t.smoothing,codec:t.codecId};case 39:return t;case 87:return{type:"binary",id:t.id,data:t.data};case 11:case 33:return defineLabel(t);default:return t}}var jsGlobal=Function("return this")();function pow2(t){return t===(0|t)?t<0?1/(1<<-t):1<<t:Math.pow(2,t)}function clamp$1(t,e,i){return Math.max(e,Math.min(i,t))}function roundHalfEven(t){if(.5===Math.abs(t%1)){var e=Math.floor(t);return e%2==0?e:Math.ceil(t)}return Math.round(t)}function altTieBreakRound(t,e){return.5!==Math.abs(t%1)||e?Math.round(t):0|t}function epsilonEquals(t,e){return Math.abs(t-e)<1e-7}var NumberUtilities={pow2:pow2,clamp:clamp$1,roundHalfEven:roundHalfEven,altTieBreakRound:altTieBreakRound,epsilonEquals:epsilonEquals};function repeatString(t,e){for(var i="",r=0;r<e;r++)i+=t;return i}function memorySizeToString(t){var e=1024,i=e*e;return(t|=0)<e?t+" B":t<i?(t/e).toFixed(2)+"KB":(t/i).toFixed(2)+"MB"}function toSafeString(t){return"string"==typeof t?'"'+t+'"':"number"==typeof t||"boolean"==typeof t?String(t):t instanceof Array?"[] "+t.length:typeof t}function toSafeArrayString(t){for(var e=[],i=0;i<t.length;i++)e.push(toSafeString(t[i]));return e.join(", ")}function utf8decode$1(t){for(var e=new Uint8Array(4*t.length),i=0,r=0,n=t.length;r<n;r++){var o=t.charCodeAt(r);if(o<=127)e[i++]=o;else{if(55296<=o&&o<=56319){var s=t.charCodeAt(r+1);56320<=s&&s<=57343&&(o=((1023&o)<<10)+(1023&s)+65536,++r)}0!=(4292870144&o)?(e[i++]=248|o>>>24&3,e[i++]=128|o>>>18&63,e[i++]=128|o>>>12&63,e[i++]=128|o>>>6&63,e[i++]=128|63&o):0!=(4294901760&o)?(e[i++]=240|o>>>18&7,e[i++]=128|o>>>12&63,e[i++]=128|o>>>6&63,e[i++]=128|63&o):0!=(4294965248&o)?(e[i++]=224|o>>>12&15,e[i++]=128|o>>>6&63,e[i++]=128|63&o):(e[i++]=192|o>>>6&31,e[i++]=128|63&o)}}return e.subarray(0,i)}function utf8encode$1(t){for(var e=0,i="";e<t.length;){var r=255&t[e++];if(r<=127)i+=String.fromCharCode(r);else{var n=192,o=5;do{if((r&(n>>1|128))===n)break;n=n>>1|128,--o}while(o>=0);if(o<=0){i+=String.fromCharCode(r);continue}for(var s=r&(1<<o)-1,a=!1,l=5;l>=o;--l){var h=t[e++];if(128!=(192&h)){a=!0;break}s=s<<6|63&h}if(a){for(var c=e-(7-l);c<e;++c)i+=String.fromCharCode(255&t[c]);continue}i+=s>=65536?String.fromCharCode(s-65536>>10&1023|55296,1023&s|56320):String.fromCharCode(s)}}return i}function base64EncodeBytes(t){for(var e,i="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=t.byteLength,o=n%3,s=n-o,a=0;a<s;a+=3)i+=concat4(r[(16515072&(e=t[a]<<16|t[a+1]<<8|t[a+2]))>>18],r[(258048&e)>>12],r[(4032&e)>>6],r[63&e]);return 1==o?i+=concat3(r[(252&(e=t[s]))>>2],r[(3&e)<<4],"=="):2==o&&(i+=concat4(r[(64512&(e=t[s]<<8|t[s+1]))>>10],r[(1008&e)>>4],r[(15&e)<<2],"=")),i}var base64DecodeMap=[62,0,0,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,0,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],base64DecodeMapOffset=43,base64EOF=61;function decodeRestrictedBase64ToBytes(t){for(var e,i,r,n=t.length,o="="===t.charAt(n-2)?2:"="===t.charAt(n-1)?1:0,s=new Uint8Array(3*(t.length>>2)-o),a=0,l=0;a<t.length;){if(e=t.charCodeAt(a++),i=base64DecodeMap[e-base64DecodeMapOffset],e=t.charCodeAt(a++),r=base64DecodeMap[e-base64DecodeMapOffset],s[l++]=i<<2|(48&r)>>4,(e=t.charCodeAt(a++))==base64EOF)return s;if(i=base64DecodeMap[e-base64DecodeMapOffset],s[l++]=(15&r)<<4|(60&i)>>2,(e=t.charCodeAt(a++))==base64EOF)return s;r=base64DecodeMap[e-base64DecodeMapOffset],s[l++]=(3&i)<<6|r}return s}function escapeString(t){return void 0!==t&&(t=t.replace(/[^\w$]/gi,"$"),/^\d/.test(t)&&(t="$"+t)),t}function fromCharCodeArray(t){for(var e="",i=0;i<t.length;i+=16384){var r=Math.min(t.length-i,16384);e+=String.fromCharCode.apply(null,t.subarray(i,i+r))}return e}var _encoding="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$_";function variableLengthEncodeInt32(t){for(var e=_encoding,i=32-Math.clz32(t),r=Math.ceil(i/6),n=e[r],o=r-1;o>=0;o--){n+=e[t>>6*o&63]}return n}function toEncoding(t){return _encoding[t]}function fromEncoding(t){return t>=65&&t<=90?t-65:t>=97&&t<=122?t-71:t>=48&&t<=57?t+4:36===t?62:95===t?63:void 0}function variableLengthDecodeInt32(t){for(var e=fromEncoding(t.charCodeAt(0)),i=0,r=0;r<e;r++){var n=6*(e-r-1);i|=fromEncoding(t.charCodeAt(1+r))<<n}return i}function trimMiddle(t,e){if(t.length<=e)return t;var i=e>>1,r=e-i-1;return t.substr(0,i)+""+t.substr(t.length-r,r)}function multiple(t,e){for(var i="",r=0;r<e;r++)i+=t;return i}function indexOfAny(t,e,i){for(var r=t.length,n=0;n<e.length;n++){var o=t.indexOf(e[n],i);o>=0&&(r=Math.min(r,o))}return r===t.length?-1:r}var _concat3array=new Array(3),_concat4array=new Array(4),_concat9array=new Array(9);function concat3(t,e,i){return _concat3array[0]=t,_concat3array[1]=e,_concat3array[2]=i,_concat3array.join("")}function concat4(t,e,i,r){return _concat4array[0]=t,_concat4array[1]=e,_concat4array[2]=i,_concat4array[3]=r,_concat4array.join("")}function concat9(t,e,i,r,n,o,s,a,l){return _concat9array[0]=t,_concat9array[1]=e,_concat9array[2]=i,_concat9array[3]=r,_concat9array[4]=n,_concat9array[5]=o,_concat9array[6]=s,_concat9array[7]=a,_concat9array[8]=l,_concat9array.join("")}var StringUtilities={repeatString:repeatString,memorySizeToString:memorySizeToString,toSafeString:toSafeString,toSafeArrayString:toSafeArrayString,utf8decode:utf8decode$1,utf8encode:utf8encode$1,base64EncodeBytes:base64EncodeBytes,base64DecodeMap:base64DecodeMap,base64DecodeMapOffset:base64DecodeMapOffset,base64EOF:base64EOF,decodeRestrictedBase64ToBytes:decodeRestrictedBase64ToBytes,escapeString:escapeString,fromCharCodeArray:fromCharCodeArray,variableLengthEncodeInt32:variableLengthEncodeInt32,toEncoding:toEncoding,fromEncoding:fromEncoding,variableLengthDecodeInt32:variableLengthDecodeInt32,trimMiddle:trimMiddle,multiple:multiple,indexOfAny:indexOfAny,_concat3array:_concat3array,_concat4array:_concat4array,_concat9array:_concat9array,concat3:concat3,concat4:concat4,concat9:concat9};function toS8U8(t){return 256*t<<16>>16}function fromS8U8(t){return t/256}function clampS8U8(t){return fromS8U8(toS8U8(t))}function toS16(t){return t<<16>>16}function ones(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24}Math.imul||(Math.imul=function(t,e){var i=65535&t,r=65535&e;return i*r+((t>>>16&65535)*r+i*(e>>>16&65535)<<16>>>0)|0}),Math.clz32||(Math.clz32=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,32-ones(t|=t>>16)});var ShumwayCom={getWeakMapKeys:function(t){return null}},Shumway={version:"",build:""},inBrowser="undefined"!=typeof window&&"document"in window&&"plugins"in window.document,inFirefox="undefined"!=typeof navigator&&navigator.userAgent.indexOf("Firefox")>=0;function dumpLine(t){"undefined"!=typeof dump&&dump(t+"\n")}jsGlobal.performance||(jsGlobal.performance={}),jsGlobal.performance.now||(jsGlobal.performance.now=function(){return Date.now()});var START_TIME=performance.now(),UINT32_CHAR_BUFFER_LENGTH=10,UINT32_MAX_DIV_10=429496729,UINT32_MAX_MOD_10=5;function isString(t){return"string"==typeof t}function isNumber(t){return"number"==typeof t}function isInteger(t){return(0|t)===t}function isObject(t){return"object"==typeof t||"function"==typeof t}function toNumber(t){return+t}function isNumericString(t){return String(Number(t))===t}function isNumeric(t){if("number"==typeof t)return!0;if("string"==typeof t){var e=t.charCodeAt(0);return!(65<=e&&e<=90||97<=e&&e<=122||36===e||95===e)&&(isIndex(t)||isNumericString(t))}return!1}function isIndex(t){var e=0;if("number"==typeof t)return t===(e=0|t)&&e>=0||t>>>0===t;if("string"!=typeof t)return!1;var i=t.length;if(0===i)return!1;if("0"===t)return!0;if(i>UINT32_CHAR_BUFFER_LENGTH)return!1;var r=0;if((e=t.charCodeAt(r++)-48)<1||e>9)return!1;for(var n=0,o=0;r<i;){if((o=t.charCodeAt(r++)-48)<0||o>9)return!1;n=e,e=10*e+o}return n<UINT32_MAX_DIV_10||n===UINT32_MAX_DIV_10&&o<=UINT32_MAX_MOD_10}function isNullOrUndefined$1(t){return null==t}function argumentsToString(t){for(var e=[],i=0;i<t.length;i++){var r=t[i];try{var n;n="object"==typeof r&&r?"toString"in r?r.toString():Object.prototype.toString.call(r):r+"",e.push(n)}catch(t){e.push("<unprintable value>")}}return e.join(", ")}function polyfillWeakMap(){if("function"!=typeof jsGlobal.WeakMap){var t=0;e.prototype={has:function(t){return t.hasOwnProperty(this.id)},get:function(t,e){return t.hasOwnProperty(this.id)?t[this.id]:e},set:function(t,e){Object.defineProperty(t,this.id,{value:e,enumerable:!1,configurable:!0})},delete:function(t){delete t[this.id]}},jsGlobal.WeakMap=e}function e(){this.id="$weakmap"+t++}}polyfillWeakMap();var WeakList=function(){function t(){void 0!==ShumwayCom&&ShumwayCom.getWeakMapKeys?(this._map=new WeakMap,this._id=0,this._newAdditions=[]):this._list=[]}return t.prototype.clear=function(){this._map?this._map.clear():this._list.length=0},t.prototype.push=function(t){this._map?(assert$2(!this._map.has(t)),this._map.set(t,this._id++),this._newAdditions.forEach((function(e){e.push(t)}))):(assert$2(-1===this._list.indexOf(t)),this._list.push(t))},t.prototype.remove=function(t){this._map?(assert$2(this._map.has(t)),this._map.delete(t)):(assert$2(this._list.indexOf(t)>-1),this._list[this._list.indexOf(t)]=null,assert$2(-1===this._list.indexOf(t)))},t.prototype.forEach=function(t){if(this._map){var e=[];this._newAdditions.push(e);var i=this._map,r=ShumwayCom.getWeakMapKeys(i);return r.sort((function(t,e){return i.get(t)-i.get(e)})),r.forEach((function(e){0!==e._referenceCount&&t(e)})),e.forEach((function(e){0!==e._referenceCount&&t(e)})),void this._newAdditions.splice(this._newAdditions.indexOf(e),1)}for(var n=this._list,o=0,s=0;s<n.length;s++){(l=n[s])&&(0===l._referenceCount?(n[s]=null,o++):t(l))}if(o>16&&o>n.length>>2){var a=[];for(s=0;s<n.length;s++){var l;(l=n[s])&&l._referenceCount>0&&a.push(l)}this._list=a}},Object.defineProperty(t.prototype,"length",{get:function(){return this._map?-1:this._list.length},enumerable:!0,configurable:!0}),t}(),IndentingWriter=function(){function t(e,i){void 0===e&&(e=!1),this._tab="  ",this._padding="",this._suppressOutput=e,this._out=i||t._consoleOut,this._outNoNewline=i||t._consoleOutNoNewline}return Object.defineProperty(t.prototype,"suppressOutput",{get:function(){return this._suppressOutput},set:function(t){this._suppressOutput=t},enumerable:!0,configurable:!0}),t.prototype.write=function(t,e){void 0===t&&(t=""),void 0===e&&(e=!1),this._suppressOutput||this._outNoNewline((e?this._padding:"")+t)},t.prototype.writeLn=function(t){void 0===t&&(t=""),this._suppressOutput||this._out(this._padding+t)},t.prototype.writeObject=function(t,e){void 0===t&&(t=""),this._suppressOutput||this._out(this._padding+t,e)},t.prototype.writeTimeLn=function(t){void 0===t&&(t=""),this._suppressOutput||this._out(this._padding+performance.now().toFixed(2)+" "+t)},t.prototype.writeComment=function(t){var e=(t||"").split("\n");if(1===e.length)this.writeLn("// "+e[0]);else{this.writeLn("/**");for(var i=0;i<e.length;i++)this.writeLn(" * "+e[i]);this.writeLn(" */")}},t.prototype.writeLns=function(t){for(var e=(t||"").split("\n"),i=0;i<e.length;i++)this.writeLn(e[i])},t.prototype.errorLn=function(e){1&t.logLevel&&this.boldRedLn(e)},t.prototype.warnLn=function(e){2&t.logLevel&&this.yellowLn(e)},t.prototype.debugLn=function(e){4&t.logLevel&&this.purpleLn(e)},t.prototype.logLn=function(e){8&t.logLevel&&this.writeLn(e)},t.prototype.infoLn=function(e){16&t.logLevel&&this.writeLn(e)},t.prototype.yellowLn=function(e){this.colorLn(t.YELLOW,e)},t.prototype.greenLn=function(e){this.colorLn(t.GREEN,e)},t.prototype.boldRedLn=function(e){this.colorLn(t.BOLD_RED,e)},t.prototype.redLn=function(e){this.colorLn(t.RED,e)},t.prototype.purpleLn=function(e){this.colorLn(t.PURPLE,e)},t.prototype.colorLn=function(e,i){this._suppressOutput||(inBrowser?this._out(this._padding+i):this._out(this._padding+e+i+t.ENDC))},t.prototype.redLns=function(e){this.colorLns(t.RED,e)},t.prototype.colorLns=function(t,e){for(var i=(e||"").split("\n"),r=0;r<i.length;r++)this.colorLn(t,i[r])},t.prototype.enter=function(t){this._suppressOutput||this._out(this._padding+t),this.indent()},t.prototype.leaveAndEnter=function(t){this.leave(t),this.indent()},t.prototype.leave=function(t){this.outdent(),!this._suppressOutput&&t&&this._out(this._padding+t)},t.prototype.indent=function(){this._padding+=this._tab},t.prototype.outdent=function(){this._padding.length>0&&(this._padding=this._padding.substring(0,this._padding.length-this._tab.length))},t.prototype.writeArray=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e=e||!1;for(var r=0,n=t.length;r<n;r++){var o="";e&&(o=null===t[r]?"null":void 0===t[r]?"undefined":t[r].constructor.name,o+=" ");var s=i?"":(""+r).padRight(" ",4);this.writeLn(s+o+t[r])}},t.PURPLE="33[94m",t.YELLOW="33[93m",t.GREEN="33[92m",t.RED="33[91m",t.BOLD_RED="33[1;91m",t.ENDC="33[0m",t.logLevel=31,t._consoleOut=console.log.bind(console),t._consoleOutNoNewline=console.log.bind(console),t}(),Bounds$1=function(){function t(t,e,i,r){this.xMin=0|t,this.yMin=0|e,this.xMax=0|i,this.yMax=0|r}return t.FromUntyped=function(e){return new t(e.xMin,e.yMin,e.xMax,e.yMax)},t.FromRectangle=function(e){return new t(20*e.x|0,20*e.y|0,20*(e.x+e.width)|0,20*(e.y+e.height)|0)},t.prototype.setElements=function(t,e,i,r){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=r},t.prototype.copyFrom=function(t){this.setElements(t.xMin,t.yMin,t.xMax,t.yMax)},t.prototype.contains=function(t,e){return t<this.xMin!=t<this.xMax&&e<this.yMin!=e<this.yMax},t.prototype.unionInPlace=function(t){t.isEmpty()||(this.extendByPoint(t.xMin,t.yMin),this.extendByPoint(t.xMax,t.yMax))},t.prototype.extendByPoint=function(t,e){this.extendByX(t),this.extendByY(e)},t.prototype.extendByX=function(t){134217728!==this.xMin?(this.xMin=Math.min(this.xMin,t),this.xMax=Math.max(this.xMax,t)):this.xMin=this.xMax=t},t.prototype.extendByY=function(t){134217728!==this.yMin?(this.yMin=Math.min(this.yMin,t),this.yMax=Math.max(this.yMax,t)):this.yMin=this.yMax=t},t.prototype.intersects=function(t){return this.contains(t.xMin,t.yMin)||this.contains(t.xMax,t.yMax)},t.prototype.isEmpty=function(){return this.xMax<=this.xMin||this.yMax<=this.yMin},Object.defineProperty(t.prototype,"width",{get:function(){return this.xMax-this.xMin},set:function(t){this.xMax=this.xMin+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.yMax-this.yMin},set:function(t){this.yMax=this.yMin+t},enumerable:!0,configurable:!0}),t.prototype.getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return e*(this.xMax-this.xMin)+i*(this.yMax-this.yMin)},t.prototype.getBaseHeight=function(t){var e=Math.abs(Math.cos(t));return Math.abs(Math.sin(t))*(this.xMax-this.xMin)+e*(this.yMax-this.yMin)},t.prototype.setEmpty=function(){this.xMin=this.yMin=this.xMax=this.yMax=0},t.prototype.setToSentinels=function(){this.xMin=this.yMin=this.xMax=this.yMax=134217728},t.prototype.clone=function(){return new t(this.xMin,this.yMin,this.xMax,this.yMax)},t.prototype.toString=function(){return"{ xMin: "+this.xMin+", xMin: "+this.yMin+", xMax: "+this.xMax+", xMax: "+this.yMax+" }"},t}(),DebugBounds=function(){function t(t,e,i,r){assert$2(isInteger(t)),assert$2(isInteger(e)),assert$2(isInteger(i)),assert$2(isInteger(r)),this._xMin=0|t,this._yMin=0|e,this._xMax=0|i,this._yMax=0|r,this.assertValid()}return t.FromUntyped=function(e){return new t(e.xMin,e.yMin,e.xMax,e.yMax)},t.FromRectangle=function(e){return new t(20*e.x|0,20*e.y|0,20*(e.x+e.width)|0,20*(e.y+e.height)|0)},t.prototype.setElements=function(t,e,i,r){this.xMin=t,this.yMin=e,this.xMax=i,this.yMax=r},t.prototype.copyFrom=function(t){this.setElements(t.xMin,t.yMin,t.xMax,t.yMax)},t.prototype.contains=function(t,e){return t<this.xMin!=t<this.xMax&&e<this.yMin!=e<this.yMax},t.prototype.unionInPlace=function(t){t.isEmpty()||(this.extendByPoint(t.xMin,t.yMin),this.extendByPoint(t.xMax,t.yMax))},t.prototype.extendByPoint=function(t,e){this.extendByX(t),this.extendByY(e)},t.prototype.extendByX=function(t){134217728!==this.xMin?(this.xMin=Math.min(this.xMin,t),this.xMax=Math.max(this.xMax,t)):this.xMin=this.xMax=t},t.prototype.extendByY=function(t){134217728!==this.yMin?(this.yMin=Math.min(this.yMin,t),this.yMax=Math.max(this.yMax,t)):this.yMin=this.yMax=t},t.prototype.intersects=function(t){return this.contains(t._xMin,t._yMin)||this.contains(t._xMax,t._yMax)},t.prototype.isEmpty=function(){return this._xMax<=this._xMin||this._yMax<=this._yMin},Object.defineProperty(t.prototype,"xMin",{get:function(){return this._xMin},set:function(t){assert$2(isInteger(t)),this._xMin=t,this.assertValid()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMin",{get:function(){return this._yMin},set:function(t){assert$2(isInteger(t)),this._yMin=0|t,this.assertValid()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xMax",{get:function(){return this._xMax},set:function(t){assert$2(isInteger(t)),this._xMax=0|t,this.assertValid()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._xMax-this._xMin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMax",{get:function(){return this._yMax},set:function(t){assert$2(isInteger(t)),this._yMax=0|t,this.assertValid()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._yMax-this._yMin},enumerable:!0,configurable:!0}),t.prototype.getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t));return e*(this._xMax-this._xMin)+i*(this._yMax-this._yMin)},t.prototype.getBaseHeight=function(t){var e=Math.abs(Math.cos(t));return Math.abs(Math.sin(t))*(this._xMax-this._xMin)+e*(this._yMax-this._yMin)},t.prototype.setEmpty=function(){this._xMin=this._yMin=this._xMax=this._yMax=0},t.prototype.clone=function(){return new t(this.xMin,this.yMin,this.xMax,this.yMax)},t.prototype.toString=function(){return"{ xMin: "+this._xMin+", yMin: "+this._yMin+", xMax: "+this._xMax+", yMax: "+this._yMax+" }"},t.prototype.assertValid=function(){},t}(),ImageType$1;!function(t){t[t.None=0]="None",t[t.PremultipliedAlphaARGB=1]="PremultipliedAlphaARGB",t[t.StraightAlphaARGB=2]="StraightAlphaARGB",t[t.StraightAlphaRGBA=3]="StraightAlphaRGBA",t[t.JPEG=4]="JPEG",t[t.PNG=5]="PNG",t[t.GIF=6]="GIF"}(ImageType$1||(ImageType$1={}));var PromiseWrapper=function(){function t(){this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this))}return t.prototype.then=function(t,e){return this.promise.then(t,e)},t}();"undefined"!=typeof exports&&(exports.Shumway=Shumway),function(){function t(t,e,i){t[e]||Object.defineProperty(t,e,{value:i,writable:!0,configurable:!0,enumerable:!1})}t(String.prototype,"padRight",(function(t,e){var i=this,r=function(t){return t.replace(/\033\[[0-9]*m/g,"")}(i).length;if(!t||r>=e)return i;for(var n=(e-r)/t.length,o=0;o<n;o++)i+=t;return i})),t(String.prototype,"padLeft",(function(t,e){var i=this,r=i.length;if(!t||r>=e)return i;for(var n=(e-r)/t.length,o=0;o<n;o++)i=t+i;return i})),t(String.prototype,"trim",(function(){return this.replace(/^\s+|\s+$/g,"")})),t(String.prototype,"endsWith",(function(t){return-1!==this.indexOf(t,this.length-t.length)})),t(Array.prototype,"replace",(function(t,e){if(t===e)return 0;for(var i=0,r=0;r<this.length;r++)this[r]===t&&(this[r]=e,i++);return i}))}();var OptionSet=function(){function t(t,e){void 0===e&&(e=null),this.open=!1,this.name=t,this.settings=e||{},this.options=[]}return t.isOptionSet=function(e){return e instanceof t||!("object"!=typeof e||null===e||e instanceof Option)&&("options"in e&&"name"in e&&"settings"in e)},t.prototype.register=function(e){if(t.isOptionSet(e))for(var i=0;i<this.options.length;i++){var r=this.options[i];if(t.isOptionSet(r)&&r.name===e.name)return r}if(this.options.push(e),this.settings)if(t.isOptionSet(e)){var n=this.settings[e.name];isObject(n)&&(e.settings=n.settings,e.open=n.open)}else if(void 0!==this.settings[e.longName])switch(e.type){case"boolean":e.value=!!this.settings[e.longName];break;case"number":e.value=+this.settings[e.longName];break;default:e.value=this.settings[e.longName]}return e},t.prototype.trace=function(t){t.enter(this.name+" {"),this.options.forEach((function(e){e.trace(t)})),t.leave("}")},t.prototype.getSettings=function(){var e={};return this.options.forEach((function(i){t.isOptionSet(i)?e[i.name]={settings:i.getSettings(),open:i.open}:e[i.longName]=i.value})),e},t.prototype.setSettings=function(e){e&&this.options.forEach((function(i){t.isOptionSet(i)?i.name in e&&i.setSettings(e[i.name].settings):i.longName in e&&(i.value=e[i.longName])}))},t}(),Option=function(){function t(t,e,i,r,n,o){void 0===o&&(o=null),this.longName=e,this.shortName=t,this.type=i,this.defaultValue=r,this.value=r,this.description=n,this.config=o}return t.prototype.parse=function(t){this.value=t},t.prototype.trace=function(t){t.writeLn(("-"+this.shortName+"|--"+this.longName).padRight(" ",30)+" = "+this.type+" "+this.value+" ["+this.defaultValue+"] ("+this.description+")")},t}(),ROOT="Shumway Options",shumwayOptions=new OptionSet(ROOT),loggingOptions=shumwayOptions.register(new OptionSet("Logging Options")),omitRepeatedWarnings=loggingOptions.register(new Option("wo","warnOnce","boolean",!0,"Omit Repeated Warnings")),release=!0,Debug=function(){function t(){}return t.release=release,t.assert=assert$2,t.error=error,t.assertUnreachable=assertUnreachable,t.assertNotImplemented=assertNotImplemented,t.warning=warning,t.notImplemented=notImplemented,t.dummyConstructor=dummyConstructor,t.warnCounts=warnCounts,t.abstractMethod=abstractMethod,t.somewhatImplemented=somewhatImplemented,t.unexpected=unexpected,t.unexpectedCase=unexpectedCase,t}();function notImplemented(t){warning("AVM1 not implemented: "+t)}function somewhatImplemented(t){warning("AVM1 somewhatImplemented: "+t)}function error(t){throw console.error(t),new Error(t)}function assert$2(t,e){if(void 0===e&&(e="assertion failed"),""===t&&(t=!0),!t){if("undefined"!=typeof console&&"assert"in console)throw console.assert(!1,e),new Error(e);error(e.toString())}}function assertUnreachable(t){var e=(new Error).stack.split("\n")[1];throw new Error("Reached unreachable location "+e+t)}function assertNotImplemented(t,e){t||error("notImplemented: "+e)}var _warnedCounts=Object.create(null);function warning(t,e,i){}function warnCounts(){var t=[];for(var e in _warnedCounts)t.push({key:e,count:_warnedCounts[e]});return t.sort((function(t,e){return e.count-t.count})),t.reduce((function(t,e){return t+"\n"+e.count+"\t"+e.key}),"")}function dummyConstructor(t){}function abstractMethod(t){}function unexpected(t){assert$2(!1,"Unexpected: "+t)}function unexpectedCase(t){assert$2(!1,"Unexpected Case: "+t)}var AVM1PropertyDescriptor=function(t,e,i,r,n){this.flags=t,this.value=e,this.get=i,this.set=r,this.watcher=n},NullPrototypeObject=function(){},DEBUG_PROPERTY_PREFIX="$Bg",AVM1Object=function(t){function e(e){var i=t.call(this)||this;i.initialDepth=0,i.scriptRefsToChilds={},i._avm1Context=e,i._ownProperties=Object.create(null),i.scriptRefsToChilds={},i._prototype=null,i._blockedByScript=!1,i._ctBlockedByScript=!1,i._visibilityByScript=!1;var r=i,n=new AVM1PropertyDescriptor(131,null,{alCall:function(t,e){return r.alPrototype}},{alCall:function(t,e){r.alPrototype=e[0]}});return i.alSetOwnProperty("__proto__",n),i}return __extends(e,t),Object.defineProperty(e.prototype,"eventObserver",{get:function(){return this._eventObserver},set:function(t){this._eventObserver=t},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){},e.prototype.isBlockedByScript=function(){return this._blockedByScript},e.prototype.isColorTransformByScript=function(){return this._ctBlockedByScript},e.prototype.isVisibilityByScript=function(){return this._visibilityByScript},e.prototype.initAdapter=function(){},e.prototype.freeFromScript=function(){this.protoTypeChanged=!1,this._blockedByScript=!1,this._ctBlockedByScript=!1,this._visibilityByScript=!1},e.prototype.clone=function(){return new e(this._avm1Context)},Object.defineProperty(e.prototype,"context",{get:function(){return this._avm1Context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alPrototype",{get:function(){return this._prototype},set:function(t){for(var e=t;e;){if(e===this)return;e=e.alPrototype}this._prototype=t},enumerable:!0,configurable:!0}),e.prototype.alGetPrototypeProperty=function(){return this.alGet("prototype")},e.prototype.alSetOwnPrototypeProperty=function(t){this.alSetOwnProperty("prototype",new AVM1PropertyDescriptor(65,t))},e.prototype.alGetConstructorProperty=function(){return this.alGet("__constructor__")},e.prototype.alSetOwnConstructorProperty=function(t){this.alSetOwnProperty("__constructor__",new AVM1PropertyDescriptor(65,t))},e.prototype._debugEscapeProperty=function(t){var e=this.context,i=alToString(e,t);return e.isPropertyCaseSensitive||(i=i.toLowerCase()),DEBUG_PROPERTY_PREFIX+i},e.prototype.alGetOwnProperty=function(t){return"string"!=typeof t||this.context.isPropertyCaseSensitive||(t=t.toLowerCase()),this._ownProperties[t]},e.prototype.alSetOwnProperty=function(t,e){var i=this.context.normalizeName(t);e.originalName||this.context.isPropertyCaseSensitive||(e.originalName=t),this._ownProperties[i]=e},e.prototype.alHasOwnProperty=function(t){var e=this.context.normalizeName(t);return!!this._ownProperties[e]},e.prototype.alDeleteOwnProperty=function(t){var e=this.context.normalizeName(t);delete this._ownProperties[e]},e.prototype.deleteOwnProperties=function(){for(var t=this.alGetOwnPropertiesKeys(),e=0;e<t.length;e++)this.alDeleteOwnProperty(t[e])},e.prototype.alGetOwnPropertiesKeys=function(){var t,e=[];if(this.context.isPropertyCaseSensitive)for(var i in this._ownProperties)1&(t=this._ownProperties[i]).flags||e.push(i);else for(var i in this._ownProperties)1&(t=this._ownProperties[i]).flags||e.push(t.originalName);return e},e.prototype.alGetProperty=function(t){var e=this.alGetOwnProperty(t);return e||(this._prototype?this._prototype.alGetProperty(t):void 0)},e.prototype.alGet=function(t){var e=this.context.normalizeName(t),i=this.alGetProperty(e);if(i){if(64&i.flags){if(i.value&&i.value.adaptee&&i.value.adaptee instanceof DisplayObject&&!i.value.adaptee.parent)return;return i.value}var r=i.get;if(r){var n=r.alCall(this);if(!(n&&n.adaptee&&n.adaptee instanceof DisplayObject)||n.adaptee.parent)return n}}},e.prototype.alCanPut=function(t){var e=this.alGetOwnProperty(t);if(e)return 128&e.flags?!!e.set:!(4&e.flags);var i=this._prototype;return!i||i.alCanPut(t)},e.prototype.alPut=function(t,e){var i=t;if(t=this.context.normalizeName(t),e&&"object"==typeof e&&"symbol"===e.avmType&&"this"!=t&&"_parent"!=t&&!e.dynamicallyCreated&&e.adaptee&&e.adaptee.parent&&e.adaptee.parent.adapter&&e.adaptee.parent.adapter.scriptRefsToChilds&&(e.adaptee.parent.adapter.scriptRefsToChilds[e.adaptee.name]={obj:this,name:t}),this.alCanPut(t)){var r=this.alGetOwnProperty(t);if(r&&64&r.flags)return r.watcher&&(e=r.watcher.callback.alCall(this,[r.watcher.name,r.value,e,r.watcher.userData])),void(t in this._ownProperties?r.value=e:this.alSetOwnProperty(i,new AVM1PropertyDescriptor(r.flags,e)));if(void 0!==e||"_x"!=t&&"_y"!=t&&"_xscale"!=t&&"_yscale"!=t&&"_width"!=t&&"_height"!=t){var n=this.alGetProperty(t);if(n&&128&n.flags){if(n.watcher){var o=n.get?n.get.alCall(this):void 0;e=n.watcher.callback.alCall(this,[n.watcher.name,o,e,n.watcher.userData])}n.set.alCall(this,[e])}else{n&&n.watcher&&(e=n.watcher.callback.alCall(this,[n.watcher.name,n.value,e,n.watcher.userData]));var s=new AVM1PropertyDescriptor(n?n.flags:64,e);this.alSetOwnProperty(i,s)}}}},e.prototype.alHasProperty=function(t){return!!this.alGetProperty(t)},e.prototype.alDeleteProperty=function(t){var e=this.alGetOwnProperty(t);return!e||!(2&e.flags)&&(this.alDeleteOwnProperty(t),!0)},e.prototype.alAddPropertyWatcher=function(t,e,i){var r=this.alGetProperty(t);return!!r&&(r.watcher={name:t,callback:e,userData:i},!0)},e.prototype.alRemotePropertyWatcher=function(t){var e=this.alGetProperty(t);return!(!e||!e.watcher)&&(e.watcher=void 0,!0)},e.prototype.alDefaultValue=function(t){if(void 0===t&&(t=0),1===t){if(alIsFunction(i=this.alGet(this.context.normalizeName("toString"))))return i.alCall(this);if(alIsFunction(e=this.alGet(this.context.normalizeName("valueOf"))))return e.alCall(this)}else{var e,i;if(alIsFunction(e=this.alGet(this.context.normalizeName("valueOf"))))return e.alCall(this);if(alIsFunction(i=this.alGet(this.context.normalizeName("toString"))))return i.alCall(this)}return this},e.prototype.alGetKeys=function(){var t=this.alGetOwnPropertiesKeys(),e=this._prototype;if(!e)return t;var i=e.alGetKeys();if(0===t.length)return i;var r,n=this.context;if(n.isPropertyCaseSensitive){var o=Object.create(null),s=t.length;for(r=0;r<s;r++)o[t[r]]=!0;s=i.length;for(r=0;r<s;r++)o[i[r]]=!0;return Object.getOwnPropertyNames(o)}var a,l,h,c=[t,i],u=Object.create(null),p=[];for(r=0;r<c.length;r++)for(var d=(a=c[r]).length;d--;)l=a[d],u[h=n.normalizeName(l)]||(u[h]=!0,p.push(l));return p},e}(NullPrototypeObject),AVM1Function=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),i.isOnEnter=!1,i}return __extends(e,t),e.prototype.alConstruct=function(t){throw new Error("not implemented AVM1Function.alConstruct")},e.prototype.alCall=function(t,e){throw new Error("not implemented AVM1Function.alCall")},e.prototype.toJSFunction=function(t){void 0===t&&(t=null);var e=this,i=this.context;return function(){var r=Array.prototype.slice.call(arguments,0);return i.executeFunction(e,t,r)}},e}(AVM1Object),AVM1EventHandler=function(t,e,i,r,n,o){this.propertyName=t,this.eventName=e,this.stageEvent=i,this.allowDisable=r,this.isMouse=n,this.isButton=o},AVM1EventProps=function(){},AVM1KeyCodeMap=[-1,37,39,36,35,45,46,-1,8,-1,-1,-1,-1,13,38,40,33,34,9,27],ClipEventMappings=Object.create(null);ClipEventMappings[262144]=!0,ClipEventMappings[512]=!0,ClipEventMappings[131072]=new AVM1EventHandler("onKey",KeyboardEvent.KEYDOWN,!0,!0,!1,!1),ClipEventMappings[1]=new AVM1EventHandler("onLoad","load",!1,!1,!1,!1),ClipEventMappings[4]=new AVM1EventHandler("onUnload","unload",!1,!1,!1,!1),ClipEventMappings[256]=new AVM1EventHandler("onData","data",!1,!1,!1,!1),ClipEventMappings[2]=new AVM1EventHandler("onEnterFrame","enterFrame",!1,!1,!1,!1),ClipEventMappings[64]=new AVM1EventHandler("onKeyDown",KeyboardEvent.KEYDOWN,!0,!0,!1,!1),ClipEventMappings[128]=new AVM1EventHandler("onKeyUp",KeyboardEvent.KEYUP,!0,!0,!1,!1),ClipEventMappings[8]=new AVM1EventHandler("onMouseMove",MouseEvent.MOUSE_MOVE,!0,!0,!0,!1),ClipEventMappings[16]=new AVM1EventHandler("onMouseDown",MouseEvent.MOUSE_DOWN,!0,!0,!0,!1),ClipEventMappings[32]=new AVM1EventHandler("onMouseUp",MouseEvent.MOUSE_UP,!0,!0,!0,!1),ClipEventMappings[1024]=new AVM1EventHandler("onPress",MouseEvent.MOUSE_DOWN,!1,!0,!0,!0),ClipEventMappings[2048]=new AVM1EventHandler("onRelease",MouseEvent.MOUSE_UP,!1,!0,!0,!0),ClipEventMappings[4096]=new AVM1EventHandler("onReleaseOutside",MouseEvent.MOUSE_UP_OUTSIDE,!1,!0,!0,!0),ClipEventMappings[8192]=new AVM1EventHandler("onRollOver",MouseEvent.MOUSE_OVER,!1,!0,!0,!0),ClipEventMappings[16384]=new AVM1EventHandler("onRollOut",MouseEvent.MOUSE_OUT,!1,!0,!0,!0),ClipEventMappings[32768]=new AVM1EventHandler("onDragOver",MouseEvent.DRAG_OVER,!1,!0,!0,!0),ClipEventMappings[65536]=new AVM1EventHandler("onDragOut",MouseEvent.DRAG_OUT,!1,!0,!0,!0);var setFocusEventMapping=new AVM1EventHandler("onSetFocus",FocusEvent.FOCUS_IN,!1,!0,!1,!1),unFocusEventMapping=new AVM1EventHandler("onKillFocus",FocusEvent.FOCUS_OUT,!1,!0,!1,!1),onChangedEventMapping=new AVM1EventHandler("onChanged",TextfieldEvent.CHANGED,!1,!0,!1,!1),EventsListForMC=[ClipEventMappings[1],ClipEventMappings[4],ClipEventMappings[256],ClipEventMappings[2],ClipEventMappings[64],ClipEventMappings[128],ClipEventMappings[8],ClipEventMappings[16],ClipEventMappings[32],ClipEventMappings[1024],ClipEventMappings[2048],ClipEventMappings[4096],ClipEventMappings[8192],ClipEventMappings[16384],ClipEventMappings[32768],ClipEventMappings[65536],ClipEventMappings[131072],setFocusEventMapping,unFocusEventMapping,onChangedEventMapping],EventsListForButton=[ClipEventMappings[1],ClipEventMappings[4],ClipEventMappings[256],ClipEventMappings[2],ClipEventMappings[64],ClipEventMappings[128],ClipEventMappings[1024],ClipEventMappings[2048],ClipEventMappings[4096],ClipEventMappings[8192],ClipEventMappings[16384],ClipEventMappings[32768],ClipEventMappings[65536],ClipEventMappings[131072],setFocusEventMapping,unFocusEventMapping,onChangedEventMapping],DEPTH_OFFSET=16384;function hasAwayJSAdaptee(t){return!!t.adaptee}function getAwayJSAdaptee(t){return t.adaptee}function getAwayObjectOrTemplate(t){if(t.adaptee)return t.adaptee;if(!t._as3ObjectTemplate){for(var e,i=t.alPrototype;i&&!i.initAVM1SymbolInstance&&!(e=i._as3ObjectTemplate);)i=i.alPrototype;t._as3ObjectTemplate=Object.create(e||null)}return t._as3ObjectTemplate}var BlendModesMap=[void 0,"normal","layer","multiply","screen","lighten","darken","difference","add","subtract","invert","alpha","erase","overlay","hardlight"];function avm1HasEventProperty(t,e,i){if(e.alHasProperty(i)&&e.alGet(i)instanceof AVM1Function)return!0;if(e.alHasProperty(i)&&e._ownProperties[i]&&e._ownProperties[i].value)return!0;var r=e.alGet("_listeners");return r instanceof AVM1ArrayNative&&r.value.some((function(t){return t instanceof AVM1Object&&t.alHasProperty(i)}))}function avm1BroadcastNativeEvent(t,e,i,r){void 0===r&&(r=null);var n=e.alGet(i);n instanceof AVM1Function&&("onenterframe"==i.toLowerCase()&&(n.isOnEnter=!0),t.executeFunction(n,e,r));var o=e.alGet("_listeners");if(o instanceof AVM1ArrayNative){var s=null;o.value.forEach((function(n){n instanceof AVM1Object&&(s=n.alGet(i))instanceof AVM1Function&&t.executeFunction(s,e,r)}))}}function avm1BroadcastEvent(t,e,i,r){void 0===r&&(r=null);var n=e.alGet(i);n instanceof AVM1Function&&n.alCall(e,r);var o=e.alGet("_listeners");if(o instanceof AVM1ArrayNative){var s=null;o.value.forEach((function(t){t instanceof AVM1Object&&(s=t.alGet(i))instanceof AVM1Function&&s.alCall(e,r)}))}}var myCount=0;function createAVM1NativeObject(t,e,i){for(var r,n=t.alGetPrototypeProperty();n&&!n.initAVM1SymbolInstance;)n._as3ObjectTemplate&&!r&&(r=n._as3ObjectTemplate),n=n.alPrototype;var o=Object.create(n);if(n.initAVM1SymbolInstance.call(o,i,e),o.alPrototype=t.alGetPrototypeProperty(),o.alSetOwnConstructorProperty(t),e._as2Object=o,t.alCall(o),o.aCount=myCount++,r)for(var s in r)e[s]=r[s];return o}function getAVM1Object(t,e){return t?t._as2Object?t._as2Object:(t.isAsset(MovieClip)?i=t.timeline.isButton?createAVM1NativeObject(e.globals.Button,t,e):createAVM1NativeObject(e.globals.MovieClip,t,e):t.isAsset(TextField)&&(i=createAVM1NativeObject(e.globals.TextField,t,e)),i&&(t._as2Object=i,t.adapter=i,i.adaptee=t),t._as2Object=i,i):null;var i}function wrapAVM1NativeMembers(t,e,i,r,n){function o(e){if(!isNullOrUndefined$1(e))return new AVM1NativeFunction(t,n?function(){var i=Array.prototype.slice.call(arguments,0);return i.unshift(t),e.apply(this,i)}:e)}void 0===n&&(n=!1),r&&r.forEach((function(t){if("#"!==t[t.length-1]){var r=function(t){for(var e,r=i;r;r=Object.getPrototypeOf(r))if(e=Object.getOwnPropertyDescriptor(r,t))return e;return null}(t);if(r&&!r.get&&!r.set){var n=r.value;"function"==typeof n&&(n=o(n));c=new AVM1PropertyDescriptor(67,n);e.alSetOwnProperty(t,c)}}else{var s="get"+t[0].toUpperCase()+t.slice(1,-1),a=i[s],l="set"+t[0].toUpperCase()+t.slice(1,-1),h=i[l],c=new AVM1PropertyDescriptor(131,null,o(a),o(h));e.alSetOwnProperty(t.slice(0,-1),c)}}))}function wrapAVM1NativeClass(t,e,i,r,n,o,s){var a=e?new AVM1NativeFunction(t,o||function(){},(function(){var e=new i(t);return e.alPrototype=l,e.alSetOwnConstructorProperty(a),s&&s.apply(e,arguments),e})):new AVM1Object(t);wrapAVM1NativeMembers(t,a,i,r,!0);var l=new i(t);return l.alPrototype=t.builtins.Object.alGetPrototypeProperty(),wrapAVM1NativeMembers(t,l,i.prototype,n,!1),alDefineObjectProperties(a,{prototype:{value:l}}),alDefineObjectProperties(l,{constructor:{value:a,writable:!0}}),a}function initializeAVM1Object(t,e,i){var r=getAVM1Object(t,e);i.variableName&&r.alPut("variable",i.variableName);var n=i.events;if(n)for(var o,s,a,l,h,c,u=null,p=0;p<n.length;p++)for(var d in(o=n[p]).actionsBlock?(s=e.actionsDataFactory.createActionsData(o.actionsBlock,"s"+i.symbolId+"d"+i.depth+"e"+p),o.actionsBlock=null,o.compiled=s):s=o.compiled,a=clipEventHandler.bind(null,s,r),l=o.flags,ClipEventMappings)h=parseInt(d),l&(0|(h|=0))&&(262144!=h&&512!=h?1!=h?(c=ClipEventMappings[h]).eventName?(o.keyCode&&((u=new AVM1EventProps).keyCode=o.keyCode,o.keyCode<32&&AVM1KeyCodeMap[o.keyCode]&&(u.keyCode=AVM1KeyCodeMap[o.keyCode])),r._addOnClipEventListener(c,a,u)):Debug.warning("ClipEvent: "+h+" not implemented"):t.onLoadedAction=a:a())}function toTwipFloor(t){var e=Math.floor(20*t)/20;return t>e&&t-e>.04995&&(e+=.05),e}function toTwipRound(t){return Math.round(20*t)/20}function avm2AwayDepth(t){return t+1}function away2avmDepth(t){return t-1}function clipEventHandler(t,e){return e.context.executeActions(t,e)}function toAS3Point(t){var e,i,r=t.context;return t instanceof AVM1Object&&(e=alCoerceNumber(r,t.alGet("x")),i=alCoerceNumber(r,t.alGet("y"))),new Point(e,i)}function copyAS3PointTo(t,e){e.alPut("x",t.x),e.alPut("y",t.y)}var AVM1Point=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.alPrototype=e.globals.Point.alGetPrototypeProperty(),n.alPut("x",i),n.alPut("y",r),n}return __extends(e,t),e.fromAS3Point=function(t,i){return new e(t,i.x,i.y)},e}(AVM1Object),AVM1PointFunction=function(t){function e(e){var i=t.call(this,e)||this;return alDefineObjectProperties(i,{prototype:{value:new AVM1PointPrototype(e,i)},distance:{value:i.distance,writable:!0},interpolate:{value:i.interpolate,writable:!0},polar:{value:i.polar,writable:!0}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){return t&&t.length>0?new AVM1Point(this.context,t[0],t[1]):new AVM1Point(this.context,0,0)},e.prototype.distance=function(t,e){return Point.distance(toAS3Point(t),toAS3Point(e))},e.prototype.interpolate=function(t,e,i){i=alToNumber(this.context,i);var r=Point.interpolate(toAS3Point(t),toAS3Point(e),i);return AVM1Point.fromAS3Point(this.context,r)},e.prototype.polar=function(t,e){return t=alToNumber(this.context,t),e=alToNumber(this.context,e),AVM1Point.fromAS3Point(this.context,Point.polar(t,e))},e}(AVM1Function),AVM1PointPrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(r,{constructor:{value:i,writable:!0},length:{get:r.getLength},add:{value:r.add,writable:!0},clone:{value:r.clone,writable:!0},equals:{value:r.equals,writable:!0},normalize:{value:r.normalize,writable:!0},offset:{value:r.offset,writable:!0},subtract:{value:r.subtract,writable:!0},toString:{value:r._toString,writable:!0}}),r}return __extends(e,t),e.prototype.getLength=function(){return toAS3Point(this).length},e.prototype.add=function(t){return AVM1Point.fromAS3Point(this.context,toAS3Point(this).add(toAS3Point(t)))},e.prototype.clone=function(){var t=new AVM1Point(this.context);return this instanceof AVM1Object&&(t.alPut("x",this.alGet("x")),t.alPut("y",this.alGet("y"))),t},e.prototype.equals=function(t){return toAS3Point(this).equals(toAS3Point(t))},e.prototype.normalize=function(t){t=alToNumber(this.context,t);var e=toAS3Point(this);e.normalize(t),copyAS3PointTo(e,this)},e.prototype.offset=function(t,e){t=alToNumber(this.context,t),e=alToNumber(this.context,e);var i=toAS3Point(this);i.offset(t,e),copyAS3PointTo(i,this)},e.prototype.subtract=function(t){return AVM1Point.fromAS3Point(this.context,toAS3Point(this).subtract(toAS3Point(t)))},e.prototype._toString=function(){return"(x="+this.alGet("x")+", y="+this.alGet("y")+")"},e}(AVM1Object);function toAS3Rectangle(t){var e,i,r,n,o=t.context;return t instanceof AVM1Object&&(e=alCoerceNumber(o,t.alGet("x")),i=alCoerceNumber(o,t.alGet("y")),r=alCoerceNumber(o,t.alGet("width")),n=alCoerceNumber(o,t.alGet("height"))),new Rectangle(e,i,r,n)}function copyAS3RectangleTo(t,e){e.alPut("x",t.x),e.alPut("y",t.y),e.alPut("width",t.width),e.alPut("height",t.height)}var AVM1Rectangle=function(t){function e(e,i,r,n,o){var s=t.call(this,e)||this;return s.alPrototype=e.globals.Rectangle.alGetPrototypeProperty(),s.alPut("x",i),s.alPut("y",r),s.alPut("width",n),s.alPut("height",o),s}return __extends(e,t),e.fromAS3Rectangle=function(t,i){return new e(t,i.x,i.y,i.width,i.height)},e}(AVM1Object),AVM1RectangleFunction=function(t){function e(e){var i=t.call(this,e)||this;return alDefineObjectProperties(i,{prototype:{value:new AVM1RectanglePrototype(e,i)}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){return t&&t.length>0?new AVM1Rectangle(this.context,t[0],t[1],t[2],t[3]):new AVM1Rectangle(this.context,0,0,0,0)},e}(AVM1Function),AVM1RectanglePrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(r,{constructor:{value:i,writable:!0},bottom:{get:r.getBottom,set:r.setBottom},bottomRight:{get:r.getBottomRight,set:r.setBottomRight},left:{get:r.getLeft,set:r.setLeft},right:{get:r.getRight,set:r.setRight},size:{get:r.getSize,set:r.setSize},top:{get:r.getTop,set:r.setTop},topLeft:{get:r.getTopLeft,set:r.setTopLeft},clone:{value:r.clone,writable:!0},contains:{value:r.contains,writable:!0},containsPoint:{value:r.containsPoint,writable:!0},containsRectangle:{value:r.containsRectangle,writable:!0},equals:{value:r.equals,writable:!0},inflate:{value:r.inflate,writable:!0},inflatePoint:{value:r.inflatePoint,writable:!0},intersection:{value:r.intersection,writable:!0},intersects:{value:r.intersects,writable:!0},isEmpty:{value:r.isEmpty,writable:!0},offset:{value:r.offset,writable:!0},offsetPoint:{value:r.offsetPoint,writable:!0},setEmpty:{value:r.setEmpty,writable:!0},toString:{value:r._toString,writable:!0},union:{value:r.union,writable:!0}}),r}return __extends(e,t),e.prototype.getBottom=function(){return alToNumber(this.context,this.alGet("y"))+alToNumber(this.context,this.alGet("height"))},e.prototype.setBottom=function(t){this.alPut("height",alToNumber(this.context,t)-alToNumber(this.context,this.alGet("y")))},e.prototype.getBottomRight=function(){return new AVM1Point(this.context,e.prototype.getRight.call(this),e.prototype.getBottom.call(this))},e.prototype.setBottomRight=function(t){e.prototype.setRight.call(this,t.alGet("x")),e.prototype.setBottom.call(this,t.alGet("y"))},e.prototype.getLeft=function(){return alToNumber(this.context,this.alGet("x"))},e.prototype.setLeft=function(t){this.alPut("x",alToNumber(this.context,t))},e.prototype.getSize=function(){return new AVM1Point(this.context,this.alGet("width"),this.alGet("height"))},e.prototype.setSize=function(t){this.alPut("width",t.alGet("x")),this.alPut("height",t.alGet("y"))},e.prototype.getRight=function(){return alToNumber(this.context,this.alGet("x"))+alToNumber(this.context,this.alGet("width"))},e.prototype.setRight=function(t){this.alPut("width",alToNumber(this.context,t)-alToNumber(this.context,this.alGet("x")))},e.prototype.getTop=function(){return alToNumber(this.context,this.alGet("y"))},e.prototype.setTop=function(t){this.alPut("y",alToNumber(this.context,t))},e.prototype.getTopLeft=function(){return new AVM1Point(this.context,e.prototype.getLeft.call(this),e.prototype.getTop.call(this))},e.prototype.setTopLeft=function(t){e.prototype.setLeft.call(this,t.alGet("x")),e.prototype.setTop.call(this,t.alGet("y"))},e.prototype.clone=function(){var t=new AVM1Rectangle(this.context);return this instanceof AVM1Object&&(t.alPut("x",this.alGet("x")),t.alPut("y",this.alGet("y")),t.alPut("width",this.alGet("width")),t.alPut("height",this.alGet("height"))),t},e.prototype.contains=function(t,e){return t=alToNumber(this.context,t),e=alToNumber(this.context,e),toAS3Rectangle(this).contains(t,e)},e.prototype.containsPoint=function(t){var e=toAS3Rectangle(this),i=toAS3Point(t);return e.containsPoint(i)},e.prototype.containsRectangle=function(t){var e=toAS3Rectangle(this),i=toAS3Rectangle(t);return e.containsRect(i)},e.prototype.equals=function(t){var e=toAS3Rectangle(this),i=toAS3Rectangle(t);return e.equals(i)},e.prototype.inflate=function(t,e){t=alToNumber(this.context,t),e=alToNumber(this.context,e);var i=toAS3Rectangle(this);i.inflate(t,e),copyAS3RectangleTo(i,this)},e.prototype.inflatePoint=function(t){var e=toAS3Rectangle(this),i=toAS3Point(t);e.inflatePoint(i),copyAS3RectangleTo(e,this)},e.prototype.intersection=function(t){var e=toAS3Rectangle(this),i=toAS3Rectangle(t);return AVM1Rectangle.fromAS3Rectangle(this.context,e.intersection(i))},e.prototype.intersects=function(t){var e=toAS3Rectangle(this),i=toAS3Rectangle(t);return e.intersects(i)},e.prototype.isEmpty=function(){return toAS3Rectangle(this).isEmpty()},e.prototype.offset=function(t,e){t=alToNumber(this.context,t),e=alToNumber(this.context,e);var i=toAS3Rectangle(this);i.offset(t,e),copyAS3RectangleTo(i,this)},e.prototype.offsetPoint=function(t){var e=toAS3Rectangle(this),i=toAS3Point(t);e.offsetPoint(i),copyAS3RectangleTo(e,this)},e.prototype.setEmpty=function(){this.alPut("x",0),this.alPut("y",0),this.alPut("width",0),this.alPut("height",0)},e.prototype._toString=function(){return"(x="+this.alGet("x")+", y="+this.alGet("y")+", w="+this.alGet("width")+", h="+this.alGet("height")+")"},e.prototype.union=function(t){var e=toAS3Rectangle(this),i=toAS3Rectangle(t);return AVM1Rectangle.fromAS3Rectangle(this.context,e.union(i))},e}(AVM1Object),AVM1BitmapFilterFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alSetOwnPrototypeProperty(new AVM1BitmapFilterPrototype(e,i)),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=new AVM1Object(this.context);return e.alPrototype=this.alGetPrototypeProperty(),e},e}(AVM1Function),AVM1BitmapFilterPrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return alDefineObjectProperties(r,{constructor:{value:i,writable:!0},clone:{value:r.clone,writable:!0}}),r}return __extends(e,t),e.prototype.clone=function(){var t=new AVM1Object(this.context);return t.alPrototype=this.alGetPrototypeProperty(),t},e}(AVM1Object);function createFilterClass(t,e,i,r,n){function o(){return t.sec.flash.filters[r].axClass}var s=i.alGetPrototypeProperty(),a=Object.create(AVM1BitmapFilterPrototype.prototype);AVM1Object.call(a,t),a.alPrototype=s;var l=Object.create(AVM1BitmapFilterFunction.prototype);AVM1Function.call(l,t),l.alSetOwnPrototypeProperty(a),l.alConstruct=function(e){var i=new AVM1Object(t);if(i.alPrototype=a,e)for(var r=0;r<e.length;r++)i.alPut(n[r<<1],e[r]);return i},alDefineObjectProperties(a,{constructor:{value:l,writable:!0},clone:{value:function(){var e=new AVM1Object(t);e.alPrototype=a;for(var i=0;i<n.length;i+=2)e.alPut(n[i],this.alGet(n[i]));return e},writable:!0}}),a.asFilterConverter={toAS3Filter:function(e){for(var i=o().axConstruct([]),r=0;r<n.length;r+=2){var s=e.alGet(n[r]);void 0!==s&&i.axSetPublicProperty(n[r],convertToAS3Field(t,s,n[r+1]))}return i},fromAS3Filter:function(e){var i=new AVM1Object(t);i.alPrototype=a;for(var r=0;r<n.length;r+=2)i.alPut(n[r],convertFromAS3Field(t,e.axGetPublicProperty(n[r]),n[r+1]));return i},getAS3Class:o},e.alPut(r,l)}function createFiltersClasses(t){var e=alNewObject(t),i=new AVM1BitmapFilterFunction(t);return e.alPut("BitmapFilter",i),createFilterClass(t,e,i,"BevelFilter",["distance","Number","angle","Number","highlightColor","Number","highlightAlpha","Number","shadowColor","Number","shadowAlpha","Number","blurX","Number","blurY","Number","strength","Number","quality","Number","type","String","knockout","Boolean"]),createFilterClass(t,e,i,"BlurFilter",["blurX","Number","blurY","Number","quality","Number"]),createFilterClass(t,e,i,"ColorMatrixFilter",["matrix","Numbers"]),createFilterClass(t,e,i,"ConvolutionFilter",["matrixX","Number","matrixY","Number","matrix","Numbers","divisor","Number","bias","Number","preserveAlpha","Boolean","clamp","Boolean","color","Number","alpha","Number"]),createFilterClass(t,e,i,"DisplacementMapFilter",["mapBitmap","BitmapData","mapPoint","Point","componentX","Number","componentY","Number","scaleX","Number","scaleY","Number","mode","String","color","Number","alpha","Number"]),createFilterClass(t,e,i,"DropShadowFilter",["distance","Number","angle","Number","color","Number","alpha","Number","blurX","Number","blurY","Number","strength","Number","quality","Number","inner","Boolean","knockout","Boolean","hideObject","Boolean"]),createFilterClass(t,e,i,"GlowFilter",["color","Number","alpha","Number","blurX","Number","blurY","Number","strength","Number","quality","Number","inner","Boolean","knockout","Boolean"]),createFilterClass(t,e,i,"GradientBevelFilter",["distance","Number","angle","Number","colors","Numbers","alphas","Numbers","ratios","Numbers","blurX","Number","blurY","Number","strength","Number","quality","Number","type","String","knockout","Boolean"]),createFilterClass(t,e,i,"GradientGlowFilter",["distance","Number","angle","Number","colors","Numbers","alphas","Numbers","ratios","Numbers","blurX","Number","blurY","Number","strength","Number","quality","Number","type","String","knockout","Boolean"]),e}function convertToAS3Field(t,e,i){switch(i){case"String":return alToString(t,e);case"Boolean":return alToBoolean(t,e);case"Number":return alToNumber(t,e);case"Numbers":var r=[];if(e)for(var n=0,o=e.alGet("length");n<o;n++)r[n]=alToNumber(t,e.alGet(n));return t.sec.createArray(r);case"BitmapData":return toAS3BitmapData(e);case"Point":return toAS3Point(e)}}function convertFromAS3Field(t,e,i){switch(i){case"String":case"Boolean":case"Number":return e;case"Numbers":var r=[];if(e)for(var n=0,o=e.value.length;n<o;n++)r[n]=+e.value[n];return new AVM1ArrayNative(t,r);case"BitmapData":return AVM1BitmapData.fromAS3BitmapData(t,e);case"Point":return AVM1Point.fromAS3Point(t,e)}}function convertToAS3Filter(t,e){for(var i=e?e.alPrototype:null;i&&!i.asFilterConverter;)i=i.alPrototype;if(i)return i.asFilterConverter.toAS3Filter(e)}function defaultTo(t,e){return void 0===t?e:t}function fromAVM1Object(t){var e=t.context;if(!(t instanceof AVM1Object))return new AVM1ColorTransform(e,1,1,1,1,0,0,0,0);var i=t.alGet("alphaOffset");null==i&&(i=t.alGet("ab"));var r=t.alGet("alphaMultiplier");null==r&&null!=(r=t.alGet("aa"))&&(r/=100);var n=t.alGet("redOffset");null==n&&(n=t.alGet("rb"));var o=t.alGet("redMultiplier");null==o&&null!=(o=t.alGet("ra"))&&(o/=100);var s=t.alGet("greenOffset");null==s&&(s=t.alGet("gb"));var a=t.alGet("greenMultiplier");null==a&&null!=(a=t.alGet("ga"))&&(a/=100);var l=t.alGet("blueOffset");null==l&&(l=t.alGet("bb"));var h=t.alGet("blueMultiplier");return null==h&&null!=(h=t.alGet("ba"))&&(h/=100),new AVM1ColorTransform(e,alCoerceNumber(e,defaultTo(o,1)),alCoerceNumber(e,defaultTo(a,1)),alCoerceNumber(e,defaultTo(h,1)),alCoerceNumber(e,defaultTo(r,1)),alCoerceNumber(e,defaultTo(n,0)),alCoerceNumber(e,defaultTo(s,0)),alCoerceNumber(e,defaultTo(l,0)),alCoerceNumber(e,defaultTo(i,0)))}function toAwayColorTransform(t){var e=t.context;return t instanceof AVM1ColorTransform?new ColorTransform(alCoerceNumber(e,defaultTo(t._rawData[0],1)),alCoerceNumber(e,defaultTo(t._rawData[1],1)),alCoerceNumber(e,defaultTo(t._rawData[2],1)),alCoerceNumber(e,defaultTo(t._rawData[3],1)),alCoerceNumber(e,defaultTo(t._rawData[4],0)),alCoerceNumber(e,defaultTo(t._rawData[5],0)),alCoerceNumber(e,defaultTo(t._rawData[6],0)),alCoerceNumber(e,defaultTo(t._rawData[7],0))):new ColorTransform(1,1,1,1,0,0,0,0)}var AVM1ColorTransform=function(t){function e(e,i,r,n,o,s,a,l,h){void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0===h&&(h=0);var c=t.call(this,e)||this;return c._rawData=[i,r,n,o,s,a,l,h],c.alPrototype=e.globals.ColorTransform.alGetPrototypeProperty(),alDefineObjectProperties(c,{rgb:{get:c.getRgb,set:c.setRgb},ra:{get:c.getRM,set:c.setRM},ga:{get:c.getGM,set:c.setGM},ba:{get:c.getBM,set:c.setBM},aa:{get:c.getAM,set:c.setAM},rb:{get:c.getRO,set:c.setRO},gb:{get:c.getGO,set:c.setGO},bb:{get:c.getBO,set:c.setBO},ab:{get:c.getAO,set:c.setAO},redMultiplier:{get:c.getRedMultiplier,set:c.setRedMultiplier},greenMultiplier:{get:c.getGreenMultiplier,set:c.setGreenMultiplier},blueMultiplier:{get:c.getBlueMultiplier,set:c.setBlueMultiplier},alphaMultiplier:{get:c.getAlphaMultiplier,set:c.setAlphaMultiplier},redOffset:{get:c.getRedOffset,set:c.setRedOffset},greenOffset:{get:c.getGreenOffset,set:c.setGreenOffset},blueOffset:{get:c.getBlueOffset,set:c.setBlueOffset},alphaOffset:{get:c.getAlphaOffset,set:c.setAlphaOffset},concat:{value:c.concat,writable:!0},toString:{value:c._toString,writable:!0}}),c}return __extends(e,t),e.prototype.getRedMultiplier=function(){return this._rawData[0]},e.prototype.setRedMultiplier=function(t){this._rawData[0]=t},e.prototype.getGreenMultiplier=function(){return this._rawData[1]},e.prototype.setGreenMultiplier=function(t){this._rawData[1]=t},e.prototype.getBlueMultiplier=function(){return this._rawData[2]},e.prototype.setBlueMultiplier=function(t){this._rawData[2]=t},e.prototype.getAlphaMultiplier=function(){return this._rawData[3]},e.prototype.setAlphaMultiplier=function(t){this._rawData[3]=t},e.prototype.getRedOffset=function(){return this._rawData[4]},e.prototype.setRedOffset=function(t){this._rawData[4]=t},e.prototype.getGreenOffset=function(){return this._rawData[5]},e.prototype.setGreenOffset=function(t){this._rawData[5]=t},e.prototype.getBlueOffset=function(){return this._rawData[6]},e.prototype.setBlueOffset=function(t){this._rawData[6]=t},e.prototype.getAlphaOffset=function(){return this._rawData[7]},e.prototype.setAlphaOffset=function(t){this._rawData[7]=t},e.prototype.getRM=function(){return 100*this._rawData[0]},e.prototype.setRM=function(t){this._rawData[0]=t/100},e.prototype.getGM=function(){return 100*this._rawData[1]},e.prototype.setGM=function(t){this._rawData[1]=t/100},e.prototype.getBM=function(){return 100*this._rawData[2]},e.prototype.setBM=function(t){this._rawData[2]=t/100},e.prototype.getAM=function(){return 100*this._rawData[3]},e.prototype.setAM=function(t){this._rawData[3]=t/100},e.prototype.getRO=function(){return this._rawData[4]},e.prototype.setRO=function(t){this._rawData[4]=t},e.prototype.getGO=function(){return this._rawData[5]},e.prototype.setGO=function(t){this._rawData[5]=t},e.prototype.getBO=function(){return this._rawData[6]},e.prototype.setBO=function(t){this._rawData[6]=t},e.prototype.getAO=function(){return this._rawData[7]},e.prototype.setAO=function(t){this._rawData[7]=t},e.prototype.getRgb=function(){return this._rawData[4]<<16|this._rawData[5]<<8|this._rawData[6]},e.prototype.setRgb=function(t){var e=ColorUtils.float32ColorToARGB(t);this._rawData[4]=e[1],this._rawData[5]=e[2],this._rawData[6]=e[3],this._rawData[0]=0,this._rawData[1]=0,this._rawData[2]=0},e.prototype.concat=function(t){console.warn("AVM1ColorTransform concat is not implemented")},e.prototype._toString=function(){return"[object Object]"},e.fromAwayColorTransform=function(t,i){return new e(t,i.redMultiplier,i.greenMultiplier,i.blueMultiplier,i.alphaMultiplier,i.redOffset,i.greenOffset,i.blueOffset,i.alphaOffset)},e}(AVM1Object),AVM1ColorTransformFunction=function(t){function e(e){var i=t.call(this,e)||this;return alDefineObjectProperties(i,{prototype:{value:new AVM1ColorTransformPrototype(e,i)}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=Object.create(AVM1ColorTransform.prototype);return t=t||[],AVM1ColorTransform.apply(e,[this.context].concat(t)),e},e}(AVM1Function),AVM1ColorTransformPrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(r,{constructor:{value:i,writable:!0}}),r}return __extends(e,t),e}(AVM1Object);function toAS3Matrix(t){var e,i,r,n,o,s,a=t.context;return t instanceof AVM1Object&&(e=alCoerceNumber(a,t.alGet("a")),i=alCoerceNumber(a,t.alGet("b")),r=alCoerceNumber(a,t.alGet("c")),n=alCoerceNumber(a,t.alGet("d")),o=alCoerceNumber(a,t.alGet("tx")),s=alCoerceNumber(a,t.alGet("ty"))),new Matrix(e,i,r,n,o,s)}function copyAS3MatrixTo(t,e){e.alPut("a",t.a),e.alPut("b",t.b),e.alPut("c",t.c),e.alPut("d",t.d),e.alPut("tx",t.tx),e.alPut("ty",t.ty)}var AVM1Matrix=function(t){function e(e,i,r,n,o,s,a){void 0===i&&(i=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===a&&(a=0);var l=t.call(this,e)||this;return l.alPrototype=e.globals.Matrix.alGetPrototypeProperty(),l.alPut("a",i),l.alPut("b",r),l.alPut("c",n),l.alPut("d",o),l.alPut("tx",s),l.alPut("ty",a),l}return __extends(e,t),e.fromAS3Matrix=function(t,i){return new e(t,i.a,i.b,i.c,i.d,i.tx,i.ty)},e}(AVM1Object),AVM1MatrixFunction=function(t){function e(e){var i=t.call(this,e)||this;return alDefineObjectProperties(i,{prototype:{value:new AVM1MatrixPrototype(e,i)}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){return t&&t.length>0?new AVM1Matrix(this.context,t[0],t[1],t[2],t[3],t[4],t[5]):new AVM1Matrix(this.context)},e}(AVM1Function),AVM1MatrixPrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(r,{constructor:{value:i,writable:!0},clone:{value:r.clone,writable:!0},concat:{value:r.concat,writable:!0},createBox:{value:r.createBox,writable:!0},createGradientBox:{value:r.createGradientBox,writable:!0},deltaTransformPoint:{value:r.deltaTransformPoint,writable:!0},identity:{value:r.identity,writable:!0},invert:{value:r.invert,writable:!0},rotate:{value:r.rotate,writable:!0},scale:{value:r.scale,writable:!0},toString:{value:r._toString,writable:!0},transformPoint:{value:r.transformPoint,writable:!0},translate:{value:r.translate,writable:!0}}),r}return __extends(e,t),e.prototype.clone=function(){var t=new AVM1Matrix(this.context);return this instanceof AVM1Object&&(t.alPut("a",this.alGet("a")),t.alPut("b",this.alGet("b")),t.alPut("c",this.alGet("c")),t.alPut("d",this.alGet("d")),t.alPut("tx",this.alGet("tx")),t.alPut("ty",this.alGet("ty"))),t},e.prototype.concat=function(t){var e=toAS3Matrix(this),i=toAS3Matrix(t);e.concat(i),copyAS3MatrixTo(e,this)},e.prototype.createBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),i=alCoerceNumber(this.context,i),r=alCoerceNumber(this.context,r),n=alCoerceNumber(this.context,n);var o=toAS3Matrix(this);o.createBox(t,e,i,r,n),copyAS3MatrixTo(o,this)},e.prototype.createGradientBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),i=alCoerceNumber(this.context,i),r=alCoerceNumber(this.context,r),n=alCoerceNumber(this.context,n);var o=toAS3Matrix(this);o.createGradientBox(t,e,i,r,n),copyAS3MatrixTo(o,this)},e.prototype.deltaTransformPoint=function(t){var e=toAS3Point(t),i=toAS3Matrix(this);return AVM1Point.fromAS3Point(this.context,i.deltaTransformPoint(e))},e.prototype.identity=function(){this.alPut("a",1),this.alPut("b",0),this.alPut("c",0),this.alPut("d",1),this.alPut("tx",0),this.alPut("ty",0)},e.prototype.invert=function(){var t=toAS3Matrix(this);t.invert(),copyAS3MatrixTo(t,this)},e.prototype.rotate=function(t){t=alCoerceNumber(this.context,t);var e=toAS3Matrix(this);e.rotate(t),copyAS3MatrixTo(e,this)},e.prototype.scale=function(t,e){t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e);var i=toAS3Matrix(this);i.scale(t,e),copyAS3MatrixTo(i,this)},e.prototype._toString=function(){return toAS3Matrix(this).toString()},e.prototype.transformPoint=function(t){var e=toAS3Point(t),i=toAS3Matrix(this);return AVM1Point.fromAS3Point(this.context,i.transformPoint(e))},e.prototype.translate=function(t,e){t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e);var i=toAS3Matrix(this);i.translate(t,e),copyAS3MatrixTo(i,this)},e}(AVM1Object),AVM1Stage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){var i=new e(t);return wrapAVM1NativeMembers(t,i,e.prototype,["align#","displayState#","fullScreenSourceRect#","height#","scaleMode#","showMenu#","width#"],!1),i},e.bindStage=function(t,i,r,n){i._awayAVMStage=r,e.stage=r},e.prototype.getAlign=function(){return this._awayAVMStage.align},e.prototype.setAlign=function(t){this._awayAVMStage.align=t},e.prototype.getDisplayState=function(){return this._awayAVMStage.displayState},e.prototype.setDisplayState=function(t){this._awayAVMStage.displayState=t},e.prototype.getFullScreenSourceRect=function(){return this._awayAVMStage.fullScreenSourceRect},e.prototype.setFullScreenSourceRect=function(t){this._awayAVMStage.fullScreenSourceRect=t},e.prototype.getHeight=function(){return this._awayAVMStage.stageHeight},e.prototype.getScaleMode=function(){return this._awayAVMStage.scaleMode},e.prototype.setScaleMode=function(t){this._awayAVMStage.scaleMode=t},e.prototype.getShowMenu=function(){return this._awayAVMStage.showDefaultContextMenu},e.prototype.setShowMenu=function(t){this._awayAVMStage.showDefaultContextMenu=t},e.prototype.getWidth=function(){return this._awayAVMStage.stageWidth},e}(AVM1Object);function toAS3BitmapData(t){return t instanceof AVM1BitmapData?t.as3BitmapData:null}var AVM1BitmapData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,["loadBitmap"],["height#","rectangle#","transparent#","width#","applyFilter","clone","colorTransform","compare","copyChannel","copyPixels","dispose","draw","fillRect","floodFill","generateFilterRect","getColorBoundsRect","getPixel","getPixel32","hitTest","merge","noise","paletteMap","perlinNoise","pixelDissolve","scroll","setPixel","setPixel32","threshold"],null,e.prototype.avm1Constructor)},Object.defineProperty(e.prototype,"as3BitmapData",{get:function(){return this.adaptee},enumerable:!0,configurable:!0}),e.prototype.avm1Constructor=function(t,e,i,r){t=alToNumber(this.context,t),e=alToNumber(this.context,e),i=arguments.length<3||alToBoolean(this.context,i),r=arguments.length<4?4294967295:alToInt32(this.context,r);var n=new SceneImage2D(t,e,i,r,!1,AVM1Stage.stage.rendererStage);this.adaptee=n},e.fromAS3BitmapData=function(t,i){var r=new e(t);return r.alPrototype=t.globals.BitmapData.alGetPrototypeProperty(),r.adaptee=i,r},e.loadBitmap=function(t,i){i=alToString(t,i);var r=AssetLibrary.getAsset(i);if(r&&r.isAsset(BitmapImage2D)){var n=new e(t);return n.adaptee=r,n}return null},e.prototype.getHeight=function(){return this.adaptee.height},e.prototype.getRectangle=function(){var t=this.as3BitmapData;return new AVM1Rectangle(this.context,0,0,t.width,t.height)},e.prototype.getTransparent=function(){return this.adaptee.transparent},e.prototype.getWidth=function(){return this.adaptee.width},e.prototype.applyFilter=function(t,e,i,r){t.as3BitmapData,toAS3Rectangle(e),toAS3Point(i),convertToAS3Filter(this.context,r);return 0},e.prototype.clone=function(){var t=new e(this.context);return t.alPrototype=this.context.globals.BitmapData.alGetPrototypeProperty(),t.adaptee=this.adaptee.clone(),t},e.prototype.colorTransform=function(t,e){var i=toAS3Rectangle(t),r=toAwayColorTransform(e);this.adaptee.colorTransform(i,r)},e.prototype.compare=function(t){return t instanceof e},e.prototype.copyChannel=function(t,e,i,r,n){var o=t.as3BitmapData,s=toAS3Rectangle(e),a=toAS3Point(i);r=alCoerceNumber(this.context,r),n=alCoerceNumber(this.context,n),this.as3BitmapData.copyChannel(o,s,a,r,n)},e.prototype.copyPixels=function(t,e,i,r,n,o){t.as3BitmapData,toAS3Rectangle(e),toAS3Point(i),r&&r.as3BitmapData,n&&toAS3Point(n);o=alToBoolean(this.context,o)},e.prototype.dispose=function(){this.as3BitmapData.dispose()},e.prototype.draw=function(t,e,i,r,n,o){var s=t.adaptee,a=e?toAS3Matrix(e):null,l=i?toAwayColorTransform(i):null,h=n?toAS3Rectangle(n):null;r=(r="number"==typeof r?BlendModesMap[r]:alCoerceString(this.context,r))||null,o=alToBoolean(this.context,o),this.as3BitmapData.draw(s,a,l,r,h,o)},e.prototype.fillRect=function(t,e){var i=toAS3Rectangle(t);e=alToInt32(this.context,e),this.as3BitmapData.fillRect(i,e)},e.prototype.floodFill=function(t,e,i){t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),i=alToInt32(this.context,i),Debug.notImplemented("AVM1BitmapData.floodFill")},e.prototype.generateFilterRect=function(t,e){Debug.notImplemented("AVM1BitmapData.generateFilterRect")},e.prototype.getColorBoundsRect=function(t,e,i){return t=alToInt32(this.context,t),e=alToInt32(this.context,e),i=alToBoolean(this.context,i),Debug.notImplemented("AVM1BitmapData.getColorBoundsRect"),null},e.prototype.getPixel=function(t,e){return this.adaptee.getPixel(t,e)},e.prototype.getPixel32=function(t,e){return this.adaptee.getPixel32(t,e)},e.prototype.hitTest=function(t,e,i,r,n){Debug.somewhatImplemented("AVM1BitmapData.hitTest");toAS3Point(t);return e=alToInt32(this.context,e),Debug.notImplemented("AVM1BitmapData.hitTest"),!1},e.prototype.merge=function(t,e,i,r,n,o,s){var a=t.as3BitmapData,l=toAS3Rectangle(e),h=toAS3Point(i);r=alToInt32(this.context,r),n=alToInt32(this.context,n),o=alToInt32(this.context,o),s=alToInt32(this.context,s),this.as3BitmapData.merge(a,l,h,r,n,o,s)},e.prototype.noise=function(t,e,i,r,n){t=alToInt32(this.context,t),e=arguments.length<2?0:alToInt32(this.context,e),i=arguments.length<3?255:alToInt32(this.context,i),r=arguments.length<4?7:alToInt32(this.context,r),n=!(arguments.length<5)&&alToBoolean(this.context,n),Debug.notImplemented("AVM1BitmapData.noise")},e.prototype.paletteMap=function(t,e,i,r,n,o,s){Debug.notImplemented("AVM1BitmapData.paletteMap")},e.prototype.perlinNoise=function(t,e,i,r,n,o,s,a,l){var h=this;t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),i=alCoerceNumber(this.context,i),r=alCoerceNumber(this.context,r),n=alToBoolean(this.context,n),o=alToBoolean(this.context,o),s=void 0===s?7:alCoerceNumber(this.context,s),a=alToBoolean(this.context,a);isNullOrUndefined$1(l)||this.context.sec.createArray(AVM1ArrayNative.mapToJSArray(l,(function(t){return alCoerceNumber(h.context,t)}),this));Debug.notImplemented("AVM1BitmapData.perlinNoise")},e.prototype.pixelDissolve=function(t,e,i,r,n,o){t.as3BitmapData;var s=toAS3Rectangle(e);toAS3Point(i);return r=arguments.length<4?0:alToInt32(this.context,r),n=arguments.length<5?s.width*s.height/30:alToInt32(this.context,n),o=arguments.length<6?0:alToInt32(this.context,o),Debug.notImplemented("AVM1BitmapData.pixelDissolve"),0},e.prototype.scroll=function(t,e){t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),Debug.notImplemented("AVM1BitmapData.scroll")},e.prototype.setPixel=function(t,e,i){t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),i=alToInt32(this.context,i),this.adaptee.setPixel(t,e,i)},e.prototype.setPixel32=function(t,e,i){t=alCoerceNumber(this.context,t),e=alCoerceNumber(this.context,e),i=alToInt32(this.context,i),this.adaptee.setPixel32(t,e,i)},e.prototype.threshold=function(t,e,i,r,n,o,s,a){t.as3BitmapData,toAS3Rectangle(e),toAS3Point(i);return r=alCoerceString(this.context,r),n=alToInt32(this.context,n),o=arguments.length<6?0:alToInt32(this.context,o),s=arguments.length<7?4294967295:alToInt32(this.context,s),a=!(arguments.length<8)&&alToBoolean(this.context,a),Debug.notImplemented("AVM1BitmapData.threshold"),0},e}(AVM1Object),ASObject=function(){function t(){}return t.prototype.axCallPublicProperty=function(t,e){return null},t.prototype.axGetPublicProperty=function(t){return null},t.prototype.axSetPublicProperty=function(t,e){return null},t.prototype.axHasPublicProperty=function(t){return null},t.prototype.axDeletePublicProperty=function(t){return null},t.prototype.axGetEnumerableKeys=function(){return[]},t}(),ASBoolean=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject),ASArray=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject),ASFunction=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject),ASNumber=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject),ASString=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject),ASClass=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject),MovieClipProperties;function FlashNetScript_navigateToURL(t,e,i){void 0===i&&(i=null),e.url&&0===e.url.toLowerCase().indexOf("fscommand:")||window.open(e.url,i)}function axCoerceString$2(t){return"string"==typeof t?t:null==t?null:t+""}!function(t){t[t._x=0]="_x",t[t._y=1]="_y",t[t._xscale=2]="_xscale",t[t._yscale=3]="_yscale",t[t._currentframe=4]="_currentframe",t[t._totalframes=5]="_totalframes",t[t._alpha=6]="_alpha",t[t._visible=7]="_visible",t[t._width=8]="_width",t[t._height=9]="_height",t[t._rotation=10]="_rotation",t[t._target=11]="_target",t[t._framesloaded=12]="_framesloaded",t[t._name=13]="_name",t[t._droptarget=14]="_droptarget",t[t._url=15]="_url",t[t._highquality=16]="_highquality",t[t._focusrect=17]="_focusrect",t[t._soundbuftime=18]="_soundbuftime",t[t._quality=19]="_quality",t[t._xmouse=20]="_xmouse",t[t._ymouse=21]="_ymouse"}(MovieClipProperties||(MovieClipProperties={}));var AVM1SymbolBase=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasSwappedDepth=!1,e.dynamicallyCreated=!1,e.enabled=!0,e}return __extends(e,t),e.prototype.initAVM1SymbolInstance=function(t,e){this.avmType="symbol",this.scriptRefsToChilds={},this._mouseListenerCount=0,this._avm1Context=t,this._ownProperties=Object.create(null),this._prototype=null;var i=this;this._onClipEventsListeners=[];var r=new AVM1PropertyDescriptor(131,null,{alCall:function(t,e){return i.alPrototype}},{alCall:function(t,e){i.alPrototype=e[0]}});this.alSetOwnProperty("__proto__",r),this.adaptee=e;var n=e.name,o=this.get_parent();n&&o&&o._addChildName(this,n)},e.prototype.bindEvents=function(t,e){this._events=t;var i=Object.create(null);this._eventsMap=i,this._eventsListeners=Object.create(null),this._eventHandlers=Object.create(null);var r=this,n=this.context;t.forEach((function(t){var e=t.propertyName=n.normalizeName(t.propertyName);i[e]=t,r._updateEvent(t)}))},e.prototype.unbindEvents=function(){var t=this._events,e=this,i=this.context;t.forEach((function(t){i.unregisterEventPropertyObserver(t.propertyName,e),e._removeEventListener(t)})),this._events=null,this._eventsMap=null,this._eventsListeners=null,this._eventHandlers=null},e.prototype.updateEventByPropName=function(t){this._eventsMap?this._eventsMap[t]&&this._updateEvent(this._eventsMap[t]):console.log("no eventsmap set",this)},e.prototype.updateAllEvents=function(){this._events.forEach((function(t){this._updateEvent(t)}),this)},e.prototype._updateEvent=function(t){avm1HasEventProperty(this.context,this,t.propertyName)?this._addEventListener(t):this._removeEventListener(t)},e.prototype._addOnClipEventListener=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),t.propertyName=this.context.normalizeName(t.propertyName),this._onClipEventsListeners.push({event:t,callback:e}),!this.enabled&&t.allowDisable||this.addEventListenerOnAdapter(t,e,i)},e.prototype._addEventListener=function(t,e){void 0===e&&(e=null);var i=this.context.normalizeName(t.propertyName),r=this._eventsListeners[i],n=this;r||(r=e||function(){var t=null;"onchanged"==i.toLowerCase()&&(t=[n]),avm1BroadcastNativeEvent(this.context,this,i,t)}.bind(this),this._eventsListeners[i]=r,this._eventHandlers[i]=t),!this.enabled&&t.allowDisable||this.addEventListenerOnAdapter(t,r)},e.prototype.addEventListenerOnAdapter=function(t,e,i){(void 0===i&&(i=null),t.stageEvent)?this.context.globals.Stage._awayAVMStage.addAVM1EventListener(this.adaptee,t.eventName,e,i):(this.adaptee.addEventListener(t.eventName,e),this._updateMouseEnabled(t,!0))},e.prototype.removeEventListenerOnAdapter=function(t,e){if(t.stageEvent){var i=this.context.globals.Stage._awayAVMStage;i&&i.removeAVM1EventListener(this.adaptee,t.eventName,e)}else this.adaptee.removeEventListener(t.eventName,e),this._updateMouseEnabled(t,!1)},e.prototype._updateMouseEnabled=function(t,e){this.adaptee.isAVMScene||t.isMouse&&(e?(this._mouseListenerCount++,this.adaptee.mouseEnabled=!0,this.adaptee.mouseChildren=!1):(this._mouseListenerCount--,this._mouseListenerCount<=0&&(this._mouseListenerCount=0,this.adaptee.mouseEnabled=!1,this.adaptee.mouseChildren=!0)))},e.prototype.freeFromScript=function(){for(var e in t.prototype.freeFromScript.call(this),this.enabled=!0,this.adaptee.mouseEnabled=!1,this.adaptee.mouseChildren=!0,this._eventsListeners)this.removeEventListenerOnAdapter(this._eventHandlers[e],this._eventsListeners[e]);this._eventsListeners={};for(var i=this._onClipEventsListeners.length;i>0;)i--,this.removeEventListenerOnAdapter(this._onClipEventsListeners[i].event,this._onClipEventsListeners[i].callback);this._onClipEventsListeners=[],this._mouseListenerCount=0},e.prototype._removeEventListener=function(t){var e=this.context.normalizeName(t.propertyName),i=this._eventsListeners[e];i&&(this.removeEventListenerOnAdapter(t,i),delete this._eventsListeners[e])},e.prototype.onEventPropertyModified=function(t){t=this.context.normalizeName(t);var e=this._eventsMap[t];this._updateEvent(e)},e.prototype.getEnabled=function(){return this.enabled},e.prototype.setEnabled=function(t){t!=this.enabled&&(this.enabled=t,this.setEnabledListener(t))},e.prototype.setEnabledListener=function(t){if(!1!==t&&0!==t){for(var e in this._eventsListeners)this._eventHandlers[e].allowDisable&&this.addEventListenerOnAdapter(this._eventHandlers[e],this._eventsListeners[e]);for(var e in this._onClipEventsListeners)this._onClipEventsListeners[e].event.allowDisable&&this.addEventListenerOnAdapter(this._onClipEventsListeners[e].event,this._onClipEventsListeners[e].callback)}else{for(var e in this._eventsListeners)this._eventHandlers[e].allowDisable&&this.removeEventListenerOnAdapter(this._eventHandlers[e],this._eventsListeners[e]);for(var e in this._onClipEventsListeners)this._onClipEventsListeners[e].event.allowDisable&&this.removeEventListenerOnAdapter(this._onClipEventsListeners[e].event,this._onClipEventsListeners[e].callback)}},e.prototype.get_alpha=function(){return 100*this.adaptee.alpha},e.prototype.set_alpha=function(t){this._ctBlockedByScript=!0,t=alToNumber(this.context,t),isNaN(t)||(this.adaptee.alpha=t/100)},e.prototype.getBlendMode=function(){return notImplemented("AVM1SymbolBase.getBlendMode"),""},e.prototype.setBlendMode=function(t){notImplemented("AVM1SymbolBase.setBlendMode")},e.prototype.getCacheAsBitmap=function(){return this.adaptee.cacheAsBitmap},e.prototype.setCacheAsBitmap=function(t){t=alToBoolean(this.context,t),this.adaptee.cacheAsBitmap=t},e.prototype.getFilters=function(){return notImplemented("AVM1SymbolBase.getFilters"),null},e.prototype.setFilters=function(t){notImplemented("AVM1SymbolBase.setFilters")},e.prototype.get_focusrect=function(){return notImplemented("AVM1SymbolBase.setOpaqueBackground"),!1},e.prototype.set_focusrect=function(t){notImplemented("AVM1SymbolBase.setOpaqueBackground")},e.prototype.get_height=function(){var t=PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(this.adaptee);return null==t?0:toTwipFloor(t.height)},e.prototype.set_height=function(t){t=toTwipFloor(alToNumber(this.context,t)),this._blockedByScript=!0,isNaN(t)||(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view).getBoundsPicker(this.adaptee.partition).height=t)},e.prototype.get_highquality=function(){switch(this.get_quality()){case"BEST":return 2;case"HIGH":return 1;default:return 0}},e.prototype.set_highquality=function(t){var e;switch(alToInteger(this.context,t)){case 2:e="BEST";break;case 1:e="HIGH";break;default:e="LOW"}this.set_quality(e)},e.prototype.getMenu=function(){notImplemented("AVM1SymbolBase.getMenu")},e.prototype.setMenu=function(t){notImplemented("AVM1SymbolBase.setMenu")},e.prototype.get_name=function(){return this.adaptee?this.adaptee.name:void 0},e.prototype.set_name=function(t){t=alCoerceString(this.context,t);var e=this.adaptee.name;this.adaptee.name=t;var i=this.get_parent();i&&(i.registerScriptObject(this.adaptee),i._updateChildName(this,e,t))},e.prototype.get_parent=function(){return getAVM1Object(this.adaptee.parent,this.context)||void 0},e.prototype.set_parent=function(t){notImplemented("AVM1SymbolBase.set_parent")},e.prototype.getOpaqueBackground=function(){return notImplemented("AVM1SymbolBase.getOpaqueBackground"),0},e.prototype.setOpaqueBackground=function(t){notImplemented("AVM1SymbolBase.setOpaqueBackground")},e.prototype.get_quality=function(){return somewhatImplemented("AVM1SymbolBase.get_quality"),"HIGH"},e.prototype.set_quality=function(t){somewhatImplemented("AVM1SymbolBase.set_quality")},e.prototype.set_root=function(t){notImplemented("AVM1SymbolBase.set_root")},e.prototype.get_root=function(){for(var t=this.adaptee,e=null;t&&!t.isAVMScene;){if((e=getAVM1Object(t,this.context))&&e.get_lockroot())return e;t=t.parent}if(t)return getAVM1Object(t,this.context)},e.prototype.get_rotation=function(){for(var t=this.adaptee.rotationZ;t>180;)t-=360;for(;t<-180;)t+=360;return Math.round(1e4*t)/1e4},e.prototype.set_rotation=function(t){t=alToNumber(this.context,t),this._blockedByScript=!0,isNaN(t)||(this.adaptee.rotationZ=t)},e.prototype.getScale9Grid=function(){return AVM1Rectangle.fromAS3Rectangle(this.context,this.adaptee.scale9Grid)},e.prototype.setScale9Grid=function(t){this.adaptee.scale9Grid=isNullOrUndefined$1(t)?null:toAS3Rectangle(t)},e.prototype.getScrollRect=function(){return AVM1Rectangle.fromAS3Rectangle(this.context,this.adaptee.scrollRect)},e.prototype.setScrollRect=function(t){this.adaptee.scrollRect=isNullOrUndefined$1(t)?null:toAS3Rectangle(t)},e.prototype.get_soundbuftime=function(){return notImplemented("AVM1SymbolBase.get_soundbuftime"),0},e.prototype.set_soundbuftime=function(t){notImplemented("AVM1SymbolBase.set_soundbuftime")},e.prototype.getTabEnabled=function(){return!!this.adaptee&&this.adaptee.tabEnabled},e.prototype.setTabEnabled=function(t){this.adaptee&&(this.adaptee.tabEnabled=t)},e.prototype.getTabIndex=function(){return this.adaptee.tabIndex},e.prototype.setTabIndex=function(t){this.adaptee.tabIndex=t},e.prototype.get_target=function(){var t=this.adaptee;if(t===t.root)return"/";var e="";do{if(isNullOrUndefined$1(t))return void warning("AVM1SymbolBase.get_target returns undefined");e="/"+t.name+e,t=t.parent}while(t&&!t.isAVMScene);return e},e.prototype.removeMovieClip=function(){this.adaptee.isAVMScene||this.adaptee.parent&&away2avmDepth(this.adaptee._depthID)>=0&&this.adaptee.parent.removeChild(this.adaptee)},e.prototype.get_visible=function(){return this.adaptee.visible},e.prototype.set_visible=function(t){this._visibilityByScript=!0,t=alToBoolean(this.context,t),this.adaptee.visible=t},e.prototype.get_url=function(){return this.adaptee.assetNamespace},e.prototype.get_width=function(){var t=PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(this.adaptee);return null==t?0:toTwipRound(t.width)},e.prototype.set_width=function(t){t=toTwipRound(alToNumber(this.context,t)),this._blockedByScript=!0,isNaN(t)||(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view).getBoundsPicker(this.adaptee.partition).width=t)},e.prototype.get_x=function(){return toTwipFloor(this.adaptee.x)},e.prototype.set_x=function(t){t=toTwipFloor(alToNumber(this.context,t)),this._blockedByScript=!0,isNaN(t)||(this.adaptee.x=t)},e.prototype.get_xmouse=function(){return toTwipFloor(this.context.globals.Stage._awayAVMStage.scene.getLocalMouseX(this.adaptee))},e.prototype.get_xscale=function(){return 100*this.adaptee.scaleX},e.prototype.set_xscale=function(t){t=alToNumber(this.context,t),this._blockedByScript=!0,isNaN(t)||(this.adaptee.scaleX=t/100)},e.prototype.get_y=function(){return toTwipFloor(this.adaptee.y)},e.prototype.set_y=function(t){t=toTwipFloor(alToNumber(this.context,t)),this._blockedByScript=!0,isNaN(t)||(this.adaptee.y=t)},e.prototype.get_ymouse=function(){return toTwipFloor(this.context.globals.Stage._awayAVMStage.scene.getLocalMouseY(this.adaptee))},e.prototype.get_yscale=function(){return 100*this.adaptee.scaleY},e.prototype.set_yscale=function(t){t=alToNumber(this.context,t),this._blockedByScript=!0,isNaN(t)||(this.adaptee.scaleY=t/100)},e.prototype.getDepth=function(){return this.protoTypeChanged?null:away2avmDepth(this.adaptee._depthID)},e.prototype.toString=function(){for(var t=this.adaptee,e=[];t;)t.isAVMScene?(e.push("_level0"),t=null):(e.push(t.name),t=t.parent);for(var i=e.length,r="";i>0;)r+=e[--i],i>0&&(r+=".");return r},e}(AVM1Object),AVM1LoaderHelper=function(){function t(t){var e=this;this.result=new PromiseWrapper,this._context=t,this._onAssetCompleteDelegate=function(t){return e.onAssetComplete(t)},this._onLoadCompleteDelegate=function(t){return e.onLoadComplete(t)},this._onLoadErrorDelegate=function(t){return e.onLoadError(t)},this._loader=new Loader}return Object.defineProperty(t.prototype,"loader",{get:function(){return this._loader},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loaderInfo",{get:function(){return this._loader.loaderInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),t.prototype.onAssetComplete=function(t){var e=t.asset;if(e.isAsset(MovieClip)){if(e.assetNamespace!=this._url)return;e.isAVMScene&&(this._content=e,this.result.resolve(e),e.adapter.initAdapter())}},t.prototype.onLoadComplete=function(t){t.url==this._url&&(AssetLibrary.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),AssetLibrary.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),AssetLibrary.removeEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate))},t.prototype.onLoadError=function(t){AssetLibrary.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),AssetLibrary.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),AssetLibrary.removeEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate),console.log("load error in loadMovie",t)},t.prototype.load=function(t,e){return this._url=t,this.result=new PromiseWrapper,AssetLibrary.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),AssetLibrary.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),AssetLibrary.addEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate),AssetLibrary.load(new URLRequest(t),null,t,new SWFParser(AVM1Globals._scenegraphFactory)),this.result.promise},t}();function convertAS3RectangeToBounds(t,e){var i=alNewObject(e);return i.alPut("xMin",t.left),i.alPut("yMin",t.top),i.alPut("xMax",t.right),i.alPut("yMax",t.bottom),i}var AVM1MovieClip=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onLoaded=null,e.executeConstructor=null,e.unregisteredColors={},e.isDragging=!1,e.startDragPoint=new Point,e.startDragMCPosition=new Point,e}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["$version#","_alpha#","getAwayJSID","attachAudio","attachBitmap","attachMovie","beginFill","beginBitmapFill","beginGradientFill","blendMode#","cacheAsBitmap#","_callFrame","clear","createEmptyMovieClip","createTextField","_currentframe#","curveTo","_droptarget#","duplicateMovieClip","enabled#","endFill","filters#","_framesloaded#","_focusrect#","forceSmoothing#","getBounds","getBytesLoaded","getBytesTotal","getDepth","getInstanceAtDepth","getNextHighestDepth","getRect","getSWFVersion","getTextSnapshot","getURL","globalToLocal","gotoAndPlay","gotoAndStop","_height#","_highquality#","hitArea#","hitTest","lineGradientStyle","lineStyle","lineTo","loadMovie","loadVariables","localToGlobal","_lockroot#","menu#","moveTo","_name#","nextFrame","opaqueBackground#","_parent#","play","prevFrame","_quality#","removeMovieClip","_root#","_rotation#","scale9Grid#","scrollRect#","setMask","_soundbuftime#","startDrag","stop","stopDrag","swapDepths","tabChildren#","tabEnabled#","tabIndex#","_target#","_totalframes#","trackAsMenu#","toString","unloadMovie","_url#","useHandCursor#","_visible#","_width#","_x#","_xmouse#","_xscale#","_y#","_ymouse#","_yscale#"])},e.prototype._updateMouseEnabled=function(t,e){this.adaptee.isAVMScene||t.isMouse&&(e?(this._mouseListenerCount++,this.adaptee.mouseEnabled=!0,this.adaptee.mouseChildren=!1,t.isButton&&(this._mouseButtonListenerCount++,this.adaptee.buttonMode=!0)):(this._mouseListenerCount--,this._mouseListenerCount<=0&&(this._mouseListenerCount=0,this.adaptee.mouseEnabled=!1,this.adaptee.mouseChildren=!0),t.isButton&&(this._mouseButtonListenerCount--,this._mouseButtonListenerCount<=0&&(this._mouseButtonListenerCount=0,this.adaptee.buttonMode=!1)))),this.enabled||(this.adaptee.mouseChildren=!1)},e.prototype.clone=function(){return getAVM1Object(this.adaptee.clone(),this._avm1Context)},e.prototype.attachCustomConstructor=function(){if(this.adaptee){var t=this.adaptee.avm1Symbol;if(t){this.alPut("__proto__",t._ownProperties.prototype.value);var e=this;this.executeConstructor=function(){t.alCall(e)}}}},e.prototype.compareAVM1FrameScripts=function(t,e){if(!t.precedence)return e.precedence?-1:0;if(!e.precedence)return 1;for(var i=0;i<t.precedence.length&&i<e.precedence.length&&t.precedence[i]===e.precedence[i];)i++;return i>=t.precedence.length?t.precedence.length===e.precedence.length?0:-1:i>=e.precedence.length?1:t.precedence[i]-e.precedence[i]},e.prototype.executeScript=function(t){e.currentMCAssetNameSpace=this.adaptee.assetNamespace,AVM1TextField.syncQueedTextfields();var i=this.adaptee.name.replace(/[^\w]/g,"");if(t){for(var r=[],n=0;n<t.length;n++){var o=t[n],s=function(t){this._avm1Context.executeActions(t,this)}.bind(this,o.data);s.precedence=this.adaptee.getScriptPrecedence().concat(o.precedence),s.context=this.adaptee,r.push(s)}if(r.length){r.sort(this.compareAVM1FrameScripts);var a=r;for(n=0;n<a.length;n++){var l=a[n],h=l.context;l.call(h)}}}else window.alert("actionsBlocks is empty, can not execute framescript"+i+this.adaptee.currentFrameIndex)},e.prototype.addScript=function(t,e){for(var i=t,r=[],n=0;n<i.length;n++){var o=i[n],s=this.adaptee.name;"string"!=typeof s&&(s=s.toString()),o.data=this._avm1Context.actionsDataFactory.createActionsData(o.actionsData,"script_"+s.replace(/[^\w]/g,"")+"_"+this.adaptee.id+"_frame_"+e+"_idx_"+n),r[r.length]=o}return r},e.prototype.stopAllSounds=function(){for(var t,e=this.alGetKeys(),i=0;i<e.length;i++){var r=this.alGetProperty(e[i]),n=r?r.value:null;n&&n._sound&&n._sound.isAsset&&n._sound.isAsset(WaveAudio)&&n.stop()}for(i=this.adaptee.numChildren;i>0;)i--,(t=this.adaptee.getChildAt(i)).isAsset(MovieClip)&&t.adapter!=t&&t.adapter.freeFromScript()},e.prototype.freeFromScript=function(){this.hasSwappedDepth=!1,t.prototype.freeFromScript.call(this),this._mouseButtonListenerCount=0},e.prototype.initAdapter=function(){for(var t in this._dropTarget="",this._mouseButtonListenerCount=0,e.currentMCAssetNameSpace=this.adaptee.assetNamespace,this.adaptee.timeline.avm1InitActions)this.executeScript(this.addScript(this.adaptee.timeline.avm1InitActions[t],"initActionsData"+t));this.initEvents&&initializeAVM1Object(this.adaptee,this._avm1Context,this.initEvents),this.attachCustomConstructor(),this.initialDepth=this.adaptee._depthID,(this.onLoaded||this.executeConstructor)&&FrameScriptManager.add_loaded_action_to_queue(this.adaptee)},e.prototype.registerScriptObject=function(t,e){t.adapter!=t&&t.adapter.setEnabled(!0);var i=t.name;if(i){if(i=i.toLowerCase(),this.alHasOwnProperty(i))return;(!this._childrenByName[i]||this._childrenByName[i].adaptee&&null==this._childrenByName[i].adaptee.parent||this._childrenByName[i].adaptee&&this._childrenByName[i].adaptee._depthID>t._depthID)&&(this._childrenByName[i]&&this._childrenByName[i].avmColor&&(this.unregisteredColors[i]=this._childrenByName[i].avmColor),this._childrenByName[i]=getAVM1Object(t,this.context),this.unregisteredColors[i]&&(this.unregisteredColors[i].changeTarget(t.adapter),this.unregisteredColors[i]=null))}},e.prototype.unregisterScriptObject=function(t){t&&t.adapter!=t&&t.adapter.alPut("onEnterFrame",null);var e=t.name;if(e&&(e=e.toLowerCase(),this._childrenByName[e]&&this._childrenByName[e].adaptee.id==t.id)){this._childrenByName[e]&&this._childrenByName[e].avmColor&&(this.unregisteredColors[e]=this._childrenByName[e].avmColor);for(var i=this.adaptee._children,r=i.length,n=null,o=null,s=0;s<r;s++)(n=i[s])!=t&&n.name&&n.name.toLowerCase()==e&&(!o||o._depthID>n._depthID)&&(o=n);o?(this._childrenByName[e]=getAVM1Object(o,this.context),this.unregisteredColors[e]&&(this.unregisteredColors[e].changeTarget(o.adapter),this.unregisteredColors[e]=null)):delete this._childrenByName[e]}},e.prototype.getLatestObjectForName=function(t){if(!this.alHasOwnProperty(t)){for(var e=this.adaptee._children,i=e.length,r=null,n=null,o=0;o<i;o++)(r=e[o]).name&&r.name.toLowerCase()==t&&(!n||n._depthID>r._depthID)&&(n=r);n&&(this._childrenByName[t]=getAVM1Object(n,this.context),this.unregisteredColors[t]&&(this.unregisteredColors[t].changeTarget(n.adapter),this.unregisteredColors[t]=null))}},Object.defineProperty(e.prototype,"graphics",{get:function(){return this.adaptee.graphics},enumerable:!0,configurable:!0}),e.prototype.initAVM1SymbolInstance=function(e,i){var r=this;this._childrenByName=Object.create(null),t.prototype.initAVM1SymbolInstance.call(this,e,i),this.dragListenerDelegate=function(t){return r.dragListener(t)},this.stopDragDelegate=function(t){return r.stopDrag(t)},this.dynamicallyCreated=!1,this.adaptee=i,this._initEventsHandlers()},e.prototype._lookupChildByName=function(t){return this._childrenByName[t]},e.prototype._lookupChildInAS3Object=function(t){return this.context.isPropertyCaseSensitive,getAVM1Object(this.adaptee.getChildByName(t),this.context)},Object.defineProperty(e.prototype,"__targetPath",{get:function(){var t=this.get_target(),e=this.adaptee.root,i="_level"+this.context.levelsContainer._getLevelForRoot(e);return"/"!=t?i+t.replace(/\//g,"."):i},enumerable:!0,configurable:!0}),e.prototype.getAwayJSID=function(){return this.adaptee.id},e.prototype.attachAudio=function(t){isNullOrUndefined$1(t)||!1!==t&&notImplemented("AVM1MovieClip.attachAudio")},e.prototype.attachBitmap=function(t,e,i,r){void 0===i&&(i="auto"),void 0===r&&(r=!1),i=alCoerceString(this.context,i),r=alToBoolean(this.context,r);var n=t.as3BitmapData;n.transparent=!0;var o=new MethodMaterial(n);o.alphaBlending=!0,o.useColorTransform=!0;var s=new Billboard(o,i,r);this._insertChildAtDepth(s,e)},e.prototype._constructMovieClipSymbol=function(t,e){t=alToString(this.context,t),e=alToString(this.context,e);var i,r=AssetLibrary.getAsset(t,this.adaptee.assetNamespace);if(r)return(i=r.adaptee.clone()).name=e,getAVM1Object(i,this._avm1Context),i},e.prototype.get$version=function(){return""},e.prototype.rgbaToArgb=function(t){return(255&t)<<24|(4278190080&t)>>>24<<16|(16711680&t)>>>16<<8|(65280&t)>>>8},e.prototype.attachMovie=function(t,e,i,r){if(this._constructMovieClipSymbol){var n=this._constructMovieClipSymbol(t,e);if(n){i=alToNumber(this.context,i);var o=this._childrenByName[e],s=this._insertChildAtDepth(n,avm2AwayDepth(i));return r&&s._init(r),o&&o.avmColor&&o.avmColor.changeTarget(s),n.timeline&&n.timeline.isButton&&n.addButtonListeners(),s.dynamicallyCreated=!0,this.registerScriptObject(n,!1),s}}},e.prototype.beginFill=function(t,e){t=alToInt32(this.context,t),void 0===e&&(2==arguments.length?e=0:arguments.length<=1&&(e=100)),e=alToNumber(this.context,e),this.graphics.beginFill(t,e/100)},e.prototype.beginBitmapFill=function(t,e,i,r){if(void 0===e&&(e=null),void 0===i&&(i=!1),void 0===r&&(r=!1),alInstanceOf(this.context,t,this.context.globals.BitmapData)){toAS3BitmapData(t),isNullOrUndefined$1(e)||toAS3Matrix(e);i=alToBoolean(this.context,i),r=alToBoolean(this.context,r),notImplemented("AVM1MovieClip.beginBitmapFill")}},e.prototype.beginGradientFill=function(t,e,i,r,n,o,s,a){var l=this;void 0===o&&(o="pad"),void 0===s&&(s="rgb"),void 0===a&&(a=0);var h=this.context.sec,c=h.createArray(AVM1ArrayNative.mapToJSArray(e,(function(t){return alToInt32(l.context,t)}))),u=h.createArray(AVM1ArrayNative.mapToJSArray(i,(function(t){return alToNumber(l.context,t)/100}))),p=h.createArray(AVM1ArrayNative.mapToJSArray(r,(function(t){return alToNumber(l.context,t)})));isNullOrUndefined$1(n)&&somewhatImplemented("AVM1MovieClip.beginGradientFill"),o=alToString(this.context,o),s=alToString(this.context,s),a=alToNumber(this.context,a),this.graphics.beginGradientFill(t,c,u,p,null,o,s,a)},e.prototype._callFrame=function(t){var e;"string"==typeof t?e=this.adaptee.timeline.getScriptForLabel(this.adaptee,t):"number"==typeof t&&(e=this.adaptee.timeline.get_script_for_frame(this.adaptee,t-1)),e&&this.executeScript(e)},e.prototype.clear=function(){this.graphics.clear()},e.prototype._insertChildAtDepth=function(t,e){return this.adaptee.addChildAtDepth(t,e),getAVM1Object(t,this._avm1Context)},e.prototype._updateChildName=function(t,e,i){e&&this._removeChildName(t,e),i&&this._addChildName(t,i)},e.prototype._removeChildName=function(t,e){if(this.context.isPropertyCaseSensitive||(e=e.toLowerCase()),this._childrenByName&&this._childrenByName[e]&&this._childrenByName[e]===t){var i=this._lookupChildInAS3Object(e);i?this._childrenByName[e]=i:delete this._childrenByName[e]}},e.prototype._addChildName=function(t,e){this.context.isPropertyCaseSensitive||(e=e.toLowerCase());var i=this._childrenByName[e];(!i||i.getDepth()>t.getDepth())&&(this._childrenByName[e]=t)},e.prototype.createEmptyMovieClip=function(t,i){var r;if(t=alToString(this.context,t),this.alHasProperty(t)){var n=this.alGet(t);n&&n instanceof e&&(r=n.adaptee)}r||((r=new MovieClip).name=t,r.assetNamespace=this.adaptee.assetNamespace,getAVM1Object(r,this._avm1Context));var o=this._insertChildAtDepth(r,avm2AwayDepth(i));return o.dynamicallyCreated=!0,this.registerScriptObject(r,!1),o},e.prototype.createTextField=function(t,e,i,r,n,o){t=alToString(this.context,t);var s=new TextField;s.name=t,s.textFormat=new TextFormat,getAVM1Object(s,this._avm1Context);var a=this._insertChildAtDepth(s,avm2AwayDepth(e));return this.registerScriptObject(s,!1),s.x=i,s.y=r,s.width=n,s.height=o,a.dynamicallyCreated=!0,a},e.prototype.get_currentframe=function(){return this.adaptee.currentFrameIndex+1},e.prototype.curveTo=function(t,e,i,r){t=alToNumber(this.context,t),e=alToNumber(this.context,e),i=alToNumber(this.context,i),r=alToNumber(this.context,r),this.graphics.curveTo(t,e,i,r)},e.prototype.setDropTarget=function(t){if(t){for(var e=[];t;)t.isAVMScene?t=null:(null!=t.name&&e.push(t.name),t=t.parent);for(var i=e.length,r="";i>0;)""!=e[--i]&&(r+="/"),r+=e[i];this._dropTarget=r}else this._dropTarget=""},e.prototype.get_droptarget=function(){return this._dropTarget},e.prototype.duplicateMovieClip=function(t,e,i){if((t=alToString(this.context,t))==this.adaptee.name)return this;var r,n=this.get_parent();n||(warning("AVM1MovieClip.duplicateMovieClip could not get parent"),n=this.context.resolveTarget(null)),this.adaptee._symbol?notImplemented("AVM1MovieClip.duplicateMovieClip from symbol"):r=this.clone().adaptee,r.name=t,r.adapter.placeObjectTag=this.placeObjectTag,r.adapter.initEvents=this.initEvents;var o=n._insertChildAtDepth(r,avm2AwayDepth(e));o.dynamicallyCreated=!0,o._avm1Context=this._avm1Context,n.registerScriptObject(r,!1);var s=r.transform.matrix3D,a=this.adaptee.transform.matrix3D._rawData;return s._rawData[0]=a[0],s._rawData[1]=a[1],s._rawData[4]=a[4],s._rawData[5]=a[5],s._rawData[12]=a[12],s._rawData[13]=a[13],r.transform.invalidateComponents(),r.alpha=this.adaptee.alpha,r.blendMode=this.adaptee.blendMode,r.cacheAsBitmap=this.adaptee.cacheAsBitmap,i&&o._init(i),o},e.prototype.endFill=function(){this.graphics.endFill()},e.prototype.getForceSmoothing=function(){return notImplemented("AVM1MovieClip.getForceSmoothing"),!1},e.prototype.setForceSmoothing=function(t){t=alToBoolean(this.context,t),notImplemented("AVM1MovieClip.setForceSmoothing")},e.prototype.get_framesloaded=function(){return notImplemented("AVM1MovieClip.get_framesloaded"),0},e.prototype.getBounds=function(t){var e=getAwayJSAdaptee(t);if(e)return convertAS3RectangeToBounds(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.renderer.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(e,!0),this.context)},e.prototype.getBytesLoaded=function(){return this.adaptee.currentFrameIndex>=0?100:-1},e.prototype.getBytesTotal=function(){return 100},e.prototype.getInstanceAtDepth=function(t){var e=this.adaptee.getChildAtDepth(avm2AwayDepth(t));return e?e.isAsset(Billboard)?this:e.isAsset(MovieClip)?this:getAVM1Object(e,this.context):null},e.prototype.getNextHighestDepth=function(){return away2avmDepth(this.adaptee.getNextHighestDepth())},e.prototype.getRect=function(t){var e=getAwayJSAdaptee(t);if(e)return convertAS3RectangeToBounds(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.renderer.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(e),this.context)},e.prototype.getSWFVersion=function(){this.adaptee.loaderInfo;return 0},e.prototype.getTextSnapshot=function(){notImplemented("AVM1MovieClip.getTextSnapshot")},e.prototype.getURL=function(t,e,i){var r=new URLRequest(t);i&&(r.method=i),FlashNetScript_navigateToURL(r,e)},e.prototype.globalToLocal=function(t){if(t){var e=toAS3Point(t);this.adaptee.transform.globalToLocal(e,e),copyAS3PointTo(e,t)}},e.prototype.gotoAndPlay=function(t){if(!this.protoTypeChanged&&null!=t){if(Array.isArray(t)){if(0==t.length)return;t=t[0]}if(t instanceof AVM1ArrayNative){if(!t.value||0==t.value.length)return;t=t.value[0]}if("string"==typeof t&&null==this.adaptee.timeline._labels[t.toLowerCase()])return t=parseInt(t),void(isNaN(t)||(this.adaptee.currentFrameIndex=t-1,this.adaptee.play()));"number"==typeof t&&t<=0||(this.adaptee.play(),this._gotoFrame(t))}},e.prototype.gotoAndStop=function(t){if(!this.protoTypeChanged&&null!=t){if(Array.isArray(t)){if(0==t.length)return;t=t[0]}if(t instanceof AVM1ArrayNative){if(!t.value||0==t.value.length)return;t=t.value[0]}"number"==typeof t&&t<=0||(this.adaptee.stop(),this._gotoFrame(t))}},e.prototype._gotoFrame=function(t){if("number"==typeof t&&t%1!=0&&(t=t.toString()),"string"==typeof t){if(null==this.adaptee.timeline._labels[t.toLowerCase()])return t=parseInt(t),void(isNaN(t)||(this.adaptee.currentFrameIndex=t-1));this.adaptee.jumpToLabel(t.toLowerCase())}else this.adaptee.currentFrameIndex=t-1},e.prototype.getHitArea=function(){return this._hitArea},e.prototype.setHitArea=function(t){this._hitArea=t;var e=t?getAwayJSAdaptee(t):null;e&&!e.isAsset(MovieClip)&&(e=null)},e.prototype.hitTest=function(t,e,i){if(arguments.length<=1){var r=arguments[0];return"string"==typeof r&&(r=this.context.resolveTarget(r)),!(isNullOrUndefined$1(r)||!hasAwayJSAdaptee(r))&&PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.renderer.view).getBoundsPicker(this.adaptee.partition).hitTestObject(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.renderer.view).getBoundsPicker(getAwayJSAdaptee(r).partition))}return t=alToNumber(this.context,t),e=alToNumber(this.context,e),t+=this.get_root().get_x(),e+=this.get_root().get_y(),i=alToBoolean(this.context,i),PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.renderer.view).getBoundsPicker(this.adaptee.partition).hitTestPoint(t,e,i)},e.prototype.lineGradientStyle=function(t,e,i,r,n,o,s,a){var l=this;void 0===o&&(o="pad"),void 0===s&&(s="rgb"),void 0===a&&(a=0);var h=this.context.sec,c=h.createArray(AVM1ArrayNative.mapToJSArray(e,(function(t){return alToInt32(l.context,t)}))),u=h.createArray(AVM1ArrayNative.mapToJSArray(i,(function(t){return alToNumber(l.context,t)/100}))),p=h.createArray(AVM1ArrayNative.mapToJSArray(r,(function(t){return alToNumber(l.context,t)})));isNullOrUndefined$1(n)&&somewhatImplemented("AVM1MovieClip.lineGradientStyle"),o=alToString(this.context,o),s=alToString(this.context,s),a=alToNumber(this.context,a),this.graphics.lineGradientStyle(t,c,u,p,null,o,s,a)},e.prototype.lineStyle=function(t,i,r,n,o,s,a,l){void 0===t&&(t=NaN),void 0===i&&(i=0),void 0===r&&(r=100),void 0===n&&(n=!1),void 0===o&&(o="normal"),void 0===s&&(s="round"),void 0===a&&(a="round"),void 0===l&&(l=3),t=alToNumber(this.context,t),i=alToInt32(this.context,i),n=alToBoolean(this.context,n),o=alToString(this.context,o);var h=e.capStyleMapStringToInt[alToString(this.context,s)],c=e.jointStyleMapStringToInt[alToString(this.context,a)];l=alToNumber(this.context,l),this.graphics.lineStyle(t,i,r/100,n,e.noScaleDictionary[o],h,c,l)},e.prototype.lineTo=function(t,e){t=toTwipFloor(alToNumber(this.context,t)),e=toTwipFloor(alToNumber(this.context,e)),this.graphics.lineTo(t,e)},e.prototype.loadMovie=function(t,e){var i=new AVM1LoaderHelper(this.context);i.load(t,e).then(function(){null!=i.content?(this.adaptee.timeline=i.content.timeline,this.adaptee.assetNamespace=i.content.assetNamespace,this.adaptee.reset(!0)):warning("loadMovie - content is null")}.bind(this))},e.prototype.loadVariables=function(t,e){this.context.actions._loadVariables(this,t,e)},e.prototype.localToGlobal=function(t){if(t){var e=toAS3Point(t);this.adaptee.transform.localToGlobal(e,e),copyAS3PointTo(e,t)}},e.prototype.get_lockroot=function(){return this._lockroot},e.prototype.set_lockroot=function(t){somewhatImplemented("AVM1MovieClip._lockroot"),this._lockroot=alToBoolean(this.context,t)},e.prototype.moveTo=function(t,e){t=toTwipFloor(alToNumber(this.context,t)),e=toTwipFloor(alToNumber(this.context,e)),this.graphics.moveTo(t,e)},e.prototype.nextFrame=function(){++this.adaptee.currentFrameIndex},e.prototype.nextScene=function(){notImplemented("AVM1MovieClip.nextScene")},e.prototype.play=function(){this.adaptee.play()},e.prototype.prevFrame=function(){--this.adaptee.currentFrameIndex,this.adaptee.stop()},e.prototype.prevScene=function(){notImplemented("AVM1MovieClip.prevScene")},e.prototype.setMask=function(t){if(null!=t){var e=this.context.resolveTarget(t);e&&(this.adaptee.mask=getAwayJSAdaptee(e))}else this.adaptee.mask=null},e.prototype.startDrag=function(t,i,r,n,o){if(e.currentDraggedMC=this,t=alToBoolean(this.context,t),this._dragBounds=null,i>n){var s=n;n=i,i=s}if(r>o){s=o;o=r,r=s}arguments.length>1&&(i=alToNumber(this.context,i),r=alToNumber(this.context,r),n=alToNumber(this.context,n),o=alToNumber(this.context,o),this._dragBounds=new Rectangle(i,r,n-i,o-r)),this.isDragging||(this.isDragging=!0,this.startDragPoint=this.adaptee.parent.transform.globalToLocal(new Point(this.context.globals.Stage._awayAVMStage.mouseX,this.context.globals.Stage._awayAVMStage.mouseY)),t&&(this.adaptee.x=this.startDragPoint.x,this.adaptee.y=this.startDragPoint.y),this._dragBounds&&this.checkBounds(),this.startDragMCPosition.x=this.adaptee.x,this.startDragMCPosition.y=this.adaptee.y,AVM1Stage.stage.addEventListener("mouseMove3d",this.dragListenerDelegate),AVM1Stage.stage.scene.mousePicker.dragEntity=this.adaptee,MouseManager.getInstance(AVM1Stage.stage.scene.renderer.renderGroup.pickGroup).isAVM1Dragging=!0)},e.prototype.dragListener=function(t){if(this.adaptee.parent){var e=this.adaptee.parent.transform.globalToLocal(new Point(this.context.globals.Stage._awayAVMStage.mouseX,this.context.globals.Stage._awayAVMStage.mouseY));this.adaptee.x=this.startDragMCPosition.x+(e.x-this.startDragPoint.x),this.adaptee.y=this.startDragMCPosition.y+(e.y-this.startDragPoint.y),this._dragBounds&&this.checkBounds()}},e.prototype.checkBounds=function(){this.adaptee.x<this._dragBounds.left&&(this.adaptee.x=this._dragBounds.left),this.adaptee.x>this._dragBounds.right&&(this.adaptee.x=this._dragBounds.right),this.adaptee.y<this._dragBounds.top&&(this.adaptee.y=this._dragBounds.top),this.adaptee.y>this._dragBounds.bottom&&(this.adaptee.y=this._dragBounds.bottom)},e.prototype.stop=function(){return e.pokiSDKonStopAction&&e.pokiSDKonStopActionChildName&&this.adaptee.getChildByName(e.pokiSDKonStopActionChildName)&&e.pokiSDKonStopAction(),e.pokiSDKonStopAction&&"all"==e.pokiSDKonStopActionChildName&&e.pokiSDKonStopAction(),this.adaptee.stop()},e.prototype.stopDrag=function(t){this.isDragging=!1,e.currentDraggedMC=null,AVM1Stage.stage.scene.mousePicker.dragEntity=null,MouseManager.getInstance(AVM1Stage.stage.scene.renderer.renderGroup.pickGroup).isAVM1Dragging=!0,AVM1Stage.stage.removeEventListener("mouseMove3d",this.dragListenerDelegate),window.removeEventListener("mouseup",this.stopDragDelegate),window.removeEventListener("touchend",this.stopDragDelegate)},e.prototype.swapDepths=function(t){if(!this.adaptee.isAVMScene&&this.get_parent()){var e=getAwayJSAdaptee(this.get_parent());e?void 0!==t?("number"==typeof t?e.swapDepths(this.adaptee,avm2AwayDepth(t)):t.adaptee&&(t._blockedByScript=!0,t._ctBlockedByScript=!0,e.swapChildren(this.adaptee,t.adaptee)),this._blockedByScript=!0,this._ctBlockedByScript=!0,this.adaptee._depthID==this.initialDepth?this.hasSwappedDepth=!1:this.hasSwappedDepth=!0,this.adaptee.name&&e&&e.adapter&&e.adapter.getLatestObjectForName(this.adaptee.name.toLowerCase())):warning("AVM1MovieClip.swapDepth called with undefined as target depth"):warning("AVM1MovieClip.swapDepth called for object with no parent")}},e.prototype.getTabChildren=function(){return getAwayObjectOrTemplate(this).tabChildren},e.prototype.setTabChildren=function(t){getAwayObjectOrTemplate(this).tabChildren=alToBoolean(this.context,t)},e.prototype.get_totalframes=function(){return this.adaptee.numFrames},e.prototype.getTrackAsMenu=function(){return notImplemented("AVM1MovieClip.getTrackAsMenu()"),getAwayObjectOrTemplate(this).trackAsMenu},e.prototype.setTrackAsMenu=function(t){notImplemented("AVM1MovieClip.setTrackAsMenu()"),getAwayObjectOrTemplate(this).trackAsMenu=alToBoolean(this.context,t)},e.prototype.unloadMovie=function(){var t=this.adaptee;this.adaptee.constructedKeyFrameIndex=0,this.adaptee.stop(),t.removeChildren(0,t.numChildren),(this.dynamicallyCreated||this.hasSwappedDepth)&&t.parent&&t.parent.adapter&&t.parent.adapter.unregisterScriptObject(t)},e.prototype.getUseHandCursor=function(){return this.adaptee.useHandCursor},e.prototype.setUseHandCursor=function(t){this.adaptee&&(this.adaptee.useHandCursor=t)},e.prototype.setParameters=function(t){for(var e in t)this.alHasProperty(e)||this.alPut(e,t[e])},e.prototype._resolveLevelNProperty=function(t){if("_level0"===t)return this.context.resolveLevel(0);if("_root"===t)return this.context.resolveRoot();if(0===t.indexOf("_level")){var e=t.substring(6),i=0|e;if(i>0&&e==i)return this.context.resolveLevel(i)}return null},e.prototype._getCachedPropertyResult=function(t){return this._cachedPropertyResult?this._cachedPropertyResult.value=t:this._cachedPropertyResult={flags:65,value:t},this._cachedPropertyResult},e.prototype.alGetOwnProperty=function(e){var i=t.prototype.alGetOwnProperty.call(this,e);if(i)return i;if("_"===e[0])if("l"===e[1]&&0===e.indexOf("_level")||"r"===e[1]&&0===e.indexOf("_root")){var r=this._resolveLevelNProperty(e);if(r)return this._getCachedPropertyResult(r)}else if(e.toLowerCase()in MovieClipProperties)return t.prototype.alGetOwnProperty.call(this,e.toLowerCase());if(hasAwayJSAdaptee(this)){var n=this._lookupChildByName(e);if(n)return this._getCachedPropertyResult(n)}},e.prototype.alGetOwnPropertiesKeys=function(){var e=t.prototype.alGetOwnPropertiesKeys.call(this);if(!hasAwayJSAdaptee(this))return e;var i=this.adaptee;if(0===i._children.length)return e;var r=Object.create(null),n=e.length,o=0;for(o=0;o<n;o++)r[e[o]]=!0;var s=i._children.length;for(o=0;o<s;o++)r[i._children[o].name]=!0;return Object.getOwnPropertyNames(r)},e.prototype._init=function(t){var e=this;t instanceof AVM1Object&&alForEachProperty(t,(function(i){e.alPut(i,t.alGet(i))}),null)},e.prototype._initEventsHandlers=function(){this.bindEvents(EventsListForMC)},e.currentMCAssetNameSpace="",e.currentDraggedMC=null,e.pokiSDKonStopActionChildName=null,e.pokiSDKonStopAction=null,e.capStyleMapStringToInt={none:0,round:1,square:2},e.jointStyleMapStringToInt={round:0,bevel:1,miter:2},e.noScaleDictionary={normal:LineScaleMode.NORMAL,none:LineScaleMode.NONE,vertical:LineScaleMode.VERTICAL,horizontal:LineScaleMode.HORIZONTAL},e}(AVM1SymbolBase);function _updateAllSymbolEvents(t){hasAwayJSAdaptee(t)&&t.updateAllEvents()}var AVM1Broadcaster=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,["initialize"],[])},e.initialize=function(t,e){var i=new AVM1PropertyDescriptor(65,new AVM1ArrayNative(t,[]));e.alSetOwnProperty("_listeners",i),i=new AVM1PropertyDescriptor(65,new AVM1NativeFunction(t,(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var n=this.alGet("_listeners");n instanceof AVM1ArrayNative&&avm1BroadcastEvent(t,this,e,i)}))),e.alSetOwnProperty("broadcastMessage",i),i=new AVM1PropertyDescriptor(65,new AVM1NativeFunction(t,(function(t){var e=this.alGet("_listeners");return e instanceof AVM1ArrayNative&&(e.value.push(t),_updateAllSymbolEvents(this),!0)}))),e.alSetOwnProperty("addListener",i),i=new AVM1PropertyDescriptor(65,new AVM1NativeFunction(t,(function(t){var e=this.alGet("_listeners");if(!(e instanceof AVM1ArrayNative))return!1;var i=e.value,r=i.indexOf(t);return!(r<0)&&(i.splice(r,1),_updateAllSymbolEvents(this),!0)}))),e.alSetOwnProperty("removeListener",i)},e}(AVM1Object),capabilitiesProperties=["avHardwareDisable","hasAccessibility","hasAudio","hasAudioEncoder","hasEmbeddedVideo","hasIME","hasMP3","hasPrinting","hasScreenBroadcast","hasScreenPlayback","hasStreamingAudio","hasStreamingVideo","hasVideoEncoder","isDebugger","language","localFileReadDisable","manufacturer","os","pixelAspectRatio","playerType","screenColor","screenDPI","screenResolutionX","screenResolutionY","serverString","version"],AVM1Capabilities=function(t){function e(e){var i=t.call(this,e)||this;i.alPrototype=e.builtins.Object.alGetPrototypeProperty();var r=null;return capabilitiesProperties.forEach((function(t){r=new AVM1PropertyDescriptor(131,null,{alCall:function(){return null}}),i.alSetOwnProperty(t,r)}),i),i}return __extends(e,t),e}(AVM1Object),AVM1Security=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{sandboxType:{get:i.getSandboxType},allowDomain:{value:i.allowDomain},allowInsecureDomain:{value:i.allowInsecureDomain},loadPolicyFile:{value:i.loadPolicyFile}}),i}return __extends(e,t),e.prototype.getSandboxType=function(){return null},e.prototype.allowDomain=function(t){t=alCoerceString(this.context,t)},e.prototype.allowInsecureDomain=function(t){t=alCoerceString(this.context,t)},e.prototype.loadPolicyFile=function(t){t=alCoerceString(this.context,t)},e}(AVM1Object),AVM1System=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.alInitStatic=function(t){this._capabilities=new AVM1Capabilities(t),this._security=new AVM1Security(t)},e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!1,e,["capabilities#","security#"],[])},e.getCapabilities=function(t){return t.getStaticState(e)._capabilities},e.getSecurity=function(t){return t.getStaticState(e)._security},e}(AVM1Object),StateTransitions;!function(t){t[t.IdleToOverUp=1]="IdleToOverUp",t[t.OverUpToIdle=2]="OverUpToIdle",t[t.OverUpToOverDown=4]="OverUpToOverDown",t[t.OverDownToOverUp=8]="OverDownToOverUp",t[t.OverDownToOutDown=16]="OverDownToOutDown",t[t.OutDownToOverDown=32]="OutDownToOverDown",t[t.OutDownToIdle=64]="OutDownToIdle",t[t.IdleToOverDown=128]="IdleToOverDown",t[t.OverDownToIdle=256]="OverDownToIdle"}(StateTransitions||(StateTransitions={}));var AVM1KeyCodeMap$1=[-1,37,39,36,35,45,46,-1,8,-1,-1,-1,-1,13,38,40,33,34,9,27],buttonActionsMap={1:ClipEventMappings[8192],2:ClipEventMappings[16384],4:ClipEventMappings[1024],8:ClipEventMappings[2048],64:ClipEventMappings[4096],160:ClipEventMappings[32768],272:ClipEventMappings[65536]},AVM1Button=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["$version#","_alpha#","getAwayJSID","attachAudio","attachBitmap","attachMovie","beginFill","beginBitmapFill","beginGradientFill","blendMode#","cacheAsBitmap#","_callFrame","clear","createEmptyMovieClip","createTextField","_currentframe#","curveTo","_droptarget#","duplicateMovieClip","enabled#","endFill","filters#","_framesloaded#","_focusrect#","forceSmoothing#","getBounds","getBytesLoaded","getBytesTotal","getDepth","getInstanceAtDepth","getNextHighestDepth","getRect","getSWFVersion","getTextSnapshot","getURL","globalToLocal","gotoAndPlay","gotoAndStop","_height#","_highquality#","hitArea#","hitTest","lineGradientStyle","lineStyle","lineTo","loadMovie","loadVariables","localToGlobal","_lockroot#","menu#","moveTo","_name#","nextFrame","opaqueBackground#","_parent#","play","prevFrame","_quality#","removeMovieClip","_root#","_rotation#","scale9Grid#","scrollRect#","setMask","_soundbuftime#","startDrag","stop","stopDrag","swapDepths","tabChildren#","tabEnabled#","tabIndex#","_target#","_totalframes#","trackAsMenu#","toString","unloadMovie","_url#","useHandCursor#","_visible#","_width#","_x#","_xmouse#","_xscale#","_y#","_ymouse#","_yscale#"])},e.prototype._updateMouseEnabled=function(t,e){this.adaptee.isAVMScene||t.isMouse&&(e?(this._mouseListenerCount++,this.adaptee.mouseEnabled=!0,this.adaptee.mouseChildren=!1,t.isButton&&(this._mouseButtonListenerCount++,this.adaptee.buttonMode=!0)):(this._mouseListenerCount--,this._mouseListenerCount<=0&&(this._mouseListenerCount=0,this.adaptee.mouseEnabled=!1,this.adaptee.mouseChildren=!1),t.isButton&&(this._mouseButtonListenerCount--,this._mouseButtonListenerCount<=0&&(this._mouseButtonListenerCount=0,this.adaptee.buttonMode=!1))))},e.prototype.initAVM1SymbolInstance=function(e,i){t.prototype.initAVM1SymbolInstance.call(this,e,i);for(var r=this.adaptee,n=this._requiredListeners=Object.create(null),o=this._actions=r.timeline.avm1ButtonActions,s=null,a=null,l=!1,h=o.length,c=0;c<h;c++)if((s=o[c]).actionsBlock||(s.actionsBlock=e.actionsDataFactory.createActionsData(s.actionsData,"s"+r.id+"e"+c)),s.keyCode,0!=s.stateTransitionFlags){for(var u in a=this._mouseEventHandler.bind(this,s.stateTransitionFlags),l=!1,buttonActionsMap)s.stateTransitionFlags&parseInt(u)&&(l=!0,n[buttonActionsMap[u].eventName]={handler:buttonActionsMap[u],boundListener:a});l||console.warn("unknown button event flag",s.stateTransitionFlags)}this.adaptee.addButtonListeners(),this._initEventsHandlers(),this._addListeners()},e.prototype.initAdapter=function(){t.prototype.initAdapter.call(this),this._addListeners()},e.prototype.stop=function(){return this.adaptee.stop()},e.prototype.getEnabled=function(){return this.enabled},e.prototype.setEnabled=function(t){this.adaptee.buttonEnabled=t,t!=this.enabled&&(this.enabled=t,this.setEnabledListener(t),this.adaptee.mouseEnabled=!0)},e.prototype.getTrackAsMenu=function(){return notImplemented("AVM1Textfield.getTrackAsMenu"),!1},e.prototype.setTrackAsMenu=function(t){notImplemented("AVM1Textfield.setTrackAsMenu")},e.prototype._addListeners=function(){for(var t in this._requiredListeners)this._eventHandlers[t]=this._requiredListeners[t].handler,this._eventsListeners[t]=this._requiredListeners[t].boundListener;this.setEnabledListener(this.enabled)},e.prototype._removeListeners=function(){for(var t in this._requiredListeners)this.adaptee.removeEventListener(t,this._requiredListeners[t].boundListener)},e.prototype._keyDownHandler=function(t){for(var e=this._actions,i=e.length,r=0;r<i;r++){var n=e[r];n.keyCode&&((n.keyCode<32&&AVM1KeyCodeMap$1[n.keyCode]===t.axGetPublicProperty("keyCode")||n.keyCode===t.axGetPublicProperty("charCode"))&&this._runAction(n))}},e.prototype._mouseEventHandler=function(t){for(var i=this,r=this._actions,n=r.length,o=0;o<n;o++){var s=r[o];s.stateTransitionFlags===t&&(console.log("press button",this.adaptee.parent.symbolID,this.adaptee.symbolID),e.buttonPokiSDKActions[this.adaptee.name]?(console.log("button has poki sdk action"),AudioManager.setVolume(0),e.buttonPokiSDKActions[this.adaptee.name]((function(){AudioManager.setVolume(1),i._runAction(s)}))):e.buttonPokiSDKActions.all?(console.log("button has poki sdk action"),AudioManager.setVolume(0),e.buttonPokiSDKActions.all((function(){AudioManager.setVolume(1),i._runAction(s)}))):this._runAction(s))}},e.prototype._runAction=function(t){var e=this._avm1Context;this.adaptee.parent&&e.executeActions(t.actionsBlock,getAVM1Object(this.adaptee.parent,this.context))},e.prototype._initEventsHandlers=function(){this.bindEvents(EventsListForButton)},e.buttonPokiSDKActions={},e}(AVM1MovieClip),AVM1Color=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["getRGB","getTransform","setRGB","setTransform"],null,e.prototype.avm1Constructor)},e.prototype.avm1Constructor=function(t){t&&(this._target=this.context.resolveTarget(t),this._target&&this._target.adaptee&&!this._target.adaptee.isAVMScene&&(this._target.avmColor=this,this._targetAwayObject=getAwayJSAdaptee(this._target)))},e.prototype.changeTarget=function(t){t&&t instanceof AVM1SymbolBase?(this._target=t,this._target.avmColor=this,this._target._ctBlockedByScript=!0,this._targetAwayObject=getAwayJSAdaptee(this._target)):this._target=null},e.prototype.getRGB=function(){var t=e.prototype.getTransform.call(this);return t?t.getRgb():null},e.prototype.getTransform=function(){return this._targetAwayObject?AVM1ColorTransform.fromAwayColorTransform(this.context,this._targetAwayObject.transform.colorTransform):null},e.prototype.setRGB=function(t){var i=e.prototype.getTransform.call(this);i&&(i.setRgb(t),e.prototype.setTransform.call(this,i)),this._target&&(this._target._ctBlockedByScript=!0)},e.prototype.setTransform=function(t){if(this._targetAwayObject&&t){var e=t;t instanceof AVM1ColorTransform||t instanceof AVM1Object&&(e=fromAVM1Object(t)),e&&(this._targetAwayObject.transform.colorTransform._rawData[0]=e._rawData[0],this._targetAwayObject.transform.colorTransform._rawData[1]=e._rawData[1],this._targetAwayObject.transform.colorTransform._rawData[2]=e._rawData[2],this._targetAwayObject.transform.colorTransform._rawData[3]=e._rawData[3],this._targetAwayObject.transform.colorTransform._rawData[4]=e._rawData[4],this._targetAwayObject.transform.colorTransform._rawData[5]=e._rawData[5],this._targetAwayObject.transform.colorTransform._rawData[6]=e._rawData[6],this._targetAwayObject.transform.colorTransform._rawData[7]=e._rawData[7],this._targetAwayObject.transform.invalidateColorTransform(),this._targetAwayObject.invalidate(),this._targetAwayObject._invalidateHierarchicalProperties(HierarchicalProperties.COLOR_TRANSFORM))}this._target&&(this._target._ctBlockedByScript=!0)},e}(AVM1Object),AVM1Key=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!1,e,["BACKSPACE","CAPSLOCK","CONTROL","DELETEKEY","DOWN","END","ENTER","ESCAPE","HOME","INSERT","LEFT","PGDN","PGUP","RIGHT","SHIFT","SPACE","TAB","UP","isDown","getCode"],[])},e.alInitStatic=function(t){this._keyStates=[],this._lastKeyCode=0},e.bindStage=function(t,i,r,n){e.keyDownDelegate&&n.removeEventListener("keydown",e.keyDownDelegate),e.keyUpDelegate&&n.removeEventListener("keyup",e.keyUpDelegate),e.keyDownDelegate=function(r){var n=t.getStaticState(e);n._lastKeyCode=r.keyCode,n._keyStates[r.keyCode]=1,alCallProperty(i,"broadcastMessage",["onKeyDown"])},e.keyUpDelegate=function(r){var n=t.getStaticState(e);n._lastKeyCode=r.keyCode,delete n._keyStates[r.keyCode],alCallProperty(i,"broadcastMessage",["onKeyUp"])},n.addEventListener("keydown",e.keyDownDelegate),n.addEventListener("keyup",e.keyUpDelegate)},e.isDown=function(t,i){return!!t.getStaticState(e)._keyStates[i]},e.getCode=function(t){return t.getStaticState(e)._lastKeyCode},e.BACKSPACE=8,e.CAPSLOCK=20,e.CONTROL=17,e.DELETEKEY=46,e.DOWN=40,e.END=35,e.ENTER=13,e.ESCAPE=27,e.HOME=36,e.INSERT=45,e.LEFT=37,e.PGDN=34,e.PGUP=33,e.RIGHT=39,e.SHIFT=16,e.SPACE=32,e.TAB=9,e.UP=38,e.keyDownDelegate=null,e.keyUpDelegate=null,e}(AVM1Object),AVM1Mouse=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!1,e,["show","hide"],[])},e.bindStage=function(t,i,r,n){e.mouseDownDelegate&&r.removeEventListener("keydown",e.mouseDownDelegate),e.mouseMoveDelegate&&r.removeEventListener("keyup",e.mouseMoveDelegate),e.mouseOutDelegate&&r.removeEventListener("keyup",e.mouseOutDelegate),e.mouseUpDelegate&&r.removeEventListener("keyup",e.mouseUpDelegate),e.mouseDownDelegate=function(t){alCallProperty(i,"broadcastMessage",["onMouseDown"])},e.mouseMoveDelegate=function(t){alCallProperty(i,"broadcastMessage",["onMouseMove"])},e.mouseOutDelegate=function(t){alCallProperty(i,"broadcastMessage",["onMouseOut"])},e.mouseUpDelegate=function(t){alCallProperty(i,"broadcastMessage",["onMouseUp"])},r.addEventListener("mouseDown",e.mouseDownDelegate),r.addEventListener("mouseMove",e.mouseMoveDelegate),r.addEventListener("mouseOut",e.mouseOutDelegate),r.addEventListener("mouseUp",e.mouseUpDelegate)},e.hide=function(){AVM1Globals.instance.Stage._awayAVMStage.scene.mouseManager.showCursor=!1},e.show=function(){AVM1Globals.instance.Stage._awayAVMStage.scene.mouseManager.showCursor=!0},e.mouseDownDelegate=null,e.mouseMoveDelegate=null,e.mouseOutDelegate=null,e.mouseUpDelegate=null,e}(AVM1Object),AVM1MovieClipLoader=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["loadClip","unloadClip","getProgress"],null,e.prototype.avm1Constructor)},e.prototype.avm1Constructor=function(){AVM1Broadcaster.initialize(this.context,this)},e.prototype.loadClip=function(t,e){if("number"==typeof e){if(0===e)return notImplemented("MovieClipLoader.loadClip at _level0"),!1}else if(!this.context.resolveTarget(e))return!1;var i=new AVM1LoaderHelper(this.context);return this._loaderHelper=i,this._target=null,!0},e.prototype.unloadClip=function(t){return notImplemented("MovieClipLoader.unloadClip"),!0},e.prototype.getProgress=function(t){return this._loaderHelper.loaderInfo.bytesLoaded},e}(AVM1Object);function loadAVM1DataObject(t,e,i,r,n,o){var s=new URLRequest(e);i&&(s.method=i),n&&(s.data=n);var a=new URLLoader;a.dataFormat="text";var l=function(e){a.removeEventListener(URLLoaderEvent.LOAD_COMPLETE,l),avm1BroadcastEvent(t,o,"onData",[a.data])};a.addEventListener(URLLoaderEvent.LOAD_COMPLETE,l),o._as3Loader=a,a.load(s)}var AVM1LoadVarsFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alSetOwnPrototypeProperty(new AVM1LoadVarsPrototype(e,i)),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=new AVM1Object(this.context);return e.alPrototype=this.alGetPrototypeProperty(),e.isAVM1DataObject=!0,e},e.prototype.alCall=function(t,e){return this.alConstruct(e)},e}(AVM1Function),AVM1LoadVarsPrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return alDefineObjectProperties(r,{constructor:{value:i,writable:!0},toString:{value:r._toString},load:{value:r.load},onData:{value:r.defaultOnData},decode:{value:r.decode},send:{value:r.load},sendAndload:{value:r.load}}),r}return __extends(e,t),e.prototype.getBytesLoaded=function(){if(this._as3Loader)return this._as3Loader.bytesLoaded},e.prototype.getBytesTotal=function(){if(this._as3Loader)return this._as3Loader.bytesTotal},e.prototype.load=function(t){return!!(t=alCoerceString(this.context,t))&&(loadAVM1DataObject(this.context,t,null,null,null,this),!0)},e.prototype.defaultOnData=function(t){isNullOrUndefined$1(t)?avm1BroadcastEvent(this.context,this,"onLoad",[!1]):(e.prototype.decode.call(this,t),this.alPut("loaded",!0),avm1BroadcastEvent(this.context,this,"onLoad",[!0]))},e.prototype.decode=function(t){t=alCoerceString(this.context,t)},e.prototype._toString=function(){this.context;return""},e.prototype.send=function(t,e,i){return t=alCoerceString(this.context,t),i=isNullOrUndefined$1(i)?"POST":alCoerceString(this.context,i),notImplemented("AVM1LoadVarsPrototype.send"),!1},e.prototype.sendAndLoad=function(t,e,i){if(t=alCoerceString(this.context,t),i=isNullOrUndefined$1(i)?"POST":alCoerceString(this.context,i),!(t&&e instanceof AVM1Object))return!1;if(!e.isAVM1DataObject)return!1;var r=this.alGet("contentType");r=isNullOrUndefined$1(r)?"application/x-www-form-urlencoded":alCoerceString(this.context,r);var n=alToString(this.context,this);return loadAVM1DataObject(this.context,t,i,r,n,e),!0},e}(AVM1Object),AVM1Sound=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loopsToPlay=0,e}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["attachSound","duration#","getBytesLoaded","getBytesTotal","getPan","setPan","getTransform","setTransform","getVolume","setVolume","start","stop","onSoundComplete"],null,e.prototype.avm1Constructor)},e.prototype.avm1Constructor=function(t){this._target=this.context.resolveTarget(t),this._sound=null,this._channel=null,this._linkageID=null,this._assetNameSpace=AVM1MovieClip.currentMCAssetNameSpace},e.prototype.alPut=function(e,i){t.prototype.alPut.call(this,e,i),e&&"onsoundcomplete"==e.toLowerCase()&&this.onSoundComplete(i)},e.prototype.alDeleteProperty=function(e){return t.prototype.alDeleteProperty.call(this,e),e&&"onsoundcomplete"==e.toLowerCase()&&this.onSoundComplete(),!0},e.prototype.attachSound=function(t){var e=this;if("string"==typeof t||"number"==typeof t){var i=AssetLibrary.getAsset(t,this._assetNameSpace);i?(this._linkageID=t,this._sound=i.clone(),this._sound?this._sound.onSoundComplete=function(){return e.soundCompleteInternal()}:warning("AVM1Sound.attachSound no WaveAudio found "+t)):warning("AVM1Sound.attachSound no symbol found "+t)}},e.prototype.soundCompleteInternal=function(){this.loopsToPlay--,this.loopsToPlay>0?(this.stop(),this._sound.play(0,!1)):this._onCompleteCallback&&this._onCompleteCallback()},e.prototype.onSoundComplete=function(t){void 0===t&&(t=null);var e=this;this._onCompleteCallback=null,t&&(this._onCompleteCallback=function(){t.alCall(e)}),this._sound||warning("AVM1Sound.onSoundComplete called, but no WaveAudio set")},e.prototype.loadSound=function(t,e){console.warn("AVM1Sound.loadSound")},e.prototype.getBytesLoaded=function(){return console.warn("AVM1Sound.getBytesLoaded"),0},e.prototype.getBytesTotal=function(){return console.warn("AVM1Sound.getBytesTotal"),0},e.prototype.getDuration=function(){return console.warn("AVM1Sound.getDuration"),0},e.prototype.getPan=function(){return console.warn("AVM1Sound.getPan"),0},e.prototype.setPan=function(t){console.warn("AVM1Sound.setPan")},e.prototype.getTransform=function(){return console.warn("AVM1Sound.getTransform"),null},e.prototype.setTransform=function(t){console.warn("AVM1Sound.setTransform")},e.prototype.getVolume=function(){return this._sound?100*this._sound.volume:(console.warn("AVM1Sound.getVolume called, but no WaveAudio set"),100)},e.prototype.setVolume=function(t){this._sound?(this._target&&this._target.adaptee&&(this._target.adaptee.soundVolume=t/100),this._sound.volume=t/100):console.warn("AVM1Sound.setVolume called, but no WaveAudio set")},e.prototype.start=function(t,e){this._sound?(e=isNaN(e)||e<1?1:Math.floor(e),this.loopsToPlay=e,this._target&&this._target.adaptee&&this._target.adaptee.startSound(this._linkageID,this._sound,this.loopsToPlay)):warning("AVM1Sound.start called, but no WaveAudio set")},e.prototype.stop=function(t){this._sound?this._target&&this._target.adaptee&&this._target.adaptee.stopSounds(this._linkageID):warning("AVM1Sound.stop called, but no WaveAudio set")},e}(AVM1Object),AVM1SharedObject=function(t){function e(e){var i=t.call(this,e)||this;return alDefineObjectProperties(i,{data:{get:i.getData},clear:{value:i.clear,writable:!0},flush:{value:i.flush,writable:!0}}),i}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,["getLocal"],["data#","flush","clear"])},e.prototype.setName=function(t){if(this._data=alNewObject(this.context),t=alCoerceString(this.context,t),this._storage_name=t,"undefined"!=typeof Storage){var e=JSON.parse(localStorage.getItem(t));e&&(this._data=this.getAVM1Value(e))}return console.log("no shared object found"),null},e.getLocal=function(t,i,r,n){(r||n)&&console.warn("SharedObject.getLocal: params 'localPath' and 'secure' not supported");var o=new e(t);return o.setName(i),o},e.prototype.getData=function(){return this._data},e.prototype.clear=function(){},e.prototype.getAVM1Value=function(t){if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)return t;if(Array.isArray(t)){for(var e=0;e<t.length;e++)t[e]=this.getAVM1Value(t[e]);return new AVM1ArrayNative(this.context,t)}if("object"==typeof t){var i=alNewObject(this.context);for(var r in t)i.alSetOwnProperty(r,new AVM1PropertyDescriptor(65,this.getAVM1Value(t[r])));return i}},e.prototype.getJSValue=function(t){if("number"==typeof t||"string"==typeof t||"boolean"==typeof t)return t;if(alIsArray(this.context,t)){console.log("array");var e=t.value,i=[];if(e)for(var r=e.length,n=0;n<r;n++)i[n]=this.getJSValue(e[n]);return i}if(t instanceof AVM1Object){var o={};for(var s in t._ownProperties)"__proto__"!=s&&"__constructor__"!=s&&(o[s]=this.getJSValue(t._ownProperties[s].value));return o}console.log("unknown datatype")},e.prototype.flush=function(t){var e=this.getJSValue(this._data);return localStorage.setItem(this._storage_name,JSON.stringify(e)),!1},e}(AVM1Object),AVM1TextFormat=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){var i=["align#","blockIndent#","bold#","bullet#","color#","font#","getTextExtent","indent#","italic#","kerning#","leading#","leftMargin#","letterSpacing#","rightMargin#","size#","tabStops#","target#","adaptee#","underline#","url#"],r=wrapAVM1NativeClass(t,!0,e,[],i,null,e.prototype.avm1Constructor),n=r.alGetPrototypeProperty(),o=null;return i.forEach((function(t){"#"===t[t.length-1]&&(t=t.slice(0,-1)),(o=n.alGetOwnProperty(t)).flags&=-2,n.alSetOwnProperty(t,o)})),r},e.createFromNative=function(t,i){var r=t.globals.TextFormat,n=new e(t);return n.alPrototype=r.alGetPrototypeProperty(),n.adaptee=i,n},e.prototype.alPut=function(e,i){"font"==e&&this.setFont(i),t.prototype.alPut.call(this,e,i)},e.prototype.avm1Constructor=function(t,e,i,r,n,o,s,a,l,h,c,u,p){var d=this.context;t=null==t?null:alToString(d,t),e=null==e?null:alToNumber(d,e),i=null==i?null:alToNumber(d,i),r=null==r?null:alToBoolean(d,r),n=null==n?null:alToBoolean(d,n),o=null==o?null:alToBoolean(d,o),s=null==s?null:alToString(d,s),a=null==a?null:alToString(d,a),l=null==l?null:alToString(d,l),h=null==h?null:alToNumber(d,h),c=null==c?null:alToNumber(d,c),u=null==u?null:alToNumber(d,u),p=null==p?null:alToNumber(d,p);var f=new TextFormat(t,e,i,r,n,o,s,a,l,h,c,u,p);this.adaptee=f},e.alInitStatic=function(t){var e=new TextField;e.multiline=!0,this._measureTextField=e},e.prototype.getAdaptee=function(){return this.adaptee.id},e.prototype.setAdaptee=function(t){},e.prototype.getAlign=function(){return this.adaptee.align},e.prototype.setAlign=function(t){var e=alToString(this.context,t);""==e&&(e="center"),this.adaptee.align=e},e.prototype.getBlockIndent=function(){return notImplemented("AVM1TextFormat.getBlockIndent"),this.adaptee.blockIndent},e.prototype.setBlockIndent=function(t){notImplemented("AVM1TextFormat.setBlockIndent"),this.adaptee.blockIndent=alToNumber(this.context,t)},e.prototype.getBold=function(){return this.adaptee.bold},e.prototype.setBold=function(t){this.adaptee.bold=alToBoolean(this.context,t)},e.prototype.getBullet=function(){return notImplemented("AVM1TextFormat.getBullet"),this.adaptee.bullet},e.prototype.setBullet=function(t){notImplemented("AVM1TextFormat.setBullet"),this.adaptee.bullet=alToBoolean(this.context,t)},e.prototype.getColor=function(){return this.adaptee.color},e.prototype.setColor=function(t){this.adaptee.color=alToNumber(this.context,t)},e.prototype.getFont=function(){return this.adaptee.font},e.prototype.setFont=function(t){this.adaptee.font_name=alToString(this.context,t)},e.prototype.getIndent=function(){return this.adaptee.indent},e.prototype.setIndent=function(t){this.adaptee.indent=alToNumber(this.context,t)},e.prototype.getItalic=function(){return this.adaptee.italic},e.prototype.setItalic=function(t){this.adaptee.italic=alToBoolean(this.context,t)},e.prototype.getKerning=function(){return notImplemented("AVM1TextFormat.getKerning"),this.adaptee.kerning},e.prototype.setKerning=function(t){notImplemented("AVM1TextFormat.setKerning"),this.adaptee.kerning=alToBoolean(this.context,t)},e.prototype.getLeading=function(){return this.adaptee.leading},e.prototype.setLeading=function(t){this.adaptee.leading=alToNumber(this.context,t)},e.prototype.getLeftMargin=function(){return this.adaptee.leftMargin},e.prototype.setLeftMargin=function(t){this.adaptee.leftMargin=alToNumber(this.context,t)},e.prototype.getLetterSpacing=function(){return this.adaptee.letterSpacing},e.prototype.setLetterSpacing=function(t){this.adaptee.letterSpacing=alToNumber(this.context,t)},e.prototype.getRightMargin=function(){return this.adaptee.rightMargin},e.prototype.setRightMargin=function(t){this.adaptee.rightMargin=alToNumber(this.context,t)},e.prototype.getSize=function(){return this.adaptee.size},e.prototype.setSize=function(t){this.adaptee.size=alToNumber(this.context,t)},e.prototype.getTabStops=function(){notImplemented("AVM1TextFormat.getTabStops");var t=this.adaptee.tabStops;return t?t.value:null},e.prototype.setTabStops=function(t){if(notImplemented("AVM1TextFormat.setTabStops"),t instanceof AVM1ArrayNative||null==t){var e=t&&this.context.sec.createArray(t);this.adaptee.tabStops=e}},e.prototype.getTarget=function(){return notImplemented("AVM1TextFormat.getTarget"),this.adaptee.target},e.prototype.setTarget=function(t){notImplemented("AVM1TextFormat.setTarget"),this.adaptee.target=alToString(this.context,t)},e.prototype.getTextExtent=function(t,i){notImplemented("AVM1TextFormat.getTextExtent"),t=alCoerceString(this.context,t),i=+i;var r=this.context.getStaticState(e)._measureTextField;!isNaN(i)&&i>0?(r.width=i+4,r.wordWrap=!0):r.wordWrap=!1,r.defaultTextFormat=this.adaptee,r.text=t;var n=alNewObject(this.context),o=r.textWidth,s=r.textHeight;n.alPut("width",o),n.alPut("height",s),n.alPut("textFieldWidth",o+4),n.alPut("textFieldHeight",s+4);var a=r.getLineMetrics(0);return n.alPut("ascent",a.axGetPublicProperty("ascent")),n.alPut("descent",a.axGetPublicProperty("descent")),n},e.prototype.getUnderline=function(){return notImplemented("AVM1TextFormat.getUnderline"),this.adaptee.underline},e.prototype.setUnderline=function(t){notImplemented("AVM1TextFormat.setUnderline"),this.adaptee.underline=alToBoolean(this.context,t)},e.prototype.getUrl=function(){return notImplemented("AVM1TextFormat.getUrl"),this.adaptee.url},e.prototype.setUrl=function(t){notImplemented("AVM1TextFormat.setUrl"),this.adaptee.url=alToString(this.context,t)},e}(AVM1Object),XMLNode=function(){function t(t,e){}return t.prototype.axCallPublicProperty=function(t,e){return null},t.prototype.axGetPublicProperty=function(t){return null},t.prototype.axSetPublicProperty=function(t,e){return null},t.prototype.removeChild=function(t){},Object.defineProperty(t.prototype,"attributes",{get:function(){return console.log("attributes not implemented yet in flash/XMLNode"),null},set:function(t){console.log("attributes not implemented yet in flash/XMLNode")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return console.log("childNodes not implemented yet in flash/XMLNode"),[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localName",{get:function(){return console.log("localName not implemented yet in flash/XMLNode"),""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"namespaceURI",{get:function(){return console.log("namespaceURI not implemented yet in flash/XMLNode"),""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prefix",{get:function(){return console.log("prefix not implemented yet in flash/XMLNode"),""},enumerable:!0,configurable:!0}),t.prototype.appendChild=function(t){console.log("appendChild not implemented yet in flash/XMLNode")},t.prototype.cloneNode=function(t){return console.log("cloneNode not implemented yet in flash/XMLNode"),null},t.prototype.getNamespaceForPrefix=function(t){return console.log("getNamespaceForPrefix not implemented yet in flash/XMLNode"),""},t.prototype.getPrefixForNamespace=function(t){return console.log("getPrefixForNamespace not implemented yet in flash/XMLNode"),""},t.prototype.hasChildNodes=function(){return console.log("hasChildNodes not implemented yet in flash/XMLNode"),!1},t.prototype.insertBefore=function(t,e){console.log("insertBefore not implemented yet in flash/XMLNode")},t.prototype.removeNode=function(){console.log("removeNode not implemented yet in flash/XMLNode")},t.prototype.toString=function(){return console.log("toString not implemented yet in flash/XMLNode"),""},t}(),AVM1XMLNodeType;function toAS3XMLNode(t){if(!(t instanceof AVM1Object))return null;var e=t.context;return alInstanceOf(e,t,e.globals.XMLNode)?t.as3XMLNode:null}function fromAS3XMLNode(t,e){if(!isNullOrUndefined$1(e)){var i=e._as2Node;return i||((i=new AVM1Object(t)).alPrototype=t.globals.XMLNode.alGetPrototypeProperty(),AVM1XMLNodePrototype.prototype.initializeFromAS3Node.call(i,e)),i}}!function(t){t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.TEXT_NODE=3]="TEXT_NODE"}(AVM1XMLNodeType||(AVM1XMLNodeType={}));var AVM1XMLNodeFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alSetOwnPrototypeProperty(new AVM1XMLNodePrototype(e,i)),i}return __extends(e,t),e.prototype.alConstruct=function(t){if(!t&&t.length<2)Debug.notImplemented("Unsupported amount of parameters for AVM1XMLNode constructor");else{var e=alCoerceNumber(this.context,t[0]),i=alCoerceString(this.context,t[1]);if(e===AVM1XMLNodeType.ELEMENT_NODE||e===AVM1XMLNodeType.TEXT_NODE){var r=new AVM1Object(this.context);return r.alPrototype=this.alGetPrototypeProperty(),AVM1XMLNodePrototype.prototype.initializeNode.call(r,e,i),r}Debug.notImplemented("Unsupported AVM1XMLNode type: "+e)}},e.prototype.alCall=function(t,e){return this.alConstruct(e)},e}(AVM1Function),AVM1XMLNodeChildNodes=function(t){function e(e,i){var r=t.call(this,e)||this;return r._as3XMLNode=i,r._cachedNodePropertyDescriptor=new AVM1PropertyDescriptor(70,void 0),alDefineObjectProperties(r,{length:{get:r.getLength}}),r}return __extends(e,t),Object.defineProperty(e.prototype,"as3ChildNodes",{get:function(){return this._as3XMLNode.axGetPublicProperty("childNodes").value},enumerable:!0,configurable:!0}),e.prototype.getLength=function(){return this.as3ChildNodes.length},e.prototype.alGetOwnProperty=function(e){if(alIsIndex(this.context,e)){var i=alToInteger(this.context,e);if(i>=0&&i<this.as3ChildNodes.length)return this._cachedNodePropertyDescriptor.value=fromAS3XMLNode(this.context,this.as3ChildNodes[i]),this._cachedNodePropertyDescriptor}return t.prototype.alGetOwnProperty.call(this,e)},e}(AVM1Object),AVM1XMLNodeAttributes=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),r._as3Attributes=i,r._cachedNodePropertyDescriptor=new AVM1PropertyDescriptor(64,void 0),r}return __extends(e,t),e.prototype.alGetOwnProperty=function(t){var e=alCoerceString(this.context,t);if(this._as3Attributes.axHasPublicProperty(e))return this._cachedNodePropertyDescriptor.value=this._as3Attributes.axGetPublicProperty(e),this._cachedNodePropertyDescriptor},e.prototype.alSetOwnProperty=function(t,e){var i=alCoerceString(this.context,t);if(64&e.flags){var r=alCoerceString(this.context,e.value);this._as3Attributes.axSetPublicProperty(i,r)}},e.prototype.alHasOwnProperty=function(t){var e=alCoerceString(this.context,t);return this._as3Attributes.axHasPublicProperty(e)},e.prototype.alDeleteOwnProperty=function(t){var e=alCoerceString(this.context,t);this._as3Attributes.axDeletePublicProperty(e)},e.prototype.alGetOwnPropertiesKeys=function(){return this._as3Attributes.axGetEnumerableKeys().map((function(t){return axCoerceString$2(t)}))},e}(AVM1Object),AVM1XMLNodePrototype=function(t){function e(e,i){var r=t.call(this,e)||this;return alDefineObjectProperties(r,{constructor:{value:i,writable:!0},attributes:{get:r.getAttributes,set:r.setAttributes},childNodes:{get:r.getChildNodes},firstChild:{get:r.getFirstChild},lastChild:{get:r.getLastChild},localName:{get:r.getLocalName},namespaceURI:{get:r.getNamespaceURI},nextSibling:{get:r.getNextSibling},nodeName:{get:r.getNodeName,set:r.setNodeName},nodeType:{get:r.getNodeType},nodeValue:{get:r.getNodeValue,set:r.setNodeValue},parentNode:{get:r.getParentNode},prefix:{get:r.getPrefix},previousSibling:{get:r.getPreviousSibling},appendChild:{value:r.appendChild},cloneNode:{value:r.cloneNode},getNamespaceForPrefix:{value:r.getNamespaceForPrefix},getPrefixForNamespace:{value:r.getPrefixForNamespace},hasChildNodes:{value:r.hasChildNodes},insertBefore:{value:r.insertBefore},removeNode:{value:r.removeNode},toString:{value:r._toString}}),r}return __extends(e,t),e.prototype.initializeNode=function(t,i){this.as3XMLNode=new XMLNode(t,i),this._attributes=void 0,this._childNodes=void 0,e.addMap(this.as3XMLNode,this)},e.prototype.initializeFromAS3Node=function(t){this.as3XMLNode=t,this._attributes=void 0,this._childNodes=void 0,e.addMap(this.as3XMLNode,this)},e.prototype._toString=function(){return this.as3XMLNode.toString()},e.prototype.appendChild=function(t){this.as3XMLNode.axCallPublicProperty("appendChild",[toAS3XMLNode(t)])},e.prototype.getAttributes=function(){var t=this.as3XMLNode.axGetPublicProperty("attributes");if(!isNullOrUndefined$1(t))return this._attributes||(this._attributes=new AVM1XMLNodeAttributes(this.context,t)),this._attributes},e.prototype.setAttributes=function(t){var e=this;if(isNullOrUndefined$1(t))this._attributes=void 0;else if(t instanceof AVM1XMLNodeAttributes)this._attributes=t;else{var i=this.context,r=i.sec.createObject();alForEachProperty(t,(function(t){var n=alCoerceString(i,t),o=alCoerceString(i,e.alGet(t));r.axSetPublicProperty(n,o)}),this),this._attributes=new AVM1XMLNodeAttributes(i,r)}},e.prototype.getChildNodes=function(){return this._childNodes||(this._childNodes=new AVM1XMLNodeChildNodes(this.context,this.as3XMLNode)),this._childNodes},e.prototype.cloneNode=function(t){t=alToBoolean(this.context,t);var e=this.as3XMLNode.axCallPublicProperty("cloneNode",[t]);return fromAS3XMLNode(this.context,e)},e.prototype.getFirstChild=function(){return fromAS3XMLNode(this.context,this.as3XMLNode.axGetPublicProperty("firstChild"))},e.prototype.getNamespaceForPrefix=function(t){return this.as3XMLNode.axCallPublicProperty("getNamespaceForPrefix",[t])},e.prototype.getPrefixForNamespace=function(t){return this.as3XMLNode.axCallPublicProperty("getNamespaceForPrefix",[t])},e.prototype.hasChildNodes=function(){return this.as3XMLNode.axCallPublicProperty("hasChildNodes",null)},e.prototype.insertBefore=function(t,e){this.as3XMLNode.axCallPublicProperty("insertBefore",[toAS3XMLNode(t),toAS3XMLNode(e)])},e.prototype.getLastChild=function(){return fromAS3XMLNode(this.context,this.as3XMLNode.axGetPublicProperty("lastChild"))},e.prototype.getLocalName=function(){return this.as3XMLNode.axGetPublicProperty("localName")},e.prototype.getNamespaceURI=function(){return this.as3XMLNode.axGetPublicProperty("namespaceURI")},e.prototype.getNextSibling=function(){return fromAS3XMLNode(this.context,this.as3XMLNode.axGetPublicProperty("nextSibling"))},e.prototype.getNodeName=function(){return this.as3XMLNode.axGetPublicProperty("nodeName")},e.prototype.setNodeName=function(t){t=alCoerceString(this.context,t),this.as3XMLNode.axSetPublicProperty("nodeName",t)},e.prototype.getNodeType=function(){return this.as3XMLNode.axGetPublicProperty("nodeType")},e.prototype.getNodeValue=function(){return this.as3XMLNode.axGetPublicProperty("nodeValue")},e.prototype.setNodeValue=function(t){t=alCoerceString(this.context,t),this.as3XMLNode.axSetPublicProperty("nodeValue",t)},e.prototype.getParentNode=function(){return fromAS3XMLNode(this.context,this.as3XMLNode.axGetPublicProperty("parentNode"))},e.prototype.getPrefix=function(){return this.as3XMLNode.axGetPublicProperty("prefix")},e.prototype.getPreviousSibling=function(){return fromAS3XMLNode(this.context,this.as3XMLNode.axGetPublicProperty("previousSibling"))},e.prototype.removeNode=function(){this.as3XMLNode.axCallPublicProperty("removeNode",null)},e.addMap=function(t,e){t._as2Node=e},e}(AVM1Object),AVM1XMLFunction=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alSetOwnPrototypeProperty(new AVM1XMLPrototype(e,r,i)),r}return __extends(e,t),e.prototype.alConstruct=function(t){var e=t&&alCoerceString(this.context,t[0]),i=new AVM1Object(this.context);return i.alPrototype=this.alGetPrototypeProperty(),i.isAVM1DataObject=!0,e||(e=""),AVM1XMLPrototype.prototype.initializeDocument.call(i,e),i},e.prototype.alCall=function(t,e){return this.alConstruct(e)},e}(AVM1Function),AVM1XMLPrototype=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.alPrototype=r.alGetPrototypeProperty(),alDefineObjectProperties(n,{constructor:{value:i,writable:!0},addRequestHeader:{value:n.addRequestHeader},createElement:{value:n.createElement},createTextNode:{value:n.createTextNode},getBytesLoaded:{value:n.getBytesLoaded},getBytesTotal:{value:n.getBytesTotal},ignoreWhite:{value:!1,writable:!0},load:{value:n.load},parseXML:{value:n.parseXML},send:{value:n.send},sendAndLoad:{value:n.sendAndLoad},onData:{value:n.defaultOnData,writable:!0}}),n}return __extends(e,t),e.prototype.initializeDocument=function(t){t=alCoerceString(this.context,t)||null;var e=new XMLDocument;e.body.innerHTML=t,AVM1XMLNodePrototype.prototype.initializeFromAS3Node.call(this,e),this.as3XMLDocument=e},e.prototype.addRequestHeader=function(t,e){Debug.notImplemented("AVM1XMLPrototype.addRequestHeader")},e.prototype.createElement=function(t){t=alCoerceString(this.context,t);var e=this.as3XMLDocument.axCallPublicProperty("createElement",[t]);return fromAS3XMLNode(this.context,e)},e.prototype.createTextNode=function(t){t=alCoerceString(this.context,t);var e=this.as3XMLDocument.axCallPublicProperty("createTextNode",[t]);return fromAS3XMLNode(this.context,e)},e.prototype.getBytesLoaded=function(){if(this._as3Loader)return this._as3Loader.bytesLoaded},e.prototype.getBytesTotal=function(){if(this._as3Loader)return this._as3Loader.bytesTotal},e.prototype.load=function(t){return!!(t=alCoerceString(this.context,t))&&(loadAVM1DataObject(this.context,t,null,null,null,this),!0)},e.prototype.defaultOnData=function(t){isNullOrUndefined$1(t)?avm1BroadcastEvent(this.context,this,"onLoad",[!1]):(e.prototype.parseXML.call(this,t),this.alPut("loaded",!0),avm1BroadcastEvent(this.context,this,"onLoad",[!0]))},e.prototype.parseXML=function(t){t=alCoerceString(this.context,t),this.as3XMLDocument.axSetPublicProperty("ignoreWhite",alToBoolean(this.context,this.alGet("ignoreWhite"))),this.as3XMLDocument.axCallPublicProperty("parseXML",[t])},e.prototype.send=function(t,e,i){return t=alCoerceString(this.context,t),e=isNullOrUndefined$1(e)?void 0:alCoerceString(this.context,e),i=isNullOrUndefined$1(i)?void 0:alCoerceString(this.context,i),Debug.notImplemented("AVM1XMLPrototype.send"),!1},e.prototype.sendAndLoad=function(t,e){if((t=alCoerceString(this.context,t))&&e.isAVM1DataObject){Debug.somewhatImplemented("AVM1XMLPrototype.send");var i=this.alGet("contentType");i=isNullOrUndefined$1(i)?void 0:alCoerceString(this.context,i);var r=alToString(this.context,this);loadAVM1DataObject(this.context,t,"POST",i,r,e)}},e}(AVM1Object),AVM1Transform=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["matrix#","concatenatedMatrix#","colorTransform#","pixelBounds#"],null,e.prototype.avm1Constructor)},Object.defineProperty(e.prototype,"as3Transform",{get:function(){return this._targetAwayObject.transform},enumerable:!0,configurable:!0}),e.prototype.avm1Constructor=function(t){this._target=this.context.resolveTarget(t),this._targetAwayObject=getAwayJSAdaptee(this._target)},e.prototype.getMatrix=function(){var t=this._targetAwayObject.transform;return AVM1Matrix.fromAS3Matrix(this.context,t.matrix)},e.prototype.setMatrix=function(t){this._targetAwayObject.transform.matrix=toAS3Matrix(t)},e.prototype.getConcatenatedMatrix=function(){var t=this._targetAwayObject.transform;return AVM1Matrix.fromAS3Matrix(this.context,t.concatenatedMatrix)},e.prototype.getColorTransform=function(){var t=this._targetAwayObject.transform;return AVM1ColorTransform.fromAwayColorTransform(this.context,t.colorTransform)},e.prototype.setColorTransform=function(t){this._targetAwayObject.transform.colorTransform=toAwayColorTransform(t)},e.prototype.getPixelBounds=function(){var t=this._targetAwayObject.transform;return AVM1Rectangle.fromAS3Rectangle(this.context,t.pixelBounds)},e}(AVM1Object),AVM1ExternalInterface=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,["available#","addCallback","call"],[])},e.getAvailable=function(t){return!0},e.addCallback=function(t,e,i,r){if(e=alCoerceString(t,e),!alIsFunction(r))return!1;try{return window.flashObject||(window.flashObject={}),window.flashObject[e]=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=i.alGet(e.toLowerCase());n&&alIsFunction(n)?n.alCall(i,t):n&&n.value&&n.value.alCall(i,t)},!0}catch(t){}return!1},e.call=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=[],o=i.length,s=0;for(s=0;s<o;s++)n.push(i[s]);1==n.length&&(n=n[0]);try{var a=e.split("."),l=window;for(s=0;s<a.length;s++)l=l[a[s]];l(n);var h="";return h}catch(t){return}},e}(AVM1Object),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var stringify_1=createCommonjsModule((function(t,e){function i(t,e){var i=[],r=[];return null==e&&(e=function(t,e){return i[0]===e?"[Circular ~]":"[Circular ~."+r.slice(0,i.indexOf(e)).join(".")+"]"}),function(n,o){if(i.length>0){var s=i.indexOf(this);~s?i.splice(s+1):i.push(this),~s?r.splice(s,1/0,n):r.push(n),~i.indexOf(o)&&(o=e.call(this,n,o))}else i.push(o);return null==t?o:t.call(this,n,o)}}(t.exports=function(t,e,r,n){return JSON.stringify(t,i(e,n),r)}).getSerialize=i})),stringify_2=stringify_1.getSerialize,Mash=function(){var t=4022871197;return function(e){if(e){e=e.toString();for(var i=0;i<e.length;i++){var r=.02519603282416938*(t+=e.charCodeAt(i));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)}t=4022871197}},uheprng=function(t){return function(){var e,i,r=48,n=1,o=r,s=new Array(r),a=0,l=new Mash;for(e=0;e<r;e++)s[e]=l(Math.random());var h=function(){++o>=r&&(o=0);var t=1768863*s[o]+2.3283064365386963e-10*n;return s[o]=t-(n=0|t)},c=function(t){return Math.floor(t*(h()+11102230246251565e-32*(2097152*h()|0)))};c.string=function(t){var e,i="";for(e=0;e<t;e++)i+=String.fromCharCode(33+c(94));return i};var u=function(){var t=Array.prototype.slice.call(arguments);for(e=0;e<t.length;e++)for(i=0;i<r;i++)s[i]-=l(t[e]),s[i]<0&&(s[i]+=1)};return c.cleanString=function(t){return t=(t=(t=t.replace(/(^\s*)|(\s*$)/gi,"")).replace(/[\x00-\x1F]/gi,"")).replace(/\n /,"\n")},c.hashString=function(t){for(t=c.cleanString(t),l(t),e=0;e<t.length;e++)for(a=t.charCodeAt(e),i=0;i<r;i++)s[i]-=l(a),s[i]<0&&(s[i]+=1)},c.seed=function(t){null==t&&(t=Math.random()),"string"!=typeof t&&(t=stringify_1(t,(function(t,e){return"function"==typeof e?e.toString():e}))),c.initState(),c.hashString(t)},c.addEntropy=function(){var t=[];for(e=0;e<arguments.length;e++)t.push(arguments[e]);u(a+++(new Date).getTime()+t.join("")+Math.random())},c.initState=function(){for(l(),e=0;e<r;e++)s[e]=l(" ");n=1,o=r},c.done=function(){l=null},void 0!==t&&c.seed(t),c.range=function(t){return c(t)},c.random=function(){return c(Number.MAX_VALUE-1)/Number.MAX_VALUE},c.floatBetween=function(t,e){return c.random()*(e-t)+t},c.intBetween=function(t,e){return Math.floor(c.random()*(e-t+1))+t},c}()};uheprng.create=function(t){return new uheprng(t)};var randomSeed=uheprng,randomSeed_1=randomSeed.create,AVM1Selection=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.url="",e.targetMC=null,e._queued_focus_value=null,e._queued_focus=!1,e.callbackName="",e.callbackTarget=null,e}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["addListener","getFocus","getBeginIndex","getEndIndex","removeListener","setFocus","setSelection","getCaretIndex"],null,e.prototype.avm1Constructor)},e.prototype.avm1Constructor=function(t,e){this.url=t,this.targetMC=e,this._queued_focus=!1},e.prototype.addListener=function(t){notImplemented("AVM1Selection.addListener")},e.prototype.removeListener=function(t){return notImplemented("AVM1Selection.removeListener"),!0},e.prototype.getBeginIndex=function(){var t=MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.renderer.view)).getFocus();return t&&t.isAsset(TextField)?t.selectionBeginIndex:-1},e.prototype.getEndIndex=function(){var t=MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).getFocus();return t&&t.isAsset(TextField)?t.selectionEndIndex:-1},e.prototype.getCaretIndex=function(){var t=MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).getFocus();return t&&t.isAsset(TextField)?t.selectionBeginIndex:-1},e.prototype.getFocus=function(){var t=MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).getFocus();if(t){for(var e=[];t;)t.isAVMScene?t=null:(e.push(t.name),t=t.parent);for(var i=e.length,r="";i>0;)r+=e[--i],i>0&&(r+=".");return r}return""},e.prototype.setFocus=function(t){var e;if(""!==t)return"string"==typeof t?(e=this.context.resolveTarget(t))&&e.adaptee?void MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).setFocus(e.adaptee):(e=this.context.resolveTarget(t+"_internal_TF"))&&e.adaptee?void MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).setFocus(e.adaptee):void warning("AVM1Selection.setFocus - no object found for string "+t):((e=this.context.resolveTarget(t))&&e.adaptee?MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).setFocus(e.adaptee):warning("AVM1Selection.setFocus - no object found '"+t.toString()+"'"),!0)},e.prototype.setSelection=function(t,e){var i=MouseManager.getInstance(PickGroup.getInstance(this.context.globals.Stage._awayAVMStage.scene.view)).getFocus();i&&i.isAsset(TextField)&&i.setSelection(t,e)},e}(AVM1Object),_escape=jsGlobal.escape,_internalTimeouts=[],AVM1MatrixFunction$1=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(AVM1Object),TraceLevel=function(){function t(){}return t.ALL="all",t.NONE="none",t.IMPORTANT="important",t}(),AVM1Globals=function(t){function e(e){var i=t.call(this,e)||this;i.NaN=Number.NaN,i.Infinity=Number.POSITIVE_INFINITY,i.undefined=void 0,i._initBuiltins(e);e.loaderInfo.swfVersion;return i._initializeFlashObject(e),i}return __extends(e,t),e.setRandom=function(t){void 0===t&&(t=null),e.randomProvider=t?randomSeed_1(t):null},e.registerCustomClass=function(t,i){e._registeredCustomClasses[t]=i,e.instance&&e.instance.alPut(t,i)},e.registerCustomClassInstance=function(t,i){e._registeredCustomClassInstances[t]=i,e.instance&&e.instance.alPut(t,i)},e.createGlobalsObject=function(t){var i=new e(t);return wrapAVM1NativeMembers(t,i,i,["flash","ASSetPropFlags","BitmapData","clearInterval","clearTimeout","ExternalInterface","escape","unescape","setInterval","setTimeout","showRedrawRegions","trace","updateAfterEvent","myName","NaN","Infinity","isFinite","isNaN","parseFloat","parseInt","undefined","Object","Function","Array","Number","Math","Boolean","Date","Selection","String","Error","MovieClip","AsBroadcaster","System","Stage","Button","TextField","Color","Key","Mouse","MovieClipLoader","XML","XMLNode","LoadVars","Sound","SharedObject","ContextMenu","ContextMenuItem","TextFormat"],!1),e.instance=i,i},e.prototype.ASSetPropFlags=function(t,e,i,r){},e.prototype.clearIntervals=function(){var t=0,e=_internalTimeouts.length;for(t=0;t<e;t++)FrameScriptManager.clearInterval(_internalTimeouts[t]);_internalTimeouts.length=0},e.prototype.clearInterval=function(t){var e=_internalTimeouts[t-1];e&&(FrameScriptManager.clearInterval(e),delete _internalTimeouts[t-1])},e.prototype.clearTimeout=function(t){var e=_internalTimeouts[t-1];e&&(FrameScriptManager.clearTimeout(e),delete _internalTimeouts[t-1])},e.prototype.escape=function(t){return encodeURIComponent(t).replace(/!|'|\(|\)|\*|-|\.|_|~/g,(function(t){switch(t){case"*":return"%2A";case"-":return"%2D";case".":return"%2E";case"_":return"%5F";default:return _escape(t)}}))},e.prototype.unescape=function(t){return decodeURIComponent(t)},e.prototype.setInterval=function(){if(!(arguments.length<2)){var t,e=this.context,i=alToInteger(e,arguments[1]),r=2;if(alIsFunction(arguments[0]))t=arguments[0].toJSFunction();else{if(arguments.length<3)return;var n=arguments[0],o=arguments[1];if(i=alToInteger(e,arguments[2]),r=3,!(n instanceof AVM1Object)||"string"!=typeof o)return;t=function(){var t=n.alGet(o);if(alIsFunction(t)){var i=Array.prototype.slice.call(arguments,0);e.executeFunction(t,n,i)}}}for(var s,a=[],l=arguments.length,h=r;h<l;h++)a.push(arguments[h]);if(t){var c=function(){t.apply(null,a)};s=FrameScriptManager.setInterval(c,i)}return _internalTimeouts.push(s)}},e.prototype.setTimeout=function(){if(!(arguments.length<2)&&alIsFunction(arguments[0])){for(var t=arguments[0].toJSFunction(),e=alToInteger(this.context,arguments[1]),i=[],r=arguments.length,n=2;n<r;n++)i.push(arguments[n]);var o=function(){t.apply(null,i)},s=FrameScriptManager.setTimeOut(o,e);return _internalTimeouts.push(s)}},e.prototype.showRedrawRegions=function(t,e){notImplemented("AVM1Globals.showRedrawRegions")},e.prototype.trace=function(t){this&&this.context.actions.trace(t)},e.prototype.updateAfterEvent=function(){notImplemented("AVM1Globals.updateAfterEvent")},e.prototype.isFinite=function(t){return isFinite(alToNumber(this.context,t))},e.prototype.isNaN=function(t){return" "===t||isNaN(alToNumber(this.context,t))},e.prototype.parseFloat=function(t){return parseFloat(alToString(this.context,t))},e.prototype.parseInt=function(t,e){return parseInt(alToString(this.context,t),alToInt32(this.context,e))},e.prototype._initBuiltins=function(t){var i=t.builtins;for(var r in this.Object=i.Object,this.Function=i.Function,this.Array=i.Array,this.Number=i.Number,this.Math=i.Math,this.Boolean=i.Boolean,this.Date=i.Date,this.String=i.String,this.Error=i.Error,this.Selection=AVM1Selection.createAVM1Class(t)._ownProperties.prototype.value,this.ExternalInterface=AVM1ExternalInterface.createAVM1Class(t),this.MovieClip=AVM1MovieClip.createAVM1Class(t),this.AsBroadcaster=AVM1Broadcaster.createAVM1Class(t),this.System=AVM1System.createAVM1Class(t),this.Stage=AVM1Stage.createAVM1Class(t),this.Button=AVM1Button.createAVM1Class(t),this.TextField=AVM1TextField.createAVM1Class(t),this.Color=AVM1Color.createAVM1Class(t),this.Key=AVM1Key.createAVM1Class(t),this.Mouse=AVM1Mouse.createAVM1Class(t),this.MovieClipLoader=AVM1MovieClipLoader.createAVM1Class(t),this.LoadVars=new AVM1LoadVarsFunction(t),this.Sound=AVM1Sound.createAVM1Class(t),this.SharedObject=AVM1SharedObject.createAVM1Class(t),this.ContextMenu=void 0,this.ContextMenuItem=void 0,this.TextFormat=AVM1TextFormat.createAVM1Class(t),this.XMLNode=new AVM1XMLNodeFunction(t),this.XML=new AVM1XMLFunction(t,this.XMLNode),this.BitmapData=AVM1BitmapData.createAVM1Class(t),this.Matrix=new AVM1MatrixFunction$1(t),this.Point=new AVM1PointFunction(t),this.Rectangle=new AVM1RectangleFunction(t),this.Transform=AVM1Transform.createAVM1Class(t),this.ColorTransform=new AVM1ColorTransformFunction(t),AVM1Broadcaster.initialize(t,this.Stage),AVM1Broadcaster.initialize(t,this.Key),AVM1Broadcaster.initialize(t,this.Mouse),e._registeredCustomClasses)this.alPut(r,e._registeredCustomClasses[r]);for(var r in e._registeredCustomClassInstances)this.alPut(r,e._registeredCustomClassInstances[r])},e.prototype._initializeFlashObject=function(t){this.flash=alNewObject(t);var e=alNewObject(t);e.alPut("BitmapData",this.BitmapData),this.flash.alPut("display",e);var i=alNewObject(t);i.alPut("ExternalInterface",AVM1ExternalInterface.createAVM1Class(t)),this.flash.alPut("external",i);var r=createFiltersClasses(t);this.flash.alPut("filters",r),this.filters=r;var n=alNewObject(t);n.alPut("ColorTransform",this.ColorTransform),n.alPut("Matrix",this.Matrix),n.alPut("Point",this.Point),n.alPut("Rectangle",this.Rectangle),n.alPut("Transform",this.Transform),this.flash.alPut("geom",n);var o=alNewObject(t);this.flash.alPut("text",o)},e._registeredCustomClasses={},e._registeredCustomClassInstances={},e.tracelevel=TraceLevel.NONE,e.toStringPrecision=-1,e}(AVM1Object),AVM1NativeActions=function(){function t(t){this.context=t}return t.prototype.asfunction=function(t){notImplemented("AVM1NativeActions.$asfunction")},t.prototype.call=function(t){this.context.resolveTarget(null)._callFrame(t)},t.prototype.chr=function(t){return t=alToInteger(this.context,t),this.context.swfVersion<=5&&(t&=255),t?String.fromCharCode(t):""},t.prototype.duplicateMovieClip=function(t,e,i){var r=alCoerceNumber(this.context,i)-DEPTH_OFFSET;this.context.resolveTarget(t).duplicateMovieClip(e,r,null)},t.prototype.fscommand=function(t,e){return somewhatImplemented("AVM1NativeActions.fscommand"),this.context.sec.flash.system.fscommand.axCall(null,this.context.sec,t,e)},t.prototype.getTimer=function(){return(new Date).getTime()-AVM1Globals.lessonStartTime},t.prototype.getURL=function(t,e,i){var r=this.context.sec,n=new URLRequest(String(t));i&&(n.method=i),"string"!=typeof e||0!==e.indexOf("_level")?FlashNetScript_navigateToURL(r,n,e):this.loadMovieNum(t,+e.substr(6),i)},t.prototype.gotoAndPlay=function(t,e){var i=this.context.resolveTarget(null);i.adaptee.play(),this._gotoFrame(i.adaptee,t,e)},t.prototype.gotoAndStop=function(t,e){var i=this.context.resolveTarget(null);"number"==typeof e&&e<=0||(i.adaptee.stop(),this._gotoFrame(i.adaptee,t,e))},t.prototype._gotoFrame=function(t,e,i){if(Array.isArray(e)){if(0==e.length)return;e=e[0]}if(e instanceof AVM1ArrayNative){if(!e.value||0==e.value.length)return;e=e.value[0]}if("number"==typeof e&&e%1!=0&&(e=e.toString()),"string"==typeof e){if(null===t.timeline._labels[e.toLowerCase()])return e=parseInt(e),void(isNaN(e)||(t.currentFrameIndex=e-1));t.jumpToLabel(e.toLowerCase(),i)}else t.currentFrameIndex=e-1},t.prototype.ifFrameLoaded=function(t,e){var i=this.context.resolveTarget(null),r=arguments.length<2?arguments[0]:arguments[1],n=i.alGet("_framesloaded"),o=i.alGet("_totalframes");return Math.min(r+1,o)<=n},t.prototype.length_=function(t){return(""+t).length},t.prototype.loadMovie=function(t,e,i){if(t&&0===t.toLowerCase().indexOf("fscommand:"))this.fscommand(t.substring("fscommand:".length),e);else{var r,n="string"==typeof e&&0===e.indexOf("_level");if(n){var o=e.substr(6);n=(r=parseInt(o,10)).toString()===o}if(n)this.loadMovieNum(t,r,i);else this.context.resolveTarget(e).loadMovie(t,i)}},t.prototype.loadMovieNum=function(t,e,i){notImplemented("AVM1NativeActions.loadMovieNum")},t.prototype.loadVariables=function(t,e,i){void 0===i&&(i=""),t=alCoerceString(this.context,t),i=alCoerceString(this.context,i);var r=this.context.resolveTarget(e);r&&this._loadVariables(r,t,i)},t.prototype.loadVariablesNum=function(t,e,i){void 0===i&&(i=""),t=alCoerceString(this.context,t),e=alToInteger(this.context,e),i=alCoerceString(this.context,i);var r=this.context.resolveLevel(e);r&&this._loadVariables(r,t,i)},t.prototype._loadVariables=function(t,e,i){var r=this.context,n=new URLRequest(e);i&&(n.method=i);var o=new URLLoader;o.dataFormat="variables";var s=r.sec.boxFunction((function(e){o.removeEventListener(URLLoaderEvent.LOAD_COMPLETE,s),t instanceof AVM1MovieClip&&avm1BroadcastEvent(r,t,"onData")}));o.addEventListener(URLLoaderEvent.LOAD_COMPLETE,s),o.load(n)},t.prototype.mbchr=function(t){return(t=alToInteger(this.context,t))?String.fromCharCode(t):""},t.prototype.mblength=function(t){return(""+t).length},t.prototype.mbord=function(t){return(""+t).charCodeAt(0)},t.prototype.mbsubstring=function(t,e,i){return e!==(0|e)||i!==(0|i)?"":(i<0&&(i=void 0),(""+t).substr(e=e<1?0:e-1,i))},t.prototype.nextFrame=function(){++getAwayJSAdaptee(this.context.resolveTarget(null)).currentFrameIndex},t.prototype.nextScene=function(){notImplemented("AVM1NativeActions.nextScene")},t.prototype.ord=function(t){return(""+t).charCodeAt(0)},t.prototype.play=function(){this.context.resolveTarget(null).play()},t.prototype.prevFrame=function(){var t=getAwayJSAdaptee(this.context.resolveTarget(null));--t.currentFrameIndex,t.stop()},t.prototype.prevScene=function(){notImplemented("AVM1NativeActions.prevScene")},t.prototype.print=function(t,e){notImplemented("AVM1NativeActions.print")},t.prototype.printAsBitmap=function(t,e){notImplemented("AVM1NativeActions.printAsBitmap")},t.prototype.printAsBitmapNum=function(t,e){notImplemented("AVM1NativeActions.printAsBitmapNum")},t.prototype.printNum=function(t,e){notImplemented("AVM1NativeActions.printNum")},t.prototype.random=function(t){return AVM1Globals.randomProvider?0|AVM1Globals.randomProvider.random()*(0|t):0|Math.random()*(0|t)},t.prototype.removeMovieClip=function(t){if(t){var e=this.context.resolveTarget(t);e?e.removeMovieClip():warning("AVM1NativeActions.removeMovieClip - target not found")}else warning("AVM1NativeActions.removeMovieClip - called for undefined")},t.prototype.startDrag=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.context.resolveTarget(t);r&&r.startDrag.apply(r,e)},t.prototype.stop=function(){this.context.resolveTarget(null).stop()},t.prototype.stopAllSounds=function(){AudioManager.stopAllSounds()},t.prototype.stopDrag=function(){AVM1MovieClip.currentDraggedMC&&AVM1MovieClip.currentDraggedMC.stopDrag()},t.prototype.substring=function(t,e,i){return this.mbsubstring(t,e,i)},t.prototype.toggleHighQuality=function(){notImplemented("AVM1NativeActions.toggleHighQuality")},t.prototype.trace=function(t){if(AVM1Globals.tracelevel!=TraceLevel.NONE){var e,i=!1;switch(typeof t){case"undefined":e="undefined";break;case"string":i=(e=t).length>0&&"!"==e[0];break;default:e=alToString(this.context,t)}(AVM1Globals.tracelevel!=TraceLevel.IMPORTANT||i)&&console.log("%cAVM1 trace: %c "+e+" ","color: #054996","background: #eee; color: #054996")}},t.prototype.unloadMovie=function(t){var e=this.context.resolveTarget(t);e?e.unloadMovie():warning("AVM1Globals.unloadMovie - target not found")},t.prototype.unloadMovieNum=function(t){0!==(t=alToInt32(this.context,t))?this.context.levelsContainer._removeRoot(t):notImplemented("unloadMovieNum at _level0")},t}(),AVM1ObjectPrototype=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype._initializePrototype=function(){alDefineObjectProperties(this,{constructor:{value:this.context.builtins.Object,writable:!0},valueOf:{value:this._valueOf,writable:!0},toString:{value:this._toString,writable:!0},addProperty:{value:this.addProperty},hasOwnProperty:{value:this.hasOwnProperty},isPropertyEnumerable:{value:this.isPropertyEnumerable},isPrototypeOf:{value:this.isPrototypeOf},unwatch:{value:this.unwatch},watch:{value:this.watch}})},e.prototype._valueOf=function(){return this},e.prototype._toString=function(){return alIsFunction(this)?"[type "+alGetObjectClass(this)+"]":"[object "+alGetObjectClass(this)+"]"},e.prototype.addProperty=function(t,e,i){if("string"!=typeof t||""===t)return!1;if(!alIsFunction(e))return!1;if(!alIsFunction(i)&&null!==i)return!1;var r=this.alGetOwnProperty(t);return!(r&&2&r.flags)&&(this.alSetOwnProperty(t,new AVM1PropertyDescriptor(128,null,e,i||void 0)),!0)},e.prototype.hasOwnProperty=function(t){return this.alHasOwnProperty(t)},e.prototype.isPropertyEnumerable=function(t){return!(1&this.alGetProperty(t).flags)},e.prototype.isPrototypeOf=function(t){return alInstanceOf(this.context,this,t)},e.prototype.unwatch=function(t){return t=alCoerceString(this.context,t),this.alRemotePropertyWatcher(t)},e.prototype.watch=function(t,e,i){return t=alCoerceString(this.context,t),!!alIsFunction(e)&&this.alAddPropertyWatcher(t,e,i)},e}(AVM1Object),AVM1ObjectFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:e.builtins.Object.alGetPrototypeProperty()},registerClass:{value:i.registerClass}}),i}return __extends(e,t),e.prototype.registerClass=function(t,e){this.context.registerClass(t,e)},e.prototype.alConstruct=function(t){if(t){var e=t[0];if(e instanceof AVM1Object)return e;switch(typeof e){case"string":case"boolean":case"number":return alToObject(this.context,e)}}return alNewObject(this.context)},e.prototype.alCall=function(t,e){return e&&null!==e[0]&&void 0!==e[0]?alToObject(this.context,e[0]):alNewObject(this.context)},e}(AVM1Function),AVM1FunctionPrototype=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype._initializePrototype=function(){var t=this.context;this.alPrototype=t.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(this,{constructor:{value:t.builtins.Function,writable:!0},call:this.call,apply:this.apply})},e.prototype.call=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=alEnsureType(this,AVM1Function);return r.alCall(t,e)},e.prototype.apply=function(t,e){var i=alEnsureType(this,AVM1Function),r=e?alEnsureType(e,AVM1ArrayNative).value:void 0;return i.alCall(t,r)},e}(AVM1Object),AVM1FunctionFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:e.builtins.Function.alGetPrototypeProperty()}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){return t?t[0]:void 0},e.prototype.alCall=function(t,e){return e?e[0]:void 0},e}(AVM1Function),AVM1BooleanNative=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Boolean.alGetPrototypeProperty(),r.alSetOwnConstructorProperty(e.builtins.Boolean),r.value=i,r}return __extends(e,t),e.prototype.valueOf=function(){return this.value},e}(AVM1Object),AVM1BooleanPrototype=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{constructor:{value:e.builtins.Boolean,writable:!0},valueOf:{value:i._valueOf,writable:!0},toString:{value:i._toString,writable:!0}}),i}return __extends(e,t),e.prototype._valueOf=function(){return alEnsureType(this,AVM1BooleanNative).value},e.prototype._toString=function(){return alEnsureType(this,AVM1BooleanNative).value?"true":"false"},e}(AVM1Object),AVM1BooleanFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:new AVM1BooleanPrototype(e)}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=!!t&&alToBoolean(this.context,t[0]);return new AVM1BooleanNative(this.context,e)},e.prototype.alCall=function(t,e){return!!e&&alToBoolean(this.context,e[0])},e}(AVM1Function),AVM1NumberNative=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Number.alGetPrototypeProperty(),r.alSetOwnConstructorProperty(e.builtins.Number),r.value=i,r}return __extends(e,t),e.prototype.valueOf=function(){return this.value},e}(AVM1Object),AVM1NumberPrototype=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{constructor:{value:e.builtins.Number,writable:!0},valueOf:{value:i._valueOf,writable:!0},toString:{value:i._toString,writable:!0}}),i}return __extends(e,t),e.prototype._valueOf=function(){return alEnsureType(this,AVM1NumberNative).value},e.prototype._toString=function(t){return alEnsureType(this,AVM1NumberNative).value.toString(t||10)},e}(AVM1Object),AVM1NumberFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:new AVM1NumberPrototype(e)},MAX_VALUE:Number.MAX_VALUE,MIN_VALUE:Number.MIN_VALUE,NaN:Number.NaN,NEGATIVE_INFINITY:Number.NEGATIVE_INFINITY,POSITIVE_INFINITY:Number.POSITIVE_INFINITY}),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=t?alToNumber(this.context,t[0]):0;return new AVM1NumberNative(this.context,e)},e.prototype.alCall=function(t,e){return e?alToNumber(this.context,e[0]):0},e}(AVM1Function),AVM1StringNative=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.String.alGetPrototypeProperty(),r.alSetOwnConstructorProperty(e.builtins.String),r.value=i,r}return __extends(e,t),e.prototype.toString=function(){return this.value},e}(AVM1Object),AVM1StringPrototype=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{constructor:{value:e.builtins.String,writable:!0},valueOf:{value:i._valueOf,writable:!0},toString:{value:i._toString,writable:!0},length:{get:i.getLength},charAt:{value:i.charAt,writable:!0},charCodeAt:{value:i.charCodeAt,writable:!0},concat:{value:i.concat,writable:!0},indexOf:{value:i.indexOf,writable:!0},lastIndexOf:{value:i.lastIndexOf,writable:!0},slice:{value:i.slice,writable:!0},split:{value:i.split,writable:!0},substr:{value:i.substr,writable:!0},substring:{value:i.substring,writable:!0},toLowerCase:{value:i.toLowerCase,writable:!0},toUpperCase:{value:i.toUpperCase,writable:!0}}),i}return __extends(e,t),e.prototype._valueOf=function(){return alEnsureType(this,AVM1StringNative).value},e.prototype._toString=function(){return alEnsureType(this,AVM1StringNative).value},e.prototype.getLength=function(){return alEnsureType(this,AVM1StringNative).value.length},e.prototype.charAt=function(t){return alToString(this.context,this).charAt(alToInteger(this.context,t))},e.prototype.charCodeAt=function(t){return alToString(this.context,this).charCodeAt(alToInteger(this.context,t))},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=[alToString(this.context,this)],r=0;r<t.length;++r)i.push(alToString(this.context,t[r]));return i.join("")},e.prototype.indexOf=function(t,e){var i=alToString(this.context,this);return t=alToString(this.context,t),e=alToInteger(this.context,e),i.indexOf(t,e)},e.prototype.lastIndexOf=function(t,e){var i=alToString(this.context,this);return t=alToString(this.context,t),(e=arguments.length<2?NaN:alToNumber(this.context,e))<0?-1:i.lastIndexOf(t,isNaN(e)?void 0:e)},e.prototype.slice=function(t,e){if(0!==arguments.length){var i=alToString(this.context,this);return t=alToInteger(this.context,t),e=void 0===e?void 0:alToInteger(this.context,e),i.slice(t,e)}},e.prototype.split=function(t,e){var i=alToString(this.context,this);return void 0!==t?(t=alToString(this.context,t),e=(void 0===e?-1:alToInt32(this.context,e))>>>0,new AVM1ArrayNative(this.context,i.split(t,e))):new AVM1ArrayNative(this.context,[i])},e.prototype.substr=function(t,e){var i=alToString(this.context,this),r=i.length;if(t=alToInteger(this.context,t),e=void 0===e?r:alToInteger(this.context,e),t<0&&(t=Math.max(0,r+t)),e<0){if(-e<=t)return"";e=Math.max(0,r+e)}return i.substr(t,e)},e.prototype.substring=function(t,e){var i=alToString(this.context,this);return(t=alToInteger(this.context,t))>=i.length?"":(e=void 0===e?void 0:alToInteger(this.context,e),i.substring(t,e))},e.prototype.toLowerCase=function(){return alToString(this.context,this).toLowerCase()},e.prototype.toUpperCase=function(){return alToString(this.context,this).toUpperCase()},e}(AVM1Object),AVM1StringFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:new AVM1StringPrototype(e)},fromCharCode:{value:i.fromCharCode}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=t?alToString(this.context,t[0]):"";return new AVM1StringNative(this.context,e)},e.prototype.alCall=function(t,e){return e?alToString(this.context,e[0]):""},e.prototype.fromCharCode=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e=e.map((function(e){return 65535&alToInt32(t.context,e)})),String.fromCharCode.apply(String,e)},e}(AVM1Function),cachedArrayPropertyDescriptor=new AVM1PropertyDescriptor(64,void 0),AVM1ArrayNative=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Array.alGetPrototypeProperty(),r.alSetOwnConstructorProperty(e.builtins.Array),r.value=i,r}return __extends(e,t),e.prototype.alGetOwnProperty=function(e){if(alIsIndex(this.context,e)){var i=alToInt32(this.context,e);if(Object.getOwnPropertyDescriptor(this.value,i))return cachedArrayPropertyDescriptor.value=this.value[i],cachedArrayPropertyDescriptor}return t.prototype.alGetOwnProperty.call(this,e)},e.prototype.alSetOwnProperty=function(e,i){if(alIsIndex(this.context,e)){var r=alToInt32(this.context,e);if(!(64&i.flags)||1&i.flags||2&i.flags)throw new Error("Special property is non-supported for array");this.value[r]=i.value}else t.prototype.alSetOwnProperty.call(this,e,i)},e.prototype.alDeleteOwnProperty=function(e){if(alIsIndex(this.context,e)){var i=alToInt32(this.context,e);delete this.value[i]}else t.prototype.alDeleteOwnProperty.call(this,e)},e.prototype.alGetOwnPropertiesKeys=function(){var e=t.prototype.alGetOwnPropertiesKeys.call(this),i=[];for(var r in this.value)i.push(r);return i.concat(e)},e.mapToJSArray=function(t,i,r){if(t instanceof e)return t.value.map(i,r);if(!alIsArrayLike(t.context,t))throw new Error("Invalid type");var n=[];return alIterateArray(t.context,t,(function(t,e){n.push(i.call(r,t,e))})),n},e}(AVM1Object),AVM1ArraySortOnOptions;!function(t){t[t.CASEINSENSITIVE=1]="CASEINSENSITIVE",t[t.DESCENDING=2]="DESCENDING",t[t.UNIQUESORT=4]="UNIQUESORT",t[t.RETURNINDEXEDARRAY=8]="RETURNINDEXEDARRAY",t[t.NUMERIC=16]="NUMERIC"}(AVM1ArraySortOnOptions||(AVM1ArraySortOnOptions={}));var sortArray=function(t,e){var i=alEnsureType(t,AVM1ArrayNative).value;if(alIsFunction(e)){var r=[void 0,void 0];i.sort((function(t,i){return r[0]=t,r[1]=i,e.alCall(null,r)}))}else{var n="number"==typeof e&&(e&AVM1ArraySortOnOptions.NUMERIC||-1==e),o="number"==typeof e&&e&AVM1ArraySortOnOptions.DESCENDING;if(n)i.sort((function(t,e){for(;t instanceof AVM1ArrayNative;)(t=alEnsureType(t,AVM1ArrayNative).value)&&t.length>0&&(t=t[0]);for(;e instanceof AVM1ArrayNative;)(e=alEnsureType(e,AVM1ArrayNative).value)&&e.length>0&&(e=e[0]);return t-e}));else{for(var s=i.length;s>0;)void 0!==i[--s]&&null!==i[s]||(i[s]="00000000000AwayInternal");for(i.sort((function(t,e){for(;t instanceof AVM1ArrayNative;)(t=alEnsureType(t,AVM1ArrayNative).value)&&t.length>0&&(t=t[0]);for(;e instanceof AVM1ArrayNative;)(e=alEnsureType(e,AVM1ArrayNative).value)&&e.length>0&&(e=e[0]);return t<e?-1:1})),s=i.length;s>0;)"00000000000AwayInternal"==i[--s]&&(i[s]=void 0)}o&&i.reverse()}return t},AVM1ArrayPrototype=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{constructor:{value:e.builtins.Array,writable:!0},join:{value:i.join,writable:!0},length:{get:i.getLength,set:i.setLength},concat:{value:i.concat,writable:!0},pop:{value:i.pop,writable:!0},push:{value:i.push,writable:!0},reverse:{value:i.reverse,writable:!0},shift:{value:i.shift,writable:!0},slice:{value:i.slice,writable:!0},splice:{value:i.splice,writable:!0},sort:{value:i.sort,writable:!0},sortOn:{value:i.sortOn,writable:!0},toString:{value:i._toString,writable:!0},unshift:{value:i.unshift,writable:!0}}),i}return __extends(e,t),e.prototype._toString=function(){var t,e=this.alGet("length"),i=0,r="";for(i=0;i<e;i++)r+=void 0!==(t=this.alGet(i))?alToString(this.context,t)+(i==e-1?"":","):i==e-1?"":",";return r},e.prototype.getLength=function(){return alEnsureType(this,AVM1ArrayNative).value.length},e.prototype.setLength=function(t){(null===t&&(t=0),isIndex(t))&&(t=alToInt32(this.context,t)>>>0,alEnsureType(this,AVM1ArrayNative).value.length=t)},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this instanceof AVM1ArrayNative){for(var i=alEnsureType(this,AVM1ArrayNative).value,r=0;r<t.length;r++)t[r]instanceof AVM1ArrayNative&&(t[r]=alEnsureType(t[r],AVM1ArrayNative).value);return new AVM1ArrayNative(this.context,Array.prototype.concat.apply(i,t))}var n=[],o=this,s=alIsArrayLike(this.context,this);for(r=0;s?alIterateArray(this.context,o,(function(t){return n.push(t)})):n.push(alToString(this.context,o)),!(r>=t.length);)o=t[r++],s=alIsArray(this.context,o);return new AVM1ArrayNative(this.context,n)},e.prototype.join=function(t){if(t=void 0===t?",":alCoerceString(this.context,t),this instanceof AVM1ArrayNative){var e=alEnsureType(this,AVM1ArrayNative).value;if(0===e.length)return"";if(e.every((function(t){return!(t instanceof AVM1Object)})))return e.join(t)}var i=this.context,r=alToInt32(i,this.alGet("length"))>>>0;if(0===r)return"";for(var n=[],o=0;o<r;o++){var s=this.alGet(o);n[o]=null==s?"":alCoerceString(i,s)}return n.join(t)},e.prototype.pop=function(){if(this instanceof AVM1ArrayNative)return alEnsureType(this,AVM1ArrayNative).value.pop();var t=alToInt32(this.context,this.alGet("length"))>>>0;if(0!==t){var e=t-1,i=this.alGet(e);return this.alDeleteProperty(e),this.alPut("length",e),i}},e.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this instanceof AVM1ArrayNative){var i=alEnsureType(this,AVM1ArrayNative).value;return Array.prototype.push.apply(i,t)}for(var r=alToInt32(this.context,this.alGet("length"))>>>0,n=0;n<t.length;n++)this.alPut(r,t[n]),r++;return this.alPut("length",r),r},e.prototype.reverse=function(){var t=[],e=this.alGet("length"),i=0;for(i=0;i<e;i++)t[i]=this.alGet(i);for(i=e-1;i>=0;)this.alPut(e-1-i,t[i]),i--;return this.value},e.prototype.shift=function(){if(this instanceof AVM1ArrayNative)return alEnsureType(this,AVM1ArrayNative).value.shift();var t=alToInt32(this.context,this.alGet("length"))>>>0;if(0!==t){for(var e=this.alGet(0),i=1;i<t;i++)this.alHasProperty(i)?this.alPut(i-1,this.alGet(i)):this.alDeleteProperty(i-1);return this.alDeleteProperty(t-1),this.alPut("length",t-1),e}},e.prototype.slice=function(t,e){if(t=alToInteger(this.context,t),e=void 0!==e?alToInteger(this.context,e):void 0,this instanceof AVM1ArrayNative){var i=alEnsureType(this,AVM1ArrayNative).value;return new AVM1ArrayNative(this.context,i.slice(t,e))}var r=[],n=alToInt32(this.context,this.alGet("length"))>>>0;t=t<0?Math.max(n+t,0):Math.min(n,t),e=void 0===e?n:e<0?Math.max(n+e,0):Math.min(n,e);for(var o=t,s=0;o<e;o++,s++)this.alHasProperty(o)&&(r[s]=this.alGet(o));return new AVM1ArrayNative(this.context,r)},e.prototype.splice=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];t=alToInteger(this.context,t);var n=alToInt32(this.context,this.alGet("length"))>>>0;if(t=t<0?Math.max(n+t,0):Math.min(n,t),e=e||"number"==typeof e?alToInteger(this.context,e):n-t,this instanceof AVM1ArrayNative){var o=alEnsureType(this,AVM1ArrayNative).value;return new AVM1ArrayNative(this.context,Array.prototype.splice.apply(o,[t,e].concat(i)))}for(var s=[],a=0;a<e;a++)this.alHasProperty(t+a)&&(s[a]=this.alGet(t+a));var l=i.length-e;if(l<0){for(a=t-l;a<n;a++)this.alHasProperty(a)?this.alPut(a+l,this.alGet(a)):this.alDeleteProperty(a+l);for(a=l;a<0;a++)this.alDeleteProperty(n+a)}else if(l>0)for(a=n-1;a>=t+l;a--)this.alHasProperty(a)?this.alPut(a+l,this.alGet(a)):this.alDeleteProperty(a+l);for(a=0;a<i.length;a++)this.alPut(t+a,i[a]);return this.alPut("length",n+l),new AVM1ArrayNative(this.context,s)},e.prototype.sort=function(t){return sortArray(this,t)},e.prototype.sortOn=function(t,e){var i=this.context,r=[],n=[];if(alIsString(i,t))r=[alToString(i,t)],n=[alToInt32(i,e)];else{if(!alIsArray(i,t))return sortArray(this,e);r=[],n=[];var o=alIsArray(i,e)?e:null,s=alToInteger(i,t.alGet("length"));o&&s!==alToInteger(i,o.alGet("length"))&&(o=null);for(var a=0;a<s;a++)r.push(alToString(i,t.alGet(a))),n.push(o?alToInt32(i,o.alGet(a)):0)}n[0];return alEnsureType(this,AVM1ArrayNative).value.sort((function(t,e){for(;t instanceof AVM1ArrayNative;)(t=alEnsureType(t,AVM1ArrayNative).value)&&t.length>0&&(t=t[0]);for(;e instanceof AVM1ArrayNative;)(e=alEnsureType(e,AVM1ArrayNative).value)&&e.length>0&&(e=e[0]);for(var o=alToObject(i,t),s=alToObject(i,e),a=0;a<r.length;a++){var l,h=o.alGet(r[a]),c=s.alGet(r[a]);if(n[a]&AVM1ArraySortOnOptions.NUMERIC){var u=alToNumber(i,h),p=alToNumber(i,c);l=u<p?-1:u>p?1:0}else{var d=alToString(i,h),f=alToString(i,c);n[a]&AVM1ArraySortOnOptions.CASEINSENSITIVE&&(d=d.toLowerCase(),f=f.toLowerCase()),l=d<f?-1:d>f?1:0}if(0!==l)return n[a]&AVM1ArraySortOnOptions.DESCENDING?-l:l}return 0})),this},e.prototype.unshift=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this instanceof AVM1ArrayNative){var i=alEnsureType(this,AVM1ArrayNative).value;return Array.prototype.unshift.apply(i,t)}for(var r=alToInt32(this.context,this.alGet("length"))>>>0,n=t.length,o=r-1;o>=0;o--)this.alHasProperty(o)?this.alPut(o+n,this.alGet(o)):this.alDeleteProperty(o+n);for(o=0;o<t.length;o++)this.alPut(o,t[o]);return r+=n,this.alPut("length",r),r},e}(AVM1Object),AVM1ArrayFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:new AVM1ArrayPrototype(e)}}),alDefineObjectProperties(i,{NUMERIC:{value:AVM1ArraySortOnOptions.NUMERIC}}),alDefineObjectProperties(i,{DESCENDING:{value:AVM1ArraySortOnOptions.DESCENDING}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){if(!t)return new AVM1ArrayNative(this.context,[]);if(1===t.length&&"number"==typeof t[0]){var e=t[0];if(e>>>0!==e)throw new Error("Range error");return new AVM1ArrayNative(this.context,new Array(e))}return new AVM1ArrayNative(this.context,t)},e.prototype.alCall=function(t,e){return this.alConstruct.apply(this,e)},e}(AVM1Function),AVM1MathObject=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{E:Math.E,LN10:Math.LN10,LN2:Math.LN2,LOG10E:Math.LOG10E,LOG2E:Math.LOG2E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,abs:i.abs,acos:i.acos,asin:i.asin,atan:i.atan,atan2:i.atan2,ceil:i.ceil,cos:i.cos,exp:i.exp,floor:i.floor,log:i.log,max:i.max,min:i.min,pow:i.pow,random:i.random,round:i.round,sin:i.sin,sqrt:i.sqrt,tan:i.tan}),i}return __extends(e,t),e.prototype.abs=function(t){return Math.abs(alToNumber(this.context,t))},e.prototype.acos=function(t){return Math.acos(alToNumber(this.context,t))},e.prototype.asin=function(t){return Math.asin(alToNumber(this.context,t))},e.prototype.atan=function(t){return Math.atan(alToNumber(this.context,t))},e.prototype.atan2=function(t,e){return Math.atan2(alToNumber(this.context,t),alToNumber(this.context,e))},e.prototype.ceil=function(t){return Math.ceil(alToNumber(this.context,t))},e.prototype.cos=function(t){return Math.cos(alToNumber(this.context,t))},e.prototype.exp=function(t){return Math.exp(alToNumber(this.context,t))},e.prototype.floor=function(t){return Math.floor(alToNumber(this.context,t))},e.prototype.log=function(t){return Math.log(alToNumber(this.context,t))},e.prototype.max=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e=e.map((function(e){return alToNumber(t.context,e)})),Math.max.apply(null,e)},e.prototype.min=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e=e.map((function(e){return alToNumber(t.context,e)})),Math.min.apply(null,e)},e.prototype.pow=function(t,e){return Math.pow(alToNumber(this.context,t),alToNumber(this.context,e))},e.prototype.random=function(){return AVM1Globals.randomProvider?AVM1Globals.randomProvider.random():Math.random()},e.prototype.round=function(t){return Math.round(alToNumber(this.context,t))},e.prototype.sin=function(t){return Math.sin(alToNumber(this.context,t))},e.prototype.sqrt=function(t){return Math.sqrt(alToNumber(this.context,t))},e.prototype.tan=function(t){return Math.tan(alToNumber(this.context,t))},e}(AVM1Object),AVM1DateNative=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Date.alGetPrototypeProperty(),r.alSetOwnConstructorProperty(e.builtins.Date),r.value=i,r}return __extends(e,t),e.prototype.alDefaultValue=function(e){return void 0!==e?t.prototype.alDefaultValue.call(this,e):this.context.swfVersion>=6?t.prototype.alDefaultValue.call(this,1):t.prototype.alDefaultValue.call(this,0)},e}(AVM1Object),AVM1DatePrototype=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{constructor:{value:e.builtins.Date,writable:!0},valueOf:{value:i._valueOf,writable:!0},toString:{value:i._toString,writable:!0},toLocaleString:{value:i._toLocaleString,writable:!0},toDateString:{value:i.toDateString,writable:!0},toTimeString:{value:i.toTimeString,writable:!0},toLocaleDateString:{value:i.toLocaleDateString,writable:!0},toLocaleTimeString:{value:i.toLocaleTimeString,writable:!0},getTime:{value:i.getTime,writable:!0},getFullYear:{value:i.getFullYear,writable:!0},getUTCFullYear:{value:i.getUTCFullYear,writable:!0},getMonth:{value:i.getMonth,writable:!0},getUTCMonth:{value:i.getUTCMonth,writable:!0},getDate:{value:i.getDate,writable:!0},getUTCDate:{value:i.getUTCDate,writable:!0},getDay:{value:i.getDay,writable:!0},getUTCDay:{value:i.getUTCDay,writable:!0},getHours:{value:i.getHours,writable:!0},getUTCHours:{value:i.getUTCHours,writable:!0},getMinutes:{value:i.getMinutes,writable:!0},getUTCMinutes:{value:i.getUTCMinutes,writable:!0},getSeconds:{value:i.getSeconds,writable:!0},getUTCSeconds:{value:i.getUTCSeconds,writable:!0},getMilliseconds:{value:i.getMilliseconds,writable:!0},getUTCMilliseconds:{value:i.getUTCMilliseconds,writable:!0},getTimezoneOffset:{value:i.getTimezoneOffset,writable:!0},setTime:{value:i.setTime,writable:!0},setMilliseconds:{value:i.setMilliseconds,writable:!0},setUTCMilliseconds:{value:i.setUTCMilliseconds,writable:!0},setSeconds:{value:i.setSeconds,writable:!0},setUTCSeconds:{value:i.setUTCSeconds,writable:!0},setMinutes:{value:i.setMinutes,writable:!0},setUTCMinutes:{value:i.setUTCMinutes,writable:!0},setHours:{value:i.setHours,writable:!0},setUTCHours:{value:i.setUTCHours,writable:!0},setDate:{value:i.setDate,writable:!0},setUTCDate:{value:i.setUTCDate,writable:!0},setMonth:{value:i.setMonth,writable:!0},setUTCMonth:{value:i.setUTCMonth,writable:!0},setFullYear:{value:i.setFullYear,writable:!0},setUTCFullYear:{value:i.setUTCFullYear,writable:!0},toUTCString:{value:i.toUTCString,writable:!0}}),i}return __extends(e,t),e.prototype._valueOf=function(){return alEnsureType(this,AVM1DateNative).value.valueOf()},e.prototype._toString=function(){return alEnsureType(this,AVM1DateNative).value.toString()},e.prototype._toLocaleString=function(){return alEnsureType(this,AVM1DateNative).value.toLocaleString()},e.prototype.toDateString=function(){return alEnsureType(this,AVM1DateNative).value.toDateString()},e.prototype.toTimeString=function(){return alEnsureType(this,AVM1DateNative).value.toTimeString()},e.prototype.toLocaleDateString=function(){return alEnsureType(this,AVM1DateNative).value.toLocaleDateString()},e.prototype.toLocaleTimeString=function(){return alEnsureType(this,AVM1DateNative).value.toLocaleTimeString()},e.prototype.getTime=function(){return alEnsureType(this,AVM1DateNative).value.getTime()},e.prototype.getFullYear=function(){return alEnsureType(this,AVM1DateNative).value.getFullYear()},e.prototype.getUTCFullYear=function(){return alEnsureType(this,AVM1DateNative).value.getUTCFullYear()},e.prototype.getMonth=function(){return alEnsureType(this,AVM1DateNative).value.getMonth()},e.prototype.getUTCMonth=function(){return alEnsureType(this,AVM1DateNative).value.getUTCMonth()},e.prototype.getDate=function(){return alEnsureType(this,AVM1DateNative).value.getDate()},e.prototype.getUTCDate=function(){return alEnsureType(this,AVM1DateNative).value.getUTCDate()},e.prototype.getDay=function(){return alEnsureType(this,AVM1DateNative).value.getDay()},e.prototype.getUTCDay=function(){return alEnsureType(this,AVM1DateNative).value.getUTCDay()},e.prototype.getHours=function(){return alEnsureType(this,AVM1DateNative).value.getHours()},e.prototype.getUTCHours=function(){return alEnsureType(this,AVM1DateNative).value.getUTCHours()},e.prototype.getMinutes=function(){return alEnsureType(this,AVM1DateNative).value.getMinutes()},e.prototype.getUTCMinutes=function(){return alEnsureType(this,AVM1DateNative).value.getUTCMinutes()},e.prototype.getSeconds=function(){return alEnsureType(this,AVM1DateNative).value.getSeconds()},e.prototype.getUTCSeconds=function(){return alEnsureType(this,AVM1DateNative).value.getUTCSeconds()},e.prototype.getMilliseconds=function(){return alEnsureType(this,AVM1DateNative).value.getMilliseconds()},e.prototype.getUTCMilliseconds=function(){return alEnsureType(this,AVM1DateNative).value.getUTCMilliseconds()},e.prototype.getTimezoneOffset=function(){return alEnsureType(this,AVM1DateNative).value.getTimezoneOffset()},e.prototype.setTime=function(t){return t=alToNumber(this.context,t),alEnsureType(this,AVM1DateNative).value.setTime(t)},e.prototype.setMilliseconds=function(t){return t=alToNumber(this.context,t),alEnsureType(this,AVM1DateNative).value.setMilliseconds(t)},e.prototype.setUTCMilliseconds=function(t){return t=alToNumber(this.context,t),alEnsureType(this,AVM1DateNative).value.setUTCMilliseconds(t)},e.prototype.setSeconds=function(t,e){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setSeconds(t):(e=alToNumber(this.context,e),alEnsureType(this,AVM1DateNative).value.setSeconds(t,e))},e.prototype.setUTCSeconds=function(t,e){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setUTCSeconds(t):(e=alToNumber(this.context,e),alEnsureType(this,AVM1DateNative).value.setUTCSeconds(t,e))},e.prototype.setMinutes=function(t,e,i){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setMinutes(t):(e=alToNumber(this.context,e),arguments.length<=2?alEnsureType(this,AVM1DateNative).value.setMinutes(t,e):(i=alToNumber(this.context,i),alEnsureType(this,AVM1DateNative).value.setMinutes(t,e,i)))},e.prototype.setUTCMinutes=function(t,e,i){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setUTCMinutes(t):(e=alToNumber(this.context,e),arguments.length<=2?alEnsureType(this,AVM1DateNative).value.setUTCMinutes(t,e):(i=alToNumber(this.context,i),alEnsureType(this,AVM1DateNative).value.setUTCMinutes(t,e,i)))},e.prototype.setHours=function(t,e,i,r){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setHours(t):(e=alToNumber(this.context,e),arguments.length<=2?alEnsureType(this,AVM1DateNative).value.setHours(t,e):(i=alToNumber(this.context,i),arguments.length<=3?alEnsureType(this,AVM1DateNative).value.setHours(t,e,i):(r=alToNumber(this.context,r),alEnsureType(this,AVM1DateNative).value.setHours(t,e,i,r))))},e.prototype.setUTCHours=function(t,e,i,r){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setUTCHours(t):(e=alToNumber(this.context,e),arguments.length<=2?alEnsureType(this,AVM1DateNative).value.setUTCHours(t,e):(i=alToNumber(this.context,i),arguments.length<=3?alEnsureType(this,AVM1DateNative).value.setUTCHours(t,e,i):(r=alToNumber(this.context,r),alEnsureType(this,AVM1DateNative).value.setUTCHours(t,e,i,r))))},e.prototype.setDate=function(t){return t=alToNumber(this.context,t),alEnsureType(this,AVM1DateNative).value.setDate(t)},e.prototype.setUTCDate=function(t){return t=alToNumber(this.context,t),alEnsureType(this,AVM1DateNative).value.setUTCDate(t)},e.prototype.setMonth=function(t,e){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setMonth(t):(e=alToNumber(this.context,e),alEnsureType(this,AVM1DateNative).value.setMonth(t,e))},e.prototype.setUTCMonth=function(t,e){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setUTCMonth(t):(e=alToNumber(this.context,e),alEnsureType(this,AVM1DateNative).value.setUTCMonth(t,e))},e.prototype.setFullYear=function(t,e,i){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setFullYear(t):(e=alToNumber(this.context,e),arguments.length<=2?alEnsureType(this,AVM1DateNative).value.setFullYear(t,e):(i=alToNumber(this.context,i),alEnsureType(this,AVM1DateNative).value.setFullYear(t,e,i)))},e.prototype.setUTCFullYear=function(t,e,i){return t=alToNumber(this.context,t),arguments.length<=1?alEnsureType(this,AVM1DateNative).value.setUTCFullYear(t):(e=alToNumber(this.context,e),arguments.length<=2?alEnsureType(this,AVM1DateNative).value.setUTCFullYear(t,e):(i=alToNumber(this.context,i),alEnsureType(this,AVM1DateNative).value.setUTCFullYear(t,e,i)))},e.prototype.toUTCString=function(){return alEnsureType(this,AVM1DateNative).value.toUTCString()},e}(AVM1Object),AVM1DateFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:new AVM1DatePrototype(e)},UTC:{value:i._UTC,writable:!0}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e,i=this.context;switch(t.length){case 0:e=new Date;break;case 1:e=new Date(alToPrimitive(i,t[0]));break;default:for(var r=[],n=0;n<t.length;n++)r.push(alToNumber(i,t[n]));e=new Date(alToNumber(i,t[0]),alToNumber(i,t[1]),t.length>2?alToNumber(i,t[2]):1,t.length>3?alToNumber(i,t[3]):0,t.length>4?alToNumber(i,t[4]):0,t.length>5?alToNumber(i,t[5]):0,t.length>6?alToNumber(i,t[6]):0)}return new AVM1DateNative(i,e)},e.prototype.alCall=function(t,e){return alCallProperty(this.alConstruct.apply(this,e),"toString")},e.prototype._UTC=function(t,e,i,r,n,o){var s=this.context;return Date.UTC(alToNumber(s,arguments[0]),alToNumber(s,arguments[1]),arguments.length>2?alToNumber(s,arguments[2]):1,arguments.length>3?alToNumber(s,arguments[3]):0,arguments.length>4?alToNumber(s,arguments[4]):0,arguments.length>5?alToNumber(s,arguments[5]):0,arguments.length>6?alToNumber(s,arguments[6]):0)},e}(AVM1Function),AVM1ErrorNative=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alPrototype=e.builtins.Error.alGetPrototypeProperty(),r.alSetOwnConstructorProperty(e.builtins.Error),void 0!==i&&r.alPut("message",i),r}return __extends(e,t),e}(AVM1Object),AVM1ErrorPrototype=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Object.alGetPrototypeProperty(),alDefineObjectProperties(i,{constructor:{value:e.builtins.Error,writable:!0},name:{value:"Error",writable:!0},message:{value:"Error",writable:!0},toString:{value:i._toString,writable:!0}}),i}return __extends(e,t),e.prototype._toString=function(){return this.alGet("message")},e}(AVM1Object),AVM1ErrorFunction=function(t){function e(e){var i=t.call(this,e)||this;return i.alPrototype=e.builtins.Function.alGetPrototypeProperty(),alDefineObjectProperties(i,{prototype:{value:new AVM1ErrorPrototype(e)}}),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=t&&void 0!==t[0]?alCoerceString(this.context,t[0]):void 0;return new AVM1ErrorNative(this.context,e)},e.prototype.alCall=function(t,e){var i=e&&void 0!==e[0]?alCoerceString(this.context,e[0]):void 0;return new AVM1ErrorNative(this.context,i)},e}(AVM1Function);function alEnsureType(t,e){if(t instanceof e)return t;throw new Error("Invalid type")}function installBuiltins(t){var e=t.builtins,i=new AVM1ObjectPrototype(t),r=new AVM1Object(t);r.alSetOwnPrototypeProperty(i),e.Object=r;var n=new AVM1FunctionPrototype(t),o=new AVM1Object(t);o.alSetOwnPrototypeProperty(n),e.Function=o,i._initializePrototype(),n._initializePrototype(),e.Object=new AVM1ObjectFunction(t),e.Function=new AVM1FunctionFunction(t),e.Boolean=new AVM1BooleanFunction(t),e.Number=new AVM1NumberFunction(t),e.String=new AVM1StringFunction(t),e.Array=new AVM1ArrayFunction(t),e.Date=new AVM1DateFunction(t),e.Math=new AVM1MathObject(t),e.Error=new AVM1ErrorFunction(t)}var big=createCommonjsModule((function(t){!function(e){var i,r=20,n=1,o=1e6,s=-7,a=21,l="[big.js] ",h=l+"Invalid ",c=h+"decimal places",u=h+"rounding mode",p={},d=void 0,f=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function _(t,e,i,r){var n=t.c,o=t.e+e+1;if(o<n.length){if(1===i)r=n[o]>=5;else if(2===i)r=n[o]>5||5==n[o]&&(r||o<0||n[o+1]!==d||1&n[o-1]);else if(3===i)r=r||!!n[0];else if(r=!1,0!==i)throw Error(u);if(o<1)n.length=1,r?(t.e=-e,n[0]=1):n[0]=t.e=0;else{if(n.length=o--,r)for(;++n[o]>9;)n[o]=0,o--||(++t.e,n.unshift(1));for(o=n.length;!n[--o];)n.pop()}}else if(i<0||i>3||i!==~~i)throw Error(u);return t}function g(t,e,i,r){var n,s,a=t.constructor,l=!t.c[0];if(i!==d){if(i!==~~i||i<(3==e)||i>o)throw Error(3==e?h+"precision":c);for(i=r-(t=new a(t)).e,t.c.length>++r&&_(t,i,a.RM),2==e&&(r=t.e+i+1);t.c.length<r;)t.c.push(0)}if(n=t.e,i=(s=t.c.join("")).length,2!=e&&(1==e||3==e&&r<=n||n<=a.NE||n>=a.PE))s=s.charAt(0)+(i>1?"."+s.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)s="0"+s;s="0."+s}else if(n>0)if(++n>i)for(n-=i;n--;)s+="0";else n<i&&(s=s.slice(0,n)+"."+s.slice(n));else i>1&&(s=s.charAt(0)+"."+s.slice(1));return t.s<0&&(!l||4==e)?"-"+s:s}p.abs=function(){var t=new this.constructor(this);return t.s=1,t},p.cmp=function(t){var e,i=this,r=i.c,n=(t=new i.constructor(t)).c,o=i.s,s=t.s,a=i.e,l=t.e;if(!r[0]||!n[0])return r[0]?o:n[0]?-s:0;if(o!=s)return o;if(e=o<0,a!=l)return a>l^e?1:-1;for(s=(a=r.length)<(l=n.length)?a:l,o=-1;++o<s;)if(r[o]!=n[o])return r[o]>n[o]^e?1:-1;return a==l?0:a>l^e?1:-1},p.div=function(t){var e=this,i=e.constructor,r=e.c,n=(t=new i(t)).c,s=e.s==t.s?1:-1,a=i.DP;if(a!==~~a||a<0||a>o)throw Error(c);if(!n[0])throw Error("[big.js] Division by zero");if(!r[0])return new i(0*s);var l,h,u,p,f,g=n.slice(),m=l=n.length,y=r.length,v=r.slice(0,l),b=v.length,x=t,A=x.c=[],E=0,S=a+(x.e=e.e-t.e)+1;for(x.s=s,s=S<0?0:S,g.unshift(0);b++<l;)v.push(0);do{for(u=0;u<10;u++){if(l!=(b=v.length))p=l>b?1:-1;else for(f=-1,p=0;++f<l;)if(n[f]!=v[f]){p=n[f]>v[f]?1:-1;break}if(!(p<0))break;for(h=b==l?n:g;b;){if(v[--b]<h[b]){for(f=b;f&&!v[--f];)v[f]=9;--v[f],v[b]+=10}v[b]-=h[b]}for(;!v[0];)v.shift()}A[E++]=p?u:++u,v[0]&&p?v[b]=r[m]||0:v=[r[m]]}while((m++<y||v[0]!==d)&&s--);return A[0]||1==E||(A.shift(),x.e--),E>S&&_(x,a,i.RM,v[0]!==d),x},p.eq=function(t){return!this.cmp(t)},p.gt=function(t){return this.cmp(t)>0},p.gte=function(t){return this.cmp(t)>-1},p.lt=function(t){return this.cmp(t)<0},p.lte=function(t){return this.cmp(t)<1},p.minus=p.sub=function(t){var e,i,r,n,o=this,s=o.constructor,a=o.s,l=(t=new s(t)).s;if(a!=l)return t.s=-l,o.plus(t);var h=o.c.slice(),c=o.e,u=t.c,p=t.e;if(!h[0]||!u[0])return u[0]?(t.s=-l,t):new s(h[0]?o:0);if(a=c-p){for((n=a<0)?(a=-a,r=h):(p=c,r=u),r.reverse(),l=a;l--;)r.push(0);r.reverse()}else for(i=((n=h.length<u.length)?h:u).length,a=l=0;l<i;l++)if(h[l]!=u[l]){n=h[l]<u[l];break}if(n&&(r=h,h=u,u=r,t.s=-t.s),(l=(i=u.length)-(e=h.length))>0)for(;l--;)h[e++]=0;for(l=e;i>a;){if(h[--i]<u[i]){for(e=i;e&&!h[--e];)h[e]=9;--h[e],h[i]+=10}h[i]-=u[i]}for(;0===h[--l];)h.pop();for(;0===h[0];)h.shift(),--p;return h[0]||(t.s=1,h=[p=0]),t.c=h,t.e=p,t},p.mod=function(t){var e,i=this,r=i.constructor,n=i.s,o=(t=new r(t)).s;if(!t.c[0])throw Error("[big.js] Division by zero");return i.s=t.s=1,e=1==t.cmp(i),i.s=n,t.s=o,e?new r(i):(n=r.DP,o=r.RM,r.DP=r.RM=0,i=i.div(t),r.DP=n,r.RM=o,this.minus(i.times(t)))},p.plus=p.add=function(t){var e,i=this,r=i.constructor,n=i.s,o=(t=new r(t)).s;if(n!=o)return t.s=-o,i.minus(t);var s=i.e,a=i.c,l=t.e,h=t.c;if(!a[0]||!h[0])return h[0]?t:new r(a[0]?i:0*n);if(a=a.slice(),n=s-l){for(n>0?(l=s,e=h):(n=-n,e=a),e.reverse();n--;)e.push(0);e.reverse()}for(a.length-h.length<0&&(e=h,h=a,a=e),n=h.length,o=0;n;a[n]%=10)o=(a[--n]=a[n]+h[n]+o)/10|0;for(o&&(a.unshift(o),++l),n=a.length;0===a[--n];)a.pop();return t.c=a,t.e=l,t},p.pow=function(t){var e=this,i=new e.constructor(1),r=i,n=t<0;if(t!==~~t||t<-1e6||t>1e6)throw Error(h+"exponent");for(n&&(t=-t);1&t&&(r=r.times(e)),t>>=1;)e=e.times(e);return n?i.div(r):r},p.round=function(t,e){var i=this.constructor;if(t===d)t=0;else if(t!==~~t||t<-o||t>o)throw Error(c);return _(new i(this),t,e===d?i.RM:e)},p.sqrt=function(){var t,e,i,r=this,n=r.constructor,o=r.s,s=r.e,a=new n(.5);if(!r.c[0])return new n(r);if(o<0)throw Error(l+"No square root");0===(o=Math.sqrt(r+""))||o===1/0?((e=r.c.join("")).length+s&1||(e+="0"),s=((s+1)/2|0)-(s<0||1&s),t=new n(((o=Math.sqrt(e))==1/0?"1e":(o=o.toExponential()).slice(0,o.indexOf("e")+1))+s)):t=new n(o),s=t.e+(n.DP+=4);do{i=t,t=a.times(i.plus(r.div(i)))}while(i.c.slice(0,s).join("")!==t.c.slice(0,s).join(""));return _(t,n.DP-=4,n.RM)},p.times=p.mul=function(t){var e,i=this,r=i.constructor,n=i.c,o=(t=new r(t)).c,s=n.length,a=o.length,l=i.e,h=t.e;if(t.s=i.s==t.s?1:-1,!n[0]||!o[0])return new r(0*t.s);for(t.e=l+h,s<a&&(e=n,n=o,o=e,h=s,s=a,a=h),e=new Array(h=s+a);h--;)e[h]=0;for(l=a;l--;){for(a=0,h=s+l;h>l;)a=e[h]+o[l]*n[h-l-1]+a,e[h--]=a%10,a=a/10|0;e[h]=(e[h]+a)%10}for(a?++t.e:e.shift(),l=e.length;!e[--l];)e.pop();return t.c=e,t},p.toExponential=function(t){return g(this,1,t,t)},p.toFixed=function(t){return g(this,2,t,this.e+t)},p.toPrecision=function(t){return g(this,3,t,t-1)},p.toString=function(){return g(this)},p.valueOf=p.toJSON=function(){return g(this,4)},(i=function t(){function e(i){var r=this;if(!(r instanceof e))return i===d?t():new e(i);i instanceof e?(r.s=i.s,r.e=i.e,r.c=i.c.slice()):function(t,e){var i,r,n;if(0===e&&1/e<0)e="-0";else if(!f.test(e+=""))throw Error(h+"number");t.s="-"==e.charAt(0)?(e=e.slice(1),-1):1,(i=e.indexOf("."))>-1&&(e=e.replace(".",""));(r=e.search(/e/i))>0?(i<0&&(i=r),i+=+e.slice(r+1),e=e.substring(0,r)):i<0&&(i=e.length);for(n=e.length,r=0;r<n&&"0"==e.charAt(r);)++r;if(r==n)t.c=[t.e=0];else{for(;n>0&&"0"==e.charAt(--n););for(t.e=i-r-1,t.c=[],i=0;r<=n;)t.c[i++]=+e.charAt(r++)}}(r,i),r.constructor=e}return e.prototype=p,e.DP=r,e.RM=n,e.NE=s,e.PE=a,e.version="5.2.2",e}()).default=i.Big=i,t.exports?t.exports=i:e.Big=i}(commonjsGlobal)})),AVM1NativeFunction=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n._fn=i,r&&(n._ctor=r),n}return __extends(e,t),e.prototype.alConstruct=function(t){if(!this._ctor)throw new Error("not a constructor");return this._ctor.apply(this,t)},e.prototype.alCall=function(t,e){if(!this._fn)throw new Error("not callable");return this._fn.apply(t,e)},e}(AVM1Function),AVM1EvalFunction=function(t){function e(e){var i=t.call(this,e)||this,r=new AVM1Object(e);return r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),r.alSetOwnProperty("constructor",new AVM1PropertyDescriptor(67)),i.alSetOwnPrototypeProperty(r),i}return __extends(e,t),e.prototype.alConstruct=function(t){var e=new AVM1Object(this.context),i=this.alGetPrototypeProperty();i instanceof AVM1Object||(i=this.context.builtins.Object.alGetPrototypeProperty()),e.alPrototype=i,e.alSetOwnConstructorProperty(this);var r=this.alCall(e,t);return r instanceof AVM1Object?r:e},e}(AVM1Function);function AVM1TypeError(t){}function alToPrimitive(t,e,i){if(!(e instanceof AVM1Object))return e;var r=e;return void 0!==i?r.alDefaultValue(i):r.alDefaultValue()}function alToBoolean(t,e){switch(typeof e){case"undefined":return!1;case"object":return null!==e;case"boolean":return e;case"string":case"number":return!!e}}function alToNumber(t,e){switch("object"==typeof e&&null!==e&&(e=alToPrimitive(t,e,0)),typeof e){case"undefined":return t.swfVersion>=7?NaN:0;case"object":return null===e?t.swfVersion>=7?NaN:0:t.swfVersion>=5?NaN:0;case"boolean":return e?1:0;case"number":return e;case"string":return""===e&&t.swfVersion<5?0:""===e?NaN:+e}}function alToInteger(t,e){var i=alToNumber(t,e);return isNaN(i)?0:0===i||i===Number.POSITIVE_INFINITY||i===Number.NEGATIVE_INFINITY?i:i<0?Math.ceil(i):Math.floor(i)}function alToInt32(t,e){return 0|alToNumber(t,e)}function alToString(t,e){switch("object"==typeof e&&null!==e&&(e=alToPrimitive(t,e,1)),typeof e){case"undefined":return t.swfVersion>=7?"undefined":"";case"object":if(null===e)return"null";if(e&&e instanceof Array){for(var i="",r=0;r<e.length;r++)i+=alToString(t,e[r]),i+=r==e.length-1?"":",";return i}return"[type "+alGetObjectClass(e)+"]";case"boolean":return e?"true":"false";case"number":if(!isNaN(e)){var n=big(e);return Math.abs(n.e)<14&&(n=n.round(14-n.e,1)),n.toString()}return e.toString();case"string":return e}}function alToObject(t,e){switch(typeof e){case"undefined":throw new AVM1TypeError;case"object":if(null===e)throw new AVM1TypeError;return Array.isArray(e)?new AVM1ArrayNative(t,e):e;case"boolean":return new AVM1BooleanNative(t,e);case"number":return new AVM1NumberNative(t,e);case"string":return new AVM1StringNative(t,e)}}function alNewObject(t){var e=new AVM1Object(t);return e.alPrototype=t.builtins.Object.alGetPrototypeProperty(),e.alSetOwnConstructorProperty(t.builtins.Object),e}function alGetObjectClass(t){return t instanceof AVM1Function?"Function":"Object"}function alCoerceString(t,e){return e instanceof AVM1Object?alToString(t,e):axCoerceString$2(e)}function alCoerceNumber(t,e){if(!isNullOrUndefined$1(e))return alToNumber(t,e)}function alIsIndex(t,e){return isIndex(e instanceof AVM1Object?alToString(t,e):e)}function alForEachProperty(t,e,i){t.alGetKeys().forEach(e,i)}function alIsFunction(t){return t instanceof AVM1Function}function alCallProperty(t,e,i){t.alGet(e).alCall(t,i)}function alInstanceOf(t,e,i){if(!(e instanceof AVM1Object))return!1;if(!(i instanceof AVM1Object))return!1;for(var r=i.alGetPrototypeProperty(),n=e;n;n=n.alPrototype)if(n===r)return!0;return!1}function alIsArray(t,e){return alInstanceOf(t,e,t.builtins.Array)}function alIsArrayLike(t,e){if(!(e instanceof AVM1Object))return!1;var i=alToInteger(t,e.alGet("length"));return!(isNaN(i)||i<0||i>=4294967296)}function alIterateArray(t,e,i,r){void 0===r&&(r=null);var n=alToInteger(t,e.alGet("length"));if(!(isNaN(n)||n>=4294967296))for(var o=0;o<n;o++)i.call(r,e.alGet(o),o)}function alIsString(t,e){return"string"==typeof e}function alDefineObjectProperties(t,e){var i=t.context;Object.getOwnPropertyNames(e).forEach((function(r){var n,o,s,a=e[r],l=0;"object"==typeof a?(a.get||a.set?(o=a.get?new AVM1NativeFunction(i,a.get):void 0,s=a.set?new AVM1NativeFunction(i,a.set):void 0,l|=128):("function"==typeof(n=a.value)&&(n=new AVM1NativeFunction(i,n)),l|=64,a.writable||(l|=4)),a.enumerable||(l|=1),a.configurable||(l|=2)):("function"==typeof(n=a)&&(n=new AVM1NativeFunction(i,n)),l|=71),t.alSetOwnProperty(r,new AVM1PropertyDescriptor(l,n,o,s))}))}AVM1TypeError.prototype=Object.create(Error.prototype);var AVM1TextField=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._prevTextVarContent="",e._textVarHolder=null,e._textVarPropName="",e}return __extends(e,t),e.createAVM1Class=function(t){return wrapAVM1NativeClass(t,!0,e,[],["_alpha#","addListener","antiAliasType#","autoSize#","background#","backgroundColor#","border#","borderColor#","bottomScroll#","condenseWhite#","embedFonts#","filters#","getAwayJSID","getNewTextFormat","getTextFormat","gridFitType#","getDepth","_height#","_highquality#","hscroll#","html#","htmlText#","length#","maxChars#","maxhscroll#","maxscroll#","multiline#","_name#","_parent#","password#","_quality#","_rotation#","replaceSel","removeMovieClip","removeTextField","restrict#","scroll#","selectable#","setNewTextFormat","setTextFormat","_soundbuftime#","tabEnabled#","tabIndex#","_target#","toString","text#","textColor#","textHeight#","textWidth#","type#","_url#","variable#","_visible#","_width#","wordWrap#","_x#","_xmouse#","_xscale#","_y#","_ymouse#","_yscale#"])},e.prototype.dispatchKeyEvent=function(t,e,i,r){if(this.context.globals.Stage&&this.context.globals.Stage._awayAVMStage&&this.context.globals.Stage._awayAVMStage.scene&&this.context.globals.Stage._awayAVMStage.scene.mouseManager.useSoftkeyboard){var n,o=this.context.getStaticState(AVM1Key);o._lastKeyCode=t,o._keyStates[t]=1,alCallProperty(AVM1Globals.instance.Key,"broadcastMessage",["onKeyDown"]),(n=new KeyboardEvent(KeyboardEvent.KEYDOWN,"",t)).isShift=e,n.isCTRL=i,n.isAlt=r,this.context.globals.Stage._awayAVMStage.dispatchEvent(n),delete o._keyStates[t],alCallProperty(AVM1Globals.instance.Key,"broadcastMessage",["onKeyUp"]),(n=new KeyboardEvent(KeyboardEvent.KEYUP,"",t)).isShift=e,n.isCTRL=i,n.isAlt=r,this.context.globals.Stage._awayAVMStage.dispatchEvent(n)}},e.syncAllTextfields=function(){for(var t in e.allTextfields)e.allTextfields[t]?e.allTextfields[t].syncTextFieldValue():delete e.allTextfields[t]},e.syncQueedTextfields=function(){if(e.textFieldVars.length>0){for(var t=e.textFieldVars.length,i=0;i<t;i++)e.textFieldVars[i].syncTextFieldValue();e.textFieldVars.length=0}},e.prototype.getAwayJSID=function(){return this.adaptee.id},e.prototype.selectTextField=function(t){void 0===t&&(t=!1),AVM1Globals.softKeyboardManager&&("dummy_txt"!=this.adaptee.name&&0!=this.adaptee.name.indexOf("temp")||(t=!0),AVM1Globals.softKeyboardManager.openKeyboard(this.adaptee,t))},e.prototype.removeTextField=function(){this.removeMovieClip()},e.prototype.alPut=function(e,i){t.prototype.alPut.call(this,e,i)},e.prototype.initAdapter=function(){var t=this;this.adaptee._symbol&&this.setVariable(this.adaptee._symbol.variableName||""),this.adaptee.addEventListener(TextfieldEvent.CHANGED,(function(){t.updateVarFromText(),t.syncTextFieldValue()}))},e.prototype.initAVM1SymbolInstance=function(e,i){t.prototype.initAVM1SymbolInstance.call(this,e,i),this.adaptee=i,this._initEventsHandlers(),this._variable="",this._exitFrameHandler=null,this.adaptee=i},e.prototype.clone=function(){return getAVM1Object(this.adaptee.clone(),this._avm1Context)},e.prototype.getAntiAliasType=function(){return notImplemented("AVM1Textfield.getAntiAliasType"),""},e.prototype.setAntiAliasType=function(t){notImplemented("AVM1Textfield.getAntiAliasType")},e.prototype.get_width=function(){return this.syncTextFieldValue(),toTwipRound(this.adaptee.width)},e.prototype.get_height=function(){return this.syncTextFieldValue(),toTwipRound(this.adaptee.height)},e.prototype.set_width=function(t){t=toTwipRound(alToNumber(this.context,t)),this._blockedByScript=!0,isNaN(t)||(this.adaptee.width=t)},e.prototype.set_height=function(t){t=toTwipRound(alToNumber(this.context,t)),this._blockedByScript=!0,isNaN(t)||(this.adaptee.height=t)},e.prototype.get_x=function(){return this.syncTextFieldValue(),toTwipFloor(this.adaptee.x+this.adaptee.scaleX*this.adaptee.textOffsetX)},e.prototype.get_y=function(){return this.syncTextFieldValue(),toTwipFloor(this.adaptee.y+this.adaptee.scaleY*this.adaptee.textOffsetY)},e.prototype.set_x=function(t){this.syncTextFieldValue(),this.adaptee.x=toTwipFloor(t-this.adaptee.scaleX*this.adaptee.textOffsetX)},e.prototype.set_y=function(t){this.syncTextFieldValue(),this.adaptee.y=toTwipFloor(t-this.adaptee.scaleY*this.adaptee.textOffsetY)},e.prototype.getAutoSize=function(){return this.adaptee.autoSize},e.prototype.setAutoSize=function(t){!0===t?t="left":!1===t&&(t="none"),t=alCoerceString(this.context,t),this.adaptee.autoSize=t},e.prototype.getBackground=function(){return this.adaptee.background},e.prototype.setBackground=function(t){t=alToBoolean(this.context,t),this.adaptee.background=t},e.prototype.getBackgroundColor=function(){return this.adaptee.backgroundColor},e.prototype.setBackgroundColor=function(t){t=alToInt32(this.context,t),this.adaptee.backgroundColor=t},e.prototype.getBorder=function(){return this.adaptee.border},e.prototype.setBorder=function(t){t=alToBoolean(this.context,t),this.adaptee.border=t},e.prototype.getBorderColor=function(){return this.adaptee.borderColor},e.prototype.setBorderColor=function(t){t=alToInt32(this.context,t),this.adaptee.borderColor=t},e.prototype.getBottomScroll=function(){return this.adaptee.bottomScrollV+1},e.prototype.getCondenseWhite=function(){return notImplemented("AVM1Textfield.getCondenseWhite"),this.adaptee.condenseWhite},e.prototype.setCondenseWhite=function(t){notImplemented("AVM1Textfield.setCondenseWhite"),t=alToBoolean(this.context,t),this.adaptee.condenseWhite=t},e.prototype.getEmbedFonts=function(){return notImplemented("AVM1Textfield.getEmbedFonts"),this.adaptee.embedFonts},e.prototype.setEmbedFonts=function(t){notImplemented("AVM1Textfield.setEmbedFonts"),t=alToBoolean(this.context,t),this.adaptee.embedFonts=t},e.prototype.getNewTextFormat=function(){return AVM1TextFormat.createFromNative(this.context,this.adaptee.defaultTextFormat)},e.prototype.getTextFormat=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=-1),t=alToInteger(this.context,t),e=alToInteger(this.context,e);var i=this.adaptee.getTextFormat(t,e);return AVM1TextFormat.createFromNative(this.context,i)},e.prototype.getGridFitType=function(){return notImplemented("AVM1Textfield.getGridFitType"),""},e.prototype.setGridFitType=function(t){notImplemented("AVM1Textfield.setGridFitType")},e.prototype.getHscroll=function(){return this.adaptee.scrollH+1},e.prototype.setHscroll=function(t){(t=alCoerceNumber(this.context,t))<=0&&(t=1),this.adaptee.scrollH=t-1},e.prototype.getHtml=function(){return this.adaptee.html},e.prototype.setHtml=function(t){this.adaptee.html=!!t},e.prototype.getHtmlText=function(){return this.adaptee.html?this.adaptee.htmlText:this.adaptee.text},e.prototype.setHtmlText=function(t){t=void 0===t?"undefined":alToString(this.context,t),this.adaptee.html?this.adaptee.htmlText=t:this.adaptee.text=t,this.updateVarFromText(),this.syncTextFieldValue()},e.prototype.getLength=function(){return this.adaptee.length},e.prototype.getMaxChars=function(){return 0==this.adaptee.maxChars?null:this.adaptee.maxChars},e.prototype.setMaxChars=function(t){t=alCoerceNumber(this.context,t),this.adaptee.maxChars=t},e.prototype.getRestrict=function(){return this.adaptee.restrict},e.prototype.setRestrict=function(t){t=alCoerceString(this.context,t),this.adaptee.restrict=t},e.prototype.getMaxhscroll=function(){return this.adaptee.maxScrollH+1},e.prototype.getMaxscroll=function(){return this.adaptee.maxScrollV+1},e.prototype.getMultiline=function(){return this.adaptee.multiline},e.prototype.setMultiline=function(t){t=alToBoolean(this.context,t),this.adaptee.multiline=t},e.prototype.getPassword=function(){return notImplemented("AVM1Textfield.getPassword"),this.adaptee.displayAsPassword},e.prototype.setPassword=function(t){notImplemented("AVM1Textfield.setPassword"),t=alToBoolean(this.context,t),this.adaptee.displayAsPassword=t},e.prototype.getScroll=function(){return this.adaptee.scrollV+1},e.prototype.setScroll=function(t){(t=alCoerceNumber(this.context,t))<=0&&(t=1),this.adaptee.scrollV=t-1},e.prototype.getSelectable=function(){return this.adaptee.selectable},e.prototype.setSelectable=function(t){"false"==t&&(t=!1),(t=alToBoolean(this.context,t))||this.context.globals.Stage._awayAVMStage.scene.mouseManager.getFocus()!=this.adaptee||this.context.globals.Stage._awayAVMStage.scene.mouseManager.setFocus(null),this.adaptee.selectable=t},e.prototype.replaceSel=function(t){t=alToString(this.context,t),this.adaptee.replaceSelectedText(t)},e.prototype.setNewTextFormat=function(t){var e;t instanceof AVM1TextFormat?(e=t.adaptee,this.adaptee.textFormat||(this.adaptee.textFormat=new TextFormat),this.adaptee.newTextFormat=e):console.log("AVM1Textfield.setNewtextFormat - trying to set something other than a TextFormat",t)},e.prototype.setTextFormat=function(){this._variable&&this.syncTextFieldValue();var t,e,i=-1,r=-1;switch(arguments.length){case 0:return;case 1:t=arguments[0];break;case 2:i=alToNumber(this.context,arguments[0]),t=arguments[1];break;default:i=alToNumber(this.context,arguments[0]),r=alToNumber(this.context,arguments[1]),t=arguments[2]}i>=0&&-1==r&&(r=i),t instanceof AVM1TextFormat&&(e=t.adaptee,this.adaptee.setTextFormat(e,i,r))},e.prototype.getText=function(){return this._variable&&this.syncTextFieldValue(),this.adaptee.text},e.prototype.setText=function(t){t=void 0===t?"":alToString(this.context,t);var e=this.context.utils;if(this.adaptee.parent){var i=getAVM1Object(this.adaptee.parent,this.context);e.setProperty(i,this._variable,t)}this.adaptee.text=t,this._variable&&(this.updateVarFromText(),this.syncTextFieldValue())},e.prototype.getTextColor=function(){return this.adaptee.textColor},e.prototype.setTextColor=function(t){t=alToInt32(this.context,t),this.adaptee.textColor=t},e.prototype.getTextHeight=function(){return this._variable&&this.syncTextFieldValue(),this.adaptee.textHeight},e.prototype.setTextHeight=function(t){notImplemented("AVM1TextField.setTextHeight")},e.prototype.getTextWidth=function(){return this._variable&&this.syncTextFieldValue(),this.adaptee.textWidth},e.prototype.setTextWidth=function(t){notImplemented("AVM1TextField.setTextWidth")},e.prototype.getType=function(){return this.adaptee.type},e.prototype.setType=function(t){(t=alCoerceString(this.context,t))&&(t=t.toLowerCase()),this.adaptee.type=t},e.prototype.getVariable=function(){return this._variable},e.prototype.setVariable=function(t){if((t=alCoerceString(this.context,t))!==this._variable){var i=this.adaptee;e.allTextfields[i.id]=this,this._prevTextVarContent=this.adaptee.text,this._syncTextFieldValue(i,t),this._exitFrameHandler&&!t&&(i.removeEventListener("exitFrame",this._exitFrameHandler),this._exitFrameHandler=null),this._variable=t,!this._exitFrameHandler&&t&&(this._exitFrameHandler=this._onAS3ObjectExitFrame.bind(this),i.addEventListener("exitFrame",this._exitFrameHandler))}},e.prototype._onAS3ObjectExitFrame=function(){this._variable&&this._syncTextFieldValue(this.adaptee,this._variable)},e.prototype.syncTextFieldValue=function(){this._syncTextFieldValue(this.adaptee,this._variable)},e.prototype.updateVarFromText=function(){this._textVarHolder&&(this.context.utils.setProperty(this._textVarHolder,this._textVarPropName,this.adaptee.html?this.adaptee.htmlText:this.adaptee.text),this._prevTextVarContent=this.adaptee.text)},e.prototype._syncTextFieldValue=function(t,i){if(i&&""!=i){var r=this.context.utils;if(null==this._textVarHolder)if(i.indexOf(".")>=0||i.indexOf(":")>=0){var n=i.split(/[.:\/]/g);if(this._textVarPropName=n.pop(),"_root"==n[0]||"_level0"==n[0]||""===n[0]){var o=t.parent;for(this._textVarHolder=null;o;)o.isAVMScene?(this._textVarHolder=o.adapter,o=null):o=o.parent;if(null===this._textVarHolder)return;n.shift(),""===n[0]&&n.shift()}else if("_global"==n[0])n.shift(),this._textVarHolder=this.context.globals;else{if(!t.parent)return;this._textVarHolder=getAVM1Object(t.parent,this.context)}for(var s=null;n.length>0;)if(s=n.shift(),this._textVarHolder=r.getProperty(this._textVarHolder,s),!this._textVarHolder)return}else if(this._textVarPropName=i,t.parent&&t.parent.parent){var a;this._textVarHolder=getAVM1Object(t.parent,this.context);for(var l=t.parent.parent,h=l.numChildren,c=0;c<h;c++)(a=l.getChildAt(c))!=t.parent&&a.name==t.parent.name&&r.hasProperty(a.adapter,this._textVarPropName)&&(this._textVarHolder=a.adapter)}if(!this._textVarHolder)return e.textFieldVars.push(this),t.html?this._prevTextVarContent=t.htmlText:void(this._prevTextVarContent=t.text);if(!r.hasProperty(this._textVarHolder,this._textVarPropName))return t.html?(""!=t.htmlText?r.setProperty(this._textVarHolder,this._textVarPropName,t.htmlText):r.setProperty(this._textVarHolder,this._textVarPropName,void 0),r.setProperty(this._textVarHolder,this._textVarPropName+"_internal_TF",this),void(this._prevTextVarContent=t.htmlText)):(""!=t.text?r.setProperty(this._textVarHolder,this._textVarPropName,t.text):r.setProperty(this._textVarHolder,this._textVarPropName,void 0),r.setProperty(this._textVarHolder,this._textVarPropName+"_internal_TF",this),void(this._prevTextVarContent=t.text));r.hasProperty(this._textVarHolder,this._textVarPropName+"_internal_TF")||r.setProperty(this._textVarHolder,this._textVarPropName+"_internal_TF",this);var u=r.getProperty(this._textVarHolder,this._textVarPropName);if("string"!=typeof u&&(u=alToString(this.context,u)),t.html){if(u!==this._prevTextVarContent)return t.htmlText=void 0===u?"":u,void(this._prevTextVarContent=u);t.htmlText===u||void 0===u&&""===t.htmlText||(t.htmlText=void 0===u?"":u)}else{if(u!==this._prevTextVarContent)return t.text=void 0===u?"":u,void(this._prevTextVarContent=u);t.text===u||void 0===u&&""===t.text||(t.text=void 0===u?"":u)}}},e.prototype.getWordWrap=function(){return this.adaptee.wordWrap},e.prototype.setWordWrap=function(t){t=alToBoolean(this.context,t),this.adaptee.wordWrap=t},e.prototype._initEventsHandlers=function(){this.bindEvents(EventsListForMC)},e.allTextfields={},e.textFieldVars=[],e}(AVM1SymbolBase),StageScaleMode=function(){function t(){}return t.EXACT_FIT="EXACT_FIT",t.NO_BORDER="noBorder",t.NO_SCALE="noScale",t.SHOW_ALL="showAll",t}(),StageAlign=function(){function t(){}return t.BOTTOM="B",t.BOTTOM_LEFT="BL",t.BOTTOM_RIGHT="BR",t.LEFT="L",t.RIGHT="R",t.TOP="T",t.TOP_LEFT="TL",t.TOP_RIGHT="TR",t}(),AVMAwayStage=function(t){function e(i,r,n,o,s,a,l,h){void 0===n&&(n=null),void 0===o&&(o=30),void 0===s&&(s=null),void 0===a&&(a=550),void 0===l&&(l=400),void 0===h&&(h=!1);var c=t.call(this)||this;return c._frameRate=30,c._currentFps=0,c._stageTime=0,c.isStage=!0,c.enterEvent=new EventBase("enterFrame"),c.exitEvent=new EventBase("exitFrame"),c.SHOW_FRAME_RATE=!0,c._debugtimer=0,c.avm1Listener={},c._collectedDispatcher=[],c._align=1,c._scaleMode=1,BuildMode.mode=BuildMode.AVM1,c._stage3Ds=[],c._layers=[],c.SHOW_FRAME_RATE=h,Graphics.get_material_for_color=function(t,i){void 0===i&&(i=1),0==t&&(t=1);var r,n={};if(e._useTextureAtlasForColors)return n=TextureAtlas.getTextureForColor(t,i),e._colorMaterials[n.bitmap.id]?(n.material=e._colorMaterials[n.bitmap.id],n):((r=new MethodMaterial(n.bitmap)).alphaBlending=!0,r.useColorTransform=!0,r.bothSides=!0,e._colorMaterials[n.bitmap.id]=r,n.material=r,n);var o=t+"_"+Math.round(100*i).toString();return e._colorMaterials[o]?(n.material=e._colorMaterials[o],n):((r=new MethodMaterial(t,i)).alphaBlending=!0,r.useColorTransform=!0,r.bothSides=!0,n.material=r,e._colorMaterials[o]=r,n)},Graphics.get_material_for_gradient=function(t){var i=TextureAtlas.getTextureForGradient(t),r=i.bitmap.id+t.type;if(e._textureMaterials[r])return i.material=e._textureMaterials[r],i;var n=new MethodMaterial(i.bitmap);return n.useColorTransform=!0,n.alphaBlending=!0,n.bothSides=!0,e._textureMaterials[r]=n,i.material=n,i},c._stageWidth=a,c._stageHeight=l,c.initEninge(s),c.partition=new SceneGraphPartition(c,!0),c._scene.root.addChild(c),c.mouseEnabled=!0,c._scene.view.backgroundColor=isNaN(n)?16711935:n,c._frameRate=o,MouseManager.getInstance(PickGroup.getInstance(c._scene.renderer.view))._stage=c,MouseManager.getInstance(PickGroup.getInstance(c._scene.renderer.view)).eventBubbling=!1,c.SHOW_FRAME_RATE&&(c._fpsTextField=document.createElement("div"),c._fpsTextField.style.cssFloat="none",c._fpsTextField.style.position="absolute",c._fpsTextField.style.top="15px",c._fpsTextField.style.width="200px",c._fpsTextField.style.height="20px",c._fpsTextField.style.left=.5*window.innerWidth-100+"px",c._fpsTextField.style.textAlign="center",c._fpsTextField.style.color="#ff0000",c._fpsTextField.style.fontSize="30px",c._fpsTextField.style.zIndex="9999",c._fpsTextField.innerHTML="30",document.body.appendChild(c._fpsTextField),setInterval((function(){return c.updateFPS()}),1e3)),c.initListeners(),c.htmlElement=c._stage.container,c.htmlElement.tabIndex=1e3,c}return __extends(e,t),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),e.prototype.getLayer=function(t){for(;this._layers.length<=t;)this._layers[this._layers.length]=new Sprite,this.addChild(this._layers[this._layers.length-1]);return this._layers[t]},Object.defineProperty(e.prototype,"rendererStageContainer",{get:function(){return this._stage.container},enumerable:!0,configurable:!0}),e.prototype.updateFPS=function(){this._fpsTextField&&(this._fpsTextField.innerText=this._currentFps.toFixed(2)+" / "+this._frameRate+" fps"),this._currentFps=0},Object.defineProperty(e.prototype,"onlyMouseEnabled",{set:function(t){},enumerable:!0,configurable:!0}),e.prototype.initResizeListener=function(t,e){},e.prototype.removeResizeListener=function(t,e){},e.prototype.resizeCallback=function(t){var e=window.innerWidth,i=window.innerHeight,r=0,n=0;switch(this.scaleMode){case StageScaleMode.NO_SCALE:this._projection.fieldOfView=360*Math.atan(this._stageHeight/1e3/2)/Math.PI;break;case StageScaleMode.SHOW_ALL:i=window.innerHeight,(e=this._stageWidth/this._stageHeight*i)>window.innerWidth&&(i=(e=window.innerWidth)*(this._stageHeight/this._stageWidth)),r=(window.innerWidth-e)/2,n=(window.innerHeight-i)/2,this._projection.fieldOfView=360*Math.atan(this._stageHeight/1e3/2)/Math.PI;break;case StageScaleMode.EXACT_FIT:case StageScaleMode.NO_BORDER:this._projection.fieldOfView=360*Math.atan(window.innerHeight/1e3/2)/Math.PI;break;default:console.log("Stage: only implemented StageScaleMode are NO_SCALE, SHOW_ALL")}switch(this.align){case StageAlign.TOP_LEFT:this._scene.renderer.view.y=0,this._scene.renderer.view.x=0;break;default:console.log("Stage: only implemented StageAlign is TOP_LEFT")}this.updateSize(r,n,e,i)},e.prototype.updateSize=function(t,e,i,r){this._scene.view.x=t,this._scene.view.y=e,this._stage.x=t,this._stage.y=e,this._stage.width=i,this._stage.height=r,this._scene.view.width=i,this._scene.view.height=r,this._fpsTextField&&(this._fpsTextField.style.left=.5*window.innerWidth-100+"px")},e.prototype.show=function(){},e.prototype.takeSnapShot=function(){var t=new BitmapImage2D(550,400,!0,4294967295,!1);this._scene.renderer.queueSnapshot(t),this._scene.render(),t.invalidate();var e=t.data,i=new BitmapImage2D(550,400,!0,4278255615,!1),r=0,n=0,o=0,s=0,a=[];for(n=0;n<400;n++)for(r=0;r<550;r++)o=4*(550*(399-n)+r),s=ColorUtils.ARGBtoFloat32(e[o+3],e[o],e[o+1],e[o+2]),a[a.length]=s,i.setPixel32(r,n,s);i.invalidate();var l=document.createElement("canvas");l.width=i.width,l.height=i.height,l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.width="100%";var h=l.getContext("2d"),c=h.getImageData(0,0,i.width,i.height);return c.data.set(i.data),h.putImageData(c,0,0),l},e.prototype.initEninge=function(t){StageManager.htmlCanvas=t,this._scene=new Scene(new BasicPartition(new DisplayObjectContainer)),this._scene.renderer.renderableSorter=null,StageManager.htmlCanvas=null,this._stage=this._scene.view.stage,this._stage.antiAlias=0,this._stage.color=4294967295,this._scene.mousePicker.shapeFlag=!0,this._scene.forceMouseMove=!0,this._scene.beforeRenderCallback=function(){FrameScriptManager.execute_queue(),AVM1TextField.syncAllTextfields()},this._projection=new PerspectiveProjection,this._projection.coordinateSystem=CoordinateSystem.RIGHT_HANDED,this._projection.fieldOfView=30,this._projection.originX=-1,this._projection.originY=1;var e=new Camera;e.projection=this._projection,this._scene.camera=e,this._projection.fieldOfView=360*Math.atan(this._stageHeight/1e3/2)/Math.PI},e.prototype.initListeners=function(){var t=this;this._timer=new RequestAnimationFrame(this.internalOnEnterFrame,this),this._timer.start(),this.clearAllAVM1Listener(),this.addEventListener(MouseEvent.MOUSE_DOWN,(function(e){return t.onMouseEvent(e)})),this.addEventListener(MouseEvent.MOUSE_UP,(function(e){return t.onMouseEvent(e)})),this.addEventListener(MouseEvent.MOUSE_MOVE,(function(e){return t.onMouseEvent(e)})),this.addEventListener(KeyboardEvent.KEYDOWN,(function(e){return t.onKeyEvent(e)})),this.addEventListener(KeyboardEvent.KEYUP,(function(e){return t.onKeyEvent(e)}))},e.prototype.onKeyEvent=function(t){if(this.avm1Listener[t.type]){this._collectedDispatcher.length=0;var e,i,r,n,o=0,s=this._layers.length;for(o=0;o<s;o++)for(i=(e=this._layers[o]).numChildren,r=0;r<i;++r)(n=e.getChildAt(r)).isAsset(MovieClip)&&this.collectMousEvents(n);for(s=this._collectedDispatcher.length,o=0;o<s;o++)if(this.avm1Listener[t.type]&&this.avm1Listener[t.type][this._collectedDispatcher[o].id])for(var a=0;a<this.avm1Listener[t.type][this._collectedDispatcher[o].id].length;a++)"number"==typeof this.avm1Listener[t.type][this._collectedDispatcher[o].id][a].keyCode&&this.avm1Listener[t.type][this._collectedDispatcher[o].id][a].keyCode!=t.keyCode||this.avm1Listener[t.type][this._collectedDispatcher[o].id][a].callback();FrameScriptManager.execute_queue()}},e.prototype.addAVM1EventListener=function(t,e,i,r){this.avm1Listener[e]||(this.avm1Listener[e]={}),this.avm1Listener[e][t.id]||(this.avm1Listener[e][t.id]=[]),this.avm1Listener[e][t.id].push({type:e,callback:i}),r&&"number"==typeof r.keyCode&&(this.avm1Listener[e][t.id][this.avm1Listener[e][t.id].length-1].keyCode=r.keyCode)},e.prototype.removeAVM1EventListener=function(t,e,i){this.avm1Listener[e]&&delete this.avm1Listener[e][t.id]},e.prototype.clearAllAVM1Listener=function(){this.avm1Listener={}},e.prototype.collectMousEvents=function(t){for(var e,i=t.numChildren;i>0;)i--,e=t.getChildAt(i),this.collectMousEvents(e);t.isAsset(MovieClip)&&(this._collectedDispatcher[this._collectedDispatcher.length]=t)},e.prototype.onMouseEvent=function(t){if(this.avm1Listener[t.type]){this._collectedDispatcher.length=0;var e,i,r,n,o,s=0,a=this._layers.length;for(s=0;s<a;s++)for(i=(e=this._layers[s]).numChildren,r=0;r<i;++r)(n=e.getChildAt(r)).isAsset(MovieClip)&&this.collectMousEvents(n);for(a=this._collectedDispatcher.length,s=0;s<a;s++)if(this.avm1Listener[t.type]&&this.avm1Listener[t.type][this._collectedDispatcher[s].id]){o=this.avm1Listener[t.type][this._collectedDispatcher[s].id].length;for(var l=0;l<o;l++)this.avm1Listener[t.type][this._collectedDispatcher[s].id][l].callback()}FrameScriptManager.execute_queue()}},e.prototype.runAVM1Framescripts=function(){FrameScriptManager.execute_queue()},e.prototype.executeEnterFrame=function(t,e){for(var i,r=t.numChildren;r>0;)r--,i=t.getChildAt(r),this.executeEnterFrame(i,e);t.isAsset(MovieClip)&&t.hasEventListener(this.enterEvent.type)&&e.push(t)},e.prototype.onEnterFrame=function(t){FrameScriptManager.execute_queue();var e,i,r,n,o=0,s=this._layers.length;for(MovieClip._skipAdvance=!0,o=0;o<s;o++)for(i=(e=this._layers[o]).numChildren,r=0;r<i;++r)(n=e.getChildAt(r)).isAsset(MovieClip)&&n.advanceFrame();MovieClip._skipAdvance=!1,FrameScriptManager.execute_queue();var a=[];for(s=this._layers.length,o=0;o<s;o++)for(i=(e=this._layers[o]).numChildren,r=0;r<i;++r)n=e.getChildAt(r),this.executeEnterFrame(n,a);for(s=a.length,o=0;o<s;o++)a[o].dispatchEvent(this.enterEvent);for(FrameScriptManager.execute_queue(),FrameScriptManager.execute_intervals(t),FrameScriptManager.execute_queue(),s=this._layers.length,o=0;o<s;o++)for(i=(e=this._layers[o]).numChildren,r=0;r<i;++r)(n=e.getChildAt(r)).isAsset(MovieClip)&&n.dispatchExitFrame(this.exitEvent);FrameScriptManager.execute_queue()},e.prototype.internalOnEnterFrame=function(t){if(this._stage&&this._scene&&this._scene.renderer){var e=1e3/this._frameRate;if(this._stageTime+=Math.min(t,e),this._stageTime>=e){if(MovieClipSoundsManager.enterFrame(),this._stage.clear(),this.onEnterFrame(this._stageTime),this._stageTime-=e,!this._stage||!this._scene||!this._scene.renderer)return void this._timer.stop();this._currentFps++,this._scene.render(),MovieClipSoundsManager.exitFrame()}}else this._timer.stop()},Object.defineProperty(e.prototype,"rendererStage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseX",{get:function(){return this._scene.getLocalMouseX(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseY",{get:function(){return this._scene.getLocalMouseY(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessibilityImplementation",{set:function(t){console.log("textSnapshot not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowsFullScreen",{get:function(){return console.log("allowsFullScreen not implemented yet in flash/AVMAwayStage"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowsFullScreenInteractive",{get:function(){return console.log("allowsFullScreenInteractive not implemented yet in flash/AVMAwayStage"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"browserZoomFactor",{get:function(){return console.log("browserZoomFactor not implemented yet in flash/AVMAwayStage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._scene.view.backgroundColor},set:function(t){this._scene.view.backgroundColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorCorrection",{get:function(){return console.log("colorCorrection not implemented yet in flash/AVMAwayStage"),""},set:function(t){console.log("colorCorrection not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorCorrectionSupport",{get:function(){return console.log("colorCorrectionSupport not implemented yet in flash/AVMAwayStage"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentsScaleFactor",{get:function(){return console.log("contentsScaleFactor not implemented yet in flash/AVMAwayStage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayContextInfo",{get:function(){return console.log("displayContextInfo not implemented yet in flash/AVMAwayStage"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayState",{get:function(){return console.log("displayState not implemented yet in flash/AVMAwayStage"),""},set:function(t){console.log("displayState not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focus",{get:function(){return console.log("focus not implemented yet in flash/AVMAwayStage"),null},set:function(t){console.log("focus not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameRate",{get:function(){return this._frameRate},set:function(t){this._frameRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullScreenHeight",{get:function(){return console.log("fullScreenHeight not implemented yet in flash/AVMAwayStage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullScreenSourceRect",{get:function(){return console.log("fullScreenSourceRect not implemented yet in flash/AVMAwayStage"),null},set:function(t){console.log("fullScreenSourceRect not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullScreenWidth",{get:function(){return console.log("fullScreenWidth not implemented yet in flash/AVMAwayStage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseLock",{get:function(){return console.log("mouseLock not implemented yet in flash/AVMAwayStage"),!1},set:function(t){console.log("mouseLock not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return console.log("quality not implemented yet in flash/AVMAwayStage"),""},set:function(t){console.log("quality not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showDefaultContextMenu",{get:function(){return console.log("showDefaultContextMenu not implemented yet in flash/AVMAwayStage"),!1},set:function(t){console.log("showDefaultContextMenu not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"softKeyboardRect",{get:function(){return console.log("softKeyboardRect not implemented yet in flash/AVMAwayStage"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage3Ds",{get:function(){return console.log("stage3Ds not implemented yet in flash/AVMAwayStage"),this._stage3Ds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageFocusRect",{get:function(){return console.log("stageFocusRect not implemented yet in flash/AVMAwayStage"),!1},set:function(t){console.log("stageFocusRect not implemented yet in flash/AVMAwayStage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageHeight",{get:function(){return this._stageHeight},set:function(t){this._stageHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageVideos",{get:function(){return console.log("stageVideos not implemented yet in flash/AVMAwayStage"),[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageWidth",{get:function(){return this._stageWidth},set:function(t){this._stageWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabChildren",{get:function(){return console.log("tabChildren not implemented yet in flash/AVMAwayStage"),!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSnapshot",{get:function(){return console.log("textSnapshot not implemented yet in flash/AVMAwayStage"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wmodeGPU",{get:function(){return console.log("wmodeGPU not implemented yet in flash/AVMAwayStage"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessibilityProperties",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheAsBitmap",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contextMenu",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusRect",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaderInfo",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opaqueBackground",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale9Grid",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollRect",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabEnabled",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabIndex",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{set:function(t){},enumerable:!0,configurable:!0}),e.prototype.invalidate=function(){},e.prototype.isFocusInaccessible=function(){return console.log("isFocusInaccessible not implemented yet in flash/AVMAwayStage"),!1},e.prototype.dispose=function(){this._scene&&this._scene.renderer&&this._scene.renderer.view&&this._scene.renderer&&this._scene.renderer.stage&&this._scene.renderer.stage.container&&MouseManager.getInstance(PickGroup.getInstance(this._scene.renderer.view)).unregisterContainer(this._scene.renderer.stage.container),this._scene&&this._scene.dispose(),this._scene=null,e._colorMaterials={},e._textureMaterials={},PickGroup.clearAllInstances(),TextureAtlas.clearAllMaterials(),this._timer.stop();for(var t,i,r=this._layers.length,n=0;n<r;n++){i=(t=this._layers[n]).numChildren;for(var o=0;o<i;++o)t.getChildAt(o).dispose()}this._layers.length=0,AVM1TextField.allTextfields={},MovieClip.clearPool(),TextField.clearPool(),Sprite.clearPool(),Graphics.clearPool(),Shape.clearPool()},e._colorMaterials={},e._textureMaterials={},e._useTextureAtlasForColors=!0,e}(Sprite),AVM1SceneGraphFactory=function(t){function e(i){var r=t.call(this)||this;return r.imageStore={},r.avm1Context=i,e._instance=r,r}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return e._instance||console.log("Error. A instance of AVM1SceneGraphFactory must be created manually before accessing the singleton AVM1SceneGraphFactory._instance"),e._instance},enumerable:!0,configurable:!0}),e.prototype.createSprite=function(t){return new Sprite},e.prototype.createDisplayObjectContainer=function(){return new DisplayObjectContainer},e.prototype.createMovieClip=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=new MovieClip(t||new Timeline);if(i.timelineMC=!0,e.isButton)getAVM1Object(i,this.avm1Context);else getAVM1Object(i,this.avm1Context);return i},e.prototype.createTextField=function(){var t=new TextField;t.multiline=!0,t.wordWrap=!0;getAVM1Object(t,this.avm1Context);return t},e.prototype.createBillboard=function(t){return null},e.prototype.createImage2D=function(t,e,i,r,n){return void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=!0),new BitmapImage2D(t,e,i,r,n)},e}(DefaultSceneGraphFactory),avm1Options=shumwayOptions.register(new OptionSet("AVM1")),avm1TraceEnabled=avm1Options.register(new Option("t1","traceAvm1","boolean",!1,"trace AVM1 execution")),avm1ErrorsEnabled=avm1Options.register(new Option("e1","errorsAvm1","boolean",!1,"fail on AVM1 warnings and errors")),avm1WarningsEnabled=avm1Options.register(new Option("w1","warningsAvm1","boolean",!0,"Emit messages for AVM1 warnings and errors")),avm1TimeoutDisabled=avm1Options.register(new Option("ha1","nohangAvm1","boolean",!1,"disable fail on AVM1 hang")),avm1CompilerEnabled=avm1Options.register(new Option("ca1","compileAvm1","boolean",!0,"compiles AVM1 code")),avm1DebuggerEnabled=avm1Options.register(new Option("da1","debugAvm1","boolean",!1,"allows AVM1 code debugging")),avm1WellknownActionsCompilationsEnabled=avm1Options.register(new Option("cw1","wellknownAvm1","boolean",!0,"Replaces well-known actions patterns instead of compilation")),AVM1ActionsData=function(t,e,i){void 0===i&&(i=null),this.bytes=t,this.id=e,this.parent=i,this.ir=null,this.compiled=null},ActionsDataFactory=function(){function t(){this._cache=new WeakMap}return t.prototype.createActionsData=function(t,e,i){void 0===i&&(i=null);var r=this._cache.get(t);return r||(r=new AVM1ActionsData(t,e,i),this._cache.set(t,r)),r},t}(),AVM1Context=function(){function t(t){this.swfVersion=t,this.globals=null,this.actionsDataFactory=new ActionsDataFactory,t>6?(this.isPropertyCaseSensitive=!0,this.normalizeName=this.normalizeNameCaseSensitive):(this.isPropertyCaseSensitive=!1,this._nameCache=Object.create(null),this.normalizeName=this.normalizeNameCaseInsensitive),this.builtins={},installBuiltins(this),this.eventObservers=Object.create(null),this.assets={},this.assetsSymbols=[],this.assetsClasses=[],this.awayAssets={},this.staticStates=new WeakMap}return t.prototype.resolveTarget=function(t){},t.prototype.resolveRoot=function(){},t.prototype.checkTimeout=function(){},t.prototype.executeActions=function(t,e){},t.prototype.executeFunction=function(t,e,i){},t.prototype.normalizeNameCaseSensitive=function(t){switch(typeof t){case"number":case"string":return t;default:return alToString(this,t)}},t.prototype.normalizeNameCaseInsensitive=function(t){switch(typeof t){case"number":return t.toString();case"string":break;default:t=alToString(this,t)}var e=this._nameCache[t];return e||(e=t.toLowerCase(),this._nameCache[t]=e,e)},t.prototype._getEventPropertyObservers=function(t,e){this.isPropertyCaseSensitive||(t=t.toLowerCase());var i=this.eventObservers[t];return i||(e?(i=[],this.eventObservers[t]=i,i):null)},t.prototype.registerEventPropertyObserver=function(t,e){this._getEventPropertyObservers(t,!0).push(e)},t.prototype.unregisterEventPropertyObserver=function(t,e){var i=this._getEventPropertyObservers(t,!1);if(i){var r=i.indexOf(e);r<0||i.splice(r,1)}},t.prototype.broadcastEventPropertyChange=function(t){var e=this._getEventPropertyObservers(t,!1);e&&e.forEach((function(e){return e.onEventPropertyModified(t)}))},t.prototype.addAsset=function(t,e,i){this.assets[t.toLowerCase()]=e,this.assetsSymbols[e]=i,this.awayAssets[t.toLowerCase()]=i},t.prototype.registerClass=function(t,e){if(null===(t=alCoerceString(this,t)))return this.utils.warn("Cannot register class for symbol: className is missing"),null;var i=AssetLibrary.getAsset(t,AVM1MovieClip.currentMCAssetNameSpace);i.adaptee?(console.log("register",i.adaptee.name,i.adaptee.id),i.adaptee.avm1Symbol=e):console.warn("can not find symbol to register class "+t)},t.prototype.getSymbolClass=function(t){return this.assetsClasses[t]||null},t.prototype.getAsset=function(t){if(null!==(t=alCoerceString(this,t))){var e=this.assets[t.toLowerCase()];if(void 0!==e){var i=this.awayAssets[t.toLowerCase()];return i||console.log("error in getAsset. not implemented to grab assets from loaderInfo"),{symbolId:e,symbolProps:i}}}},t.prototype.reset=function(){this.eventObservers=Object.create(null),this.assets={},this.assetsSymbols=[],this.assetsClasses=[],this.awayAssets={},this.staticStates=new WeakMap,AVM1Stage.bindStage(this,this.globals.Stage,null,null)},t.prototype.setStage=function(t,e){AVM1Key.bindStage(this,this.globals.Key,t,e),AVM1Mouse.bindStage(this,this.globals.Mouse,t,e),AVM1Stage.bindStage(this,this.globals.Stage,t,e)},t.prototype.getStaticState=function(t){var e=this.staticStates.get(t);if(!e){e=Object.create(null);var i=t.alInitStatic;i&&i.call(e,this),this.staticStates.set(t,e)}return e},t.prototype.resolveLevel=function(t){this.utils.warn("Unable to resolve level "+t+" root")},t}(),ActionsDataAnalyzer=function(){function t(){this.parentResults=null,this.registersLimit=0}return t.prototype.analyze=function(t){for(var e,i,r,n,o,s,a,l=[],h=[0],c=[!0],u=!1,p=null,d=[0];d.length>0;)if(e=d.shift(),!l[e])for(t.position=e;!t.eof&&!l[e]&&0!==(i=t.readNext()).actionCode;){switch(r=t.position,g={action:i,next:r,conditionalJumpTo:-1},n=0,o=!1,s=!1,i.actionCode){case 138:case 141:o=!0,a=138===i.actionCode?i.args[1]:i.args[0],t.skip(a),n=t.position,t.position=r;break;case 153:s=!0,o=!0,n=r+i.args[0];break;case 157:o=!0,n=r+i.args[0];break;case 42:case 62:case 0:s=!0,o=!0,n=t.length;break;case 136:if(u){p=null;break}u=!0,0===e&&(p=i.args[0])}if(o&&((n<0||n>t.length)&&(console.error("jump outside the action block;"),n=t.length),s?g.next=n:g.conditionalJumpTo=n,c[n]||(h.push(n),d.push(n),c[n]=!0)),l[e]=g,s)break;e=r}var f,_,g,m=[];h.forEach((function(t){if(l[t]){f=[],_=t;do{g=l[_],f.push(g),_=g.next}while(!c[_]&&l[_]);m.push({label:t,items:f,jump:_})}}));var y=null;return u?y=p:this.parentResults&&(y=this.parentResults.singleConstantPool),{actions:l,blocks:m,dataId:t.dataId,singleConstantPool:y,registersLimit:this.registersLimit}},t}(),ActionsDataStream=function(){function t(t,e){this.array=t,this.position=0,this.end=t.length,this.readANSI=e<6;var i=new ArrayBuffer(4);if(new Int32Array(i)[0]=1,!new Uint8Array(i)[0])throw new Error("big-endian platform")}return t.prototype.readUI8=function(){return this.array[this.position++]},t.prototype.readUI16=function(){var t=this.position,e=this.array,i=e[t+1]<<8|e[t];return this.position=t+2,i},t.prototype.readSI16=function(){var t=this.position,e=this.array,i=e[t+1]<<8|e[t];return this.position=t+2,i<32768?i:i-65536},t.prototype.readInteger=function(){var t=this.position,e=this.array,i=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;return this.position=t+4,i},t.prototype.readFloat=function(){var t=this.position,e=this.array,i=new ArrayBuffer(4),r=new Uint8Array(i);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],this.position=t+4,new Float32Array(i)[0]},t.prototype.readDouble=function(){var t=this.position,e=this.array,i=new ArrayBuffer(8),r=new Uint8Array(i);return r[4]=e[t],r[5]=e[t+1],r[6]=e[t+2],r[7]=e[t+3],r[0]=e[t+4],r[1]=e[t+5],r[2]=e[t+6],r[3]=e[t+7],this.position=t+8,new Float64Array(i)[0]},t.prototype.readBoolean=function(){return!!this.readUI8()},t.prototype.readANSIString=function(){for(var t,e="";t=this.readUI8();)e+=String.fromCharCode(t);return e},t.prototype.readUTF8String=function(){for(var t,e="";t=this.readUI8();)if(t<128)e+=String.fromCharCode(t);else if(128!=(192&t)){var i=this.position-1,r=192,n=5;do{var o=r>>1|128;if((t&o)===r)break;r=o,--n}while(n>=0);for(var s=t&(1<<n)-1,a=5;a>=n;--a)if(128==(192&(t=this.readUI8())))s=s<<6|63&t;else{var l=this.position-1;for(this.position=i;this.position<l;)e+=String.fromCharCode(this.readUI8())}e+=s>=65536?String.fromCharCode(s-65536>>10&1023|55296,1023&s|56320):String.fromCharCode(s)}else e+=String.fromCharCode(t);return e},t.prototype.readString=function(){return this.readANSI?this.readANSIString():this.readUTF8String()},t.prototype.readBytes=function(t){var e=this.position,i=Math.max(this.end-e,0);i<t&&(t=i);var r=this.array.subarray(e,e+t);return this.position=e+t,r},t}(),ParsedPushRegisterAction=function(t){this.registerNumber=t},ParsedPushConstantAction=function(t){this.constantIndex=t},ActionsDataParser=function(){function t(t,e){this._actionsData=t,this.dataId=t.id,this._stream=new ActionsDataStream(t.bytes,e)}return Object.defineProperty(t.prototype,"position",{get:function(){return this._stream.position},set:function(t){this._stream.position=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eof",{get:function(){return this._stream.position>=this._stream.end},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._stream.end},enumerable:!0,configurable:!0}),t.prototype.readNext=function(){var t=this._stream,e=t.position,i=t.readUI8(),r=i>=128?t.readUI16():0,n=t.position+r,o=null;switch(0|i){case 129:var s=t.readUI16(),a=!1;6!==(l=t.readUI8())&&7!==l?t.position--:(n++,a=6===l),o=[s,a];break;case 131:o=[t.readString(),t.readString()];break;case 138:o=[s=t.readUI16(),p=t.readUI8()];break;case 139:o=[t.readString()];break;case 140:var l,h=t.readString();a=!1;6!==(l=t.readUI8())&&7!==l?t.position--:(n++,a=6===l),o=[h,a];break;case 150:var c,u;for(o=[];t.position<n;){switch(0|(c=t.readUI8())){case 0:u=t.readString();break;case 1:u=t.readFloat();break;case 2:u=null;break;case 3:u=void 0;break;case 4:u=new ParsedPushRegisterAction(t.readUI8());break;case 5:u=t.readBoolean();break;case 6:u=t.readDouble();break;case 7:u=t.readInteger();break;case 8:u=new ParsedPushConstantAction(t.readUI8());break;case 9:u=new ParsedPushConstantAction(t.readUI16());break;default:console.error("Unknown value type: "+c),t.position=n;continue}o.push(u)}break;case 153:case 157:o=[t.readSI16()];break;case 154:o=[y=t.readUI8()];break;case 159:o=[y=t.readUI8()],2&y&&o.push(t.readUI16());break;case 141:o=[p=t.readUI8()];break;case 136:for(var p=t.readUI16(),d=[],f=0;f<p;f++)d.push(t.readString());o=[d];break;case 155:var _=t.readString(),g=(p=t.readUI16(),[]);for(f=0;f<p;f++)g.push(t.readString());n+=E=t.readUI16(),o=[new AVM1ActionsData(t.readBytes(E),this.dataId+"_f"+t.position,this._actionsData),_,g];break;case 148:n+=E=t.readUI16(),o=[new AVM1ActionsData(t.readBytes(E),this.dataId+"_w"+t.position,this._actionsData)];break;case 135:o=[b=t.readUI8()];break;case 142:_=t.readString(),p=t.readUI16();var m=t.readUI8(),y=t.readUI16(),v=[];for(g=[],f=0;f<p;f++){var b=t.readUI8(),x=t.readString();g.push(x),b&&(v[b]={type:1,name:x,index:f})}var A=1;1&y&&(v[A++]={type:2}),4&y&&(v[A++]={type:4}),16&y&&(v[A++]={type:8}),64&y&&(v[A++]={type:64}),128&y&&(v[A++]={type:32}),256&y&&(v[A++]={type:16});var E,S=0;2&y&&(S|=2),8&y&&(S|=4),32&y&&(S|=8),n+=E=t.readUI16(),o=[new AVM1ActionsData(t.readBytes(E),this.dataId+"_f"+t.position,this._actionsData),_,g,m,v,S];break;case 143:var T=!!(4&(y=t.readUI8())),P=!!(2&y),C=!!(1&y),w=t.readUI16(),D=t.readUI16(),M=t.readUI16();n+=w+D+M,o=[T,T?t.readUI8():t.readString(),new AVM1ActionsData(t.readBytes(w),this.dataId+"_t"+t.position,this._actionsData),C,new AVM1ActionsData(t.readBytes(D),this.dataId+"_c"+t.position,this._actionsData),P,new AVM1ActionsData(t.readBytes(M),this.dataId+"_z"+t.position,this._actionsData)];break;case 137:o=[t.readUI8()]}return t.position=n,{position:e,actionCode:i,actionName:ActionNamesMap[i],args:o}},t.prototype.skip=function(t){for(var e=this._stream;t>0&&e.position<e.end;){var i=e.readUI8()>=128?e.readUI16():0;e.position+=i,t--}},t}(),ActionNamesMap={0:"EOA",4:"ActionNextFrame",5:"ActionPreviousFrame",6:"ActionPlay",7:"ActionStop",8:"ActionToggleQuality",9:"ActionStopSounds",10:"ActionAdd",11:"ActionSubtract",12:"ActionMultiply",13:"ActionDivide",14:"ActionEquals",15:"ActionLess",16:"ActionAnd",17:"ActionOr",18:"ActionNot",19:"ActionStringEquals",20:"ActionStringLength",21:"ActionStringExtract",23:"ActionPop",24:"ActionToInteger",28:"ActionGetVariable",29:"ActionSetVariable",32:"ActionSetTarget2",33:"ActionStringAdd",34:"ActionGetProperty",35:"ActionSetProperty",36:"ActionCloneSprite",37:"ActionRemoveSprite",38:"ActionTrace",39:"ActionStartDrag",40:"ActionEndDrag",41:"ActionStringLess",42:"ActionThrow",43:"ActionCastOp",44:"ActionImplementsOp",45:"ActionFSCommand2",48:"ActionRandomNumber",49:"ActionMBStringLength",50:"ActionCharToAscii",51:"ActionAsciiToChar",52:"ActionGetTime",53:"ActionMBStringExtract",54:"ActionMBCharToAscii",55:"ActionMBAsciiToChar",58:"ActionDelete",59:"ActionDelete2",60:"ActionDefineLocal",61:"ActionCallFunction",62:"ActionReturn",63:"ActionModulo",64:"ActionNewObject",65:"ActionDefineLocal2",66:"ActionInitArray",67:"ActionInitObject",68:"ActionTypeOf",69:"ActionTargetPath",70:"ActionEnumerate",71:"ActionAdd2",72:"ActionLess2",73:"ActionEquals2",74:"ActionToNumber",75:"ActionToString",76:"ActionPushDuplicate",77:"ActionStackSwap",78:"ActionGetMember",79:"ActionSetMember",80:"ActionIncrement",81:"ActionDecrement",82:"ActionCallMethod",83:"ActionNewMethod",84:"ActionInstanceOf",85:"ActionEnumerate2",96:"ActionBitAnd",97:"ActionBitOr",98:"ActionBitXor",99:"ActionBitLShift",100:"ActionBitRShift",101:"ActionBitURShift",102:"ActionStrictEquals",103:"ActionGreater",104:"ActionStringGreater",105:"ActionExtends",129:"ActionGotoFrame",131:"ActionGetURL",135:"ActionStoreRegister",136:"ActionConstantPool",137:"ActionStrictMode",138:"ActionWaitForFrame",139:"ActionSetTarget",140:"ActionGoToLabel",141:"ActionWaitForFrame2",142:"ActionDefineFunction2",143:"ActionTry",148:"ActionWith",150:"ActionPush",153:"ActionJump",154:"ActionGetURL2",155:"ActionDefineFunction",157:"ActionIf",158:"ActionCall",159:"ActionGotoFrame2"},cachedActionsCalls=null;function getActionsCalls(){return cachedActionsCalls||(cachedActionsCalls=generateActionCalls()),cachedActionsCalls}var ActionsDataCompiler=function(){function t(){}return t.prototype.convertArgs=function(t,e,i,r){for(var n,o,s,a,l,h,c=[],u=t.length,p=0;p<u;p++)"object"!=typeof(n=t[p])||null===n||Array.isArray(n)?void 0===n?c.push("undefined"):c.push(JSON.stringify(n)):n instanceof ParsedPushConstantAction?r.singleConstantPool?(o=r.singleConstantPool[n.constantIndex],c.push(void 0===o?"undefined":JSON.stringify(o))):(s="",(a=i.constantPool)&&(s=(s=void 0===(o=a[n.constantIndex])?"undefined":JSON.stringify(o)).indexOf("*/")>=0?"":" /* "+s+" */"),c.push("constantPool["+n.constantIndex+"]"+s)):n instanceof ParsedPushRegisterAction?(l=n.registerNumber)<0||l>=r.registersLimit?c.push("undefined"):c.push("registers["+l+"]"):n instanceof AVM1ActionsData?(i[h="code_"+e+"_"+p]=n,c.push("res."+h)):notImplemented("Unknown AVM1 action argument type");return c.join(",")},t.prototype.convertAction=function(t,e,i,r,n){switch(t.action.actionCode){case 153:case 62:return"";case 136:return i.constantPool=t.action.args[0],"  constantPool = ["+this.convertArgs(t.action.args[0],e,i,n)+"];\n  ectx.constantPool = constantPool;\n";case 150:return"  stack.push("+this.convertArgs(t.action.args,e,i,n)+");\n";case 135:var o=t.action.args[0];return o<0||o>=n.registersLimit?"":"  registers["+o+"] = stack[stack.length - 1];\n";case 138:case 141:return"  if (calls."+t.action.actionName+"(ectx,["+this.convertArgs(t.action.args,e,i,n)+"])) { position = "+t.conditionalJumpTo+"; checkTimeAfter -= "+(r+1)+"; break; }\n";case 157:return"  if (!!stack.pop()) { position = "+t.conditionalJumpTo+"; checkTimeAfter -= "+(r+1)+"; break; }\n";default:return"  calls."+t.action.actionName+"(ectx"+(t.action.args?",["+this.convertArgs(t.action.args,e,i,n)+"]":"")+");\n"}},t.prototype.generate=function(t){var e=this,i=t.blocks,r={},n=0,o=t.dataId,s="return function "+o+"(ectx) {\nvar position = 0;\nvar checkTimeAfter = 0;\nvar constantPool = ectx.constantPool, registers = ectx.registers, stack = ectx.stack;\n";return avm1DebuggerEnabled.value&&(s+="/* Running "+o+" */ if (Shumway.AVM1.Debugger.pause || Shumway.AVM1.Debugger.breakpoints."+o+") { debugger; }\n"),s+="while (!ectx.isEndOfActions) {\nif (checkTimeAfter <= 0) { checkTimeAfter = "+CHECK_AVM1_HANG_EVERY+"; ectx.context.checkTimeout(); }\nswitch(position) {\n",i.forEach((function(i){s+=" case "+i.label+":\n",i.items.forEach((function(i,o){s+=e.convertAction(i,n++,r,o,t)})),s+="  position = "+i.jump+";\n  checkTimeAfter -= "+i.items.length+";\n  break;\n"})),s+=" default: ectx.isEndOfActions = true; break;\n}\n}\nreturn stack.pop();};",s+="//# sourceURL="+o,new Function("calls","res",s)(getActionsCalls(),r)},t}(),instance,Telemetry={instance:instance},Debugger={pause:!1,breakpoints:{}};function avm1Warn(t,e,i,r,n){if(avm1ErrorsEnabled.value)try{throw new Error(t)}catch(t){}avm1WarningsEnabled.value&&Debug.warning.apply(console,arguments)}var MAX_AVM1_HANG_TIMEOUT=1e3,CHECK_AVM1_HANG_EVERY=1e3,MAX_AVM1_ERRORS_LIMIT=1e3,MAX_AVM1_STACK_LIMIT=256,AVM1ScopeListItemFlags;!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.TARGET=1]="TARGET",t[t.REPLACE_TARGET=2]="REPLACE_TARGET"}(AVM1ScopeListItemFlags||(AVM1ScopeListItemFlags={}));var AVM1ScopeListItem=function(t,e){this.scope=t,this.previousScopeItem=e,this.flags=AVM1ScopeListItemFlags.DEFAULT},GlobalPropertiesScope=function(t){function e(e,i){var r=t.call(this,e)||this;return r.alSetOwnProperty("this",new AVM1PropertyDescriptor(71,i)),r.alSetOwnProperty("_global",new AVM1PropertyDescriptor(71,e.globals)),r}return __extends(e,t),e}(AVM1Object),AVM1CallFrame=function(){function t(t,e,i,r,n){this.previousFrame=t,this.currentThis=e,this.fn=i,this.args=r,this.ectx=n,this.inSequence=!!t&&(t.calleeThis===e&&t.calleeFn===i),this.resetCallee()}return t.prototype.setCallee=function(t,e,i,r){this.calleeThis=t,this.calleeSuper=e,this.calleeFn=i},t.prototype.resetCallee=function(){this.calleeThis=null,this.calleeSuper=null,this.calleeFn=null},t}(),AVM1RuntimeUtilsImpl=function(){function t(t){this._context=t}return t.prototype.hasProperty=function(t,e){return as2HasProperty(this._context,t,e)},t.prototype.getProperty=function(t,e){return as2GetProperty(this._context,t,e)},t.prototype.setProperty=function(t,e,i){return as2SetProperty(this._context,t,e,i)},t.prototype.warn=function(t){avm1Warn.apply(null,arguments)},t}(),AVM1ContextImpl=function(t){function e(e){var i=this,r=e.swfVersion;return(i=t.call(this,r)||this).loaderInfo=e,i.sec=e.sec,i.globals=AVM1Globals.createGlobalsObject(i),i.actions=new AVM1NativeActions(i),i.initialScope=new AVM1ScopeListItem(i.globals,null),i.utils=new AVM1RuntimeUtilsImpl(i),i.isActive=!1,i.executionProhibited=!1,i.actionTracer=avm1TraceEnabled.value?new ActionTracer:null,i.abortExecutionAt=0,i.stackDepth=0,i.frame=null,i.isTryCatchListening=!1,i.errorsIgnored=0,i.deferScriptExecution=!0,i}return __extends(e,t),e.prototype._getExecutionContext=function(){return this.frame.ectx},e.prototype.resolveTarget=function(t){return avm1ResolveTarget(this._getExecutionContext(),t,!0)},e.prototype.resolveRoot=function(){return avm1ResolveRoot(this._getExecutionContext())},e.prototype.checkTimeout=function(){Date.now(),this.abortExecutionAt},e.prototype.pushCallFrame=function(t,e,i,r){var n=new AVM1CallFrame(this.frame,t,e,i,r);return this.frame=n,n},e.prototype.popCallFrame=function(){var t=this.frame.previousFrame;return this.frame=t,t},e.prototype.executeActions=function(t,e){if(!this.executionProhibited){var i=this.isActive;i||(this.isActive=!0,this.abortExecutionAt=avm1TimeoutDisabled.value?Number.MAX_VALUE:Date.now()+MAX_AVM1_HANG_TIMEOUT,this.errorsIgnored=0);try{executeActionsData(this,t,e)}catch(t){}this.isActive=i}},e.prototype.executeFunction=function(t,e,i){if(!this.executionProhibited){var r,n,o=this.isActive;o||(this.isActive=!0,this.abortExecutionAt=avm1TimeoutDisabled.value?Number.MAX_VALUE:Date.now()+MAX_AVM1_HANG_TIMEOUT,this.errorsIgnored=0);try{n=t.alCall(e,i)}catch(t){r=t}if(this.isActive=o,r)throw r;return n}},e}(AVM1Context);AVM1Context.create=function(t){return new AVM1ContextImpl(t)};var AVM1Error=function(t){this.error=t},AVM1CriticalError=function(t){function e(e,i){var r=t.call(this,e)||this;return r.error=i,r}return __extends(e,t),e}(Error);function isAVM1MovieClip(t){return"object"==typeof t&&t&&t instanceof AVM1MovieClip}function as2GetType(t){if(null===t)return"null";if("object"==typeof t){if(t instanceof AVM1MovieClip)return"movieclip";if(t instanceof AVM1Function)return"function"}return typeof t}function as2ToAddPrimitive(t,e){return alToPrimitive(t,e)}function as2Compare(t,e,i){var r=alToPrimitive(t,e),n=alToPrimitive(t,i);if("string"==typeof r&&"string"==typeof n)return alToString(t,r)<alToString(t,n);var o=alToNumber(t,r),s=alToNumber(t,n);return isNaN(o)||isNaN(s)?void 0:o<s}function as2Equals(t,e,i){return typeof e==typeof i?e===i:null==e&&null==i||("number"==typeof e&&"string"==typeof i?""!==i&&e===+i:"string"==typeof e&&"number"==typeof i?""!==e&&+e===i:"boolean"==typeof e&&(e=+e,"number"==typeof i||"string"==typeof i)?""!==i&&e===+i:"boolean"==typeof i&&(i=+i,"number"==typeof e||"string"==typeof e)?""!==e&&+e===i:"number"!=typeof e&&"string"!=typeof e||"object"!=typeof i||null===i?"object"==typeof e&&null!==e&&("number"==typeof i||"string"==typeof i)&&("object"!=typeof(e=alToPrimitive(t,e))&&as2Equals(t,e,i)):"object"!=typeof(i=alToPrimitive(t,i))&&as2Equals(t,e,i))}function as2InstanceOf(t,e){if(isNullOrUndefined$1(t)||isNullOrUndefined$1(e))return!1;if(e===ASString)return"string"==typeof t;if(e===ASNumber)return"number"==typeof t;if(e===ASBoolean)return"boolean"==typeof t;if(e===ASArray)return Array.isArray(t);if(e===ASFunction)return"function"==typeof t;if(e===ASObject)return"object"==typeof t;var i=e.alGetPrototypeProperty();if(!i)return!1;for(var r=t;r;){if(r===i)return!0;r=r.alPrototype}return!1}function as2HasProperty(t,e,i){var r=alToObject(t,e);return i=t.normalizeName(i),r.alHasProperty(i)}function as2GetProperty(t,e,i){var r=alToObject(t,e);if(r)return r.alGet(i)}function as2SetProperty(t,e,i,r){var n=alToObject(t,e);if(n)if("__proto__"==i){if(r){for(var o=r.alGetKeys(),s=0;s<o.length;s++){var a=o[s];""!=a&&(n.alPut(a,r.alGet(a)),as2SyncEvents(t,a,n))}n.protoTypeChanged=!(r instanceof AVM1MovieClip)}}else n.alPut(i,r),as2SyncEvents(t,i,n)}function as2DeleteProperty(t,e,i){var r=alToObject(t,e);i=t.normalizeName(i);var n=r.alDeleteProperty(i);return as2SyncEvents(t,i,r),n}function as2SyncEvents(t,e,i){void 0!==e&&(e=alCoerceString(t,e),"o"===(e=t.normalizeName(e))[0]&&"n"===e[1]&&i&&i.updateEventByPropName&&i.updateEventByPropName(e))}function as2CastError(t){return"undefined"!=typeof InternalError&&t instanceof InternalError&&"too much recursion"===t.message?new AVM1CriticalError("long running script -- AVM1 recursion limit is reached"):t}function as2Construct(t,e){if(alIsFunction(t))return t.alConstruct(e)}function as2Enumerate(t,e,i){if("boolean"!=typeof t&&"string"!=typeof t&&"number"!=typeof t){var r=Object.create(null),n=[];alForEachProperty(t,(function(t){"string"==typeof t&&-1!=t.indexOf("_internal_TF")||r[t]||(n[n.length]=t,r[t]=!0)}),i);for(var o=n.length,s=null;o>0;)o--,!(s=t.alGet(n[o]))||s.adaptee&&s.adaptee.isAsset(TextField)&&s.adaptee.isStatic||e.call(i,n[o])}}function avm1FindSuperPropertyOwner(t,e,i){if(t.swfVersion<6)return null;var r=e.inSequence&&e.previousFrame.calleeSuper;if(!r){for(r=e.currentThis;r&&!r.alHasOwnProperty(i);)r=r.alPrototype;if(!r)return null}return r=r.alPrototype}var DEFAULT_REGISTER_COUNT=4;function executeActionsData(t,e,i){t.actionTracer;var r,n=new AVM1ScopeListItem(new GlobalPropertiesScope(t,i),t.initialScope),o=new AVM1ScopeListItem(i,n);o.flags|=AVM1ScopeListItemFlags.TARGET;var s=ExecutionContext.create(t,o,[],DEFAULT_REGISTER_COUNT);t.pushCallFrame(i,null,null,s);try{interpretActionsData(s,e)}catch(t){r=as2CastError(t)}if(s.dispose(),r instanceof AVM1CriticalError&&(t.executionProhibited=!0,console.error("Disabling AVM1 execution")),t.popCallFrame(),r)throw r}function createBuiltinType(t,e,i){var r=t.builtins,n=void 0;if(e!==r.Array&&e!==r.Object&&e!==r.Date&&e!==r.String&&e!==r.Function||(n=e.alConstruct(i)),e!==r.Boolean&&e!==r.Number||(n=e.alConstruct(i).value),n instanceof AVM1Object){var o=new AVM1PropertyDescriptor(65,e);n.alSetOwnProperty("__constructor__",o)}return n}var AVM1SuperWrapper=function(t){function e(e,i){var r=t.call(this,e)||this;return r.callFrame=i,r.alPrototype=e.builtins.Object.alGetPrototypeProperty(),r}return __extends(e,t),e}(AVM1Object),AVM1Arguments=function(t){function e(e,i,r,n){var o=t.call(this,e,i)||this;return alDefineObjectProperties(o,{callee:{value:r},caller:{value:n}}),o}return __extends(e,t),e}(AVM1ArrayNative),ExecutionContext=function(){function t(t,e,i,r){this.context=t,this.actions=t.actions,this.isSwfVersion5=t.swfVersion>=5,this.isSwfVersion7=t.swfVersion>=7,this.registers=[],this.stack=[],this.frame=null,this.recoveringFromError=!1,this.isEndOfActions=!1,this.reset(e,i,r)}return t.alInitStatic=function(){this.cache=[]},t.prototype.reset=function(t,e,i){this.scopeList=t,this.constantPool=e,this.registers.length=i},t.prototype.clean=function(){this.scopeList=null,this.constantPool=null,this.registers.length=0,this.stack.length=0,this.frame=null,this.recoveringFromError=!1,this.isEndOfActions=!1},t.prototype.pushScope=function(t){var e=Object.create(this);return e.stack=[],isNullOrUndefined$1(t)||(e.scopeList=t),e},t.prototype.dispose=function(){this.clean();var e=this.context.getStaticState(t);e.cache.length<t.MAX_CACHED_EXECUTIONCONTEXTS&&e.cache.push(this)},t.create=function(e,i,r,n){var o,s=e.getStaticState(t);return s.cache.length>0?(o=s.cache.pop()).reset(i,r,n):o=new t(e,i,r,n),o},t.MAX_CACHED_EXECUTIONCONTEXTS=20,t}(),AVM1InterpreterScope=function(t){function e(e){var i=t.call(this,e)||this;return i.alPut("toString",new AVM1NativeFunction(e,i._toString)),i}return __extends(e,t),e.prototype._toString=function(){return this},e}(AVM1Object),AVM1InterpretedFunction=function(t){function e(e,i,r,n,o,s,a,l){var h=t.call(this,e)||this;h.functionName=n,h.actionsData=r,h.parametersNames=o,h.registersAllocation=a,h.suppressArguments=l,h.scopeList=i.scopeList,h.constantPool=i.constantPool;for(var c=null,u=a?a.length:0,p=0;p<u;p++){var d=a[p];d&&1===d.type&&(c||(c=[]),c[a[p].index]=!0)}h.skipArguments=c;var f=Math.min(s,255);return f=Math.max(f,u+1),h.registersLength=f,h}return __extends(e,t),e.prototype.alCall=function(t,e){var i=this.context;if(!i.executionProhibited){var r=new AVM1InterpreterScope(i),n=new AVM1ScopeListItem(r,this.scopeList),o=this.scopeList.scope;e=e||[];var s,a,l=ExecutionContext.create(i,n,this.constantPool,this.registersLength),h=i.frame?i.frame.fn:void 0,c=i.pushCallFrame(t,this,e,l),u=this.suppressArguments;4&u||r.alPut("arguments",new AVM1Arguments(i,e,this,h)),2&u||r.alPut("this",t),8&u||(s=new AVM1SuperWrapper(i,c),r.alPut("super",s));var p=l.registers,d=this.registersAllocation,f=d?d.length:0;for(a=0;a<f;a++){var _=d[a];if(_)switch(_.type){case 1:p[a]=e[_.index];break;case 2:p[a]=t;break;case 4:p[a]=new AVM1Arguments(i,e,this,h);break;case 8:s=s||new AVM1SuperWrapper(i,c),p[a]=s;break;case 16:p[a]=i.globals;break;case 32:var g=null;if(o&&((g=o.alGet("_parent"))||(g=o.alGet("this"))&&(g=g.alGet("_parent"))),!g&&((g=t)&&(g=g.alGet("_parent")),g&&this.isOnEnter&&g.alGet("_parent")&&(g=g.alGet("_parent")),!g&&this.scopeList&&this.scopeList.previousScopeItem&&this.scopeList.previousScopeItem.scope))for(var m=this.scopeList.previousScopeItem;m;)m.scope&&m.scope instanceof AVM1MovieClip?g=m.scope:m.scope&&(g=m.scope.alGet("this")),g&&(g=g.alGet("_parent")),m=m.previousScopeItem?m.previousScopeItem:null;g&&(p[a]=g);break;case 64:p[a]=avm1ResolveRoot(l)}}var y,v,b=this.parametersNames,x=this.skipArguments;for(a=0;a<e.length||a<b.length;a++)x&&x[a]||r.alPut(b[a],e[a]);i.actionTracer;var A=this.actionsData;if(++i.stackDepth>=MAX_AVM1_STACK_LIMIT)throw new AVM1CriticalError("long running script -- AVM1 recursion limit is reached");try{y=interpretActionsData(l,A)}catch(t){v=t}if(i.stackDepth--,i.popCallFrame(),l.dispose(),v)throw v;return y}},e}(AVM1EvalFunction);function fixArgsCount(t,e){return isNaN(t)||t<0?(avm1Warn("Invalid amount of arguments: "+t),0):(t|=0)>e?(avm1Warn("Truncating amount of arguments: from "+t+" to "+e),e):t}function avm1ReadFunctionArgs(t){var e=+t.pop();e=fixArgsCount(e,t.length);for(var i=[],r=0;r<e;r++)i.push(t.pop());return i}function avm1SetTarget(t,e){var i=null;if(e){if("string"==typeof e)for(;e.length&&"."==e[e.length-1];)e=e.substring(0,e.length-1);try{avm1IsTarget(i=avm1ResolveTarget(t,e,!1))||(avm1Warn("Invalid AVM1 target object: "+e),i=void 0)}catch(t){avm1Warn("Unable to set target: "+t)}}i?(t.scopeList.flags|=AVM1ScopeListItemFlags.REPLACE_TARGET,t.scopeList.replaceTargetBy=i):(t.scopeList.flags&=~AVM1ScopeListItemFlags.REPLACE_TARGET,t.scopeList.replaceTargetBy=null)}function avm1DefineFunction(t,e,i,r,n,o,s){return new AVM1InterpretedFunction(t.context,t,e,i,r,n,o,s)}function avm1VariableNameHasPath(t){return t&&(t.indexOf(".")>=0||t.indexOf(":")>=0||t.indexOf("/")>=0)}var cachedResolvedVariableResult={scope:null,propertyName:null,value:void 0};function avm1IsTarget(t){return t instanceof AVM1Object&&hasAwayJSAdaptee(t)}function avm1ResolveSimpleVariable(t,e,i,r){var n;void 0===r&&(r=null);for(var o=cachedResolvedVariableResult,s=t;s;s=s.previousScopeItem){if(!(s.flags&AVM1ScopeListItemFlags.REPLACE_TARGET)||64&i||n||(n=s.replaceTargetBy),s.flags&AVM1ScopeListItemFlags.TARGET){if(2&i)return o.scope=n||s.scope,o.propertyName=e,o.value=32&i?o.scope.alGet(e):void 0,o;if(1&i&&n){if(n.alHasProperty(e))return o.scope=n,o.propertyName=e,o.value=32&i?n.alGet(e):void 0,o;continue}}if(s.scope.alHasProperty(e)){var a=s.scope.alGet(e);if(r&&(!a||"object"!=typeof a||!a.alHasProperty||!a.alHasProperty(r)))continue;return o.scope=s.scope,o.propertyName=e,o.value=32&i?s.scope.alGet(e):void 0,o}}}function avm1ResolveVariable(t,e,i){var r=e;if("string"==typeof(e=t.context.normalizeName(e))&&(e=e.replace("_level0","_root")),!avm1VariableNameHasPath(e))return avm1ResolveSimpleVariable(t.scopeList,e,i);if("."==e[e.length-1])return null;var n,o,s,a=0,l=e.length,h=!0,c=null,u=null,p=void 0;if("/"===e[0]?((n=avm1ResolveSimpleVariable(t.scopeList,"_root",33))&&(c=n.propertyName,u=n.scope,p=n.value),a++,s=!1):(n=null,s=!0),a>=l)return n;for(var d=a;a<l;){if(!(s||p instanceof AVM1Object))return avm1Warn("Unable to resolve variable on invalid object "+e.substring(d,a-1)+" (expr "+e+")"),null;d=a;if("."===e[a]&&"."===e[a+1])a+=2,c="_parent";else{for(;a<l&&"/"!==(o=e[a])&&"."!==o&&":"!==o;)a++;c=e.substring(d,a)}if(""===c&&a<l)a++;else{u=p;var f=!1;if(h){var _=p instanceof AVM1MovieClip?p._lookupChildByName(c):void 0;_&&(f=!0,p=_)}if(!f)if(s){d=a+1;var g=a+1,m="";if("."===e[g]&&"."===e[g+1])g+=2,m="_parent";else{for(;g<l&&"/"!==(o=e[g])&&"."!==o&&":"!==o;)g++;m=e.substring(d,g)}""==m&&(m=null),!(n=avm1ResolveSimpleVariable(t.scopeList,c,i,m))&&m&&(n=avm1ResolveSimpleVariable(t.scopeList,c,i)),n&&(f=!0,c=n.propertyName,u=n.scope,p=n.value,a<l&&!p&&u&&(p=u)),s=!1}else p.alHasProperty(c)&&(p=p.alGet(c),f=!0);if(f||"_"!==c[0]||("_level0"===c?(p=t.context.resolveLevel(0),f=!0):"_root"===c&&(p=avm1ResolveRoot(t),f=!0)),!(f||2&i))return avm1Warn("Unable to resolve "+c+" on "+e.substring(d,a-1)+" (expr "+e+")"),null;if(a>=l)break;var y=e[a++];"/"!==y||":"!==(o=e[a])&&"."!==o||(y=e[a++]),h="/"===y}}return(n=cachedResolvedVariableResult).scope=u,n.propertyName=r.substring(d,a),n.value=32&i?p:void 0,n}function avm1GetTarget(t,e){for(var i=t.scopeList;i.previousScopeItem;i=i.previousScopeItem){if(i.flags&AVM1ScopeListItemFlags.REPLACE_TARGET&&e)return i.replaceTargetBy;if(i.flags&AVM1ScopeListItemFlags.TARGET)return i.scope}}function avm1ResolveTarget(t,e,i){var r;if(avm1IsTarget(e))r=e;else if(e=isNullOrUndefined$1(e)?"":alToString(this,e)){var n=alToString(t.context,e),o=avm1ResolveVariable(t,n,161|(i?0:64));o&&avm1IsTarget(o.value)?r=o.value:(avm1Warn("Invalid AVM1 target object: "+n),r=void 0)}else r=avm1GetTarget(t,!0);return r}function avm1ResolveRoot(t){return avm1GetTarget(t,!0).get_root()}function avm1ProcessWith(t,e,i){if(isNullOrUndefined$1(e))avm1Warn("The with statement object cannot be undefined.");else{var r=t.context,n=t.scopeList,o=new AVM1ScopeListItem(alToObject(r,e),n);interpretActionsData(t.pushScope(o),i)}}function avm1ProcessTry(t,e,i,r,n,o,s,a){var l,h=t.context,c=t.scopeList,u=t.registers,p=h.isTryCatchListening;try{h.isTryCatchListening=!0,interpretActionsData(t.pushScope(),o)}catch(e){if(h.isTryCatchListening=p,r&&e instanceof AVM1Error){if("string"==typeof n)c.scope.alPut(n,e.error);else u[n]=e.error;interpretActionsData(t.pushScope(),s)}else l=e}if(h.isTryCatchListening=p,i&&interpretActionsData(t.pushScope(),a),l)throw l}function avm1_0x81_ActionGotoFrame(t,e){var i=e[0];e[1]?t.actions.gotoAndPlay(i+1):t.actions.gotoAndStop(i+1)}function avm1_0x83_ActionGetURL(t,e){t.actions;var i=e[0],r=e[1];t.actions.getURL(i,r)}function avm1_0x04_ActionNextFrame(t){t.actions.nextFrame()}function avm1_0x05_ActionPreviousFrame(t){t.actions.prevFrame()}function avm1_0x06_ActionPlay(t){t.actions.play()}function avm1_0x07_ActionStop(t){t.actions.stop()}function avm1_0x08_ActionToggleQuality(t){t.actions.toggleHighQuality()}function avm1_0x09_ActionStopSounds(t){t.actions.stopAllSounds()}function avm1_0x8A_ActionWaitForFrame(t,e){var i=e[0];e[1];return!t.actions.ifFrameLoaded(i)}function avm1_0x8B_ActionSetTarget(t,e){avm1SetTarget(t,e[0])}function avm1_0x8C_ActionGoToLabel(t,e){var i=e[0];e[1]?t.actions.gotoAndPlay(i):t.actions.gotoAndStop(i)}function avm1_0x96_ActionPush(t,e){var i=t.registers,r=t.constantPool,n=t.stack;e.forEach((function(t){if(t instanceof ParsedPushConstantAction)n.push(r[t.constantIndex]);else if(t instanceof ParsedPushRegisterAction){var e=t.registerNumber;e<0||e>=i.length?n.push(void 0):n.push(i[e])}else n.push(t)}))}function avm1_0x17_ActionPop(t){t.stack.pop()}function avm1_0x0A_ActionAdd(t){var e=t.stack,i=alToNumber(t.context,e.pop()),r=alToNumber(t.context,e.pop());t.isSwfVersion7||(void 0===i&&(i=0),void 0===r&&(r=0)),isNaN(i)||isNaN(r)?e.push(NaN):e.push(Number(big(Number(i)).add(big(Number(r)))))}function avm1_0x0B_ActionSubtract(t){var e=t.stack,i=alToNumber(t.context,e.pop()),r=alToNumber(t.context,e.pop());t.isSwfVersion7||(void 0===i&&(i=0),void 0===r&&(r=0)),isNaN(i)||isNaN(r)?e.push(NaN):e.push(Number(big(Number(r)).sub(big(Number(i)))))}function avm1_0x0C_ActionMultiply(t){var e=t.stack,i=alToNumber(t.context,e.pop()),r=alToNumber(t.context,e.pop());t.isSwfVersion7||(void 0===i&&(i=0),void 0===r&&(r=0)),isNaN(i)||isNaN(r)?e.push(NaN):e.push(Number(big(Number(i)).mul(big(Number(r)))))}function avm1_0x0D_ActionDivide(t){var e=t.stack,i=t.isSwfVersion5,r=alToNumber(t.context,e.pop()),n=alToNumber(t.context,e.pop());t.isSwfVersion7||(void 0===r&&(r=0),void 0===n&&(n=0)),isNaN(r)||isNaN(n)||0==r&&0==n?e.push(NaN):0==r?e.push(i?"#ERROR#":n>0?1/0:-1/0):e.push(Number(big(Number(n)).div(big(Number(r)))))}function avm1_0x0E_ActionEquals(t){var e=t.stack,i=t.isSwfVersion5,r=alToNumber(t.context,e.pop())==alToNumber(t.context,e.pop());e.push(i?r:r?1:0)}function avm1_0x0F_ActionLess(t){var e=t.stack,i=t.isSwfVersion5,r=alToNumber(t.context,e.pop()),n=alToNumber(t.context,e.pop())<r;e.push(i?n:n?1:0)}function avm1_0x10_ActionAnd(t){var e=t.stack,i=t.isSwfVersion5,r=alToBoolean(t.context,e.pop()),n=alToBoolean(t.context,e.pop()),o=r&&n;e.push(i?o:o?1:0)}function avm1_0x11_ActionOr(t){var e=t.stack,i=t.isSwfVersion5,r=alToBoolean(t.context,e.pop()),n=alToBoolean(t.context,e.pop()),o=r||n;e.push(i?o:o?1:0)}function avm1_0x12_ActionNot(t){var e=t.stack,i=t.isSwfVersion5,r=e.pop();"string"==typeof r&&(r=!1);var n=!alToBoolean(t.context,r);e.push(i?n:n?1:0)}function avm1_0x13_ActionStringEquals(t){var e=t.stack,i=t.isSwfVersion5,r=alToString(t.context,e.pop())==alToString(t.context,e.pop());e.push(i?r:r?1:0)}function avm1_0x14_ActionStringLength(t){var e=t.stack,i=alToString(t.context,e.pop());e.push(t.actions.length_(i))}function avm1_0x31_ActionMBStringLength(t){var e=t.stack,i=alToString(t.context,e.pop());e.push(t.actions.length_(i))}function avm1_0x21_ActionStringAdd(t){var e=t.stack,i=alToString(t.context,e.pop()),r=alToString(t.context,e.pop());e.push(r+i)}function avm1_0x15_ActionStringExtract(t){var e=t.stack,i=e.pop(),r=e.pop(),n=alToString(t.context,e.pop());e.push(t.actions.substring(n,r,i))}function avm1_0x35_ActionMBStringExtract(t){var e=t.stack,i=e.pop(),r=e.pop(),n=alToString(t.context,e.pop());e.push(t.actions.mbsubstring(n,r,i))}function avm1_0x29_ActionStringLess(t){var e=t.stack,i=t.isSwfVersion5,r=alToString(t.context,e.pop()),n=alToString(t.context,e.pop())<r;e.push(i?n:n?1:0)}function avm1_0x18_ActionToInteger(t){var e=t.stack,i=alToInt32(t.context,e.pop());e.push(i)}function avm1_0x32_ActionCharToAscii(t){var e=t.stack,i=e.pop(),r=t.actions.ord(i);e.push(r)}function avm1_0x36_ActionMBCharToAscii(t){var e=t.stack,i=e.pop(),r=t.actions.mbord(i);e.push(r)}function avm1_0x33_ActionAsciiToChar(t){var e=t.stack,i=+e.pop(),r=t.actions.chr(i);e.push(r)}function avm1_0x37_ActionMBAsciiToChar(t){var e=t.stack,i=+e.pop(),r=t.actions.mbchr(i);e.push(r)}function avm1_0x99_ActionJump(t,e){}function avm1_0x9D_ActionIf(t,e){var i=t.stack;e[0];return!!i.pop()}function avm1_0x9E_ActionCall(t){var e=t.stack.pop();t.actions.call(e)}function avm1_0x1C_ActionGetVariable(t){var e=t.stack,i=e.pop();i&&(i=alToString(t.context,i));var r=e.length;e.push(void 0);var n=avm1ResolveVariable(t,i,33);isNullOrUndefined$1(n)?"TRUE"==i?e[r]=!0:"FALSE"==i?e[r]=!1:i&&0==i.indexOf("this.")?(n=avm1ResolveVariable(t,i=i.replace("this.",""),33),e[r]=n?n.value:void 0):avm1WarningsEnabled.value&&avm1Warn("AVM1 warning: cannot look up variable '"+i+"'"):e[r]=n?n.value:void 0}function avm1_0x1D_ActionSetVariable(t){var e=t.stack,i=e.pop(),r=""+e.pop(),n=avm1ResolveVariable(t,r,2);n?(n.scope.alPut(n.propertyName,i),as2SyncEvents(t.context,n.propertyName,n.scope)):avm1WarningsEnabled.value&&avm1Warn("AVM1 warning: cannot look up variable '"+r+"'")}function avm1_0x9A_ActionGetURL2(t,e){var i,r=t.stack,n=e[0],o=r.pop(),s=r.pop();1&n?i="GET":2&n&&(i="POST");var a=64&n;128&n?t.actions.loadVariables(s,o,i):a?t.actions.loadMovie(s,o,i):t.actions.getURL(s,o,i)}function avm1_0x9F_ActionGotoFrame2(t,e){var i=t.stack,r=e[0],n=[i.pop()];2&r&&n.push(e[1]),(1&r?t.actions.gotoAndPlay:t.actions.gotoAndStop).apply(t.actions,n)}function avm1_0x20_ActionSetTarget2(t){var e=t.stack;avm1SetTarget(t,alToString(t.context,e.pop()))}function avm1_0x22_ActionGetProperty(t){var e=t.stack,i=e.pop(),r=e.pop(),n=e.length;e.push(void 0);var o=avm1ResolveTarget(t,r,!0),s=MovieClipProperties[i];o&&s&&(e[n]=o.alGet(s))}function avm1_0x23_ActionSetProperty(t){var e=t.stack,i=e.pop(),r=e.pop(),n=avm1ResolveTarget(t,e.pop(),!0),o=MovieClipProperties[r];n&&o&&n.alPut(o,i)}function avm1_0x24_ActionCloneSprite(t){var e=t.stack,i=e.pop(),r=e.pop(),n=e.pop();t.actions.duplicateMovieClip(n,r,i)}function avm1_0x25_ActionRemoveSprite(t){var e=t.stack.pop();t.actions.removeMovieClip(e)}function avm1_0x27_ActionStartDrag(t){var e=t.stack,i=e.pop(),r=e.pop(),n=e.pop()?{y2:e.pop(),x2:e.pop(),y1:e.pop(),x1:e.pop()}:null,o=[i,r];n&&(o=o.concat(n.x1,n.y1,n.x2,n.y2)),t.actions.startDrag.apply(t.actions,o)}function avm1_0x28_ActionEndDrag(t){t.actions.stopDrag()}function avm1_0x8D_ActionWaitForFrame2(t,e){var i=t.stack,r=(e[0],i.pop());return!t.actions.ifFrameLoaded(r)}function avm1_0x26_ActionTrace(t){var e=t.stack.pop();t.actions.trace(e)}function avm1_0x34_ActionGetTime(t){t.stack.push(t.actions.getTimer())}function avm1_0x30_ActionRandomNumber(t){var e=t.stack;e.push(t.actions.random(e.pop()))}function avm1_0x3D_ActionCallFunction(t){var e=t.stack,i=e.pop(),r=avm1ReadFunctionArgs(e),n=e.length;e.push(void 0);var o=avm1ResolveVariable(t,i,33);if(isNullOrUndefined$1(o))avm1Warn("AVM1 warning: cannot look up function '"+i+"'");else{var s=o.value;alIsFunction(s)?("array"==i.toLowerCase()&&(r=[r]),e[n]=s.alCall(o.scope||null,r)):avm1Warn("AVM1 warning: function '"+i+(s?"' is not callable":"' is undefined"))}}function avm1_0x52_ActionCallMethod(t){var e,i=t.stack,r=i.pop(),n=i.pop(),o=avm1ReadFunctionArgs(i),s=i.length;if(i.push(void 0),isNullOrUndefined$1(n))avm1Warn("AVM1 warning: method '"+r+"' can't be called on undefined object");else{var a,l=t.context.frame;if(isNullOrUndefined$1(r)||""===r){if(n instanceof AVM1SuperWrapper){var h=n.callFrame;(c=avm1FindSuperPropertyOwner(t.context,h,"__constructor__"))&&(a=c.alGet("__constructor__"),e=h.currentThis)}else a=n,e=n;alIsFunction(a)?(l.setCallee(e,c,a,o),i[s]=a.alCall(e,o),l.resetCallee()):avm1Warn("AVM1 warning: obj '"+n+(n?"' is not callable":"' is undefined"))}else{if(n instanceof AVM1SuperWrapper){var c;h=n.callFrame;(c=avm1FindSuperPropertyOwner(t.context,h,r))&&(a=c.alGet(r),e=h.currentThis)}else a=as2GetProperty(t.context,n,r),e=alToObject(t.context,n);alIsFunction(a)?(l.setCallee(e,c,a,o),"toString"==r&&"number"==typeof n?1==o.length&&16==o[0]?i[s]=n.toString(16).toString():i[s]=alToString(t.context,n):i[s]=a.alCall(e,o),l.resetCallee()):"function"==typeof a?i[s]=a(o):avm1Warn("AVM1 warning: method '"+r+"' on object",n,isNullOrUndefined$1(a)?"is undefined":"is not callable")}}}function avm1_0x88_ActionConstantPool(t,e){var i=e[0];t.constantPool=i}function avm1_0x9B_ActionDefineFunction(t,e){var i=t.stack,r=e[0],n=e[1],o=avm1DefineFunction(t,r,n,e[2],4,null,0);if(n){var s=t.scopeList.scope;s.alPut(n,o),as2SyncEvents(t.context,n,s)}else i.push(o)}function avm1_0x3C_ActionDefineLocal(t){var e=t.stack,i=t.scopeList.scope,r=e.pop(),n=e.pop();i.alPut(n,r)}function avm1_0x41_ActionDefineLocal2(t){var e=t.stack,i=t.scopeList.scope,r=e.pop();i.alHasProperty(r)||i.alPut(r,void 0)}function avm1_0x3A_ActionDelete(t){var e=t.stack,i=e.pop(),r=e.pop();isNullOrUndefined$1(r)?avm1Warn("AVM1 warning: cannot delete member '"+i+"' on undefined object"):e.push(as2DeleteProperty(t.context,r,i))}function avm1_0x3B_ActionDelete2(t){var e=t.stack,i=e.pop(),r=avm1ResolveVariable(t,i,1);if(isNullOrUndefined$1(r))avm1Warn("AVM1 warning: cannot look up variable '"+i+"'");else{var n=r.scope.alGetProperty(i);n&&n.value&&n.value.adaptee||e.push(as2DeleteProperty(t.context,r.scope,i))}}function avm1_0x46_ActionEnumerate(t){var e=t.stack,i=e.pop();e.push(null);var r=avm1ResolveVariable(t,i,33);if(isNullOrUndefined$1(r))avm1Warn("AVM1 warning: cannot look up variable '"+i+"'");else{var n=r.value;isNullOrUndefined$1(n)?avm1Warn("AVM1 warning: cannot iterate over undefined object"):as2Enumerate(n,(function(t){e.push(t)}),null)}}function avm1_0x49_ActionEquals2(t){var e=t.stack,i=e.pop(),r=e.pop();e.push(as2Equals(t.context,i,r))}function avm1_0x4E_ActionGetMember(t){var e=t.stack,i=e.pop(),r=e.pop();if(e.push(void 0),isNullOrUndefined$1(r))avm1Warn("AVM1 warning: cannot get member '"+i+"' on undefined object");else if(r instanceof AVM1SuperWrapper){var n=r.callFrame,o=avm1FindSuperPropertyOwner(t.context,n,i);o&&(e[e.length-1]=o.alGet(i))}else e[e.length-1]=as2GetProperty(t.context,r,i)}function avm1_0x42_ActionInitArray(t){var e=t.stack,i=new AVM1ArrayNative(t.context,avm1ReadFunctionArgs(e));e.push(i)}function avm1_0x43_ActionInitObject(t){var e=t.stack,i=+e.pop();i=fixArgsCount(i,e.length>>1);for(var r=alNewObject(t.context),n=0;n<i;n++){var o=e.pop(),s=e.pop();r.alPut(s,o)}e.push(r)}function avm1_0x53_ActionNewMethod(t){var e=t.stack,i=e.pop(),r=e.pop(),n=avm1ReadFunctionArgs(e),o=e.length;if(e.push(void 0),isNullOrUndefined$1(r))avm1Warn("AVM1 warning: method '"+i+"' can't be constructed on undefined object");else{var s=as2Construct(isNullOrUndefined$1(i)||""===i?r:as2GetProperty(t.context,r,i),n);void 0===s&&avm1Warn("AVM1 warning: method '"+i+"' on object",r,"is not constructible"),e[o]=s}}function avm1_0x40_ActionNewObject(t){var e=t.stack,i=e.pop(),r=avm1ReadFunctionArgs(e),n=e.length;e.push(void 0);var o=avm1ResolveVariable(t,i,33);if(isNullOrUndefined$1(o))avm1Warn("AVM1 warning: cannot look up object '"+i+"'");else{var s=o.value,a=createBuiltinType(t.context,s,r);void 0===a&&void 0===(a=as2Construct(s,r))&&avm1Warn("AVM1 warning: object '"+i+(s?"' is not constructible":"' is undefined")),e[n]=a}}function avm1_0x4F_ActionSetMember(t){var e=t.stack,i=e.pop(),r=e.pop(),n=e.pop();if(isNullOrUndefined$1(n))avm1Warn("AVM1 warning: cannot set member '"+r+"' on undefined object");else if(n instanceof AVM1SuperWrapper)avm1Warn("AVM1 warning: cannot set member '"+r+"' on super");else if(void 0!==r){if("string"==typeof r){var o=r.split(".");if(o.length>1){for(;o.length>1;){var s=o.shift(),a=n.alGet(s);if(!(a instanceof AVM1Object))return void avm1Warn("AVM1 warning: cannot set member '"+r+"' on super");n=a}1==o.length&&(r=o[0])}}as2SetProperty(t.context,n,r,i)}}function avm1_0x45_ActionTargetPath(t){var e=t.stack,i=e.pop();e.push(isAVM1MovieClip(i)?i._target:void 0)}function avm1_0x94_ActionWith(t,e){var i=t.stack,r=e[0];avm1ProcessWith(t,i.pop(),r)}function avm1_0x4A_ActionToNumber(t){var e=t.stack;e.push(alToNumber(t.context,e.pop()))}function avm1_0x4B_ActionToString(t){var e=t.stack;e.push(alToString(t.context,e.pop()))}function avm1_0x44_ActionTypeOf(t){var e=t.stack,i=as2GetType(e.pop());e.push(i)}function avm1_0x47_ActionAdd2(t){var e=t.stack,i=as2ToAddPrimitive(t.context,e.pop()),r=as2ToAddPrimitive(t.context,e.pop());"string"==typeof i||"string"==typeof r?e.push(alToString(t.context,r)+alToString(t.context,i)):(t.isSwfVersion7||(void 0===i&&(i=0),void 0===r&&(r=0)),isNaN(i)||isNaN(r)?e.push(NaN):e.push(Number(big(Number(i)).add(big(Number(r))))))}function avm1_0x48_ActionLess2(t){var e=t.stack,i=e.pop(),r=e.pop();e.push(as2Compare(t.context,r,i))}function avm1_0x3F_ActionModulo(t){var e=t.stack,i=alToNumber(t.context,e.pop()),r=alToNumber(t.context,e.pop());t.isSwfVersion7||(void 0===i&&(i=0),void 0===r&&(r=0)),isNaN(i)||isNaN(r)||0==i?e.push(NaN):e.push(Number(big(Number(r)).mod(big(Number(i)))))}function avm1_0x60_ActionBitAnd(t){var e=t.stack,i=alToInt32(t.context,e.pop()),r=alToInt32(t.context,e.pop());e.push(r&i)}function avm1_0x63_ActionBitLShift(t){var e=t.stack,i=alToInt32(t.context,e.pop()),r=alToInt32(t.context,e.pop());e.push(r<<i)}function avm1_0x61_ActionBitOr(t){var e=t.stack,i=alToInt32(t.context,e.pop()),r=alToInt32(t.context,e.pop());e.push(r|i)}function avm1_0x64_ActionBitRShift(t){var e=t.stack,i=alToInt32(t.context,e.pop()),r=alToInt32(t.context,e.pop());e.push(r>>i)}function avm1_0x65_ActionBitURShift(t){var e=t.stack,i=alToInt32(t.context,e.pop()),r=alToInt32(t.context,e.pop());e.push(r>>>i)}function avm1_0x62_ActionBitXor(t){var e=t.stack,i=alToInt32(t.context,e.pop()),r=alToInt32(t.context,e.pop());e.push(r^i)}function avm1_0x51_ActionDecrement(t){var e=t.stack,i=alToNumber(t.context,e.pop());i--,e.push(i)}function avm1_0x50_ActionIncrement(t){var e=t.stack,i=alToNumber(t.context,e.pop());i++,e.push(i)}function avm1_0x4C_ActionPushDuplicate(t){var e=t.stack;e.push(e[e.length-1])}function avm1_0x3E_ActionReturn(t){t.isEndOfActions=!0}function avm1_0x4D_ActionStackSwap(t){var e=t.stack;e.push(e.pop(),e.pop())}function avm1_0x87_ActionStoreRegister(t,e){var i=t.stack,r=t.registers,n=e[0];n<0||n>=r.length||(r[n]=i[i.length-1])}function avm1_0x54_ActionInstanceOf(t){var e=t.stack,i=e.pop(),r=e.pop();e.push(as2InstanceOf(r,i))}function avm1_0x55_ActionEnumerate2(t){var e=t.stack,i=e.pop();e.push(null),isNullOrUndefined$1(i)?avm1Warn("AVM1 warning: cannot iterate over undefined object"):as2Enumerate(i,(function(t){e.push(t)}),null)}function avm1_0x66_ActionStrictEquals(t){var e=t.stack,i=e.pop(),r=e.pop();e.push(r===i)}function avm1_0x67_ActionGreater(t){var e=t.stack,i=e.pop(),r=e.pop();e.push(as2Compare(t.context,i,r))}function avm1_0x68_ActionStringGreater(t){var e=t.stack,i=t.isSwfVersion5,r=alToString(t.context,e.pop()),n=alToString(t.context,e.pop())>r;e.push(i?n:n?1:0)}function avm1_0x8E_ActionDefineFunction2(t,e){var i=t.stack,r=t.scopeList.scope,n=e[0],o=e[1],s=avm1DefineFunction(t,n,o,e[2],e[3],e[4],e[5]);o?(r.alPut(o,s),as2SyncEvents(t.context,o,r)):i.push(s)}function avm1_0x69_ActionExtends(t){var e=t.stack,i=t.context,r=alToObject(i,e.pop()),n=alToObject(i,e.pop()).alGetPrototypeProperty(),o=r.alGetPrototypeProperty();n.alPrototype=o;var s=new AVM1PropertyDescriptor(65,r);n.alSetOwnProperty("__constructor__",s)}function avm1_0x2B_ActionCastOp(t){var e=t.stack,i=e.pop(),r=e.pop();e.push(as2InstanceOf(i,r)?i:null)}function avm1_0x2C_ActionImplementsOp(t){var e=t.stack,i=e.pop(),r=+e.pop();fixArgsCount(r,e.length);for(var n=[],o=0;o<r;o++)n.push(e.pop());i._as2Interfaces=n}function avm1_0x8F_ActionTry(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4];avm1ProcessTry(t,i,e[5],o,r,n,s,e[6])}function avm1_0x2A_ActionThrow(t){var e=t.stack.pop();throw new AVM1Error(e)}function avm1_0x2D_ActionFSCommand2(t){var e=t.stack,i=avm1ReadFunctionArgs(e),r=e.length;e.push(void 0);var n=t.actions.fscommand.apply(t.actions,i);e[r]=n}function avm1_0x89_ActionStrictMode(t,e){e[0]}function wrapAvm1Error(t){return function(e,i){t(e,i),e.recoveringFromError=!1}}function generateActionCalls(){var t;return{ActionGotoFrame:(t=avm1ErrorsEnabled.value?function(t){return t}:wrapAvm1Error)(avm1_0x81_ActionGotoFrame),ActionGetURL:t(avm1_0x83_ActionGetURL),ActionNextFrame:t(avm1_0x04_ActionNextFrame),ActionPreviousFrame:t(avm1_0x05_ActionPreviousFrame),ActionPlay:t(avm1_0x06_ActionPlay),ActionStop:t(avm1_0x07_ActionStop),ActionToggleQuality:t(avm1_0x08_ActionToggleQuality),ActionStopSounds:t(avm1_0x09_ActionStopSounds),ActionWaitForFrame:t(avm1_0x8A_ActionWaitForFrame),ActionSetTarget:t(avm1_0x8B_ActionSetTarget),ActionGoToLabel:t(avm1_0x8C_ActionGoToLabel),ActionPush:t(avm1_0x96_ActionPush),ActionPop:t(avm1_0x17_ActionPop),ActionAdd:t(avm1_0x0A_ActionAdd),ActionSubtract:t(avm1_0x0B_ActionSubtract),ActionMultiply:t(avm1_0x0C_ActionMultiply),ActionDivide:t(avm1_0x0D_ActionDivide),ActionEquals:t(avm1_0x0E_ActionEquals),ActionLess:t(avm1_0x0F_ActionLess),ActionAnd:t(avm1_0x10_ActionAnd),ActionOr:t(avm1_0x11_ActionOr),ActionNot:t(avm1_0x12_ActionNot),ActionStringEquals:t(avm1_0x13_ActionStringEquals),ActionStringLength:t(avm1_0x14_ActionStringLength),ActionMBStringLength:t(avm1_0x31_ActionMBStringLength),ActionStringAdd:t(avm1_0x21_ActionStringAdd),ActionStringExtract:t(avm1_0x15_ActionStringExtract),ActionMBStringExtract:t(avm1_0x35_ActionMBStringExtract),ActionStringLess:t(avm1_0x29_ActionStringLess),ActionToInteger:t(avm1_0x18_ActionToInteger),ActionCharToAscii:t(avm1_0x32_ActionCharToAscii),ActionMBCharToAscii:t(avm1_0x36_ActionMBCharToAscii),ActionAsciiToChar:t(avm1_0x33_ActionAsciiToChar),ActionMBAsciiToChar:t(avm1_0x37_ActionMBAsciiToChar),ActionJump:t(avm1_0x99_ActionJump),ActionIf:t(avm1_0x9D_ActionIf),ActionCall:t(avm1_0x9E_ActionCall),ActionGetVariable:t(avm1_0x1C_ActionGetVariable),ActionSetVariable:t(avm1_0x1D_ActionSetVariable),ActionGetURL2:t(avm1_0x9A_ActionGetURL2),ActionGotoFrame2:t(avm1_0x9F_ActionGotoFrame2),ActionSetTarget2:t(avm1_0x20_ActionSetTarget2),ActionGetProperty:t(avm1_0x22_ActionGetProperty),ActionSetProperty:t(avm1_0x23_ActionSetProperty),ActionCloneSprite:t(avm1_0x24_ActionCloneSprite),ActionRemoveSprite:t(avm1_0x25_ActionRemoveSprite),ActionStartDrag:t(avm1_0x27_ActionStartDrag),ActionEndDrag:t(avm1_0x28_ActionEndDrag),ActionWaitForFrame2:t(avm1_0x8D_ActionWaitForFrame2),ActionTrace:t(avm1_0x26_ActionTrace),ActionGetTime:t(avm1_0x34_ActionGetTime),ActionRandomNumber:t(avm1_0x30_ActionRandomNumber),ActionCallFunction:t(avm1_0x3D_ActionCallFunction),ActionCallMethod:t(avm1_0x52_ActionCallMethod),ActionConstantPool:t(avm1_0x88_ActionConstantPool),ActionDefineFunction:t(avm1_0x9B_ActionDefineFunction),ActionDefineLocal:t(avm1_0x3C_ActionDefineLocal),ActionDefineLocal2:t(avm1_0x41_ActionDefineLocal2),ActionDelete:t(avm1_0x3A_ActionDelete),ActionDelete2:t(avm1_0x3B_ActionDelete2),ActionEnumerate:t(avm1_0x46_ActionEnumerate),ActionEquals2:t(avm1_0x49_ActionEquals2),ActionGetMember:t(avm1_0x4E_ActionGetMember),ActionInitArray:t(avm1_0x42_ActionInitArray),ActionInitObject:t(avm1_0x43_ActionInitObject),ActionNewMethod:t(avm1_0x53_ActionNewMethod),ActionNewObject:t(avm1_0x40_ActionNewObject),ActionSetMember:t(avm1_0x4F_ActionSetMember),ActionTargetPath:t(avm1_0x45_ActionTargetPath),ActionWith:t(avm1_0x94_ActionWith),ActionToNumber:t(avm1_0x4A_ActionToNumber),ActionToString:t(avm1_0x4B_ActionToString),ActionTypeOf:t(avm1_0x44_ActionTypeOf),ActionAdd2:t(avm1_0x47_ActionAdd2),ActionLess2:t(avm1_0x48_ActionLess2),ActionModulo:t(avm1_0x3F_ActionModulo),ActionBitAnd:t(avm1_0x60_ActionBitAnd),ActionBitLShift:t(avm1_0x63_ActionBitLShift),ActionBitOr:t(avm1_0x61_ActionBitOr),ActionBitRShift:t(avm1_0x64_ActionBitRShift),ActionBitURShift:t(avm1_0x65_ActionBitURShift),ActionBitXor:t(avm1_0x62_ActionBitXor),ActionDecrement:t(avm1_0x51_ActionDecrement),ActionIncrement:t(avm1_0x50_ActionIncrement),ActionPushDuplicate:t(avm1_0x4C_ActionPushDuplicate),ActionReturn:t(avm1_0x3E_ActionReturn),ActionStackSwap:t(avm1_0x4D_ActionStackSwap),ActionStoreRegister:t(avm1_0x87_ActionStoreRegister),ActionInstanceOf:t(avm1_0x54_ActionInstanceOf),ActionEnumerate2:t(avm1_0x55_ActionEnumerate2),ActionStrictEquals:t(avm1_0x66_ActionStrictEquals),ActionGreater:t(avm1_0x67_ActionGreater),ActionStringGreater:t(avm1_0x68_ActionStringGreater),ActionDefineFunction2:t(avm1_0x8E_ActionDefineFunction2),ActionExtends:t(avm1_0x69_ActionExtends),ActionCastOp:t(avm1_0x2B_ActionCastOp),ActionImplementsOp:t(avm1_0x2C_ActionImplementsOp),ActionTry:t(avm1_0x8F_ActionTry),ActionThrow:t(avm1_0x2A_ActionThrow),ActionFSCommand2:t(avm1_0x2D_ActionFSCommand2),ActionStrictMode:t(avm1_0x89_ActionStrictMode)}}function interpretAction(t,e){t.stack;var i=e.actionCode,r=e.args,n=(t.context.actionTracer,!1);switch(0|i){case 129:avm1_0x81_ActionGotoFrame(t,r);break;case 131:avm1_0x83_ActionGetURL(t,r);break;case 4:avm1_0x04_ActionNextFrame(t);break;case 5:avm1_0x05_ActionPreviousFrame(t);break;case 6:avm1_0x06_ActionPlay(t);break;case 7:avm1_0x07_ActionStop(t);break;case 8:avm1_0x08_ActionToggleQuality(t);break;case 9:avm1_0x09_ActionStopSounds(t);break;case 138:n=avm1_0x8A_ActionWaitForFrame(t,r);break;case 139:avm1_0x8B_ActionSetTarget(t,r);break;case 140:avm1_0x8C_ActionGoToLabel(t,r);break;case 150:avm1_0x96_ActionPush(t,r);break;case 23:avm1_0x17_ActionPop(t);break;case 10:avm1_0x0A_ActionAdd(t);break;case 11:avm1_0x0B_ActionSubtract(t);break;case 12:avm1_0x0C_ActionMultiply(t);break;case 13:avm1_0x0D_ActionDivide(t);break;case 14:avm1_0x0E_ActionEquals(t);break;case 15:avm1_0x0F_ActionLess(t);break;case 16:avm1_0x10_ActionAnd(t);break;case 17:avm1_0x11_ActionOr(t);break;case 18:avm1_0x12_ActionNot(t);break;case 19:avm1_0x13_ActionStringEquals(t);break;case 20:avm1_0x14_ActionStringLength(t);break;case 49:avm1_0x31_ActionMBStringLength(t);break;case 33:avm1_0x21_ActionStringAdd(t);break;case 21:avm1_0x15_ActionStringExtract(t);break;case 53:avm1_0x35_ActionMBStringExtract(t);break;case 41:avm1_0x29_ActionStringLess(t);break;case 24:avm1_0x18_ActionToInteger(t);break;case 50:avm1_0x32_ActionCharToAscii(t);break;case 54:avm1_0x36_ActionMBCharToAscii(t);break;case 51:avm1_0x33_ActionAsciiToChar(t);break;case 55:avm1_0x37_ActionMBAsciiToChar(t);break;case 153:break;case 157:n=avm1_0x9D_ActionIf(t,r);break;case 158:avm1_0x9E_ActionCall(t);break;case 28:avm1_0x1C_ActionGetVariable(t);break;case 29:avm1_0x1D_ActionSetVariable(t);break;case 154:avm1_0x9A_ActionGetURL2(t,r);break;case 159:avm1_0x9F_ActionGotoFrame2(t,r);break;case 32:avm1_0x20_ActionSetTarget2(t);break;case 34:avm1_0x22_ActionGetProperty(t);break;case 35:avm1_0x23_ActionSetProperty(t);break;case 36:avm1_0x24_ActionCloneSprite(t);break;case 37:avm1_0x25_ActionRemoveSprite(t);break;case 39:avm1_0x27_ActionStartDrag(t);break;case 40:avm1_0x28_ActionEndDrag(t);break;case 141:n=avm1_0x8D_ActionWaitForFrame2(t,r);break;case 38:avm1_0x26_ActionTrace(t);break;case 52:avm1_0x34_ActionGetTime(t);break;case 48:avm1_0x30_ActionRandomNumber(t);break;case 61:avm1_0x3D_ActionCallFunction(t);break;case 82:avm1_0x52_ActionCallMethod(t);break;case 136:avm1_0x88_ActionConstantPool(t,r);break;case 155:avm1_0x9B_ActionDefineFunction(t,r);break;case 60:avm1_0x3C_ActionDefineLocal(t);break;case 65:avm1_0x41_ActionDefineLocal2(t);break;case 58:avm1_0x3A_ActionDelete(t);break;case 59:avm1_0x3B_ActionDelete2(t);break;case 70:avm1_0x46_ActionEnumerate(t);break;case 73:avm1_0x49_ActionEquals2(t);break;case 78:avm1_0x4E_ActionGetMember(t);break;case 66:avm1_0x42_ActionInitArray(t);break;case 67:avm1_0x43_ActionInitObject(t);break;case 83:avm1_0x53_ActionNewMethod(t);break;case 64:avm1_0x40_ActionNewObject(t);break;case 79:avm1_0x4F_ActionSetMember(t);break;case 69:avm1_0x45_ActionTargetPath(t);break;case 148:avm1_0x94_ActionWith(t,r);break;case 74:avm1_0x4A_ActionToNumber(t);break;case 75:avm1_0x4B_ActionToString(t);break;case 68:avm1_0x44_ActionTypeOf(t);break;case 71:avm1_0x47_ActionAdd2(t);break;case 72:avm1_0x48_ActionLess2(t);break;case 63:avm1_0x3F_ActionModulo(t);break;case 96:avm1_0x60_ActionBitAnd(t);break;case 99:avm1_0x63_ActionBitLShift(t);break;case 97:avm1_0x61_ActionBitOr(t);break;case 100:avm1_0x64_ActionBitRShift(t);break;case 101:avm1_0x65_ActionBitURShift(t);break;case 98:avm1_0x62_ActionBitXor(t);break;case 81:avm1_0x51_ActionDecrement(t);break;case 80:avm1_0x50_ActionIncrement(t);break;case 76:avm1_0x4C_ActionPushDuplicate(t);break;case 62:avm1_0x3E_ActionReturn(t);break;case 77:avm1_0x4D_ActionStackSwap(t);break;case 135:avm1_0x87_ActionStoreRegister(t,r);break;case 84:avm1_0x54_ActionInstanceOf(t);break;case 85:avm1_0x55_ActionEnumerate2(t);break;case 102:avm1_0x66_ActionStrictEquals(t);break;case 103:avm1_0x67_ActionGreater(t);break;case 104:avm1_0x68_ActionStringGreater(t);break;case 142:avm1_0x8E_ActionDefineFunction2(t,r);break;case 105:avm1_0x69_ActionExtends(t);break;case 43:avm1_0x2B_ActionCastOp(t);break;case 44:avm1_0x2C_ActionImplementsOp(t);break;case 143:avm1_0x8F_ActionTry(t,r);break;case 42:avm1_0x2A_ActionThrow(t);break;case 45:avm1_0x2D_ActionFSCommand2(t);break;case 137:avm1_0x89_ActionStrictMode(t,r);break;case 0:t.isEndOfActions=!0;break;default:throw new Error("Unknown action code: "+i)}return n}function interpretActionWithRecovery(t,e){var i,r;try{r=interpretAction(t,e),t.recoveringFromError=!1}catch(e){if(i=t.context,e=as2CastError(e),avm1ErrorsEnabled.value&&!i.isTryCatchListening||e instanceof AVM1CriticalError)throw e;if(e instanceof AVM1Error)throw e;if(Telemetry.instance.reportTelemetry({topic:"error",error:1}),!t.recoveringFromError){if(i.errorsIgnored++>=MAX_AVM1_ERRORS_LIMIT)throw new AVM1CriticalError("long running script -- AVM1 errors limit is reached");console.error("AVM1 error: "+e),t.recoveringFromError=!0}}return r}function analyzeAndCompileActionsData(t,e){var i,r=t.context,n=new ActionsDataParser(e,r.swfVersion),o=new ActionsDataAnalyzer;o.registersLimit=t.registers.length,o.parentResults=e.parent&&e.parent.ir;var s=o.analyze(n);if(e.ir=s,avm1CompilerEnabled.value)try{i=(new ActionsDataCompiler).generate(s),e.compiled=i}catch(t){console.error("Unable to compile AVM1 function: "+t)}}function interpretActionsData(t,e){e.ir||e.compiled||analyzeAndCompileActionsData(t,e);var i=t.context,r=t.scopeList.scope.adaptee;r&&r._deferScriptExecution&&(i.deferScriptExecution=!0),r&&(AVM1MovieClip.currentMCAssetNameSpace=r.assetNamespace);var n=e.compiled;if(n)return n(t);var o=0,s=i.abortExecutionAt;avm1DebuggerEnabled.value&&Debugger.breakpoints[a.dataId];for(var a=e.ir,l=0,h=a.actions[l];h&&!t.isEndOfActions;){if(o++%CHECK_AVM1_HANG_EVERY==0&&Date.now()>=s)throw new AVM1CriticalError("long running script -- AVM1 instruction hang timeout");l=interpretActionWithRecovery(t,h.action)?h.conditionalJumpTo:h.next,h=a.actions[l]}return t.stack.pop()}var ActionTracer=function(){function t(){this._indentation=0,this._indentStringCache=[]}return t.prototype._getIndentString=function(){return this._indentStringCache[this._indentation]||(this._indentStringCache[this._indentation]=new Array(this._indentation+1).join(".."))},t.prototype.print=function(t,e){for(var i=t.position,r=t.actionCode,n=t.actionName,o=[],s=0;s<e.length;s++){var a=e[s];if(a&&"object"==typeof a){var l=a.alGetConstructorProperty();o.push("["+(l?l.name:"Object")+"]")}else o.push(a)}console.log("AVM1 trace: "+this._getIndentString()+i+": "+n+"("+r.toString(16)+"), stack="+o)},t.prototype.indent=function(){this._indentation++},t.prototype.unindent=function(){this._indentation--},t.prototype.message=function(t){console.log("AVM1 trace: ------- "+t)},t}(),LoaderInfo$1=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.swfVersion=0,e}return __extends(e,t),e.prototype.getSymbolById=function(t){},e}(LoaderInfo),XMLNodeType=function(){function t(){}return t.CDATA_NODE=100,t.COMMENT_NODE=101,t.DOCUMENT_TYPE_NODE=102,t.ELEMENT_NODE=1,t.PROCESSING_INSTRUCTION_NODE=103,t.TEXT_NODE=3,t.XML_DECLARATION=104,t}(),XMLDocumentAway=function(t){function e(e){return t.call(this,XMLNodeType.DOCUMENT_TYPE_NODE,"null")||this}return __extends(e,t),e.prototype.axCallPublicProperty=function(t,e){return null},e.prototype.axGetPublicProperty=function(t){return null},e.prototype.axSetPublicProperty=function(t,e){return null},e.prototype.createElement=function(t){return console.log("createElement not implemented yet in flash/XMLDocument"),null},e.prototype.createTextNode=function(t){return console.log("createTextNode not implemented yet in flash/XMLDocument"),null},e.prototype.parseXML=function(t){console.log("parseXML not implemented yet in flash/XMLDocument")},e.prototype.toString=function(){return console.log("toString not implemented yet in flash/XMLDocument"),""},e}(XMLNode);function getCONSTANTName(t){return String(t)}var _namespaces={};function getNamespaceTypeName(t){return String(t)}var _md5R=new Uint8Array([7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21]),_md5K=new Int32Array([-680876936,-389564586,606105819,-1044525330,-176418897,1200080426,-1473231341,-45705983,1770035416,-1958414417,-42063,-1990404162,1804603682,-40341101,-1502002290,1236535329,-165796510,-1069501632,643717713,-373897302,-701558691,38016083,-660478335,-405537848,568446438,-1019803690,-187363961,1163531501,-1444681467,-51403784,1735328473,-1926607734,-378558,-2022574463,1839030562,-35309556,-1530992060,1272893353,-155497632,-1094730640,681279174,-358537222,-722521979,76029189,-640364487,-421815835,530742520,-995338651,-198630844,1126891415,-1416354905,-57434055,1700485571,-1894986606,-1051523,-2054922799,1873313359,-30611744,-1560198380,1309151649,-145523070,-1120210379,718787259,-343485551]);function hashBytesTo32BitsMD5(t,e,i){var r,n,o,s=_md5R,a=_md5K,l=1732584193,h=-271733879,c=-1732584194,u=271733878,p=i+72&-64,d=new Uint8Array(p);for(r=0;r<i;++r)d[r]=t[e++];for(d[r++]=128,o=p-8;r<o;)d[r++]=0;d[r++]=i<<3&255,d[r++]=i>>5&255,d[r++]=i>>13&255,d[r++]=i>>21&255,d[r++]=i>>>29&255,d[r++]=0,d[r++]=0,d[r++]=0;var f=new Int32Array(16);for(r=0;r<p;){for(n=0;n<16;++n,r+=4)f[n]=d[r]|d[r+1]<<8|d[r+2]<<16|d[r+3]<<24;var _,g,m=l,y=h,v=c,b=u;for(n=0;n<64;++n){n<16?(_=y&v|~y&b,g=n):n<32?(_=b&y|~b&v,g=5*n+1&15):n<48?(_=y^v^b,g=3*n+5&15):(_=v^(y|~b),g=7*n&15);var x=b,A=m+_+a[n]+f[g]|0,E=s[n];b=v,v=y,y=y+(A<<E|A>>>32-E)|0,m=x}l=l+m|0,h=h+y|0,c=c+v|0,u=u+b|0}return l}function mixHash(t,e){return(31*t|0)+e|0}var HashUtilities={_md5R:_md5R,_md5K:_md5K,hashBytesTo32BitsMD5:hashBytesTo32BitsMD5,mixHash:mixHash},namespaceHashingBuffer=new Uint8Array(100),Namespace=function(){function t(t,e,i){this.type=t,this.uri=e,this.prefix=i,this.mangledName=null,assert(void 0!==t),this.mangleName()}return t.prototype.toString=function(){return getNamespaceTypeName(this.type)+(""!==this.uri?":"+this.uri:"")},t._hashNamespace=function(e,i,r){i+="",r+="";var n=t._knownNames.indexOf(i);if(n>=0)return e<<2|n;var o=1+i.length+r.length,s=o<101?namespaceHashingBuffer:new Uint8Array(o),a=0;s[a++]=e;for(var l=0;l<i.length;l++)s[a++]=i.charCodeAt(l);for(l=0;l<r.length;l++)s[a++]=r.charCodeAt(l);return HashUtilities.hashBytesTo32BitsMD5(s,0,a)},t.prototype.mangleName=function(){if(0!==this.type||""!==this.uri){var e=t._hashNamespace(this.type,this.uri,this.prefix);this.mangledName=StringUtilities.variableLengthEncodeInt32(e)}else this.mangledName="Bg"},t.prototype.isPublic=function(){return 0===this.type},Object.defineProperty(t.prototype,"reflectedURI",{get:function(){return this.uri||(0===this.type?null:this.uri)},enumerable:!0,configurable:!0}),t._knownNames=[""],t}();function internNamespace(t,e){var i=t+e;return _namespaces[i]||(_namespaces[i]=new Namespace(t,e,""))}function internPrefixedNamespace(t,e,i){var r=t+e+i,n=_namespaces[r];return n||(n=_namespaces[r]=new Namespace(t,e,i)),n}function axCoerceString$3(t){return"string"==typeof t?t:null==t?null:t+""}var Multiname=function(){function t(e,i,r,n,o,s,a){void 0===s&&(s=null),void 0===a&&(a=!1),this.abc=e,this.index=i,this.kind=r,this.namespaces=n,this.name=o,this.parameterType=s,this.mutable=a,this.id=t._nextID++,this._mangledName=null,this.script=null,this.numeric=!1,this.numericValue=0,this.resolved={},this.scope=null,this.value=null,this._key=null,this.others=null}return t.prototype.rename=function(e){null==this.others&&(this.others={});var i=this.others[e];return void 0===i&&((i=new t(this.abc,-1,null,this.namespaces,e,this.parameterType)).script=this.script,this.others[e]=i),i},t.prototype.key=function(){if(this._key)return this._key;var t=this.toString();return this.mutable||(this._key=t),t},t.FromFQNString=function(e,i){var r=e.lastIndexOf("."),n=-1===r?"":e.substr(0,r),o=-1===r?e:e.substr(r+1);return new t(null,0,15,[internNamespace(i,n)],o)},t.prototype._nameToString=function(){return this.isAnyName()?"*":this.isRuntimeName()?"["+this.name+"]":this.name},t.prototype.isRuntime=function(){switch(this.kind){case 7:case 13:case 9:case 14:return!1}return!0},t.prototype.isRuntimeName=function(){switch(this.kind){case 17:case 18:case 27:case 28:return!0}return!1},t.prototype.isRuntimeNamespace=function(){switch(this.kind){case 15:case 16:case 17:case 18:return!0}return!1},t.prototype.isAnyName=function(){return null===this.name},t.prototype.isAnyNamespace=function(){return!(this.isRuntimeNamespace()||this.namespaces.length>1)&&(0===this.namespaces.length||""===this.namespaces[0].uri)},t.prototype.isQName=function(){var t=this.kind;return 29===t||7===t||13===t||t>=15&&t<=18},Object.defineProperty(t.prototype,"namespace",{get:function(){return this.namespaces[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uri",{get:function(){return this.namespaces[0].uri},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prefix",{get:function(){return this.namespaces[0].prefix},set:function(t){var e=this.namespaces[0];e.prefix!==t&&(this.namespaces[0]=internPrefixedNamespace(e.type,e.uri,t))},enumerable:!0,configurable:!0}),t.prototype.equalsQName=function(t){return this.name===t.name&&this.namespaces[0].uri===t.namespaces[0].uri},t.prototype.matches=function(t){var e=t.isAnyName();if(e&&!t.isQName())return!0;if(!e&&this.name!==t.name)return!1;for(var i=this.namespaces[0].uri,r=t.namespaces.length;r--;)if(t.namespaces[r].uri===i)return!0;return!1},t.prototype.isAttribute=function(){switch(this.kind){case 13:case 16:case 18:case 14:case 28:return!0}return!1},t.prototype.getMangledName=function(){return this._mangledName||this._mangleName()},t.prototype._mangleName=function(){var t="$"+this.namespaces[0].mangledName+axCoerceString$3(this.name);return this.isRuntime()||(this._mangledName=t),t},t.prototype.getPublicMangledName=function(){return isNumeric(this.name)?this.name:"$Bg"+axCoerceString$3(this.name)},t.isPublicQualifiedName=function(t){return 0===t.indexOf("$Bg")},t.getPublicMangledName=function(t){return isNumeric(t)?t:"$Bg"+t},t.prototype.toFQNString=function(t){var e=this.namespaces[0].uri;return e.length&&(e+=t?"::":"."),e+this.name},t.prototype.toString=function(){var t=getCONSTANTName(this.kind)+" ";(t+=this.isAttribute()?"@":"",this.isRuntimeNamespace())?t+="["+(this.namespaces?this.namespaces.map((function(t){return String(t)})).join(", "):null)+"]::"+this._nameToString():this.isQName()?(t+=this.namespaces[0]+"::",t+=this._nameToString()):this.namespaces?(t+="{"+this.namespaces.map((function(t){return String(t)})).join(", ")+"}",t+="::"+this._nameToString()):(t+="{"+this.namespaces+"}",t+="::"+this._nameToString());return this.parameterType&&(t+="<"+this.parameterType+">"),t},t.prototype.toFlashlogString=function(){var t=this.uri;return t?t+"::"+this.name:this.name},t.stripPublicMangledName=function(t){if(0===t.indexOf("$Bg"))return t.substring(3)},t.FromSimpleName=function(e){var i=e.lastIndexOf(".");i<=0&&(i=e.lastIndexOf(" "));var r,n="";return i>0&&i<e.length-1?(r=e.substring(i+1).trim(),n=e.substring(0,i).trim()):r=e,new t(null,0,15,[internNamespace(0,n)],r)},t._nextID=1,t}();function boxValue(t){return isNullOrUndefined$1(t)||isObject(t)?t:Object(t)}function toKeyValueArray(t){var e=Object.prototype.hasOwnProperty,i=[];for(var r in t)e.call(t,r)&&i.push([r,t[r]]);return i}function isPrototypeWriteable(t){return Object.getOwnPropertyDescriptor(t,"prototype").writable}function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function propertyIsEnumerable(t,e){return Object.prototype.propertyIsEnumerable.call(t,e)}function getPropertyDescriptor(t,e){do{var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}while(t);return null}function hasOwnGetter(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(!i||!i.get)}function getOwnGetter(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return i?i.get:null}function hasOwnSetter(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(!i||!i.set)}function createMap(){return Object.create(null)}function createArrayMap(){return[]}function defineReadOnlyProperty(t,e,i){Object.defineProperty(t,e,{value:i,writable:!1,configurable:!0,enumerable:!1})}function copyProperties(t,e){for(var i in e)t[i]=e[i]}function copyOwnProperties(t,e){for(var i in e)hasOwnProperty(e,i)&&(t[i]=e[i])}function copyOwnPropertyDescriptors(t,e,i,r,n){for(var o in void 0===i&&(i=null),void 0===r&&(r=!0),void 0===n&&(n=!1),e)if(hasOwnProperty(e,o)&&(!i||i(o))){var s=Object.getOwnPropertyDescriptor(e,o);if(!r&&hasOwnProperty(t,o))continue;try{n&&!1===s.writable&&(s.writable=!0),Object.defineProperty(t,o,s)}catch(t){assert$2("Can't define: "+o)}}}function copyPropertiesByList(t,e,i){for(var r=0;r<i.length;r++){var n=i[r];t[n]=e[n]}}function defineNonEnumerableGetter(t,e,i){Object.defineProperty(t,e,{get:i,configurable:!0,enumerable:!1})}function defineNonEnumerableProperty(t,e,i){Object.defineProperty(t,e,{value:i,writable:!0,configurable:!0,enumerable:!1})}var ObjectUtilities={boxValue:boxValue,toKeyValueArray:toKeyValueArray,isPrototypeWriteable:isPrototypeWriteable,hasOwnProperty:hasOwnProperty,propertyIsEnumerable:propertyIsEnumerable,getPropertyDescriptor:getPropertyDescriptor,hasOwnGetter:hasOwnGetter,getOwnGetter:getOwnGetter,hasOwnSetter:hasOwnSetter,createArrayMap:createArrayMap,createMap:createMap,defineReadOnlyProperty:defineReadOnlyProperty,copyProperties:copyProperties,copyOwnProperties:copyOwnProperties,copyOwnPropertyDescriptors:copyOwnPropertyDescriptors,copyPropertiesByList:copyPropertiesByList,defineNonEnumerableGetter:defineNonEnumerableGetter,defineNonEnumerableProperty:defineNonEnumerableProperty};function addPrototypeFunctionAlias(t,e,i){defineNonEnumerableProperty(t,e,t.sec.AXFunction.axBox(i))}function axImplementsInterface(t){return this.classInfo.instanceInfo.getInterfaces(this.axClass).has(t)}var RuntimeTraits=function(){function t(t,e,i){this.superTraits=t,this.protectedNs=e,this.protectedNsMappings=i,this.slots=[],this._nextSlotID=1,this.multinames={};var r=this._traits=Object.create(null);if(t){var n=t._traits;for(var o in n)r[o]=Object.create(n[o])}}return t.prototype.addTrait=function(t){var e=t.name,i=this._traits[e.name];i||(i=this._traits[e.name]=Object.create(null));var r=e.namespaces[0].mangledName,n=i[r];return i[r]=t,n},t.prototype.addSlotTrait=function(t){var e=t.slot;e?this._nextSlotID=e+1:e=t.slot=this._nextSlotID++,this.slots[e]=t},t.prototype.getTraitMultiname=function(t){if(t.mutable)return this.getTrait(t.namespaces,t.name);var e=this.multinames[t.id];return void 0===e&&(e=this.getTrait(t.namespaces,t.name),this.multinames[t.id]=e),e},t.prototype.getTrait=function(t,e){var i,r=this._traits[e];if(!r)return null;for(var n=0;n<t.length;n++){var o=t[n];if(i=r[o.mangledName])return i;if(1===o.type)for(var s=this;s;){if(s.protectedNs===o&&(i=s.protectedNsMappings[e]))return i;s=s.superTraits}}return null},t.prototype.getTraitsList=function(){var t=[],e=this._traits;for(var i in e){var r=e[i];for(var n in r)t.push(r[n])}return t},t.prototype.getSlotPublicTraitNames=function(){for(var t=this.slots,e=[],i=1;i<t.length;i++){var r=t[i];r.name.namespace.isPublic()&&e.push(r.name.name)}return e},t.prototype.getSlot=function(t){return this.slots[t]},t}();function AXBasePrototype_$BgtoString(){var t=this.hasOwnProperty("classInfo")?"Object":this.classInfo.instanceInfo.name.name;return StringUtilities.concat3("[object ",t,"]")}function isPrimitiveJSValue(t){return null==t||"number"==typeof t||"string"==typeof t||"boolean"==typeof t}function AXBasePrototype_toString(){return this.$BgtoString.axCall(this)}function AXBasePrototype_$BgvalueOf(){return this}function AXBasePrototype_valueOf(){return this.$BgvalueOf.axCall(this)}var D=defineNonEnumerableProperty,AXBasePrototype=null;function isValidASValue(t){return AXBasePrototype.isPrototypeOf(t)||isPrimitiveJSValue(t)}function initializeAXBasePrototype(){if(!AXBasePrototype){var t=ASObject$1.prototype;AXBasePrototype=Object.create(null),D(AXBasePrototype,"axHasPropertyInternal",t.axHasPropertyInternal),D(AXBasePrototype,"axHasProperty",t.axHasProperty),D(AXBasePrototype,"axSetProperty",t.axSetProperty),D(AXBasePrototype,"axHasProperty",t.axHasProperty),D(AXBasePrototype,"axHasPublicProperty",t.axHasPublicProperty),D(AXBasePrototype,"axSetPublicProperty",t.axSetPublicProperty),D(AXBasePrototype,"axGetPublicProperty",t.axGetPublicProperty),D(AXBasePrototype,"axCallPublicProperty",t.axCallPublicProperty),D(AXBasePrototype,"axDeletePublicProperty",t.axDeletePublicProperty),D(AXBasePrototype,"axGetProperty",t.axGetProperty),D(AXBasePrototype,"axDeleteProperty",t.axDeleteProperty),D(AXBasePrototype,"axGetSuper",t.axGetSuper),D(AXBasePrototype,"axSetSuper",t.axSetSuper),D(AXBasePrototype,"axSetSlot",t.axSetSlot),D(AXBasePrototype,"axGetSlot",t.axGetSlot),D(AXBasePrototype,"axCallProperty",t.axCallProperty),D(AXBasePrototype,"axCallSuper",t.axCallSuper),D(AXBasePrototype,"axConstructProperty",t.axConstructProperty),D(AXBasePrototype,"axResolveMultiname",t.axResolveMultiname),D(AXBasePrototype,"axNextNameIndex",t.axNextNameIndex),D(AXBasePrototype,"axNextName",t.axNextName),D(AXBasePrototype,"axNextValue",t.axNextValue),D(AXBasePrototype,"axGetEnumerableKeys",t.axGetEnumerableKeys),D(AXBasePrototype,"axImplementsInterface",axImplementsInterface),D(AXBasePrototype,"traits",new RuntimeTraits(null,null,Object.create(null))),D(AXBasePrototype,"isPrototypeOf",Object.prototype.isPrototypeOf),D(AXBasePrototype,"hasOwnProperty",Object.prototype.hasOwnProperty),AXBasePrototype.$BgtoString=AXBasePrototype_$BgtoString,AXBasePrototype.toString=AXBasePrototype_toString,AXBasePrototype.$BgvalueOf=AXBasePrototype_$BgvalueOf,AXBasePrototype.valueOf=AXBasePrototype_valueOf}}function makeMultiname(t,e){var i=new Multiname(null,0,17,[],null);return i.namespaces=e?[e]:[Namespace.PUBLIC],i.name=t,i}function qualifyPublicName(t){return isIndex(t)?t:"$Bg"+t}function axCoerceName(t){return"string"==typeof t?t:null==t?"null":t.toString()}var rn=new Multiname(null,0,17,[],null,null,!0),avm2Options=shumwayOptions.register(new OptionSet("AVM2")),options=avm2Options.register(new OptionSet("Runtime")),traceRuntime=options.register(new Option("tr","traceRuntime","boolean",!1,"trace runtime")),traceExecution=options.register(new Option("tx","traceExecution","boolean",!1,"trace execution")),traceInterpreter=options.register(new Option("ti","traceInterpreter","boolean",!1,"trace interpreter")),debuggerMode=options.register(new Option("db","debuggerMode","boolean",!0,"enable debugger mode")),Errors$1={NotImplementedError:{code:1001,message:"The method %1 is not implemented."},InvalidPrecisionError:{code:1002,message:"Number.toPrecision has a range of 1 to 21. Number.toFixed and Number.toExponential have a range of 0 to 20. Specified value is not within expected range."},InvalidRadixError:{code:1003,message:"The radix argument must be between 2 and 36; got %1."},InvokeOnIncompatibleObjectError:{code:1004,message:"Method %1 was invoked on an incompatible object."},ArrayIndexNotIntegerError:{code:1005,message:"Array index is not a positive integer (%1)."},CallOfNonFunctionError:{code:1006,message:"%1 is not a function."},ConstructOfNonFunctionError:{code:1007,message:"Instantiation attempted on a non-constructor."},ConvertNullToObjectError:{code:1009,message:"Cannot access a property or method of a null object reference."},ConvertUndefinedToObjectError:{code:1010,message:"A term is undefined and has no properties."},ClassNotFoundError:{code:1014,message:"Class %1 could not be found."},DescendentsError:{code:1016,message:"Descendants operator (..) not supported on type %1."},StackOverflowError:{code:1023,message:"Stack overflow occurred."},CpoolIndexRangeError:{code:1032,message:"Cpool index %1 is out of range %2."},CpoolEntryWrongTypeError:{code:1033,message:"Cpool entry %1 is wrong type."},CheckTypeFailedError:{code:1034,message:"Type Coercion failed: cannot convert %1 to %2."},CannotAssignToMethodError:{code:1037,message:"Cannot assign to a method %1 on %2."},CantUseInstanceofOnNonObjectError:{code:1040,message:"The right-hand side of instanceof must be a class or function."},IsTypeMustBeClassError:{code:1041,message:"The right-hand side of operator must be a class."},InvalidMagicError:{code:1042,message:"Not an ABC file.  major_version=%1 minor_version=%2."},UnsupportedTraitsKindError:{code:1045,message:"Unsupported traits kind=%1."},PrototypeTypeError:{code:1049,message:"Prototype objects must be vanilla Objects."},ConvertToPrimitiveError:{code:1050,message:"Cannot convert %1 to primitive."},InvalidURIError:{code:1052,message:"Invalid URI passed to %1 function."},WriteSealedError:{code:1056,message:"Cannot create property %1 on %2."},WrongArgumentCountError:{code:1063,message:"Argument count mismatch on %1. Expected %2, got %3."},UndefinedVarError:{code:1065,message:"Variable %1 is not defined."},ReadSealedError:{code:1069,message:"Property %1 not found on %2 and there is no default value."},ConstWriteError:{code:1074,message:"Illegal write to read-only property %1 on %2."},XMLPrefixNotBound:{code:1083,message:'The prefix "%1" for element "%2" is not bound.'},XMLUnterminatedElementTag:{code:1085,message:'The element type "%1" must be terminated by the matching end-tag "</%2>".'},XMLOnlyWorksWithOneItemLists:{code:1086,message:"The %1 method only works on lists containing one item."},XMLAssignmentToIndexedXMLNotAllowed:{code:1087,message:"Assignment to indexed XML is not allowed."},XMLMarkupMustBeWellFormed:{code:1088,message:"The markup in the document following the root element must be well-formed."},XMLAssigmentOneItemLists:{code:1089,message:"Assignment to lists with more than one item is not supported."},XMLMalformedElement:{code:1090,message:"XML parser failure: element is malformed."},XMLUnterminatedCData:{code:1091,message:"XML parser failure: Unterminated CDATA section."},XMLUnterminatedXMLDecl:{code:1092,message:"XML parser failure: Unterminated XML declaration."},XMLUnterminatedDocTypeDecl:{code:1093,message:"XML parser failure: Unterminated DOCTYPE declaration."},XMLUnterminatedComment:{code:1094,message:"XML parser failure: Unterminated comment."},XMLUnterminatedElement:{code:1096,message:"XML parser failure: Unterminated element."},XMLNamespaceWithPrefixAndNoURI:{code:1098,message:"Illegal prefix %1 for no namespace."},RegExpFlagsArgumentError:{code:1100,message:"Cannot supply flags when constructing one RegExp from another."},InvalidBaseClassError:{code:1108,message:"The OP_newclass opcode was used with the incorrect base class."},XMLInvalidName:{code:1117,message:"Invalid XML name: %1."},XMLIllegalCyclicalLoop:{code:1118,message:"Illegal cyclical loop between nodes."},FilterError:{code:1123,message:"Filter operator not supported on type %1."},OutOfRangeError:{code:1125,message:"The index %1 is out of range %2."},VectorFixedError:{code:1126,message:"Cannot change the length of a fixed Vector."},TypeAppOfNonParamType:{code:1127,message:"Type application attempted on a non-parameterized type."},WrongTypeArgCountError:{code:1128,message:"Incorrect number of type parameters for %1. Expected %2, got %3."},JSONCyclicStructure:{code:1129,message:"Cyclic structure cannot be converted to JSON string."},JSONInvalidReplacer:{code:1131,message:"Replacer argument to JSON stringifier must be an array or a two parameter function."},JSONInvalidParseInput:{code:1132,message:"Invalid JSON parse input."},InvalidRangeError:{code:1506,message:"The specified range is invalid."},NullArgumentError:{code:1507,message:"Argument %1 cannot be null."},InvalidArgumentError:{code:1508,message:"The value specified for argument %1 is invalid."},ArrayFilterNonNullObjectError:{code:1510,message:"When the callback argument is a method of a class, the optional this argument must be null."},InvalidParamError:{code:2004,message:"One of the parameters is invalid."},ParamRangeError:{code:2006,message:"The supplied index is out of bounds."},NullPointerError:{code:2007,message:"Parameter %1 must be non-null."},InvalidEnumError:{code:2008,message:"Parameter %1 must be one of the accepted values."},CantInstantiateError:{code:2012,message:"%1 class cannot be instantiated."},InvalidBitmapData:{code:2015,message:"Invalid BitmapData."},EOFError:{code:2030,message:"End of file was encountered.",fqn:"flash.errors.EOFError"},CompressedDataError:{code:2058,message:"There was an error decompressing the data.",fqn:"flash.errors.IOError"},EmptyStringError:{code:2085,message:"Parameter %1 must be non-empty string."},ProxyGetPropertyError:{code:2088,message:"The Proxy class does not implement getProperty. It must be overridden by a subclass."},ProxySetPropertyError:{code:2089,message:"The Proxy class does not implement setProperty. It must be overridden by a subclass."},ProxyCallPropertyError:{code:2090,message:"The Proxy class does not implement callProperty. It must be overridden by a subclass."},ProxyHasPropertyError:{code:2091,message:"The Proxy class does not implement hasProperty. It must be overridden by a subclass."},ProxyDeletePropertyError:{code:2092,message:"The Proxy class does not implement deleteProperty. It must be overridden by a subclass."},ProxyGetDescendantsError:{code:2093,message:"The Proxy class does not implement getDescendants. It must be overridden by a subclass."},ProxyNextNameIndexError:{code:2105,message:"The Proxy class does not implement nextNameIndex. It must be overridden by a subclass."},ProxyNextNameError:{code:2106,message:"The Proxy class does not implement nextName. It must be overridden by a subclass."},ProxyNextValueError:{code:2107,message:"The Proxy class does not implement nextValue. It must be overridden by a subclass."},TooFewArgumentsError:{code:2001,message:"Too few arguments were specified; got %1, %2 expected."},ParamTypeError:{code:2005,message:"Parameter %1 is of the incorrect type. Should be type %2."},SocketConnectError:{code:2011,message:"Socket connection failed to %1:%2."},CantAddSelfError:{code:2024,message:"An object cannot be added as a child of itself."},NotAChildError:{code:2025,message:"The supplied DisplayObject must be a child of the caller."},UnhandledError:{code:2044,message:"Unhandled %1:."},AllowDomainArgumentError:{code:2052,message:"Only String arguments are permitted for allowDomain and allowInsecureDomain."},DelayRangeError:{code:2066,message:"The Timer delay specified is out of range."},ExternalInterfaceNotAvailableError:{code:2067,message:"The ExternalInterface is not available in this container. ExternalInterface requires Internet Explorer ActiveX, Firefox, Mozilla 1.7.5 and greater, or other browsers that support NPRuntime."},InvalidLoaderMethodError:{code:2069,message:"The Loader class does not implement this method."},InvalidStageMethodError:{code:2071,message:"The Stage class does not implement this property or method."},TimelineObjectNameSealedError:{code:2078,message:"The name property of a Timeline-placed object cannot be modified."},AlreadyConnectedError:{code:2082,message:"Connect failed because the object is already connected."},CloseNotConnectedError:{code:2083,message:"Close failed because the object is not connected."},ArgumentSizeError:{code:2084,message:"The AMF encoding of the arguments cannot exceed 40K."},AsyncError:{code:2095,message:"%1 was unable to invoke callback %2."},LoadingObjectNotSWFError:{code:2098,message:"The loading object is not a .swf file, you cannot request SWF properties from it."},LoadingObjectNotInitializedError:{code:2099,message:"The loading object is not sufficiently loaded to provide this information."},DecodeParamError:{code:2101,message:"The String passed to URLVariables.decode() must be a URL-encoded query string containing name/value pairs."},SceneNotFoundError:{code:2108,message:"Scene %1 was not found."},FrameLabelNotFoundError:{code:2109,message:"Frame label %1 not found in scene %2."},InvalidLoaderInfoMethodError:{code:2118,message:"The LoaderInfo class does not implement this method."},SecuritySwfNotAllowedError:{code:2121,message:"Security sandbox violation: %1: %2 cannot access %3. This may be worked around by calling Security.allowDomain."},UnknownFileTypeError:{code:2124,message:"Loaded file is an unknown type."},CantAddParentError:{code:2150,message:"An object cannot be added as a child to one of it's children (or children's children, etc.)."},Matrix3DRefCannontBeShared:{code:2189,message:"A Matrix3D can not be assigned to more than one DisplayObject."},ObjectWithStringsParamError:{code:2196,message:"Parameter %1 must be an Object with only String values."},AllowCodeImportError:{code:3226,message:"Cannot import a SWF file when LoaderContext.allowCodeImport is false."},PermissionDenied:{code:3315,message:"The current security context does not allow this operation."},InternalErrorIV:{code:3343,message:"Internal Error."}};for(var k in Errors$1){var error$1=Errors$1[k];error$1.typeName=k,Errors$1[error$1.code]=error$1}function getErrorMessage(t){var e="Error #"+t;if(!debuggerMode.value)return e;var i=Errors$1[t];return e+": "+(i&&i.message||"(unknown)")}function getErrorInfo(t){return Errors$1[t]}function formatErrorMessage(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=t.message;return e.forEach((function(t,e){r=r.replace("%"+(e+1),t)})),"Error #"+t.code+": "+r}function validateCall(t,e,i){e&&e.axApply||t.throwError("TypeError",Errors$1.CallOfNonFunctionError,e&&e.methodInfo?e.methodInfo.getName():"value"),e.methodInfo&&i<e.methodInfo.minArgs&&t.throwError("ArgumentError",Errors$1.WrongArgumentCountError,e.methodInfo.getName(),e.methodInfo.minArgs,i)}function validateConstruct(t,e,i){if(!e||!e.axConstruct){var r=e&&e.classInfo?e.classInfo.instanceInfo.getName().name:"value";t.throwError("TypeError",Errors$1.ConstructOfNonFunctionError,r)}var n=e.classInfo.getInitializer();i<n.minArgs&&t.throwError("ArgumentError",Errors$1.WrongArgumentCountError,e.classInfo.instanceInfo.getName().name,n.minArgs,i)}var RecordedData=function(){function t(){}return t.conflict={},t.get={},t.set={},t.lex={},t}(),timeout=18e4,Resolver=function(){function t(){this.extra="",this.started=!1,this.keys=[],this.resolved={},this.lex={},this.boxed={},this.coerced={}}return t.prototype.resolveLex=function(t){return RecordedData.lex[this.extra+t.key()]||RecordedData.lex[t.key()]||0},t.prototype.resolveGet=function(t){return RecordedData.get[this.extra+t.key()]||RecordedData.get[t.key()]||null},t.prototype.resolveSet=function(t){return RecordedData.set[this.extra+t.key()]||RecordedData.set[t.key()]||null},t.prototype.recordLex=function(t,e){var i=this;this.started||(setTimeout((function(){return i.print()}),timeout),this.started=!0);var r=t.key();this.lex[r]||(this.lex[r]={}),this.lex[r][this.extra]?this.lex[r][this.extra].indexOf(e)<0&&this.lex[r][this.extra].push(e):this.lex[r][this.extra]=[e]},t.prototype.recordResolve=function(t,e){var i=this;this.started||(setTimeout((function(){return i.print()}),timeout),this.started=!0);var r=t.key();this.resolved[r]||(this.keys.push(r),this.resolved[r]={}),this.resolved[r][this.extra]?this.resolved[r][this.extra].indexOf(e)<0&&this.resolved[r][this.extra].push(e):this.resolved[r][this.extra]=[e]},t.prototype.recordBox=function(t){var e=t.key();this.boxed[e]||(this.boxed[e]={}),this.boxed[e][this.extra]||(this.boxed[e][this.extra]=!0)},t.prototype.recordFun=function(t){var e=t.key();this.boxed[e]||(this.boxed[e]={}),this.boxed[e][this.extra]||(this.boxed[e][this.extra]=!0)},t.prototype.recordCoerce=function(t){var e=t.key();this.coerced[e]||(this.coerced[e]={}),this.coerced[e][this.extra]||(this.coerced[e][this.extra]=!0)},t.prototype.print=function(){var t=[];t.push("export class RecordedData {"),t.push("    static conflict = {");for(var e=0;e<this.keys.length;e++){var i=this.keys[e],r=[];for(var n in this.resolved[i])this.resolved[i].hasOwnProperty(n)&&r.push(n);for(var o=0;o<r.length;o++)this.resolved[i][r[o]].length>1&&t.push('        "'+r[o]+i+'": ["'+this.resolved[i][r[o]].join('", "')+'"],')}t.push("    }"),t.push("    static get = {");for(e=0;e<this.keys.length;e++){i=this.keys[e],r=[];for(var n in this.resolved[i])this.resolved[i].hasOwnProperty(n)&&r.push(n);var s=[];for(o=0;o<r.length;o++)for(var a=0;a<this.resolved[i][r[o]].length;a++)s.indexOf(this.resolved[i][r[o]][a])<0&&s.push(this.resolved[i][r[o]][a]);if(this.boxed[i]||1!=s.length)for(o=0;o<r.length;o++)1==this.resolved[i][r[o]].length&&(this.boxed[i]&&this.boxed[i][r[o]]||t.push('        "'+r[o]+i+'": "'+this.resolved[i][r[o]][0]+'",'));else t.push('        "'+i+'": "'+s[0]+'",')}t.push("    }"),t.push("    static set = {");for(e=0;e<this.keys.length;e++){i=this.keys[e],r=[];for(var n in this.resolved[i])this.resolved[i].hasOwnProperty(n)&&r.push(n);for(s=[],o=0;o<r.length;o++)for(a=0;a<this.resolved[i][r[o]].length;a++)s.indexOf(this.resolved[i][r[o]][a])<0&&s.push(this.resolved[i][r[o]][a]);if(this.coerced[i]||1!=s.length)for(o=0;o<r.length;o++)1==this.resolved[i][r[o]].length&&(this.coerced[i]&&this.coerced[i][r[o]]||t.push('        "'+r[o]+i+'": "'+this.resolved[i][r[o]][0]+'",'));else t.push('        "'+i+'": "'+s[0]+'",')}t.push("    }"),t.push("    static lex = {");for(e=0;e<this.keys.length;e++){i=this.keys[e],r=[];for(var n in this.lex[i])this.lex[i].hasOwnProperty(n)&&r.push(n);var l=[];for(o=0;o<r.length;o++)for(a=0;a<this.lex[i][r[o]].length;a++)l.indexOf(this.lex[i][r[o]][a])<0&&l.push(this.lex[i][r[o]][a]);if(this.coerced[i]||1!=l.length)for(o=0;o<r.length;o++)1==this.lex[i][r[o]].length&&(this.coerced[i]&&this.coerced[i][r[o]]||t.push('        "'+r[o]+i+'": "'+this.lex[i][r[o]][0]+'",'));else t.push('        "'+i+'": "'+l[0]+'",')}t.push("    }"),t.push("}"),console.log(t.join("\n")),console.log(this.resolved)},t}(),resolver=new Resolver,ASObject$1=function(){function t(){}return t.classInitializer=function(){var e=this.dPrototype,i=t.prototype;addPrototypeFunctionAlias(e,"$BghasOwnProperty",i.native_hasOwnProperty),addPrototypeFunctionAlias(e,"$BgpropertyIsEnumerable",i.native_propertyIsEnumerable),addPrototypeFunctionAlias(e,"$BgsetPropertyIsEnumerable",i.native_setPropertyIsEnumerable),addPrototypeFunctionAlias(e,"$BgisPrototypeOf",i.native_isPrototypeOf),addPrototypeFunctionAlias(e,"$BgtoLocaleString",i.toString)},t._init=function(){},t.init=function(){},t.prototype.native_isPrototypeOf=function(t){return this.isPrototypeOf(this.sec.box(t))},t.prototype.native_hasOwnProperty=function(t){return this.axHasOwnProperty(makeMultiname(t))},t.prototype.native_propertyIsEnumerable=function(t){var e=Object.getOwnPropertyDescriptor(this,qualifyPublicName(axCoerceString$3(t)));return!!e&&e.enumerable},t.prototype.native_setPropertyIsEnumerable=function(t,e){void 0===e&&(e=!0);var i=qualifyPublicName(axCoerceString$3(t));e=!!e;var r,n=this.axClass.classInfo.instanceInfo;(n.isSealed()&&this!==this.axClass.dPrototype&&this.sec.throwError("ReferenceError",Errors$1.WriteSealedError,t,n.name.name),(r=Object.getOwnPropertyDescriptor(this.axClass.tPrototype,i))&&this!==this.axClass.dPrototype)||(r=Object.getOwnPropertyDescriptor(this,i))&&r.enumerable!==e&&(r.enumerable=e,Object.defineProperty(this,i,r))},t.prototype.axResolveMultiname=function(t){if(t.numeric)return t.numericValue;var e=t.name;if(t.mutable)return(n=this.traits.getTrait(t.namespaces,e))?n.name.getMangledName():"$Bg"+e;var i=this.__key__;i||((i=this.axClass.classInfo.instanceInfo.key)||(i=this.axClass.classInfo.instanceInfo.getClassName(),this.axClass.classInfo.instanceInfo.key=i),this.__key__=i);var r=t.resolved[i];if(r)return r;var n,o=(n=this.traits.getTraitMultiname(t))?n.name.getMangledName():"$Bg"+e;return t.resolved[i]=o,o},t.prototype.axHasProperty=function(t){return this.axHasPropertyInternal(t)},t.prototype.axHasPublicProperty=function(t){return rn.name=t,this.axHasProperty(rn)},t.prototype.axSetProperty=function(t,e,i){var r=t.name;if("number"==typeof r||isNumeric(r=axCoerceName(r)))this[+r]=e;else{var n=!1,o=this.traits.getTrait(t.namespaces,r);if(o){var s=o.name.getMangledName();switch(o.kind){case 1:this.sec.throwError("ReferenceError",Errors$1.CannotAssignToMethodError,r,this.axClass.name.name);case 2:this.sec.throwError("ReferenceError",Errors$1.ConstWriteError,r,this.axClass.name.name);case 4:case 6:104!==i&&this.sec.throwError("ReferenceError",Errors$1.ConstWriteError,r,this.axClass.name.name),n=!0}var a=o.getType();a&&(e=a.axCoerce(e))}else s="$Bg"+r;this[s]=e,n&&Object.defineProperty(this,s,{writable:!1})}},t.prototype.axGetProperty=function(t){var e=this.axResolveMultiname(t),i=this[e];return"function"==typeof i?this.axGetMethod(e):(void 0===i&&(i=this[e.replace("$Bg","")]),i)},t.prototype.axGetMethod=function(t){var e=this._methodClosureCache;e||(Object.defineProperty(this,"_methodClosureCache",{value:Object.create(null)}),e=this._methodClosureCache);var i=e[t];return i||(i=e[t]=this.sec.AXMethodClosure.Create(this,this[t])),i},t.prototype.axGetSuper=function(t,e){var i,r=axCoerceName(t.name),n=t.namespaces,o=e.parent.object.tPrototype.traits.getTrait(n,r);if(2===o.kind||7===o.kind)i=o.get.call(this);else{var s=o.name.getMangledName();if("function"==typeof(i=this[s]))return this.axGetMethod(s)}return i},t.prototype.axSetSuper=function(t,e,i){var r=axCoerceName(t.name),n=t.namespaces,o=e.parent.object.tPrototype.traits.getTrait(n,r),s=o.getType();s&&(i=s.axCoerce(i)),3===o.kind||7===o.kind?o.set.call(this,i):this[o.name.getMangledName()]=i},t.prototype.axDeleteProperty=function(t){var e=axCoerceName(t.name),i=t.namespaces;return!this.traits.getTrait(i,e)&&delete this[t.getPublicMangledName()]},t.prototype.axCallProperty=function(t,e,i){var r=this[this.axResolveMultiname(t)];return validateCall(this.sec,r,e.length),r.axApply(i?null:this,e)},t.prototype.axCallSuper=function(t,e,i){var r=this.axResolveMultiname(t),n=e.parent.object.tPrototype[r];return validateCall(this.sec,n,i.length),n.axApply(this,i)},t.prototype.axConstructProperty=function(t,e){var i=this[this.axResolveMultiname(t)];return validateConstruct(this.sec,i,e.length),i.axConstruct(e)},t.prototype.axHasPropertyInternal=function(t){return this.axResolveMultiname(t)in this},t.prototype.axHasOwnProperty=function(t){var e=this.axResolveMultiname(t);return this.hasOwnProperty(e)||this.axClass.tPrototype.hasOwnProperty(e)},t.prototype.axGetEnumerableKeys=function(){if(this.sec.isPrimitive(this))return[];for(var t=Object.getPrototypeOf(this),e=Object.keys(this),i=[],r=0;r<e.length;r++){var n=e[r];if(isNumeric(n))i.push(n);else{if(t.hasOwnProperty(n))continue;var o=Multiname.stripPublicMangledName(n);void 0!==o&&i.push(o)}}return i},t.prototype.axGetPublicProperty=function(t){return this[Multiname.getPublicMangledName(t)]},t.prototype.axSetPublicProperty=function(t,e){this[Multiname.getPublicMangledName(t)]=e},t.prototype.axCallPublicProperty=function(t,e){return this[Multiname.getPublicMangledName(t)].axApply(this,e)},t.prototype.axDeletePublicProperty=function(t){return delete this[Multiname.getPublicMangledName(t)]},t.prototype.axGetSlot=function(t){return this[this.traits.getSlot(t).name.getMangledName()]},t.prototype.axSetSlot=function(t,e){var i=this.traits.getSlot(t),r=i.name.getMangledName(),n=i.getType();this[r]=n?n.axCoerce(e):e},t.prototype.axNextNameIndex=function(t){0===t&&defineNonEnumerableProperty(this,"axEnumerableKeys",this.axGetEnumerableKeys());for(var e=this.axEnumerableKeys;t<e.length;){if(rn.name=e[t],this.axHasPropertyInternal(rn))return t+1;t++}return 0},t.prototype.axNextName=function(t){return this.axEnumerableKeys[t-1]},t.prototype.axNextValue=function(t){return this.axGetPublicProperty(this.axNextName(t))},t.prototype.axSetNumericProperty=function(t,e){this.axSetPublicProperty(t,e)},t.prototype.axGetNumericProperty=function(t){return this.axGetPublicProperty(t)},t.classSymbols=null,t.instanceSymbols=null,t}(),Event=function(t){function e(e,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0);var n=t.call(this)||this;return n._type=axCoerceString(e),n._bubbles=!!i,n._cancelable=!!r,n._target=null,n._currentTarget=null,n._eventPhase=null,n._stopPropagation=!1,n._stopImmediatePropagation=!1,n._isDefaultPrevented=!1,n}return __extends(e,t),e.getInstance=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=this._instances[t];return n||(n=new e(t,i,r),this._instances[t]=n),n._bubbles=i,n._cancelable=r,n},e.getBroadcastInstance=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=this._instances[t];return n||(n=new e(t,i,r),this._instances[t]=n),n._isBroadcastEvent=!0,n._bubbles=i,n._cancelable=r,n},e.isBroadcastEventType=function(t){switch(t){case e.ENTER_FRAME:case e.EXIT_FRAME:case e.FRAME_CONSTRUCTED:case e.RENDER:case e.ACTIVATE:case e.DEACTIVATE:return!0}return!1},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},set:function(t){this._currentTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this._stopPropagation=!0},e.prototype.stopImmediatePropagation=function(){this._stopImmediatePropagation=this._stopPropagation=!0},e.prototype.preventDefault=function(){this._cancelable&&(this._isDefaultPrevented=!0)},e.prototype.isDefaultPrevented=function(){return this._isDefaultPrevented},e.prototype.isBroadcastEvent=function(){return!!this._isBroadcastEvent},e.prototype.clone=function(){return new e(this._type,this._bubbles,this._cancelable)},e.prototype.toString=function(){return this.formatToString("Event","type","bubbles","cancelable","eventPhase")},e.prototype.formatToString=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var r="["+t,n=0;n<e.length;n++){var o=e[n],s=this.axGetPublicProperty(o);"string"==typeof s&&(s='"'+s+'"'),r+=" "+o+"="+s}return r+"]"},e.classInitializer=function(){this._instances=ObjectUtilities.createMap()},e.ACTIVATE="activate",e.ADDED="added",e.ADDED_TO_STAGE="addedToStage",e.CANCEL="cancel",e.CHANGE="change",e.CLEAR="clear",e.CLOSE="close",e.COMPLETE="complete",e.CONNECT="connect",e.COPY="copy",e.CUT="cut",e.DEACTIVATE="deactivate",e.ENTER_FRAME="enterFrame",e.FRAME_CONSTRUCTED="frameConstructed",e.EXIT_FRAME="exitFrame",e.FRAME_LABEL="frameLabel",e.ID3="id3",e.INIT="init",e.MOUSE_LEAVE="mouseLeave",e.OPEN="open",e.PASTE="paste",e.REMOVED="removed",e.REMOVED_FROM_STAGE="removedFromStage",e.RENDER="render",e.RESIZE="resize",e.SCROLL="scroll",e.TEXT_INTERACTION_MODE_CHANGE="textInteractionModeChange",e.SELECT="select",e.SELECT_ALL="selectAll",e.SOUND_COMPLETE="soundComplete",e.TAB_CHILDREN_CHANGE="tabChildrenChange",e.TAB_ENABLED_CHANGE="tabEnabledChange",e.TAB_INDEX_CHANGE="tabIndexChange",e.UNLOAD="unload",e.FULLSCREEN="fullScreen",e.CONTEXT3D_CREATE="context3DCreate",e.TEXTURE_READY="textureReady",e.VIDEO_FRAME="videoFrame",e.SUSPEND="suspend",e.AVM1_INIT="initialize",e.AVM1_CONSTRUCT="construct",e.AVM1_LOAD="load",e}(ASObject$1),EventDispatcherBase=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._listenerObjects=new Array,i._queuedEvents=[],i._t=e||i,i}return __extends(e,t),e.prototype.toString=function(){return""},e.prototype.addEventListener=function(t,e){if(this._listenerObjects){var i=this._listenerObjects[t];void 0===i&&(i=this._listenerObjects[t]=new ListenerObject$1),i.addEventListener(e)}},e.prototype.removeEventListener=function(t,e){if(this._listenerObjects){var i=this._listenerObjects[t];i&&(i.removeEventListener(e),0==i.numListeners&&delete this._listenerObjects[t])}},e.prototype.getQueuedEvents=function(){if(!this._queuedEvents)return null;var t=this._queuedEvents.concat();return this._queuedEvents.length=0,t},e.prototype.dispatchEvent=function(t){if(!this._listenerObjects)return this._queuedEvents||(this._queuedEvents=[]),void this._queuedEvents.push(t);var e=this._listenerObjects[t.type];e&&(t.target=this._t,e.dispatchEvent(t))},e.prototype.hasEventListener=function(t,e){if(this._listenerObjects)return void 0!==this._listenerObjects[t]&&(null!=e?-1!==this._listenerObjects[t].getEventListenerIndex(e):this._listenerObjects[t].numListeners>0)},e}(ASObject$1),ListenerObject$1=function(){function t(){this._index=0,this._listeners=new Array,this.numListeners=0}return t.prototype.addEventListener=function(t){-1===this.getEventListenerIndex(t)&&(this._listeners.push(t),this.numListeners++)},t.prototype.removeEventListener=function(t){var e=this.getEventListenerIndex(t);-1!==e&&(this._listeners.splice(e,1),e<=this._index&&this._index--,this.numListeners--)},t.prototype.dispatchEvent=function(t){var e=this.numListeners;for(this._index=0;this._index<e&&this._index<this.numListeners;this._index++)this._listeners[this._index].call(this._listeners[this._index],t)},t.prototype.getEventListenerIndex=function(t){for(var e=0;e<this.numListeners;e++)if(t==this._listeners[e])return e;return-1},t}(),EventDispatcher$1=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this,e)||this;return i.eventMapping={},i.eventMappingDummys={},i.eventMappingExtern={},i.eventMappingInvert={},i._activateCallbackDelegate=function(t){return i.activateCallback(t)},i.eventMapping[Event.ACTIVATE]={adaptedType:"",addListener:i.initActivateListener,removeListener:i.removeActivateListener,callback:i._activateCallbackDelegate},i._deactivateCallbackDelegate=function(t){return i.deactivateCallback(t)},i.eventMapping[Event.DEACTIVATE]={adaptedType:"",addListener:i.initDeactivateListener,removeListener:i.removeDeactivateListener,callback:i._deactivateCallbackDelegate},i}return __extends(e,t),e.prototype.toString=function(){return""},e.prototype.hasEventListener=function(e,i){return t.prototype.hasEventListener.call(this,e,i)},e.prototype.willTrigger=function(){},e.prototype.dispatchQueuedEvents=function(){for(var t=0;t<this._queuedEvents.length;t++)this.dispatchEvent(this._queuedEvents[t]);this._queuedEvents.length=0},e.prototype.getQueuedEvents=function(){return t.prototype.getQueuedEvents.call(this)},e.prototype.dispatchEvent=function(e){t.prototype.dispatchEvent.call(this,e)},e.prototype.initActivateListener=function(t,e){window.onfocus=e},e.prototype.removeActivateListener=function(t,e){window.onfocus=null},e.prototype.activateCallback=function(t){this.dispatchEvent(new this.sec.flash.events.Event(Event.ACTIVATE))},e.prototype.initDeactivateListener=function(t,e){window.onblur=e},e.prototype.removeDeactivateListener=function(t,e){window.onblur=null},e.prototype.deactivateCallback=function(t){this.dispatchEvent(new this.sec.flash.events.Event(Event.DEACTIVATE))},e.prototype.addEventListener=function(e,i,r,n,o){if(void 0===r&&(r=!1),!r&&Event.isBroadcastEventType(e)&&BroadcastEventDispatchQueue.getInstance().add(e,this),this.eventMappingExtern.hasOwnProperty(e))t.prototype.addEventListener.call(this,e,i);else if(!this.eventMappingDummys.hasOwnProperty(e))return this.eventMapping.hasOwnProperty(e)?(t.prototype.addEventListener.call(this,e,i),void this.eventMapping[e].addListener.call(this,this.eventMapping[e].adaptedType,this.eventMapping[e].callback)):void 0},e.prototype.removeEventListener=function(e,i){t.prototype.removeEventListener.call(this,e,i),this.eventMapping.hasOwnProperty(e)&&(this.eventMapping[e].removeListener.call(this,this.eventMapping[e].adaptedType,this.eventMapping[e].callback),this.hasEventListener(e)||Event.isBroadcastEventType(e)&&BroadcastEventDispatchQueue.getInstance().remove(e,this))},e}(EventDispatcherBase),BroadcastEventDispatchQueue=function(){function t(){this.reset()}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.reset=function(){this._queues={}},t.prototype.add=function(t,e){var i=this._queues[t]||(this._queues[t]=[]);i.indexOf(e)>=0||i.push(e)},t.prototype.remove=function(t,e){var i=this._queues[t],r=i.indexOf(e);i[r]=null},t.prototype.dispatchEvent=function(t){var e=this._queues[t._type];if(e){for(var i=0,r=0;r<e.length;r++){var n=e[r];null===n?i++:n.dispatchEvent(t)}if(i>16&&i>e.length>>1){var o=[];for(r=0;r<e.length;r++)e[r]&&o.push(e[r]);this._queues[t.type]=o}}},t.prototype.getQueueLength=function(t){return this._queues[t]?this._queues[t].length:0},t}();function constructClassFromSymbol(t,e){var i=Object.create(e.tPrototype);return i._symbol||(i._symbol=t),i.applySmybol&&i.applySymbol(),i}var OrphanManager=function(){function t(){}return t.addOrphan=function(e){t.orphans.indexOf(e)>=0||t.orphans.push(e)},t.removeOrphan=function(e){if(!(t.orphans.indexOf(e)<0)){for(var i=[],r=0;r<t.orphans.length;r++)t.orphans[r]!=e&&i.push(t.orphans[r]);t.orphans=i}},t.updateOrphans=function(e){for(var i=0;i<t.orphans.length;i++)t.orphans[i].adaptee.isAsset(MovieClip)?t.orphans[i].adaptee.update(e):t.orphans[i].advanceFrame(e)},t.orphans=[],t}(),StaticEvents=function(){function t(){}return t.events={},t}(),DisplayObject$1=function(t){function e(){var e=t.call(this)||this;return e._blockedByScript=!1,e._ctBlockedByScript=!1,e._visibilityByScript=!1,e.adaptee=e.adaptee||e.createAdaptee(),e._stage=e.activeStage,e.eventMappingExtern[Event.ENTER_FRAME]="",e.eventMappingExtern[Event.FRAME_CONSTRUCTED]="",e.eventMappingExtern[Event.EXIT_FRAME]="",e.eventMappingExtern[Event.RENDER]="",e.eventMappingExtern[Event.REMOVED]="",e.eventMappingExtern[Event.ADDED_TO_STAGE]="",e.eventMappingExtern[Event.ADDED]="",e._transform=new e.sec.flash.geom.Transform(e.adaptee.transform),e}return __extends(e,t),e.prototype.toString=function(){return this.adaptee.name},e.prototype.applySymbol=function(){},e.prototype.dispatchStaticEvent=function(t){StaticEvents.events[t]||(StaticEvents.events[t]=new this.sec.flash.events.Event(t)),this.dispatchEvent(StaticEvents.events[t])},e.prototype.dispatchStaticBroadCastEvent=function(t){StaticEvents.events[t]||(StaticEvents.events[t]=new this.sec.flash.events.Event(t)),BroadcastEventDispatchQueue.getInstance().dispatchEvent(StaticEvents.events[t])},e.prototype.createAdaptee=function(){return new DisplayObject},Object.defineProperty(e.prototype,"activeStage",{get:function(){return null==this.sec.flash.display.DisplayObject.axClass._activeStage&&console.log("ERROR: a Stage must have been created before any Sprite can be created!"),this.sec.flash.display.DisplayObject.axClass._activeStage},enumerable:!0,configurable:!0}),e.prototype.dispatchEventRecursive=function(t){this.dispatchEvent(t)},Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},set:function(t){this._adaptee!=t&&(this._adaptee&&(this._adaptee.adapter=null),this._adaptee=t,this._adaptee&&(this._adaptee.partition||(this._adaptee.partition=new SceneGraphPartition(this._adaptee)),this._adaptee.adapter=this))},enumerable:!0,configurable:!0}),e.prototype.initAdapter=function(){},e.prototype.isBlockedByScript=function(){return this._blockedByScript},e.prototype.isVisibilityByScript=function(){return this._visibilityByScript},e.prototype.isColorTransformByScript=function(){return this._ctBlockedByScript},e.prototype.freeFromScript=function(){this._blockedByScript=!1,this._ctBlockedByScript=!1,this._visibilityByScript=!1},e.prototype.clone=function(){if(!this._symbol)throw"_symbol not defined when cloning movieclip";var t=constructClassFromSymbol(this._symbol,this._symbol.symbolClass);return t.axInitializer(),this.adaptee.copyTo(t.adaptee),t},e.prototype.dispose=function(){throw new AbstractMethodError},e.prototype.disposeValues=function(){this.adaptee=null},Object.defineProperty(e.prototype,"accessibilityProperties",{get:function(){return console.log("accessibilityProperties not implemented yet in flash/DisplayObject"),null},set:function(t){console.log("accessibilityProperties not implemented yet in flash/DisplayObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.adaptee.alpha},set:function(t){this._ctBlockedByScript=!0,this.adaptee.alpha=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return console.log("blendMode not implemented yet in flash/DisplayObject"),""},set:function(t){console.log("blendMode not implemented yet in flash/DisplayObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendShader",{set:function(t){console.log("blendShader not implemented yet in flash/DisplayObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheAsBitmap",{get:function(){return console.log("cacheAsBitmap not implemented yet in flash/DisplayObject"),!1},set:function(t){console.log("cacheAsBitmap not implemented yet in flash/DisplayObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return[]},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){if(!this._adaptee.partition)return console.warn("Trying to get Display.height on orphan child!"),100;var t=PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(this.adaptee);return null==t?0:t.height},set:function(t){isNaN(t)||(this._blockedByScript=!0,this._adaptee.partition?PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).height=t:console.warn("Trying to set Display.height on orphan child!"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaderInfo",{get:function(){return this._loaderInfo||(this._loaderInfo=new this.sec.flash.display.LoaderInfo),this._loaderInfo},set:function(t){this._loaderInfo=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return null==this.adaptee.masks?null:0==this.adaptee.masks.length?null:this.adaptee.masks[0].adapter},set:function(t){if(null==t)return null!=this.adaptee.masks&&(this.adaptee.masks[0].maskMode=!1),void(this.adaptee.masks=null);t.adaptee.maskMode=!0,this.adaptee.masks=[t.adaptee]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metaData",{get:function(){return console.log("mask not implemented yet in flash/DisplayObject"),null},set:function(t){console.log("mask not implemented yet in flash/DisplayObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseX",{get:function(){return this.adaptee.transform.globalToLocal(new Point(this.stage.mouseX,0)).x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseY",{get:function(){return this.adaptee.transform.globalToLocal(new Point(0,this.stage.mouseY)).y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.adaptee.name},set:function(t){this.adaptee.name=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opaqueBackground",{get:function(){return console.log("opaqueBackground not implemented yet in flash/DisplayObject"),null},set:function(t){console.log("opaqueBackground not implemented yet in flash/DisplayObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return null==this.adaptee.parent||null==this.adaptee.parent.adapter||this.adaptee.parent.adapter==this.adaptee.parent?null:this.adaptee.parent.adapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.stage.getChildAt(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.adaptee.rotationZ},set:function(t){this.adaptee.rotationZ=isNaN(t)?0:isFinite(t)?t:-8},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this.adaptee.rotationX},set:function(t){this.adaptee.rotationX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this.adaptee.rotationY},set:function(t){this.adaptee.rotationY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this.adaptee.rotationZ},set:function(t){this.adaptee.rotationZ=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale9Grid",{get:function(){return new this.sec.flash.geom.Rectangle(this.adaptee.scale9Grid)},set:function(t){this.adaptee.scale9Grid=t.adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this.adaptee.scaleX},set:function(t){this._blockedByScript=!0,this.adaptee.scaleX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this.adaptee.scaleY},set:function(t){this._blockedByScript=!0,this.adaptee.scaleY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleZ",{get:function(){return this.adaptee.scaleZ},set:function(t){this._blockedByScript=!0,this.adaptee.scaleZ=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollRect",{get:function(){return new this.sec.flash.geom.Rectangle(this.adaptee.scrollRect)},set:function(t){this.adaptee.scrollRect=t.adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage",{get:function(){return this._stage},set:function(t){this._stage=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this._ctBlockedByScript=!0,this._transform=new this.sec.flash.geom.Transform(this.adaptee.transform)},set:function(t){console.log("DisplayObject:setter for transform not yet implemented")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this.adaptee.visible},set:function(t){this._visibilityByScript=!0,this.adaptee.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){if(!this.adaptee.partition)return console.warn("Trying to get Display.width on orphan child!"),100;var t=PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(this.adaptee);return null==t?0:t.width},set:function(t){this.adaptee.partition?(this._blockedByScript=!0,isNaN(t)||(PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).width=t)):console.warn("Trying to set Display.width on orphan child!")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.adaptee.x},set:function(t){this._blockedByScript=!0,this.adaptee.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.adaptee.y},set:function(t){this._blockedByScript=!0,this.adaptee.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this.adaptee.z},set:function(t){this._blockedByScript=!0,this.adaptee.z=t},enumerable:!0,configurable:!0}),e.prototype.getBounds=function(t){var e=PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(this.adaptee);return new this.sec.flash.geom.Rectangle(e.x-this.x,e.y-this.y,e.width,e.height)},e.prototype.getRect=function(t){var e=PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).getBoxBounds(this.adaptee);return e?new this.sec.flash.geom.Rectangle(e.x-this.x,e.y-this.y,e.width,e.height):new this.sec.flash.geom.Rectangle},e.prototype.globalToLocal=function(t){return new this.sec.flash.geom.Point(this.adaptee.transform.globalToLocal(t.adaptee))},e.prototype.globalToLocal3D=function(t){return console.log("DisplayObject:globalToLocal3D not yet implemented"),new this.sec.flash.geom.Vector3D},e.prototype.hitTestObject=function(t){return PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).hitTestObject(PickGroup.getInstance(this._stage.view).getBoundsPicker(t.adaptee.partition))},e.prototype.hitTestPoint=function(t,e,i){return void 0===i&&(i=!1),PickGroup.getInstance(this._stage.view).getBoundsPicker(this.adaptee.partition).hitTestPoint(t,e,i)},e.prototype._getObjectsUnderPointInternal=function(t,e){},e.prototype.local3DToGlobal=function(t){return console.log("DisplayObject:local3DToGlobal not yet implemented"),new this.sec.flash.geom.Point},e.prototype.localToGlobal=function(t){return new this.sec.flash.geom.Point(this.adaptee.transform.localToGlobal(t.adaptee))},e._activeStage=null,e}(EventDispatcher$1),MouseEvent$1=function(t){function e(e,i,r,n,o,s,a,l,h,c,u){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===h&&(h=!1),void 0===c&&(c=!1),void 0===u&&(u=0);var p=t.call(this,e,i,r)||this;return p.localX=n,p.localY=o,p.relatedObject=s,p.ctrlKey=a,p.altKey=l,p.shiftKey=h,p.buttonDown=c,p.delta=u,p}return __extends(e,t),Object.defineProperty(e.prototype,"altKey",{get:function(){return this._altKey},set:function(t){this._altKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonDown",{get:function(){return this._buttonDown},set:function(t){this._buttonDown=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctrlKey",{get:function(){return this._ctrlKey},set:function(t){this._ctrlKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delta",{get:function(){return this._delta},set:function(t){this._delta=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRelatedObjectInaccessible",{get:function(){return this._isRelatedObjectInaccessible},set:function(t){this._isRelatedObjectInaccessible=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localX",{get:function(){return this._localX},set:function(t){this._localX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localY",{get:function(){return this._localY},set:function(t){this._localY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementX",{get:function(){return this._movementX},set:function(t){this._movementX=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementY",{get:function(){return this._movementY},set:function(t){this._movementY=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relatedObject",{get:function(){return this._relatedObject},set:function(t){this._relatedObject=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shiftKey",{get:function(){return this._shiftKey},set:function(t){this._shiftKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageX",{get:function(){return this._stageX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageY",{get:function(){return this._stageY},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return null},e.prototype.fillFromJS=function(t){this._stageX=null!=t.clientX?t.clientX:t.changedTouches[0].clientX,this._stageY=null!=t.clientY?t.clientY:t.changedTouches[0].clientY,this.delta=t.delta,this._stageY<0&&(this._stageY=0),this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey},e.prototype.fillFromAway=function(t){this.target=t.target,this.delta=t.delta,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this._stageX=t.screenX,this._stageY=t.screenY},e.prototype.toString=function(){return""},e.prototype.updateAfterEvent=function(){},e.CLICK="click",e.CONTEXT_MENU="contextMenu",e.DOUBLE_CLICK="doubleClick",e.MIDDLE_CLICK="middleClick",e.MIDDLE_MOUSE_DOWN="middleMouseDown",e.MIDDLE_MOUSE_UP="middleMouseUp",e.MOUSE_DOWN="mouseDown",e.MOUSE_MOVE="mouseMove",e.MOUSE_OUT="mouseOut",e.MOUSE_OVER="mouseOver",e.MOUSE_UP="mouseUp",e.MOUSE_WHEEL="mouseWheel",e.RIGHT_CLICK="rightClick",e.RIGHT_MOUSE_DOWN="rightMouseDown",e.RIGHT_MOUSE_UP="rightMouseUp",e.ROLL_OUT="rollOut",e.ROLL_OVER="rollOver",e}(Event),EventPhase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.CAPTURING_PHASE=1,e.AT_TARGET=2,e.BUBBLING_PHASE=3,e}(ASObject$1),Event$1=function(t){function e(e,i,r){var n=t.call(this)||this;return n._type=axCoerceString(e),n._bubbles=!!i,n._cancelable=!!r,n._target=null,n._currentTarget=null,n._eventPhase=EventPhase.AT_TARGET,n._stopPropagation=!1,n._stopImmediatePropagation=!1,n._isDefaultPrevented=!1,n}return __extends(e,t),e.getInstance=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=this._instances[t];return n||(n=new e(t,i,r),this._instances[t]=n),n._bubbles=i,n._cancelable=r,n},e.getBroadcastInstance=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=this._instances[t];return n||(n=new e(t,i,r),this._instances[t]=n),n._isBroadcastEvent=!0,n._bubbles=i,n._cancelable=r,n},e.isBroadcastEventType=function(t){switch(t){case e.ENTER_FRAME:case e.EXIT_FRAME:case e.FRAME_CONSTRUCTED:case e.RENDER:case e.ACTIVATE:case e.DEACTIVATE:return!0}return!1},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),e.prototype.stopPropagation=function(){this._stopPropagation=!0},e.prototype.stopImmediatePropagation=function(){this._stopImmediatePropagation=this._stopPropagation=!0},e.prototype.preventDefault=function(){this._cancelable&&(this._isDefaultPrevented=!0)},e.prototype.isDefaultPrevented=function(){return this._isDefaultPrevented},e.prototype.isBroadcastEvent=function(){return!!this._isBroadcastEvent},e.prototype.clone=function(){return new e(this._type,this._bubbles,this._cancelable)},e.prototype.toString=function(){return this.formatToString("Event","type","bubbles","cancelable","eventPhase")},e.prototype.formatToString=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var r="["+t,n=0;n<e.length;n++){var o=e[n],s=this.axGetPublicProperty(o);"string"==typeof s&&(s='"'+s+'"'),r+=" "+o+"="+s}return r+"]"},e.classInitializer=function(){this._instances=ObjectUtilities.createMap()},e.ACTIVATE="activate",e.ADDED="added",e.ADDED_TO_STAGE="addedToStage",e.CANCEL="cancel",e.CHANGE="change",e.CLEAR="clear",e.CLOSE="close",e.COMPLETE="complete",e.CONNECT="connect",e.COPY="copy",e.CUT="cut",e.DEACTIVATE="deactivate",e.ENTER_FRAME="enterFrame",e.FRAME_CONSTRUCTED="frameConstructed",e.EXIT_FRAME="exitFrame",e.FRAME_LABEL="frameLabel",e.ID3="id3",e.INIT="init",e.MOUSE_LEAVE="mouseLeave",e.OPEN="open",e.PASTE="paste",e.REMOVED="removed",e.REMOVED_FROM_STAGE="removedFromStage",e.RENDER="render",e.RESIZE="resize",e.SCROLL="scroll",e.TEXT_INTERACTION_MODE_CHANGE="textInteractionModeChange",e.SELECT="select",e.SELECT_ALL="selectAll",e.SOUND_COMPLETE="soundComplete",e.TAB_CHILDREN_CHANGE="tabChildrenChange",e.TAB_ENABLED_CHANGE="tabEnabledChange",e.TAB_INDEX_CHANGE="tabIndexChange",e.UNLOAD="unload",e.FULLSCREEN="fullScreen",e.CONTEXT3D_CREATE="context3DCreate",e.TEXTURE_READY="textureReady",e.VIDEO_FRAME="videoFrame",e.SUSPEND="suspend",e.AVM1_INIT="initialize",e.AVM1_CONSTRUCT="construct",e.AVM1_LOAD="load",e}(ASObject$1),KeyboardEvent$1=function(t){function e(e,i,r,n,o,s,a,l,h){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===h&&(h=!1);var c=t.call(this,e,i,r)||this;return c._charCode=n>>>0,c._keyCode=o>>>0,c._keyLocation=s>>>0,c._ctrlKey=!!a,c._altKey=!!l,c._shiftKey=!!h,c}return __extends(e,t),Object.defineProperty(e.prototype,"charCode",{get:function(){return this._charCode},set:function(t){this._charCode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyCode",{get:function(){return this._keyCode},set:function(t){this._keyCode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyLocation",{get:function(){return this._keyLocation},set:function(t){this._keyLocation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctrlKey",{get:function(){return this._ctrlKey},set:function(t){this._ctrlKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altKey",{get:function(){return this._altKey},set:function(t){this._altKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shiftKey",{get:function(){return this._shiftKey},set:function(t){this._shiftKey=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.charCode,this.keyCode,this.keyLocation,this.ctrlKey,this.altKey,this.shiftKey)},e.prototype.toString=function(){return this.formatToString("KeyboardEvent","type","bubbles","cancelable","eventPhase","charCode","keyCode","keyLocation","ctrlKey","altKey","shiftKey")},e.prototype.updateAfterEvent=function(){this.sec.player.requestRendering()},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.KEY_DOWN="keyDown",e.KEY_UP="keyUp",e}(Event$1),InteractiveObject=function(t){function e(){var e=t.call(this)||this;return e.eventMappingDummys[MouseEvent$1.RIGHT_MOUSE_UP]="InteractiveObject:MouseEvent.RIGHT_MOUSE_UP",e.eventMappingDummys[MouseEvent$1.RIGHT_MOUSE_DOWN]="InteractiveObject:MouseEvent.RIGHT_MOUSE_DOWN",e.eventMappingDummys[MouseEvent$1.RIGHT_MOUSE_DOWN]="InteractiveObject:MouseEvent.RIGHT_MOUSE_DOWN",e.eventMappingDummys[MouseEvent$1.RIGHT_CLICK]="InteractiveObject:MouseEvent.RIGHT_CLICK",e.eventMappingDummys[MouseEvent$1.MIDDLE_MOUSE_UP]="InteractiveObject:MouseEvent.MIDDLE_MOUSE_UP",e.eventMappingDummys[MouseEvent$1.MIDDLE_MOUSE_DOWN]="InteractiveObject:MouseEvent.MIDDLE_MOUSE_DOWN",e.eventMappingDummys[MouseEvent$1.MIDDLE_CLICK]="InteractiveObject:MouseEvent.MIDDLE_CLICK",e._keyUpCallbackDelegate=function(t){return e.keyUpCallback(t)},e.eventMapping[KeyboardEvent$1.KEY_UP]={adaptedType:"",addListener:e.initKeyUpListener,removeListener:e.removeKeyUpListener,callback:e._keyUpCallbackDelegate},e._keyDownCallbackDelegate=function(t){return e.keyDownCallback(t)},e.eventMapping[KeyboardEvent$1.KEY_DOWN]={adaptedType:"",addListener:e.initKeyDownListener,removeListener:e.removeKeyDownListener,callback:e._keyDownCallbackDelegate},e._mouseCallbackDelegate=function(t){return e.mouseCallback(t)},e.eventMappingInvert[MouseEvent.MOUSE_WHEEL]=MouseEvent$1.MOUSE_WHEEL,e.eventMapping[MouseEvent$1.MOUSE_WHEEL]={adaptedType:MouseEvent.MOUSE_WHEEL,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.MOUSE_UP]=MouseEvent$1.MOUSE_UP,e.eventMapping[MouseEvent$1.MOUSE_UP]={adaptedType:MouseEvent.MOUSE_UP,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.MOUSE_OVER]=MouseEvent$1.MOUSE_OVER,e.eventMapping[MouseEvent$1.MOUSE_OVER]={adaptedType:MouseEvent.MOUSE_OVER,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.MOUSE_OUT]=MouseEvent$1.MOUSE_OUT,e.eventMapping[MouseEvent$1.MOUSE_OUT]={adaptedType:MouseEvent.MOUSE_OUT,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.MOUSE_MOVE]=MouseEvent$1.MOUSE_MOVE,e.eventMapping[MouseEvent$1.MOUSE_MOVE]={adaptedType:MouseEvent.MOUSE_MOVE,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.MOUSE_DOWN]=MouseEvent$1.MOUSE_DOWN,e.eventMapping[MouseEvent$1.MOUSE_DOWN]={adaptedType:MouseEvent.MOUSE_DOWN,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.DOUBLE_CLICK]=MouseEvent$1.DOUBLE_CLICK,e.eventMapping[MouseEvent$1.DOUBLE_CLICK]={adaptedType:MouseEvent.DOUBLE_CLICK,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e.eventMappingInvert[MouseEvent.CLICK]=MouseEvent$1.CLICK,e.eventMapping[MouseEvent$1.CLICK]={adaptedType:MouseEvent.CLICK,addListener:e.initMouseListener,removeListener:e.removeMouseListener,callback:e._mouseCallbackDelegate},e}return __extends(e,t),e.prototype.initKeyUpListener=function(t,e){document.addEventListener("keyup",e),document.addEventListener("keypress",e)},e.prototype.removeKeyUpListener=function(t,e){document.removeEventListener("keyup",e)},e.prototype.keyUpCallback=function(t){void 0===t&&(t=null),window.event&&(window.event.returnValue=!1),t.preventDefault?t.preventDefault():t.returnValue=!1;var e=new this.sec.flash.events.KeyboardEvent(KeyboardEvent$1.KEY_UP,!0,!1,t.charCode,t.keyCode,t.location,t.ctrlKey,t.altKey,t.shiftKey);return this.dispatchEvent(e),!1},e.prototype.initKeyDownListener=function(t,e){document.addEventListener("keydown",e),document.addEventListener("keypress",e)},e.prototype.removeKeyDownListener=function(t,e){document.removeEventListener("keydown",e),document.removeEventListener("keypress",e)},e.prototype.keyDownCallback=function(t){void 0===t&&(t=null),window.event&&(window.event.returnValue=!1),t.preventDefault?t.preventDefault():t.returnValue=!1;var e=new this.sec.flash.events.KeyboardEvent(KeyboardEvent$1.KEY_DOWN);return e.axInitializer(KeyboardEvent$1.KEY_DOWN),e.keyCode=t.keyCode,e.charCode=t.charCode,e.shiftKey=t.shiftKey,e.ctrlKey=t.ctrlKey,e.altKey=t.altKey,this.dispatchEvent(e),!1},e.prototype.initMouseListener=function(t,e){this.adaptee.addEventListener(t,e)},e.prototype.removeMouseListener=function(t,e){this.adaptee.removeEventListener(t,e)},e.prototype.mouseCallback=function(t){var e=new this.sec.flash.events.MouseEvent(this.eventMappingInvert[t.type]);e.fillFromAway(t),e.target=this,this.dispatchEvent(e)},Object.defineProperty(e.prototype,"accessibilityImplementation",{get:function(){return console.log("accessibilityImplementation not implemented yet in flash/InteractiveObject"),null},set:function(t){console.log("accessibilityImplementation not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contextMenu",{get:function(){return console.log("contextMenu not implemented yet in flash/InteractiveObject"),null},set:function(t){console.log("contextMenu not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClickEnabled",{get:function(){return console.log("doubleClickEnabled not implemented yet in flash/InteractiveObject"),!1},set:function(t){console.log("doubleClickEnabled not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusRect",{get:function(){return console.log("focusRect not implemented yet in flash/InteractiveObject"),null},set:function(t){console.log("focusRect not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseEnabled",{get:function(){return this.adaptee.mouseEnabled},set:function(t){this.adaptee.mouseEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsSoftKeyboard",{get:function(){return console.log("needsSoftKeyboard not implemented yet in flash/InteractiveObject"),!1},set:function(t){console.log("needsSoftKeyboard not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"softKeyboardInputAreaOfInterest",{get:function(){return console.log("softKeyboardInputAreaOfInterest not implemented yet in flash/InteractiveObject"),null},set:function(t){console.log("softKeyboardInputAreaOfInterest not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabEnabled",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabIndex",{get:function(){return console.log("tabIndex not implemented yet in flash/InteractiveObject"),0},set:function(t){console.log("tabIndex not implemented yet in flash/InteractiveObject")},enumerable:!0,configurable:!0}),e.prototype.requestSoftKeyboard=function(){return console.log("requestSoftKeyboard not implemented yet in flash/InteractiveObject"),!1},e}(DisplayObject$1),DisplayObjectContainer$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addTimelineObjectAtDepth=function(t,e){},e.prototype.getTimelineObjectAtDepth=function(t){return null},e.prototype._lookupChildByName=function(t,e){},e.prototype._lookupChildByIndex=function(t,e){},e.prototype.createAdaptee=function(){return new DisplayObjectContainer},e.prototype.clone=function(){if(!this._symbol)throw"_symbol not defined when cloning movieclip";var t=constructClassFromSymbol(this._symbol,this._symbol.symbolClass);return t.axInitializer(),this.adaptee.copyTo(t.adaptee),t},e.prototype.advanceFrame=function(t){for(var e=this._adaptee._children.length;e>0;){e--;var i=this._adaptee._children[e];i&&(i.isAsset(DisplayObjectContainer)?i.adapter&&i.adapter.advanceFrame(t):i.isAsset(Sprite)?i.adapter&&i.adapter.advanceFrame&&i.adapter.advanceFrame(t):i.isAsset(MovieClip)&&i.update())}},e.prototype.dispatchQueuedEvents=function(){t.prototype.dispatchQueuedEvents.call(this);for(var e=0;e<this._adaptee.numChildren;e++){var i=this._adaptee.getChildAt(e);i&&i.adapter&&i.adapter.dispatchQueuedEvents&&i.adapter.dispatchQueuedEvents()}},e.prototype.debugDisplayGraph=function(t){t.object=this,t.rectangle="x:"+this.x+", y:"+this.y+", width:"+this.width+", height:"+this.height,t.children={};var e=0;for(e=0;e<this._adaptee.numChildren;e++){var i=this._adaptee.getChildAt(e),r="child_"+e+" "+i.adapter.constructor.name;if(i.isAsset(Sprite)||i.isAsset(DisplayObjectContainer))i.adapter&&(t.children[r]={},i.adapter.debugDisplayGraph(t.children[r]));else if(i.isAsset(Billboard))t.children[r]={},t.children[r].object=i.adapter,t.children[r].name=i.name,t.children[r].rectangle="x:"+i.x+", y:"+i.y;else if(i.isAsset(MovieClip))t.children[r]={},t.children[r].object=i.adapter,t.children[r].name=i.name,t.children[r].rectangle="x:"+i.x+", y:"+i.y;else if(i.isAsset(TextField)){t.children[r]={},t.children[r].object=i.adapter,t.children[r].text=i.text,t.children[r].rectangle="x:"+i.x+", y:"+i.y;var n=PickGroup.getInstance(this._stage.view).getBoundsPicker(i.partition).getBoxBounds(i);t.children[r].width=null==n?0:n.width,t.children[r].height=null==n?0:n.height}}},Object.defineProperty(e.prototype,"mouseChildren",{get:function(){return this._adaptee.mouseChildren},set:function(t){this._adaptee.mouseChildren=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numChildren",{get:function(){return this._adaptee.numChildren},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabChildren",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSnapshot",{get:function(){throw"textSnapshot not implemented yet in flash/DisplayObjectContainer"},enumerable:!0,configurable:!0}),e.prototype.addChild=function(t){return t.noReset=!0,this._adaptee.addChild(t.adaptee),t.noReset=!1,t.dispatchStaticEvent(Event.ADDED),t.dispatchStaticEvent(Event.ADDED_TO_STAGE),OrphanManager.removeOrphan(t),t},e.prototype.addChildAt=function(t,e){var i=[];t.noReset=!0;for(var r=0;r<this._adaptee.numChildren;r++)t.adaptee.id!=this._adaptee._children[r].id&&(i[i.length]=this._adaptee._children[r]);for(r=0;r<i.length;r++)this._adaptee.removeChild(i[r]);var n=0;for(r=0;r<i.length+1;r++)r==e?this._adaptee.addChild(t.adaptee):(i[n].adapter.noReset=!0,this._adaptee.addChild(i[n++]));return t.noReset=!1,t.dispatchStaticEvent(Event.ADDED),t.dispatchStaticEvent(Event.ADDED_TO_STAGE),t},e.prototype.areInaccessibleObjectsUnderPoint=function(t){throw"areInaccessibleObjectsUnderPoint not implemented yet in flash/DisplayObjectContainer"},e.prototype.contains=function(t){return this._adaptee.contains(t.adaptee)},e.prototype.getChildAt=function(t){var e=this._adaptee.getChildAt(t);return e.adapter&&e.adapter!=e||(e.adapter=this.sec.flash.display.Sprite(e)),e.adapter},e.prototype.getChildByName=function(t){return this._adaptee.getChildByName(t)?this._adaptee.getChildByName(t).adapter:null},e.prototype.getChildIndex=function(t){return this._adaptee.getChildIndex(t.adaptee)},e.prototype.getObjectsUnderPoint=function(t){var e=[];return this._getObjectsUnderPointInternal(t,e),e},e.prototype._getObjectsUnderPointInternal=function(t,e){for(var i,r=this._adaptee.numChildren,n=0;n<r;n++)(i=this._adaptee._children[n]).visible&&(PickGroup.getInstance(this._stage.view).getBoundsPicker(i.adaptee.partition).hitTestPoint(t.x,t.y,!0)&&e.push(i.adapter),i.adapter._getObjectsUnderPointInternal(t,e))},e.prototype.removeChild=function(t){return t.dispatchStaticEvent(Event.REMOVED),this._adaptee.removeChild(t.adaptee),t},e.prototype.removeChildAt=function(t){var e=this._adaptee.removeChildAt(t).adapter;return e.dispatchEvent(new Event(Event.REMOVED)),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647),e>=this._adaptee.numChildren&&(e=this._adaptee.numChildren-1);for(var i=t;i<=e;i++){var r=this._adaptee._children[i];r.adapter&&r.adapter.dispatchStaticEvent(Event.REMOVED)}this._adaptee.removeChildren(t,e+1)},e.prototype.setChildIndex=function(t,e){for(var i=[],r=0;r<this._adaptee.numChildren;r++)i[i.length]=this._adaptee._children[r];for(r=0;r<i.length;r++)this._adaptee.removeChild(i[r]);t.noReset=!0;var n,o=0;for(r=0;r<i.length;r++)r==e?this._adaptee.addChild(t.adaptee):((n=i[o++]).adapter.noReset=!0,n.id!=t.adaptee.id?this._adaptee.addChild(n):((n=i[o++]).adapter.noReset=!0,this._adaptee.addChild(n)),n.adapter.noReset=!1);t.noReset=!1},e.prototype.stopAllMovieClips=function(){throw"stopAllMovieClips not implemented yet in flash/DisplayObjectContainer"},e.prototype.swapChildren=function(t,e){this._adaptee.swapChildren(t.adaptee,e.adaptee)},e.prototype.swapChildrenAt=function(t,e){throw"swapChildrenAt not implemented yet in flash/DisplayObjectContainer"},e}(InteractiveObject),Bitmap=function(t){function e(i,r,n){void 0===i&&(i=null),void 0===r&&(r="auto"),void 0===n&&(n=!1);var o=this,s=new MethodMaterial(i?i.adaptee:0);return s.alphaBlending=!0,s.useColorTransform=!0,e.argBitmapMaterial=s,e.argPixelSnapping=r,e.argSmoothing=n,(o=t.call(this)||this)._bitmapData=i,o._bitmapData&&o._bitmapData._addOwner(o),o}return __extends(e,t),e.getNewBitmap=function(t,i,r){if(void 0===t&&(t=null),void 0===i&&(i="auto"),void 0===r&&(r=!1),e._bitmaps.length){var n=new MethodMaterial(t?t.adaptee:0);n.alphaBlending=!0,n.useColorTransform=!0;var o=e._bitmaps.pop();return o.adaptee=Billboard.getNewBillboard(n,i,r),o}return new e(t,i,r)},e.prototype.createAdaptee=function(){var t=Billboard.getNewBillboard(e.argBitmapMaterial,e.argPixelSnapping,e.argSmoothing);return e.argBitmapMaterial=null,e.argPixelSnapping=null,e.argSmoothing=null,t},e.prototype.clone=function(){var t=e.getNewBitmap(this._bitmapData);return this._adaptee.copyTo(t.adaptee),t},e.prototype.dispose=function(){this.disposeValues(),e._bitmaps.push(this)},e.prototype.disposeValues=function(){this.bitmapData=null,t.prototype.disposeValues.call(this)},Object.defineProperty(e.prototype,"bitmapData",{get:function(){return this._bitmapData},set:function(t){if(this._bitmapData!=t){this._bitmapData&&this._bitmapData._removeOwner(this),this._bitmapData=t,this._bitmapData&&this._bitmapData._addOwner(this);var e=this._adaptee.material;this._bitmapData?(e.ambientMethod.texture||(e.ambientMethod.texture=new ImageTexture2D),e.style.image=this._bitmapData.adaptee):(e.ambientMethod.texture&&(e.ambientMethod.texture=null),e.style.image=null,e.style.color=0),e.invalidateTextures()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelSnapping",{get:function(){return""},set:function(t){console.log("pixelSnapping not implemented yet in flash/Bitmap")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smoothing",{get:function(){return console.log("smoothing not implemented yet in flash/Bitmap"),!1},set:function(t){console.log("smoothing not implemented yet in flash/Bitmap")},enumerable:!0,configurable:!0}),e._bitmaps=new Array,e}(DisplayObject$1),ProgressEvent=function(t){function e(e,i,r,n,o){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=0),void 0===o&&(o=0);var s=t.call(this,e,i,r)||this;return s._byteLoaded=n,s._bytesTotal=o,s}return __extends(e,t),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return this._bytesTotal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return this._byteLoaded},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,null,null,this._byteLoaded,this._bytesTotal)},e.PROGRESS="progress",e.SOCKET_DATA="socketData",e.STANDARD_ERROR_DATA="standardErrorData",e.STANDARD_OUTPUT_DATA="standardOutputData",e}(Event),BitmapData=function(t){function e(e,i,r,n){void 0===r&&(r=!0),void 0===n&&(n=4294967295);var o=t.call(this)||this;return o._owners=new Array,o._adaptee=o._adaptee||new SceneImage2D(e,i,r,n,!1,StageManager.getInstance().getStageAt(0)),o._adaptee.adapter=o,o}return __extends(e,t),e.prototype.compare=function(t){return!0},Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},set:function(t){this._adaptee=t},enumerable:!0,configurable:!0}),e.loadBitmap=function(t){return console.log("loadBitmap not implemented yet in flash/BitmapData"),null},e.prototype.setPixels=function(t,e){console.log("todo: BitmapData.setPixels")},e.prototype.getPixels=function(t){return console.log("getPixels not implemented yet in flash/BitmapData"),null},e.prototype.copyPixelsToByteArray=function(t,e){console.log("copyPixelsToByteArray not implemented yet in flash/BitmapData")},e.prototype.getVector=function(t){return notImplemented("public flash.display.BitmapData::getVector"),null},e.prototype.setVector=function(t,e){notImplemented("public flash.display.BitmapData::encode")},e.prototype.histogram=function(t){notImplemented("public flash.display.BitmapData::encode")},e.prototype.encode=function(t,e,i){notImplemented("public flash.display.BitmapData::encode")},e.prototype.drawWithQuality=function(t,e,i,r,n,o,s){notImplemented("public flash.display.BitmapData::drawWithQuality")},Object.defineProperty(e.prototype,"transparent",{get:function(){return this._adaptee.transparent},set:function(t){this._adaptee.transparent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._adaptee.width},set:function(t){this._adaptee.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._adaptee.height},set:function(t){this._adaptee.height=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new this.sec.flash.display.BitmapData(this._adaptee.width,this._adaptee.height,this._adaptee.transparent,0);return t.copyPixels(this,this.rect,new this.sec.flash.geom.Point),t},Object.defineProperty(e.prototype,"rect",{get:function(){return new this.sec.flash.geom.Rectangle(this._adaptee.rect.clone())},enumerable:!0,configurable:!0}),e.prototype.getPixel=function(t,e){return this._adaptee.getPixel(t,e)},e.prototype.getPixel32=function(t,e){return this._adaptee.getPixel32(t,e)},e.prototype.setPixel=function(t,e,i){this._adaptee.setPixel(t,e,i)},e.prototype.setPixel32=function(t,e,i){this._adaptee.setPixel32(t,e,i)},e.prototype.applyFilter=function(t,e,i,r){return console.log("applyFilter not implemented yet in flash/BitmapData"),0},e.prototype.colorTransform=function(t,e){this._adaptee.colorTransform(t.adaptee,e.adaptee)},e.prototype.copyChannel=function(t,e,i,r,n){this._adaptee.copyChannel(t.adaptee,e.adaptee,i.adaptee,r,n)},e.prototype.copyPixels=function(t,e,i,r,n,o){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=!1),this._adaptee.copyPixels(t.adaptee,e.adaptee,i.adaptee,r?r.adaptee:null,n?n.adaptee:null,o)},e.prototype.dispose=function(){this._adaptee.dispose(),this._adaptee=null},e.prototype.draw=function(t,e,i,r,n,o){void 0===i&&(i=null),void 0===r&&(r=""),void 0===n&&(n=null),void 0===o&&(o=!1),this._adaptee.draw(t.adaptee,e?e.adaptee:null,i?i.adaptee:null,r,n?n.adaptee:null,o)},e.prototype.fillRect=function(t,e){var i=ColorUtils.float32ColorToARGB(e);e=ColorUtils.ARGBtoFloat32(i[0],i[3],i[2],i[1]),this._adaptee.fillRect(t.adaptee,e)},e.prototype.floodFill=function(t,e,i){console.log("floodFill not implemented yet in flash/BitmapData")},e.prototype.generateFilterRect=function(t,e){return console.log("generateFilterRect not implemented yet in flash/BitmapData"),null},e.prototype.getColorBoundsRect=function(t,e,i){return console.log("getColorBoundsRect not implemented yet in flash/BitmapData"),null},e.prototype.hitTest=function(t,e,i,r,n){return void 0===r&&(r=new this.sec.flash.geom.Point(0,0)),console.log("hitTest not implemented yet in flash/BitmapData"),!1},e.prototype.lock=function(){this._adaptee.lock()},e.prototype.merge=function(t,e,i,r,n,o,s){this._adaptee.merge(t.adaptee,t.rect.adaptee,i.adaptee,r,n,o,s)},e.prototype.noise=function(t,e,i,r,n){console.log("noise not implemented yet in flash/BitmapData")},e.prototype.paletteMap=function(t,e,i,r,n,o,s){console.log("paletteMap not implemented yet in flash/BitmapData")},e.prototype.perlinNoise=function(t,e,i,r,n,o,s,a,l){console.log("perlinNoise not implemented yet in flash/BitmapData")},e.prototype.pixelDissolve=function(t,e,i,r,n,o){return console.log("pixelDissolve not implemented yet in flash/BitmapData"),0},e.prototype.scroll=function(t,e){console.log("scroll not implemented yet in flash/BitmapData")},e.prototype.threshold=function(t,e,i,r,n,o,s,a){return 0},e.prototype.unlock=function(){this._adaptee.unlock()},e.prototype._addOwner=function(t){-1==this._owners.indexOf(t)&&this._owners.push(t)},e.prototype._removeOwner=function(t){var e=this._owners.indexOf(t);-1!=e&&this._owners.splice(e,1),this._owners.length||this._adaptee.clear()},e}(ASObject$1),MetadataInfo=function(){function t(t,e,i,r){this.abc=t,this.name=e,this.keys=i,this.values=r}return t.prototype.getName=function(){return"number"==typeof this.name&&(this.name=this.abc.getString(this.name)),this.name},t.prototype.getKeyAt=function(t){return this.abc.getString(this.keys[t])},t.prototype.getValueAt=function(t){return this.abc.getString(this.values[t])},t.prototype.getValue=function(t){for(var e=0;e<this.keys.length;e++)if(this.abc.getString(this.keys[e])===t)return this.abc.getString(this.values[e]);return null},t}(),Info=function(){},InstanceInfo=function(t){function e(e,i,r,n,o,s,a,l){var h=t.call(this)||this;return h.abc=e,h.name=i,h.superName=r,h.flags=n,h.protectedNs=o,h.interfaceNameIndices=s,h.initializer=a,h.traits=l,h.classInfo=null,h.runtimeTraits=null,h.key=null,h._interfaces=null,h}return __extends(e,t),e.prototype.getInitializer=function(){return"number"==typeof this.initializer&&(this.initializer=this.abc.getMethodInfo(this.initializer)),this.initializer},e.prototype.getName=function(){return"number"==typeof this.name&&(this.name=this.abc.getMultiname(this.name)),this.name},e.prototype.getClassName=function(){var t=this.getName();return t.namespaces[0].uri?t.namespaces[0].uri+"."+t.name:t.name},e.prototype.getSuperName=function(){return"number"==typeof this.superName&&(this.superName=this.abc.getMultiname(this.superName)),this.superName},e.prototype.getInterfaces=function(t){if(this._interfaces)return this._interfaces;var e,i=t.superClass;i&&(e=i.classInfo.instanceInfo.getInterfaces(i));for(var r=Set,n=this._interfaces=new r(e),o=0;o<this.interfaceNameIndices.length;o++){var s=this.abc.getMultiname(this.interfaceNameIndices[o]),a=this.abc.applicationDomain.getClass(s);n.add(a),a.classInfo.instanceInfo.getInterfaces(a).forEach((function(t){return n.add(t)}))}return n},e.prototype.toString=function(){return"InstanceInfo "+this.getName().name},e.prototype.toFlashlogString=function(){return this.getName().toFlashlogString()},e.prototype.trace=function(t){t.enter("InstanceInfo: "+this.getName()),this.superName&&t.writeLn("Super: "+this.getSuperName()),this.traits.trace(t),t.outdent()},e.prototype.isInterface=function(){return!!(4&this.flags)},e.prototype.isSealed=function(){return!!(1&this.flags)},e.prototype.isFinal=function(){return!!(2&this.flags)},e}(Info),ClassInfo=function(t){function e(e,i,r,n){var o=t.call(this)||this;return o.abc=e,o.instanceInfo=i,o.initializer=r,o.traits=n,o.trait=null,o.runtimeTraits=null,o}return __extends(e,t),e.prototype.getNativeMetadata=function(){if(!this.trait)return null;var t=this.trait.getMetadata();if(!t)return null;for(var e=0;e<t.length;e++)if("native"===t[e].getName())return t[e];return null},e.prototype.getInitializer=function(){return"number"==typeof this.initializer?this.initializer=this.abc.getMethodInfo(this.initializer):this.initializer},e.prototype.toString=function(){return"ClassInfo "+this.instanceInfo.getName()},e.prototype.trace=function(t){t.enter("ClassInfo"),this.traits.trace(t),t.outdent()},e}(Info),MethodInfo=function(){function t(t,e,i,r,n,o,s){this.abc=t,this._index=e,this.name=i,this.returnTypeNameIndex=r,this.parameters=n,this.optionalCount=o,this.flags=s,this.trait=null,this.compiled=null,this.error=null,this._body=null,this.minArgs=n.length-o}return t.prototype.getNativeMetadata=function(){if(!this.trait)return null;var t=this.trait.getMetadata();if(!t)return null;for(var e=0;e<t.length;e++)if("native"===t[e].getName())return t[e];return null},t.prototype.getBody=function(){return this._body||(this._body=this.abc.getMethodBodyInfo(this._index))},t.prototype.index=function(){return this._index},t.prototype.getType=function(){if(void 0!==this._returnType)return this._returnType;if(0===this.returnTypeNameIndex)this._returnType=null;else{var t=this.abc.getMultiname(this.returnTypeNameIndex);this._returnType=this.abc.applicationDomain.getClass(t)}return this._returnType},t.prototype.getName=function(){return this.name?this.abc.getString(this.name):this.trait?this.trait.getName().name:"anonymous"},t.prototype.toString=function(){var t="anonymous";return this.name&&(t=this.abc.getString(this.name)),t+=" ("+this.parameters.join(", ")+")",this.returnTypeNameIndex&&(t+=": "+this.abc.getMultiname(this.returnTypeNameIndex).name),t},t.prototype.toFlashlogString=function(){var t,e,i=this.trait,r=2===i.kind?"get ":3===i.kind?"set ":"",n=i.toFlashlogString(),o=i.holder;return o&&o instanceof InstanceInfo&&(r=(t=o.toFlashlogString())+"/"+r),o&&o instanceof ClassInfo&&o.trait&&(r=(t=o.trait.toFlashlogString())+"$/"+r),t&&(e=n.indexOf("::"))>0&&0===t.indexOf(n.substring(0,e+2))&&(n=n.substring(e+2)),"MTHD "+r+n+" ()"},t.prototype.isNative=function(){return!!(32&this.flags)},t.prototype.needsRest=function(){return!!(4&this.flags)},t.prototype.needsArguments=function(){return!!(1&this.flags)},t}();function getBytecodeName(t){return"Bytecode: "+t}var BytecodeFlags=new Uint32Array(256),BytecodeFormat=new Array(256);function define(t,e,i){void 0===i&&(i=0);e.length;BytecodeFlags[t]=i,BytecodeFormat[t]=e}function defineBytecodes(){define(1,""),define(2,""),define(3,""),define(4,"e"),define(5,"e"),define(6,"e"),define(7,""),define(8,"e"),define(9,""),define(10,""),define(11,""),define(12,"d"),define(13,"d"),define(14,"d"),define(15,"d"),define(16,"d"),define(17,"d"),define(18,"d"),define(19,"d"),define(20,"d"),define(21,"d"),define(22,"d"),define(23,"d"),define(24,"d"),define(25,"d"),define(26,"d"),define(27,""),define(28,""),define(29,""),define(30,""),define(31,""),define(32,""),define(33,""),define(35,""),define(36,"b"),define(37,"c"),define(38,""),define(39,""),define(40,""),define(41,""),define(42,""),define(43,""),define(44,"e"),define(45,"e"),define(46,"e"),define(47,"e"),define(48,""),define(49,"e"),define(50,"ee"),define(53,""),define(54,""),define(55,""),define(56,""),define(57,""),define(58,""),define(59,""),define(60,""),define(61,""),define(62,""),define(64,"e"),define(65,"e"),define(66,"e"),define(67,"ee"),define(68,"ee"),define(69,"ee"),define(70,"ee"),define(71,""),define(72,""),define(73,"e"),define(74,"ee"),define(75,""),define(76,"ee"),define(77,""),define(78,"ee"),define(79,"ee"),define(80,""),define(81,""),define(82,""),define(83,"e"),define(84,""),define(85,"e"),define(86,"e"),define(87,""),define(88,"e"),define(89,"e"),define(90,"e"),define(93,"e"),define(94,"e"),define(95,""),define(96,"e"),define(97,"e"),define(98,"e"),define(99,"e"),define(100,""),define(101,"e"),define(102,"e"),define(103,""),define(104,"e"),define(106,"e"),define(108,"e"),define(109,"e"),define(110,"e"),define(111,"e"),define(112,""),define(113,""),define(114,""),define(115,""),define(116,""),define(117,""),define(118,""),define(119,""),define(120,""),define(121,""),define(122,""),define(123,""),define(128,"e"),define(129,""),define(130,""),define(131,""),define(132,""),define(133,""),define(134,"e"),define(135,""),define(136,""),define(137,""),define(144,""),define(145,""),define(146,"e"),define(147,""),define(148,"e"),define(149,""),define(150,""),define(151,""),define(160,""),define(161,""),define(162,""),define(163,""),define(164,""),define(165,""),define(166,""),define(167,""),define(168,""),define(169,""),define(170,""),define(171,""),define(172,""),define(173,""),define(174,""),define(175,""),define(176,""),define(177,""),define(178,"e"),define(179,""),define(180,""),define(192,""),define(193,""),define(194,"e"),define(195,"e"),define(196,""),define(197,""),define(198,""),define(199,""),define(208,""),define(209,""),define(210,""),define(211,""),define(212,""),define(213,""),define(214,""),define(215,""),define(237,""),define(239,"aeae"),define(240,"e"),define(241,"e"),define(242,"e"),define(243,"")}defineBytecodes();var Bytes=function(){function t(){}return t.u8=function(t,e){return t[e]},t.s32=function(t,e){var i=t[e];return 128&i&&16384&(i=127&i|t[e+1]<<7)&&2097152&(i=16383&i|t[e+2]<<14)&&268435456&(i=2097151&i|t[e+3]<<21)&&(i=268435455&i|t[e+4]<<28,i&=4294967295),i},t.u32=function(e,i){return t.s32(e,i)>>>0},t.u30=function(e,i){return t.u32(e,i)},t.s32Length=function(t,e){var i=t[e];return 128&i?16384&(i=127&i|t[e+1]<<7)?2097152&(i=16383&i|t[e+2]<<14)?268435456&(i=2097151&i|t[e+3]<<21)?5:4:3:2:1},t}();function lengthAt(t,e){var i=1,r=t[e];if(27===r){i+=3;var n=Bytes.u30(t,e+i)+1;return i+=Bytes.s32Length(t,e+i),i+=3*n}var o=BytecodeFormat[r];if(""===o)return i;assert(o,"OP: "+getBytecodeName(r));for(var s=0;s<o.length;s++){switch(o[s].charCodeAt(0)-97){case 0:case 1:i+=1;continue;case 3:i+=3;continue;case 2:case 4:case 5:i+=Bytes.s32Length(t,e+i);continue}}return i}var BytecodeStream=function(){function t(t){this._code=t,this.setBCI(0)}return t.prototype.next=function(){this.setBCI(this._nextBCI)},t.prototype.endBCI=function(){return this._code.length},Object.defineProperty(t.prototype,"nextBCI",{get:function(){return this._nextBCI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentBCI",{get:function(){return this._currentBCI},enumerable:!0,configurable:!0}),t.prototype.currentBytecode=function(){return this._bytecode},t.prototype.nextBC=function(){return Bytes.u8(this._code,this._nextBCI)},t.prototype.setBCI=function(t){if(this._currentBCI=t,this._currentBCI<this._code.length){this._bytecode=Bytes.u8(this._code,t);var e=lengthAt(this._code,t);this._nextBCI=t+e}else this._bytecode=255,this._nextBCI=this._currentBCI},t}(),MethodBodyInfo=function(t){function e(e,i,r,n,o,s,a){var l=t.call(this)||this;return l.maxStack=e,l.localCount=i,l.initScopeDepth=r,l.maxScopeDepth=n,l.code=o,l.catchBlocks=s,l.traits=a,l.activationPrototype=null,l}return __extends(e,t),e.prototype.trace=function(t){t.writeLn("Code: "+this.code.length);for(var e=new BytecodeStream(this.code);255!==e.currentBytecode();)t.writeLn(e.currentBCI+": "+getBytecodeName(e.currentBytecode())),e.next()},e}(Info),ScriptInfo=function(t){function e(e,i,r){var n=t.call(this)||this;return n.abc=e,n.initializer=i,n.traits=r,n.global=null,n.state=0,n}return __extends(e,t),e.prototype.getInitializer=function(){return this.abc.getMethodInfo(this.initializer)},e.prototype.trace=function(t){t.enter("ScriptInfo"),this.traits.trace(t),t.outdent()},e}(Info),ParameterInfo=function(){function t(t,e,i,r,n){this.abc=t,this.type=e,this.name=i,this.optionalValueKind=r,this.optionalValueIndex=n}return t.prototype.getName=function(){return"number"==typeof this.name&&(this.name=this.abc.getString(this.name)),this.name},t.prototype.getType=function(){return"number"==typeof this.type&&(this.type=this.abc.getMultiname(this.type)),this.type},t.prototype.hasOptionalValue=function(){return this.optionalValueKind>=0},t.prototype.getOptionalValue=function(){return this.abc.getConstant(this.optionalValueKind,this.optionalValueIndex)},t.prototype.toString=function(){var t="";return this.name?t+=this.getName():t+="?",this.type&&(t+=": "+this.getType().name),this.optionalValueKind>=0&&(t+=" = "+this.abc.getConstant(this.optionalValueKind,this.optionalValueIndex)),t},t}(),RuntimeTraitInfo=function(){function t(t,e,i){this.name=t,this.kind=e,this.abc=i,this.configurable=!0,this._type=void 0,this.typeName=null}return t.prototype.getType=function(){if(void 0!==this._type)return this._type;if(null===this.typeName)return this._type=null;var t=this.abc.applicationDomain.getClass(this.typeName);return this._type=t&&t.axCoerce?t:null},t}();function createGlobalNative(t,e){return function(){switch(arguments.length){case 0:return t(e);case 1:return t(e,arguments[0]);case 2:return t(e,arguments[0],arguments[1]);case 3:return t(e,arguments[0],arguments[1],arguments[2]);default:for(var i=[e],r=0;r<arguments.length;r++)i.push(arguments[r]);return t.apply(this,i)}}}var FlashLog=function(){function t(){this.isAS3TraceOn=!0,this._startTime=Date.now()}return Object.defineProperty(t.prototype,"currentTimestamp",{get:function(){return Date.now()-this._startTime},enumerable:!0,configurable:!0}),t.prototype._writeLine=function(t){},t.prototype.writeAS3Trace=function(t){this.isAS3TraceOn&&this._writeLine(this.currentTimestamp+" AVMINF: "+t)},t}(),Scope=function(){function t(t,e,i){void 0===i&&(i=!1),this.parent=t,this.object=e,this.global=t?t.global:this,this.isWith=i,this.cache=[],this.defaultNamespace=null}return t.prototype.toString=function(){return this.parent+" => "+this.object+" "+this.isWith},t.prototype.extend=function(e){if(e===this.object)return this;var i=e.__scope__;if(i&&i.parent==this)return i;var r=new t(this,e,!1);return e.__scope__=r,r},t.prototype.findDepth=function(t){for(var e=this,i=0;e;){if(e.object===t)return i;i++,e=e.parent}return-1},t.prototype.getScopeObjects=function(){for(var t=[],e=this;e;)t.unshift(e.object),e=e.parent;return t},t.prototype.getScopeProperty=function(t,e,i){return this.findScopeProperty(t,e,i).axGetProperty(t)},t.prototype.findScopeProperty=function(t,e,i){if(t.mutable||i)return this._findScopeProperty(t,e,i);if(t.scope===this.object)return t.value;var r=this._findScopeProperty(t,e,i);return t.value=r,t.scope=this.object,r},t.prototype._findScopeProperty=function(t,e,i){if(null===t.name&&this.global.object.sec.throwError("ReferenceError",Errors$1.UndefinedVarError,"*"),!i&&!t.isRuntime()&&(r=this.cache[t.id]))return r;if(this.object&&(this.isWith?this.object.axHasPropertyInternal(t):this.object.traits.getTrait(t.namespaces,t.name)))return this.isWith||t.isRuntime()?this.object:this.cache[t.id]=this.object;if(this.parent){var r=this.parent.findScopeProperty(t,e,i);return 7===t.kind&&(this.cache[t.id]=r),r}if(i)return null;t.isAttribute()&&this.object.sec.throwError("ReferenceError",Errors$1.UndefinedVarError,t.name);var n=this.global.object;return(r=n.applicationDomain.findProperty(t,e,!0))?r:(e&&(t.getPublicMangledName()in n||this.global.object.sec.throwError("ReferenceError",Errors$1.UndefinedVarError,t.name)),n)},t}(),WriterFlags;!function(t){t[t.None=0]="None",t[t.Runtime=1]="Runtime",t[t.Execution=2]="Execution",t[t.Interpreter=4]="Interpreter"}(WriterFlags||(WriterFlags={}));var writer=new IndentingWriter(!1,(function(t){dumpLine(t)})),runtimeWriter=null,interpreterWriter=null;function sliceArguments(t,e){return Array.prototype.slice.call(t,e)}function safeGetPrototypeOf(t){var e=t.axClass;if(!e||e===e.sec.AXObject)return null;var i=e.dPrototype;return i===t&&(i=e.superClass.dPrototype),i}var HasNext2Info=function(){function t(t,e){this.object=t,this.index=e}return t.prototype.next=function(t,e){if(isNullOrUndefined$1(t))return this.index=0,void(this.object=null);this.object=t,this.index=e;var i=t.axNextNameIndex(this.index);if(i>0)this.index=i;else for(;;){if(!(t=safeGetPrototypeOf(t)))return this.index=0,void(this.object=null);if((i=t.axNextNameIndex(0))>0)return this.index=i,void(this.object=t)}},t}(),scopeStacks=[];function getCurrentScope(){return 0===scopeStacks.length?null:scopeStacks[scopeStacks.length-1].topScope()}function isXMLType(t,e){return"object"==typeof t&&t&&(t.axClass===e.AXXML||t.axClass===e.AXXMLList||t.axClass===e.AXQName||t.axClass===e.AXNamespace)}function isXMLCollection(t,e){return"object"==typeof e&&e&&(e.axClass===t.AXXML||e.axClass===t.AXXMLList)}function toString(t,e){if(!t||t.axClass!==e.AXXML)return axCoerceString$3(t);switch(t._kind){case 3:case 2:return t._value;default:if(t.hasSimpleContent()){for(var i="",r=0;r<t._children.length;r++){var n=t._children[r];4!==n._kind&&5!==n._kind&&(i+=toString(n,e))}return i}return toXMLString(e,t)}}function escapeElementValue(t,e){if(isXMLCollection(t,e))return e.toXMLString();e=axCoerceString$3(e);for(var i,r=0;r<e.length&&"&"!==(i=e[r])&&"<"!==i&&">"!==i;)r++;if(r>=e.length)return e;for(var n=e.substring(0,r);r<e.length;)switch(i=e[r++]){case"&":n+="&amp;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=i}return n}function escapeAttributeValue(t){t=String(t);for(var e,i=0;i<t.length&&"&"!==(e=t[i])&&"<"!==e&&'"'!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e;)i++;if(i>=t.length)return t;for(var r=t.substring(0,i);i<t.length;)switch(e=t[i++]){case"&":r+="&amp;";break;case"<":r+="&lt;";break;case'"':r+="&quot;";break;case"\n":r+="&#xA;";break;case"\r":r+="&#xD;";break;case"\t":r+="&#x9;";break;default:r+=e}return r}function isWhitespace(t,e){var i=t[e];return" "===i||"\n"===i||"\r"===i||"\t"===i}function isWhitespaceString(t){for(var e=0;e<t.length;e++){var i=t[e];if(" "!==i&&"\n"!==i&&"\r"!==i&&"\t"!==i)return!1}return!0}function trimWhitespaces(t){for(var e=0;e<t.length&&isWhitespace(t,e);)e++;if(e>=t.length)return"";for(var i=t.length-1;isWhitespace(t,i);)i--;return 0===e&&i===t.length-1?t:t.substring(e,i+1)}var indentStringCache=[];function getIndentString(t){if(t>0){if(void 0!==indentStringCache[t])return indentStringCache[t];for(var e="",i=0;i<t;i++)e+=" ";return indentStringCache[t]=e,e}return""}function generateUniquePrefix(t){for(var e,i=1;;){if(e="_ns"+i,!t.some((function(t){return t.prefix===e})))return e;i++}}function toXMLString(t,e){if(null==e)throw new TypeError;return escapeElementValue(t,e)}function toXML(t,e){if(null===t&&e.throwError("TypeError",Errors$1.ConvertNullToObjectError),void 0===t&&e.throwError("TypeError",Errors$1.ConvertUndefinedToObjectError),t.axClass===e.AXXML)return t;if(t.axClass===e.AXXMLList)return 1!==t._children.length&&e.throwError("TypeError",Errors$1.XMLMarkupMustBeWellFormed),t._children[0];var i=e.xmlParser.parseFromString(axCoerceString$3(t)),r=i._children.length;return 0===r?createXML(e,3):1===r?(i._children[0]._parent=null,i._children[0]):2===r?(i._children[1]._parent=null,i._children[1]):void e.throwError("TypeError",Errors$1.XMLMarkupMustBeWellFormed)}function toXMLList(t,e){if(null===t&&e.sec.throwError("TypeError",Errors$1.ConvertNullToObjectError),void 0===t&&e.sec.throwError("TypeError",Errors$1.ConvertUndefinedToObjectError),t.axClass!==e.sec.AXXML){var i=toXML('<parent xmlns="'+escapeAttributeValue(getDefaultNamespace(e.sec).uri)+'">'+t+"</parent>",e.sec)._children;if(i)for(var r=0;r<i.length;r++){var n=i[r];n._parent=null,e.append(n)}}else e.append(t)}function toXMLName(t,e){if(void 0===t)return anyMultiname;var i;if("object"==typeof t&&null!==t){if(t instanceof Multiname)return t;if(t.axClass===e.AXQName)return t.name;i=String(t)}else"number"==typeof t?i=t+"":"string"==typeof t?i="*"===t?null:t:e.throwError("TypeError",Errors$1.XMLInvalidName,t);return i&&"@"===i[0]?("*"===(i=i.substr(1))&&(i=null),new Multiname(null,0,13,[Namespace.PUBLIC],i)):new Multiname(null,0,7,[Namespace.PUBLIC],i)}function coerceE4XMultiname(t,e){var i=tmpMultiname;if(i.kind=t.kind,t.name&&t.name.axClass===e.AXQName&&(t=t.name.name),t.isQName())i.name=t.name,i.namespaces=t.namespaces;else if(t.isAnyNamespace())i.namespaces=t.namespaces;else{for(var r=getDefaultNamespace(e),n=t.namespaces,o=!1,s=0;s<n.length;s++){var a=n[s];if(a.uri===r.uri&&a.prefix===r.prefix&&a.type===r.type){o=!0;break}}i.namespaces=o?t.namespaces:t.namespaces.concat(r)}var l=t.name;return t.isAnyName()||"*"===l||null===l?i.name=null:l.length>1&&"@"===l[0]?i.isAttribute()?i.name=l:(i.name="@*"===l?null:l.substr(1),i.kind=1===i.namespaces.length?13:14):i.name=l,i}function getDefaultNamespace(t){for(var e=getCurrentScope();e;){if(e.defaultNamespace)return e.defaultNamespace;e=e.parent}return t.AXNamespace.defaultNamespace||(t.AXNamespace.defaultNamespace=new Namespace(0,"default","")),t.AXNamespace.defaultNamespace}function GetNamespace(t,e){for(var i=t.uri,r=0;e&&r<e.length;r++)if(i===e[r].uri)return e[r];return t.namespaces[0]}function isXMLName(t,e){try{e.AXQName.Create(t)}catch(t){return!1}return!0}var tmpMultiname=new Multiname(null,0,7,[],null,null,!0),anyMultiname=new Multiname(null,0,7,[],null,null,!0),XMLParserBase=function(){function t(){}return t.prototype.resolveEntities=function(t){return t.replace(/&([^;]+);/g,(function(t,e){if("#x"===e.substring(0,2))return String.fromCharCode(parseInt(e.substring(2),16));if("#"===e.substring(0,1))return String.fromCharCode(parseInt(e.substring(1),10));switch(e){case"lt":return"<";case"gt":return">";case"amp":return"&";case"quot":return'"'}return t}))},t.prototype.parseContent=function(t,e){var i,r=e,n=[];function o(){for(;r<t.length&&isWhitespace(t,r);)++r}for(;r<t.length&&!isWhitespace(t,r)&&">"!==t[r]&&"/"!==t[r];)++r;for(i=t.substring(e,r),o();r<t.length&&">"!==t[r]&&"/"!==t[r]&&"?"!==t[r];){o();for(var s,a="";r<t.length&&!isWhitespace(t,r)&&"="!==t[r];)a+=t[r],++r;if(o(),"="!==t[r])return null;++r,o();var l=t[r];if('"'!==l&&"'"!==l)return null;var h=t.indexOf(l,++r);if(h<0)return null;s=t.substring(r,h),n.push({name:a,value:this.resolveEntities(s)}),r=h+1,o()}return{name:i,attributes:n,parsed:r-e}},t.prototype.parseProcessingInstruction=function(t,e){var i,r=e;for(;r<t.length&&!isWhitespace(t,r)&&">"!==t[r]&&"/"!==t[r];)++r;i=t.substring(e,r),function(){for(;r<t.length&&isWhitespace(t,r);)++r}();for(var n=r;r<t.length&&("?"!==t[r]||">"!=t[r+1]);)++r;return{name:i,value:t.substring(n,r),parsed:r-e}},t.prototype.parseXml=function(t){for(var e=0;e<t.length;){var i=e;if("<"===t[e]){var r;switch(t[++i]){case"/":if(++i,(r=t.indexOf(">",i))<0)return void this.onError(-9);this.onEndElement(t.substring(i,r)),i=r+1;break;case"?":++i;var n=this.parseProcessingInstruction(t,i);if("?>"!=t.substring(i+n.parsed,i+n.parsed+2))return void this.onError(-3);this.onPi(n.name,n.value),i+=n.parsed+2;break;case"!":if("--"===t.substring(i+1,i+3)){if((r=t.indexOf("--\x3e",i+3))<0)return void this.onError(-5);this.onComment(t.substring(i+3,r)),i=r+3}else if("[CDATA["===t.substring(i+1,i+8)){if((r=t.indexOf("]]>",i+8))<0)return void this.onError(-2);this.onCdata(t.substring(i+8,r)),i=r+3}else{if("DOCTYPE"!==t.substring(i+1,i+8))return void this.onError(-6);var o=t.indexOf("[",i+8),s=!1;if((r=t.indexOf(">",i+8))<0)return void this.onError(-4);if(o>0&&r>o){if((r=t.indexOf("]>",i+8))<0)return void this.onError(-4);s=!0}var a=t.substring(i+8,r+(s?1:0));this.onDoctype(a),i=r+(s?2:1)}break;default:var l=this.parseContent(t,i);if(null===l)return void this.onError(-6);var h=!1;if("/>"===t.substring(i+l.parsed,i+l.parsed+2))h=!0;else if(">"!==t.substring(i+l.parsed,i+l.parsed+1))return void this.onError(-9);this.onBeginElement(l.name,l.attributes,h),i+=l.parsed+(h?2:1)}}else{do{}while(i++<t.length&&"<"!==t[i]);var c=t.substring(e,i);this.onText(this.resolveEntities(c))}e=i}},t.prototype.onPi=function(t,e){},t.prototype.onComment=function(t){},t.prototype.onCdata=function(t){},t.prototype.onDoctype=function(t){},t.prototype.onText=function(t){},t.prototype.onBeginElement=function(t,e,i){},t.prototype.onEndElement=function(t){},t.prototype.onError=function(t){},t}(),XMLParser=function(t){function e(e){var i=t.call(this)||this;return i.sec=e,i.scopes=[],i}return __extends(e,t),e.prototype.isWhitespacePreserved=function(){for(var t=this.scopes,e=t.length-1;e>=0;--e)if("preserve"===t[e].space)return!0;return!1},e.prototype.lookupDefaultNs=function(){for(var t=this.scopes,e=t.length-1;e>=0;--e)if("xmlns"in t[e])return t[e].xmlns;return""},e.prototype.lookupNs=function(t){for(var e=this.scopes,i=e.length-1;i>=0;--i)if(t in e[i].lookup)return e[i].lookup[t]},e.prototype.getName=function(t,e){var i=t.indexOf(":");if(i>=0){var r=t.substring(0,i),n=t.substring(i+1),o=this.lookupNs(r);return void 0===o&&this.sec.throwError("TypeError",Errors$1.XMLPrefixNotBound,r,n),{name:o+"::"+n,localName:n,prefix:r,namespace:o}}return e?{name:t,localName:t,prefix:"",namespace:this.lookupDefaultNs()}:{name:t,localName:t,prefix:"",namespace:""}},e.prototype.onError=function(t){switch(t){case-6:return void this.sec.throwError("TypeError",Errors$1.XMLMalformedElement);case-9:return void this.sec.throwError("TypeError",Errors$1.XMLUnterminatedElement);case-4:return void this.sec.throwError("TypeError",Errors$1.XMLUnterminatedDocTypeDecl);case-2:return void this.sec.throwError("TypeError",Errors$1.XMLUnterminatedCData);case-5:return void this.sec.throwError("TypeError",Errors$1.XMLUnterminatedComment);case-3:return void this.sec.throwError("TypeError",Errors$1.XMLUnterminatedXMLDecl)}},e.prototype.onPi=function(t,e){this.pi(t,e)},e.prototype.onComment=function(t){this.comment(t)},e.prototype.onCdata=function(t){this.cdata(t)},e.prototype.onDoctype=function(t){this.doctype(t)},e.prototype.onText=function(t){this.text(t,this.isWhitespacePreserved())},e.prototype.onBeginElement=function(t,e,i){for(var r=this.scopes,n={namespaces:[],lookup:Object.create(null),inScopes:null},o=0;o<e.length;++o){var s=e[o],a=s.name;if("xmlns:"===a.substring(0,6)){var l=a.substring(6),h=s.value;if(this.lookupNs(l)!==h){n.lookup[l]=trimWhitespaces(h);var c=internPrefixedNamespace(0,h,l);n.namespaces.push(c)}e[o]=null}else if("xmlns"===a){h=s.value;if(this.lookupDefaultNs()!==h){n.xmlns=trimWhitespaces(h);c=internNamespace(0,h);n.namespaces.push(c)}e[o]=null}else if("xml:"===a.substring(0,4)){var u=a.substring(4);n[u]=trimWhitespaces(s.value)}}var p=[];n.namespaces.forEach((function(t){t.prefix&&n.lookup[t.prefix]!==t.uri||p.push(t)})),r[r.length-1].inScopes.forEach((function(t){(!t.prefix||t.prefix in n.lookup)&&(t.prefix||"xmlns"in n)||p.push(t)})),n.inScopes=p,r.push(n);var d=[];for(o=0;o<e.length;++o)(s=e[o])&&d.push({name:this.getName(s.name,!1),value:s.value});this.beginElement(this.getName(t,!0),d,p,i),i&&r.pop()},e.prototype.onEndElement=function(t){this.endElement(this.getName(t,!0)),this.scopes.pop()},e.prototype.beginElement=function(t,e,i,r){var n=this.currentElement;this.elementsStack.push(n),this.currentElement=createXML(this.sec,1,t.namespace,t.localName,t.prefix);for(var o=0;o<e.length;++o){var s=e[o],a=createXML(this.sec,2,s.name.namespace,s.name.localName,s.name.prefix);a._value=s.value,a._parent=this.currentElement,this.currentElement._attributes.push(a)}for(o=0;o<i.length;++o)this.currentElement._inScopeNamespaces.push(i[o]);n.insert(n._children.length,this.currentElement),r&&(this.currentElement=this.elementsStack.pop())},e.prototype.endElement=function(t){this.currentElement=this.elementsStack.pop()},e.prototype.text=function(t,e){if(this.sec.AXXML.ignoreWhitespace&&(t=trimWhitespaces(t)),!(0===t.length||e&&this.sec.AXXML.ignoreWhitespace)){var i=createXML(this.sec);i._value=t,this.currentElement.insert(this.currentElement._children.length,i)}},e.prototype.cdata=function(t){var e=createXML(this.sec);e._value=t,this.currentElement.insert(this.currentElement._children.length,e)},e.prototype.comment=function(t){if(!this.sec.AXXML.ignoreComments){var e=createXML(this.sec,4,"","");e._value=t,this.currentElement.insert(this.currentElement._children.length,e)}},e.prototype.pi=function(t,e){if(!this.sec.AXXML.ignoreProcessingInstructions){var i=createXML(this.sec,5,"",t);i._value=e,this.currentElement.insert(this.currentElement._children.length,i)}},e.prototype.doctype=function(t){},e.prototype.parseFromString=function(t,e){var i=this.currentElement=createXML(this.sec,1,"","","");this.elementsStack=[];var r=getDefaultNamespace(this.sec),n=[{namespaces:[],lookup:{xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace"},inScopes:[r],space:"default",xmlns:r.uri}];if(this.scopes=n,this.parseXml(t),this.currentElement=null,this.elementsStack.length>0){var o=this.elementsStack.pop()._name.name;this.sec.throwError("TypeError",Errors$1.XMLUnterminatedElementTag,o,o)}return this.elementsStack=null,i},e}(XMLParserBase),ASNamespace=function(t){function e(e,i){var r=t.call(this)||this,n="",o="";if(0===arguments.length);else if(1===arguments.length){if((a=e)instanceof Namespace)return r._ns=a,r;if(a&&"object"==typeof a)if(a.axClass===r.sec.AXNamespace){var s=a;o=s.prefix,n=s.uri}else a.axClass===r.sec.AXQName&&null!==a.uri&&(n=a.uri);else o=""===(n=toString(a,r.sec))?"":void 0}else{var a,l=e;""===(n=isObject(a=i)&&a.axClass===r.sec.AXQName&&null!==a.uri?a.uri:toString(a,r.sec))?void 0===l||""===toString(l,r.sec)?o="":r.sec.throwError("TypeError",Errors$1.XMLNamespaceWithPrefixAndNoURI,l):o=void 0===l?void 0:!1===isXMLName(l,r.sec)?void 0:toString(l,r.sec)}return r._ns=internPrefixedNamespace(0,n,o),r}return __extends(e,t),e.classInitializer=function(){defineNonEnumerableProperty(this,"$Bglength",2),defineNonEnumerableProperty(this.dPrototype,"$BgtoString",e.prototype.toString)},e.axApply=function(t,e){var i=e[0],r=e[1];if(1===e.length&&isObject(i)&&i.axClass===this.sec.AXNamespace)return i;switch(e.length){case 0:return this.sec.AXNamespace.Create();case 1:return this.sec.AXNamespace.Create(i);default:return this.sec.AXNamespace.Create(i,r)}},e.Create=function(t,e){var i=Object.create(this.sec.AXNamespace.tPrototype);return i.axInitializer.apply(i,arguments),i},e.FromNamespace=function(t){var e=Object.create(this.sec.AXNamespace.tPrototype);return e._ns=t,e},e.prototype.equals=function(t){return t&&t.axClass===this.axClass&&t._ns.uri===this._ns.uri||"string"==typeof t&&this._ns.uri===t},Object.defineProperty(e.prototype,"prefix",{get:function(){return this._ns.prefix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uri",{get:function(){return this._ns.uri},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this===this.axClass.dPrototype?"":this._ns.uri},e.prototype.valueOf=function(){return this===this.axClass.dPrototype?"":this._ns.uri},e.instanceConstructor=e,e.defaultNamespace=Namespace.PUBLIC,e}(ASObject$1),ASQName=function(t){function e(e,i){var r,n,o=t.call(this)||this;if(0===arguments.length?r="":1===arguments.length?r=e:(n=e,r=i),r&&r.axClass===o.sec.AXQName){if(arguments.length<2)return o.name=r.name,o;r=r.localName}r=void 0===r?"":toString(r,o.sec),void 0===n&&(n="*"===r?null:getDefaultNamespace(o.sec));var s=r,a=null;return null!==n&&(n.axClass!==o.sec.AXNamespace&&(n=o.sec.AXNamespace.Create(n)),a=n._ns),o.name=new Multiname(null,0,7,[a],s),o}return __extends(e,t),e.classInitializer=function(){defineNonEnumerableProperty(this,"$Bglength",2),defineNonEnumerableProperty(this.dPrototype,"$BgtoString",e.prototype.ecmaToString)},e.Create=function(t,e,i){var r=Object.create(this.sec.AXQName.tPrototype);return r.axInitializer.apply(r,arguments),r},e.FromMultiname=function(t){var e=Object.create(this.sec.AXQName.tPrototype);return e.name=t,e},e.axApply=function(t,e){var i=e[0],r=e[1];if(1===e.length&&i&&i.axClass===this.sec.AXQName)return i;switch(e.length){case 0:return this.sec.AXQName.Create();case 1:return this.sec.AXQName.Create(i);default:return this.sec.AXQName.Create(i,r)}},e.prototype.equals=function(t){return t&&t.axClass===this.sec.AXQName&&t.uri===this.uri&&t.name.name===this.name.name||"string"==typeof t&&this.toString()===t},Object.defineProperty(e.prototype,"localName",{get:function(){return this.name.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uri",{get:function(){var t=this.name.namespaces;return t.length>1?"":t[0]?t[0].uri:null},enumerable:!0,configurable:!0}),e.prototype.ecmaToString=function(){return this&&this===this.sec.AXQName.dPrototype?"":(this&&this.axClass===this.sec.AXQName||this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"QName.prototype.toString"),this.toString())},e.prototype.toString=function(){var t=this.uri;if(""===t)return this.name.name;if(null===t)return"*::"+this.name.name;var e=(t+="").charCodeAt(t.length-1),i=t;return e>=57344&&e<=63743&&(i=t.substr(0,t.length-1)),""===i?this.name.name:i+"::"+this.name.name},e.prototype.valueOf=function(){return this},Object.defineProperty(e.prototype,"prefix",{get:function(){return this.name.namespaces[0]?this.name.namespaces[0].prefix:null},enumerable:!0,configurable:!0}),e}(ASObject$1),ASXML_FLAGS;!function(t){t[t.FLAG_IGNORE_COMMENTS=1]="FLAG_IGNORE_COMMENTS",t[t.FLAG_IGNORE_PROCESSING_INSTRUCTIONS=2]="FLAG_IGNORE_PROCESSING_INSTRUCTIONS",t[t.FLAG_IGNORE_WHITESPACE=4]="FLAG_IGNORE_WHITESPACE",t[t.FLAG_PRETTY_PRINTING=8]="FLAG_PRETTY_PRINTING",t[t.ALL=15]="ALL"}(ASXML_FLAGS||(ASXML_FLAGS={}));var ASXMLKindNames=[null,"element","attribute","text","comment","processing-instruction"],ASXML=function(t){function e(e){var i=t.call(this)||this;if(i._parent=null,isNullOrUndefined$1(e)&&(e=""),"string"==typeof e&&0===e.length)return i._kind=3,i._value="",i;var r=toXML(e,i.sec);isXMLType(e,i.sec)&&(r=r._deepCopy()),i._kind=r._kind,i._name=r._name,i._value=r._value,i._attributes=r._attributes,i._inScopeNamespaces=r._inScopeNamespaces;var n=r._children;if(i._children=n,n)for(var o=0;o<n.length;o++){n[o]._parent=i}return i}return __extends(e,t),e.classInitializer=function(){defineNonEnumerableProperty(this,"$Bglength",1);var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgvalueOf",i.valueOf),defineNonEnumerableProperty(t,"$BghasOwnProperty",i.native_hasOwnProperty),defineNonEnumerableProperty(t,"$BgpropertyIsEnumerable",i.native_propertyIsEnumerable),addPrototypeFunctionAlias(this,"$Bgsettings",e.native_settings),addPrototypeFunctionAlias(this,"$BgsetSettings",e.native_setSettings),addPrototypeFunctionAlias(this,"$BgdefaultSettings",e.native_defaultSettings),addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgaddNamespace",i.addNamespace),addPrototypeFunctionAlias(t,"$BgappendChild",i.appendChild),addPrototypeFunctionAlias(t,"$Bgattribute",i.attribute),addPrototypeFunctionAlias(t,"$Bgattributes",i.attributes),addPrototypeFunctionAlias(t,"$Bgchild",i.child),addPrototypeFunctionAlias(t,"$BgchildIndex",i.childIndex),addPrototypeFunctionAlias(t,"$Bgchildren",i.children),addPrototypeFunctionAlias(t,"$Bgcomments",i.comments),addPrototypeFunctionAlias(t,"$Bgcontains",i.contains),addPrototypeFunctionAlias(t,"$Bgcopy",i.copy),addPrototypeFunctionAlias(t,"$Bgdescendants",i.descendants),addPrototypeFunctionAlias(t,"$Bgelements",i.elements),addPrototypeFunctionAlias(t,"$BghasComplexContent",i.hasComplexContent),addPrototypeFunctionAlias(t,"$BghasSimpleContent",i.hasSimpleContent),addPrototypeFunctionAlias(t,"$BginScopeNamespaces",i.inScopeNamespaces),addPrototypeFunctionAlias(t,"$BginsertChildAfter",i.insertChildAfter),addPrototypeFunctionAlias(t,"$BginsertChildBefore",i.insertChildBefore),addPrototypeFunctionAlias(t,"$Bglength",i.length),addPrototypeFunctionAlias(t,"$BglocalName",i.localName),addPrototypeFunctionAlias(t,"$Bgname",i.name),addPrototypeFunctionAlias(t,"$Bgnamespace",i.namespace),addPrototypeFunctionAlias(t,"$BgnamespaceDeclarations",i.namespaceDeclarations),addPrototypeFunctionAlias(t,"$BgnodeKind",i.nodeKind),addPrototypeFunctionAlias(t,"$Bgnormalize",i.normalize),addPrototypeFunctionAlias(t,"$Bgparent",i.parent),addPrototypeFunctionAlias(t,"$BgprocessingInstructions",i.processingInstructions),addPrototypeFunctionAlias(t,"$BgprependChild",i.prependChild),addPrototypeFunctionAlias(t,"$BgremoveNamespace",i.removeNamespace),addPrototypeFunctionAlias(t,"$Bgreplace",i.replace),addPrototypeFunctionAlias(t,"$BgsetChildren",i.setChildren),addPrototypeFunctionAlias(t,"$BgsetLocalName",i.setLocalName),addPrototypeFunctionAlias(t,"$BgsetName",i.setName),addPrototypeFunctionAlias(t,"$BgsetNamespace",i.setNamespace),addPrototypeFunctionAlias(t,"$Bgtext",i.text),addPrototypeFunctionAlias(t,"$BgtoXMLString",i.toXMLString),addPrototypeFunctionAlias(t,"$BgtoJSON",i.toJSON)},e.Create=function(t){var e=Object.create(this.sec.AXXML.tPrototype);return e.axInitializer(t),e},e.resetSettings=function(){this._flags=ASXML_FLAGS.ALL},e.native_settings=function(){var t=Object.create(this.sec.AXObject.tPrototype);return t.$BgignoreComments=this.ignoreComments,t.$BgignoreProcessingInstructions=this.ignoreProcessingInstructions,t.$BgignoreWhitespace=this.ignoreWhitespace,t.$BgprettyPrinting=this.prettyPrinting,t.$BgprettyIndent=this.prettyIndent,t},e.native_setSettings=function(t){if(isNullOrUndefined$1(t))return this.ignoreComments=!0,this.ignoreProcessingInstructions=!0,this.ignoreWhitespace=!0,this.prettyPrinting=!0,void(this.prettyIndent=2);"boolean"==typeof t.$BgignoreComments&&(this.ignoreComments=t.$BgignoreComments),"boolean"==typeof t.$BgignoreProcessingInstructions&&(this.ignoreProcessingInstructions=t.$BgignoreProcessingInstructions),"boolean"==typeof t.$BgignoreWhitespace&&(this.ignoreWhitespace=t.$BgignoreWhitespace),"boolean"===t.$BgprettyPrinting&&(this.prettyPrinting=t.$BgprettyPrinting),"number"===t.$BgprettyIndent&&(this.prettyIndent=t.$BgprettyIndent)},e.native_defaultSettings=function(){return{__proto__:this.sec.AXObject.tPrototype,$BgignoreComments:!0,$BgignoreProcessingInstructions:!0,$BgignoreWhitespace:!0,$BgprettyPrinting:!0,$BgprettyIndent:2}},e.axApply=function(t,e){var i=e[0];return isNullOrUndefined$1(i)&&(i=""),toXML(i,this.sec)},e.prototype.valueOf=function(){return this},e.prototype.equals=function(t){if(t&&t.axClass===this.sec.AXXMLList)return t.equals(this);if(t&&t.axClass===this.sec.AXXML){var e=t;return(3===this._kind||2===this._kind)&&e.hasSimpleContent()||(3===e._kind||2===e._kind)&&this.hasSimpleContent()?this.toString()===t.toString():this._deepEquals(t)}return this.hasSimpleContent()&&this.toString()===axCoerceString$3(t)},e.prototype.init=function(t,e){switch(this._name=e,this._kind=t,this._parent=null,t){case 1:this._inScopeNamespaces=[],this._attributes=[],this._children=[];break;case 4:case 5:case 2:case 3:this._value=""}return this},e.prototype._deepEquals=function(t){if(!t||t.axClass!==this.sec.AXXML)return!1;var e=t;if(this._kind!==e._kind)return!1;if(!!this._name!=!!e._name||this._name&&!this._name.equalsQName(e._name))return!1;if(1!==this._kind)return this._value===e._value;var i=this._attributes,r=e._attributes;if(i.length!==r.length)return!1;var n=this._children,o=e._children;if(n.length!==o.length)return!1;t:for(var s=0;s<i.length;s++){for(var a=i[s],l=0;l<r.length;l++){var h=r[l];if(h._name.equalsQName(a._name)&&h._value===a._value)continue t}return!1}for(s=0;s<n.length;s++)if(!n[s].equals(o[s]))return!1;return!0},e.prototype._deepCopy=function(){var t=this._kind,e=this.sec.AXXML.Create();switch(e._kind=t,e._name=this._name,t){case 1:e._inScopeNamespaces=this._inScopeNamespaces.slice(),e._attributes=this._attributes.map((function(t){return(t=t._deepCopy())._parent=e,t})),e._children=this._children.map((function(t){return(t=t._deepCopy())._parent=e,t}));break;case 4:case 5:case 2:case 3:e._value=this._value}return e},e.prototype.resolveValue=function(){return this},e.prototype._addInScopeNamespace=function(t){this._inScopeNamespaces.some((function(e){return e.uri===t.uri&&e.prefix===t.prefix}))||this._inScopeNamespaces.push(t)},Object.defineProperty(e,"ignoreComments",{get:function(){return!!(this._flags&ASXML_FLAGS.FLAG_IGNORE_COMMENTS)},set:function(t){(t=!!t)?this._flags|=ASXML_FLAGS.FLAG_IGNORE_COMMENTS:this._flags&=~ASXML_FLAGS.FLAG_IGNORE_COMMENTS},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ignoreProcessingInstructions",{get:function(){return!!(this._flags&ASXML_FLAGS.FLAG_IGNORE_PROCESSING_INSTRUCTIONS)},set:function(t){(t=!!t)?this._flags|=ASXML_FLAGS.FLAG_IGNORE_PROCESSING_INSTRUCTIONS:this._flags&=~ASXML_FLAGS.FLAG_IGNORE_PROCESSING_INSTRUCTIONS},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ignoreWhitespace",{get:function(){return!!(this._flags&ASXML_FLAGS.FLAG_IGNORE_WHITESPACE)},set:function(t){(t=!!t)?this._flags|=ASXML_FLAGS.FLAG_IGNORE_WHITESPACE:this._flags&=~ASXML_FLAGS.FLAG_IGNORE_WHITESPACE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"prettyPrinting",{get:function(){return!!(this._flags&ASXML_FLAGS.FLAG_PRETTY_PRINTING)},set:function(t){(t=!!t)?this._flags|=ASXML_FLAGS.FLAG_PRETTY_PRINTING:this._flags&=~ASXML_FLAGS.FLAG_PRETTY_PRINTING},enumerable:!0,configurable:!0}),Object.defineProperty(e,"prettyIndent",{get:function(){return this._prettyIndent},set:function(t){t|=0,this._prettyIndent=t},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this===this.axClass.dPrototype?"":this.hasComplexContent()?this.toXMLString():toString(this,this.sec)},e.prototype.native_hasOwnProperty=function(t){if(this===this.axClass.dPrototype)return ASObject$1.prototype.native_hasOwnProperty.call(this,t);var e=toXMLName(t,this.sec);return!!this.hasProperty(e)||this.axHasOwnProperty(e)},e.prototype.native_propertyIsEnumerable=function(t){return void 0===t&&(t=void 0),"0"===String(t)},e.prototype.addNamespace=function(t){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this._addInScopeNamespace(t),this},e.prototype.appendChild=function(t){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this.insert(this._children.length,t),this},e.prototype.attribute=function(t){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),isNullOrUndefined$1(t)&&arguments.length>0&&this.sec.throwError("TypeError",Errors$1.ConvertUndefinedToObjectError),t&&t.axClass===this.sec.AXQName?this.getProperty(t.name):("*"!==(t=axCoerceString$3(t))&&0!==arguments.length||(t=null),tmpMultiname.name=t,tmpMultiname.namespaces=[Namespace.PUBLIC],tmpMultiname.kind=13,this.getProperty(tmpMultiname))},e.prototype.attributes=function(){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML");var t=this.sec.AXXMLList.CreateList(this,this._name);return Array.prototype.push.apply(t._children,this._attributes),t},e.prototype.child=function(t){if(this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),isIndex(t)){var e=this.sec.AXXMLList.CreateList(null,null);return this._children&&t<this._children.length&&e.append(this._children[0|t]),e}var i;return t&&t.axClass===this.sec.AXQName?i=t.name:((i=tmpMultiname).kind=7,i.name=toString(t,this.sec)),this.getProperty(i)},e.prototype.childIndex=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this._parent&&2!==this._kind?this._parent._children.indexOf(this):-1},e.prototype.children=function(){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML");var t=this.sec.AXXMLList.CreateList(this,this._name);return t._children=this._children.concat(),t},e.prototype.comments=function(){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML");var t=this.sec.AXXMLList.CreateList(this,this._name);return this._children&&this._children.forEach((function(e,i){4===e._kind&&t.append(e)})),t},e.prototype.contains=function(t){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this===t},e.prototype.copy=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this._deepCopy()},e.prototype.descendants=function(t){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML");var e=this.sec.AXXMLList.CreateList(this,this._name);return this.descendantsInto(toXMLName(t,this.sec),e)},e.prototype.elements=function(t){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this.getProperty(toXMLName(t,this.sec))},e.prototype.hasComplexContent=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),2!==this._kind&&4!==this._kind&&5!==this._kind&&3!==this._kind&&this._children.some((function(t){return 1===t._kind}))},e.prototype.hasSimpleContent=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),4!==this._kind&&5!==this._kind&&(1!==this._kind||(!this._children&&0===this._children.length||this._children.every((function(t){return 1!==t._kind}))))},e.prototype.inScopeNamespaces=function(){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML");for(var t=this._inScopeNamespacesImpl(),e=[],i=0;i<t.length;i++){var r=this.sec.AXNamespace;e[i]=r.FromNamespace(t[i])}return this.sec.AXArray.axBox(e)},e.prototype._inScopeNamespacesImpl=function(){for(var t=this,e=[],i=e;null!==t;){for(var r=t._inScopeNamespaces,n=0;r&&n<r.length;n++){var o=r[n];i[o.prefix]||(i[o.prefix]=o,e.push(o))}t=t._parent}return e},e.prototype.insertChildAfter=function(t,e){if(this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),!(this._kind>1)){if(null==t)return this.insert(0,e),this;if(t.axClass===this.sec.AXXMLList&&1===t._children.length&&(t=t._children[0]),t.axClass===this.sec.AXXML)for(var i=0;i<this._children.length;i++){if(this._children[i]===t)return this.insert(i+1,e),this}}},e.prototype.insertChildBefore=function(t,e){if(this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),!(this._kind>1)){if(null==t)return this.insert(this._children.length,e),this;if(t.axClass===this.sec.AXXMLList&&1===t._children.length&&(t=t._children[0]),t.axClass===this.sec.AXXML)for(var i=0;i<this._children.length;i++){if(this._children[i]===t)return this.insert(i,e),this}}},e.prototype.length=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this._children?this._children.length:0},e.prototype.localName=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this._name.name},e.prototype.name=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),this.sec.AXQName.FromMultiname(this._name)},e.prototype.namespace=function(t){if(this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),0===arguments.length&&this._kind>=3)return null;var e=this._inScopeNamespacesImpl();if(0===arguments.length)return this.sec.AXNamespace.FromNamespace(GetNamespace(this._name,e));t=axCoerceString$3(t);for(var i=0;i<e.length;i++){var r=e[i];if(r.prefix===t)return this.sec.AXNamespace.FromNamespace(r)}},e.prototype.namespaceDeclarations=function(){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML")},e.prototype.nodeKind=function(){return this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML"),ASXMLKindNames[this._kind]},e.prototype.normalize=function(){this&&this.axClass===this.sec.AXXML||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,this,"XML");for(var t=0;t<this._children.length;){var e=this._children[t];if(1===e._kind)e.normalize(),t++;else if(3===e._kind){for(;t+1<this._children.length;){var i=this._children[t+1];if(3!==i._kind)break;e._value+=i._value,this.removeByIndex(t+1)}0===e._value.length||isWhitespaceString(e._value)?this.removeByIndex(t):t++}else t++}return this},e.prototype.removeByIndex=function(t){this._children[t]._parent=null,this._children.splice(t,1)},e.prototype.parent=function(){return this._parent||void 0},e.prototype.processingInstructions=function(t){var e=this.sec.AXXMLList.CreateList(this,this._name);return e._targetObject=this,e._targetProperty=null,this.processingInstructionsInto(toXMLName(t,this.sec),e)},e.prototype.processingInstructionsInto=function(t,e){var i=t||"*",r=this._children;if(!r)return e;for(var n=0;n<r.length;n++){var o=r[n];5!==o._kind||"*"!==i&&o._name.name!==i||e._children.push(o)}return e},e.prototype.prependChild=function(t){return this.insert(0,t),this},e.prototype.removeNamespace=function(t){},e.prototype.replace=function(t,e){if(1===this._kind){var i;i=!e||e.axClass!==this.axClass&&e.axClass!==this.sec.AXXMLList?axCoerceString$3(e):e._deepCopy();var r=toXMLName(t,this.sec);if(isIndex(r.name))return this._replaceByIndex(0|r.name,i),this;for(var n=r.isAnyName(),o=-1,s=this._children,a=s.length;a--;){var l=s[a];(n||1===l._kind&&l._name.matches(r))&&(-1!==o&&this.deleteByIndex(o),o=a)}return-1===o?this:(this._replaceByIndex(o,i),this)}},e.prototype._replaceByIndex=function(t,e){if(this._kind>1)return this;var i=this._children;if(t>i.length&&(t=i.length),e&&e.axClass===this.axClass&&2!==e._kind){if(1===e._kind)for(var r=this;r;)r===e&&this.sec.throwError("Error",Errors$1.XMLIllegalCyclicalLoop),r=r._parent;e._parent=this,i[t]&&(i[t]._parent=null),i[t]=e}else if(e&&e.axClass===this.sec.AXXMLList)if(0===e._children.length)this.deleteByIndex(t);else{var n=e._children.length;if(t<i.length){i[t]._parent=null;for(var o=i.length-1;o>t;o--)i[o+n]=i[o]}for(o=0;o<n;o++){var s=e._children[o];s._parent=this,i[o+t]=s}}else{var a=axCoerceString$3(e),l=this.axClass.Create();l._kind=3,l._value=a,l._parent=this,i[t]&&(i[t]._parent=null),i[t]=l}},e.prototype.setChildren=function(t){return this.setProperty(anyMultiname,t),this},e.prototype.setLocalName=function(t){var e;3!==this._kind&&4!==this._kind&&(e=t&&t.axClass===this.sec.AXQName?t.localName:axCoerceString$3(t),this._name.name=e)},e.prototype.setName=function(t){if(3!==this._kind&&4!==this._kind){t&&t.axClass===this.sec.AXQName&&null===t.uri&&(t=t.localName);var e=this.sec.AXQName.Create(t).name;5===this._kind&&(e.namespaces[0]=Namespace.PUBLIC),this._name=e;var i=this;if(2===this._kind){if(null===this._parent)return;i=this._parent}i.addInScopeNamespace(e.namespaces[0])}},e.prototype.setNamespace=function(t){if(3!==this._kind&&4!==this._kind&&5!==this._kind){var e=this.sec.AXNamespace.Create(t)._ns;this._name.namespaces=[e],2===this._kind?this._parent&&this._parent.addInScopeNamespace(e):1===this._kind&&this.addInScopeNamespace(e)}},e.prototype.text=function(){var t=this.sec.AXXMLList.CreateList(this,this._name);return this._children&&this._children.forEach((function(e,i){3===e._kind&&t.append(e)})),t},e.prototype.toXMLString=function(){return this.toXMLStringImpl()},e.prototype.toXMLStringImpl=function(t,e){var i=this.sec,r=i.AXXML.prettyPrinting;e|=0;var n=r?getIndentString(e):"";switch(this._kind){case 3:return r?n+escapeElementValue(i,trimWhitespaces(this._value)):escapeElementValue(i,this._value);case 2:return n+escapeAttributeValue(this._value);case 4:return n+"\x3c!--"+this._value+"--\x3e";case 5:return n+"<?"+this._name.name+" "+this._value+"?>"}t=t||[];for(var o=[],s=0;this._inScopeNamespaces&&s<this._inScopeNamespaces.length;s++){var a=this._inScopeNamespaces[s];t.every((function(t){return t.uri!==a.uri||t.prefix!==a.prefix}))&&o.push(a)}var l=t.concat(o);if(void 0===(p=GetNamespace(this._name,l)).prefix){var h=generateUniquePrefix(l),c=internPrefixedNamespace(0,p.uri,h);o.push(c),l.push(c)}var u=(p.prefix?p.prefix+":":"")+this._name.name;n+="<"+u,this._attributes&&this._attributes.forEach((function(t){var e=GetNamespace(t._name,l);if(void 0===e.prefix){var i=generateUniquePrefix(l),r=internPrefixedNamespace(0,e.uri,i);o.push(r),l.push(r)}}));for(s=0;s<o.length;s++){var p;if(""!==(p=o[s]).uri){var d=p.prefix?"xmlns:"+p.prefix:"xmlns";n+=" "+d+'="'+escapeAttributeValue(p.uri)+'"'}}if(this._attributes&&this._attributes.forEach((function(e){var i=e._name,r=GetNamespace(i,t),o=r.prefix?r.prefix+":"+i.name:i.name;n+=" "+o+'="'+escapeAttributeValue(e._value)+'"'})),0===this._children.length)return n+="/>";n+=">";var f=this._children.length>1||1===this._children.length&&3!==this._children[0]._kind,_=r&&f?e+i.AXXML._prettyIndent:0;return this._children.forEach((function(t,e){r&&f&&(n+="\n"),n+=t.toXMLStringImpl(l,_)})),r&&f&&(n+="\n"+getIndentString(e)),n+="</"+u+">"},e.prototype.toJSON=function(t){return"XML"},e.prototype.axGetEnumerableKeys=function(){if(this===this.axClass.dPrototype)return t.prototype.axGetEnumerableKeys.call(this);for(var e=[],i=0;i<this._children.length;i++)e.push(this._children[i]._name.name);return e},e.prototype.setProperty=function(t,e){var i,r=this.sec;if(t.isAnyName()||t.isAttribute()||t.name!==t.name>>>0||r.throwError("TypeError",Errors$1.XMLAssignmentToIndexedXMLNotAllowed),3!==this._kind&&4!==this._kind&&5!==this._kind&&2!==this._kind)if(i=isXMLType(e,r)&&3!==e._kind&&2!==e._kind?e._deepCopy():toString(e,r),t.isAttribute()){if(i&&i.axClass===r.AXXMLList)if(0===i._children.length)i="";else{for(var n=toString(i._children[0],r),o=1;o<i._children.length;o++)n+=" "+toString(i._children[o],r);i=n}else i=axCoerceString$3(i);var s=null,a=this._attributes,l=this._attributes=[];for(o=0;a&&o<a.length;o++){var h=a[o];if(h._name.matches(t)){if(s){h._parent=null;continue}s=h}l.push(h)}if(!s){if(t.isAnyName())return;var c="";1===t.namespaces.length&&(c=t.namespaces[0].uri),(s=createXML(r,2,c,t.name))._parent=this,l.push(s)}s._value=i}else{for(var u,p=t.isAnyName(),d=!isXMLType(i,r)&&!p&&"*"!==t.name,f=t.isAnyNamespace(),_=this._children.length-1;_>=0;_--)(p||1===this._children[_]._kind&&this._children[_]._name.name===t.name)&&(f||1===this._children[_]._kind&&this._children[_]._name.matches(t))&&(void 0!==u&&this.deleteByIndex(u),u=_);if(void 0===u&&(u=this._children.length,d)){var g;c=null;if(null!==(v=t.namespaces[0]).uri&&(c=v.uri,g=v.prefix),null===c){var m=getDefaultNamespace(r);c=m.uri,g=m.prefix}var y=createXML(r,1,c,t.name,g);y._parent=this,this._replaceByIndex(u,y);var v=y._name.namespace;y.addInScopeNamespace(v)}if(d){var b=this._children[u]._children;for(o=b.length;o--;)b[o]._parent=null;b.length=0,""!==(n=toString(i,r))&&this._children[u]._replaceByIndex(0,n)}else this._replaceByIndex(u,i)}},e.prototype.axSetProperty=function(t,e,i){this!==this.axClass.dPrototype?this.setProperty(coerceE4XMultiname(t,this.sec),e):this[this.axResolveMultiname(t)]=e},e.prototype.getProperty=function(t){var e=t.name;if(isIndex(e))return 0==(0|e)?this:null;var i=this.sec.AXXMLList.CreateList(this,t),r=0,n=t.isAnyName(),o=t.isAnyNamespace();if(t.isAttribute()){for(var s=0;this._attributes&&s<this._attributes.length;s++){var a=this._attributes[s];!n&&a._name.name!==e||!o&&!a._name.matches(t)||(i._children[r++]=a,assert(i._children[0]))}return i}for(s=0;this._children&&s<this._children.length;s++){a=this._children[s];(n||1===a._kind&&a._name.name===e)&&(o||a._name.matches(t))&&(i._children[r++]=a,assert(i._children[0]))}return i},e.prototype.axGetProperty=function(t){return this===this.axClass.dPrototype?this[this.axResolveMultiname(t)]:this.getProperty(coerceE4XMultiname(t,this.sec))},e.prototype.hasProperty=function(t){if(isIndex(t.name))return 0==(0|t.name);var e=toXMLName(t,this.sec),i=e.isAnyName(),r=e.isAnyNamespace();if(t.isAttribute()){for(var n=0;this._attributes&&n<this._attributes.length;n++){var o=this._attributes[n];if(i||o._name.matches(e))return!0}return!1}for(n=0;n<this._children.length;n++){o=this._children[n];if((i||1===o._kind&&o._name.name===e.name)&&(r||1===o._kind&&o._name.matches(e)))return!0}},e.prototype.deleteProperty=function(t){if(isIndex(t.name))return!0;var e=toXMLName(t,this.sec),i=e.name,r=t.isAnyName(),n=t.isAnyNamespace();if(t.isAttribute()){var o=this._attributes;if(o)for(var s=this._attributes=[],a=0;a<o.length;a++){var l=o[a],h=l._name;!r&&h.name!==i||!n&&!h.matches(e)?s.push(l):l._parent=null}}else if(this._children.some((function(t,i){return(r||1===t._kind&&t._name.name===e.name)&&(n||1===t._kind&&t._name.matches(e))})))return!0},e.prototype.axHasProperty=function(e){return this===this.axClass.dPrototype?t.prototype.axHasPropertyInternal.call(this,e):this.axHasPropertyInternal(e)},e.prototype.axHasPropertyInternal=function(t){return!!this.hasProperty(t)||!!this[this.axResolveMultiname(t)]},e.prototype.axDeleteProperty=function(t){return!!this.deleteProperty(t)||delete this[this.axResolveMultiname(t)]},e.prototype.axCallProperty=function(t,e){var i=this[this.axResolveMultiname(t)];return i||(i=this["$Bg"+t.name]),i?(validateCall(this.sec,i,e.length),i.axApply(this,e)):this.hasSimpleContent()?this.sec.box(toString(this,this.sec)).axCallProperty(t,e):void this.sec.throwError("TypeError",Errors$1.CallOfNonFunctionError,"value")},e.prototype._delete=function(t,e){},e.prototype.deleteByIndex=function(t){if(String(t>>>0)!==String(t))throw"TypeError in XML.prototype.deleteByIndex(): invalid index "+t;var e=this._children;t<e.length&&e[t]&&(e[t]._parent=null,e.splice(t,1))},e.prototype.insert=function(t,e){if(!(this._kind>1)){var i=t;if(e&&e.axClass===this.axClass)for(var r=this;r;)r===e&&this.sec.throwError("TypeError",Errors$1.XMLIllegalCyclicalLoop),r=r._parent;var n=1;if(!e||e.axClass!==this.sec.AXXMLList||0!==(n=e._children.length)){for(var o=this._children,s=o.length-1;s>=i;s--)o[s+n]=o[s],assert(o[0]);if(e&&e.axClass===this.sec.AXXMLList){n=e._children.length;for(s=0;s<n;s++)e._children[s]._parent=this,o[i+s]=e._children[s]}else e&&e.axClass===this.axClass||(e=this.sec.AXXML.Create(e)),e._parent=this,o||(this._children=o=[]),o[i]=e,assert(o[0])}}},e.prototype.addInScopeNamespace=function(t){if(3!==this._kind&&4!==this._kind&&5!==this._kind&&2!==this._kind){var e=t.prefix;if(void 0!==e){if(""===e&&""===this._name.uri)return;var i=null;this._inScopeNamespaces.forEach((function(t,r){t.prefix===e&&(i=t)})),null!==i&&i.uri!==t.uri&&this._inScopeNamespaces.forEach((function(e,r){e.prefix===i.prefix&&(this._inScopeNamespaces[r]=t)})),this._name.prefix===e&&(this._name.prefix=void 0),this._attributes.forEach((function(t,i){t._name.prefix===e&&(t._name.prefix=void 0)}))}}},e.prototype.descendantsInto=function(t,e){if(1!==this._kind)return e;var i=e._children.length,r=t.isAnyName();return t.isAttribute()?this._attributes.forEach((function(n,o){(r||n._name.matches(t))&&(e._children[i++]=n,assert(e._children[0]))})):this._children.forEach((function(n,o){(r||n._name.matches(t))&&(e._children[i++]=n,assert(e._children[0]))})),this._children.forEach((function(i,r){i.descendantsInto(t,e)})),e},e.instanceConstructor=e,e._flags=ASXML_FLAGS.ALL,e._prettyIndent=2,e}(ASObject$1);function createXML(t,e,i,r,n){void 0===e&&(e=3),void 0===i&&(i=""),void 0===r&&(r="");var o=t.AXXML.Create(),s=internPrefixedNamespace(0,i,n||""),a=new Multiname(null,0,2===e?13:7,[s],r,null);return o.init(e,a),o}var ASXMLList=function(t){function e(e){var i=t.call(this)||this;if(i._children=[],isNullOrUndefined$1(e)&&(e=""),!e)return i;if(e&&e.axClass===i.sec.AXXMLList)for(var r=e._children,n=0;n<r.length;n++){var o=r[n];i._children[n]=o,assert(i._children[0])}else toXMLList(e,i);return i}return __extends(e,t),e.classInitializer=function(){defineNonEnumerableProperty(this,"$Bglength",1);var t=this.dPrototype,i=e.prototype;defineNonEnumerableProperty(t,"$BgvalueOf",Object.prototype.$BgvalueOf),defineNonEnumerableProperty(t,"$BghasOwnProperty",i.native_hasOwnProperty),defineNonEnumerableProperty(t,"$BgpropertyIsEnumerable",i.native_propertyIsEnumerable),addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgaddNamespace",i.addNamespace),addPrototypeFunctionAlias(t,"$BgappendChild",i.appendChild),addPrototypeFunctionAlias(t,"$Bgattribute",i.attribute),addPrototypeFunctionAlias(t,"$Bgattributes",i.attributes),addPrototypeFunctionAlias(t,"$Bgchild",i.child),addPrototypeFunctionAlias(t,"$BgchildIndex",i.childIndex),addPrototypeFunctionAlias(t,"$Bgchildren",i.children),addPrototypeFunctionAlias(t,"$Bgcomments",i.comments),addPrototypeFunctionAlias(t,"$Bgcontains",i.contains),addPrototypeFunctionAlias(t,"$Bgcopy",i.copy),addPrototypeFunctionAlias(t,"$Bgdescendants",i.descendants),addPrototypeFunctionAlias(t,"$Bgelements",i.elements),addPrototypeFunctionAlias(t,"$BghasComplexContent",i.hasComplexContent),addPrototypeFunctionAlias(t,"$BghasSimpleContent",i.hasSimpleContent),addPrototypeFunctionAlias(t,"$BginScopeNamespaces",i.inScopeNamespaces),addPrototypeFunctionAlias(t,"$BginsertChildAfter",i.insertChildAfter),addPrototypeFunctionAlias(t,"$BginsertChildBefore",i.insertChildBefore),addPrototypeFunctionAlias(t,"$Bglength",i.length),addPrototypeFunctionAlias(t,"$BglocalName",i.localName),addPrototypeFunctionAlias(t,"$Bgname",i.name),addPrototypeFunctionAlias(t,"$Bgnamespace",i.namespace),addPrototypeFunctionAlias(t,"$BgnamespaceDeclarations",i.namespaceDeclarations),addPrototypeFunctionAlias(t,"$BgnodeKind",i.nodeKind),addPrototypeFunctionAlias(t,"$Bgnormalize",i.normalize),addPrototypeFunctionAlias(t,"$Bgparent",i.parent),addPrototypeFunctionAlias(t,"$BgprocessingInstructions",i.processingInstructions),addPrototypeFunctionAlias(t,"$BgprependChild",i.prependChild),addPrototypeFunctionAlias(t,"$BgremoveNamespace",i.removeNamespace),addPrototypeFunctionAlias(t,"$Bgreplace",i.replace),addPrototypeFunctionAlias(t,"$BgsetChildren",i.setChildren),addPrototypeFunctionAlias(t,"$BgsetLocalName",i.setLocalName),addPrototypeFunctionAlias(t,"$BgsetName",i.setName),addPrototypeFunctionAlias(t,"$BgsetNamespace",i.setNamespace),addPrototypeFunctionAlias(t,"$Bgtext",i.text),addPrototypeFunctionAlias(t,"$BgtoXMLString",i.toXMLString),addPrototypeFunctionAlias(t,"$BgtoJSON",i.toJSON)},e.axApply=function(t,e){var i=e[0];if(isNullOrUndefined$1(i)&&(i=""),i&&i.axClass===this.sec.AXXMLList)return i;var r=this.sec.AXXMLList.Create();return toXMLList(i,r),r},e.addXML=function(t,e){var i;return t.axClass===t.sec.AXXML?(i=t.sec.AXXMLList.Create()).append(t):i=t,i.append(e),i},e.Create=function(t){var e=Object.create(this.sec.AXXMLList.tPrototype);return e.axInitializer(t),e},e.CreateList=function(t,e){var i=this.Create();return i._targetObject=t,i._targetProperty=e,i},e.prototype.valueOf=function(){return this},e.prototype.equals=function(t){var e=this._children;if(void 0===t&&0===e.length)return!0;if(t&&t.axClass===this.sec.AXXMLList){var i=t._children;if(i.length!==e.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].equals(i[r]))return!1;return!0}return 1===e.length&&e[0].equals(t)},e.prototype.toString=function(){if(this.hasComplexContent())return this.toXMLString();for(var t="",e=0;e<this._children.length;e++)t+=toString(this._children[e],this.sec);return t},e.prototype._deepCopy=function(){for(var t=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty),e=this._children.length,i=0;i<e;i++)t._children[i]=this._children[i]._deepCopy(),assert(t._children[0]);return t},e.prototype._shallowCopy=function(){for(var t=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty),e=this._children.length,i=0;i<e;i++)t._children[i]=this._children[i],assert(t._children[0]);return t},e.prototype.native_hasOwnProperty=function(t){if(t=axCoerceString$3(t),this===this.sec.AXXMLList.dPrototype)return ASObject$1.prototype.native_hasOwnProperty.call(this,t);if(isIndex(t))return(0|t)<this._children.length;for(var e=toXMLName(t,this.sec),i=this._children,r=0;r<i.length;r++){var n=i[r];if(1===n._kind&&n.hasProperty(e))return!0}return!1},e.prototype.native_propertyIsEnumerable=function(t){return isIndex(t)&&(0|t)<this._children.length},e.prototype.attribute=function(t){return isNullOrUndefined$1(t)&&arguments.length>0&&this.sec.throwError("TypeError",Errors$1.ConvertUndefinedToObjectError),t&&t.axClass===this.sec.AXQName?this.getProperty(t.name):("*"!==(t=axCoerceString$3(t))&&0!==arguments.length||(t=null),tmpMultiname.name=t,tmpMultiname.namespaces=[Namespace.PUBLIC],tmpMultiname.kind=13,this.getProperty(tmpMultiname))},e.prototype.attributes=function(){return tmpMultiname.name=null,tmpMultiname.namespaces=[],tmpMultiname.kind=13,this.getProperty(tmpMultiname)},e.prototype.child=function(t){if(isIndex(t)){var e=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty);return(0|t)<this._children.length&&(e._children[0]=this._children[0|t]._deepCopy(),assert(e._children[0])),e}return this.getProperty(toXMLName(t,this.sec))},e.prototype.children=function(){return this.getProperty(anyMultiname)},e.prototype.descendants=function(t){for(var e=toXMLName(t,this.sec),i=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty),r=0;r<this._children.length;r++){var n=this._children[r];1===n._kind&&n.descendantsInto(e,i)}return i},e.prototype.comments=function(){var t=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty);return this._children.forEach((function(e){if(1===e._kind){var i=e.comments();Array.prototype.push.apply(t._children,i._children)}})),t},e.prototype.contains=function(t){for(var e=this._children,i=0;i<e.length;i++){if(e[i].equals(t))return!0}return!1},e.prototype.copy=function(){return this._deepCopy()},e.prototype.elements=function(t){var e=toXMLName(t,this.sec),i=this.sec.AXXMLList.CreateList(this._targetObject,e);return this._children.forEach((function(t){if(1===t._kind){var r=t.elements(e);Array.prototype.push.apply(i._children,r._children)}})),i},e.prototype.hasComplexContent=function(){switch(this._children.length){case 0:return!1;case 1:return this._children[0].hasComplexContent();default:return this._children.some((function(t){return 1===t._kind}))}},e.prototype.hasSimpleContent=function(){switch(this._children.length){case 0:return!0;case 1:return this._children[0].hasSimpleContent();default:return this._children.every((function(t){return 1!==t._kind}))}},e.prototype.length=function(){return this._children.length},e.prototype.name=function(){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"name"),this._children[0].name()},e.prototype.normalize=function(){for(var t=0;t<this._children.length;){var e=this._children[t];if(1===e._kind)e.normalize(),t++;else if(3===e._kind){for(t++;t<this._children.length;){var i=this._children[t];if(3!==i._kind)break;e._value+=i._value,this.removeByIndex(t)}0===e._value.length?this.removeByIndex(t):t++}else t++}return this},e.prototype.parent=function(){var t=this._children;if(0!==t.length){for(var e=t[0]._parent,i=1;i<t.length;i++)if(t[i]._parent!==e)return;return e}},e.prototype.processingInstructions=function(t){var e=toXMLName(t,this.sec),i=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty);i._targetObject=this,i._targetProperty=null;for(var r=this._children,n=0;n<r.length;n++)r[n].processingInstructionsInto(e,i);return i},e.prototype.text=function(){var t=this.sec.AXXMLList.CreateList(this._targetObject,this._targetProperty);return this._children.forEach((function(e,i){if(1===e._kind){var r=e.text();r._children.length>0&&t._children.push(r)}})),t},e.prototype.toXMLString=function(){var t=this.sec;return this._children.map((function(e){return toXMLString(t,e)})).join(t.AXXML.prettyPrinting?"\n":"")},e.prototype.toJSON=function(t){return"XMLList"},e.prototype.addNamespace=function(t){1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"addNamespace");var e=this._children[0];return e.addNamespace(t),e},e.prototype.appendChild=function(t){1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"appendChild");var e=this._children[0];return e.appendChild(t),e},e.prototype.append=function(t){var e=this._children,i=e.length;if(t&&t.axClass===this.sec.AXXMLList){this._targetObject=t._targetObject,this._targetProperty=t._targetProperty;var r=t._children;if(0===r.length)return;for(var n=0;n<r.length;n++)e[i+n]=r[n]}else e[i]=t},e.prototype.childIndex=function(){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"childIndex"),this._children[0].childIndex()},e.prototype.inScopeNamespaces=function(){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"inScopeNamespaces"),this._children[0].inScopeNamespaces()},e.prototype.insertChildAfter=function(t,e){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"insertChildAfter"),this._children[0].insertChildAfter(t,e)},e.prototype.insertChildBefore=function(t,e){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"insertChildBefore"),this._children[0].insertChildBefore(t,e)},e.prototype.nodeKind=function(){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"nodeKind"),this._children[0].nodeKind()},e.prototype.namespace=function(t){1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"namespace");var e=this._children[0];return arguments.length?e.namespace(t):e.namespace()},e.prototype.localName=function(){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"localName"),this._children[0].localName()},e.prototype.namespaceDeclarations=function(){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"namespaceDeclarations"),this._children[0].namespaceDeclarations()},e.prototype.prependChild=function(t){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"prependChild"),this._children[0].prependChild(t)},e.prototype.removeNamespace=function(t){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"removeNamespace"),this._children[0].removeNamespace(t)},e.prototype.replace=function(t,e){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"replace"),this._children[0].replace(t,e)},e.prototype.setChildren=function(t){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"setChildren"),this._children[0].setChildren(t)},e.prototype.setLocalName=function(t){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"setLocalName"),this._children[0].setLocalName(t)},e.prototype.setName=function(t){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"setName"),this._children[0].setName(t)},e.prototype.setNamespace=function(t){return 1!==this._children.length&&this.sec.throwError("TypeError",Errors$1.XMLOnlyWorksWithOneItemLists,"setNamespace"),this._children[0].setNamespace(t)},e.prototype.axGetEnumerableKeys=function(){return this===this.axClass.dPrototype?t.prototype.axGetEnumerableKeys.call(this):Object.keys(this._children)},e.prototype.getProperty=function(t){var e=t.name;if(isIndex(e))return this._children[0|e];for(var i=null===e||"*"===e,r=t.isAnyNamespace(),n=t.isAttribute(),o=this.sec.AXXMLList.CreateList(this._targetObject,t),s=this._children,a=0;a<s.length;a++){if(1===(c=s[a])._kind)if(n)for(var l=c._attributes,h=0;l&&h<l.length;h++){var c=l[h];!i&&c._name.name!==e||!r&&!c._name.matches(t)||o._children.push(c)}else{var u=c._children;for(h=0;u&&h<u.length;h++){c=u[h];(i||1===c._kind&&c._name.name===e)&&(r||c._name.matches(t))&&o._children.push(c)}}}return o},e.prototype.axGetProperty=function(t){return this===this.axClass.dPrototype?this[this.axResolveMultiname(t)]:this.getProperty(coerceE4XMultiname(t,this.sec))},e.prototype.axGetPublicProperty=function(t){return this===this.axClass.dPrototype?this[Multiname.getPublicMangledName(t)]:isIndex(t)?this._children[0|t]:(tmpMultiname.name=t,tmpMultiname.namespaces=[Namespace.PUBLIC],tmpMultiname.kind=7,this.getProperty(tmpMultiname))},e.prototype.hasProperty=function(t){return!isIndex(t.name)||Number(t.name)<this._children.length},e.prototype.axHasProperty=function(t){return this.hasProperty(t)},e.prototype.axHasPropertyInternal=function(t){return this.hasProperty(t)},e.prototype.resolveValue=function(){return this},e.prototype.setProperty=function(t,e){if(isIndex(t.name)){var i=0|t.name,r=null;if(this._targetObject&&null===(r=this._targetObject.resolveValue()))return;var n=this._children.length;if(i>=n){if(r&&r.axClass===this.sec.AXXMLList){if(1!==r._children.length)return;r=r._children[0]}if(r&&1!==r._kind)return;var o=this.sec.AXXML.Create();o._parent=r;var s=this._targetProperty,a=3;if(this._targetProperty&&this._targetProperty.isAttribute()){if(r.hasProperty(this._targetProperty))return;a=2}else this._targetProperty&&null!==this._targetProperty.name?a=1:(s=null,a=3);if(o.init(a,s),i=n,2!==o._kind){if(null!==r){if(i>0){var l=this._children[i-1],h=r._children.length-1;for(m=0;m<h&&r._children[m]!==l;m++);}else m=r._children.length-1;r._children[m+1]=o,assert(r._children[0]),o._parent=r}e&&e.axClass===this.sec.AXXML?o._name=e._name:e&&e.axClass===this.sec.AXXMLList&&(o._name=e._targetProperty),this.append(o)}}isXMLType(e,this.sec)&&3!==e._kind&&2!==e._kind||(e+="");var c=this._children[i],u=c._kind,p=c._parent;if(2===u){var d=p._children.indexOf(c);return p.setProperty(c._name,!1),this._children[i]=p._children[d],void assert(this._children[0])}if(e&&e.axClass===this.sec.AXXMLList){var f=e._shallowCopy(),_=f._children.length;if(null!==p){var g=p._children.indexOf(c);p._replaceByIndex(g,f);for(var m=0;m<_;m++)f._children[m]=p._children[g+m]}if(0===_){for(m=i+1;m<n;m++)this._children[m-1]=this._children[m],assert(this._children[0]);this._children.length--}else for(m=n-1;m>i;m--)this._children[m+_-1]=this._children[m],assert(this._children[0]);for(m=0;m<_;m++)this._children[i+m]=f._children[m],assert(this._children[0]);return}if(u>=3||e&&e.axClass===this.sec.AXXML){if(null!==p){g=p._children.indexOf(c);p._replaceByIndex(g,e),e=p._children[g]}if("string"==typeof e){var y=this.sec.AXXML.Create(e);this._children[i]=y,assert(this._children[0])}else this._children[i]=e,assert(this._children[0]);return}c.setProperty(anyMultiname,e)}else{if(0===this._children.length){if(null===(r=this.resolveValue())||1!==r._children.length)return;this.append(r._children[0])}1!==this._children.length?this.sec.throwError("TypeError",Errors$1.XMLAssigmentOneItemLists):this._children[0].setProperty(t,e)}},e.prototype.axSetProperty=function(t,e,i){this!==this.axClass.dPrototype?this.setProperty(coerceE4XMultiname(t,this.sec),e):this[this.axResolveMultiname(t)]=e},e.prototype.axDeleteProperty=function(t){var e=t.name;if(isIndex(e))return(i=0|e)>=this._children.length||(this.removeByIndex(i),!0);for(var i=0;i<this._children.length;i++){var r=this._children[i];1===r._kind&&r.deleteProperty(t)}return!0},e.prototype.removeByIndex=function(t){var e=this._children[t],i=e._parent;i&&(e._parent=null,i._children.splice(i._children.indexOf(e),1)),this._children.splice(t,1)},e.prototype.axCallProperty=function(t,e){var i=this[this.axResolveMultiname(t)];return i?(validateCall(this.sec,i,e.length),i.axApply(this,e)):1===this._children.length?this._children[0].axCallProperty(t,e):void this.sec.throwError("TypeError",Errors$1.CallOfNonFunctionError,"value")},e.instanceConstructor=e,e}(ASObject$1),Bytecode;function axEquals(t,e,i){return isXMLType(t,i)?t.equals(e):isXMLType(e,i)?e.equals(t):t==e}function axIsXMLCollection(t,e){return e.AXXML.dPrototype.isPrototypeOf(t)||e.AXXMLList.dPrototype.isPrototypeOf(t)}function axGetDescendants(t,e,i){return axIsXMLCollection(t,i)||i.throwError("TypeError",Errors$1.DescendentsError,t),t.descendants(e)}function axCheckFilter(t,e){if(!e||!isXMLCollection(t,e)){var i=e&&e.axClass?e.axClass.name.toFQNString(!1):"[unknown]";t.throwError("TypeError",Errors$1.FilterError,i)}return e}function axConvertString(t){return"string"==typeof t?t:t+""}function axAdd(t,e,i){return"string"==typeof t||"string"==typeof e?String(t)+String(e):isXMLCollection(i,t)&&isXMLCollection(i,e)?ASXMLList.addXML(t,e):t+e}function axTypeOf(t,e){if(t){if(t.value)return typeof t.value;if(axIsXMLCollection(t,e))return"xml"}return typeof t}function popManyInto(t,e,i){for(var r=e-1;r>=0;r--)i[r]=t.pop();i.length=e}function pushMany(t,e){for(var i=0;i<e.length;i++)t.push(e[i])}!function(t){t[t.BKPT=1]="BKPT",t[t.NOP=2]="NOP",t[t.THROW=3]="THROW",t[t.GETSUPER=4]="GETSUPER",t[t.GETSUPER_DYN=260]="GETSUPER_DYN",t[t.SETSUPER=5]="SETSUPER",t[t.SETSUPER_DYN=261]="SETSUPER_DYN",t[t.DXNS=6]="DXNS",t[t.DXNSLATE=7]="DXNSLATE",t[t.KILL=8]="KILL",t[t.LABEL=9]="LABEL",t[t.LF32X4=10]="LF32X4",t[t.SF32X4=11]="SF32X4",t[t.IFNLT=12]="IFNLT",t[t.IFNLE=13]="IFNLE",t[t.IFNGT=14]="IFNGT",t[t.IFNGE=15]="IFNGE",t[t.JUMP=16]="JUMP",t[t.IFTRUE=17]="IFTRUE",t[t.IFFALSE=18]="IFFALSE",t[t.IFEQ=19]="IFEQ",t[t.IFNE=20]="IFNE",t[t.IFLT=21]="IFLT",t[t.IFLE=22]="IFLE",t[t.IFGT=23]="IFGT",t[t.IFGE=24]="IFGE",t[t.IFSTRICTEQ=25]="IFSTRICTEQ",t[t.IFSTRICTNE=26]="IFSTRICTNE",t[t.LOOKUPSWITCH=27]="LOOKUPSWITCH",t[t.PUSHWITH=28]="PUSHWITH",t[t.POPSCOPE=29]="POPSCOPE",t[t.NEXTNAME=30]="NEXTNAME",t[t.HASNEXT=31]="HASNEXT",t[t.PUSHNULL=32]="PUSHNULL",t[t.PUSHUNDEFINED=33]="PUSHUNDEFINED",t[t.PUSHFLOAT=34]="PUSHFLOAT",t[t.NEXTVALUE=35]="NEXTVALUE",t[t.PUSHBYTE=36]="PUSHBYTE",t[t.PUSHSHORT=37]="PUSHSHORT",t[t.PUSHTRUE=38]="PUSHTRUE",t[t.PUSHFALSE=39]="PUSHFALSE",t[t.PUSHNAN=40]="PUSHNAN",t[t.POP=41]="POP",t[t.DUP=42]="DUP",t[t.SWAP=43]="SWAP",t[t.PUSHSTRING=44]="PUSHSTRING",t[t.PUSHINT=45]="PUSHINT",t[t.PUSHUINT=46]="PUSHUINT",t[t.PUSHDOUBLE=47]="PUSHDOUBLE",t[t.PUSHSCOPE=48]="PUSHSCOPE",t[t.PUSHNAMESPACE=49]="PUSHNAMESPACE",t[t.HASNEXT2=50]="HASNEXT2",t[t.LI8=53]="LI8",t[t.LI16=54]="LI16",t[t.LI32=55]="LI32",t[t.LF32=56]="LF32",t[t.LF64=57]="LF64",t[t.SI8=58]="SI8",t[t.SI16=59]="SI16",t[t.SI32=60]="SI32",t[t.SF32=61]="SF32",t[t.SF64=62]="SF64",t[t.NEWFUNCTION=64]="NEWFUNCTION",t[t.CALL=65]="CALL",t[t.CONSTRUCT=66]="CONSTRUCT",t[t.CALLMETHOD=67]="CALLMETHOD",t[t.CALLSTATIC=68]="CALLSTATIC",t[t.CALLSUPER=69]="CALLSUPER",t[t.CALLSUPER_DYN=69]="CALLSUPER_DYN",t[t.CALLPROPERTY=70]="CALLPROPERTY",t[t.CALLPROPERTY_DYN=326]="CALLPROPERTY_DYN",t[t.RETURNVOID=71]="RETURNVOID",t[t.RETURNVALUE=72]="RETURNVALUE",t[t.CONSTRUCTSUPER=73]="CONSTRUCTSUPER",t[t.CONSTRUCTSUPER_DYN=329]="CONSTRUCTSUPER_DYN",t[t.CONSTRUCTPROP=74]="CONSTRUCTPROP",t[t.CONSTRUCTPROP_DYN=330]="CONSTRUCTPROP_DYN",t[t.CALLSUPERID=75]="CALLSUPERID",t[t.CALLPROPLEX=76]="CALLPROPLEX",t[t.CALLPROPLEX_DYN=332]="CALLPROPLEX_DYN",t[t.CALLINTERFACE=77]="CALLINTERFACE",t[t.CALLSUPERVOID=78]="CALLSUPERVOID",t[t.CALLSUPERVOID_DYN=334]="CALLSUPERVOID_DYN",t[t.CALLPROPVOID=79]="CALLPROPVOID",t[t.SXI1=80]="SXI1",t[t.SXI8=81]="SXI8",t[t.SXI16=82]="SXI16",t[t.APPLYTYPE=83]="APPLYTYPE",t[t.PUSHFLOAT4=84]="PUSHFLOAT4",t[t.NEWOBJECT=85]="NEWOBJECT",t[t.NEWARRAY=86]="NEWARRAY",t[t.NEWACTIVATION=87]="NEWACTIVATION",t[t.NEWCLASS=88]="NEWCLASS",t[t.GETDESCENDANTS=89]="GETDESCENDANTS",t[t.NEWCATCH=90]="NEWCATCH",t[t.FINDPROPSTRICT=93]="FINDPROPSTRICT",t[t.FINDPROPSTRICT_DYN=349]="FINDPROPSTRICT_DYN",t[t.FINDPROPERTY=94]="FINDPROPERTY",t[t.FINDPROPERTY_DYN=350]="FINDPROPERTY_DYN",t[t.FINDDEF=95]="FINDDEF",t[t.GETLEX=96]="GETLEX",t[t.GETLEX_DYN=352]="GETLEX_DYN",t[t.SETPROPERTY=97]="SETPROPERTY",t[t.SETPROPERTY_DYN=353]="SETPROPERTY_DYN",t[t.GETLOCAL=98]="GETLOCAL",t[t.SETLOCAL=99]="SETLOCAL",t[t.GETGLOBALSCOPE=100]="GETGLOBALSCOPE",t[t.GETSCOPEOBJECT=101]="GETSCOPEOBJECT",t[t.GETPROPERTY=102]="GETPROPERTY",t[t.GETPROPERTY_DYN=358]="GETPROPERTY_DYN",t[t.GETOUTERSCOPE=103]="GETOUTERSCOPE",t[t.INITPROPERTY=104]="INITPROPERTY",t[t.UNUSED_69=105]="UNUSED_69",t[t.DELETEPROPERTY=106]="DELETEPROPERTY",t[t.DELETEPROPERTY_DYN=362]="DELETEPROPERTY_DYN",t[t.UNUSED_6B=107]="UNUSED_6B",t[t.GETSLOT=108]="GETSLOT",t[t.SETSLOT=109]="SETSLOT",t[t.GETGLOBALSLOT=110]="GETGLOBALSLOT",t[t.SETGLOBALSLOT=111]="SETGLOBALSLOT",t[t.CONVERT_S=112]="CONVERT_S",t[t.ESC_XELEM=113]="ESC_XELEM",t[t.ESC_XATTR=114]="ESC_XATTR",t[t.CONVERT_I=115]="CONVERT_I",t[t.CONVERT_U=116]="CONVERT_U",t[t.CONVERT_D=117]="CONVERT_D",t[t.CONVERT_B=118]="CONVERT_B",t[t.CONVERT_O=119]="CONVERT_O",t[t.CHECKFILTER=120]="CHECKFILTER",t[t.CONVERT_F=121]="CONVERT_F",t[t.UNPLUS=122]="UNPLUS",t[t.CONVERT_F4=123]="CONVERT_F4",t[t.BC_7C=124]="BC_7C",t[t.BC_7D=125]="BC_7D",t[t.BC_7E=126]="BC_7E",t[t.BC_7F=127]="BC_7F",t[t.COERCE=128]="COERCE",t[t.COERCE_DYN=384]="COERCE_DYN",t[t.COERCE_B=129]="COERCE_B",t[t.COERCE_A=130]="COERCE_A",t[t.COERCE_I=131]="COERCE_I",t[t.COERCE_D=132]="COERCE_D",t[t.COERCE_S=133]="COERCE_S",t[t.ASTYPE=134]="ASTYPE",t[t.ASTYPELATE=135]="ASTYPELATE",t[t.COERCE_U=136]="COERCE_U",t[t.COERCE_O=137]="COERCE_O",t[t.NEGATE=144]="NEGATE",t[t.INCREMENT=145]="INCREMENT",t[t.INCLOCAL=146]="INCLOCAL",t[t.DECREMENT=147]="DECREMENT",t[t.DECLOCAL=148]="DECLOCAL",t[t.TYPEOF=149]="TYPEOF",t[t.NOT=150]="NOT",t[t.BITNOT=151]="BITNOT",t[t.UNUSED_98=152]="UNUSED_98",t[t.UNUSED_99=153]="UNUSED_99",t[t.UNUSED_9A=154]="UNUSED_9A",t[t.UNUSED_9B=155]="UNUSED_9B",t[t.UNUSED_9C=156]="UNUSED_9C",t[t.UNUSED_9D=157]="UNUSED_9D",t[t.UNUSED_9E=158]="UNUSED_9E",t[t.UNUSED_9F=159]="UNUSED_9F",t[t.ADD=160]="ADD",t[t.SUBTRACT=161]="SUBTRACT",t[t.MULTIPLY=162]="MULTIPLY",t[t.DIVIDE=163]="DIVIDE",t[t.MODULO=164]="MODULO",t[t.LSHIFT=165]="LSHIFT",t[t.RSHIFT=166]="RSHIFT",t[t.URSHIFT=167]="URSHIFT",t[t.BITAND=168]="BITAND",t[t.BITOR=169]="BITOR",t[t.BITXOR=170]="BITXOR",t[t.EQUALS=171]="EQUALS",t[t.STRICTEQUALS=172]="STRICTEQUALS",t[t.LESSTHAN=173]="LESSTHAN",t[t.LESSEQUALS=174]="LESSEQUALS",t[t.GREATERTHAN=175]="GREATERTHAN",t[t.GREATEREQUALS=176]="GREATEREQUALS",t[t.INSTANCEOF=177]="INSTANCEOF",t[t.ISTYPE=178]="ISTYPE",t[t.ISTYPELATE=179]="ISTYPELATE",t[t.IN=180]="IN",t[t.UNUSED_B5=181]="UNUSED_B5",t[t.UNUSED_B6=182]="UNUSED_B6",t[t.UNUSED_B7=183]="UNUSED_B7",t[t.UNUSED_B8=184]="UNUSED_B8",t[t.UNUSED_B9=185]="UNUSED_B9",t[t.UNUSED_BA=186]="UNUSED_BA",t[t.UNUSED_BB=187]="UNUSED_BB",t[t.UNUSED_BC=188]="UNUSED_BC",t[t.UNUSED_BD=189]="UNUSED_BD",t[t.UNUSED_BE=190]="UNUSED_BE",t[t.UNUSED_BF=191]="UNUSED_BF",t[t.INCREMENT_I=192]="INCREMENT_I",t[t.DECREMENT_I=193]="DECREMENT_I",t[t.INCLOCAL_I=194]="INCLOCAL_I",t[t.DECLOCAL_I=195]="DECLOCAL_I",t[t.NEGATE_I=196]="NEGATE_I",t[t.ADD_I=197]="ADD_I",t[t.SUBTRACT_I=198]="SUBTRACT_I",t[t.MULTIPLY_I=199]="MULTIPLY_I",t[t.UNUSED_C8=200]="UNUSED_C8",t[t.UNUSED_C9=201]="UNUSED_C9",t[t.UNUSED_CA=202]="UNUSED_CA",t[t.UNUSED_CB=203]="UNUSED_CB",t[t.UNUSED_CC=204]="UNUSED_CC",t[t.UNUSED_CD=205]="UNUSED_CD",t[t.UNUSED_CE=206]="UNUSED_CE",t[t.UNUSED_CF=207]="UNUSED_CF",t[t.GETLOCAL0=208]="GETLOCAL0",t[t.GETLOCAL1=209]="GETLOCAL1",t[t.GETLOCAL2=210]="GETLOCAL2",t[t.GETLOCAL3=211]="GETLOCAL3",t[t.SETLOCAL0=212]="SETLOCAL0",t[t.SETLOCAL1=213]="SETLOCAL1",t[t.SETLOCAL2=214]="SETLOCAL2",t[t.SETLOCAL3=215]="SETLOCAL3",t[t.UNUSED_D8=216]="UNUSED_D8",t[t.UNUSED_D9=217]="UNUSED_D9",t[t.UNUSED_DA=218]="UNUSED_DA",t[t.UNUSED_DB=219]="UNUSED_DB",t[t.UNUSED_DC=220]="UNUSED_DC",t[t.UNUSED_DD=221]="UNUSED_DD",t[t.UNUSED_DE=222]="UNUSED_DE",t[t.UNUSED_DF=223]="UNUSED_DF",t[t.UNUSED_E0=224]="UNUSED_E0",t[t.UNUSED_E1=225]="UNUSED_E1",t[t.UNUSED_E2=226]="UNUSED_E2",t[t.UNUSED_E3=227]="UNUSED_E3",t[t.UNUSED_E4=228]="UNUSED_E4",t[t.UNUSED_E5=229]="UNUSED_E5",t[t.UNUSED_E6=230]="UNUSED_E6",t[t.UNUSED_E7=231]="UNUSED_E7",t[t.UNUSED_E8=232]="UNUSED_E8",t[t.UNUSED_E9=233]="UNUSED_E9",t[t.UNUSED_EA=234]="UNUSED_EA",t[t.UNUSED_EB=235]="UNUSED_EB",t[t.UNUSED_EC=236]="UNUSED_EC",t[t.UNUSED_ED=237]="UNUSED_ED",t[t.UNUSED_EE=238]="UNUSED_EE",t[t.INVALID=237]="INVALID",t[t.DEBUG=239]="DEBUG",t[t.DEBUGLINE=240]="DEBUGLINE",t[t.DEBUGFILE=241]="DEBUGFILE",t[t.BKPTLINE=242]="BKPTLINE",t[t.TIMESTAMP=243]="TIMESTAMP",t[t.RESTARGC=244]="RESTARGC",t[t.RESTARG=245]="RESTARG",t[t.UNUSED_F6=246]="UNUSED_F6",t[t.UNUSED_F7=247]="UNUSED_F7",t[t.UNUSED_F8=248]="UNUSED_F8",t[t.UNUSED_F9=249]="UNUSED_F9",t[t.UNUSED_FA=250]="UNUSED_FA",t[t.UNUSED_FB=251]="UNUSED_FB",t[t.UNUSED_FC=252]="UNUSED_FC",t[t.UNUSED_FD=253]="UNUSED_FD",t[t.UNUSED_FE=254]="UNUSED_FE",t[t.END=255]="END"}(Bytecode||(Bytecode={}));var BytecodeName=Bytecode,Instruction=function(){function t(t,e,i,r,n,o,s){void 0===i&&(i=[]),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=!1),void 0===s&&(s=[]),this.position=t,this.name=e,this.params=i,this.delta=r,this.deltaScope=n,this.terminal=o,this.refs=s,this.stack=-1024,this.scope=-1024}return t.prototype.toString=function(){return"Instruction("+this.position+", "+BytecodeName[this.name]+" ("+this.name+"), ["+this.params+"], "+this.stack+" -> "+(this.stack+this.delta)+", "+this.scope+" -> "+(this.scope+this.deltaScope)+", "+this.terminal+", ["+this.refs+"])"},t}();function compile(methodInfo){for(var abc=methodInfo.abc,code=methodInfo.getBody().code,q=[],_loop_1=function(t){var e,i,r,n,o,s,a,l,h,c,u,p,f,_,g=function(){var e=code[t++];return 128&e&&16384&(e=127&e|code[t++]<<7)&&2097152&(e=16383&e|code[t++]<<14)&&268435456&(e=2097151&e|code[t++]<<21)&&(e=268435455&e|code[t++]<<28,e&=4294967295),e>>>0},m=function(){var t=g(),e=abc.getMultiname(t);return e.isRuntimeName()?[t,256,-1]:e.isRuntimeNamespace()?[t,512,-1]:[t,0,0]},y=function(){return(code[t++]|code[t++]<<8|code[t++]<<16)<<8>>8},v=function(){return code[t++]<<24>>24},b=t,x=code[t++];switch(x){case Bytecode.LABEL:q.push(new Instruction(b,x));break;case Bytecode.DEBUGFILE:case Bytecode.DEBUGLINE:q.push(new Instruction(b,x,[g()]));break;case Bytecode.DEBUG:q.push(new Instruction(b,x,[v(),g(),v(),g()]));break;case Bytecode.THROW:q.push(new Instruction(b,x,[],-1,0,!0));break;case Bytecode.PUSHSCOPE:case Bytecode.PUSHWITH:q.push(new Instruction(b,x,[],-1,1));break;case Bytecode.POPSCOPE:q.push(new Instruction(b,x,[],0,-1));break;case Bytecode.GETSCOPEOBJECT:q.push(new Instruction(b,x,[v()],1,0));break;case Bytecode.GETGLOBALSCOPE:q.push(new Instruction(b,x,[],1));break;case Bytecode.GETSLOT:q.push(new Instruction(b,x,[g()],0));break;case Bytecode.SETSLOT:q.push(new Instruction(b,x,[g()],-2));break;case Bytecode.NEXTNAME:case Bytecode.NEXTVALUE:q.push(new Instruction(b,x,[],-1));break;case Bytecode.HASNEXT2:q.push(new Instruction(b,x,[g(),g()],1));break;case Bytecode.IN:q.push(new Instruction(b,x,[],-1));break;case Bytecode.DUP:q.push(new Instruction(b,x,[],1));break;case Bytecode.POP:q.push(new Instruction(b,x,[],-1));break;case Bytecode.SWAP:q.push(new Instruction(b,x,[],0));break;case Bytecode.PUSHTRUE:case Bytecode.PUSHFALSE:q.push(new Instruction(b,x,[],1));break;case Bytecode.PUSHBYTE:q.push(new Instruction(b,x,[v()],1));break;case Bytecode.PUSHSHORT:q.push(new Instruction(b,x,[g()<<16>>16],1));break;case Bytecode.PUSHINT:case Bytecode.PUSHDOUBLE:q.push(new Instruction(b,x,[g()],1));break;case Bytecode.PUSHNAN:case Bytecode.PUSHNULL:case Bytecode.PUSHUNDEFINED:q.push(new Instruction(b,x,[],1));break;case Bytecode.PUSHSTRING:q.push(new Instruction(b,x,[g()],1));break;case Bytecode.IFEQ:case Bytecode.IFNE:case Bytecode.IFSTRICTEQ:case Bytecode.IFSTRICTNE:j=y(),q.push(new Instruction(b,x,[t+j],-2,0,!1,[t+j]));break;case Bytecode.IFGT:case Bytecode.IFNLE:j=y(),q.push(new Instruction(b,Bytecode.IFGT,[t+j],-2,0,!1,[t+j]));break;case Bytecode.IFGE:case Bytecode.IFNLT:j=y(),q.push(new Instruction(b,Bytecode.IFGE,[t+j],-2,0,!1,[t+j]));break;case Bytecode.IFLT:case Bytecode.IFNGE:j=y(),q.push(new Instruction(b,Bytecode.IFLT,[t+j],-2,0,!1,[t+j]));break;case Bytecode.IFLE:case Bytecode.IFNGT:j=y(),q.push(new Instruction(b,Bytecode.IFLE,[t+j],-2,0,!1,[t+j]));break;case Bytecode.IFTRUE:case Bytecode.IFFALSE:j=y(),q.push(new Instruction(b,x,[t+j],-1,0,!1,[t+j]));break;case Bytecode.LOOKUPSWITCH:offset=b+y(),cases=g(),jumps=[offset];for(var A=0;A<=cases;A++)jumps.push(b+y());q.push(new Instruction(b,x,jumps,-1,0,!0,jumps));break;case Bytecode.JUMP:j=y(),q.push(new Instruction(b,x,[t+j],0,0,!0,[t+j]));break;case Bytecode.RETURNVALUE:q.push(new Instruction(b,x,[],-1,0,!0));break;case Bytecode.RETURNVOID:q.push(new Instruction(b,x,[],0,0,!0));break;case Bytecode.NOT:case Bytecode.BITNOT:case Bytecode.NEGATE:case Bytecode.INCREMENT:case Bytecode.DECREMENT:case Bytecode.INCREMENT_I:case Bytecode.DECREMENT_I:q.push(new Instruction(b,x,[],0));break;case Bytecode.INCLOCAL_I:case Bytecode.DECLOCAL_I:q.push(new Instruction(b,x,[g()],0));break;case Bytecode.ADD:case Bytecode.SUBTRACT:case Bytecode.MULTIPLY:case Bytecode.DIVIDE:case Bytecode.MODULO:case Bytecode.LSHIFT:case Bytecode.RSHIFT:case Bytecode.URSHIFT:case Bytecode.BITAND:case Bytecode.BITOR:case Bytecode.BITXOR:case Bytecode.EQUALS:case Bytecode.STRICTEQUALS:case Bytecode.GREATERTHAN:case Bytecode.GREATEREQUALS:case Bytecode.LESSTHAN:case Bytecode.LESSEQUALS:case Bytecode.ISTYPELATE:case Bytecode.ASTYPELATE:q.push(new Instruction(b,x,[],-1));break;case Bytecode.CALL:argnum=g(),q.push(new Instruction(b,x,[argnum],-argnum-1));break;case Bytecode.CONSTRUCT:argnum=g(),q.push(new Instruction(b,x,[argnum,index],-argnum));break;case Bytecode.CALLPROPERTY:e=m(),index=e[0],dyn=e[1],d=e[2],argnum=g(),q.push(new Instruction(b,x+dyn,[argnum,index],-argnum+d));break;case Bytecode.CALLPROPVOID:i=m(),index=i[0],dyn=i[1],d=i[2],argnum=g(),q.push(new Instruction(b,x+dyn,[argnum,index],-(argnum+1)+d));break;case Bytecode.APPLYTYPE:argnum=g(),q.push(new Instruction(b,x,[argnum],-argnum));break;case Bytecode.FINDPROPSTRICT:r=m(),index=r[0],dyn=r[1],d=r[2],q.push(new Instruction(b,x+dyn,[index],1+d));break;case Bytecode.FINDPROPERTY:n=m(),index=n[0],dyn=n[1],d=n[2],q.push(new Instruction(b,x+dyn,[index],1+d));break;case Bytecode.NEWFUNCTION:q.push(new Instruction(b,x,[g()],1));break;case Bytecode.NEWCLASS:q.push(new Instruction(b,x,[g()],0));break;case Bytecode.NEWARRAY:argnum=g(),q.push(new Instruction(b,x,[argnum],1-argnum));break;case Bytecode.NEWOBJECT:argnum=g(),q.push(new Instruction(b,x,[argnum],-2*argnum+1));break;case Bytecode.NEWACTIVATION:q.push(new Instruction(b,x,[],1));break;case Bytecode.NEWCATCH:q.push(new Instruction(b,x,[g()],1));break;case Bytecode.CONSTRUCTSUPER:argnum=g(),q.push(new Instruction(b,x,[argnum],-(argnum+1)));break;case Bytecode.CALLSUPER:o=m(),index=o[0],dyn=o[1],d=o[2],argnum=g(),q.push(new Instruction(b,x+dyn,[argnum,index],-argnum+d));break;case Bytecode.CALLSUPERVOID:s=m(),index=s[0],dyn=s[1],d=s[2],argnum=g(),q.push(new Instruction(b,x+dyn,[argnum,index],-(argnum+1)+d));break;case Bytecode.CONSTRUCTPROP:a=m(),index=a[0],dyn=a[1],d=a[2],argnum=g(),q.push(new Instruction(b,x+dyn,[argnum,index],-argnum+d));break;case Bytecode.GETPROPERTY:l=m(),index=l[0],dyn=l[1],d=l[2],q.push(new Instruction(b,Bytecode.GETPROPERTY+dyn,[index],0+d));break;case Bytecode.INITPROPERTY:case Bytecode.SETPROPERTY:h=m(),index=h[0],dyn=h[1],d=h[2],q.push(new Instruction(b,Bytecode.SETPROPERTY+dyn,[index],-2+d));break;case Bytecode.DELETEPROPERTY:c=m(),index=c[0],dyn=c[1],d=c[2],q.push(new Instruction(b,x+dyn,[index],0+d));case Bytecode.GETSUPER:u=m(),index=u[0],dyn=u[1],d=u[2],q.push(new Instruction(b,x+dyn,[index],0+d));break;case Bytecode.SETSUPER:p=m(),index=p[0],dyn=p[1],d=p[2],q.push(new Instruction(b,x+dyn,[index],-2+d));break;case Bytecode.COERCE:f=m(),index=f[0],dyn=f[1],d=f[2],q.push(new Instruction(b,x+dyn,[index],0+d));break;case Bytecode.COERCE_A:case Bytecode.COERCE_S:case Bytecode.CONVERT_I:case Bytecode.CONVERT_D:case Bytecode.CONVERT_B:case Bytecode.CONVERT_U:q.push(new Instruction(b,x,[],0));break;case Bytecode.GETLOCAL:q.push(new Instruction(b,Bytecode.GETLOCAL,[g()],1));break;case Bytecode.GETLOCAL0:q.push(new Instruction(b,Bytecode.GETLOCAL,[0],1));break;case Bytecode.GETLOCAL1:q.push(new Instruction(b,Bytecode.GETLOCAL,[1],1));break;case Bytecode.GETLOCAL2:q.push(new Instruction(b,Bytecode.GETLOCAL,[2],1));break;case Bytecode.GETLOCAL3:q.push(new Instruction(b,Bytecode.GETLOCAL,[3],1));break;case Bytecode.SETLOCAL:q.push(new Instruction(b,Bytecode.SETLOCAL,[g()],-1));break;case Bytecode.SETLOCAL0:q.push(new Instruction(b,Bytecode.SETLOCAL,[0],-1));break;case Bytecode.SETLOCAL1:q.push(new Instruction(b,Bytecode.SETLOCAL,[1],-1));break;case Bytecode.SETLOCAL2:q.push(new Instruction(b,Bytecode.SETLOCAL,[2],-1));break;case Bytecode.SETLOCAL3:q.push(new Instruction(b,Bytecode.SETLOCAL,[3],-1));break;case Bytecode.KILL:q.push(new Instruction(b,x,[g()],0));break;case Bytecode.GETLEX:_=m(),index=_[0],dyn=_[1],d=_[2],q.push(new Instruction(b,x+dyn,[index],1+d));break;default:return console.log("UNKNOWN #"+code[t-1].toString(16)+" "+BytecodeName[code[t-1]]+" (method N"+methodInfo.index()+")"),{value:"UNKNOWN BYTECODE $"+code[t-1].toString(16)+" ("+BytecodeName[code[t-1]]+") at "+b}}out_i_1=t},j,j,j,j,j,j,j,j,j,j,offset,cases,jumps,j,argnum,argnum,index,dyn,d,argnum,index,dyn,d,argnum,argnum,index,dyn,d,index,dyn,d,argnum,argnum,argnum,index,dyn,d,argnum,index,dyn,d,argnum,index,dyn,d,argnum,index,dyn,d,index,dyn,d,index,dyn,d,index,dyn,d,index,dyn,d,index,dyn,d,index,dyn,d,out_i_1,i=0;i<code.length;){var state_1=_loop_1(i);if(i=out_i_1,"object"==typeof state_1)return state_1.value}var propagate=function(t,e){for(var i=e,r=0;r<q.length;r++)if(q[r].position>=t){if(q[r].stack>=0)return;q[r].stack=i,i+=q[r].delta;for(var n=0;n<q[r].refs.length;n++)propagate(q[r].refs[n],i);if(q[r].terminal)return}};propagate(0,0);var propagateScope=function(t,e){for(var i=e,r=0;r<q.length;r++)if(q[r].position>=t){if(q[r].scope>=0)return;q[r].scope=i,i+=q[r].deltaScope;for(var n=0;n<q[r].refs.length;n++)propagateScope(q[r].refs[n],i);if(q[r].terminal)return}};propagateScope(0,0);var targets=[];targets.push(0);for(var i=0;i<q.length;i++)for(var j_4=0;j_4<q[i].refs.length;j_4++)targets.push(q[i].refs[j_4]);for(var maxstack=0,i=0;i<q.length;i++)q[i].stack>maxstack&&(maxstack=q[i].stack);for(var maxlocal=0,i=0;i<q.length;i++)q[i].name!=Bytecode.GETLOCAL&&q[i].name!=Bytecode.SETLOCAL||q[i].params[0]>maxlocal&&(maxlocal=q[i].params[0]);for(var temp=!1,i=0;i<q.length;i++)q[i].name!=Bytecode.NEWOBJECT&&q[i].name!=Bytecode.SWAP&&q[i].name!=Bytecode.HASNEXT2||(temp=!0);for(var maxscope=0,i=0;i<q.length;i++)q[i].scope>maxscope&&(maxscope=q[i].scope);var params=methodInfo.parameters,underrun="[stack underrun]",js0=["// (#"+methodInfo.index()+") --- "+methodInfo];js0.push("(function (context) { return function compiled_"+methodInfo.getName().replace(/([^a-z0-9]+)/gi,"_")+"() {");for(var i=0;i<params.length;i++)if(params[i].hasOptionalValue()){js0.push("    let argnum = arguments.length;");break}js0.push("    let local0 = this === context.jsGlobal ? context.savedScope.global.object : this;");for(var i=0;i<params.length;i++){var p=params[i];if(js0.push("    let local"+(i+1)+" = arguments["+i+"];"),params[i].hasOptionalValue())switch(p.optionalValueKind){case 1:js0.push("    if (argnum <= "+i+") local"+(i+1)+" = context.abc.getString("+p.optionalValueIndex+");");break;default:js0.push("    if (argnum <= "+i+") local"+(i+1)+" = "+p.getOptionalValue()+";")}}for(var i=params.length+1;i<=maxlocal;i++)js0.push("    let local"+i+" = undefined;");for(var i=0;i<=maxstack;i++)js0.push("    let stack"+i+" = undefined;");for(var i=0;i<=maxscope;i++)js0.push("    let scope"+i+" = undefined;");temp&&js0.push("    let temp = undefined;"),js0.push("    let tk = undefined;"),js0.push("    let tr = undefined;");var names=[],getname=function(t){var e=abc.getMultiname(t),i=names.indexOf(e);return i<0&&(i=names.length,names.push(e),js0.push("    let name"+i+" = context.names["+i+"];")),"name"+i},js=[];js.push("    let p = 0;"),js.push("    while (true) {"),js.push("        switch (p) {");for(var _loop_2=function(t){var e=q[t];targets.indexOf(e.position)>=0&&js.push("            case "+e.position+":"),js.push("                    //"+BytecodeName[e.name]+" "+e.params.join(" / "));var i=function(t){return e.stack-1-t>=0?"stack"+(e.stack-1-t):underrun},r=i(0),n=i(1),o=i(2),s=(i(3),i(-1)),a=e.scope>0?"scope"+(e.scope-1):"context.savedScope",l="scope"+e.scope,h=function(t){return"local"+t},c=function(t){return e.params[t]};if(resolver.extra=methodInfo.index()+" | "+e.position+" | ",e.stack<0)js.push("                    // unreachable");else switch(e.name){case Bytecode.LABEL:case Bytecode.DEBUGFILE:case Bytecode.DEBUGLINE:case Bytecode.DEBUG:case Bytecode.THROW:break;case Bytecode.GETLOCAL:js.push("                "+s+" = "+h(c(0))+";");break;case Bytecode.SETLOCAL:js.push("                "+h(c(0))+" = "+r+";");break;case Bytecode.GETSLOT:js.push("                "+r+" = context.sec.box("+r+").axGetSlot("+c(0)+");");break;case Bytecode.SETSLOT:js.push("                context.sec.box("+n+").axSetSlot("+c(0)+", "+r+");");break;case Bytecode.GETGLOBALSCOPE:js.push("                "+s+" = context.savedScope.global.object;");break;case Bytecode.PUSHSCOPE:js.push("                "+l+" = "+a+".extend(context.sec.box("+r+"));");break;case Bytecode.PUSHWITH:js.push("                "+l+" = context.pushwith("+a+", "+r+");");break;case Bytecode.POPSCOPE:js.push("                "+a+" = undefined;");break;case Bytecode.GETSCOPEOBJECT:js.push("                "+s+" = scope"+c(0)+".object;");break;case Bytecode.NEXTNAME:js.push("                "+n+" = context.sec.box("+n+").axNextName("+r+");");break;case Bytecode.NEXTVALUE:js.push("                "+n+" = context.sec.box("+n+").axNextValue("+r+");");break;case Bytecode.HASNEXT2:js.push("                temp = context.hasnext2("+h(c(0))+", "+h(c(1))+");"),js.push("                "+h(c(0))+" = temp[0];"),js.push("                "+h(c(1))+" = temp[1];"),js.push("                "+s+" = "+h(c(1))+" > 0;");break;case Bytecode.IN:js.push("                "+n+" = ("+n+" && "+n+".axClass === context.sec.AXQName) ? obj.axHasProperty("+n+".name) : "+r+".axHasPublicProperty("+n+");");break;case Bytecode.DUP:js.push("                "+s+" = "+r+";");break;case Bytecode.POP:js.push("                ;");break;case Bytecode.SWAP:js.push("                temp = "+r+";"),js.push("                "+r+" = "+n+";"),js.push("                "+n+" = temp;"),js.push("                temp = undefined;");break;case Bytecode.PUSHTRUE:js.push("                "+s+" = true;");break;case Bytecode.PUSHFALSE:js.push("                "+s+" = false;");break;case Bytecode.PUSHBYTE:case Bytecode.PUSHSHORT:js.push("                "+s+" = "+c(0)+";");break;case Bytecode.PUSHINT:js.push("                "+s+" = "+abc.ints[c(0)]+";");break;case Bytecode.PUSHDOUBLE:js.push("                "+s+" = "+abc.doubles[c(0)]+";");break;case Bytecode.PUSHSTRING:js.push("                "+s+" = context.abc.getString("+c(0)+");");break;case Bytecode.PUSHNAN:js.push("                "+s+" = NaN;");break;case Bytecode.PUSHNULL:js.push("                "+s+" = null;");break;case Bytecode.PUSHUNDEFINED:js.push("                "+s+" = undefined;");break;case Bytecode.IFEQ:js.push("                if ("+r+" == "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFNE:js.push("                if ("+r+" != "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFSTRICTEQ:js.push("                if ("+r+" === "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFSTRICTNE:js.push("                if ("+r+" !== "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFGT:js.push("                if ("+r+" < "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFGE:js.push("                if ("+r+" <= "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFLT:js.push("                if ("+r+" > "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFLE:js.push("                if ("+r+" >= "+n+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFFALSE:js.push("                if (!"+r+") { p = "+c(0)+"; continue; };");break;case Bytecode.IFTRUE:js.push("                if ("+r+") { p = "+c(0)+"; continue; };");break;case Bytecode.LOOKUPSWITCH:jj=e.params.concat(),dj=jj.shift(),js.push("                if ("+r+" >= 0 && "+r+" < "+jj.length+") { p = ["+jj.join(", ")+"]["+r+"]; continue; } else { p = "+dj+"; continue; };");break;case Bytecode.JUMP:js.push("                { p = "+c(0)+"; continue; };");break;case Bytecode.INCREMENT:js.push("                "+r+"++;");break;case Bytecode.DECREMENT:js.push("                "+r+"--;");break;case Bytecode.INCREMENT_I:js.push("                "+r+" |= 0;"),js.push("                "+r+"++;");break;case Bytecode.DECREMENT_I:js.push("                "+r+" |= 0;"),js.push("                "+r+"--;");break;case Bytecode.INCLOCAL_I:case Bytecode.DECLOCAL_I:js.push("                "+h(c(0))+" |= 0;"),js.push("                "+h(c(0))+"++;");break;case Bytecode.ADD:js.push("                "+n+" = "+n+" + "+r+";");break;case Bytecode.SUBTRACT:js.push("                "+n+" = "+n+" - "+r+";");break;case Bytecode.MULTIPLY:js.push("                "+n+" = "+n+" * "+r+";");break;case Bytecode.DIVIDE:js.push("                "+n+" = "+n+" / "+r+";");break;case Bytecode.MODULO:js.push("                "+n+" = "+n+" % "+r+";");break;case Bytecode.LSHIFT:js.push("                "+n+" = "+n+" << "+r+";");break;case Bytecode.RSHIFT:js.push("                "+n+" = "+n+" >> "+r+";");break;case Bytecode.URSHIFT:js.push("                "+n+" = "+n+" >>> "+r+";");break;case Bytecode.BITAND:js.push("                "+n+" = "+n+" & "+r+";");break;case Bytecode.BITOR:js.push("                "+n+" = "+n+" | "+r+";");break;case Bytecode.BITXOR:js.push("                "+n+" = "+n+" ^ "+r+";");break;case Bytecode.EQUALS:js.push("                "+n+" = "+n+" == "+r+";");break;case Bytecode.STRICTEQUALS:js.push("                "+n+" = "+n+" === "+r+";");break;case Bytecode.GREATERTHAN:js.push("                "+n+" = "+n+" > "+r+";");break;case Bytecode.GREATEREQUALS:js.push("                "+n+" = "+n+" >= "+r+";");break;case Bytecode.LESSTHAN:js.push("                "+n+" = "+n+" < "+r+";");break;case Bytecode.LESSEQUALS:js.push("                "+n+" = "+n+" <= "+r+";");break;case Bytecode.NOT:js.push("                "+r+" = !"+r+";");break;case Bytecode.BITNOT:js.push("                "+r+" = ~"+r+";");break;case Bytecode.NEGATE:js.push("                "+r+" = -"+r+";");break;case Bytecode.ISTYPELATE:js.push("                "+n+" = "+r+".axIsType("+n+");");break;case Bytecode.ASTYPELATE:js.push("                "+n+" = "+r+".axAsType("+n+");");break;case Bytecode.CALL:for(var u=[],p=1;p<=c(0);p++)u.push(i(c(0)-p));js.push("                "+i(c(0)+1)+" = context.call("+i(c(0)+1)+", "+i(c(0))+", ["+u.join(", ")+"]);");break;case Bytecode.CONSTRUCT:for(var d=[],f=1;f<=c(0);f++)d.push(i(c(0)-f));js.push("                "+i(c(0))+" = context.construct("+i(c(0))+", ["+d.join(", ")+"]);");break;case Bytecode.CALLPROPERTY:for(var _=[],g=0;g<=c(0);g++)_.push(i(c(0)-g));"getDefinitionByName"==abc.getMultiname(c(1)).name?js.push("                "+i(c(0))+" = context.getdefinitionbyname("+a+", "+_.shift()+", ["+_.join(", ")+"]);"):(js.push("                // "+abc.getMultiname(c(0))),js.push("                "+i(c(0))+" = context.sec.box("+_.shift()+").axCallProperty("+getname(c(1))+", ["+_.join(", ")+"], false);"));break;case Bytecode.CALLPROPVOID:for(var m=[],y=0;y<=c(0);y++)m.push(i(c(0)-y));js.push("                context.sec.box("+m.shift()+").axCallProperty("+getname(c(1))+", ["+m.join(", ")+"], false);");break;case Bytecode.APPLYTYPE:for(var v=[],b=1;b<=c(0);b++)v.push(i(c(0)-b));js.push("                "+i(c(0))+" = context.sec.applyType("+i(c(0))+", ["+v.join(", ")+"]);");break;case Bytecode.FINDPROPSTRICT:js.push("                // "+abc.getMultiname(c(0))),js.push("                "+s+" = "+a+".findScopeProperty("+getname(c(0))+", true, false);");break;case Bytecode.FINDPROPERTY:js.push("                // "+abc.getMultiname(c(0))),js.push("                "+s+" = "+a+".findScopeProperty("+getname(c(0))+", false, false);");break;case Bytecode.NEWFUNCTION:js.push("                // "+abc.getMethodInfo(c(0))),js.push("                "+s+" = context.sec.createFunction(context.abc.getMethodInfo("+c(0)+"), "+a+", true);");break;case Bytecode.NEWCLASS:js.push("                // "+abc.classes[c(0)]),js.push("                "+r+" = context.sec.createClass(context.abc.classes["+c(0)+"], "+r+", "+a+");");break;case Bytecode.NEWARRAY:for(var x=[],A=1;A<=c(0);A++)x.push(i(c(0)-A));js.push("                "+i(c(0)-1)+" = context.sec.AXArray.axBox(["+x.join(", ")+"]);");break;case Bytecode.NEWOBJECT:js.push("                temp = Object.create(context.sec.AXObject.tPrototype);");for(var E=1;E<=c(0);E++)js.push("                temp.axSetPublicProperty("+i(2*c(0)-2*E+1)+", "+i(2*c(0)-2*E)+");");js.push("                "+i(2*c(0)-1)+" = temp;"),js.push("                temp = undefined;");break;case Bytecode.NEWACTIVATION:js.push("                "+s+" = context.sec.createActivation(context.mi, "+a+");");break;case Bytecode.NEWCATCH:js.push("                "+s+" = context.sec.createCatch(context.mi.getBody().catchBlocks["+c(0)+"], "+a+");");break;case Bytecode.CONSTRUCTSUPER:for(var S=[],T=1;T<=c(0);T++)S.push(i(c(0)-T));js.push("                context.savedScope.object.superClass.tPrototype.axInitializer.apply("+i(c(0))+", ["+S.join(", ")+"]);");break;case Bytecode.CALLSUPER_DYN:for(var P=[],C=1;C<=c(0);C++)P.push(i(c(0)-C));js.push("                "+i(c(0)+1)+" = context.sec.box("+i(c(0)+1)+").axCallSuper(context.runtimename("+i(c(0))+", "+c(1)+"), context.savedScope, ["+P.join(", ")+"]);");break;case Bytecode.CALLSUPERVOID:for(var w=[],D=1;D<=c(0);D++)w.push(i(c(0)-D));js.push("                context.sec.box("+i(c(0))+").axCallSuper("+getname(c(1))+", context.savedScope, ["+w.join(", ")+"]);");break;case Bytecode.CONSTRUCTPROP:for(var M=[],O=1;O<=c(0);O++)M.push(i(c(0)-O));js.push("                "+i(c(0))+" = context.constructprop("+getname(c(1))+", "+i(c(0))+", ["+M.join(", ")+"]);");break;case Bytecode.GETPROPERTY:mn=abc.getMultiname(c(0)),js.push("                // "+mn),(I=resolver.resolveGet(mn))?js.push("                "+r+" = "+r+'["'+I+'"];'):(js.push("                if ("+r+") {"),js.push("                    tk = "+r+"['__key__'];"),js.push("                    if (tk) {"),js.push("                        tr = "+getname(c(0))+".resolved[tk];"),js.push("                        if (tr) {"),js.push("                            "+r+" = "+r+"[tr];"),js.push("                        }"),js.push("                        else {"),js.push("                            "+r+" = context.getpropertydyn("+getname(c(0))+", "+r+");"),js.push("                        }"),js.push("                    }"),js.push("                    else {"),js.push("                        "+r+" = context.getpropertydyn("+getname(c(0))+", "+r+");"),js.push("                    }"),js.push("                }"),js.push("                else {"),js.push("                    "+r+" = context.getpropertydyn("+getname(c(0))+", "+r+");"),js.push("                }"));break;case Bytecode.GETPROPERTY_DYN:js.push("                "+n+" = context.getpropertydyn(context.runtimename("+r+", "+c(0)+"), "+n+");");break;case Bytecode.SETPROPERTY:mn=abc.getMultiname(c(0)),js.push("                // "+mn),(I=resolver.resolveSet(mn))?js.push("                "+n+'["'+I+'"] = '+r+";}"):js.push("                context.setproperty("+getname(c(0))+", "+r+", "+n+");");break;case Bytecode.SETPROPERTY_DYN:js.push("                context.setproperty(context.runtimename("+n+", "+c(0)+"), "+r+", "+o+");");break;case Bytecode.DELETEPROPERTY:js.push("                // "+abc.getMultiname(c(0))),js.push("                "+r+" = context.deleteproperty("+getname(c(0))+", "+r+");");break;case Bytecode.DELETEPROPERTY_DYN:js.push("                "+n+" = context.deleteproperty(context.runtimename("+r+", "+c(0)+"), "+n+");");break;case Bytecode.GETSUPER:js.push("                "+r+" = context.sec.box("+r+").axGetSuper("+getname(c(0))+", context.savedScope);");break;case Bytecode.GETSUPER_DYN:js.push("                "+n+" = context.sec.box("+n+").axGetSuper(context.runtimename("+r+", "+c(0)+"), context.savedScope);");break;case Bytecode.SETSUPER:js.push("                context.sec.box("+n+").axSetSuper("+getname(c(0))+", context.savedScope, "+r+");");break;case Bytecode.SETSUPER_DYN:js.push("                context.sec.box("+o+").axSetSuper(context.runtimename("+n+", "+c(0)+"), context.savedScope, "+r+");");break;case Bytecode.GETLEX:mn=abc.getMultiname(c(0)),js.push("                // "+mn);var I,L=resolver.resolveLex(mn);if(null!=(I=resolver.resolveGet(mn))&&0!=L)if(L>0){for(var N="",F=1;F<L;F++)N+=".parent";js.push("                "+s+" = "+a+N+'.object["'+I+'"];')}else js.push("                "+s+" = "+a+".global.object.applicationDomain.findProperty("+getname(c(0))+', true, true)["'+I+'"];');else js.push("                "+s+" = "+a+".findScopeProperty("+getname(c(0))+", true, false).axGetProperty("+getname(c(0))+");");break;case Bytecode.RETURNVALUE:js.push("                return "+r+";");break;case Bytecode.RETURNVOID:js.push("                return;");break;case Bytecode.COERCE:js.push("                "+r+" = "+a+".getScopeProperty("+getname(c(0))+", true, false).axCoerce("+r+");");break;case Bytecode.COERCE_A:js.push("                ;");break;case Bytecode.COERCE_S:js.push("                "+r+" = context.axCoerceString("+r+");");break;case Bytecode.CONVERT_I:js.push("                "+r+" |= 0;");break;case Bytecode.CONVERT_D:js.push("                "+r+" = +"+r+";");break;case Bytecode.CONVERT_B:js.push("                "+r+" = !!"+r+";");break;case Bytecode.CONVERT_U:js.push("                "+r+" >>>= 0;");break;case Bytecode.KILL:js.push("                "+h(c(0))+" = undefined;");break;default:return js.push("                //unknown instruction "+q[t]),console.log("unknown instruction "+q[t]+" (method N"+methodInfo.index()+")"),{value:"unhandled instruction "+e}}},jj,dj,mn,mn,mn,i=0;i<q.length;i++){var state_2=_loop_2(i);if("object"==typeof state_2)return state_2.value}js.push("        }"),js.push("    }"),js.push("}})");var w=js0.join("\n")+"\n"+js.join("\n");return w.indexOf(underrun)>=0?"STACK UNDERRUN":(resolver.extra="@@@ | ",{names:names,compiled:eval(w)})}var Context=function(){function t(t,e,i){this.jsGlobal=jsGlobal,this.axCoerceString=axCoerceString$3,this.mi=t,this.savedScope=e,this.abc=t.abc,this.sec=t.abc.applicationDomain.sec,this.names=i}return t.prototype.extra=function(t){resolver.extra=t},t.prototype.call=function(t,e,i){return validateCall(this.sec,t,i.length),t.axApply(e,i)},t.prototype.getdefinitionbyname=function(t,e,i){return t.global.object.scriptInfo.abc.env.app.getClass(Multiname.FromSimpleName(i[0]))},t.prototype.getproperty=function(t,e){return e.axGetProperty(t)},t.prototype.getpropertydyn=function(t,e){var i=this.sec.box(e);return"number"==typeof t?i.axGetNumericProperty(t):i.axGetProperty(t)},t.prototype.setproperty=function(t,e,i){if("number"==typeof t)return this.sec.box(i).axSetNumericProperty(t,e);this.sec.box(i).axSetProperty(t,e,Bytecode.INITPROPERTY)},t.prototype.deleteproperty=function(t,e){var i=this.sec.box(e);return"number"==typeof t||"string"==typeof t?delete i[t]:i.axDeleteProperty(t)},t.prototype.getlexrecording=function(t,e){var i=e.findScopeProperty(t,!0,!1);if(e.global.object.applicationDomain.findProperty(t,!0,!0)===i)resolver.recordLex(t,-1);else for(var r=1,n=e;;){if(n.object===i){resolver.recordLex(t,r);break}if(null==n.parent){resolver.recordLex(t,0);break}r+=1,n=n.parent}return i.axGetProperty(t)},t.prototype.getlex=function(t,e){return e.findScopeProperty(t,!0,!1).axGetProperty(t)},t.prototype.construct=function(t,e){t.classInfo.instanceInfo.getName();return validateConstruct(this.sec,t,e.length),t.axConstruct(e)},t.prototype.constructprop=function(t,e,i){var r=this.sec.box(e),n=r.axResolveMultiname(t),o=r[n];return validateConstruct(r.sec,o,i.length),o.axConstruct(i)},t.prototype.pushwith=function(t,e){var i=this.sec.box(e);return t.object===i&&1==t.isWith?t:new Scope(t,i,!0)},t.prototype.hasnext2=function(t,e){var i=new HasNext2Info(null,0);return i.next(this.sec.box(t),e),[i.object,i.index]},t.prototype.runtimename=function(t,e){if("number"==typeof t)return t;var i,r=this.abc.getMultiname(e);if(t&&t.axClass&&t.axClass===t.sec.AXQName)return(i=new Multiname(this.abc,0,null,null,null)).numeric=!1,i.id=r.id,i.kind=r.kind,i.kind=r.isAttribute()?18:17,i.id=t.name.id,i.name=t.name.name,i.namespaces=t.name.namespaces,i;("number"==typeof t||isNumeric(axCoerceName(t)))&&((i=new Multiname(this.abc,0,null,null,null)).numeric=!1,i.id=r.id,i.kind=r.kind,i.numeric=!0,i.numericValue=+axCoerceName(t));return r.rename(t)},t}(),ScopeStack=function(){function t(t){this.parent=t,this.stack=[],this.isWith=[]}return t.prototype.push=function(t,e){this.stack.push(t),this.isWith.push(!!e)},t.prototype.get=function(t){return this.stack[t]},t.prototype.clear=function(){this.stack.length=0,this.isWith.length=0},t.prototype.pop=function(){this.isWith.pop(),this.stack.pop(),this.scopes&&this.scopes.length>this.stack.length&&this.scopes.length--},t.prototype.topScope=function(){if(!this.scopes){if(0===this.stack.length)return this.parent;this.scopes=[]}for(var t=this.parent,e=0;e<this.stack.length;e++){var i=this.stack[e],r=this.isWith[e],n=this.scopes[e];n&&n.parent===t&&n.object===i&&n.isWith===r||(n=this.scopes[e]=new Scope(t,i,r)),t=n}return t},t}();function popNameInto(t,e,i){if(i.resolved={},i.script=null,i.numeric=!1,i.id=e.id,i.kind=e.kind,e.isRuntimeName()){var r=t.pop();if(r&&r.axClass&&r.axClass===r.sec.AXQName)return r=r.name,i.kind=e.isAttribute()?18:17,i.id=r.id,i.name=r.name,void(i.namespaces=r.namespaces);("number"==typeof r||isNumeric(axCoerceName(r)))&&(i.numeric=!0,i.numericValue=+axCoerceName(r)),i.name=r,i.id=-1}else i.name=e.name;if(e.isRuntimeNamespace()){var n=t.pop();n._ns&&(n=n._ns),i.namespaces=[n],i.id=-1}else i.namespaces=e.namespaces;interpreterWriter&&interpreterWriter.greenLn("Name: "+i.name)}function interpret(t,e,i){if(null==t.compiled&&null==t.error){var r=compile(t);"string"==typeof r?t.error=r:(t.compiled=r.compiled,t.names=r.names)}return t.compiled?t.compiled(new Context(t,e,t.names)):_interpret(t,e,i)}var InterpreterFrame=function(){function t(t,e,i,r,n){this.pc=0,this.stack=[],this.hasNext2Infos=null;var o=this.body=e.getBody();this.code=o.code,this.scopes=new ScopeStack(i);for(var s,a=this.locals=[t],l=this.app=e.abc.applicationDomain,h=this.sec=l.sec,c=r.length,u=0,p=e.parameters.length;u<p;u++){var d=e.parameters[u];s=u<c?r[u]:d.hasOptionalValue()?d.getOptionalValue():void 0;var f=d.getType();if(f&&!f.isAnyName()){var _=i.getScopeProperty(f,!0,!1);if(!_){if(!("axClass"in t&&t.axClass.name.matches(f)))continue;_=t.axClass}s=_.axCoerce(s)}a.push(s)}if(e.needsRest())a.push(h.createArrayUnsafe(sliceArguments(r,e.parameters.length)));else if(e.needsArguments()){var g=sliceArguments(r,0),m=Object.create(h.argumentsPrototype);m.value=g,m.callee=n,m.receiver=t,m.methodInfo=e,a.push(m)}}return t.prototype.bc=function(){return this.code[this.pc++]},t.prototype.u30=function(){var t=this.code,e=this.pc,i=t[e++];return 128&i&&16384&(i=127&i|t[e++]<<7)&&2097152&(i=16383&i|t[e++]<<14)&&268435456&(i=2097151&i|t[e++]<<21)&&(i=268435455&i|t[e++]<<28,i&=4294967295),this.pc=e,i>>>0},t.prototype.s24=function(){var t=this.code,e=this.pc,i=t[e]|t[e+1]<<8|t[e+2]<<16;return this.pc=e+3,i<<8>>8},t.prototype.getHasNext2Info=function(){var t=this.pc,e=this.hasNext2Infos;return e||(e=this.hasNext2Infos=[]),e[t]||(e[t]=new HasNext2Info(null,0)),e[t]},t}();function _interpret(t,e,i){return null!=t.error&&console.log("interpret: ("+t.error+")"),function(){var r,n,o,s,a,l,h,c,u=new InterpreterFrame(this,t,e,arguments,i),p=u.stack,d=u.locals,f=u.scopes,_=u.sec,g=t.abc,m=new Multiname(g,0,null,null,null,null,!0),y=[],v=0,b=scopeStacks.length;scopeStacks.push(u.scopes);t:for(;;)try{var x=u.bc();switch(x){case 9:continue;case 3:throw p.pop();case 8:d[u.u30()]=void 0;break;case 12:case 24:l=u.s24(),p.pop()<=p.pop()&&(u.pc+=l);continue;case 13:case 23:l=u.s24(),p.pop()<p.pop()&&(u.pc+=l);continue;case 14:case 22:l=u.s24(),p.pop()>=p.pop()&&(u.pc+=l);continue;case 15:case 21:l=u.s24(),p.pop()>p.pop()&&(u.pc+=l);continue;case 16:u.pc=u.s24()+u.pc;continue;case 17:l=u.s24(),p.pop()&&(u.pc+=l);continue;case 18:l=u.s24(),p.pop()||(u.pc+=l);continue;case 19:l=u.s24(),axEquals(p.pop(),p.pop(),_)&&(u.pc+=l);continue;case 20:l=u.s24(),axEquals(p.pop(),p.pop(),_)||(u.pc+=l);continue;case 25:l=u.s24(),p.pop()==p.pop()&&(u.pc+=l);continue;case 26:l=u.s24(),p.pop()!=p.pop()&&(u.pc+=l);continue;case 27:var A=u.pc-1;l=u.s24();var E=u.u30();(h=p.pop())<=E&&(u.pc+=3*h,l=u.s24()),u.pc=A+l;continue;case 29:f.pop();break;case 30:p[p.length-2]=_.box(p[p.length-2]).axNextName(p.pop());break;case 35:p[p.length-2]=_.box(p[p.length-2]).axNextValue(p.pop());break;case 50:var S=u.getHasNext2Info(),T=u.u30(),P=u.u30();S.next(_.box(d[T]),d[P]),d[T]=S.object,d[P]=S.index,p.push(!!S.index);break;case 32:p.push(null);break;case 33:p.push(void 0);break;case 36:p.push(u.code[u.pc++]<<24>>24);break;case 37:p.push(u.u30()<<16>>16);break;case 44:p.push(g.getString(u.u30()));break;case 45:p.push(g.ints[u.u30()]);break;case 46:p.push(g.uints[u.u30()]);break;case 47:p.push(g.doubles[u.u30()]);break;case 38:p.push(!0);break;case 39:p.push(!1);break;case 40:p.push(NaN);break;case 41:p.pop();break;case 42:p.push(p[p.length-1]);break;case 43:r=p[p.length-1],p[p.length-1]=p[p.length-2],p[p.length-2]=r;break;case 48:f.push(_.box(p.pop()),!1);break;case 28:f.push(_.box(p.pop()),!0);break;case 49:p.push(_.AXNamespace.FromNamespace(g.getNamespace(u.u30())));break;case 64:p.push(_.createFunction(g.getMethodInfo(u.u30()),f.topScope(),!0));break;case 65:popManyInto(p,u.u30(),y),n=p.pop(),validateCall(_,r=p[p.length-1],y.length),p[p.length-1]=r.axApply(n,y);break;case 66:popManyInto(p,u.u30(),y),o=_.box(p[p.length-1]),validateConstruct(_,o,y.length),p[p.length-1]=o.axConstruct(y);break;case 71:return release||assert(scopeStacks.length===b+1),void scopeStacks.length--;case 72:return r=p.pop(),t.returnTypeNameIndex&&(o=t.getType())&&(r=o.axCoerce(r)),release||assert(scopeStacks.length===b+1),scopeStacks.length--,r;case 73:popManyInto(p,u.u30(),y),e.object.superClass.tPrototype.axInitializer.apply(p.pop(),y);break;case 74:h=u.u30(),popManyInto(p,u.u30(),y),popNameInto(p,g.getMultiname(h),m),p[p.length-1]=_.box(p[p.length-1]).axConstructProperty(m,y);break;case 76:case 70:case 79:h=u.u30(),popManyInto(p,u.u30(),y),popNameInto(p,g.getMultiname(h),m),c=_.box(p[p.length-1]).axCallProperty(m,y,76===x),79===x?p.length--:p[p.length-1]=c;break;case 69:case 78:h=u.u30(),popManyInto(p,u.u30(),y),popNameInto(p,g.getMultiname(h),m),c=_.box(p[p.length-1]).axCallSuper(m,e,y),78===x?p.length--:p[p.length-1]=c;break;case 83:popManyInto(p,u.u30(),y),p[p.length-1]=_.applyType(p[p.length-1],y);break;case 85:n=Object.create(_.AXObject.tPrototype),v=u.u30();for(var C=p.length-2*v;C<p.length;C+=2)r=p[C+1],n.axSetPublicProperty(p[C],r);p.length-=2*v,p.push(n);break;case 86:n=[],v=u.u30();for(C=p.length-v;C<p.length;C++)n.push(p[C]);p.length-=v,p.push(_.AXArray.axBox(n));break;case 87:p.push(_.createActivation(t,f.topScope()));break;case 88:r=p[p.length-1],p[p.length-1]=_.createClass(g.classes[u.u30()],r,f.topScope());break;case 89:popNameInto(p,g.getMultiname(u.u30()),m),void 0===m.name&&(m.name="*"),p[p.length-1]=axGetDescendants(p[p.length-1],m,_);break;case 90:p.push(_.createCatch(u.body.catchBlocks[u.u30()],f.topScope()));break;case 94:case 93:popNameInto(p,g.getMultiname(u.u30()),m),p.push(f.topScope().findScopeProperty(m,93===x,!1));break;case 96:popNameInto(p,g.getMultiname(u.u30()),m),p.push(f.topScope().findScopeProperty(m,!0,!1).axGetProperty(m));break;case 104:case 97:r=p.pop(),popNameInto(p,g.getMultiname(u.u30()),m),_.box(p.pop()).axSetProperty(m,r,104,t);break;case 102:popNameInto(p,g.getMultiname(u.u30()),m),p[p.length-1]=_.box(p[p.length-1]).axGetProperty(m);break;case 106:popNameInto(p,g.getMultiname(u.u30()),m),p[p.length-1]=_.box(p[p.length-1]).axDeleteProperty(m);break;case 4:popNameInto(p,g.getMultiname(u.u30()),m),p[p.length-1]=_.box(p[p.length-1]).axGetSuper(m,e);break;case 5:r=p.pop(),popNameInto(p,g.getMultiname(u.u30()),m),_.box(p.pop()).axSetSuper(m,e,r);break;case 98:p.push(d[u.u30()]);break;case 99:d[u.u30()]=p.pop();break;case 100:p.push(e.global.object);break;case 101:p.push(f.get(u.code[u.pc++]));break;case 108:p[p.length-1]=_.box(p[p.length-1]).axGetSlot(u.u30());break;case 109:r=p.pop(),_.box(p.pop()).axSetSlot(u.u30(),r);break;case 110:p[p.length-1]=e.global.object.axGetSlot(u.u30());break;case 111:r=p.pop(),e.global.object.axSetSlot(u.u30(),r);break;case 114:p[p.length-1]=escapeAttributeValue(p[p.length-1]);break;case 113:p[p.length-1]=escapeElementValue(_,p[p.length-1]);break;case 131:case 115:p[p.length-1]|=0;break;case 136:case 116:p[p.length-1]>>>=0;break;case 132:case 117:p[p.length-1]=+p[p.length-1];break;case 129:case 118:p[p.length-1]=!!p[p.length-1];break;case 133:p[p.length-1]=axCoerceString$3(p[p.length-1]);break;case 112:p[p.length-1]=axConvertString(p[p.length-1]);break;case 120:p[p.length-1]=axCheckFilter(_,p[p.length-1]);break;case 128:popNameInto(p,g.getMultiname(u.u30()),m),p[p.length-1]=f.topScope().getScopeProperty(m,!0,!1).axCoerce(p[p.length-1]);break;case 130:break;case 134:popNameInto(p,g.getMultiname(u.u30()),m),p[p.length-1]=f.topScope().getScopeProperty(m,!0,!1).axAsType(p[p.length-1]);break;case 135:p[p.length-2]=p.pop().axAsType(p[p.length-1]);break;case 137:n=p[p.length-1],p[p.length-1]=null==n?null:n;break;case 144:p[p.length-1]=-p[p.length-1];break;case 145:++p[p.length-1];break;case 146:++d[u.u30()];break;case 147:--p[p.length-1];break;case 148:--d[u.u30()];break;case 149:p[p.length-1]=axTypeOf(p[p.length-1],_);break;case 150:p[p.length-1]=!p[p.length-1];break;case 151:p[p.length-1]=~p[p.length-1];break;case 160:a=p.pop(),s=p[p.length-1],p[p.length-1]="number"==typeof s&&"number"==typeof a?s+a:axAdd(s,a,_);break;case 161:p[p.length-2]-=p.pop();break;case 162:p[p.length-2]*=p.pop();break;case 163:p[p.length-2]/=p.pop();break;case 164:p[p.length-2]%=p.pop();break;case 165:p[p.length-2]<<=p.pop();break;case 166:p[p.length-2]>>=p.pop();break;case 167:p[p.length-2]>>>=p.pop();break;case 168:p[p.length-2]&=p.pop();break;case 169:p[p.length-2]|=p.pop();break;case 170:p[p.length-2]^=p.pop();break;case 171:p[p.length-2]=axEquals(p[p.length-2],p.pop(),_);break;case 172:p[p.length-2]=p[p.length-2]===p.pop();break;case 173:p[p.length-2]=p[p.length-2]<p.pop();break;case 174:p[p.length-2]=p[p.length-2]<=p.pop();break;case 175:p[p.length-2]=p[p.length-2]>p.pop();break;case 176:p[p.length-2]=p[p.length-2]>=p.pop();break;case 177:p[p.length-2]=p.pop().axIsInstanceOf(p[p.length-1]);break;case 178:popNameInto(p,g.getMultiname(u.u30()),m),p[p.length-1]=f.topScope().findScopeProperty(m,!0,!1).axIsType(p[p.length-1]);break;case 179:p[p.length-2]=p.pop().axIsType(p[p.length-1]);break;case 180:o=_.box(p.pop());var w=p[p.length-1];p[p.length-1]=w&&w.axClass===_.AXQName?o.axHasProperty(w.name):o.axHasPublicProperty(w);break;case 192:p[p.length-1]=1+(0|p[p.length-1]);break;case 193:p[p.length-1]=(0|p[p.length-1])-1;break;case 194:d[h=u.u30()]=1+(0|d[h]);break;case 195:d[h=u.u30()]=(0|d[h])-1;break;case 196:p[p.length-1]=-(0|p[p.length-1]);break;case 197:p[p.length-2]=(0|p[p.length-2])+(0|p.pop())|0;break;case 198:p[p.length-2]=(0|p[p.length-2])-(0|p.pop())|0;break;case 199:p[p.length-2]=(0|p[p.length-2])*(0|p.pop())|0;break;case 208:p.push(d[0]);break;case 209:p.push(d[1]);break;case 210:p.push(d[2]);break;case 211:p.push(d[3]);break;case 212:d[0]=p.pop();break;case 213:d[1]=p.pop();break;case 214:d[2]=p.pop();break;case 215:d[3]=p.pop();break;case 6:f.topScope().defaultNamespace=internNamespace(0,g.getString(u.u30()));break;case 7:f.topScope().defaultNamespace=internNamespace(0,p.pop());break;case 239:u.pc++,u.u30(),u.pc++,u.u30();break;case 240:case 241:u.u30();break;case 2:case 1:break;default:notImplemented(getBytecodeName(x))}}catch(t){isValidASValue(t)||(t=createValidException(_,t,x,r,o,s,a,m,b+1));var D=u.body.catchBlocks;for(C=0;C<D.length;C++){var M=D[C];if(u.pc>=M.start&&u.pc<=M.end){var O=M.getType();if(!O||u.app.getClass(O).axIsType(t)){p.length=0,p.push(t),f.clear(),u.pc=M.target;continue t}}}throw scopeStacks.length--,t}}}function createValidException(t,e,i,r,n,o,s,a,l){var h,c=e instanceof Error&&"string"==typeof e.name&&"string"==typeof e.message;if(c)if(e instanceof RangeError||"InternalError"===e.name){var u=Object.create(t.AXError.tPrototype);if(u._errorID=1023,"allocation size overflow"===e.message)return u.$Bgmessage="allocation size overflow",u;if(e.message.indexOf("recursion")>-1||e.message.indexOf("call stack size exceeded")>-1)return u.$Bgmessage="Stack overflow occurred",scopeStacks.length=l,u}else if(e instanceof TypeError){if(e.message.indexOf("convert")>-1&&(e.message.indexOf("to primitive")>-1||e.message.indexOf("to string")>-1))return t.createError("TypeError",Errors$1.ConvertToPrimitiveError,"value");if("Conversion to Array failed"===e.message)return t.createError("TypeError",Errors$1.CheckTypeFailedError,"value","Array")}var p=!1;switch(i){case 65:if(!r||!r.axApply)return t.createError("TypeError",Errors$1.CallOfNonFunctionError,"value");break;case 66:if(!n||!n.axConstruct)return t.createError("TypeError",Errors$1.ConstructOfNonFunctionError);break;case 88:if(!r||!t.AXClass.axIsType(r))return t.createError("VerifyError",Errors$1.InvalidBaseClassError);break;case 78:case 73:p=!0;case 70:case 79:case 76:case 74:case 69:if(null===n)return t.createError("TypeError",Errors$1.ConvertNullToObjectError);if(void 0===n)return t.createError("TypeError",Errors$1.ConvertUndefinedToObjectError);if(!(n.axResolveMultiname(a)in n)){var d=p?n.axClass.superClass:n.axClass;return d.classInfo.instanceInfo.isSealed()?t.createError("ReferenceError",Errors$1.ReadSealedError,a.name,d.name.toFQNString(!1)):t.createError("TypeError",p?Errors$1.ConstructOfNonFunctionError:Errors$1.CallOfNonFunctionError,a.name)}if(c&&"RangeError"===e.name&&(e.message.indexOf("arguments array passed")>-1||e.message.indexOf("call stack size")>-1))return t.createError("RangeError",Errors$1.StackOverflowError);break;case 4:p=!0;case 102:if(null===n)return t.createError("TypeError",Errors$1.ConvertNullToObjectError);if(void 0===n)return t.createError("TypeError",Errors$1.ConvertUndefinedToObjectError);break;case 104:case 97:if(null===n)return t.createError("TypeError",Errors$1.ConvertNullToObjectError);if(void 0===n)return t.createError("TypeError",Errors$1.ConvertUndefinedToObjectError);var f=n.axResolveMultiname(a);if(f in n&&!1===getPropertyDescriptor(n,f).writable)return t.createError("ReferenceError",Errors$1.ConstWriteError,f,n.axClass.name.name);break;case 177:if(!n||!n.axIsInstanceOf)return t.createError("TypeError",Errors$1.CantUseInstanceofOnNonObjectError);break;case 134:case 135:if(n&&!n.axAsType)return t.createError("TypeError",Errors$1.ConvertNullToObjectError);case 178:case 179:if(null===n)return t.createError("TypeError",Errors$1.ConvertNullToObjectError);if(void 0===n)return t.createError("TypeError",Errors$1.ConvertUndefinedToObjectError);if(!n.axIsType)return t.createError("TypeError",Errors$1.IsTypeMustBeClassError);break;case 128:if(!n)return t.createError("ReferenceError",Errors$1.ClassNotFoundError,a.toFQNString(!1));break;case 180:if(null===n)return t.createError("TypeError",Errors$1.ConvertNullToObjectError);if(void 0===n)return t.createError("TypeError",Errors$1.ConvertUndefinedToObjectError);break;case 19:case 20:case 171:if(typeof o!=typeof s&&("object"==typeof o&&o&&"object"!=typeof s||"object"==typeof s&&s&&"object"!=typeof o))return t.createError("TypeError",Errors$1.ConvertToPrimitiveError,"Object");break;default:if(!e||"string"!=typeof e.message||"string"!=typeof e.stack||"string"!=typeof e.name)break;h=e.message;var _,g=0===(_=e.stack.split("\n"))[0].indexOf("at ")?_[0].substr(3):_[0];switch(e.name){case"TypeError":if(0===g.indexOf("AXBasePrototype_valueOf")||0===g.indexOf("AXBasePrototype_toString"))return t.createError("TypeError",Errors$1.CallOfNonFunctionError,"value")}}h="Uncaught VM-internal exception during op "+getBytecodeName(i)+": ";try{h+=e.toString(),_=e.stack}catch(t){h+="[Failed to stringify exception]"}t.player;return console.error(h,"\n",_),t.createError("Error",Errors$1.InternalErrorIV)}var nativeFunctions=ObjectUtilities.createMap();function wrapJSGlobalFunction(t){return function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];return t.apply(jsGlobal,i)}}function getCurrentABC(){return 0===scopeStacks.length?null:scopeStacks[scopeStacks.length-1].topScope().global.object.scriptInfo.abc}function createNullOrUndefinedDescription(t,e){return{__proto__:t.objectPrototype,$Bgname:void 0===e?"void":"null",$BgisDynamic:!1,$BgisFinal:!0,$BgisStatic:!1,$Bgtraits:{__proto__:t.objectPrototype,$Bgvariables:null,$Bgaccessors:null,$Bgmetadata:t.createArray([]),$Bgconstructor:null,$Bginterfaces:t.createArray([]),$Bgmethods:null,$Bgbases:t.createArray([])}}}function describeTypeJSON(t,e,i){var r=(0|e)===e,n=isNullOrUndefined$1(e);if(512&i&&(n||r))return null;if(n)return createNullOrUndefinedDescription(t,e);if(e.sec&&(t=e.sec),e=t.box(e),t.AXFunction.axIsType(e))if(t.AXMethodClosure.axIsType(e)){if(512&i)return null}else if("receiver"in e)return null;var o=e.hasOwnProperty("classInfo")?e:e.axClass,s=o===e&&!(512&i),a=o.classInfo,l=t.createObject();return l.$Bgname=r?"int":a.instanceInfo.getName().toFQNString(!0),l.$BgisDynamic=s||!(1&a.instanceInfo.flags),l.$BgisFinal=s||!!(2&a.instanceInfo.flags),l.$BgisStatic=s,256&i&&(l.$Bgtraits=addTraits(o,a,s,i)),l}var tmpName=new Multiname(null,0,7,[Namespace.PUBLIC],null,null,!0),tmpAttr=new Multiname(null,0,13,[Namespace.PUBLIC],null,null,!0);function describeType(t,e,i){tmpName.name="XML";var r=t.application.getClass(tmpName),n=describeTypeJSON(t,e,i),o=r.Create("<type/>");tmpAttr.name="name",o.setProperty(tmpAttr,n.$Bgname);var s=n.$Bgtraits.$Bgbases.value;s.length&&(tmpAttr.name="base",o.setProperty(tmpAttr,s[0])),tmpAttr.name="isDynamic",o.setProperty(tmpAttr,n.$BgisDynamic.toString()),tmpAttr.name="isFinal",o.setProperty(tmpAttr,n.$BgisFinal.toString()),tmpAttr.name="isStatic",o.setProperty(tmpAttr,n.$BgisStatic.toString()),describeTraits(o,n.$Bgtraits);var a=describeTypeJSON(t,e,512|i);if(a){var l=r.Create("<factory/>");tmpAttr.name="type",l.setProperty(tmpAttr,a.$Bgname),describeTraits(l,a.$Bgtraits)&&o.appendChild(l)}return o}function describeTraits(t,e){for(var i=0,r=e.$Bgbases&&e.$Bgbases.value,n=0;r&&n<r.length;n++){var o=r[n],s=t.sec.AXXML.Create('<extendsClass type="'+escapeAttributeValue(o)+'"/>');t.appendChild(s),i++}var a=e.$Bginterfaces&&e.$Bginterfaces.value;for(n=0;a&&n<a.length;n++){var s=t.sec.AXXML.Create('<implementsInterface type="'+escapeAttributeValue(a[n])+'"/>');t.appendChild(s),i++}null!==e.$Bgconstructor&&(describeParams(s=t.sec.AXXML.Create("<constructor/>"),e.$Bgconstructor),t.appendChild(s),i++);var l=e.$Bgvariables&&e.$Bgvariables.value;for(n=0;l&&n<l.length;n++){var h=l[n],c="readonly"===h.$Bgaccess?"constant":"variable";finishTraitDescription(h,s=t.sec.AXXML.Create("<"+c+' name="'+escapeAttributeValue(h.$Bgname)+'" type="'+h.$Bgtype+'"/>'),t),i++}var u=e.$Bgaccessors&&e.$Bgaccessors.value;for(n=0;u&&n<u.length;n++){var p=u[n];finishTraitDescription(p,s=t.sec.AXXML.Create('<accessor name="'+escapeAttributeValue(p.$Bgname)+'" access="'+p.$Bgaccess+'" type="'+escapeAttributeValue(p.$Bgtype)+'" declaredBy="'+escapeAttributeValue(p.$BgdeclaredBy)+'"/>'),t),i++}var d=e.$Bgmethods&&e.$Bgmethods.value;for(n=0;d&&n<d.length;n++){var f=d[n];describeParams(s=t.sec.AXXML.Create('<method name="'+escapeAttributeValue(f.$Bgname)+'" declaredBy="'+escapeAttributeValue(f.$BgdeclaredBy)+'" returnType="'+escapeAttributeValue(f.$BgreturnType)+'"/>'),f.$Bgparameters.value),finishTraitDescription(f,s,t),i++}return describeMetadataXML(t,e.$Bgmetadata),i>0}function finishTraitDescription(t,e,i){null!==t.$Bguri&&(tmpAttr.name="uri",e.setProperty(tmpAttr,t.$Bguri)),null!==t.$Bgmetadata&&describeMetadataXML(e,t.$Bgmetadata),i.appendChild(e)}function describeParams(t,e){if(e)for(var i=0;i<e.length;i++){var r=e[i],n=t.sec.AXXML.Create('<parameter index="'+(i+1)+'" type="'+escapeAttributeValue(r.$Bgtype)+'" optional="'+r.$Bgoptional+'"/>');t.appendChild(n)}}function describeMetadataXML(t,e){if(e)for(var i=e.value,r=0;r<i.length;r++){for(var n=i[r],o=t.sec.AXXML.Create('<metadata name="'+escapeAttributeValue(n.$Bgname)+'"/>'),s=n.$Bgvalue.value,a=0;a<s.length;a++){var l=s[a],h=t.sec.AXXML.Create('<arg key="'+escapeAttributeValue(l.$Bgkey)+'" value="'+escapeAttributeValue(l.$Bgvalue)+'"/>');o.appendChild(h)}t.appendChild(o)}}function describeMetadataList(t,e){if(!e)return null;for(var i=t.createArray([]),r=0;r<e.length;r++){var n=e[r];"native"!==n.getName()&&i.push(describeMetadata(t,n))}return i}function describeMetadata(t,e){var i=t.createObject();i.$Bgname=e.name;var r=[];i.$Bgvalue=t.createArray(r);for(var n=0;n<e.keys.length;n++){var o=t.createObject();o.$Bgvalue=e.getValueAt(n),o.$Bgkey=e.getKeyAt(n),r.push(o)}return i}function addTraits(t,e,i,r){var n=t.sec,o=2&r,s=32&r&&!i,a=n.createObject(),l=a.$Bgvariables=8&r?n.createArray([]):null,h=a.$Bgaccessors=16&r?n.createArray([]):null,c=null;if(64&r&&!i){var u=e.trait.getMetadata();u&&(c=describeMetadataList(n,u))}if(a.$Bgmetadata=c||n.createArray([]),a.$Bgconstructor=null,4&r){if(a.$Bginterfaces=n.createArray([]),!i){var p=a.$Bginterfaces.value;t.classInfo.instanceInfo.getInterfaces(t).forEach((function(t){return p.push(t.name.toFQNString(!0))}))}}else a.$Bginterfaces=null;for(var d=a.$Bgmethods=s?n.createArray([]):null,f=a.$Bgbases=o?n.createArray([]):null,_=Object.create(null),g=Object.create(null),m=Object.create(null),y=!1,v=e.instanceInfo.isInterface();t;){var b=t.classInfo.instanceInfo.getName().toFQNString(!0);if(o&&y&&!i?f.push(b):y=!0,1024&r&&t===n.AXObject)break;A(n,i?t.classInfo.traits.traits:t.classInfo.instanceInfo.traits.traits,v),t=t.superClass}if(i){if(16&r){var x=n.createObject();x.$Bgname="prototype",x.$Bgtype="*",x.$Bgaccess="readonly",x.$Bgmetadata=null,x.$Bguri=null,x.$BgdeclaredBy="Class",h.push(x)}o&&(f.pop(),f.push("Class","Object"),t=n.AXClass)}function A(t,e,n){for(var o=0;o<e.length;o++){var a=e[o],c=a.getName(),u=c.namespace;if(n||!(!u.isPublic()&&!u.uri||1&r&&u.uri)){var p=n?c.name:c.toFQNString(!0);if(g[p]===m[p]){if(!_[p]){var f=t.createObject();_[p]=f;var y=a.getMetadata();switch(a.kind){case 6:case 0:if(!(8&r))continue;f.$Bgname=p,f.$Bguri=u.reflectedURI;var v=a.getTypeName();f.$Bgtype=v?v.toFQNString(!0):"*",f.$Bgaccess="readwrite",f.$Bgmetadata=64&r?describeMetadataList(t,y):null,l.push(f);break;case 1:if(!s)continue;var x=a.getMethodInfo().getType();f.$BgreturnType=x?x.name.toFQNString(!0):"*",f.$Bgmetadata=64&r?describeMetadataList(t,y):null,f.$Bgname=p,f.$Bguri=u.reflectedURI;for(var A=f.$Bgparameters=t.createArray([]),E=a.getMethodInfo().parameters,S=0;S<E.length;S++){var T=E[S],P=t.createObject();P.$Bgtype=T.type?T.getType().toFQNString(!0):"*",P.$Bgoptional="value"in T,A.push(P)}f.$BgdeclaredBy=b,d.push(f);break;case 2:case 3:if(!(16&r)||i)continue;if(f.$Bgname=p,2===a.kind){x=a.getMethodInfo().getType();f.$Bgtype=x?x.name.toFQNString(!0):"*",g[p]=f}else{var C=a.getMethodInfo().parameters[0].getType();f.$Bgtype=C?C.toFQNString(!0):"*",m[p]=f}f.$Bgaccess=2===a.kind?"readonly":"writeonly",f.$Bgmetadata=64&r?describeMetadataList(t,y):null,f.$Bguri=u.reflectedURI,f.$BgdeclaredBy=b,h.push(f)}}}else if((f=_[p]).$Bgaccess="readwrite",2===a.kind){var w=a.getMethodInfo().getType();f.$Bgtype=w?w.name.toFQNString(!0):"*"}}}}return d&&0!==d.value.length||(a.$Bgmethods=null),l&&0!==l.value.length||(a.$Bgvariables=null),a}var Natives={print:function(t,e,i,r,n,o){var s=Array.prototype.slice.call(arguments,1);1==s.length?console.log("%c Trace from SWF:","color: DodgerBlue",s[0]):console.log("%c Trace from SWF:","color: DodgerBlue",s)},debugBreak:function(t){},bugzilla:function(t,e){switch(e){case 574600:return!0}return!1},decodeURI:function(t,e){try{return jsGlobal.decodeURI(e)}catch(e){t.throwError("URIError",Errors$1.InvalidURIError,"decodeURI")}},decodeURIComponent:function(t,e){try{return jsGlobal.decodeURIComponent(e)}catch(e){t.throwError("URIError",Errors$1.InvalidURIError,"decodeURIComponent")}},encodeURI:function(t,e){try{return jsGlobal.encodeURI(e)}catch(e){t.throwError("URIError",Errors$1.InvalidURIError,"encodeURI")}},encodeURIComponent:function(t,e){try{return jsGlobal.encodeURIComponent(e)}catch(e){t.throwError("URIError",Errors$1.InvalidURIError,"encodeURIComponent")}},isNaN:wrapJSGlobalFunction(jsGlobal.isNaN),isFinite:wrapJSGlobalFunction(jsGlobal.isFinite),parseInt:wrapJSGlobalFunction(jsGlobal.parseInt),parseFloat:wrapJSGlobalFunction(jsGlobal.parseFloat),escape:wrapJSGlobalFunction(jsGlobal.escape),unescape:wrapJSGlobalFunction(jsGlobal.unescape),isXMLName:function(){return!1},notImplemented:wrapJSGlobalFunction(notImplemented),getQualifiedClassName:function(t,e){switch(typeof e){case"undefined":return"void";case"object":return null===e?"null":e.classInfo.instanceInfo.name.toFQNString(!0);case"number":return(0|e)===e?"int":"Number";case"string":return"String";case"boolean":return"Boolean"}},getQualifiedSuperclassName:function(t,e){if(isNullOrUndefined(e))return"null";var i=(e=t.box(e)).sec.AXClass.axIsType(e)?e.superClass:e.axClass.superClass;return this.getQualifiedClassName(t,i)},getDefinitionByName:function(t,e){e=axCoerceString$3(e).replace("::",".");var i=Multiname.FromFQNString(e,0);return getCurrentABC().env.app.getClass(i)},describeType:function(t,e,i){return console.log("describeType not implemented"),describeType(t,e,i)},describeTypeJSON:function(t,e,i){return console.log("describeTypeJSON not implemented"),null},getArgv:function(){return null}};function getNative(t){for(var e=t.split("."),i=Natives,r=0,n=e.length;r<n;r++)i=i&&i[e[r]];return i||(i=nativeFunctions[t]),i}var builtinNativeClasses=ObjectUtilities.createMap(),nativeClasses=ObjectUtilities.createMap(),nativeClassLoaderNames=[];function getNativesForTrait(t){var e,i=null;if(t.holder instanceof InstanceInfo)i=t.holder.getClassName(),e=[(r=builtinNativeClasses[i]||nativeClasses[i]).prototype],r.instanceNatives&&pushMany(e,r.instanceNatives);else if(t.holder instanceof ClassInfo){var r;i=t.holder.instanceInfo.getClassName(),e=[r=builtinNativeClasses[i]||nativeClasses[i]],r.classNatives&&pushMany(e,r.classNatives)}return e}function getMethodOrAccessorNative(t){for(var e=getNativesForTrait(t),i=t.getName().name,r=0;r<e.length;r++){var n=e[r],o=i;if(!hasOwnProperty(n,i)&&hasOwnProperty(n,"native_"+i)&&(o="native_"+i),hasOwnProperty(n,o)){var s;if(t.isAccessor()){var a=Object.getOwnPropertyDescriptor(n,o);s=t.isGetter()?a.get:a.set}else s=n[o];return s}}return warning("No native method for: "+t.holder+" "+t+", make sure you've got the static keyword for static methods."),null}function createMethodForTrait(t,e){if(t.method)return t.method;var i,r=t.getMethodInfo();if(32&r.flags){var n=r.getNativeMetadata();if(n||t.holder instanceof ScriptInfo){if(n)i=getNative(n.getValueAt(0));else{var o=t.getName();i=getNative(o.uri+"."+o.name)}i=createGlobalNative(i,e.object.sec)}else i=getMethodOrAccessorNative(t)}else i=interpret(r,e,null);return t.method=i,i.methodInfo=r,i.methodInfo=r,i}var Traits=function(){function t(t){this.traits=t,this._resolved=!1,this.multinames={}}return t.prototype.resolve=function(){if(!this._resolved){for(var t=0;t<this.traits.length;t++)this.traits[t].resolve();this._resolved=!0}},t.prototype.attachHolder=function(t){for(var e=0;e<this.traits.length;e++)this.traits[e].holder=t},t.prototype.trace=function(t){void 0===t&&(t=new IndentingWriter),this.resolve(),this.traits.forEach((function(e){return t.writeLn(e.toString())}))},t.prototype.indexOf=function(t){for(var e=t.name,i=t.namespaces,r=this.traits,n=0;n<r.length;n++){var o=r[n].name;if(o.name===e)for(var s=o.namespaces[0],a=0;a<i.length;a++)if(s===i[a])return n}return-1},t.prototype.getTrait=function(t){var e=this.multinames[t.id];if(void 0===e){var i=this.indexOf(t);e=i>=0?this.traits[i]:this,this.multinames[t.id]=e}return e===this?null:e},t.prototype.resolveRuntimeTraits=function(t,e,i){this.resolve();for(var r=Object.create(t?t.protectedNsMappings:null),n=new RuntimeTraits(t,e,r),o=0;o<this.traits.length;o++){var s=this.traits[o],a=s.name,l=new RuntimeTraitInfo(a,s.kind,s.abc);1===a.namespaces[0].type&&(n.protectedNsMappings[a.name]&&(l.name=n.protectedNsMappings[a.name].name),n.protectedNsMappings[a.name]=l);var h=n.addTrait(l);switch(s.kind){case 1:var c=createMethodForTrait(s,i);l.value=c;break;case 2:l.get=createMethodForTrait(s,i),h&&h.set&&(l.set=h.set,l.kind=7);break;case 3:l.set=createMethodForTrait(s,i),h&&h.get&&(l.get=h.get,l.kind=7);break;case 0:case 6:case 4:l.writable=!0;var u=s;l.slot=u.slot,l.value=u.getDefaultValue(),l.typeName=u.typeName,n.addSlotTrait(l)}}return n},t}();function getTRAITName(t){return String(t)}var TraitInfo=function(){function t(t,e,i){this.abc=t,this.kind=e,this.name=i,this.metadata=null,this.holder=null}return t.prototype.getMetadata=function(){if(!this.metadata)return null;if(this.metadata instanceof Uint32Array){for(var t=new Array(this.metadata.length),e=0;e<this.metadata.length;e++)t[e]=this.abc.getMetadataInfo(this.metadata[e]);this.metadata=t}return this.metadata},t.prototype.getName=function(){return this.name},t.prototype.resolve=function(){"number"==typeof this.name&&(this.name=this.abc.getMultiname(this.name))},t.prototype.toString=function(){return getTRAITName(this.kind)+" "+this.name},t.prototype.toFlashlogString=function(){return this.resolve(),this.getName().toFlashlogString()},t.prototype.isConst=function(){return 6===this.kind},t.prototype.isSlot=function(){return 0===this.kind},t.prototype.isMethod=function(){return 1===this.kind},t.prototype.isGetter=function(){return 2===this.kind},t.prototype.isSetter=function(){return 3===this.kind},t.prototype.isAccessor=function(){return 2===this.kind||3===this.kind},t.prototype.isMethodOrAccessor=function(){return this.isAccessor()||1===this.kind},t}(),typeDefaultValues={__proto__:null,$BgNumber:NaN,$Bgint:0,$Bguint:0,$BgBoolean:!1},SlotTraitInfo=function(t){function e(e,i,r,n,o,s,a){var l=t.call(this,e,i,r)||this;return l.slot=n,l.typeName=o,l.defaultValueKind=s,l.defaultValueIndex=a,l}return __extends(e,t),e.prototype.resolve=function(){t.prototype.resolve.call(this),"number"==typeof this.typeName&&(this.typeName=this.abc.getMultiname(this.typeName))},e.prototype.getTypeName=function(){return this.resolve(),this.typeName},e.prototype.getDefaultValue=function(){if(-1===this.defaultValueKind){if(null===this.typeName)return;var t=typeDefaultValues[this.typeName.getMangledName()];return void 0===t?null:t}return this.abc.getConstant(this.defaultValueKind,this.defaultValueIndex)},e}(TraitInfo),MethodTraitInfo=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r)||this;return o.methodInfo=n,o.method=null,o}return __extends(e,t),e.prototype.getMethodInfo=function(){return this.methodInfo},e.prototype.resolve=function(){t.prototype.resolve.call(this),"number"==typeof this.methodInfo&&(this.methodInfo=this.abc.getMethodInfo(this.methodInfo))},e}(TraitInfo),ClassTraitInfo=function(t){function e(e,i,r,n,o){var s=t.call(this,e,i,r,n,0,0,-1)||this;return s.classInfo=o,s}return __extends(e,t),e}(SlotTraitInfo),ExceptionInfo=function(){function t(t,e,i,r,n,o){this.abc=t,this.start=e,this.end=i,this.target=r,this.type=n,this.varName=o,this.catchPrototype=null,this._traits=null}return t.prototype.getType=function(){return"number"==typeof this.type&&(this.type=this.abc.getMultiname(this.type)),this.type},t.prototype.getTraits=function(){if(!this._traits){var t=[];this.varName&&t.push(new SlotTraitInfo(this.abc,0,this.varName,1,this.type,0,0)),this._traits=new Traits(t),this._traits.resolve()}return this._traits},t}(),textDecoder=null;"undefined"!=typeof TextDecoder&&(textDecoder=new TextDecoder);var AbcStream=function(){function t(t){this._bytes=t,this._view=new DataView(t.buffer,t.byteOffset),this._position=0}return t._getResultBuffer=function(e){return(!t._resultBuffer||t._resultBuffer.length<e)&&(t._resultBuffer=new Uint32Array(2*e)),t._resultBuffer},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),t.prototype.remaining=function(){return this._bytes.length-this._position},t.prototype.seek=function(t){this._position=t},t.prototype.advance=function(t){this._position+=t},t.prototype.readU8=function(){return this._bytes[this._position++]},t.prototype.readU8s=function(t){var e=new Uint8Array(t);return e.set(this._bytes.subarray(this._position,this._position+t),0),this._position+=t,e},t.prototype.viewU8s=function(t){var e=this._bytes.subarray(this._position,this._position+t);return this._position+=t,e},t.prototype.readS8=function(){return this._bytes[this._position++]<<24>>24},t.prototype.readU32=function(){return this.readS32()>>>0},t.prototype.readU30=function(){var t=this.readU32();return t},t.prototype.readU30Unsafe=function(){return this.readU32()},t.prototype.readS16=function(){return this.readU30Unsafe()<<16>>16},t.prototype.readS32=function(){var t=this.readU8();return 128&t&&16384&(t=127&t|this.readU8()<<7)&&2097152&(t=16383&t|this.readU8()<<14)&&268435456&(t=2097151&t|this.readU8()<<21)&&(t=268435455&t|this.readU8()<<28,t&=4294967295),t},t.prototype.readWord=function(){var t=this._view.getUint32(this._position,!0);return this._position+=4,t},t.prototype.readS24=function(){return(this.readU8()|this.readU8()<<8|this.readU8()<<16)<<8>>8},t.prototype.readDouble=function(){var t=this._view.getFloat64(this._position,!0);return this._position+=8,t},t.prototype.readUTFString=function(e){if(textDecoder){var i=this._position;return this._position+=e,textDecoder.decode(this._bytes.subarray(i,i+e))}for(var r=this._position,n=r+e,o=this._bytes,s=0,a=t._getResultBuffer(2*e);r<n;){var l=o[r++];if(l<=127)a[s++]=l;else if(l>=192){var h=0;l<224?h=(31&l)<<6|63&o[r++]:l<240?h=(15&l)<<12|(63&o[r++])<<6|63&o[r++]:(h=((7&l)<<18|(63&o[r++])<<12|(63&o[r++])<<6|63&o[r++])-65536,a[s++]=55296+((1047552&h)>>>10),h=56320+(1023&h)),a[s++]=h}}return this._position=r,StringUtilities.fromCharCodeArray(a.subarray(0,s))},t._resultBuffer=new Uint32Array(256),t}(),ABCFile=function(){function t(t,e){this._buffer=e,this.env=t,this._stream=new AbcStream(e),this._checkMagic(),this._parseConstantPool(),this._parseNamespaces(),this._parseNamespaceSets(),this._parseMultinames(),this._parseMethodInfos(),this._parseMetaData(),this._parseInstanceAndClassInfos(),this._parseScriptInfos(),this._parseMethodBodyInfos()}return Object.defineProperty(t.prototype,"applicationDomain",{get:function(){return this.env.app},enumerable:!0,configurable:!0}),t.prototype._parseConstantPool=function(){this._parseNumericConstants(),this._parseStringConstants()},t.prototype._parseNumericConstants=function(){var t=0,e=this._stream;t=e.readU30();var i=new Int32Array(t);i[0]=0;for(var r=1;r<t;r++)i[r]=e.readS32();this.ints=i,t=e.readU30();var n=new Uint32Array(t);n[0]=0;for(r=1;r<t;r++)n[r]=e.readS32();this.uints=n,t=e.readU30();var o=new Float64Array(t);o[0]=NaN;for(r=1;r<t;r++)o[r]=e.readDouble();this.doubles=o},t.prototype._parseStringConstants=function(){var t,e=this._stream;t=e.readU30(),this._strings=new Array(t),this._strings[0]=null;var i=this._stringOffsets=new Uint32Array(t);i[0]=-1;for(var r=1;r<t;r++)i[r]=e.position,e.advance(e.readU30())},t.prototype._parseNamespaces=function(){var t=this._stream,e=t.readU30();this._namespaces=new Array(e);var i=this._namespaceOffsets=new Uint32Array(e);i[0]=-1;for(var r=1;r<e;r++)i[r]=t.position,t.readU8(),t.readU30()},t.prototype._parseNamespaceSets=function(){var t=this._stream,e=t.readU30();this._namespaceSets=new Array(e);var i=this._namespaceSetOffsets=new Uint32Array(e);i[0]=-1;for(var r=1;r<e;r++){i[r]=t.position;for(var n=t.readU30(),o=0;o<n;o++)t.readU30()}},t.prototype._consumeMultiname=function(){var t=this._stream,e=t.readU8();switch(e){case 7:case 13:t.readU30(),t.readU30();break;case 15:case 16:t.readU30();break;case 17:case 18:break;case 9:case 14:t.readU30(),t.readU30();break;case 27:case 28:t.readU30();break;case 29:t.readU32();t.readU32();t.readU32();break;default:unexpected(e)}},t.prototype._parseMultinames=function(){var t=this._stream,e=t.readU30();this._multinames=new Array(e);var i=this._multinameOffsets=new Uint32Array(e);i[0]=-1;for(var r=1;r<e;r++)i[r]=t.position,this._consumeMultiname()},t.prototype._parseMultiname=function(t){var e,i=this._stream,r=!1,n=!0,o=0,s=i.readU8();switch(s){case 7:case 13:e=i.readU30(),n=!1,o=i.readU30();break;case 15:case 16:r=!0,o=i.readU30();break;case 17:case 18:r=!0;break;case 9:case 14:o=i.readU30(),e=i.readU30();break;case 27:case 28:e=i.readU30();break;case 29:var a=i.readU32(),l=(i.readU32(),this.getMultiname(i.readU32())),h=this.getMultiname(a);return new Multiname(this,t,s,h.namespaces,h.name,l);default:unexpected()}var c,u=0===o?null:this.getString(o);return c=r?null:n?this.getNamespaceSet(e):[this.getNamespace(e)],new Multiname(this,t,s,c,u)},t.prototype._checkMagic=function(){var t=this._stream.readWord();t<3014671&&this.env.app.sec.throwError("VerifierError",Errors$1.InvalidMagicError,t>>16,65535&t)},t.prototype._checkForDuplicateStrings=function(){for(var t=[],e=0;e<this._strings.length;e++)t.push(this.getString(e));t.sort();for(e=0;e<t.length-1;e++)if(t[e]===t[e+1])return!0;return!1},t.prototype.getString=function(t){var e=this._strings[t];if(void 0===e){var i=this._stream;i.seek(this._stringOffsets[t]);var r=i.readU30();e=this._strings[t]=i.readUTFString(r)}return e},t.prototype.getMultiname=function(t){if((t<0||t>=this._multinameOffsets.length)&&this.applicationDomain.sec.throwError("VerifierError",Errors$1.CpoolIndexRangeError,t,this._multinameOffsets.length),0===t)return null;var e=this._multinames[t];void 0===e&&(this._stream.seek(this._multinameOffsets[t]),e=this._multinames[t]=this._parseMultiname(t));return e},t.prototype.getNamespace=function(t){if((t<0||t>=this._namespaceOffsets.length)&&this.applicationDomain.sec.throwError("VerifierError",Errors$1.CpoolIndexRangeError,t,this._namespaceOffsets.length),0===t)return Namespace.PUBLIC;var e=this._namespaces[t];if(void 0!==e)return e;var i=this._stream;i.seek(this._namespaceOffsets[t]);var r,n=i.readU8(),o=i.readU30(),s=o?this.getString(o):void 0;switch(n){case 8:case 22:r=0;break;case 23:r=2;break;case 24:r=1;break;case 25:r=4;break;case 26:r=5;break;case 5:r=3;break;default:this.applicationDomain.sec.throwError("VerifierError",Errors$1.CpoolEntryWrongTypeError,t)}return s&&3!==r||void 0===s&&(s=""),e=this._namespaces[t]=internNamespace(r,s)},t.prototype.getNamespaceSet=function(t){if((t<0||t>=this._namespaceSets.length)&&this.applicationDomain.sec.throwError("VerifierError",Errors$1.CpoolIndexRangeError,t,this._namespaceSets.length),0===t)return null;var e=this._namespaceSets[t];if(void 0===e){var i=this._stream,r=this._namespaceSetOffsets[t];i.seek(r);var n=i.readU30();e=this._namespaceSets[t]=new Array(n),r=i.position;for(var o=0;o<n;o++){i.seek(r);var s=i.readU30();r=i.position,e[o]=this.getNamespace(s)}}return e},t.prototype._parseMethodInfos=function(){var t=this._stream,e=t.readU30();this._methods=new Array(e),this._methodInfoOffsets=new Uint32Array(e);for(var i=0;i<e;++i)this._methodInfoOffsets[i]=t.position,this._consumeMethodInfo()},t.prototype._consumeMethodInfo=function(){var t=this._stream,e=t.readU30();t.readU30();t.position;for(var i=0;i<e;i++)t.readU30();t.readU30();var r=t.readU8();if(8&r)for(i=e-t.readU30();i<e;i++)t.readU30(),t.readU8();if(128&r)for(i=0;i<e;i++)t.readU30()},t.prototype._parseMethodInfo=function(t){for(var e=this._stream,i=e.readU30(),r=e.readU30(),n=(e.position,new Array(i)),o=0;o<i;o++)n[o]=new ParameterInfo(this,e.readU30(),0,-1,-1);var s=e.readU30(),a=e.readU8(),l=0;if(8&a)for(o=i-(l=e.readU30());o<i;o++)n[o].optionalValueIndex=e.readU30(),n[o].optionalValueKind=e.readU8();if(128&a)for(o=0;o<i;o++)n[o].name=e.readU30();return new MethodInfo(this,t,s,r,n,l,a)},t.prototype.getMethodInfo=function(t){var e=this._methods[t];void 0===e&&(this._stream.seek(this._methodInfoOffsets[t]),e=this._methods[t]=this._parseMethodInfo(t));return e},t.prototype.getMethodBodyInfo=function(t){return this._methodBodies[t]},t.prototype._parseMetaData=function(){var t=this._stream,e=t.readU30();this._metadata=new Array(e);for(var i=this._metadataInfoOffsets=new Uint32Array(e),r=0;r<e;r++){i[r]=t.position,t.readU30();for(var n=t.readU30(),o=0;o<n;o++)t.readU30(),t.readU30()}},t.prototype.getMetadataInfo=function(t){var e=this._metadata[t];if(void 0===e){var i=this._stream;i.seek(this._metadataInfoOffsets[t]);for(var r=i.readU30(),n=i.readU30(),o=new Uint32Array(n),s=0;s<n;s++)o[s]=i.readU30();var a=new Uint32Array(n);for(s=0;s<n;s++)a[s]=i.readU30();e=this._metadata[t]=new MetadataInfo(this,r,o,a)}return e},t.prototype._parseInstanceAndClassInfos=function(){for(var t=this._stream,e=t.readU30(),i=this.instances=new Array(e),r=0;r<e;r++)i[r]=this._parseInstanceInfo();this._parseClassInfos(e);var n=t.position;for(r=0;r<e;r++)i[r].classInfo=this.classes[r];t.seek(n)},t.prototype._parseInstanceInfo=function(){var t=this._stream,e=t.readU30(),i=t.readU30(),r=t.readU8(),n=0;8&r&&(n=t.readU30());for(var o=t.readU30(),s=[],a=0;a<o;a++)s[a]=t.readU30();var l=t.readU30(),h=this._parseTraits(),c=new InstanceInfo(this,e,i,r,n,s,l,h);return h.attachHolder(c),c},t.prototype._parseTraits=function(){for(var t=this._stream.readU30(),e=[],i=0;i<t;i++)e.push(this._parseTrait());return new Traits(e)},t.prototype._parseTrait=function(){var t,e=this._stream,i=e.readU30(),r=e.readU8(),n=15&r,o=r>>4&15;switch(n){case 0:case 6:var s=e.readU30(),a=e.readU30(),l=e.readU30(),h=-1;0!==l&&(h=e.readU8()),t=new SlotTraitInfo(this,n,i,s,a,h,l);break;case 1:case 2:case 3:e.readU30();var c=e.readU30(),u=e.position,p=this.getMethodInfo(c);t=p.trait=new MethodTraitInfo(this,n,i,p),e.seek(u);break;case 4:s=e.readU30();var d=this.classes[e.readU30()];t=d.trait=new ClassTraitInfo(this,n,i,s,d);break;default:this.applicationDomain.sec.throwError("VerifierError",Errors$1.UnsupportedTraitsKindError,n)}if(4&o){for(var f=e.readU30(),_=new Uint32Array(f),g=0;g<f;g++)_[g]=e.readU30();t.metadata=_}return t},t.prototype._parseClassInfos=function(t){this._stream;for(var e=this.classes=new Array(t),i=0;i<t;i++)e[i]=this._parseClassInfo(i)},t.prototype._parseClassInfo=function(t){var e=this._stream.readU30(),i=this._parseTraits(),r=new ClassInfo(this,this.instances[t],e,i);return i.attachHolder(r),r},t.prototype._parseScriptInfos=function(){for(var t=this._stream.readU30(),e=this.scripts=new Array(t),i=0;i<t;i++)e[i]=this._parseScriptInfo()},t.prototype._parseScriptInfo=function(){var t=this._stream.readU30(),e=this._parseTraits(),i=new ScriptInfo(this,t,e);return e.attachHolder(i),i},t.prototype._parseMethodBodyInfos=function(){for(var t=this._stream,e=this._methodBodies=new Array(this._methods.length),i=t.readU30(),r=(t.position,0);r<i;r++){for(var n=t.readU30(),o=t.readU30(),s=t.readU30(),a=t.readU30(),l=t.readU30(),h=t.viewU8s(t.readU30()),c=t.readU30(),u=new Array(c),p=0;p<c;++p)u[p]=this._parseException();var d=this._parseTraits();e[n]=new MethodBodyInfo(o,s,a,l,h,u,d),d.attachHolder(e[n])}},t.prototype._parseException=function(){var t=this._stream,e=t.readU30(),i=t.readU30(),r=t.readU30(),n=t.readU30(),o=t.readU30();return new ExceptionInfo(this,e,i,r,n,o)},t.prototype.getConstant=function(t,e){switch(t){case 3:return this.ints[e];case 4:return this.uints[e];case 6:return this.doubles[e];case 1:return this.getString(e);case 11:return!0;case 10:return!1;case 12:return null;case 0:return;case 8:case 23:return this.getNamespace(e);case 7:case 14:case 15:case 16:case 17:case 18:case 19:case 20:return this.getMultiname(e);case 2:warning("TODO: CONSTANT.Float may be deprecated?")}},t.prototype.stress=function(){for(var t=0;t<this._multinames.length;t++)this.getMultiname(t);for(t=0;t<this._namespaceSets.length;t++)this.getNamespaceSet(t);for(t=0;t<this._namespaces.length;t++)this.getNamespace(t);for(t=0;t<this._strings.length;t++)this.getString(t)},t.prototype.trace=function(t){t.writeLn("Multinames: "+this._multinames.length),t.indent();for(var e=0;e<this._multinames.length;e++)t.writeLn(e+" "+this.getMultiname(e));t.outdent(),t.writeLn("Namespace Sets: "+this._namespaceSets.length),t.indent();for(e=0;e<this._namespaceSets.length;e++)t.writeLn(e+" "+this.getNamespaceSet(e));t.outdent(),t.writeLn("Namespaces: "+this._namespaces.length),t.indent();for(e=0;e<this._namespaces.length;e++)t.writeLn(e+" "+this.getNamespace(e));t.outdent(),t.writeLn("Strings: "+this._strings.length),t.indent();for(e=0;e<this._strings.length;e++)t.writeLn(e+" "+this.getString(e));t.outdent(),t.writeLn("MethodInfos: "+this._methods.length),t.indent();for(e=0;e<this._methods.length;e++)t.writeLn(e+" "+this.getMethodInfo(e)),this._methodBodies[e]&&this._methodBodies[e].trace(t);t.outdent(),t.writeLn("InstanceInfos: "+this.instances.length),t.indent();for(e=0;e<this.instances.length;e++)t.writeLn(e+" "+this.instances[e]),this.instances[e].trace(t);t.outdent(),t.writeLn("ClassInfos: "+this.classes.length),t.indent();for(e=0;e<this.classes.length;e++)this.classes[e].trace(t);t.outdent(),t.writeLn("ScriptInfos: "+this.scripts.length),t.indent();for(e=0;e<this.scripts.length;e++)this.scripts[e].trace(t);t.outdent()},t}(),FlashSceneGraphFactory=function(t){function e(e){var i=t.call(this)||this;return i.imageStore={},i.url="",i._sec=e,i}return __extends(e,t),e.prototype.executeABCBytes=function(t){for(var e=0;e<t.length;e++){var i=t[e],r=new ABCFile({app:this._sec.application,url:""},i.data);i.flags?this._sec.application.loadABC(r):this._sec.application.loadAndExecuteABC(r)}return null},e.prototype.createSprite=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),!i||!this._sec)throw"no symbol provided";var r=null;r=i.className?this._sec.application.getClass(Multiname.FromFQNString(i.className,0)):this._sec.flash.display.Sprite.axClass,i.symbolClass=r;var n=constructClassFromSymbol(i,r);return n.adaptee=new Sprite(e),n.adaptee.fileurl=this.url,n.adaptee},e.prototype.createDisplayObjectContainer=function(t){return(new this._sec.flash.display.DisplayObjectContainer).adaptee},e.prototype.createBinarySymbol=function(t){void 0===t&&(t=null),this._sec.application.addBinarySymbol(t)},e.prototype.createMovieClip=function(t,e){if(void 0===e&&(e=null),!e||!this._sec)throw"no symbol provided";var i=null;e.className?(i=this._sec.application.getClass(Multiname.FromFQNString(e.className,0)))._symbol=e:i=this._sec.flash.display.MovieClip.axClass,e.symbolClass=i;var r=constructClassFromSymbol(e,this._sec.flash.display.MovieClip.axClass);return r.adaptee=new MovieClip,e.timeline=r.adaptee.timeline,r.adaptee.timelineMC=!0,r.adaptee.fileurl=this.url,r.adaptee},e.prototype.createTextField=function(t){void 0===t&&(t=null);var e=null;e=t.className?this._sec.application.getClass(Multiname.FromFQNString(t.className,0)):this._sec.flash.text.TextField.axClass,t.symbolClass=e;var i=constructClassFromSymbol(t,e);return i.axInitializer(),i.adaptee.fileurl=this.url,i.adaptee},e.prototype.createBillboard=function(t,e){return new Bitmap(t.style.image.adapter).adaptee},e.prototype.createImage2D=function(t,e,i,r,n,o){return void 0===i&&(i=!0),void 0===r&&(r=null),new BitmapData(t,e,i,r).adaptee},e}(DefaultSceneGraphFactory),UncaughtErrorEvents=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(EventDispatcher$1),Loader$1=function(t){function e(e){var i=t.call(this)||this;return i._onLoaderProgressDelegate=function(t){return i.onLoaderProgress(t)},i._onLoaderCompleteDelegate=function(t){return i.onLoaderComplete(t)},i._onAssetCompleteDelegate=function(t){return i.onAssetComplete(t)},i._parser=e,i._loaderInfo=new i.sec.flash.display.LoaderInfo,i._loaderInfo._loader=i,i._factory=new FlashSceneGraphFactory(null),i}return __extends(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uncaughtErrorEvents",{get:function(){return this._uncaughtErrorEvents||(this._uncaughtErrorEvents=new UncaughtErrorEvents),this._uncaughtErrorEvents},enumerable:!0,configurable:!0}),e.prototype.onLoaderProgress=function(t){var e=new ProgressEvent(ProgressEvent.PROGRESS,null,null,t.urlLoader.bytesLoaded,t.urlLoader.bytesTotal);e.currentTarget=this._loaderInfo,this._loaderInfo.dispatchEventInternal(e)},e.prototype.onLoaderComplete=function(t){var e=new Event(Event.COMPLETE);e.currentTarget=this._loaderInfo,this._loaderInfo.dispatchEventInternal(e),this._loader.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoaderCompleteDelegate),this._loader.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),this._loader=null},e.prototype.onAssetComplete=function(t){var e=t.asset;if(e.isAsset(TextField))this._loaderContext.applicationDomain.addDefinition(e.name,e);else if(e.isAsset(SceneImage2D)||e.isAsset(BitmapImage2D))this._loaderContext.applicationDomain.addDefinition(e.name,e),this._isImage&&this._adaptee.addChild(new Bitmap(e.adapter).adaptee);else if(e.isAsset(WaveAudio))this._loaderContext.applicationDomain.addAudioDefinition(e.name,e);else if(e.isAsset(Font))this._loaderContext.applicationDomain.addFontDefinition(e.name,e);else if(e.isAsset(Sprite))this._loaderContext.applicationDomain.addDefinition(e.name,e);else if(e.isAsset(MovieClip)){if(this._loaderContext.applicationDomain.addDefinition(e.name,e),"Scene 1"==e.name||e.isAVMScene){var i=e.adapter.clone();i.loaderInfo=this.loaderInfo,i.adaptee.reset(),this.addChild(i)}}else e.isAsset(Graphics)||console.log("loaded unhandled asset-type")},e.prototype.addChild=function(e){return t.prototype.addChild.call(this,e)},e.prototype.addChildAt=function(t,e){return this.sec.throwError("IllegalOperationError",Errors$1.InvalidLoaderMethodError),null},e.prototype.removeChild=function(t){return this.sec.throwError("IllegalOperationError",Errors$1.InvalidLoaderMethodError),null},e.prototype.removeChildAt=function(t){return this.sec.throwError("IllegalOperationError",Errors$1.InvalidLoaderMethodError),null},e.prototype.setChildIndex=function(t,e){this.sec.throwError("IllegalOperationError",Errors$1.InvalidLoaderMethodError)},e.prototype.load=function(t,e){void 0===e&&(e=null),console.log("start loading the url:"+t.url);var i=t.url.substr(-3);this._isImage="jpg"==i||"png"==i,this._loaderContext=e,this._loaderInfo.applicationDomain=e.applicationDomain,this._loader=new Loader,this._loader.addEventListener(URLLoaderEvent.LOAD_PROGRESS,this._onLoaderProgressDelegate),this._loader.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoaderCompleteDelegate),this._loader.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),this._loader.load(t.adaptee,null,null,this._isImage?new Image2DParser(this._factory):this._parser)},e.prototype.loadData=function(t,e){void 0===e&&(e=null),console.log("start loading swfdata",t),this._loaderContext=e,this._loaderInfo.applicationDomain=e.applicationDomain,this._loader=new Loader,this._loader.addEventListener(URLLoaderEvent.LOAD_PROGRESS,this._onLoaderProgressDelegate),this._loader.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoaderCompleteDelegate),this._loader.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),this._loader.loadData(t,null,null,null,this._parser)},e.prototype.loadBytes=function(t,e){this.close(),console.log("80pro todo: loader.loadBytes")},e.prototype.close=function(){console.log("80pro todo: loader.close")},e.prototype._unload=function(t,e){console.log("80pro todo: loader._unload")},e.prototype.unload=function(){this._unload(!1,!1)},e.prototype.unloadAndStop=function(t){this._unload(!0,!!t)},Object.defineProperty(e.prototype,"contentLoaderInfo",{get:function(){return this._loaderInfo},set:function(t){this._loaderInfo=t},enumerable:!0,configurable:!0}),e}(DisplayObjectContainer$1),TextEvent=function(t){function e(e,i,r,n){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n="");var o=t.call(this,e,i,r)||this;return o._text=n,o}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return console.log("clone not implemented yet in flash/IOErrorEvent"),null},e.prototype.toString=function(){return console.log("toString not implemented yet in flash/IOErrorEvent"),""},e.LINK="link",e.TEXT_INPUT="textInput",e.NETWORK_ERROR="networkError",e.VERIFY_ERROR="verifyError",e}(Event),ErrorEvent=function(t){function e(e,i,r,n,o){return void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=""),t.call(this,e,i,r,n)||this}return __extends(e,t),Object.defineProperty(e.prototype,"errorID",{get:function(){return console.log("errorID not implemented yet in flash/ErrorEvent"),0},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return console.log("clone not implemented yet in flash/ErrorEvent"),null},e.prototype.toString=function(){return console.log("toString not implemented yet in flash/ErrorEvent"),""},e.ERROR="error",e}(TextEvent),IOErrorEvent=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.clone=function(){return console.log("clone not implemented yet in flash/IOErrorEvent"),null},e.prototype.toString=function(){return console.log("toString not implemented yet in flash/IOErrorEvent"),""},e.IO_ERROR="ioError",e.DISK_ERROR="diskError",e.NETWORK_ERROR="networkError",e.VERIFY_ERROR="verifyError",e}(ErrorEvent),LoaderInfo$2=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this,e)||this;return i.eventMappingExtern[Event.COMPLETE]="LoaderInfo:Event.COMPLETE",i.eventMappingExtern[ProgressEvent.PROGRESS]="LoaderInfo:ProgressEvent.PROGRESS",i.eventMappingDummys[Event.UNLOAD]="LoaderInfo:Event.UNLOAD",i.eventMappingDummys[IOErrorEvent.IO_ERROR]="LoaderInfo:IOErrorEvent.IO_ERROR",i.eventMappingDummys[Event.OPEN]="LoaderInfo:Event.OPEN",i.eventMappingDummys[Event.INIT]="LoaderInfo:Event.INIT",i.adaptee=new LoaderInfo,i}return __extends(e,t),Object.defineProperty(e.prototype,"actionScriptVersion",{get:function(){return console.log("actionScriptVersion not implemented yet in flash/LoaderInfo"),0},enumerable:!0,configurable:!0}),e.prototype.getSymbolById=function(t){},Object.defineProperty(e.prototype,"applicationDomain",{get:function(){return this._applicationDomain},set:function(t){this._applicationDomain=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytes",{get:function(){return console.log("bytes not implemented yet in flash/LoaderInfo"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return this.adaptee.bytesLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return this.adaptee.bytesTotal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childAllowsParent",{get:function(){return console.log("childAllowsParent not implemented yet in flash/LoaderInfo"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childSandboxBridge",{get:function(){return console.log("childSandboxBridge not implemented yet in flash/LoaderInfo"),null},set:function(t){console.log("childSandboxBridge not implemented yet in flash/LoaderInfo")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._loader&&this._loader.content?this._loader.content:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return this.adaptee.contentType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameRate",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return console.log("height not implemented yet in flash/LoaderInfo"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isURLInaccessible",{get:function(){return console.log("isURLInaccessible not implemented yet in flash/LoaderInfo"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loader",{get:function(){return this._loader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaderURL",{get:function(){return console.log("loaderURL not implemented yet in flash/LoaderInfo"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return console.log("parameters not implemented yet in flash/LoaderInfo"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAllowsChild",{get:function(){return console.log("parentAllowsChild not implemented yet in flash/LoaderInfo"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentSandboxBridge",{get:function(){return console.log("parentSandboxBridge not implemented yet in flash/LoaderInfo"),null},set:function(t){console.log("parentSandboxBridge not implemented yet in flash/LoaderInfo")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sameDomain",{get:function(){return console.log("sameDomain not implemented yet in flash/LoaderInfo"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sharedEvents",{get:function(){return console.log("sharedEvents not implemented yet in flash/LoaderInfo"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"swfVersion",{get:function(){return console.log("swfVersion not implemented yet in flash/LoaderInfo"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uncaughtErrorEvents",{get:function(){return console.log("uncaughtErrorEvents not implemented yet in flash/LoaderInfo"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this.adaptee&&this.adaptee.url?this.adaptee.url:""},set:function(t){console.log("url not implemented yet in flash/LoaderInfo")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return console.log("width not implemented yet in flash/LoaderInfo"),0},enumerable:!0,configurable:!0}),e.prototype.dispatchEventInternal=function(e){return t.prototype.dispatchEvent.call(this,e)},e.prototype.dispatchEvent=function(t){throw"LoaderInfo.dispatchEvent should never be called"},e.getLoaderInfoByDefinition=function(t){return console.log("getLoaderInfoByDefinition not implemented yet in flash/LoaderInfo"),null},e}(EventDispatcher$1),Sprite$1=function(t){function e(){var e=t.call(this)||this;return e._graphics=new e.sec.flash.display.Graphics(e._adaptee.graphics),e}return __extends(e,t),e.getNewSprite=function(t){if(e._sprites.length){var i=e._sprites.pop();return i.adaptee=t,i}return new e},e.prototype.initAdapter=function(){this.executeConstructor&&FrameScriptManager.queue_as3_constructor(this.adaptee)},e.prototype.createAdaptee=function(){var t=Sprite.getNewSprite();return t.timelineMC=!0,t.reset(),this.noReset=!0,t},e.prototype.registerScriptObject=function(t){t.name&&(this[t.name]=t._adapter?t.adapter:t,this.axSetPublicProperty(t.name,t.adapter))},e.prototype.unregisterScriptObject=function(t){delete this[t.name],t.isAsset(MovieClip)&&t.removeButtonListeners()},e.prototype.clearPropsDic=function(){this.$Bg__setPropDict.map=new WeakMap},e.prototype.clone=function(){if(!this._symbol)throw"_symbol not defined when cloning movieclip";var t=constructClassFromSymbol(this._symbol,this._symbol.symbolClass),e=new Sprite;return this.adaptee.copyTo(e),t.adaptee=e,t._stage=this.activeStage,t.executeConstructor=function(){var e=t.getQueuedEvents();if(t.axInitializer(),e)for(var i=0;i<e.length;i++)t.dispatchEvent(e[i])},t.adaptee.graphics=this.graphics,t},e.prototype.dispose=function(){this.disposeValues()},Object.defineProperty(e.prototype,"buttonMode",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropTarget",{get:function(){return console.log("dropTarget not implemented yet in flash/Sprite"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"graphics",{get:function(){return this._graphics},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitArea",{get:function(){return console.log("hitArea not implemented yet in flash/Sprite"),null},set:function(t){console.log("hitArea not implemented yet in flash/Sprite")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"soundTransform",{get:function(){return console.log("soundTransform not implemented yet in flash/Sprite"),null},set:function(t){console.log("soundTransform not implemented yet in flash/Sprite")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useHandCursor",{get:function(){return this.adaptee._useHandCursor},set:function(t){this.adaptee._useHandCursor=t},enumerable:!0,configurable:!0}),e.prototype.startDrag=function(t,e){console.log("startDrag not implemented yet in flash/Sprite")},e.prototype.startTouchDrag=function(t,e,i){console.log("startTouchDrag not implemented yet in flash/Sprite")},e.prototype.stopDrag=function(){console.log("startTouchDrag not implemented yet in flash/Sprite")},e.prototype.stopTouchDrag=function(t){console.log("startTouchDrag not implemented yet in flash/Sprite")},e._sprites=new Array,e}(DisplayObjectContainer$1),includeString="",MovieClip$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.applySymbol=function(){},e.getNewMovieClip=function(t){if(e._movieClips.length){var i=e._movieClips.pop();return i.adaptee=t,i}return new e},e.prototype._getAbsFrameNumber=function(t,e){return 0},e.prototype.callFrame=function(t){},e.prototype._callFrame=function(t){},e.prototype.addScript=function(t){return t},e.prototype.executeScript=function(t){if(t)for(var e=0;e<t.length;e++)t[e].setReceiver(this),t[e].axCall(this)},e.prototype.initAdapter=function(){this.executeConstructor&&FrameScriptManager.queue_as3_constructor(this.adaptee)},e.prototype.createAdaptee=function(){var t=MovieClip.getNewMovieClip();return t.timelineMC=!0,t.reset(),this.noReset=!0,t},e.prototype.clearPropsDic=function(){this.$Bg__setPropDict.map=new WeakMap},e.prototype.evalScript=function(t){var e=document.createElement("script");e.text="var __framescript__ = function() {\n"+includeString+t+"\n}";var i=document.scripts[0];i.parentNode.insertBefore(e,i).parentNode.removeChild(e);var r=__framescript__;return window.__framescript__=null,r},e.prototype.freeFromScript=function(){t.prototype.freeFromScript.call(this)},e.prototype.clone=function(){if(!this._symbol)throw"_symbol not defined when cloning movieclip";var t=constructClassFromSymbol(this._symbol,this._symbol.symbolClass),e=new MovieClip(this.adaptee.timeline);return this.adaptee.copyTo(e),t.adaptee=e,t._stage=this.activeStage,t.executeConstructor=function(){t.adaptee.timeline.resetScripts();var e=t.getQueuedEvents();if(t.axInitializer(),e)for(var i=0;i<e.length;i++)t.dispatchEvent(e[i])},this._symbol.className&&(t.adaptee.cloneForEveryInstance=!0),t.adaptee.timeline&&this._symbol.className&&"BadIcecreamFont"==this._symbol.className&&(t.adaptee.adaptee.timeline.frame_command_indices=[t.adaptee.timeline.frame_command_indices[0]],t.adaptee.adaptee.timeline.frame_recipe=[t.adaptee.timeline.frame_recipe[0]],t.adaptee.adaptee.timeline.keyframe_constructframes=[t.adaptee.timeline.keyframe_constructframes[0]],t.adaptee.adaptee.timeline.keyframe_durations=[t.adaptee.timeline.keyframe_durations[0]],t.adaptee.adaptee.timeline.keyframe_firstframes=[t.adaptee.timeline.keyframe_firstframes[0]],t.adaptee.adaptee.timeline.keyframe_indices=[t.adaptee.timeline.keyframe_indices[0]]),t},e.prototype.dispose=function(){this.disposeValues()},Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._adaptee.currentFrameIndex+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameLabel",{get:function(){return this.adaptee.timeline.getCurrentFrameLabel(this.adaptee)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLabel",{get:function(){return this.adaptee.timeline.getCurrentLabel(this.adaptee)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentLabels",{get:function(){return console.log("currentFrameLabel not implemented yet in flash/MovieClip"),[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentScene",{get:function(){return console.log("currentScene not implemented yet in flash/MovieClip"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framesLoaded",{get:function(){return console.log("framesLoaded not implemented yet in flash/MovieClip"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return console.log("isPlaying not implemented yet in flash/MovieClip"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return console.log("scenes not implemented yet in flash/MovieClip"),[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._adaptee.numFrames},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackAsMenu",{get:function(){return console.log("trackAsMenu not implemented yet in flash/MovieClip"),!1},set:function(t){console.log("trackAsMenu not implemented yet in flash/MovieClip")},enumerable:!0,configurable:!0}),e.prototype.addFrameScript=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=arguments.length;1&i&&this.sec.throwError("ArgumentError TooFewArgumentsError",i,i+1);for(var r=0;r<i;r+=2){var n=0|arguments[r],o=arguments[r+1];this.adaptee.timeline.add_framescript(o,n)}},e.prototype.gotoAndPlay=function(t,e){if(null!=t)return"string"==typeof t&&(t=t.toLowerCase(),null==this.adaptee.timeline._labels[t])?(t=parseInt(t),void(isNaN(t)||(this.adaptee.currentFrameIndex=t-1,this.adaptee.play()))):void("number"==typeof t&&t<=0||(this.play(),this._gotoFrame(t),FrameScriptManager.execute_as3_constructors(),this.dispatchStaticBroadCastEvent(Event.FRAME_CONSTRUCTED),FrameScriptManager.execute_queue()))},e.prototype.gotoAndStop=function(t,e){if(null!=t)return"string"==typeof t&&(t=t.toLowerCase(),null==this.adaptee.timeline._labels[t])?(t=parseInt(t),void(isNaN(t)||(this.adaptee.currentFrameIndex=t-1,this.adaptee.stop()))):void("number"==typeof t&&t<=0||(this.stop(),this._gotoFrame(t),FrameScriptManager.execute_as3_constructors(),this.dispatchStaticBroadCastEvent(Event.FRAME_CONSTRUCTED),FrameScriptManager.execute_queue()));this.stop()},e.prototype._gotoFrame=function(t){"string"!=typeof t?"number"==typeof t&&t<=0||(this._adaptee.currentFrameIndex=t-1):this._adaptee.jumpToLabel(t)},e.prototype.nextFrame=function(){console.log("nextFrame not implemented yet in flash/MovieClip")},e.prototype.nextScene=function(){console.log("nextScene not implemented yet in flash/MovieClip")},e.prototype.play=function(){return this._adaptee.play()},e.prototype.prevFrame=function(){this._adaptee.currentFrameIndex>0&&(this._adaptee.currentFrameIndex=this._adaptee.currentFrameIndex-1)},e.prototype.prevScene=function(){console.log("prevScene not implemented yet in flash/MovieClip")},e.prototype.stop=function(){return this._adaptee.stop()},e._movieClips=new Array,e}(Sprite$1),Graphics$1=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._adaptee=e||new Graphics,i._adaptee.adapter=i,i}return __extends(e,t),e.prototype.dispose=function(){},Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),e.FromData=function(t,e){return this.sec.flash.display.Graphics()},e.prototype.clear=function(){this.adaptee.clear()},e.prototype.beginFill=function(t,e){void 0===e&&(e=1),this.adaptee.beginFill(t,e)},e.prototype.beginGradientFill=function(t,e,i,r,n,o,s,a){notImplemented("Graphics.beginGradientFill")},e.prototype.beginBitmapFill=function(t,e,i,r){void 0===e&&(e=null),void 0===i&&(i=!0),void 0===r&&(r=!1),this.adaptee.beginBitmapFill(t.adaptee,e,i,r)},e.prototype.endFill=function(){this.adaptee.endFill()},e.prototype.lineStyle=function(t,e,i,r,n,o,s,a){notImplemented("Graphics.lineStyle")},e.prototype.lineGradientStyle=function(t,e,i,r,n,o,s,a){notImplemented("Graphics.lineGradientStyle")},e.prototype.lineBitmapStyle=function(t,e,i,r){notImplemented("Graphics.lineBitmapStyle")},e.prototype.drawRect=function(t,e,i,r){this.adaptee.drawRect(t,e,i,r)},e.prototype.drawRoundRect=function(t,e,i,r,n,o){this.adaptee.drawRoundRect(t,e,i,r,n,o)},e.prototype.drawRoundRectComplex=function(t,e,i,r,n,o,s,a){this.adaptee.drawRoundRectComplex(t,e,i,r,n,o,s,a)},e.prototype.drawCircle=function(t,e,i){this.adaptee.drawCircle(t,e,i)},e.prototype.drawEllipse=function(t,e,i,r){this.adaptee.drawEllipse(t,e,i,r)},e.prototype.moveTo=function(t,e){this.adaptee.moveTo(t,e)},e.prototype.lineTo=function(t,e){this.adaptee.lineTo(t,e)},e.prototype.curveTo=function(t,e,i,r){this.adaptee.curveTo(t,e,i,r)},e.prototype.cubicCurveTo=function(t,e,i,r,n,o){this.adaptee.cubicCurveTo(t,e,i,r,n,o)},e.prototype.copyFrom=function(t){this.adaptee.copyFrom(t.adaptee)},e.prototype.drawPath=function(t,e,i){notImplemented("Graphics.drawPath")},e.prototype.drawTriangles=function(t,e,i,r){notImplemented("Graphics.drawTriangles")},e.prototype.drawGraphicsData=function(t){notImplemented("Graphics.drawTriangles")},e.classInitializer=null,e}(ASObject$1),SimpleButton$1=function(t){function e(e,i,r,n){return t.call(this)||this}return __extends(e,t),e.prototype.initAdapter=function(){this.executeConstructor&&FrameScriptManager.queue_as3_constructor(this.adaptee)},e.prototype.registerScriptObject=function(t){},e.prototype.unregisterScriptObject=function(t){},Object.defineProperty(e.prototype,"downState",{get:function(){return console.log("downState not implemented yet in flash/SimpleButton"),null},set:function(t){console.log("downState not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return console.log("enabled not implemented yet in flash/SimpleButton"),!1},set:function(t){console.log("enabled not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitTestState",{get:function(){return console.log("hitTestState not implemented yet in flash/SimpleButton"),null},set:function(t){console.log("hitTestState not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overState",{get:function(){return console.log("overState not implemented yet in flash/SimpleButton"),null},set:function(t){console.log("overState not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"soundTransform",{get:function(){return console.log("soundTransform not implemented yet in flash/SimpleButton"),null},set:function(t){console.log("soundTransform not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackAsMenu",{get:function(){return console.log("trackAsMenu not implemented yet in flash/SimpleButton"),!1},set:function(t){console.log("trackAsMenu not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upState",{get:function(){return console.log("upState not implemented yet in flash/SimpleButton"),null},set:function(t){console.log("upState not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useHandCursor",{get:function(){return console.log("useHandCursor not implemented yet in flash/SimpleButton"),!1},set:function(t){console.log("useHandCursor not implemented yet in flash/SimpleButton")},enumerable:!0,configurable:!0}),e}(MovieClip$1),TextField$1=function(t){function e(){var e=t.call(this)||this;return e.adaptee.autoSize=TextFieldAutoSize.NONE,e.adaptee.textFormat.align=TextFormatAlign.CENTER,e.eventMappingDummys[TextEvent.TEXT_INPUT]="TextField:TextEvent.TEXT_INPUT",e.eventMappingDummys[TextEvent.LINK]="TextField:TextEvent.LINK",e.eventMappingDummys[Event.SCROLL]="TextField:Event.SCROLL",e.eventMappingDummys[Event.CHANGE]="TextField:Event.CHANGE",e.eventMappingDummys[Event.TEXT_INTERACTION_MODE_CHANGE]="TextField:Event.TEXT_INTERACTION_MODE_CHANGE",e}return __extends(e,t),e.getNewTextField=function(t){if(void 0===t&&(t=null),e._textFields.length){var i=e._textFields.pop();return i.adaptee=t||TextField.getNewTextField(),i}return new e},e.prototype.createAdaptee=function(){var t=TextField.getNewTextField();return this.noReset=!0,t.reset(),t},e.prototype.initAdapter=function(){this.executeConstructor&&FrameScriptManager.queue_as3_constructor(this.adaptee)},e.prototype.dispatchKeyEvent=function(t,e,i,r){},e.prototype.selectTextField=function(){},e.prototype.clone=function(){var t=constructClassFromSymbol(this._symbol,this._symbol.symbolClass),e=new TextField;return this.adaptee.copyTo(e),t.adaptee=e,t._stage=this.activeStage,t.executeConstructor=function(){t.axInitializer()},t},e.prototype.dispose=function(){this.disposeValues(),e._textFields.push(this)},Object.defineProperty(e.prototype,"alwaysShowSelection",{get:function(){return this._adaptee.alwaysShowSelection},set:function(t){this._adaptee.alwaysShowSelection=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"antiAliasType",{get:function(){return""},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoSize",{get:function(){return this._adaptee.autoSize},set:function(t){this._adaptee.autoSize=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._adaptee.background},set:function(t){this._adaptee.background=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._adaptee.backgroundColor},set:function(t){this._adaptee.backgroundColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"border",{get:function(){return this._adaptee.border},set:function(t){this._adaptee.border=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._adaptee.borderColor},set:function(t){this._adaptee.borderColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomScrollV",{get:function(){throw"bottomScrollV not implemented yet in flash/TextField"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caretIndex",{get:function(){throw"caretIndex not implemented yet in flash/TextField"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"condenseWhite",{get:function(){throw"condenseWhite not implemented yet in flash/TextField"},set:function(t){throw"condenseWhite not implemented yet in flash/TextField"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultTextFormat",{get:function(){return this._adaptee.textFormat.adapter},set:function(t){console.log("todo TextFormat")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayAsPassword",{get:function(){return this._adaptee.displayAsPassword},set:function(t){this._adaptee.displayAsPassword=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"embedFonts",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gridFitType",{get:function(){return""},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"htmlText",{get:function(){return this.adaptee.htmlText},set:function(t){this.adaptee.htmlText=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._adaptee.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxChars",{get:function(){return console.log("maxChars not implemented yet in flash/TextField"),0},set:function(t){console.log("maxChars not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollH",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollV",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseWheelEnabled",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiline",{get:function(){return this._adaptee.multiline},set:function(t){this._adaptee.multiline=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numLines",{get:function(){return console.log("numLines not implemented yet in flash/TextField"),this._adaptee.numLines},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restrict",{get:function(){return this.adaptee.restrict},set:function(t){this.adaptee.restrict=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollH",{get:function(){return console.log("scrollH not implemented yet in flash/TextField"),0},set:function(t){console.log("scrollH not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollV",{get:function(){return console.log("scrollV not implemented yet in flash/TextField"),0},set:function(t){console.log("scrollV not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectable",{get:function(){return!1},set:function(t){this._adaptee.selectable=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedText",{get:function(){return console.log("selectedText not implemented yet in flash/TextField"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionBeginIndex",{get:function(){return console.log("selectionBeginIndex not implemented yet in flash/TextField"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionEndIndex",{get:function(){return console.log("selectionEndIndex not implemented yet in flash/TextField"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sharpness",{get:function(){return console.log("sharpness not implemented yet in flash/TextField"),0},set:function(t){console.log("sharpness not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"styleSheet",{get:function(){return console.log("styleSheet not implemented yet in flash/TextField"),null},set:function(t){console.log("styleSheet not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._adaptee.text},set:function(t){this._adaptee.text=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textColor",{get:function(){return this._adaptee.textColor},set:function(t){this._adaptee.textColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this._adaptee.textHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textInteractionMode",{get:function(){return console.log("textInteractionMode not implemented yet in flash/TextField"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this._adaptee.textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return console.log("thickness not implemented yet in flash/TextField"),0},set:function(t){console.log("thickness not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return console.log("type not implemented yet in flash/TextField"),""},set:function(t){console.log("type not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRichTextClipboard",{get:function(){return console.log("useRichTextClipboard not implemented yet in flash/TextField"),!1},set:function(t){console.log("useRichTextClipboard not implemented yet in flash/TextField")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._adaptee.wordWrap},set:function(t){this._adaptee.wordWrap=t},enumerable:!0,configurable:!0}),e.prototype.appendText=function(t){this._adaptee.appendText(t)},e.prototype.copyRichText=function(){return console.log("copyRichText not implemented yet in flash/TextField"),""},e.prototype.getCharBoundaries=function(t){return console.log("getCharBoundaries not implemented yet in flash/TextField"),null},e.prototype.getCharIndexAtPoint=function(t,e){return console.log("getCharIndexAtPoint not implemented yet in flash/TextField"),0},e.prototype.getFirstCharInParagraph=function(t){return console.log("getFirstCharInParagraph not implemented yet in flash/TextField"),0},e.prototype.getImageReference=function(t){return console.log("getImageReference not implemented yet in flash/TextField"),null},e.prototype.getLineIndexAtPoint=function(t,e){return console.log("getLineIndexAtPoint not implemented yet in flash/TextField"),0},e.prototype.getLineIndexOfChar=function(t){return console.log("getLineIndexOfChar not implemented yet in flash/TextField"),0},e.prototype.getLineLength=function(t){return console.log("getLineLength not implemented yet in flash/TextField"),0},e.prototype.getLineMetrics=function(t){return console.log("getLineMetrics not implemented yet in flash/TextField"),null},e.prototype.getLineOffset=function(t){return console.log("getLineOffset not implemented yet in flash/TextField"),0},e.prototype.getLineText=function(t){return console.log("getLineText not implemented yet in flash/TextField"),""},e.prototype.getParagraphLength=function(t){return console.log("getParagraphLength not implemented yet in flash/TextField"),0},e.prototype.getRawText=function(){return console.log("getRawText not implemented yet in flash/TextField"),""},e.prototype.getTextFormat=function(t,e){return console.log("todo: textformats"),null},e.prototype.getTextRuns=function(t,e){return console.log("getTextRuns not implemented yet in flash/TextField"),[]},e.prototype.getXMLText=function(t,e){return console.log("getXMLText not implemented yet in flash/TextField"),""},e.prototype.insertXMLText=function(t,e,i,r){console.log("insertXMLText not implemented yet in flash/TextField")},e.isFontCompatible=function(t,e){return console.log("isFontCompatible not implemented yet in flash/TextField"),!1},e.prototype.pasteRichText=function(t){return console.log("pasteRichText not implemented yet in flash/TextField"),!1},e.prototype.replaceSelectedText=function(t){console.log("replaceSelectedText not implemented yet in flash/TextField")},e.prototype.replaceText=function(t,e,i){console.log("replaceText not implemented yet in flash/TextField")},e.prototype.setSelection=function(t,e){console.log("setSelection not implemented yet in flash/TextField")},e.prototype.setTextFormat=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=-1),this._adaptee.setTextFormat(t.adaptee,e,i)},e._textFields=new Array,e}(InteractiveObject),Point$1=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=t.call(this)||this;return r._adaptee=e instanceof Point?e:new Point(+e,+i),r}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._adaptee._rawData[0]},set:function(t){this._adaptee._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._adaptee._rawData[1]},set:function(t){this._adaptee._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._adaptee.length},enumerable:!0,configurable:!0}),e.interpolate=function(t,e,i){return new this.sec.flash.geom.Point(Point.interpolate(t.adaptee,e.adaptee,i))},e.distance=function(t,e){return Point.distance(t.adaptee,e.adaptee)},e.polar=function(t,e){return new this.sec.flash.geom.Point(Point.polar(+t,+e))},e.prototype.clone=function(){return new this.sec.flash.geom.Point(this._adaptee.clone())},e.prototype.offset=function(t,e){this._adaptee.offset(t,e)},e.prototype.equals=function(t){return this._adaptee.equals(t.adaptee)},e.prototype.subtract=function(t){return new this.sec.flash.geom.Point(this._adaptee.subtract(t.adaptee))},e.prototype.add=function(t){return new this.sec.flash.geom.Point(this._adaptee.add(t.adaptee))},e.prototype.normalize=function(t){void 0===t&&(t=1),this._adaptee.normalize(+t)},e.prototype.copyFrom=function(t){this._adaptee.copyFrom(t.adaptee)},e.prototype.setTo=function(t,e){this._adaptee.setTo(t,e)},e.prototype.toString=function(){return"(x="+this.x+", y="+this.y+")"},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),KeyboardEvent$2=function(t){function e(e,i,r,n,o,s,a,l,h){return void 0===i&&(i=!0),void 0===r&&(r=!1),t.call(this,e,i,r)||this}return __extends(e,t),Object.defineProperty(e.prototype,"altKey",{get:function(){return this._altKey},set:function(t){this._altKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"charCode",{get:function(){return this._charCode},set:function(t){this._charCode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctrlKey",{get:function(){return this._ctrlKey},set:function(t){this._ctrlKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyCode",{get:function(){return this._keyCode},set:function(t){this._keyCode=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyLocation",{get:function(){return console.log("keyLocation not implemented yet in flash/KeyboardEvent"),0},set:function(t){console.log("keyLocation not implemented yet in flash/KeyboardEvent")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shiftKey",{get:function(){return this._shiftKey},set:function(t){this._shiftKey=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return console.log("clone not implemented yet in flash/KeyboardEvent"),null},e.prototype.toString=function(){return console.log("toString not implemented yet in flash/KeyboardEvent"),""},e.prototype.updateAfterEvent=function(){console.log("updateAfterEvent not implemented yet in flash/KeyboardEvent")},e.KEY_DOWN="keyDown",e.KEY_UP="keyUp",e}(Event),Rectangle$1=function(t){function e(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0);var o=t.call(this)||this;return o._adaptee=e instanceof Rectangle?e:new Rectangle(+e,+i,+r,+n),o}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._adaptee._rawData[3]},set:function(t){this._adaptee._rawData[3]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._adaptee._rawData[2]},set:function(t){this._adaptee._rawData[2]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._adaptee._rawData[0]},set:function(t){this._adaptee._rawData[0]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._adaptee._rawData[1]},set:function(t){this._adaptee._rawData[1]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._adaptee.bottom},set:function(t){this._adaptee.bottom=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new this.sec.flash.geom.Point(this._adaptee.bottomRight)},set:function(t){this.bottom=t.y,this.right=t.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._adaptee.left},set:function(t){this._adaptee.left=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._adaptee.right},set:function(t){this._adaptee.right=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return new this.sec.flash.geom.Point(this._adaptee.size)},set:function(t){this.width=t.x,this.height=t.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._adaptee.top},set:function(t){this._adaptee.top=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new this.sec.flash.geom.Point(this._adaptee.topLeft)},set:function(t){this.top=t.y,this.left=t.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.FromBounds=function(t){var e=t.xMin,i=t.yMin;return new this.sec.flash.geom.Rectangle(e/20,i/20,(t.xMax-e)/20,(t.yMax-i)/20)},e.prototype.clone=function(){return new this.sec.flash.geom.Rectangle(this._adaptee.clone())},e.prototype.isEmpty=function(){return this._adaptee.isEmpty()},e.prototype.setEmpty=function(){return this._adaptee.setEmpty()},e.prototype.inflate=function(t,e){this._adaptee.inflate(+t,+e)},e.prototype.inflatePoint=function(t){this._adaptee.inflatePoint(t.adaptee)},e.prototype.offset=function(t,e){this._adaptee.offset(+t,+e)},e.prototype.offsetPoint=function(t){this._adaptee.offsetPoint(t.adaptee)},e.prototype.contains=function(t,e){return this._adaptee.contains(+t,+e)},e.prototype.containsPoint=function(t){return this._adaptee.containsPoint(t.adaptee)},e.prototype.containsRect=function(t){return this._adaptee.containsRect(t.adaptee)},e.prototype.intersection=function(t){return new this.sec.flash.geom.Rectangle(this._adaptee.intersection(t.adaptee))},e.prototype.intersects=function(t){return this._adaptee.intersects(t.adaptee)},e.prototype.union=function(t){return new this.sec.flash.geom.Rectangle(this._adaptee.union(t.adaptee))},e.prototype.equals=function(t){return this._adaptee.equals(t.adaptee)},e.prototype.copyFrom=function(t){this._adaptee.copyFrom(t.adaptee)},e.prototype.setTo=function(t,e,i,r){this._adaptee.setTo(+t,+e,+i,+r)},e.prototype.toString=function(){return"(x="+this.x+", y="+this.y+", w="+this.width+", h="+this.height+")"},e.prototype.hashCode=function(){var t=0;return t+=20*this.x|0,t*=37,t+=20*this.y|0,t*=37,t+=20*this.width|0,t*=37,t+=20*this.height|0},e.prototype.writeExternal=function(t){t.writeFloat(this.x),t.writeFloat(this.y),t.writeFloat(this.width),t.writeFloat(this.height)},e.prototype.readExternal=function(t){this.x=t.readFloat(),this.y=t.readFloat(),this.width=t.readFloat(),this.height=t.readFloat()},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),Matrix$1=function(t){function e(e,i,r,n,o,s){void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=0);var a=t.call(this)||this;return a._adaptee=e instanceof Matrix?e:new Matrix(+e,+i,+r,+n,+o,+s),a}return __extends(e,t),e.classInitializer=function(){this.FROZEN_IDENTITY_MATRIX=Object.freeze(this.axConstruct([])),this.TEMP_MATRIX=this.axConstruct([])},Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this._adaptee.rawData[0]},set:function(t){this._adaptee.rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._adaptee.rawData[2]},set:function(t){this._adaptee.rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"c",{get:function(){return this._adaptee.rawData[1]},set:function(t){this._adaptee.rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"d",{get:function(){return this._adaptee.rawData[3]},set:function(t){this._adaptee.rawData[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tx",{get:function(){return this._adaptee.rawData[4]},set:function(t){this._adaptee.rawData[4]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ty",{get:function(){return this._adaptee.rawData[5]},set:function(t){this._adaptee.rawData[5]=t},enumerable:!0,configurable:!0}),e.FromUntyped=function(t){return new this.sec.flash.geom.Matrix(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.FromDataBuffer=function(t){return new this.sec.flash.geom.Matrix(t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())},e.prototype.concat=function(t){this._adaptee.concat(t.adaptee)},e.prototype.invert=function(){this._adaptee.invert()},e.prototype.identity=function(){this._adaptee.identity()},e.prototype.createBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this._adaptee.createBox(t,e,i,r,n)},e.prototype.createGradientBox=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),this._adaptee.createGradientBox(t,e,i,r,n)},e.prototype.rotate=function(t){this._adaptee.rotate(t)},e.prototype.translate=function(t,e){this._adaptee.translate(t,e)},e.prototype.scale=function(t,e){this._adaptee.scale(t,e)},e.prototype.deltaTransformPoint=function(t){return new this.sec.flash.geom.Point(this._adaptee.deltaTransformPoint(t.adaptee))},e.prototype.transformPoint=function(t){return new this.sec.flash.geom.Point(this._adaptee.transformPoint(t.adaptee))},e.prototype.copyFrom=function(t){this._adaptee.copyFrom(t.adaptee)},e.prototype.setTo=function(t,e,i,r,n,o){this._adaptee.setTo(t,e,i,r,n,o)},e.prototype.copyRowTo=function(t,e){this._adaptee.copyRowTo(t,e.adaptee)},e.prototype.copyColumnTo=function(t,e){this._adaptee.copyColumnTo(t,e.adaptee)},e.prototype.copyRowFrom=function(t,e){this._adaptee.copyRowFrom(t,e.adaptee)},e.prototype.copyColumnFrom=function(t,e){this._adaptee.copyColumnFrom(t,e.adaptee)},e.prototype.clone=function(){return new this.sec.flash.geom.Matrix(this._adaptee.clone())},e.prototype.toString=function(){var t=this._adaptee.rawData;return"(a="+t[0]+", b="+t[1]+", c="+t[2]+", d="+t[3]+", tx="+t[4]+", ty="+t[5]+")"},e.prototype.writeExternal=function(t){var e=this._adaptee.rawData;t.writeFloat(e[0]),t.writeFloat(e[1]),t.writeFloat(e[2]),t.writeFloat(e[3]),t.writeFloat(e[4]),t.writeFloat(e[5])},e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),ColorTransform$1=function(t){function e(e,i,r,n,o,s,a,l){void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===l&&(l=0);var h=t.call(this)||this;return h._adaptee=e instanceof ColorTransform?e:new ColorTransform(+e,+i,+r,+n,+o,+s,+a,+l),h}return __extends(e,t),e.classInitializer=function(){this.FROZEN_IDENTITY_COLOR_TRANSFORM=Object.freeze(this.axConstruct([])),this.TEMP_COLOR_TRANSFORM=this.axConstruct([])},Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaMultiplier",{get:function(){return this._adaptee._rawData[3]},set:function(t){this._adaptee._rawData[3]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaOffset",{get:function(){return this._adaptee._rawData[7]},set:function(t){this._adaptee._rawData[7]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blueMultiplier",{get:function(){return this._adaptee._rawData[2]},set:function(t){this._adaptee._rawData[2]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blueOffset",{get:function(){return this._adaptee._rawData[6]},set:function(t){this._adaptee._rawData[6]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"greenMultiplier",{get:function(){return this._adaptee._rawData[1]},set:function(t){this._adaptee._rawData[1]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"greenOffset",{get:function(){return this._adaptee._rawData[5]},set:function(t){this._adaptee._rawData[5]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redMultiplier",{get:function(){return this._adaptee._rawData[0]},set:function(t){this._adaptee._rawData[0]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redOffset",{get:function(){return this._adaptee._rawData[4]},set:function(t){this._adaptee._rawData[4]=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._adaptee.color},set:function(t){this._adaptee.color=+t},enumerable:!0,configurable:!0}),e.prototype.concat=function(t){this._adaptee.concat(t.adaptee)},e.prototype.preMultiply=function(t){this._adaptee._rawData[4]+=t.adaptee._rawData[4]*this._adaptee._rawData[0],this._adaptee._rawData[5]+=t.adaptee._rawData[5]*this._adaptee._rawData[1],this._adaptee._rawData[6]+=t.adaptee._rawData[6]*this._adaptee._rawData[2],this._adaptee._rawData[7]+=t.adaptee._rawData[7]*this._adaptee._rawData[3],this._adaptee._rawData[0]*=t.adaptee._rawData[0],this._adaptee._rawData[1]*=t.adaptee._rawData[1],this._adaptee._rawData[2]*=t.adaptee._rawData[2],this._adaptee._rawData[3]*=t.adaptee._rawData[3]},e.prototype.copyFrom=function(t){this._adaptee.copyFrom(t.adaptee)},e.prototype.setTo=function(t,e,i,r,n,o,s,a){this._adaptee._rawData[0]=t,this._adaptee._rawData[1]=e,this._adaptee._rawData[2]=i,this._adaptee._rawData[3]=r,this._adaptee._rawData[4]=n,this._adaptee._rawData[5]=o,this._adaptee._rawData[6]=s,this._adaptee._rawData[7]=a},e.prototype.clone=function(){return new this.sec.flash.geom.ColorTransform(this._adaptee._rawData[0],this._adaptee._rawData[1],this._adaptee._rawData[2],this._adaptee._rawData[3],this._adaptee._rawData[4],this._adaptee._rawData[5],this._adaptee._rawData[6],this._adaptee._rawData[7])},e.prototype.convertToFixedPoint=function(){return this._adaptee._rawData[0]=clampS8U8(this._adaptee._rawData[0]),this._adaptee._rawData[1]=clampS8U8(this._adaptee._rawData[1]),this._adaptee._rawData[2]=clampS8U8(this._adaptee._rawData[2]),this._adaptee._rawData[3]=clampS8U8(this._adaptee._rawData[3]),this._adaptee._rawData[4]=toS16(this._adaptee._rawData[4]),this._adaptee._rawData[5]=toS16(this._adaptee._rawData[5]),this._adaptee._rawData[6]=toS16(this._adaptee._rawData[6]),this._adaptee._rawData[7]=toS16(this._adaptee._rawData[7]),this},e.prototype.dispose=function(){throw new AbstractMethodError},e.prototype.equals=function(t){return this===t||this._adaptee._rawData[0]===t._adaptee._rawData[0]&&this._adaptee._rawData[1]===t._adaptee._rawData[1]&&this._adaptee._rawData[2]===t._adaptee._rawData[2]&&this._adaptee._rawData[3]===t._adaptee._rawData[3]&&this._adaptee._rawData[4]===t._adaptee._rawData[4]&&this._adaptee._rawData[5]===t._adaptee._rawData[5]&&this._adaptee._rawData[6]===t._adaptee._rawData[6]&&this._adaptee._rawData[7]===t._adaptee._rawData[7]},e.prototype.toString=function(){return"(redMultiplier="+this._adaptee._rawData[0]+", greenMultiplier="+this._adaptee._rawData[1]+", blueMultiplier="+this._adaptee._rawData[2]+", alphaMultiplier="+this._adaptee._rawData[3]+", redOffset="+this._adaptee._rawData[4]+", greenOffset="+this._adaptee._rawData[5]+", blueOffset="+this._adaptee._rawData[6]+", alphaOffset="+this._adaptee._rawData[7]+")"},e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1);function checkNullParameter(t,e,i){null==t&&i.throwError("TypeError",Errors$1.NullPointerError,e)}var Transform$1=function(t){function e(e){var i=t.call(this)||this;return e||i.sec.throwError("ArgumentError",Errors$1.NullPointerError,"displayObject"),i._adaptee=e instanceof Transform?e:new Transform,i}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return new this.sec.flash.geom.Matrix(this._adaptee.matrix)},set:function(t){this._adaptee.matrix=t.adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTransform",{get:function(){return new this.sec.flash.geom.ColorTransform(this._adaptee.colorTransform)},set:function(t){this._adaptee.colorTransform=t.adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"concatenatedMatrix",{get:function(){return new this.sec.flash.geom.Matrix(this._adaptee.matrix)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"concatenatedColorTransform",{get:function(){return new this.sec.flash.geom.ColorTransform(this._adaptee.colorTransform)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelBounds",{get:function(){return new this.sec.flash.geom.Rectangle(this._adaptee.pixelBounds)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix3D",{get:function(){return new this.sec.flash.geom.Matrix3D(this._adaptee.matrix3D)},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.getRelativeMatrix3D=function(t){return checkNullParameter(t,"relativeTo",this.sec),new this.sec.flash.geom.Matrix3D(this._adaptee.matrix3D)},Object.defineProperty(e.prototype,"perspectiveProjection",{get:function(){return new PerspectiveProjection},set:function(t){},enumerable:!0,configurable:!0}),e.classInitializer=null,e}(ASObject$1),URLRequest$1=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._adaptee=new URLRequest(e),i}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},set:function(t){this._adaptee=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._adaptee.url},set:function(t){t=axCoerceString$3(t),this._adaptee.url=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._adaptee.data},set:function(t){this._adaptee.data=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this._adaptee.method},set:function(t){this._adaptee.method=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentType",{get:function(){return console.log("TODO: URLRequest.contentType"),""},set:function(t){console.log("TODO: URLRequest.contentType")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestHeaders",{get:function(){return console.log("TODO: URLRequest.requestHeaders"),null},set:function(t){console.log("TODO: URLRequest.requestHeaders")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"digest",{get:function(){return console.log("TODO: URLRequest.digest"),null},set:function(t){console.log("TODO: URLRequest.digest")},enumerable:!0,configurable:!0}),e}(ASObject$1),URLLoader$1=function(t){function e(){var e=t.call(this)||this;return e._adaptee=new URLLoader,e._completeCallbackDelegate=function(t){return e.completeCallback(t)},e._progressCallbackDelegate=function(t){return e.progressCallback(t)},e._loadErrorDelegate=function(t){return e.loadErrorDelegate(t)},e.eventMapping[Event.COMPLETE]={adaptedType:URLLoaderEvent.LOAD_COMPLETE,addListener:e.initListener,removeListener:e.removeListener,callback:e._completeCallbackDelegate},e.eventMapping[ProgressEvent.PROGRESS]={adaptedType:URLLoaderEvent.LOAD_PROGRESS,addListener:e.initListener,removeListener:e.removeListener,callback:e._progressCallbackDelegate},e.eventMapping[IOErrorEvent.IO_ERROR]={adaptedType:URLLoaderEvent.LOAD_ERROR,addListener:e.initListener,removeListener:e.removeListener,callback:e._loadErrorDelegate},e}return __extends(e,t),e.prototype.close=function(){console.log("not mimplemented: URLoader.close")},Object.defineProperty(e.prototype,"data",{get:function(){return this._adaptee.data},enumerable:!0,configurable:!0}),e.prototype.initListener=function(t,e){this._adaptee.addEventListener(t,e)},e.prototype.removeListener=function(t,e){this._adaptee.removeEventListener(t,e)},e.prototype.addEventListener=function(e,i){t.prototype.addEventListener.call(this,e,i)},e.prototype.loadErrorDelegate=function(t){var e=new this.sec.flash.events.IOErrorEvent(IOErrorEvent.IO_ERROR);e.currentTarget=this,this.dispatchEvent(e)},e.prototype.progressCallback=function(t){void 0===t&&(t=null);var e=new this.sec.flash.events.ProgressEvent(ProgressEvent.PROGRESS,null,null,t.urlLoader.bytesLoaded,t.urlLoader.bytesTotal);e.currentTarget=this,this.dispatchEvent(e)},e.prototype.completeCallback=function(t){var e=new this.sec.flash.events.Event(Event.COMPLETE);e.currentTarget=this,e.target=this,this.dispatchEvent(e)},e.prototype.load=function(t){this._adaptee.load(t.adaptee)},e}(EventDispatcher$1);function forEachPublicProperty(t,e,i){for(var r=t.axGetEnumerableKeys(),n=0;n<r.length;n++){var o=r[n],s=t.axGetPublicProperty(o);e.call(i,o,s)}}var AMF3ReferenceTables=function(){this.strings=[],this.objects=[],this.traits=[],this.traitNames=[]},ClassAliases=function(){function t(){this._classMap=new WeakMap,this._nameMap=Object.create(null)}return t.prototype.getAliasByClass=function(t){return this._classMap.get(t)},t.prototype.getClassByAlias=function(t){return this._nameMap[t]},t.prototype.registerClassAlias=function(t,e){this._classMap.set(e,t),this._nameMap[t]=e},t}();function writeString(t,e){if(e.length>65535)throw"AMF short string exceeded";if(!e.length)return t.writeByte(0),void t.writeByte(0);var i=StringUtilities.utf8decode(e);t.writeByte(i.length>>8&255),t.writeByte(255&i.length);for(var r=0;r<i.length;r++)t.writeByte(i[r])}function readString(t){var e=t.readByte()<<8|t.readByte();if(!e)return"";for(var i=new Uint8Array(e),r=0;r<e;r++)i[r]=t.readByte();return StringUtilities.utf8encode(i)}function writeDouble(t,e){var i=new ArrayBuffer(8),r=new DataView(i);r.setFloat64(0,e,!1);for(var n=0;n<i.byteLength;n++)t.writeByte(r.getUint8(n))}function readDouble(t){for(var e=new ArrayBuffer(8),i=new DataView(e),r=0;r<e.byteLength;r++)i.setUint8(r,t.readByte());return i.getFloat64(0,!1)}var AMF0=function(){function t(){}return t.write=function(t,e){switch(typeof e){case"boolean":t.writeByte(1),t.writeByte(e?1:0);break;case"number":t.writeByte(0),writeDouble(t,e);break;case"undefined":t.writeByte(6);break;case"string":t.writeByte(2),writeString(t,e);break;case"object":var i=e;if(null===i)t.writeByte(5);else if(t.sec.AXArray.axIsType(i)){var r=i.value;t.writeByte(8),t.writeByte(r.length>>>24&255),t.writeByte(r.length>>16&255),t.writeByte(r.length>>8&255),t.writeByte(255&r.length),forEachPublicProperty(i,(function(e,i){writeString(t,e),this.write(t,i)}),this),t.writeByte(0),t.writeByte(0),t.writeByte(9)}else t.writeByte(3),forEachPublicProperty(i,(function(e,i){writeString(t,e),this.write(t,i)}),this),t.writeByte(0),t.writeByte(0),t.writeByte(9);return}},t.read=function(t){var e=t.readByte();switch(e){case 0:return readDouble(t);case 1:return!!t.readByte();case 2:return readString(t);case 3:for(var i=t.sec.createObject();;){if(!(r=readString(t)).length)break;i.axSetPublicProperty(r,this.read(t))}if(9!==t.readByte())throw"AMF0 End marker is not found";return i;case 5:return null;case 6:return;case 8:for((n=t.sec.createArray([])).length=t.readByte()<<24|t.readByte()<<16|t.readByte()<<8|t.readByte();;){var r;if(!(r=readString(t)).length)break;n.axSetPublicProperty(r,this.read(t))}if(9!==t.readByte())throw"AMF0 End marker is not found";return n;case 10:for(var n,o=(n=t.sec.createArray([])).length=t.readByte()<<24|t.readByte()<<16|t.readByte()<<8|t.readByte(),s=0;s<o;s++)n.axSetPublicProperty(s,this.read(t));return n;case 17:return readAMF3Value(t,new AMF3ReferenceTables);default:throw"AMF0 Unknown marker "+e}},t}();function readU29(t){var e=t.readByte();if(0==(128&e))return e;var i=t.readByte();if(0==(128&i))return(127&e)<<7|i;var r=t.readByte();return 0==(128&r)?(127&e)<<14|(127&i)<<7|r:(127&e)<<22|(127&i)<<15|(127&r)<<8|t.readByte()}function writeU29(t,e){if(0==(4294967168&e))t.writeByte(127&e);else if(0==(4294950912&e))t.writeByte(128|e>>7&127),t.writeByte(127&e);else if(0==(4292870144&e))t.writeByte(128|e>>14&127),t.writeByte(128|e>>7&127),t.writeByte(127&e);else{if(0!=(3221225472&e))throw"AMF3 U29 range";t.writeByte(128|e>>22&127),t.writeByte(128|e>>15&127),t.writeByte(128|e>>8&127),t.writeByte(255&e)}}function readUTF8(t,e){var i=readU29(t);if(1===i)return"";var r=e.strings;if(0==(1&i))return r[i>>1];for(var n=i>>1,o=new Uint8Array(n),s=0;s<n;s++)o[s]=t.readByte();var a=StringUtilities.utf8encode(o);return r.push(a),a}function writeUTF8(t,e,i){if(""!==e){var r=i.strings,n=r.indexOf(e);if(n>=0)writeU29(t,n<<1);else{r.push(e);var o=StringUtilities.utf8decode(e);writeU29(t,1|o.length<<1);for(var s=0;s<o.length;s++)t.writeByte(o[s])}}else t.writeByte(1)}function readAMF3Value(t,e){var i=t.readByte();switch(i){case 1:return null;case 0:return;case 2:return!1;case 3:return!0;case 4:return readU29(t);case 5:return readDouble(t);case 6:return readUTF8(t,e);case 8:var r=readU29(t);return t.sec.AXDate.axConstruct([readDouble(t)]);case 10:var n,o;if(0==(1&(r=readU29(t))))return e.objects[r>>1];if(0!=(4&r))throw"AMF3 Traits-Ext is not supported";var s,a=!0;if(0==(2&r))o=e.traits[r>>2],s=e.traitNames[r>>2];else{var l=readUTF8(t,e);l&&(o=n=t.sec.classAliases.getClassByAlias(l)),a=0!=(8&r),s=[];for(var h=0,c=r>>4;h<c;h++)s.push(readUTF8(t,e));e.traits.push(o),e.traitNames.push(s)}var u=n?n.axConstruct([]):t.sec.createObject();e.objects.push(u);for(h=0;h<s.length;h++){var p=readAMF3Value(t,e);u.axSetPublicProperty(s[h],p)}if(a)for(;;){if(""===(_=readUTF8(t,e)))break;p=readAMF3Value(t,e);u.axSetPublicProperty(_,p)}return u;case 9:if(0==(1&(r=readU29(t))))return e.objects[r>>1];var d=t.sec.createArray([]);e.objects.push(d);for(var f=r>>1;;){var _;if(!(_=readUTF8(t,e)).length)break;p=readAMF3Value(t,e);d.axSetPublicProperty(_,p)}for(h=0;h<f;h++){p=readAMF3Value(t,e);d.axSetPublicProperty(h,p)}return d;default:throw"AMF3 Unknown marker "+i}}function tryWriteAndStartTrackingReference(t,e,i){var r=i.objects,n=r.indexOf(e);return n<0?(r.push(e),!1):(writeU29(t,n<<1),!0)}var MAX_INT=268435455,MIN_INT=-268435456;function writeAMF3Value(t,e,i){switch(typeof e){case"boolean":t.writeByte(e?3:2);break;case"number":var r=e===(0|e);r&&(e>MAX_INT||e<MIN_INT)&&(r=!1),r?(t.writeByte(4),writeU29(t,e)):(t.writeByte(5),writeDouble(t,e));break;case"undefined":t.writeByte(0);break;case"string":t.writeByte(6),writeUTF8(t,e,i);break;case"object":if(null===e)t.writeByte(1);else if(t.sec.AXArray.axIsType(e)){var n=e;if(t.writeByte(9),tryWriteAndStartTrackingReference(t,n,i))break;for(var o=0;n.axHasPublicProperty(o);)++o;writeU29(t,o<<1|1),forEachPublicProperty(n,(function(e,r){isNumeric(e)&&e>=0&&e<o||(writeUTF8(t,e,i),writeAMF3Value(t,r,i))})),writeUTF8(t,"",i);for(var s=0;s<o;s++)writeAMF3Value(t,n.axGetPublicProperty(s),i)}else if(t.sec.AXDate.axIsType(e)){if(t.writeByte(8),tryWriteAndStartTrackingReference(t,e,i))break;writeU29(t,1),writeDouble(t,e.valueOf())}else{var a=e;if(t.writeByte(10),tryWriteAndStartTrackingReference(t,a,i))break;var l=!0,h=a.axClass;if(h){var c=h.classInfo;l=!c.instanceInfo.isSealed();var u=t.sec.classAliases.getAliasByClass(h)||"",p=i.traits.indexOf(h),d=null;if(p<0){d=c.instanceInfo.runtimeTraits.getSlotPublicTraitNames(),i.traits.push(h),i.traitNames.push(d),writeU29(t,(l?11:3)+(d.length<<4)),writeUTF8(t,u,i);for(var f=0;f<d.length;f++)writeUTF8(t,d[f],i)}else d=i.traitNames[p],writeU29(t,1+(p<<2));for(f=0;f<d.length;f++)writeAMF3Value(t,a.axGetPublicProperty(d[f]),i)}else writeU29(t,11),writeUTF8(t,"",i);l&&(forEachPublicProperty(a,(function(e,r){writeUTF8(t,e,i),writeAMF3Value(t,r,i)})),writeUTF8(t,"",i))}return}}var AMF3=function(){function t(){}return t.write=function(t,e){writeAMF3Value(t,e,new AMF3ReferenceTables)},t.read=function(t){return readAMF3Value(t,new AMF3ReferenceTables)},t}(),AMFEncoding;!function(t){t[t.AMF0=0]="AMF0",t[t.AMF3=3]="AMF3",t[t.DEFAULT=3]="DEFAULT"}(AMFEncoding||(AMFEncoding={}));var ObjectEncoding=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"dynamicPropertyWriter",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),e.AMF0=AMFEncoding.AMF0,e.AMF3=AMFEncoding.AMF3,e.DEFAULT=AMFEncoding.DEFAULT,e}(ASObject$1),ByteArrayDataProvider=function(){},ByteArray$1=function(t){function e(i){var r,n=t.call(this)||this;ByteArrayDataProvider.symbolForConstructor&&(i=ByteArrayDataProvider.symbolForConstructor,ByteArrayDataProvider.symbolForConstructor=null);var o=0;if(i){if(i instanceof ArrayBuffer)r=i.slice(0);else if(Array.isArray(i))r=new Uint8Array(i).buffer;else if("buffer"in i)if(i.buffer instanceof ArrayBuffer)r=new Uint8Array(i.buffer).buffer;else if(i.buffer instanceof Uint8Array){var s=i.buffer.byteOffset;r=i.buffer.buffer.slice(s,s+i.buffer.length)}else r=i.buffer.slice();else unexpected("Source type.");o=r.byteLength}else r=new ArrayBuffer(e.INITIAL_SIZE);return n._buffer=r,n._length=o,n._position=0,n._resetViews(),n._objectEncoding=e.defaultObjectEncoding,n._littleEndian=!1,n._bitBuffer=0,n._bitLength=0,n}return __extends(e,t),e.classInitializer=function(){var t=DataBuffer.prototype;ObjectUtilities.defineNonEnumerableProperty(t,"$BgtoJSON",t.toJSON)},Object.defineProperty(e,"defaultObjectEncoding",{get:function(){return this._defaultObjectEncoding},set:function(t){t>>>=0,this._defaultObjectEncoding=t},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return"ByteArray"},e.prototype.readObject=function(){switch(this._objectEncoding){case ObjectEncoding.AMF0:return AMF0.read(this);case ObjectEncoding.AMF3:return AMF3.read(this);default:unexpected("Object Encoding")}},e.prototype.writeObject=function(t){switch(this._objectEncoding){case ObjectEncoding.AMF0:return AMF0.write(this,t);case ObjectEncoding.AMF3:return AMF3.write(this,t);default:unexpected("Object Encoding")}},e.prototype.axGetPublicProperty=function(t){return"number"==typeof t||isNumeric(t=axCoerceName(t))?this.axGetNumericProperty(t):this["$Bg"+t]},e.prototype.axGetNumericProperty=function(t){return this.getValue(t)},e.prototype.axSetPublicProperty=function(t,e){"number"==typeof t||isNumeric(t=axCoerceName(t))?this.axSetNumericProperty(t,e):this["$Bg"+t]=e},e.prototype.axSetNumericProperty=function(t,e){this.setValue(t,e)},e.prototype.axGetProperty=function(e){var i=e.name;return"number"==typeof i||isNumeric(i=axCoerceName(i))?this.getValue(+i):t.prototype.axGetProperty.call(this,e)},e.prototype.axSetProperty=function(e,i,r){var n=e.name;"number"==typeof n||isNumeric(n=axCoerceName(n))?this.setValue(+n,i):t.prototype.axSetProperty.call(this,e,i,r)},e.classNatives=[DataBuffer],e.instanceNatives=[DataBuffer.prototype],e.INITIAL_SIZE=128,e._defaultObjectEncoding=ObjectEncoding.DEFAULT,e}(ASObject$1),_sharedObjectStorage;function getSharedObjectStorage(){return"undefined"!=typeof Storage&&(_sharedObjectStorage=localStorage),_sharedObjectStorage}var SharedObject=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"defaultObjectEncoding",{get:function(){notImplemented("public flash.net.SharedObject::static defaultObjectEncoding")},set:function(t){notImplemented("public flash.net.SharedObject::static defaultObjectEncoding")},enumerable:!0,configurable:!0}),e.deleteAll=function(t){notImplemented("public flash.net.SharedObject::static deleteAll")},e.getDiskUsage=function(t){return notImplemented("public flash.net.SharedObject::static getDiskUsage"),0},e.getLocal=function(t,e,i){t=axCoerceString$3(t);var r,n=((e=axCoerceString$3(e))||"")+"/"+t,o=getSharedObjectStorage().getItem(n),s=this._defaultObjectEncoding;if(o){try{var a=StringUtilities.decodeRestrictedBase64ToBytes(o),l=new ByteArray(a.length);l.sec=this.sec,l.setArrayBuffer(a.buffer),r=AMF3.read(l)}catch(t){warning("Error encountered while decoding LocalStorage entry. Resetting data.")}r&&"object"==typeof r||(r=this.sec.createObject())}else r=this.sec.createObject();var h=this.sec.flash.net.SharedObject();return h._path=n,h._objectEncoding=s,h._data=r,h},e.getRemote=function(t,i,r,n){return new e},e.prototype.flush=function(t){var e=!0;for(var i in this._data)if(this._data.hasOwnProperty(i)){e=!1;break}if(!e||getSharedObjectStorage().getItem(this._path)){var r=new ByteArray;r.sec=this.sec,r.writeObject(this._data),AMF3.write(r,this._data);var n=new Uint8Array(r.arraybytes),o=StringUtilities.base64EncodeBytes(n);getSharedObjectStorage().setItem(this._path,o)}},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectEncoding",{get:function(){notImplemented("public flash.net.SharedObject::get objectEncoding")},set:function(t){notImplemented("public flash.net.SharedObject::set objectEncoding")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"client",{get:function(){notImplemented("public flash.net.SharedObject::get client")},set:function(t){notImplemented("public flash.net.SharedObject::set client")},enumerable:!0,configurable:!0}),e.prototype.setDirty=function(t){notImplemented("public flash.net.SharedObject::setDirty")},e.prototype.connect=function(t,e){notImplemented("public flash.net.SharedObject::connect")},e.prototype.send=function(){notImplemented("public flash.net.SharedObject::send")},e.prototype.close=function(){notImplemented("public flash.net.SharedObject::close")},e.prototype.clear=function(){notImplemented("public flash.net.SharedObject::clear")},Object.defineProperty(e.prototype,"size",{get:function(){notImplemented("public flash.net.SharedObject::get size")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fps",{set:function(t){notImplemented("public flash.net.SharedObject::set fps")},enumerable:!0,configurable:!0}),e.prototype.setProperty=function(t,e){notImplemented("public flash.net.SharedObject::setProperty")},e._defaultObjectEncoding=ObjectEncoding.DEFAULT,e}(ASObject$1),LoaderContext$1=function(t){function e(e,i,r){void 0===i&&(i=null);var n=t.call(this)||this;return n._applicationDomain=i,n}return __extends(e,t),Object.defineProperty(e.prototype,"applicationDomain",{get:function(){return this._applicationDomain},set:function(t){this._applicationDomain=t},enumerable:!0,configurable:!0}),e}(ASObject$1),Sound=function(t){function e(e,i){var r=t.call(this)||this;return r.loopsToPlay=0,r}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},set:function(t){this._adaptee=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return console.log("bytesLoaded not implemented yet in flash/Sound"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return console.log("bytesTotal not implemented yet in flash/Sound"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id3",{get:function(){return console.log("id3 not implemented yet in flash/Sound"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBuffering",{get:function(){return console.log("isBuffering not implemented yet in flash/Sound"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isURLInaccessible",{get:function(){return console.log("isURLInaccessible not implemented yet in flash/Sound"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return console.log("length not implemented yet in flash/Sound"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return console.log("url not implemented yet in flash/Sound"),""},enumerable:!0,configurable:!0}),e.prototype.close=function(){console.log("close not implemented yet in flash/Sound")},e.prototype.extract=function(t,e,i){return console.log("extract not implemented yet in flash/Sound"),0},e.prototype.load=function(t,e){console.log("load not implemented yet in flash/Sound")},e.prototype.loadCompressedDataFromByteArray=function(t,e){console.log("loadCompressedDataFromByteArray not implemented yet in flash/Sound")},e.prototype.loadPCMFromByteArray=function(t,e,i,r,n){console.log("loadPCMFromByteArray not implemented yet in flash/Sound")},e.prototype.soundCompleteInternal=function(){this.loopsToPlay--,this.loopsToPlay>0?(this.stop(),this.adaptee.play(0,!1)):this._onCompleteCallback&&this._onCompleteCallback()},e.prototype.play=function(t,e,i){var r=this;if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),this.adaptee){i&&(this.adaptee.volume=i.volume,this.adaptee.pan=i.pan),e=isNaN(e)||e<1?1:Math.floor(e),this.loopsToPlay=e,this._adaptee.onSoundComplete=function(){return r.soundCompleteInternal()},this._adaptee.play(t,!1);var n=new this.sec.flash.media.SoundChannel;return n._sound=this,i||(i=new this.sec.flash.media.SoundTransform),n.soundTransform=i,n}console.log("Sound.play : no adaptee exists!")},e.prototype.stop=function(){this._adaptee.stop()},e}(EventDispatcher$1),XMLSpecialChars;!function(t){t[t.APOS=39]="APOS",t[t.AMP=38]="AMP",t[t.QUOT=34]="QUOT",t[t.LT=60]="LT",t[t.GT=62]="GT"}(XMLSpecialChars||(XMLSpecialChars={}));var XMLNode$1=function(t){function e(e,i){return t.call(this)||this}return __extends(e,t),e.escapeXML=function(t){for(var e,i=0,r=(t=axCoerceString$3(t)).length;i<r&&(e=t.charCodeAt(i))!==XMLSpecialChars.APOS&&e!==XMLSpecialChars.AMP&&e!==XMLSpecialChars.QUOT&&e!==XMLSpecialChars.LT&&e!==XMLSpecialChars.GT;)i++;if(i>=r)return t;for(var n=[t.substring(0,i)];i<r;){switch(e){case XMLSpecialChars.APOS:n.push("&apos;");break;case XMLSpecialChars.AMP:n.push("&amp;");break;case XMLSpecialChars.QUOT:n.push("&quot;");break;case XMLSpecialChars.LT:n.push("&lt;");break;case XMLSpecialChars.GT:n.push("&gt;")}for(var o=++i;i<r&&(e=t.charCodeAt(i))!==XMLSpecialChars.APOS&&e!==XMLSpecialChars.AMP&&e!==XMLSpecialChars.QUOT&&e!==XMLSpecialChars.LT&&e!==XMLSpecialChars.GT;)i++;o<i&&n.push(t.substring(o,i))}return n.join("")},e}(ASObject$1),XMLDocument$1=function(t){function e(e){return t.call(this,1,"")||this}return __extends(e,t),e}(XMLNode$1),XMLTag=function(t){function e(){var e=t.call(this)||this;return e._type=0,e._value=null,e._empty=!1,e._attrs=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){t>>>=0,this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._empty},set:function(t){t=!!t,this._empty=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){t=axCoerceString$3(t),this._value=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attrs",{get:function(){return this._attrs},set:function(t){this._attrs=t},enumerable:!0,configurable:!0}),e}(ASObject$1),XMLNodeType$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ASObject$1);function isWhitespace$1(t){for(var e=0;e<t.length;e++){var i=t[e];if(" "!==i&&"\n"!==i&&"\r"!==i&&"\t"!==i)return!1}return!0}var XMLParserForXMLDocument=function(t){function e(e){var i=t.call(this)||this;return i.sec=e,i.queue=[],i.ignoreWhitespace=!1,i}return __extends(e,t),e.prototype.onError=function(t){this.queue.push(t)},e.prototype.onPi=function(t,e){warning("Unhandled XMLParserForXMLDocument.onPi")},e.prototype.onComment=function(t){warning("Unhandled XMLParserForXMLDocument.onComment")},e.prototype.onCdata=function(t){this.queue.push({type:4,value:t})},e.prototype.onDoctype=function(t){warning("Unhandled XMLParserForXMLDocument.onDoctype")},e.prototype.onBeginElement=function(t,e,i){var r=this.sec.createObject();e.forEach((function(t){r.axSetPublicProperty(t.name,t.value)})),this.queue.push({type:1,value:t,empty:i,attrs:r})},e.prototype.onEndElement=function(t){this.queue.push({type:1,value:"/"+t})},e.prototype.onText=function(t){this.ignoreWhitespace&&isWhitespace$1(t)||this.queue.push({type:3,value:t})},e}(XMLParserBase),XMLParser$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.startParse=function(t,e){t=axCoerceString$3(t),e=!!e;var i=new XMLParserForXMLDocument(this.sec);i.ignoreWhitespace=e,i.parseXml(t),this.queue=i.queue},e.prototype.getNext=function(t){if(0===this.queue.length)return-1;var e=this.queue.shift();if("number"==typeof e)return e;var i=e;return t.type=i.type,t.value=i.value,t.empty=i.empty||!1,t.attrs=i.attrs||null,0},e}(ASObject$1),FontStyle=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.REGULAR="regular",e.BOLD="bold",e.ITALIC="italic",e.BOLD_ITALIC="boldItalic",e}(ASObject$1),TextFormatDisplay=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.INLINE="inline",e.BLOCK="block",e}(ASObject$1),TextFormat$1=function(t){function e(e,i,r,n,o,s,a,l,h,c,u,p,d){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===p&&(p=null),void 0===d&&(d=null);var f=t.call(this)||this;return f.font=e,f.size=i,f.color=r,f.bold=n,f.italic=o,f.underline=s,f.url=a,f.target=l,f.align=h,f.leftMargin=c,f.rightMargin=u,f.indent=p,f.leading=d,f._blockIndent=null,f._bullet=null,f._display=TextFormatDisplay.BLOCK,f._kerning=null,f._letterSpacing=null,f._tabStops=null,f}return __extends(e,t),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){t=axCoerceString$3(t),this._align=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockIndent",{get:function(){return this._blockIndent},set:function(t){this._blockIndent=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{get:function(){return this._bold},set:function(t){this._bold=e.coerceBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bullet",{get:function(){return this._bullet},set:function(t){this._bullet=e.coerceBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=null!=t?0|+t:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return this._display},set:function(t){this._display=axCoerceString$3(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){this._font=axCoerceString$3(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._bold&&this._italic?FontStyle.BOLD_ITALIC:this._bold?FontStyle.BOLD:this._italic?FontStyle.ITALIC:FontStyle.REGULAR},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indent",{get:function(){return this._indent},set:function(t){this._indent=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"italic",{get:function(){return this._italic},set:function(t){this._italic=e.coerceBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kerning",{get:function(){return this._kerning},set:function(t){this._kerning=e.coerceBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftMargin",{get:function(){return this._leftMargin},set:function(t){this._leftMargin=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightMargin",{get:function(){return this._rightMargin},set:function(t){this._rightMargin=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size=e.coerceNumber(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabStops",{get:function(){return this.sec.createArrayUnsafe(this._tabStops)},set:function(t){null!=t?(this.sec.AXArray.axIsType(t)||this.sec.throwError("ArgumentError",Errors$1.CheckTypeFailedError,t,"Array"),this._tabStops=t.value):this._tabStops=null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=axCoerceString$3(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"underline",{get:function(){return this._underline},set:function(t){this._underline=e.coerceBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},set:function(t){this._url=axCoerceString$3(t)},enumerable:!0,configurable:!0}),e.coerceNumber=function(t){return null==t?null:isNaN(t)||t>268435455?-2147483648:roundHalfEven(t)},e.coerceBoolean=function(t){return null==t?null:!!t},e.prototype.clone=function(){var t=new e(this._font,this._size,this._color,this._bold,this._italic,this._underline,this._url,this._target,this._align,this._leftMargin,this._rightMargin,this._indent,this._leading);return t._blockIndent=this._blockIndent,t._bullet=this._bullet,t._display=this._display,t._kerning=this._kerning,t._letterSpacing=this._letterSpacing,t._tabStops=this._tabStops,t},e.prototype.equals=function(t){return this._align===t._align&&this._blockIndent===t._blockIndent&&this._bold===t._bold&&this._bullet===t._bullet&&this._color===t._color&&this._display===t._display&&this._font===t._font&&this._indent===t._indent&&this._italic===t._italic&&this._kerning===t._kerning&&this._leading===t._leading&&this._leftMargin===t._leftMargin&&this._letterSpacing===t._letterSpacing&&this._rightMargin===t._rightMargin&&this._size===t._size&&this._tabStops===t._tabStops&&this._target===t._target&&this._underline===t._underline&&this._url===t._url},e.prototype.merge=function(t){null!==t._align&&(this._align=t._align),null!==t._blockIndent&&(this._blockIndent=t._blockIndent),null!==t._bold&&(this._bold=t._bold),null!==t._bullet&&(this._bullet=t._bullet),null!==t._color&&(this._color=t._color),null!==t._display&&(this._display=t._display),t._font&&(this._font=t._font),null!==t._indent&&(this._indent=t._indent),null!==t._italic&&(this._italic=t._italic),null!==t._kerning&&(this._kerning=t._kerning),null!==t._leading&&(this._leading=t._leading),null!==t._leftMargin&&(this._leftMargin=t._leftMargin),null!==t._letterSpacing&&(this._letterSpacing=t._letterSpacing),null!==t._rightMargin&&(this._rightMargin=t._rightMargin),null!==t._size&&(this._size=t._size),null!==t._tabStops&&(this._tabStops=t._tabStops),t._target&&(this._target=t._target),null!==t._underline&&(this._underline=t._underline),t._url&&(this._url=t._url)},e.prototype.intersect=function(t){t._align!==this._align&&(this._align=null),t._blockIndent!==this._blockIndent&&(this._blockIndent=null),t._bold!==this._bold&&(this._bold=null),t._bullet!==this._bullet&&(this._bullet=null),t._color!==this._color&&(this._color=null),t._display!==this._display&&(this._display=null),t._font!==this._font&&(this._font=null),t._indent!==this._indent&&(this._indent=null),t._italic!==this._italic&&(this._italic=null),t._kerning!==this._kerning&&(this._kerning=null),t._leading!==this._leading&&(this._leading=null),t._leftMargin!==this._leftMargin&&(this._leftMargin=null),t._letterSpacing!==this._letterSpacing&&(this._letterSpacing=null),t._rightMargin!==this._rightMargin&&(this._rightMargin=null),t._size!==this._size&&(this._size=null),t._tabStops!==this._tabStops&&(this._tabStops=null),t._target!==this._target&&(this._target=null),t._underline!==this._underline&&(this._underline=null),t._url!==this._url&&(this._url=null)},e.prototype.transform=function(t){var e=t.textAlign;if(e&&(this.align=e),"bold"===(e=t.fontWeight)?this.bold=!0:"normal"===e&&(this.bold=!1),e=t.color){var i=axCoerceString$3(e).trim().toLowerCase();if("#"===i[0]){for(var r=i.substr(1);"0"===r[0];)r=r.substr(1);var n=parseInt(r,16);n.toString(16)===r&&(this.color=n)}}if((e=t.display)&&(this.display=e),(e=t.fontFamily)&&(this.font=e.replace("sans-serif","_sans").replace("serif","_serif")),(e=t.textIndent)&&(this.indent=parseInt(e)),"italic"===(e=t.fontStyle)?this.italic=!0:"normal"===e&&(this.italic=!1),e=t.kerning,this.kerning="true"===e?1:"false"===e?0:parseInt(e),(e=t.leading)&&(this.leading=parseInt(e)),(e=t.marginLeft)&&(this.leftMargin=parseInt(e)),(e=t.letterSpacing)&&(this.letterSpacing=parseFloat(e)),(e=t.marginRight)&&(this.rightMargin=parseInt(e)),e=t.fontSize){var o=parseInt(e);o>0&&(this.size=o)}return"none"===(e=t.textDecoration)?this.underline=!1:"underline"===e&&(this.underline=!0),this},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),AVM1Movie=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getLevelForRoot=function(t){return 0},e.prototype._getRootForLevel=function(t){return null},e.prototype._addRoot=function(t,e){},e.prototype._removeRoot=function(t){},e}(DisplayObject),ContextMenu=function(){},ContextMenuItem=function(){},fscommand=function(){},Security=function(){},Capabilities=function(){},ExternalInterface=function(){},Mouse=function(){},SoundChannel=function(){},SoundTransform=function(){},SoundMixer=function(){},SecurityDomain=function(){this.flash={display:{EventDispatcher:EventDispatcher$1,DisplayObject:DisplayObject$1,DisplayObjectContainer:DisplayObjectContainer$1,AVM1Movie:AVM1Movie,Stage:AVMAwayStage,Loader:Loader$1,LoaderInfo:LoaderInfo$2,MovieClip:MovieClip$1,Graphics:Graphics$1,Bitmap:Bitmap,BitmapData:BitmapData,SimpleButton:SimpleButton$1},events:{EventDispatcher:EventDispatcher$1,Event:Event,KeyboardEvent:KeyboardEvent$2,MouseEvent:MouseEvent$1,ProgressEvent:ProgressEvent},external:{ExternalInterface:ExternalInterface},filters:{},text:{TextField:TextField$1,TextFormat:TextFormat$1},geom:{Point:Point$1,Rectangle:Rectangle$1,Matrix:Matrix$1,ColorTransform:ColorTransform$1,Transform:Transform$1},net:{URLRequest:URLRequest$1,URLLoader:URLLoader$1,URLVariables:URLVariables,SharedObject:SharedObject},system:{Capabilities:Capabilities,LoaderContext:LoaderContext$1,Security:Security,fscommand:fscommand},ui:{ContextMenu:ContextMenu,ContextMenuItem:ContextMenuItem,Mouse:Mouse},utils:{ByteArray:ByteArray$1},media:{Sound:Sound,SoundChannel:SoundChannel,SoundTransform:SoundTransform,SoundMixer:SoundMixer},xml:{XMLDocument:XMLDocumentAway,XMLNode:XMLNode$1}},this.player={}};function axIsCallable(t){return t&&"function"==typeof t.axApply}var ASNumber$1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgtoLocaleString",i.toString),addPrototypeFunctionAlias(t,"$BgvalueOf",i.valueOf),addPrototypeFunctionAlias(t,"$BgtoFixed",i.toFixed),addPrototypeFunctionAlias(t,"$BgtoExponential",i.toExponential),addPrototypeFunctionAlias(t,"$BgtoPrecision",i.toPrecision),defineNonEnumerableProperty(this,"$BgNaN",Number.NaN),defineNonEnumerableProperty(this,"$BgNEGATIVE_INFINITY",-1/0),defineNonEnumerableProperty(this,"$BgPOSITIVE_INFINITY",1/0),defineNonEnumerableProperty(this,"$BgMAX_VALUE",Number.MAX_VALUE),defineNonEnumerableProperty(this,"$BgMIN_VALUE",Number.MIN_VALUE),defineNonEnumerableProperty(this,"$BgE",Math.E),defineNonEnumerableProperty(this,"$BgLN10",Math.LN10),defineNonEnumerableProperty(this,"$BgLN2",Math.LN2),defineNonEnumerableProperty(this,"$BgLOG10E",Math.LOG10E),defineNonEnumerableProperty(this,"$BgLOG2E",Math.LOG2E),defineNonEnumerableProperty(this,"$BgPI",Math.PI),defineNonEnumerableProperty(this,"$BgSQRT1_2",Math.SQRT2),defineNonEnumerableProperty(this,"$BgSQRT2",Math.SQRT2)},e.prototype.toString=function(t){return 0===arguments.length?t=10:((t|=0)<2||t>36)&&this.sec.throwError("RangeError",Errors$1.InvalidRadixError,t),this.axClass!==this.sec.AXNumber&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"Number.prototype.toString"),this.value.toString(t)},e.prototype.valueOf=function(){return this.axClass!==this.sec.AXNumber&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"Number.prototype.valueOf"),this.value},e.prototype.toExponential=function(t){return((t|=0)<0||t>20)&&this.sec.throwError("RangeError",Errors$1.InvalidPrecisionError),this.axClass!==this.sec.AXNumber?"NaN":this.value.toExponential(t)},e.prototype.toPrecision=function(t){return t?t|=0:t=1,(t<1||t>21)&&this.sec.throwError("RangeError",Errors$1.InvalidPrecisionError),this.axClass!==this.sec.AXNumber?"NaN":this.value.toPrecision(t)},e.prototype.toFixed=function(t){return((t|=0)<0||t>20)&&this.sec.throwError("RangeError",Errors$1.InvalidPrecisionError),this.axClass!==this.sec.AXNumber?"NaN":this.value.toFixed(t)},e._minValue=function(){return Number.MIN_VALUE},e.convertStringToDouble=function(t){var e=t.indexOf(String.fromCharCode(0));return e>=0?+t.substring(0,e):+t},e.classNatives=[Math],e}(ASObject$1);function axCoerceNumber(t){return"string"==typeof t?ASNumber$1.convertStringToDouble(t):t&&"object"==typeof t&&"string"==typeof(t=t.valueOf())?ASNumber$1.convertStringToDouble(t):+t}var BaseVector=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.axGetProperty=function(e){var i=e.name;return(0|(i="number"==typeof i?i:axCoerceName(i)))===i||isNumeric(i)?this.axGetNumericProperty("number"==typeof i?i:0|i):t.prototype.axGetProperty.call(this,e)},e.prototype.axSetProperty=function(e,i,r){var n=e.name;(0|(n="number"==typeof n?n:axCoerceName(n)))===n||isNumeric(n)?this.axSetNumericProperty("number"==typeof n?n:0|n,i):t.prototype.axSetProperty.call(this,e,i,r)},e.prototype.axGetPublicProperty=function(t){return(0|(t="number"==typeof t?t:axCoerceName(t)))===t||isNumeric(t)?this.axGetNumericProperty("number"==typeof t?t:0|t):this["$Bg"+t]},e.prototype.axSetPublicProperty=function(t,e){(0|(t="number"==typeof t?t:axCoerceName(t)))===t||isNumeric(t)?this.axSetNumericProperty("number"==typeof t?t:0|t,e):this["$Bg"+t]=e},e.prototype.axNextName=function(t){return t-1},e.prototype.checkVectorMethodArgs=function(t,e){if(isNullOrUndefined$1(t))return!1;var i=this.sec;return axIsCallable(t)||i.throwError("TypeError",Errors$1.CheckTypeFailedError,t,"Function"),t.axClass!==i.AXMethodClosure||isNullOrUndefined$1(e)||i.throwError("TypeError",Errors$1.ArrayFilterNonNullObjectError),!0},e}(ASObject$1),Vector=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.axIsType=function(t){return this.dPrototype.isPrototypeOf(t)||this.sec.Int32Vector.axClass.dPrototype.isPrototypeOf(t)||this.sec.Uint32Vector.axClass.dPrototype.isPrototypeOf(t)||this.sec.Float64Vector.axClass.dPrototype.isPrototypeOf(t)||this.sec.ObjectVector.axClass.dPrototype.isPrototypeOf(t)},e}(ASObject$1),GenericVector=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=!1);var r=t.call(this)||this;return e>>>=0,i=!!i,r._fixed=!!i,r._buffer=new Array(e),r._fill(0,e,r.axClass.defaultValue),r}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=this.tPrototype;i.axGetProperty=t.axGetProperty,i.axGetNumericProperty=t.axGetNumericProperty,i.axSetProperty=t.axSetProperty,i.axSetNumericProperty=t.axSetNumericProperty,i.axHasPropertyInternal=t.axHasPropertyInternal,i.axNextName=t.axNextName,i.axNextNameIndex=t.axNextNameIndex,i.axNextValue=t.axNextValue,t.axGetProperty=ASObject$1.prototype.axGetProperty,t.axGetNumericProperty=ASObject$1.prototype.axGetNumericProperty,t.axSetProperty=ASObject$1.prototype.axSetProperty,t.axSetNumericProperty=ASObject$1.prototype.axSetNumericProperty,t.axHasPropertyInternal=ASObject$1.prototype.axHasPropertyInternal,t.axNextName=ASObject$1.prototype.axNextName,t.axNextNameIndex=ASObject$1.prototype.axNextNameIndex,t.axNextValue=ASObject$1.prototype.axNextValue;var r=e.prototype;defineNonEnumerableProperty(t,"$Bgjoin",r.join),defineNonEnumerableProperty(t,"$BgtoString",r.join),defineNonEnumerableProperty(t,"$BgtoLocaleString",r.toLocaleString),defineNonEnumerableProperty(t,"$Bgpop",r.pop),defineNonEnumerableProperty(t,"$Bgpush",r.push),defineNonEnumerableProperty(t,"$Bgreverse",r.reverse),defineNonEnumerableProperty(t,"$Bgconcat",r.concat),defineNonEnumerableProperty(t,"$Bgsplice",r.splice),defineNonEnumerableProperty(t,"$Bgslice",r.slice),defineNonEnumerableProperty(t,"$Bgshift",r.shift),defineNonEnumerableProperty(t,"$Bgunshift",r.unshift),defineNonEnumerableProperty(t,"$BgindexOf",r.indexOf),defineNonEnumerableProperty(t,"$BglastIndexOf",r.lastIndexOf),defineNonEnumerableProperty(t,"$BgforEach",r.forEach),defineNonEnumerableProperty(t,"$Bgmap",r.map),defineNonEnumerableProperty(t,"$Bgfilter",r.filter),defineNonEnumerableProperty(t,"$Bgsome",r.some),defineNonEnumerableProperty(t,"$Bgevery",r.every),defineNonEnumerableProperty(t,"$Bgsort",r.sort),defineNonEnumerableProperty(t,"checkVectorMethodArgs",r.checkVectorMethodArgs)},e.axApply=function(t,e){var i=e[0];if(this.axIsType(i))return i;var r=i.axGetPublicProperty("length");if(void 0!==r){for(var n=this.axConstruct([r,!1]),o=0;o<r;o++)n.axSetNumericProperty(o,i.axGetPublicProperty(o));return n}unexpected()},e.defaultCompareFunction=function(t,e){return String(t).localeCompare(String(e))},e.compare=function(t,i,r,n){var o=0;return n||(n=e.defaultCompareFunction),o=r&e.NUMERIC?(t=toNumber(t))<(i=toNumber(i))?-1:t>i?1:0:n(t,i),r&e.DESCENDING&&(o*=-1),o},e.prototype._fill=function(t,e,i){for(var r=0;r<e;r++)this._buffer[t+r]=i},e.prototype.toString=function(){for(var t=[],e=0;e<this._buffer.length;e++){var i=this._buffer[e];t.push(null===i?"null":i+"")}return t.join(",")},e.prototype.toLocaleString=function(){for(var t=[],e=0;e<this._buffer.length;e++){var i=this._buffer[e];i&&"object"==typeof i?t.push(i.$BgtoLocaleString()):t.push(i+"")}return t.join(",")},e.prototype.sort=function(t){if(0===arguments.length)return this._buffer.sort(),this;if(this.sec.AXFunction.axIsType(t))return this._buffer.sort(t.value),this;var i=0|t;return i&e.NUMERIC?i&e.DESCENDING?(this._buffer.sort((function(t,e){return axCoerceNumber(e)-axCoerceNumber(t)})),this):(this._buffer.sort((function(t,e){return axCoerceNumber(t)-axCoerceNumber(e)})),this):i&e.CASEINSENSITIVE?i&e.DESCENDING?(this._buffer.sort((function(t,e){return axCoerceString$3(e).toLowerCase()-axCoerceString$3(t).toLowerCase()})),this):(this._buffer.sort((function(t,e){return axCoerceString$3(t).toLowerCase()-axCoerceString$3(e).toLowerCase()})),this):i&e.DESCENDING?(this._buffer.sort((function(t,e){return e-t})),this):(this._buffer.sort(),this)},e.prototype.every=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!0;for(var i=0;i<this._buffer.length;i++)if(!t.axCall(e,this.axGetNumericProperty(i),i,this))return!1;return!0},e.prototype.filter=function(t,e){var i=this.axClass.axConstruct([0,!1]);if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._buffer.length;r++)t.call(e,this.axGetNumericProperty(r),r,this)&&i.push(this.axGetNumericProperty(r));return i},e.prototype.map=function(t,e){var i=this.axClass.axConstruct([this.length,!1]);if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._buffer.length;r++)i.push(this._coerce(t.call(e,this.axGetNumericProperty(r),r,this)));return i},e.prototype.some=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!1;for(var i=0;i<this._buffer.length;i++)if(t.call(e,this.axGetNumericProperty(i),i,this))return!0;return!1},e.prototype.forEach=function(t,e){if(this.checkVectorMethodArgs(t,e))for(var i=0;i<this._buffer.length;i++)t.call(e,this.axGetNumericProperty(i),i,this)},e.prototype.join=function(t){void 0===t&&(t=",");for(var e=this._buffer,i=this._buffer.length,r="",n=0;n<i-1;n++)r+=e[n]+t;return i>0&&(r+=e[i-1]),r},e.prototype.indexOf=function(t,e){return void 0===e&&(e=0),this._buffer.indexOf(t,e)},e.prototype.lastIndexOf=function(t,e){return void 0===e&&(e=2147483647),this._buffer.lastIndexOf(t,e)},e.prototype.push=function(t,e,i,r,n,o,s,a){this._checkFixed();for(var l=0;l<arguments.length;l++)this._buffer.push(this._coerce(arguments[l]))},e.prototype.pop=function(){if(this._checkFixed(),0!==this._buffer.length)return this._buffer.pop()},e.prototype.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(this._coerce(arguments[e])._buffer);var i=this._buffer.concat.apply(this._buffer,t),r=this.axClass.axConstruct([]);return r._buffer=i,r},e.prototype.reverse=function(){return this._buffer.reverse(),this},e.prototype._coerce=function(t){return this.axClass.type.axCoerce(t)},e.prototype.shift=function(){if(this._checkFixed(),0!==this._buffer.length)return this._buffer.shift()},e.prototype.unshift=function(){if(arguments.length){this._checkFixed();for(var t=0;t<arguments.length;t++)this._buffer.unshift(this._coerce(arguments[t]))}},e.prototype.slice=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);var i=this._buffer,r=i.length,n=Math.min(Math.max(t,0),r),o=Math.min(Math.max(e,n),r),s=this.axClass.axConstruct([o-n,this.fixed]);return s._buffer=i.slice(n,o),s},e.prototype.splice=function(t,e){var i=this._buffer,r=i.length,n=Math.min(Math.max(t,0),r),o=Math.min(Math.max(e,0),r-n),s=arguments.length-2;o!==s&&this._checkFixed();for(var a=[n,o],l=2;l<s+2;l++)a[l]=this._coerce(arguments[l]);var h=this.axClass.axConstruct([o,this.fixed]);return h._buffer=i.splice.apply(i,a),h},Object.defineProperty(e.prototype,"length",{get:function(){return this._buffer.length},set:function(t){if((t>>>=0)>this._buffer.length)for(var e=this._buffer.length;e<t;e++)this._buffer[e]=this.axClass.defaultValue;else this._buffer.length=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixed",{get:function(){return this._fixed},set:function(t){this._fixed=!!t},enumerable:!0,configurable:!0}),e.prototype._checkFixed=function(){this._fixed&&this.sec.throwError("RangeError",Errors$1.VectorFixedError)},e.prototype.axGetNumericProperty=function(t){var e=0|t;return(e<0||e>=this._buffer.length||e!=t)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,this._buffer.length),this._buffer[e]},e.prototype.axSetNumericProperty=function(t,e){var i=this._buffer.length,r=0|t;(r<0||r>i||r!=t||r===i&&this._fixed)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,i),this._buffer[r]=this._coerce(e)},e.prototype.axHasPropertyInternal=function(t){if((0|t.name)===t.name)return t.name>=0&&t.name<this._buffer.length;var e=axCoerceName(t.name);if(t.isRuntimeName()&&isIndex(e)){var i=e>>>0;return i>=0&&i<this._buffer.length}return this.axResolveMultiname(t)in this},e.prototype.axNextValue=function(t){return this._buffer[t-1]},e.prototype.axNextNameIndex=function(t){var e=t+1;return e<=this._buffer.length?e:0},e.CASEINSENSITIVE=1,e.DESCENDING=2,e.UNIQUESORT=4,e.RETURNINDEXEDARRAY=8,e.NUMERIC=16,e.defaultValue=null,e}(BaseVector),BrowserSystemResourcesLoadingService=function(){function t(){}return t.getInstance=function(){return t._instance?t._instance:t._instance=new t},t.prototype.load=function(t,e){return this._promiseFile(t,e)},t.prototype._promiseFile=function(t,e){return new Promise((function(i,r){var n=new XMLHttpRequest;n.open("GET",t),n.responseType=e,n.onload=function(){var o=n.response;o?("json"===e&&"json"!==n.responseType&&(o=JSON.parse(o)),i(o)):r("Unable to load "+t+": "+n.statusText)},n.onerror=function(){r("Unable to load: xhr error")},n.send()}))},t}(),ABCCatalog=function(){function t(t,e,i){this.app=t,this.map=ObjectUtilities.createMap(),this.abcs=e,this.scripts=ObjectUtilities.createMap();for(var r=0;r<i.length;r++){var n=i[r];this.scripts[n.name]=n;for(var o=0;o<n.defs.length;o++){var s=n.defs[o].split(":"),a=this.map[s[1]];a||(a=this.map[s[1]]=Object.create(null)),a[s[0]]=n.name}}}return t.prototype.getABCByScriptName=function(t){var e=this.scripts[t];if(!e)return null;var i={url:t,app:this.app};return new ABCFile(i,this.abcs.subarray(e.offset,e.offset+e.length))},t.prototype.getABCByMultiname=function(t){var e=this.map[t.name];if(!e)return null;for(var i=t.namespaces,r=0;r<i.length;r++){var n=e[i[r].uri];if(n)return this.getABCByScriptName(n)}return null},t}(),AXApplicationDomain=function(){function t(t,e){this.sec=t,this.parent=e,this.system=e?e.system:this,this._abcs=[],this._binarySymbols={}}return t.prototype.addBinarySymbol=function(t){this._binarySymbols[t.className]=t},t.prototype.getBinarySymbol=function(t){return this._binarySymbols[t]},t.prototype.loadABC=function(t){assert(this._abcs.indexOf(t)<0),this._abcs.push(t)},t.prototype.loadAndExecuteABC=function(t){this.loadABC(t),this.executeABC(t)},t.prototype.executeABC=function(t){var e=t.scripts[t.scripts.length-1];this.executeScript(e)},t.prototype.findClassInfo=function(t){for(var e=0;e<this._abcs.length;e++)for(var i=this._abcs[e],r=0;r<i.instances.length;r++){var n=i.classes[r];if(n.instanceInfo.getName().name===t)return n}return null},t.prototype.executeScript=function(t){assert(0===t.state),runtimeWriter&&runtimeWriter.writeLn("Running Script: "+t);var e=this.sec.createAXGlobal(this,t);t.global=e,t.state=1,interpret(t.getInitializer(),e.scope,null).apply(e,[]),t.state=2},t.prototype.findProperty=function(t,e,i){var r=this.findDefiningScript(t,i);return r?r.global:null},t.prototype.getClass=function(t){return this.getProperty(t,!0,!0)},t.prototype.getProperty=function(t,e,i){var r=this.findProperty(t,e,i);return r?r.axGetProperty(t):null},t.prototype.findDefiningScript=function(t,e){if(t.script)return t.script;var i;if(this.parent&&(i=this.parent.findDefiningScript(t,e)))return i;for(var r=0;r<this._abcs.length;r++){var n=this._abcs[r];if(i=this._findDefiningScriptInABC(n,t,e))return t.mutable||(t.script=i),i}return(n=this.system.sec.findDefiningABC(t))?(this.loadABC(n),i=this._findDefiningScriptInABC(n,t,e),t.mutable||(t.script=i),i):null},t.prototype._findDefiningScriptInABC=function(t,e,i){for(var r=t.scripts,n=0;n<r.length;n++){var o=r[n],s=o.traits;if(s.resolve(),s.getTrait(e))return i&&0===o.state&&this.executeScript(o),o}return null},t}();function transformJSValueToAS(t,e,i){if("object"!=typeof e)return e;if(isNullOrUndefined(e))return e;if(Array.isArray(e)){for(var r=[],n=0;n<e.length;n++){var o=e[n],s=i?transformJSValueToAS(t,o,!0):o;r.push(s)}return t.createArray(r)}return t.createObjectFromJS(e,i)}function containsSymbol(t,e){for(var i=0;i<t.length;i++){var r=t[i];if(r.indexOf(e)>=0){var n="!"===r[r.length-1];if(n&&(r=r.slice(0,r.length-1)),e!==r)continue;return n}}return!1}function linkSymbols(t,e,i){for(var r=0;r<e.traits.length;r++){var n=e.traits[r];if(containsSymbol(t,n.getName().name)){if(n.isConst())return;var o=n.getName().name,s=n.getName().getMangledName();n.isSlot()?Object.defineProperty(i,o,{get:new Function("","return this."+s+"//# sourceURL=get-"+s+".as"),set:new Function("v","this."+s+" = v;//# sourceURL=set-"+s+".as")}):n.isGetter()?Object.defineProperty(i,o,{get:new Function("","return this."+s+"//# sourceURL=get-"+s+".as")}):notImplemented(n.toString())}}}function filter(t){return 0!==t.indexOf("native_")}function traceASClass(t,e){for(var i in runtimeWriter.enter("Class: "+t.classInfo),runtimeWriter.enter("Traps:"),e.prototype)if(0===i.indexOf("ax")){var r=e.hasOwnProperty(i);runtimeWriter.writeLn((r?"Own":"Inherited")+" trap: "+i)}runtimeWriter.leave(),runtimeWriter.leave()}var axTrapNames=["axResolveMultiname","axHasProperty","axDeleteProperty","axCallProperty","axCallSuper","axConstructProperty","axHasPropertyInternal","axHasOwnProperty","axSetProperty","axGetProperty","axGetSuper","axSetSuper","axNextNameIndex","axNextName","axNextValue","axGetEnumerableKeys","axHasPublicProperty","axSetPublicProperty","axGetPublicProperty","axCallPublicProperty","axDeletePublicProperty","axSetNumericProperty","axGetNumericProperty","axGetSlot","axSetSlot"];function linkClass(t,e){if(t.asClass=e,e.classSymbols&&linkSymbols(e.classSymbols,t.classInfo.traits,t),e.instanceSymbols&&linkSymbols(e.instanceSymbols,t.classInfo.instanceInfo.traits,t.tPrototype),e.classNatives)for(var i=0;i<e.classNatives.length;i++)copyOwnPropertyDescriptors(t,e.classNatives[i],filter);if(copyOwnPropertyDescriptors(t,e,filter,!0,!0),t.superClass,e.instanceNatives)for(i=0;i<e.instanceNatives.length;i++)copyOwnPropertyDescriptors(t.dPrototype,e.instanceNatives[i],filter);copyOwnPropertyDescriptors(t.dPrototype,e.prototype,filter),copyPropertiesByList(t.dPrototype,e.prototype,axTrapNames),e.classInitializer&&e.classInitializer.call(t,e),runtimeWriter&&traceASClass(t,e)}function tryLinkNativeClass(t){var e=t.classInfo.instanceInfo.getClassName(),i=builtinNativeClasses[e]||nativeClasses[e];i&&linkClass(t,i)}function getNativeInitializer(t){var e=t.instanceInfo.getInitializer(),i=t.instanceInfo.getClassName(),r=builtinNativeClasses[i]||nativeClasses[i];return e.isNative()?r:null}var createContainersFromPath=function(t,e){for(var i=0,r=t.length;i<r;i++)e[t[i]]||(e[t[i]]=Object.create(null)),e=e[t[i]];return e};function defineClassLoader(t,e,i,r){Object.defineProperty(e,r,{get:function(){runtimeWriter&&runtimeWriter.writeLn("Running Memoizer: "+i.name);var n=t.getClass(i),o=function(){return n.axConstruct(arguments)};return o.axIsType=function(t){return n.axIsType(t)},o.axClass=n,Object.defineProperty(e,r,{value:o,writable:!1}),o},configurable:!0})}function makeClassLoader(t,e,i,r,n){runtimeWriter&&runtimeWriter.writeLn("Defining Memoizer: "+i);var o=r.split("."),s=o.pop();defineClassLoader(t,e=createContainersFromPath(o,e),Multiname.FromFQNString(i,n),s)}function installClassLoaders(t,e){for(var i=0;i<nativeClassLoaderNames.length;i++){makeClassLoader(t,e,nativeClassLoaderNames[i].name,nativeClassLoaderNames[i].alias,nativeClassLoaderNames[i].nsType)}}function installNativeFunctions(t){for(var e in nativeFunctions){var i=e.split("."),r=i.pop();createContainersFromPath(i,t)[r]=t.boxFunction(nativeFunctions[e])}}function axInterfaceInitializer(){this.sec.throwError("VerifierError",Errors$1.NotImplementedError,this.name.name)}function axIsInstanceOfInterface(t){return!1}function axIsTypeInterface(t){return!(!t||"object"!=typeof t)&&t.axImplementsInterface(this)}function applyTraits(t,e){defineReadOnlyProperty(t,"traits",e);for(var i=e.getTraitsList(),r=0;r<i.length;r++){var n=i[r],o=n;o.value instanceof Namespace&&(o={value:ASNamespace.FromNamespace.call(t.sec.AXNamespace,o.value)}),Object.defineProperty(t,n.name.getMangledName(),o)}}function axCoerce(t){return isNullOrUndefined$1(t)?null:(this.axIsType(t)||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,t,this.classInfo.instanceInfo.getClassName()),t)}function axIsInstanceOfObject(t){return this.dPrototype.isPrototypeOf(this.sec.box(t))}var ActiveLoaderContext=function(){};function axConstruct(t){for(var e=Object.create(this.tPrototype),i=null,r=null,n=this;n&&!r;)(i=n._symbol)&&i.timeline&&(r=i.timeline),n=n.superClass;if(r){var o=new MovieClip(r);e.adaptee=o,o.timelineMC=!0,o.reset(),e.noReset=!0,FrameScriptManager.execute_as3_constructors(),OrphanManager.addOrphan(e)}if(this.superClass&&this.superClass.classInfo&&this.superClass.classInfo.instanceInfo&&"Sound"==this.superClass.classInfo.instanceInfo.name.name)ActiveLoaderContext.loaderContext?(s=ActiveLoaderContext.loaderContext.applicationDomain.getAwayJSAudio(this.classInfo.instanceInfo.name.name))&&s.isAsset(WaveAudio)?e.adaptee=s:console.log("error: could not find audio for class",this.classInfo.instanceInfo.name.name,s):console.log("error: ActiveLoaderContext.loaderContext not set. can not rerieve Sound");else if(this.superClass&&this.superClass.classInfo&&this.superClass.classInfo.instanceInfo&&"BitmapData"==this.superClass.classInfo.instanceInfo.name.name){var s;if(ActiveLoaderContext.loaderContext)(s=ActiveLoaderContext.loaderContext.applicationDomain.getDefinition(this.classInfo.instanceInfo.name.name))&&s.isAsset(SceneImage2D)||s.isAsset(BitmapImage2D)?e.adaptee=s:console.log("error: could not find audio for class",this.classInfo.instanceInfo.name.name,s);else console.log("error: ActiveLoaderContext.loaderContext not set. can not rerieve Sound")}if(e.noReset=!0,e.getQueuedEvents){var a=e.getQueuedEvents();if(e.axInitializer.apply(e,t),a)for(var l=0;l<a.length;l++)e.dispatchEvent(a[l])}else e.axInitializer.apply(e,t);return e}function axDefaultApply(t,e){return this.axCoerce(e?e[0]:void 0)}function axDefaultInitializer(){}function axGetArgumentsCallee(){var t=this.callee;if(t)return t;if(null===this.methodInfo.trait)return console.error("arguments.callee used on trait-less methodInfo function. Probably a constructor"),null;var e=this.methodInfo.trait.name;return this.receiver.axGetProperty(e)}function axCoerceBoolean(t){return!!t}function axIsTypeBoolean(t){return"boolean"==typeof t}function axIsTypeString(t){return"string"==typeof t}function axIsTypeNumber(t){return"number"==typeof t}function axCoerceInt(t){return 0|t}function axFalse(){return!1}function axIsTypeInt(t){return"number"==typeof t&&(0|t)===t}function axCoerceUint(t){return t>>>0}function axIsTypeUint(t){return"number"==typeof t&&t>>>0===t}function axBoxIdentity(t){return t[0]}function axIsTypeObject(t){return this.dPrototype.isPrototypeOf(this.sec.box(t))||t===this.dPrototype}function axAsType(t){return this.axIsType(t)?t:null}function axBoxPrimitive(t){var e=Object.create(this.tPrototype);return e.value=t,e}function axApplyObject(t,e){var i=e[0];return null==i?Object.create(this.tPrototype):i}function axConstructObject(t){var e=t[0];return null==e?Object.create(this.tPrototype):e}function axCoerceObject(t){return null==t?null:t}var AXSecurityDomain=function(){function t(){initializeAXBasePrototype(),this.system=new AXApplicationDomain(this,null),this.application=new AXApplicationDomain(this,this.system),this.classAliases=new ClassAliases,this.nativeClasses=Object.create(null),this.vectorClasses=new Map,this._catalogs=[]}return Object.defineProperty(t.prototype,"xmlParser",{get:function(){return this._xmlParser||(this._xmlParser=new XMLParser(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"AXFunctionUndefinedPrototype",{get:function(){return this._AXFunctionUndefinedPrototype||(this._AXFunctionUndefinedPrototype=this.createObject())},enumerable:!0,configurable:!0}),t.prototype.addCatalog=function(t){this._catalogs.push(t)},t.prototype.findDefiningABC=function(t){runtimeWriter&&runtimeWriter.writeLn("findDefiningABC: "+t);for(var e=null,i=0;i<this._catalogs.length;i++){if(e=this._catalogs[i].getABCByMultiname(t))return e}return null},t.prototype.throwError=function(t,e,i,r,n,o){throw this.createError.apply(this,arguments)},t.prototype.createError=function(t,e,i,r,n,o){var s=formatErrorMessage.apply(null,sliceArguments(arguments,1)),a=Multiname.FromFQNString(t,0),l=this.system.getProperty(a,!0,!0);return l.axConstruct([s,e.code])},t.prototype.applyType=function(t,e){this.ObjectVector.axClass.superClass.dPrototype.isPrototypeOf(t.dPrototype)||this.throwError("TypeError",Errors$1.TypeAppOfNonParamType),1!==e.length&&this.throwError("TypeError",Errors$1.WrongTypeArgCountError,"__AS3__.vec::Vector",1,e.length);var i=e[0]||this.AXObject;return this.getVectorClass(i)},t.prototype.getVectorClass=function(t){var e=this.vectorClasses.get(t);if(e)return e;switch(t?t.classInfo.instanceInfo.getName().getMangledName():"$BgObject"){case"$BgNumber":case"$Bgdouble":e=this.Float64Vector.axClass;break;case"$Bgint":e=this.Int32Vector.axClass;break;case"$Bguint":e=this.Uint32Vector.axClass;break;default:e=this.createVectorClass(t)}return this.vectorClasses.set(t,e),e},t.prototype.createVectorClass=function(t){var e=this.ObjectVector.axClass,i=Object.create(e);return i.tPrototype=Object.create(e.tPrototype),i.tPrototype.axClass=i,i.dPrototype=e.dPrototype,i.superClass=e,i.type=t,i},t.prototype.createObject=function(){return Object.create(this.AXObject.tPrototype)},t.prototype.createObjectFromJS=function(t,e){void 0===e&&(e=!1);for(var i=Object.keys(t),r=this.createObject(),n=0;n<i.length;n++){var o=t[i[n]];e&&(o=transformJSValueToAS(this,o,!0)),r.axSetPublicProperty(i[n],o)}return r},t.prototype.createArrayUnsafe=function(t){var e=Object.create(this.AXArray.tPrototype);return e.value=t,e},t.prototype.createArray=function(t){var e=this.createArrayUnsafe([]);for(var i in t)e.axSetPublicProperty(i,t[i]);return e.length=t.length,e},t.prototype.boxFunction=function(t){var e=Object.create(this.AXFunction.tPrototype);return e.value=t,e},t.prototype.createClass=function(t,e,i){var r=t.instanceInfo,n=r.getName().toFQNString(!1),o=this.nativeClasses[n]||Object.create(this.AXClass.tPrototype),s=new Scope(i,o);this.nativeClasses[n]?o.tPrototype.axInitializer=this.createInitializerFunction(t,s):r.isInterface()?(o.dPrototype=Object.create(this.objectPrototype),o.tPrototype=Object.create(o.dPrototype),o.tPrototype.axInitializer=axInterfaceInitializer,o.axIsInstanceOf=axIsInstanceOfInterface,o.axIsType=axIsTypeInterface):(e===this.AXObject?o.dPrototype=Object.create(this.objectPrototype):o.dPrototype=Object.create(e.dPrototype),o.tPrototype=Object.create(o.dPrototype),o.tPrototype.axInitializer=this.createInitializerFunction(t,s)),o.classInfo=o.dPrototype.classInfo=t,o.dPrototype.axClass=o,o.superClass=e,o.scope=i,"Object"!==n&&"Class"!==n&&this.initializeRuntimeTraits(o,e,s),defineNonEnumerableProperty(o.dPrototype,"$Bgconstructor",o),tryLinkNativeClass(o);var a=t.getInitializer(),l=a.getBody().code;return 208===l[0]&&48===l[1]&&71===l[2]||interpret(a,s,null).apply(o,[o]),o},t.prototype.initializeRuntimeTraits=function(t,e,i){var r,n=t.classInfo,o=n.instanceInfo;if(t===this.AXClass)r=o.traits.resolveRuntimeTraits(null,null,i);else{var s=this.AXClass.classInfo.instanceInfo.runtimeTraits;r=n.traits.resolveRuntimeTraits(s,null,i.parent)}n.runtimeTraits=r,applyTraits(t,r);var a=e?e.classInfo.instanceInfo.runtimeTraits:null,l=n.abc.getNamespace(o.protectedNs),h=o.traits.resolveRuntimeTraits(a,l,i);o.runtimeTraits=h,applyTraits(t.tPrototype,h)},t.prototype.createFunction=function(t,e,i){var r=this.boxFunction(interpret(t,e,r));return r.receiver={scope:e},r},t.prototype.createInitializerFunction=function(t,e){var i=t.instanceInfo.getInitializer(),r=getNativeInitializer(t);if(!r){var n=this.application.getBinarySymbol(t.instanceInfo.getClassName());n?(n.buffer=n.data,r=function(){return console.log("create instance for binary data:",t.instanceInfo.getClassName()),ByteArrayDataProvider.symbolForConstructor=n,interpret(i,e,null).apply(this,arguments)}):r=interpret(i,e,null),r.methodInfo=i}return r},t.prototype.createActivation=function(t,e){var i=t.getBody();return i.activationPrototype||(i.traits.resolve(),i.activationPrototype=Object.create(this.AXActivationPrototype),defineReadOnlyProperty(i.activationPrototype,"traits",i.traits.resolveRuntimeTraits(null,null,e))),Object.create(i.activationPrototype)},t.prototype.createCatch=function(t,e){if(!t.catchPrototype){var i=t.getTraits();t.catchPrototype=Object.create(this.AXCatchPrototype),defineReadOnlyProperty(t.catchPrototype,"traits",i.resolveRuntimeTraits(null,null,e))}return Object.create(t.catchPrototype)},t.prototype.box=function(t){if(null==t)return t;if(t.constructor===Array)return this.AXArray.axBox(t);var e=typeof t;return"number"===e?this.AXNumber.axBox(t):"boolean"===e?this.AXBoolean.axBox(t):"string"===e?this.AXString.axBox(t):t},t.prototype.isPrimitive=function(t){return isPrimitiveJSValue(t)||this.AXPrimitiveBox.dPrototype.isPrototypeOf(t)},t.prototype.createAXGlobal=function(t,e){var i=Object.create(this.AXGlobalPrototype);i.applicationDomain=t,i.scriptInfo=e;var r=i.scope=new Scope(null,i,!1),n=this.AXObject.classInfo.instanceInfo.runtimeTraits;return applyTraits(i,e.traits.resolveRuntimeTraits(n,null,r)),i},t.prototype.prepareRootClassPrototype=function(){var t=Object.create(this.objectPrototype),e=Object.create(t);e.$BgtoString=function(){return"[class "+this.classInfo.instanceInfo.getName().name+"]"};var i=defineNonEnumerableProperty;i(e,"axBox",axBoxIdentity),i(e,"axCoerce",axCoerce),i(e,"axIsType",axIsTypeObject),i(e,"axAsType",axAsType),i(e,"axIsInstanceOf",axIsInstanceOfObject),i(e,"axConstruct",axConstruct),i(e,"axApply",axDefaultApply),Object.defineProperty(e,"name",{get:function(){return this.classInfo.instanceInfo.name}}),this.rootClassPrototype=e},t.prototype.initializeCoreNatives=function(){this.prepareRootClassPrototype();var t=this.prepareNativeClass("AXClass","Class",!1);t.classInfo=this.system.findClassInfo("Class"),t.defaultValue=null,(e=this.prepareNativeClass("AXObject","Object",!1)).classInfo=this.system.findClassInfo("Object");var e=this.AXObject;defineNonEnumerableProperty(this.prepareNativeClass("AXFunction","Function",!1),"axBox",axBoxPrimitive);var i=new Scope(null,t,!1),r=this.AXObject.classInfo,n=r.instanceInfo,o=n.runtimeTraits=n.traits.resolveRuntimeTraits(null,null,i);applyTraits(this.AXObject.tPrototype,o);var s=this.AXClass.classInfo,a=s.instanceInfo;return a.runtimeTraits=a.traits.resolveRuntimeTraits(o,null,i),applyTraits(this.AXClass.tPrototype,a.runtimeTraits),s.runtimeTraits=s.traits.resolveRuntimeTraits(o,null,i),applyTraits(this.AXClass,s.runtimeTraits),r.runtimeTraits=r.traits.resolveRuntimeTraits(a.runtimeTraits,null,i),applyTraits(this.AXObject,r.runtimeTraits),e},t.prototype.prepareNativeClass=function(t,e,i){var r=Object.create(this.rootClassPrototype);if("Object"===e)r.dPrototype=Object.getPrototypeOf(this.objectPrototype),r.tPrototype=this.objectPrototype;else if("Class"===e)r.dPrototype=Object.getPrototypeOf(this.rootClassPrototype),r.tPrototype=this.rootClassPrototype;else{var n=i?this.AXPrimitiveBox.dPrototype:"AXMethodClosure"===t?this.AXFunction.dPrototype:this.objectPrototype;r.dPrototype=Object.create(n),r.tPrototype=Object.create(r.dPrototype)}return this[t]=this.nativeClasses[e]=r,r},t.prototype.preparePrimitiveClass=function(t,e,i,r,n,o,s){var a=this.prepareNativeClass(t,e,!0),l=defineNonEnumerableProperty;return l(a,"axBox",axBoxPrimitive),l(a,"axApply",(function(t,e){return i(e&&e.length?e[0]:r)})),l(a,"axConstruct",(function(t){return i(t&&t.length?t[0]:r)})),l(a,"axCoerce",n),l(a,"axIsType",o),l(a,"axIsInstanceOf",s),l(a.dPrototype,"value",r),a},t.prototype.initialize=function(){var t=defineNonEnumerableProperty,e=Object.create(AXBasePrototype);e.sec=this,Object.defineProperty(this,"objectPrototype",{value:Object.create(e)}),this.initializeCoreNatives(),this.AXGlobalPrototype=Object.create(this.objectPrototype),this.AXGlobalPrototype.$BgtoString=function(){return"[object global]"},this.AXActivationPrototype=Object.create(this.objectPrototype),this.AXActivationPrototype.$BgtoString=function(){return"[Activation]"},this.AXCatchPrototype=Object.create(this.objectPrototype),this.AXCatchPrototype.$BgtoString=function(){return"[Catch]"};var i=this.AXObject,r=this.AXFunction;t(i,"axApply",axApplyObject),t(i,"axConstruct",axConstructObject),t(i.tPrototype,"axInitializer",axDefaultInitializer),t(i,"axCoerce",axCoerceObject),this.prepareNativeClass("AXMethodClosure","builtin.as$0.MethodClosure",!1),this.prepareNativeClass("AXError","Error",!1),this.prepareNativeClass("AXMath","Math",!1),this.prepareNativeClass("AXDate","Date",!1),this.prepareNativeClass("AXXML","XML",!1),this.prepareNativeClass("AXXMLList","XMLList",!1),this.prepareNativeClass("AXQName","QName",!1),this.prepareNativeClass("AXNamespace","Namespace",!1);var n=this.prepareNativeClass("AXArray","Array",!1);t(n,"axBox",axBoxPrimitive),n.tPrototype.$BgtoString=r.axBox((function(){return this.value.toString()})),n.dPrototype.value=[],this.argumentsPrototype=Object.create(this.AXArray.tPrototype),Object.defineProperty(this.argumentsPrototype,"$Bgcallee",{get:axGetArgumentsCallee}),this.prepareNativeClass("AXRegExp","RegExp",!1).dPrototype.value=/(?:)/,t(this.prepareNativeClass("AXPrimitiveBox","PrimitiveBox",!1).dPrototype,"$BgtoString",r.axBox((function(){return this.value.toString()})));this.preparePrimitiveClass("AXBoolean","Boolean",axCoerceBoolean,!1,axCoerceBoolean,axIsTypeBoolean,axIsTypeBoolean),this.preparePrimitiveClass("AXString","String",axConvertString,"",axCoerceString$3,axIsTypeString,axIsTypeString),this.preparePrimitiveClass("AXNumber","Number",axCoerceNumber,0,axCoerceNumber,axIsTypeNumber,axIsTypeNumber),this.preparePrimitiveClass("AXInt","int",axCoerceInt,0,axCoerceInt,axIsTypeInt,axFalse),this.preparePrimitiveClass("AXUint","uint",axCoerceUint,0,axCoerceUint,axIsTypeUint,axFalse);installClassLoaders(this.application,this),installNativeFunctions(this)},t}(),AVM2LoadLibrariesFlags;function createSecurityDomain(t){var e=new PromiseWrapper;return console.log("createSecurityDomain"),console.log("Load builton.abc file"),BrowserSystemResourcesLoadingService.getInstance().load("./assets/builtins/builtin.abc","arraybuffer").then((function(i){var r=new AXSecurityDomain,n={url:"builtin.abc",app:r.system},o=new ABCFile(n,new Uint8Array(i));if(r.system.loadABC(o),r.initialize(),r.system.executeABC(o),t&AVM2LoadLibrariesFlags.Playerglobal)return Promise.all([BrowserSystemResourcesLoadingService.getInstance().load("./assets/builtins/playerglobal.abcs","arraybuffer"),BrowserSystemResourcesLoadingService.getInstance().load("./assets/builtins/playerglobal.json","json")]).then((function(t){console.log("Load playerglobal.abcs & playerglobal.json");var i=new ABCCatalog(r.system,new Uint8Array(t[0]),t[1]);console.log("add playerglobals as ABCCatalog"),r.addCatalog(i),BrowserSystemResourcesLoadingService.getInstance().load("./assets/builtins/avmplus.abc","arraybuffer").then((function(t){var i={url:"avmplus.File",app:r.system},n=new ABCFile(i,new Uint8Array(t));r.system.loadABC(n),r.system.executeABC(n),e.resolve(r)}),e.reject)}),e.reject);e.resolve(r)}),e.reject),e.promise}!function(t){t[t.Builtin=1]="Builtin",t[t.Playerglobal=2]="Playerglobal",t[t.Shell=4]="Shell"}(AVM2LoadLibrariesFlags||(AVM2LoadLibrariesFlags={}));var ASClass$1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.axCoerce=function(t){return t},Object.defineProperty(e.prototype,"prototype",{get:function(){return this.dPrototype},enumerable:!0,configurable:!0}),e.classInitializer=null,e}(ASObject$1);function ensureBoxedReceiver(t,e,i){if(e&&"object"==typeof e)return e;var r=t.box(e);return r||(scopeStacks.length?r=scopeStacks[scopeStacks.length-1].topScope().global.object:i.receiver&&(r=i.receiver.scope.global.object)),r}var ASFunction$1=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._prototypeInitialzed=!1,e}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$Bgcall",i.call),addPrototypeFunctionAlias(t,"$Bgapply",i.apply),defineNonEnumerableProperty(t,"value",i.native_functionValue)},e.prototype.setReceiver=function(t){this.receiver=t},e.prototype.axConstruct=function(t){var e=this.prototype;isNullOrUndefined(e)&&(e=this.sec.AXFunctionUndefinedPrototype);var i=Object.create(e);return i.__ctorFunction=this,this.value.apply(i,t),i},e.prototype.axIsInstanceOf=function(t){return t&&t.__ctorFunction===this},e.prototype.native_functionValue=function(){},Object.defineProperty(e.prototype,"prototype",{get:function(){return this._prototypeInitialzed||(this._prototype=Object.create(this.sec.AXObject.tPrototype),this._prototypeInitialzed=!0),this._prototype},set:function(t){isNullOrUndefined(t)?t=void 0:("object"!=typeof t||this.sec.isPrimitive(t))&&this.sec.throwError("TypeError",Errors$1.PrototypeTypeError),this._prototypeInitialzed=!0,this._prototype=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.value.methodInfo?this.value.methodInfo.parameters.length:this.value.length},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"function Function() {}"},e.prototype.call=function(t){return t=ensureBoxedReceiver(this.sec,t,this),this.value.apply(t,sliceArguments(arguments,1))},e.prototype.apply=function(t,e){return t=ensureBoxedReceiver(this.sec,t,this),this.value.apply(t,e?e.value:void 0)},e.prototype.axCall=function(t){return this.value.apply(t,sliceArguments(arguments,1))},e.prototype.axApply=function(t,e){return this.value.apply(t,e)},e}(ASObject$1),ASMethodClosure=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;defineNonEnumerableProperty(t,"$Bgcall",i.call),defineNonEnumerableProperty(t,"$Bgapply",i.apply)},e.Create=function(t,e){var i=Object.create(this.sec.AXMethodClosure.tPrototype);return i.receiver=t,i.value=e,i.methodInfo=e.methodInfo,i},Object.defineProperty(e.prototype,"prototype",{get:function(){return null},set:function(t){this.sec.throwError("ReferenceError",Errors$1.ConstWriteError,"prototype","MethodClosure")},enumerable:!0,configurable:!0}),e.prototype.axCall=function(t){return this.value.apply(this.receiver,sliceArguments(arguments,1))},e.prototype.axApply=function(t,e){return this.value.apply(this.receiver,e)},e.prototype.call=function(t){return this.value.apply(this.receiver,sliceArguments(arguments,1))},e.prototype.apply=function(t,e){return this.value.apply(this.receiver,e?e.value:void 0)},e}(ASFunction$1),ASInt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgtoLocaleString",i.toString),addPrototypeFunctionAlias(t,"$BgvalueOf",i.valueOf),defineNonEnumerableProperty(this,"$BgMAX_VALUE",2147483647),defineNonEnumerableProperty(this,"$BgMIN_VALUE",-2147483648)},e.prototype.toString=function(t){return 0===arguments.length?t=10:((t|=0)<2||t>36)&&this.sec.throwError("RangeError",Errors$1.InvalidRadixError,t),this.axClass!==this.sec.AXNumber&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"Number.prototype.toString"),this.value.toString(t)},e.prototype.valueOf=function(){return this.axClass!==this.sec.AXNumber&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"Number.prototype.valueOf"),this.value},e.staticNatives=[Math],e.instanceNatives=[ASNumber$1.prototype],e}(ASNumber$1);function transformJStoASRegExpMatchArray(t,e){var i=t.createArray(e);return i.axSetPublicProperty("index",e.index),i.axSetPublicProperty("input",e.input),i}function as3ToLowerCase(t){for(var e=null,i=0;i<t.length;i++){var r=t.charCodeAt(i);r>=4256&&r<=4293&&(e||(e=new Array(t.length)),e[i]=String.fromCharCode(r+48))}if(e){for(i=0;i<e.length;i++){e[i]||(e[i]=t.charAt(i).toLocaleString())}return e.join("")}return t.toLowerCase()}var ASString$1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgindexOf",i.generic_indexOf),addPrototypeFunctionAlias(t,"$BglastIndexOf",i.generic_lastIndexOf),addPrototypeFunctionAlias(t,"$BgcharAt",i.generic_charAt),addPrototypeFunctionAlias(t,"$BgcharCodeAt",i.generic_charCodeAt),addPrototypeFunctionAlias(t,"$Bgconcat",i.generic_concat),addPrototypeFunctionAlias(t,"$BglocaleCompare",i.generic_localeCompare),addPrototypeFunctionAlias(t,"$Bgmatch",i.generic_match),addPrototypeFunctionAlias(t,"$Bgreplace",i.generic_replace),addPrototypeFunctionAlias(t,"$Bgsearch",i.generic_search),addPrototypeFunctionAlias(t,"$Bgslice",i.generic_slice),addPrototypeFunctionAlias(t,"$Bgsplit",i.generic_split),addPrototypeFunctionAlias(t,"$Bgsubstring",i.generic_substring),addPrototypeFunctionAlias(t,"$Bgsubstr",i.generic_substr),addPrototypeFunctionAlias(t,"$BgtoLowerCase",i.generic_toLowerCase),addPrototypeFunctionAlias(t,"$BgtoLocaleLowerCase",i.generic_toLowerCase),addPrototypeFunctionAlias(t,"$BgtoUpperCase",i.generic_toUpperCase),addPrototypeFunctionAlias(t,"$BgtoLocaleUpperCase",i.generic_toUpperCase),addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgtoString",i.public_toString),addPrototypeFunctionAlias(t,"$BgvalueOf",i.public_valueOf),addPrototypeFunctionAlias(this,"$BgfromCharCode",e.fromCharCode)},e.fromCharCode=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return String.fromCharCode.apply(null,t)},e.prototype.indexOf=function(t,e){return this.value.indexOf(t,e)},e.prototype.lastIndexOf=function(t,e){return this.value.lastIndexOf(t,e)},e.prototype.charAt=function(t){return this.value.charAt(t)},e.prototype.charCodeAt=function(t){return this.value.charCodeAt(t)},e.prototype.concat=function(){return this.value.concat.apply(this.value,arguments)},e.prototype.localeCompare=function(t){arguments.length>1&&this.sec.throwError("ArgumentError",Errors$1.WrongArgumentCountError,"Function/<anonymous>()",0,2);var e=this.value;if((t=String(t))===e)return 0;for(var i=Math.min(e.length,t.length),r=0;r<i;r++)if(e[r]!==t[r])return e.charCodeAt(r)-t.charCodeAt(r);return e.length>t.length?1:-1},e.prototype.match=function(t){t=this.sec.AXRegExp.axIsType(t)?t.value:axCoerceString$3(t);var e=this.value.match(t);if(!e)return null;try{return transformJStoASRegExpMatchArray(this.sec,e)}catch(t){return null}},e.prototype.replace=function(t,e){t=this.sec.AXRegExp.axIsType(t)?t.value:axCoerceString$3(t),this.sec.AXFunction.axIsType(e)&&(e=e.value);try{return this.value.replace(t,e)}catch(t){return this.value}},e.prototype.search=function(t){t=this.sec.AXRegExp.axIsType(t)?t.value:axCoerceString$3(t);try{return this.value.search(t)}catch(t){return-1}},e.prototype.slice=function(t,e){return t=arguments.length<1?0:0|t,e=arguments.length<2?4294967295:0|e,this.value.slice(t,e)},e.prototype.split=function(t,e){t=this.sec.AXRegExp.axIsType(t)?t.value:axCoerceString$3(t),e=void 0===e?-1:0|e;try{return this.sec.createArray(this.value.split(t,e))}catch(t){return this.sec.createArrayUnsafe([this.value])}},e.prototype.substring=function(t,e){return this.value.substring(t,e)},e.prototype.substr=function(t,e){return this.value.substr(t,e)},e.prototype.toLocaleLowerCase=function(){return this.value.toLowerCase()},e.prototype.toLowerCase=function(){return as3ToLowerCase(this.value)},e.prototype.toLocaleUpperCase=function(){return this.value.toUpperCase()},e.prototype.toUpperCase=function(){return this.value.toUpperCase()},e.prototype.generic_indexOf=function(t,e){var i=null==this?"":this;return String.prototype.indexOf.call(i,t,e)},e.prototype.generic_lastIndexOf=function(t,e){var i=null==this?"":this;return String.prototype.lastIndexOf.call(i,t,e)},e.prototype.generic_charAt=function(t){var e=null==this?"":this;return String.prototype.charAt.call(e,t)},e.prototype.generic_charCodeAt=function(t){var e=null==this?"":this;return String.prototype.charCodeAt.call(e,t)},e.prototype.generic_concat=function(){var t=null==this?"":this;return String.prototype.concat.apply(t,arguments)},e.prototype.generic_localeCompare=function(t){var e=this.sec.AXString.axBox(String(this));return e.localeCompare.apply(e,arguments)},e.prototype.generic_match=function(t){return this.sec.AXString.axBox(String(this)).match(t)},e.prototype.generic_replace=function(t,e){return this.sec.AXString.axBox(String(this)).replace(t,e)},e.prototype.generic_search=function(t){return this.sec.AXString.axBox(String(this)).search(t)},e.prototype.generic_slice=function(t,e){var i=null==this?"":this;return String.prototype.slice.call(i,t,e)},e.prototype.generic_split=function(t,e){return e=arguments.length<2?4294967295:0|e,this.sec.AXString.axBox(String(this)).split(t,e)},e.prototype.generic_substring=function(t,e){var i=null==this?"":this;return String.prototype.substring.call(i,t,e)},e.prototype.generic_substr=function(t,e){var i=null==this?"":this;return String.prototype.substr.call(i,t,e)},e.prototype.generic_toLowerCase=function(){var t=null==this?"":this;return as3ToLowerCase(String(t))},e.prototype.generic_toUpperCase=function(){var t=null==this?"":this;return String.prototype.toUpperCase.call(t)},e.prototype.toString=function(){return this.value.toString()},e.prototype.public_toString=function(){return this===this.sec.AXString.dPrototype?"":(this.axClass!==this.sec.AXString&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"String.prototype.toString"),this.value.toString())},e.prototype.valueOf=function(){return this.value.valueOf()},e.prototype.public_valueOf=function(){return this===this.sec.AXString.dPrototype?"":(this.axClass!==this.sec.AXString&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"String.prototype.valueOf"),this.value.valueOf())},Object.defineProperty(e.prototype,"length",{get:function(){return this.value.length},enumerable:!0,configurable:!0}),e.classNatives=[String],e}(ASObject$1),ASUint=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgtoLocaleString",i.toString),addPrototypeFunctionAlias(t,"$BgvalueOf",i.valueOf),defineNonEnumerableProperty(this,"$BgMAX_VALUE",4294967295),defineNonEnumerableProperty(this,"$BgMIN_VALUE",0)},e.prototype.toString=function(t){return 0===arguments.length?t=10:((t|=0)<2||t>36)&&this.sec.throwError("RangeError",Errors$1.InvalidRadixError,t),this.axClass!==this.sec.AXNumber&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"Number.prototype.toString"),this.value.toString(t)},e.prototype.valueOf=function(){return this.axClass!==this.sec.AXNumber&&this.sec.throwError("TypeError",Errors$1.InvokeOnIncompatibleObjectError,"Number.prototype.valueOf"),this.value},e.staticNatives=[Math],e.instanceNatives=[ASNumber$1.prototype],e}(ASNumber$1),ASBoolean$1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgvalueOf",i.valueOf)},e.prototype.toString=function(){return this.value.toString()},e.prototype.valueOf=function(){return this.value.valueOf()},e}(ASObject$1);function coerceArray(t){if(!t||!t.sec)throw new TypeError("Conversion to Array failed");return t.sec.AXArray.axCoerce(t)}function createArrayValueFromArgs(t,e){if(1===e.length&&"number"==typeof e[0]){var i=e[0];try{return new Array(i)}catch(e){t.throwError("RangeError",Errors$1.ArrayIndexNotIntegerError,i)}}return Array.apply(Array,e)}function axDefaultCompareFunction(t,e){return String(t).localeCompare(String(e))}function axCompare(t,e,i,r,n){return 1&i&&(t=String(t).toLowerCase(),e=String(e).toLowerCase()),(16&i?(t=+t)<(e=+e)?-1:t>e?1:0:n(t,e))*r}function axCompareFields(t,e,i,r){var n,o=0;for(n=0;n<i.length&&0===o;n++){var s=i[n],a=t[s],l=e[s],h=r[n];1&h&&(a=String(a).toLowerCase(),l=String(l).toLowerCase()),o=16&h?(a=+a)<(l=+l)?-1:a>l?1:0:String(a).localeCompare(String(l))}return 2&r[n-1]&&(o*=-1),o}var ASArray$1=function(t){function e(){var e=t.call(this)||this;return e.value=createArrayValueFromArgs(e.sec,arguments),e}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;defineNonEnumerableProperty(this,"$BgCASEINSENSITIVE",1),defineNonEnumerableProperty(this,"$BgDESCENDING",2),defineNonEnumerableProperty(this,"$BgUNIQUESORT",4),defineNonEnumerableProperty(this,"$BgRETURNINDEXEDARRAY",8),defineNonEnumerableProperty(this,"$BgNUMERIC",16),addPrototypeFunctionAlias(t,"$Bgpush",i.generic_push),addPrototypeFunctionAlias(t,"$Bgpop",i.generic_pop),addPrototypeFunctionAlias(t,"$Bgshift",i.generic_shift),addPrototypeFunctionAlias(t,"$Bgunshift",i.generic_unshift),addPrototypeFunctionAlias(t,"$Bgreverse",i.generic_reverse),addPrototypeFunctionAlias(t,"$Bgconcat",i.generic_concat),addPrototypeFunctionAlias(t,"$Bgslice",i.generic_slice),addPrototypeFunctionAlias(t,"$Bgsplice",i.generic_splice),addPrototypeFunctionAlias(t,"$Bgjoin",i.generic_join),addPrototypeFunctionAlias(t,"$BgtoString",i.generic_toString),addPrototypeFunctionAlias(t,"$BgindexOf",i.generic_indexOf),addPrototypeFunctionAlias(t,"$BglastIndexOf",i.generic_lastIndexOf),addPrototypeFunctionAlias(t,"$Bgevery",i.generic_every),addPrototypeFunctionAlias(t,"$Bgsome",i.generic_some),addPrototypeFunctionAlias(t,"$BgforEach",i.generic_forEach),addPrototypeFunctionAlias(t,"$Bgmap",i.generic_map),addPrototypeFunctionAlias(t,"$Bgfilter",i.generic_filter),addPrototypeFunctionAlias(t,"$Bgsort",i.generic_sort),addPrototypeFunctionAlias(t,"$BgsortOn",i.generic_sortOn),addPrototypeFunctionAlias(t,"$BghasOwnProperty",i.native_hasOwnProperty),addPrototypeFunctionAlias(t,"$BgpropertyIsEnumerable",i.native_propertyIsEnumerable),addPrototypeFunctionAlias(t,"$BgtoLocaleString",i.generic_toString)},e.prototype.native_hasOwnProperty=function(t){return this.axHasOwnProperty(makeMultiname(t))},e.prototype.native_propertyIsEnumerable=function(e){if("number"==typeof e||isNumeric(e=axCoerceName(e))){var i=Object.getOwnPropertyDescriptor(this.value,e);return!!i&&i.enumerable}t.prototype.native_propertyIsEnumerable.call(this,e)},e.axApply=function(t,e){return this.sec.createArrayUnsafe(createArrayValueFromArgs(this.sec,e))},e.axConstruct=function(t){return this.sec.createArrayUnsafe(createArrayValueFromArgs(this.sec,t))},e.prototype.push=function(){if(this.value.length+arguments.length>4294967295){for(var t=4294967295-this.value.length,e=0;e<t;e++)this.value.push(arguments[e]);return 4294967295}return this.value.push.apply(this.value,arguments)},e.prototype.generic_push=function(){if(this&&this.value instanceof Array)return this.push.apply(this,arguments);for(var t=this.axGetPublicProperty("length")>>>0,e=0;e<arguments.length;e++)this.axSetNumericProperty(t++,arguments[e]);return this.axSetPublicProperty("length",t),t},e.prototype.pop=function(){return this.value.pop()},e.prototype.generic_pop=function(){if(this&&this.value instanceof Array)return this.value.pop();var t=this.axGetPublicProperty("length")>>>0;if(t){var e=this.axGetNumericProperty(t-1);return rn.name=t-1,rn.namespaces=[Namespace.PUBLIC],this.axDeleteProperty(rn),this.axSetPublicProperty("length",t-1),e}this.axSetPublicProperty("length",0)},e.prototype.shift=function(){return this.value.shift()},e.prototype.generic_shift=function(){return coerceArray(this).shift()},e.prototype.unshift=function(){return this.value.unshift.apply(this.value,arguments)},e.prototype.generic_unshift=function(){var t=coerceArray(this);return t.value.unshift.apply(t.value,arguments)},e.prototype.reverse=function(){return this.value.reverse(),this},e.prototype.generic_reverse=function(){return coerceArray(this).reverse()},e.prototype.concat=function(){for(var t=this.value.slice(),e=0;e<arguments.length;e++){var i=arguments[e];"object"==typeof i&&i&&i.sec&&Array.isArray(i.value)?t.push.apply(t,i.value):t.push(i)}return this.sec.createArrayUnsafe(t)},e.prototype.generic_concat=function(){return coerceArray(this).concat.apply(this,arguments)},e.prototype.slice=function(t,e){return this.sec.createArray(this.value.slice(t,e))},e.prototype.generic_slice=function(t,e){return coerceArray(this).slice(t,e)},e.prototype.splice=function(){var t=this.value;if(0!==arguments.length)return this.sec.createArray(t.splice.apply(t,arguments))},e.prototype.generic_splice=function(){return coerceArray(this).splice.apply(this,arguments)},e.prototype.join=function(t){return this.value.join(t)},e.prototype.generic_join=function(t){return coerceArray(this).join(t)},e.prototype.toString=function(){return this.value.join(",")},e.prototype.generic_toString=function(){return coerceArray(this).join(",")},e.prototype.indexOf=function(t,e){return this.value.indexOf(t,0|e)},e.prototype.generic_indexOf=function(t,e){return coerceArray(this).indexOf(t,0|e)},e.prototype.lastIndexOf=function(t,e){return this.value.lastIndexOf(t,arguments.length>1?e:2147483647)},e.prototype.generic_lastIndexOf=function(t,e){return coerceArray(this).lastIndexOf(t,arguments.length>1?e:2147483647)},e.prototype.every=function(t,e){if(!t||!t.value||"function"!=typeof t.value)return!0;e=ensureBoxedReceiver(this.sec,e,t);for(var i=this.value,r=0;r<i.length;r++)if(!0!==t.value.call(e,i[r],r,this))return!1;return!0},e.prototype.generic_every=function(t,e){return coerceArray(this).every(t,e)},e.prototype.some=function(t,e){if(!t||!t.value||"function"!=typeof t.value)return!1;e=ensureBoxedReceiver(this.sec,e,t);var i=this;return this.value.some((function(r,n,o){return t.value.call(e,r,n,i)}))},e.prototype.generic_some=function(t,e){return coerceArray(this).some(t,e)},e.prototype.forEach=function(t,e){if(t&&t.value&&"function"==typeof t.value){e=ensureBoxedReceiver(this.sec,e,t);var i=this;this.value.forEach((function(r,n){t.value.call(e,r,n,i)}))}},e.prototype.generic_forEach=function(t,e){return coerceArray(this).forEach(t,e)},e.prototype.map=function(t,e){if(!t||!t.value||"function"!=typeof t.value)return this.sec.createArrayUnsafe([]);e=ensureBoxedReceiver(this.sec,e,t);var i=this;return this.sec.createArrayUnsafe(this.value.map((function(r,n){return t.value.call(e,r,n,i)})))},e.prototype.generic_map=function(t,e){return coerceArray(this).map(t,e)},e.prototype.filter=function(t,e){if(!t||!t.value||"function"!=typeof t.value)return this.sec.createArrayUnsafe([]);e=ensureBoxedReceiver(this.sec,e,t);for(var i=[],r=this.value,n=0;n<r.length;n++)!0===t.value.call(e,r[n],n,this)&&i.push(r[n]);return this.sec.createArrayUnsafe(i)},e.prototype.generic_filter=function(t,e){return coerceArray(this).filter(t,e)},e.prototype.toLocaleString=function(){for(var t=this.sec.AXArray.axCoerce(this).value,e="",i=0,r=t.length;i<r;i++){var n=t[i];null!=n&&(e+=n.toLocaleString()),i+1<r&&(e+=",")}return e},e.prototype.sort=function(){var t,e=this.value;if(0===arguments.length)return e.sort(),this;var i=0;if(this.sec.AXFunction.axIsInstanceOf(arguments[0])?t=arguments[0].value:isNumber(arguments[0])&&(i=arguments[0]),isNumber(arguments[1])&&(i=arguments[1]),!i)return e.sort(t),this;t||(t=axDefaultCompareFunction);var r=2&i?-1:1;return e.sort((function(e,n){return axCompare(e,n,i,r,t)})),this},e.prototype.generic_sort=function(){return coerceArray(this).sort.apply(this,arguments)},e.prototype.sortOn=function(t,e){0===arguments.length&&this.sec.throwError("ArgumentError",Errors$1.WrongArgumentCountError,"Array/http://adobe.com/AS3/2006/builtin::sortOn()","1","0");var i=this.value,r=[];if(isString(t))t=[Multiname.getPublicMangledName(t)],r=[0|e];else{if(!t||!Array.isArray(t.value))return this;t=t.value;for(var n=0;n<t.length;n++)t[n]=Multiname.getPublicMangledName(t[n]);if(e&&Array.isArray(e.value))if((e=e.value).length===t.length)for(n=0;n<e.length;n++)r[n]=0|e[n];else for(n=0;n<t.length;n++)r[n]=0;else{var o=0|e;for(n=0;n<t.length;n++)r[n]=o}}o=r[0];return i.sort((function(e,i){return axCompareFields(e,i,t,r)})),this},e.prototype.generic_sortOn=function(){return coerceArray(this).sortOn.apply(this,arguments)},Object.defineProperty(e.prototype,"length",{get:function(){return this.value.length},set:function(t){this.value.length=t>>>0},enumerable:!0,configurable:!0}),e.prototype.axGetEnumerableKeys=function(){return Object.keys(this.value).concat(t.prototype.axGetEnumerableKeys.call(this))},e.prototype.axHasPropertyInternal=function(t){var e=t.name;return"number"==typeof e||isNumeric(e=axCoerceName(e))?e in this.value:!!this.traits.getTrait(t.namespaces,e)||"$Bg"+e in this},e.prototype.axHasOwnProperty=function(t){var e=t.name;return"number"==typeof e||isNumeric(e=axCoerceName(e))?this.value.hasOwnProperty(e):!!this.traits.getTrait(t.namespaces,e)||this.hasOwnProperty("$Bg"+e)},e.prototype.axGetProperty=function(e){var i=e.name;return"number"==typeof i||isNumeric(i=axCoerceName(i))?this.value[i]:t.prototype.axGetProperty.call(this,e)},e.prototype.axSetProperty=function(e,i,r){var n=e.name;"number"==typeof n||isNumeric(n=axCoerceName(n))?this.value[n]=i:t.prototype.axSetProperty.call(this,e,i,r)},e.prototype.axDeleteProperty=function(t){var e=t.name;return"number"==typeof e||isNumeric(e=axCoerceName(e))?delete this.value[e]:!this.traits.getTrait(t.namespaces,e)&&delete this["$Bg"+e]},e.prototype.axGetPublicProperty=function(t){return"number"==typeof t||isNumeric(t=axCoerceName(t))?this.value[t]:this["$Bg"+t]},e.prototype.axSetPublicProperty=function(t,e){"number"==typeof t||isNumeric(t=axCoerceName(t))?this.value[t]=e:this["$Bg"+t]=e},e}(ASObject$1),Int32Vector=function(t){function e(i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var n=t.call(this)||this;return i>>>=0,n._fixed=!!r,n._buffer=new Int32Array(Math.max(e.INITIAL_CAPACITY,i+e.EXTRA_CAPACITY)),n._offset=0,n._length=i,n}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=this.tPrototype;i.axGetProperty=t.axGetProperty,i.axGetNumericProperty=t.axGetNumericProperty,i.axSetProperty=t.axSetProperty,i.axSetNumericProperty=t.axSetNumericProperty,i.axHasPropertyInternal=t.axHasPropertyInternal,i.axNextName=t.axNextName,i.axNextNameIndex=t.axNextNameIndex,i.axNextValue=t.axNextValue,t.axGetProperty=ASObject$1.prototype.axGetProperty,t.axGetNumericProperty=ASObject$1.prototype.axGetNumericProperty,t.axSetProperty=ASObject$1.prototype.axSetProperty,t.axSetNumericProperty=ASObject$1.prototype.axSetNumericProperty,t.axHasPropertyInternal=ASObject$1.prototype.axHasPropertyInternal,t.axNextName=ASObject$1.prototype.axNextName,t.axNextNameIndex=ASObject$1.prototype.axNextNameIndex,t.axNextValue=ASObject$1.prototype.axNextValue;var r=e.prototype;defineNonEnumerableProperty(t,"$Bgjoin",r.join),defineNonEnumerableProperty(t,"$BgtoString",r.join),defineNonEnumerableProperty(t,"$BgtoLocaleString",r.toLocaleString),defineNonEnumerableProperty(t,"$Bgpop",r.pop),defineNonEnumerableProperty(t,"$Bgpush",r.push),defineNonEnumerableProperty(t,"$Bgreverse",r.reverse),defineNonEnumerableProperty(t,"$Bgconcat",r.concat),defineNonEnumerableProperty(t,"$Bgsplice",r.splice),defineNonEnumerableProperty(t,"$Bgslice",r.slice),defineNonEnumerableProperty(t,"$Bgshift",r.shift),defineNonEnumerableProperty(t,"$Bgunshift",r.unshift),defineNonEnumerableProperty(t,"$BgindexOf",r.indexOf),defineNonEnumerableProperty(t,"$BglastIndexOf",r.lastIndexOf),defineNonEnumerableProperty(t,"$BgforEach",r.forEach),defineNonEnumerableProperty(t,"$Bgmap",r.map),defineNonEnumerableProperty(t,"$Bgfilter",r.filter),defineNonEnumerableProperty(t,"$Bgsome",r.some),defineNonEnumerableProperty(t,"$Bgevery",r.every),defineNonEnumerableProperty(t,"$Bgsort",r.sort),defineNonEnumerableProperty(t,"checkVectorMethodArgs",r.checkVectorMethodArgs)},e.axApply=function(t,e){var i=e[0];if(this.axIsType(i))return i;var r=i.axGetPublicProperty("length");if(void 0!==r){for(var n=this.axConstruct([r,!1]),o=0;o<r;o++)n.axSetNumericProperty(o,i.axGetPublicProperty(o));return n}unexpected()},e.prototype.internalToString=function(){for(var t="",e=this._offset,i=e+this._length,r=0;r<this._buffer.length;r++)r===e&&(t+="["),r===i&&(t+="]"),t+=this._buffer[r],r<this._buffer.length-1&&(t+=",");return this._offset+this._length===this._buffer.length&&(t+="]"),t+": offset: "+this._offset+", length: "+this._length+", capacity: "+this._buffer.length},e.prototype.toString=function(){for(var t="",e=0;e<this._length;e++)t+=this._buffer[this._offset+e],e<this._length-1&&(t+=",");return t},e.prototype.toLocaleString=function(){for(var t="",e=0;e<this._length;e++)t+=this._buffer[this._offset+e],e<this._length-1&&(t+=",");return t},e.prototype._view=function(){return this._buffer.subarray(this._offset,this._offset+this._length)},e.prototype._ensureCapacity=function(t){var e=this._offset+t;if(!(e<this._buffer.length)){if(t<=this._buffer.length){var i=this._buffer.length-t>>2;return this._buffer.set(this._view(),i),void(this._offset=i)}var r=1+(3*this._buffer.length>>1);r<e&&(r=e);var n=new Int32Array(r);n.set(this._buffer,0),this._buffer=n}},e.prototype.concat=function(){for(var t=this._length,e=0;e<arguments.length;e++){(o=arguments[e])._buffer instanceof Int32Array||assert(!1),t+=o._length}var i=new this.sec.Int32Vector(t),r=i._buffer;r.set(this._buffer);var n=this._length;for(e=0;e<arguments.length;e++){var o;n+(o=arguments[e])._buffer.length<o._buffer.length?r.set(o._buffer,n):r.set(o._buffer.subarray(0,o._length),n),n+=o._length}return i},e.prototype.every=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!0;for(var i=0;i<this._length;i++)if(!t.call(e,this._buffer[this._offset+i],i,this))return!1;return!0},e.prototype.filter=function(t,e){var i=new this.sec.Int32Vector;if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._length;r++)t.call(e,this._buffer[this._offset+r],r,this)&&i.push(this._buffer[this._offset+r]);return i},e.prototype.map=function(t,e){var i=this.axClass.axConstruct([this.length,!1]);if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._length;r++)i[r]=t.call(e,this._buffer[this._offset+r],r,this);return i},e.prototype.some=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!1;for(var i=0;i<this._length;i++)if(t.call(e,this._buffer[this._offset+i],i,this))return!0;return!1},e.prototype.forEach=function(t,e){if(this.checkVectorMethodArgs(t,e))for(var i=0;i<this._length;i++)t.call(e,this._buffer[this._offset+i],i,this)},e.prototype.join=function(t){void 0===t&&(t=",");for(var e=this.length,i=this._buffer,r=this._offset,n="",o=0;o<e-1;o++)n+=i[r+o]+t;return e>0&&(n+=i[r+e-1]),n},e.prototype.indexOf=function(t,e){void 0===e&&(e=0);var i=this._length,r=0|e;if(r<0)(r+=i)<0&&(r=0);else if(r>=i)return-1;for(var n=this._buffer,o=(i=this._length,this._offset),s=o+i,a=r+=o;a<s;a++)if(n[a]===t)return a-o;return-1},e.prototype.lastIndexOf=function(t,e){void 0===e&&(e=2147483647);var i=this._length,r=0|e;if(r<0){if((r+=i)<0)return-1}else r>=i&&(r=i);for(var n=this._buffer,o=this._offset,s=o,a=r+=o;a-- >s;)if(n[a]===t)return a-o;return-1},e.prototype.push=function(t,e,i,r,n,o,s,a){this._checkFixed(),this._ensureCapacity(this._length+arguments.length);for(var l=0;l<arguments.length;l++)this._buffer[this._offset+this._length++]=arguments[l]},e.prototype.pop=function(){return this._checkFixed(),0===this._length?e.DEFAULT_VALUE:(this._length--,this._buffer[this._offset+this._length])},e.prototype.reverse=function(){for(var t=this._offset,e=this._offset+this._length-1,i=this._buffer;t<e;){var r=i[t];i[t]=i[e],i[e]=r,t++,e--}return this},e.prototype.sort=function(t){if(0===arguments.length)return Array.prototype.sort.call(this._view()),this;if(this.sec.AXFunction.axIsType(t))return Array.prototype.sort.call(this._view(),t.value),this;var i=0|t;return i&e.DESCENDING?Array.prototype.sort.call(this._view(),(function(t,e){return e-t})):Array.prototype.sort.call(this._view(),(function(t,e){return t-e})),this},e.prototype.shift=function(){return this._checkFixed(),0===this._length?0:(this._length--,this._buffer[this._offset++])},e.prototype.unshift=function(){if(this._checkFixed(),arguments.length){this._ensureCapacity(this._length+arguments.length),this._slide(arguments.length),this._offset-=arguments.length,this._length+=arguments.length;for(var t=0;t<arguments.length;t++)this._buffer[this._offset+t]=arguments[t]}},e.prototype.slice=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);var i=this._buffer,r=this._length,n=Math.min(Math.max(t,0),r),o=Math.min(Math.max(e,n),r),s=new this.sec.Int32Vector(o-n,this.fixed);return s._buffer.set(i.subarray(this._offset+n,this._offset+o),s._offset),s},e.prototype.splice=function(t,e){var i,r=this._buffer,n=this._length,o=Math.min(Math.max(t,0),n),s=this._offset+o,a=Math.min(Math.max(e,0),n-o),l=arguments.length-2,h=new this.sec.Int32Vector(a,this.fixed);a>0&&(i=r.subarray(s,s+a),h._buffer.set(i,h._offset)),this._ensureCapacity(n-a+l);var c=s+a,u=r.subarray(c,n);r.set(u,s+l),this._length+=l-a;for(var p=0;p<l;p++)r[s+p]=arguments[p+2];return h},e.prototype._slide=function(t){this._buffer.set(this._view(),this._offset+t),this._offset+=t},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(t){if((t>>>=0)>this._length){this._ensureCapacity(t);for(var i=this._offset+this._length,r=this._offset+t;i<r;i++)this._buffer[i]=e.DEFAULT_VALUE}this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixed",{get:function(){return this._fixed},set:function(t){this._fixed=!!t},enumerable:!0,configurable:!0}),e.prototype._checkFixed=function(){this._fixed&&this.sec.throwError("RangeError",Errors$1.VectorFixedError)},e.prototype.axGetNumericProperty=function(t){var e=this._length,i=0|t;return(i<0||i>=e||i!=t)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,e),this._buffer[this._offset+i]},e.prototype.axSetNumericProperty=function(t,e){var i=this._length,r=0|t;(r<0||r>i||r!=t||r===i&&this._fixed)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,i),r===this._length&&(this._ensureCapacity(this._length+1),this._length++),this._buffer[this._offset+r]=e},e.prototype.axHasPropertyInternal=function(t){if((0|t.name)===t.name)return t.name>=0&&t.name<this._length;var e=axCoerceName(t.name);if(t.isRuntimeName()&&isIndex(e)){var i=e>>>0;return i>=0&&i<this._length}return this.axResolveMultiname(t)in this},e.prototype.axNextValue=function(t){return this._buffer[this._offset+t-1]},e.prototype.axNextNameIndex=function(t){var e=t+1;return e<=this._length?e:0},e.EXTRA_CAPACITY=4,e.INITIAL_CAPACITY=10,e.DEFAULT_VALUE=0,e.DESCENDING=2,e.UNIQUESORT=4,e.RETURNINDEXEDARRAY=8,e}(BaseVector),Uint32Vector=function(t){function e(i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var n=t.call(this)||this;return i>>>=0,n._fixed=!!r,n._buffer=new Uint32Array(Math.max(e.INITIAL_CAPACITY,i+e.EXTRA_CAPACITY)),n._offset=0,n._length=i,n}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=this.tPrototype;i.axGetProperty=t.axGetProperty,i.axGetNumericProperty=t.axGetNumericProperty,i.axSetProperty=t.axSetProperty,i.axSetNumericProperty=t.axSetNumericProperty,i.axHasPropertyInternal=t.axHasPropertyInternal,i.axNextName=t.axNextName,i.axNextNameIndex=t.axNextNameIndex,i.axNextValue=t.axNextValue,t.axGetProperty=ASObject$1.prototype.axGetProperty,t.axGetNumericProperty=ASObject$1.prototype.axGetNumericProperty,t.axSetProperty=ASObject$1.prototype.axSetProperty,t.axSetNumericProperty=ASObject$1.prototype.axSetNumericProperty,t.axHasPropertyInternal=ASObject$1.prototype.axHasPropertyInternal,t.axNextName=ASObject$1.prototype.axNextName,t.axNextNameIndex=ASObject$1.prototype.axNextNameIndex,t.axNextValue=ASObject$1.prototype.axNextValue;var r=e.prototype;defineNonEnumerableProperty(t,"$Bgjoin",r.join),defineNonEnumerableProperty(t,"$BgtoString",r.join),defineNonEnumerableProperty(t,"$BgtoLocaleString",r.toLocaleString),defineNonEnumerableProperty(t,"$Bgpop",r.pop),defineNonEnumerableProperty(t,"$Bgpush",r.push),defineNonEnumerableProperty(t,"$Bgreverse",r.reverse),defineNonEnumerableProperty(t,"$Bgconcat",r.concat),defineNonEnumerableProperty(t,"$Bgsplice",r.splice),defineNonEnumerableProperty(t,"$Bgslice",r.slice),defineNonEnumerableProperty(t,"$Bgshift",r.shift),defineNonEnumerableProperty(t,"$Bgunshift",r.unshift),defineNonEnumerableProperty(t,"$BgindexOf",r.indexOf),defineNonEnumerableProperty(t,"$BglastIndexOf",r.lastIndexOf),defineNonEnumerableProperty(t,"$BgforEach",r.forEach),defineNonEnumerableProperty(t,"$Bgmap",r.map),defineNonEnumerableProperty(t,"$Bgfilter",r.filter),defineNonEnumerableProperty(t,"$Bgsome",r.some),defineNonEnumerableProperty(t,"$Bgevery",r.every),defineNonEnumerableProperty(t,"$Bgsort",r.sort),defineNonEnumerableProperty(t,"checkVectorMethodArgs",r.checkVectorMethodArgs)},e.axApply=function(t,e){var i=e[0];if(this.axIsType(i))return i;var r=i.axGetPublicProperty("length");if(void 0!==r){for(var n=this.axConstruct([r,!1]),o=0;o<r;o++)n.axSetNumericProperty(o,i.axGetPublicProperty(o));return n}unexpected()},e.prototype.internalToString=function(){for(var t="",e=this._offset,i=e+this._length,r=0;r<this._buffer.length;r++)r===e&&(t+="["),r===i&&(t+="]"),t+=this._buffer[r],r<this._buffer.length-1&&(t+=",");return this._offset+this._length===this._buffer.length&&(t+="]"),t+": offset: "+this._offset+", length: "+this._length+", capacity: "+this._buffer.length},e.prototype.toString=function(){for(var t="",e=0;e<this._length;e++)t+=this._buffer[this._offset+e],e<this._length-1&&(t+=",");return t},e.prototype.toLocaleString=function(){for(var t="",e=0;e<this._length;e++)t+=this._buffer[this._offset+e],e<this._length-1&&(t+=",");return t},e.prototype._view=function(){return this._buffer.subarray(this._offset,this._offset+this._length)},e.prototype._ensureCapacity=function(t){var e=this._offset+t;if(!(e<this._buffer.length)){if(t<=this._buffer.length){var i=this._buffer.length-t>>2;return this._buffer.set(this._view(),i),void(this._offset=i)}var r=1+(3*this._buffer.length>>1);r<e&&(r=e);var n=new Uint32Array(r);n.set(this._buffer,0),this._buffer=n}},e.prototype.concat=function(){for(var t=this._length,e=0;e<arguments.length;e++){(o=arguments[e])._buffer instanceof Uint32Array||assert(!1),t+=o._length}var i=new this.sec.Uint32Vector(t),r=i._buffer;r.set(this._buffer);var n=this._length;for(e=0;e<arguments.length;e++){var o;n+(o=arguments[e])._buffer.length<o._buffer.length?r.set(o._buffer,n):r.set(o._buffer.subarray(0,o._length),n),n+=o._length}return i},e.prototype.every=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!0;for(var i=0;i<this._length;i++)if(!t.call(e,this._buffer[this._offset+i],i,this))return!1;return!0},e.prototype.filter=function(t,e){var i=new this.sec.Uint32Vector;if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._length;r++)t.call(e,this._buffer[this._offset+r],r,this)&&i.push(this._buffer[this._offset+r]);return i},e.prototype.map=function(t,e){var i=this.axClass.axConstruct([this.length,!1]);if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._length;r++)i[r]=t.call(e,this._buffer[this._offset+r],r,this);return i},e.prototype.some=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!1;for(var i=0;i<this._length;i++)if(t.call(e,this._buffer[this._offset+i],i,this))return!0;return!1},e.prototype.forEach=function(t,e){if(this.checkVectorMethodArgs(t,e))for(var i=0;i<this._length;i++)t.call(e,this._buffer[this._offset+i],i,this)},e.prototype.join=function(t){void 0===t&&(t=",");for(var e=this.length,i=this._buffer,r=this._offset,n="",o=0;o<e-1;o++)n+=i[r+o]+t;return e>0&&(n+=i[r+e-1]),n},e.prototype.indexOf=function(t,e){void 0===e&&(e=0);var i=this._length,r=0|e;if(r<0)(r+=i)<0&&(r=0);else if(r>=i)return-1;for(var n=this._buffer,o=(i=this._length,this._offset),s=o+i,a=r+=o;a<s;a++)if(n[a]===t)return a-o;return-1},e.prototype.lastIndexOf=function(t,e){void 0===e&&(e=2147483647);var i=this._length,r=0|e;if(r<0){if((r+=i)<0)return-1}else r>=i&&(r=i);for(var n=this._buffer,o=this._offset,s=o,a=r+=o;a-- >s;)if(n[a]===t)return a-o;return-1},e.prototype.push=function(t,e,i,r,n,o,s,a){this._checkFixed(),this._ensureCapacity(this._length+arguments.length);for(var l=0;l<arguments.length;l++)this._buffer[this._offset+this._length++]=arguments[l]},e.prototype.pop=function(){return this._checkFixed(),0===this._length?e.DEFAULT_VALUE:(this._length--,this._buffer[this._offset+this._length])},e.prototype.reverse=function(){for(var t=this._offset,e=this._offset+this._length-1,i=this._buffer;t<e;){var r=i[t];i[t]=i[e],i[e]=r,t++,e--}return this},e.prototype.sort=function(t){if(0===arguments.length)return Array.prototype.sort.call(this._view()),this;if(this.sec.AXFunction.axIsType(t))return Array.prototype.sort.call(this._view(),t.value),this;var i=0|t;return i&e.DESCENDING?Array.prototype.sort.call(this._view(),(function(t,e){return e-t})):Array.prototype.sort.call(this._view(),(function(t,e){return t-e})),this},e.prototype.shift=function(){return this._checkFixed(),0===this._length?0:(this._length--,this._buffer[this._offset++])},e.prototype.unshift=function(){if(this._checkFixed(),arguments.length){this._ensureCapacity(this._length+arguments.length),this._slide(arguments.length),this._offset-=arguments.length,this._length+=arguments.length;for(var t=0;t<arguments.length;t++)this._buffer[this._offset+t]=arguments[t]}},e.prototype.slice=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);var i=this._buffer,r=this._length,n=Math.min(Math.max(t,0),r),o=Math.min(Math.max(e,n),r),s=new this.sec.Uint32Vector(o-n,this.fixed);return s._buffer.set(i.subarray(this._offset+n,this._offset+o),s._offset),s},e.prototype.splice=function(t,e){var i,r=this._buffer,n=this._length,o=Math.min(Math.max(t,0),n),s=this._offset+o,a=Math.min(Math.max(e,0),n-o),l=arguments.length-2,h=new this.sec.Uint32Vector(a,this.fixed);a>0&&(i=r.subarray(s,s+a),h._buffer.set(i,h._offset)),this._ensureCapacity(n-a+l);var c=s+a,u=r.subarray(c,n);r.set(u,s+l),this._length+=l-a;for(var p=0;p<l;p++)r[s+p]=arguments[p+2];return h},e.prototype._slide=function(t){this._buffer.set(this._view(),this._offset+t),this._offset+=t},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(t){if((t>>>=0)>this._length){this._ensureCapacity(t);for(var i=this._offset+this._length,r=this._offset+t;i<r;i++)this._buffer[i]=e.DEFAULT_VALUE}this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixed",{get:function(){return this._fixed},set:function(t){this._fixed=!!t},enumerable:!0,configurable:!0}),e.prototype._checkFixed=function(){this._fixed&&this.sec.throwError("RangeError",Errors$1.VectorFixedError)},e.prototype.axGetNumericProperty=function(t){var e=this._length,i=0|t;return(i<0||i>=e||i!=t)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,e),this._buffer[this._offset+i]},e.prototype.axSetNumericProperty=function(t,e){var i=this._length,r=0|t;(r<0||r>i||r!=t||r===i&&this._fixed)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,i),r===this._length&&(this._ensureCapacity(this._length+1),this._length++),this._buffer[this._offset+r]=e},e.prototype.axHasPropertyInternal=function(t){if((0|t.name)===t.name)return t.name>=0&&t.name<this._length;var e=axCoerceName(t.name);if(t.isRuntimeName()&&isIndex(e)){var i=e>>>0;return i>=0&&i<this._length}return this.axResolveMultiname(t)in this},e.prototype.axNextValue=function(t){return this._buffer[this._offset+t-1]},e.prototype.axNextNameIndex=function(t){var e=t+1;return e<=this._length?e:0},e.EXTRA_CAPACITY=4,e.INITIAL_CAPACITY=10,e.DEFAULT_VALUE=0,e.DESCENDING=2,e.UNIQUESORT=4,e.RETURNINDEXEDARRAY=8,e}(BaseVector),Float64Vector=function(t){function e(i,r){void 0===i&&(i=0),void 0===r&&(r=!1);var n=t.call(this)||this;return i>>>=0,n._fixed=!!r,n._buffer=new Float64Array(Math.max(e.INITIAL_CAPACITY,i+e.EXTRA_CAPACITY)),n._offset=0,n._length=i,n}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=this.tPrototype;i.axGetProperty=t.axGetProperty,i.axGetNumericProperty=t.axGetNumericProperty,i.axSetProperty=t.axSetProperty,i.axSetNumericProperty=t.axSetNumericProperty,i.axHasPropertyInternal=t.axHasPropertyInternal,i.axNextName=t.axNextName,i.axNextNameIndex=t.axNextNameIndex,i.axNextValue=t.axNextValue,t.axGetProperty=ASObject$1.prototype.axGetProperty,t.axGetNumericProperty=ASObject$1.prototype.axGetNumericProperty,t.axSetProperty=ASObject$1.prototype.axSetProperty,t.axSetNumericProperty=ASObject$1.prototype.axSetNumericProperty,t.axHasPropertyInternal=ASObject$1.prototype.axHasPropertyInternal,t.axNextName=ASObject$1.prototype.axNextName,t.axNextNameIndex=ASObject$1.prototype.axNextNameIndex,t.axNextValue=ASObject$1.prototype.axNextValue;var r=e.prototype;defineNonEnumerableProperty(t,"$Bgjoin",r.join),defineNonEnumerableProperty(t,"$BgtoString",r.join),defineNonEnumerableProperty(t,"$BgtoLocaleString",r.toLocaleString),defineNonEnumerableProperty(t,"$Bgpop",r.pop),defineNonEnumerableProperty(t,"$Bgpush",r.push),defineNonEnumerableProperty(t,"$Bgreverse",r.reverse),defineNonEnumerableProperty(t,"$Bgconcat",r.concat),defineNonEnumerableProperty(t,"$Bgsplice",r.splice),defineNonEnumerableProperty(t,"$Bgslice",r.slice),defineNonEnumerableProperty(t,"$Bgshift",r.shift),defineNonEnumerableProperty(t,"$Bgunshift",r.unshift),defineNonEnumerableProperty(t,"$BgindexOf",r.indexOf),defineNonEnumerableProperty(t,"$BglastIndexOf",r.lastIndexOf),defineNonEnumerableProperty(t,"$BgforEach",r.forEach),defineNonEnumerableProperty(t,"$Bgmap",r.map),defineNonEnumerableProperty(t,"$Bgfilter",r.filter),defineNonEnumerableProperty(t,"$Bgsome",r.some),defineNonEnumerableProperty(t,"$Bgevery",r.every),defineNonEnumerableProperty(t,"$Bgsort",r.sort),defineNonEnumerableProperty(t,"checkVectorMethodArgs",r.checkVectorMethodArgs)},e.axApply=function(t,e){var i=e[0];if(this.axIsType(i))return i;var r=i.axGetPublicProperty("length");if(void 0!==r){for(var n=this.axConstruct([r,!1]),o=0;o<r;o++)n.axSetNumericProperty(o,i.axGetPublicProperty(o));return n}unexpected()},e.prototype.internalToString=function(){for(var t="",e=this._offset,i=e+this._length,r=0;r<this._buffer.length;r++)r===e&&(t+="["),r===i&&(t+="]"),t+=this._buffer[r],r<this._buffer.length-1&&(t+=",");return this._offset+this._length===this._buffer.length&&(t+="]"),t+": offset: "+this._offset+", length: "+this._length+", capacity: "+this._buffer.length},e.prototype.toString=function(){for(var t="",e=0;e<this._length;e++)t+=this._buffer[this._offset+e],e<this._length-1&&(t+=",");return t},e.prototype.toLocaleString=function(){for(var t="",e=0;e<this._length;e++)t+=this._buffer[this._offset+e],e<this._length-1&&(t+=",");return t},e.prototype._view=function(){return this._buffer.subarray(this._offset,this._offset+this._length)},e.prototype._ensureCapacity=function(t){var e=this._offset+t;if(!(e<this._buffer.length)){if(t<=this._buffer.length){var i=this._buffer.length-t>>2;return this._buffer.set(this._view(),i),void(this._offset=i)}var r=1+(3*this._buffer.length>>1);r<e&&(r=e);var n=new Float64Array(r);n.set(this._buffer,0),this._buffer=n}},e.prototype.concat=function(){for(var t=this._length,e=0;e<arguments.length;e++){(o=arguments[e])._buffer instanceof Float64Array||assert(!1),t+=o._length}var i=new this.sec.Float64Vector(t),r=i._buffer;r.set(this._buffer);var n=this._length;for(e=0;e<arguments.length;e++){var o;n+(o=arguments[e])._buffer.length<o._buffer.length?r.set(o._buffer,n):r.set(o._buffer.subarray(0,o._length),n),n+=o._length}return i},e.prototype.every=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!0;for(var i=0;i<this._length;i++)if(!t.call(e,this._buffer[this._offset+i],i,this))return!1;return!0},e.prototype.filter=function(t,e){var i=new this.sec.Float64Vector;if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._length;r++)t.call(e,this._buffer[this._offset+r],r,this)&&i.push(this._buffer[this._offset+r]);return i},e.prototype.map=function(t,e){var i=this.axClass.axConstruct([this.length,!1]);if(!this.checkVectorMethodArgs(t,e))return i;for(var r=0;r<this._length;r++)i[r]=t.call(e,this._buffer[this._offset+r],r,this);return i},e.prototype.some=function(t,e){if(!this.checkVectorMethodArgs(t,e))return!1;for(var i=0;i<this._length;i++)if(t.call(e,this._buffer[this._offset+i],i,this))return!0;return!1},e.prototype.forEach=function(t,e){if(this.checkVectorMethodArgs(t,e))for(var i=0;i<this._length;i++)t.call(e,this._buffer[this._offset+i],i,this)},e.prototype.join=function(t){void 0===t&&(t=",");for(var e=this.length,i=this._buffer,r=this._offset,n="",o=0;o<e-1;o++)n+=i[r+o]+t;return e>0&&(n+=i[r+e-1]),n},e.prototype.indexOf=function(t,e){void 0===e&&(e=0);var i=this._length,r=0|e;if(r<0)(r+=i)<0&&(r=0);else if(r>=i)return-1;for(var n=this._buffer,o=(i=this._length,this._offset),s=o+i,a=r+=o;a<s;a++)if(n[a]===t)return a-o;return-1},e.prototype.lastIndexOf=function(t,e){void 0===e&&(e=2147483647);var i=this._length,r=0|e;if(r<0){if((r+=i)<0)return-1}else r>=i&&(r=i);for(var n=this._buffer,o=this._offset,s=o,a=r+=o;a-- >s;)if(n[a]===t)return a-o;return-1},e.prototype.push=function(t,e,i,r,n,o,s,a){this._checkFixed(),this._ensureCapacity(this._length+arguments.length);for(var l=0;l<arguments.length;l++)this._buffer[this._offset+this._length++]=arguments[l]},e.prototype.pop=function(){return this._checkFixed(),0===this._length?e.DEFAULT_VALUE:(this._length--,this._buffer[this._offset+this._length])},e.prototype.reverse=function(){for(var t=this._offset,e=this._offset+this._length-1,i=this._buffer;t<e;){var r=i[t];i[t]=i[e],i[e]=r,t++,e--}return this},e.prototype.sort=function(t){if(0===arguments.length)return Array.prototype.sort.call(this._view()),this;if(this.sec.AXFunction.axIsType(t))return Array.prototype.sort.call(this._view(),t.value),this;var i=0|t;return i&e.DESCENDING?Array.prototype.sort.call(this._view(),(function(t,e){return e-t})):Array.prototype.sort.call(this._view(),(function(t,e){return t-e})),this},e.prototype.shift=function(){return this._checkFixed(),0===this._length?0:(this._length--,this._buffer[this._offset++])},e.prototype.unshift=function(){if(this._checkFixed(),arguments.length){this._ensureCapacity(this._length+arguments.length),this._slide(arguments.length),this._offset-=arguments.length,this._length+=arguments.length;for(var t=0;t<arguments.length;t++)this._buffer[this._offset+t]=arguments[t]}},e.prototype.slice=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);var i=this._buffer,r=this._length,n=Math.min(Math.max(t,0),r),o=Math.min(Math.max(e,n),r),s=new this.sec.Float64Vector(o-n,this.fixed);return s._buffer.set(i.subarray(this._offset+n,this._offset+o),s._offset),s},e.prototype.splice=function(t,e){var i,r=this._buffer,n=this._length,o=Math.min(Math.max(t,0),n),s=this._offset+o,a=Math.min(Math.max(e,0),n-o),l=arguments.length-2,h=new this.sec.Float64Vector(a,this.fixed);a>0&&(i=r.subarray(s,s+a),h._buffer.set(i,h._offset)),this._ensureCapacity(n-a+l);var c=s+a,u=r.subarray(c,n);r.set(u,s+l),this._length+=l-a;for(var p=0;p<l;p++)r[s+p]=arguments[p+2];return h},e.prototype._slide=function(t){this._buffer.set(this._view(),this._offset+t),this._offset+=t},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(t){if((t>>>=0)>this._length){this._ensureCapacity(t);for(var i=this._offset+this._length,r=this._offset+t;i<r;i++)this._buffer[i]=e.DEFAULT_VALUE}this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixed",{get:function(){return this._fixed},set:function(t){this._fixed=!!t},enumerable:!0,configurable:!0}),e.prototype._checkFixed=function(){this._fixed&&this.sec.throwError("RangeError",Errors$1.VectorFixedError)},e.prototype.axGetNumericProperty=function(t){var e=this._length,i=0|t;return(i<0||i>=e||i!=t)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,e),this._buffer[this._offset+i]},e.prototype.axSetNumericProperty=function(t,e){var i=this._length,r=0|t;(r<0||r>i||r!=t||r===i&&this._fixed)&&this.sec.throwError("RangeError",Errors$1.OutOfRangeError,t,i),r===this._length&&(this._ensureCapacity(this._length+1),this._length++),this._buffer[this._offset+r]=e},e.prototype.axHasPropertyInternal=function(t){if((0|t.name)===t.name)return t.name>=0&&t.name<this._length;var e=axCoerceName(t.name);if(t.isRuntimeName()&&isIndex(e)){var i=e>>>0;return i>=0&&i<this._length}return this.axResolveMultiname(t)in this},e.prototype.axNextValue=function(t){return this._buffer[this._offset+t-1]},e.prototype.axNextNameIndex=function(t){var e=t+1;return e<=this._length?e:0},e.EXTRA_CAPACITY=4,e.INITIAL_CAPACITY=10,e.DEFAULT_VALUE=0,e.DESCENDING=2,e.UNIQUESORT=4,e.RETURNINDEXEDARRAY=8,e}(BaseVector),ASMath=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classNatives=[Math],e.classInitializer=function(){defineNonEnumerableProperty(this,"$BgE",Math.E),defineNonEnumerableProperty(this,"$BgLN10",Math.LN10),defineNonEnumerableProperty(this,"$BgLN2",Math.LN2),defineNonEnumerableProperty(this,"$BgLOG10E",Math.LOG10E),defineNonEnumerableProperty(this,"$BgLOG2E",Math.LOG2E),defineNonEnumerableProperty(this,"$BgPI",Math.PI),defineNonEnumerableProperty(this,"$BgSQRT1_2",Math.SQRT2),defineNonEnumerableProperty(this,"$BgSQRT2",Math.SQRT2)},e}(ASObject$1),ASRegExp=function(t){function e(i,r){var n,o=t.call(this)||this;if(o._dotall=!1,o._extended=!1,o._captureNames=[],void 0===i)i=n="";else if(o.sec.AXRegExp.axIsType(i))r&&o.sec.throwError("TypeError",Errors$1.RegExpFlagsArgumentError),n=i.source,i=i.value;else{if(n=(i=String(i)).replace(/(^|^[\/]|(?:\\\\)+)\//g,"$1\\/"),r){var s=r;r="";for(var a=0;a<s.length;a++){var l=s[a];switch(l){case"s":o._dotall=!0;break;case"x":o._extended=!0;break;case"g":case"i":case"m":r+=l}}}i=o._parse(n)}try{o.value=new RegExp(i,r)}catch(t){o.value=new RegExp(e.UNMATCHABLE_PATTERN,r)}return o._source=n,o}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.ecmaToString),addPrototypeFunctionAlias(t,"$Bgexec",i.exec),addPrototypeFunctionAlias(t,"$Bgtest",i.test)},e.prototype._parse=function(t){for(var i="",r=this._captureNames,n=[],o=0,s=0;s<t.length;s++){var a=t[s];switch(a){case"(":if(i+=a,n.push(o>1?o-1:o),o=0,"?"===t[s+1])switch(t[s+2]){case":":case"=":case"!":i+="?"+t[s+2],s+=2;break;default:if(!/\(\?P<([\w$]+)>/.exec(t.substr(s)))return e.UNMATCHABLE_PATTERN;var l=RegExp.$1;"length"!==l&&r.push(l),r.indexOf(l),s+=RegExp.lastMatch.length-1}else r.push(null);if(r.length>406)return e.UNMATCHABLE_PATTERN;break;case")":if(!n.length)return e.UNMATCHABLE_PATTERN;i+=a,o=n.pop()+1;break;case"|":i+=a;break;case"\\":i+=a,/\\|c[A-Z]|x[0-9,a-z,A-Z]{2}|u[0-9,a-z,A-Z]{4}|./.exec(t.substr(s+1))&&(i+=RegExp.lastMatch,s+=RegExp.lastMatch.length),o<=1&&o++;break;case"[":if(!/\[[^\]]*\]/.exec(t.substr(s)))return e.UNMATCHABLE_PATTERN;i+=RegExp.lastMatch,s+=RegExp.lastMatch.length-1,o<=1&&o++;break;case"{":if(!/\{[^\{]*?(?:,[^\{]*?)?\}/.exec(t.substr(s)))return e.UNMATCHABLE_PATTERN;i+=RegExp.lastMatch,s+=RegExp.lastMatch.length-1;break;case".":this._dotall?i+="[\\s\\S]":i+=a,o<=1&&o++;break;case"?":case"*":case"+":if(!o)return e.UNMATCHABLE_PATTERN;i+=a,"?"===t[s+1]&&(s++,i+="?");break;case" ":if(this._extended)break;default:i+=a,o<=1&&o++}if(i.length>32767)return e.UNMATCHABLE_PATTERN}return n.length?e.UNMATCHABLE_PATTERN:i},e.prototype.ecmaToString=function(){var t="/"+this._source+"/";return this.value.global&&(t+="g"),this.value.ignoreCase&&(t+="i"),this.value.multiline&&(t+="m"),this._dotall&&(t+="s"),this._extended&&(t+="x"),t},e.prototype.axCall=function(t){return this.exec.apply(this,arguments)},e.prototype.axApply=function(t,e){return this.exec.apply(this,e)},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"global",{get:function(){return this.value.global},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignoreCase",{get:function(){return this.value.ignoreCase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiline",{get:function(){return this.value.multiline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastIndex",{get:function(){return this.value.lastIndex},set:function(t){this.value.lastIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dotall",{get:function(){return this._dotall},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extended",{get:function(){return this._extended},enumerable:!0,configurable:!0}),e.prototype.exec=function(t){void 0===t&&(t="");var e=this.value.exec(t);if(!e)return null;var i=transformJStoASRegExpMatchArray(this.sec,e),r=this._captureNames;if(r){for(var n=0;n<r.length;n++){var o=r[n];if(null!==o){var s=e[n+1]||"";e[o]=s,i.axSetPublicProperty(o,s)}}return i}},e.prototype.test=function(t){return void 0===t&&(t=""),null!==this.exec(t)},e.UNMATCHABLE_PATTERN="^(?!)$",e}(ASObject$1);function transformASValueToJS(t,e,i){if("object"!=typeof e)return e;if(isNullOrUndefined(e))return e;if(t.AXArray.axIsType(e)){for(var r=[],n=e.value,o=0;o<n.length;o++){var s=n[o],a=i?transformASValueToJS(t,s,!0):s;r.push(a)}return r}var l=Object.keys(e),h={};for(o=0;o<l.length;o++){var c=l[o],u=c;isNumeric(c)||(u=c.substr(3));var p=e[c];i&&(p=transformASValueToJS(t,p,!0)),h[u]=p}return h}function walk(t,e,i,r){var n=e[i];if(Array.isArray(n))for(var o=n,s=0,a=o.length;s<a;s++){void 0===(h=walk(t,o,axCoerceString$3(s),r))?delete o[s]:o[s]=h}else if(null!==n&&"boolean"!=typeof n&&"number"!=typeof n&&"string"!=typeof n)for(var l in n){if(!n.hasOwnProperty(l)||!Multiname.isPublicQualifiedName(l))break;var h;void 0===(h=walk(t,n,l,r))?delete n[l]:n[l]=h}return r.call(e,i,n)}var ASJSON=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.parse=function(t,e){void 0===e&&(e=null),t=axCoerceString$3(t),null===e||axIsCallable(e)||this.sec.throwError("TypeError",Errors$1.CheckTypeFailedError,e,"Function"),null===t&&this.sec.throwError("SyntaxError",Errors$1.JSONInvalidParseInput);try{var i=transformJSValueToAS(this.sec,JSON.parse(t),!0)}catch(t){this.sec.throwError("SyntaxError",Errors$1.JSONInvalidParseInput)}return null===e?i:walk(this.sec,{"":i},"",e.value)},e.stringify=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),null!==e){var r="object"==typeof e?e.sec:null;r&&(r.AXFunction.axIsType(e)||r.AXArray.axIsType(e))||this.sec.throwError("TypeError",Errors$1.JSONInvalidReplacer)}var n;return n="string"==typeof i?i.length>10?i.substring(0,10):i:"number"==typeof i?"          ".substring(0,Math.min(10,0|i)):"",null===e?this.stringifySpecializedToString(t,null,null,n):r.AXArray.axIsType(e)?this.stringifySpecializedToString(t,this.computePropertyList(e.value),null,n):this.stringifySpecializedToString(t,null,e.value,n)},e.computePropertyList=function(t){for(var e=[],i=Object.create(null),r=0,n=t.length;r<n;r++)if(t.hasOwnProperty(r)){var o=t[r],s=null;"string"==typeof o?s=o:"number"==typeof o&&(s=axCoerceString$3(o)),null===s||i[s]||(i[s]=!0,e.push(s))}return e},e.stringifySpecializedToString=function(t,e,i,r){try{return void 0===t?"null":JSON.stringify(transformASValueToJS(this.sec,t,!0),i,r)}catch(t){this.sec.throwError("TypeError",Errors$1.JSONCyclicStructure)}},e}(ASObject$1);function FlashUtilScript_getDefinitionByName(t,e){var i=String(e).replace("::",".");return getCurrentABC().env.app.getClass(Multiname.FromFQNString(i,0))}function FlashUtilScript_getTimer(t){return Date.now()-t.flash.display.Loader.axClass.runtimeStartTime}function FlashNetScript_navigateToURL$1(t,e,i){null==e&&t.throwError("TypeError",Errors$1.NullPointerError,"request"),t.flash.net.URLRequest.axClass.axIsType(e)||t.throwError("TypeError",Errors$1.CheckTypeFailedError,e,"flash.net.URLRequest");var r=e.url;(isNullOrUndefined(r)&&t.throwError("TypeError",Errors$1.NullPointerError,"url"),0!==r.toLowerCase().indexOf("fscommand:"))?window.open(e.url,"_blank"):(0,t.flash.system.fscommand.value)(t,r.substring("fscommand:".length),i)}function FlashNetScript_sendToURL(t,e){isNullOrUndefined(e)&&t.throwError("TypeError",Errors$1.NullPointerError,"request"),t.flash.net.URLRequest.axClass.axIsType(e)||t.throwError("TypeError",Errors$1.CheckTypeFailedError,e,"flash.net.URLRequest"),console.log("TODO: FlashNetScript_sendToURL: FileLoadingService")}function Toplevel_registerClassAlias(t,e,i){(e=axCoerceString$3(e))||t.throwError("TypeError",Errors$1.NullPointerError,"aliasName"),i||t.throwError("TypeError",Errors$1.NullPointerError,"classObject"),t.classAliases.registerClassAlias(e,i)}function Toplevel_getClassByAlias(t,e){(e=axCoerceString$3(e))||t.throwError("TypeError",Errors$1.NullPointerError,"aliasName");var i=t.classAliases.getClassByAlias(e);return i||t.throwError("ReferenceError",Errors$1.ClassNotFoundError,e),i}var ASError=function(t){function e(e,i){var r=t.call(this)||this;return arguments.length<1&&(e=""),r.$Bgmessage=String(e),r._errorID=0|i,r}return __extends(e,t),e.throwError=function(t,e){for(var i=getErrorInfo(e),r=[i],n=2;n<arguments.length;n++)r.push(arguments[n]);var o=formatErrorMessage.apply(null,r);throw t.axConstruct([o,e])},e.classInitializer=function(t){defineNonEnumerableProperty(this,"$Bglength",1),defineNonEnumerableProperty(this.dPrototype,"$Bgname",this.classInfo.instanceInfo.getName().name),t===e&&(defineNonEnumerableProperty(this.dPrototype,"$Bgmessage","Error"),defineNonEnumerableProperty(this.dPrototype,"$BgtoString",e.prototype.toString))},e.prototype.toString=function(){return""!==this.$Bgmessage?this.$Bgname+": "+this.$Bgmessage:this.$Bgname},Object.defineProperty(e.prototype,"errorID",{get:function(){return this._errorID},enumerable:!0,configurable:!0}),e.prototype.getStackTrace=function(){return null},e.getErrorMessage=getErrorMessage,e}(ASObject$1),ASDefinitionError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASEvalError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASRangeError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASReferenceError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASSecurityError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASSyntaxError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASTypeError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASURIError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASVerifyError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASUninitializedError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASArgumentError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASIOError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASEOFError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASMemoryError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASIllegalOperationError=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASError),ASDate=function(t){function e(e,i,r,n,o,s,a){void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0);var l=t.call(this)||this;switch(arguments.length){case 0:l.value=new Date;break;case 1:l.value=new Date(e);break;case 2:l.value=new Date(e,i);break;case 3:l.value=new Date(e,i,r);break;case 4:l.value=new Date(e,i,r,n);break;case 5:l.value=new Date(e,i,r,n,o);break;case 6:l.value=new Date(e,i,r,n,o,s);break;default:l.value=new Date(e,i,r,n,o,s,a)}return l}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;addPrototypeFunctionAlias(t,"$BgtoString",i.toString),addPrototypeFunctionAlias(t,"$BgtoLocaleString",i.toString),addPrototypeFunctionAlias(t,"$BgvalueOf",i.valueOf),addPrototypeFunctionAlias(t,"$BgtoDateString",i.toDateString),addPrototypeFunctionAlias(t,"$BgtoTimeString",i.toTimeString),addPrototypeFunctionAlias(t,"$BgtoLocaleString",i.toLocaleString),addPrototypeFunctionAlias(t,"$BgtoLocaleDateString",i.toLocaleDateString),addPrototypeFunctionAlias(t,"$BgtoLocaleTimeString",i.toLocaleTimeString),addPrototypeFunctionAlias(t,"$BgtoUTCString",i.toUTCString),addPrototypeFunctionAlias(t,"$BgtoJSON",i.toJSON),addPrototypeFunctionAlias(t,"$BggetUTCFullYear",i.getUTCFullYear),addPrototypeFunctionAlias(t,"$BggetUTCMonth",i.getUTCMonth),addPrototypeFunctionAlias(t,"$BggetUTCDate",i.getUTCDate),addPrototypeFunctionAlias(t,"$BggetUTCDay",i.getUTCDay),addPrototypeFunctionAlias(t,"$BggetUTCHours",i.getUTCHours),addPrototypeFunctionAlias(t,"$BggetUTCMinutes",i.getUTCMinutes),addPrototypeFunctionAlias(t,"$BggetUTCSeconds",i.getUTCSeconds),addPrototypeFunctionAlias(t,"$BggetUTCMilliseconds",i.getUTCMilliseconds),addPrototypeFunctionAlias(t,"$BggetFullYear",i.getFullYear),addPrototypeFunctionAlias(t,"$BggetMonth",i.getMonth),addPrototypeFunctionAlias(t,"$BggetDate",i.getDate),addPrototypeFunctionAlias(t,"$BggetDay",i.getDay),addPrototypeFunctionAlias(t,"$BggetHours",i.getHours),addPrototypeFunctionAlias(t,"$BggetMinutes",i.getMinutes),addPrototypeFunctionAlias(t,"$BggetSeconds",i.getSeconds),addPrototypeFunctionAlias(t,"$BggetMilliseconds",i.getMilliseconds),addPrototypeFunctionAlias(t,"$BggetTimezoneOffset",i.getTimezoneOffset),addPrototypeFunctionAlias(t,"$BggetTime",i.getTime),addPrototypeFunctionAlias(t,"$BgsetFullYear",i.setFullYear),addPrototypeFunctionAlias(t,"$BgsetMonth",i.setMonth),addPrototypeFunctionAlias(t,"$BgsetDate",i.setDate),addPrototypeFunctionAlias(t,"$BgsetHours",t.setHours),addPrototypeFunctionAlias(t,"$BgsetMinutes",i.setMinutes),addPrototypeFunctionAlias(t,"$BgsetSeconds",i.setSeconds),addPrototypeFunctionAlias(t,"$BgsetMilliseconds",i.setMilliseconds),addPrototypeFunctionAlias(t,"$BgsetUTCFullYear",i.setUTCFullYear),addPrototypeFunctionAlias(t,"$BgsetUTCMonth",i.setUTCMonth),addPrototypeFunctionAlias(t,"$BgsetUTCDate",i.setUTCDate),addPrototypeFunctionAlias(t,"$BgsetUTCHours",i.setUTCHours),addPrototypeFunctionAlias(t,"$BgsetUTCMinutes",i.setUTCMinutes),addPrototypeFunctionAlias(t,"$BgsetUTCSeconds",i.setUTCSeconds),addPrototypeFunctionAlias(t,"$BgsetUTCMilliseconds",i.setUTCMilliseconds)},e.parse=function(t){return Date.parse(t)},e.UTC=function(t,e,i,r,n,o,s){return void 0===i&&(i=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),Date.parse.apply(null,arguments)},e.axCoerce=function(t){return this.axConstruct([t])},e.prototype.toString=function(){if(!(this.value instanceof Date))return"Invalid Date";var t=this.value.toString().split(" ");return t.length<4?"Invalid Date":(t.length=6,t.push(t.splice(3,1)[0]),"0"===t[2][0]&&(t[2]=t[2][1]),t.join(" "))},e.prototype.toDateString=function(){if(!(this.value instanceof Date))return"Invalid Date";var t=this.value.toDateString().split(" ");return t.length<4?"Invalid Date":("0"===t[2][0]&&(t[2]=t[2][1]),t.join(" "))},e.prototype.toJSON=function(){return this.value instanceof Date?this.value.toString():"Invalid Date"},e.prototype.valueOf=function(){return this.value instanceof Date?this.value.valueOf():NaN},e.prototype.setTime=function(t){return void 0===t&&(t=0),this.value instanceof Date?this.value.setTime(t):NaN},e.prototype.toTimeString=function(){return this.value instanceof Date?this.value.toTimeString():"Invalid Date"},e.prototype.toLocaleString=function(){return this.value instanceof Date?this.value.toLocaleString():"Invalid Date"},e.prototype.toLocaleDateString=function(){return this.value instanceof Date?this.value.toLocaleDateString():"Invalid Date"},e.prototype.toLocaleTimeString=function(){return this.value instanceof Date?this.value.toLocaleTimeString():"Invalid Date"},e.prototype.toUTCString=function(){return this.value instanceof Date?this.value.toUTCString():"Invalid Date"},e.prototype.getUTCFullYear=function(){return this.value instanceof Date?this.value.getUTCFullYear():NaN},e.prototype.getUTCMonth=function(){return this.value instanceof Date?this.value.getUTCMonth():NaN},e.prototype.getUTCDate=function(){return this.value instanceof Date?this.value.getUTCDate():NaN},e.prototype.getUTCDay=function(){return this.value instanceof Date?this.value.getUTCDay():NaN},e.prototype.getUTCHours=function(){return this.value instanceof Date?this.value.getUTCHours():NaN},e.prototype.getUTCMinutes=function(){return this.value instanceof Date?this.value.getUTCMinutes():NaN},e.prototype.getUTCSeconds=function(){return this.value instanceof Date?this.value.getUTCSeconds():NaN},e.prototype.getUTCMilliseconds=function(){return this.value instanceof Date?this.value.getUTCMilliseconds():NaN},e.prototype.getFullYear=function(){return this.value instanceof Date?this.value.getFullYear():NaN},e.prototype.getMonth=function(){return this.value instanceof Date?this.value.getMonth():NaN},e.prototype.getDate=function(){return this.value instanceof Date?this.value.getDate():NaN},e.prototype.getDay=function(){return this.value instanceof Date?this.value.getDay():NaN},e.prototype.getHours=function(){return this.value instanceof Date?this.value.getHours():NaN},e.prototype.getMinutes=function(){return this.value instanceof Date?this.value.getMinutes():NaN},e.prototype.getSeconds=function(){return this.value instanceof Date?this.value.getSeconds():NaN},e.prototype.getMilliseconds=function(){return this.value instanceof Date?this.value.getMilliseconds():NaN},e.prototype.getTimezoneOffset=function(){return this.value instanceof Date?this.value.getTimezoneOffset():NaN},e.prototype.getTime=function(){return this.value instanceof Date?this.value.getTime():NaN},e.prototype.setFullYear=function(t,e,i){return this.value instanceof Date?this.value.setFullYear.apply(this.value,arguments):NaN},e.prototype.setMonth=function(t,e){return this.value instanceof Date?this.value.setMonth.apply(this.value,arguments):NaN},e.prototype.setDate=function(t){return this.value instanceof Date?this.value.setDate.apply(this.value,arguments):NaN},e.prototype.setHours=function(t,e,i,r){return this.value instanceof Date?this.value.setHours.apply(this.value,arguments):NaN},e.prototype.setMinutes=function(t,e,i){return this.value instanceof Date?this.value.setMinutes.apply(this.value,arguments):NaN},e.prototype.setSeconds=function(t,e){return this.value instanceof Date?this.value.setSeconds.apply(this.value,arguments):NaN},e.prototype.setMilliseconds=function(t){return this.value instanceof Date?this.value.setMilliseconds.apply(this.value,arguments):NaN},e.prototype.setUTCFullYear=function(t,e,i){return this.value instanceof Date?this.value.setUTCFullYear.apply(this.value,arguments):NaN},e.prototype.setUTCMonth=function(t,e){return this.value instanceof Date?this.value.setUTCMonth.apply(this.value,arguments):NaN},e.prototype.setUTCDate=function(t){return this.value instanceof Date?this.value.setUTCDate.apply(this.value,arguments):NaN},e.prototype.setUTCHours=function(t,e,i,r){return this.value instanceof Date?this.value.setUTCHours.apply(this.value,arguments):NaN},e.prototype.setUTCMinutes=function(t,e,i){return this.value instanceof Date?this.value.setUTCMinutes.apply(this.value,arguments):NaN},e.prototype.setUTCSeconds=function(t,e){return this.value instanceof Date?this.value.setUTCSeconds.apply(this.value,arguments):NaN},e.prototype.setUTCMilliseconds=function(t){return this.value instanceof Date?this.value.setUTCMilliseconds.apply(this.value,arguments):NaN},Object.defineProperty(e.prototype,"fullYear",{get:function(){return this.value.getFullYear()},set:function(t){this.value.setFullYear(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"month",{get:function(){return this.value.getMonth()},set:function(t){this.value.setMonth(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"date",{get:function(){return this.value.getDate()},set:function(t){this.value.setDate(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hours",{get:function(){return this.value.getHours()},set:function(t){this.value.setHours(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minutes",{get:function(){return this.value.getMinutes()},set:function(t){this.value.setMinutes(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"seconds",{get:function(){return this.value.getSeconds()},set:function(t){this.value.setSeconds(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"milliseconds",{get:function(){return this.value.getMilliseconds()},set:function(t){this.value.setMilliseconds(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullYearUTC",{get:function(){return this.value.getUTCFullYear()},set:function(t){this.value.setUTCFullYear(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"monthUTC",{get:function(){return this.value.getUTCMonth()},set:function(t){this.value.setUTCMonth(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateUTC",{get:function(){return this.value.getUTCDate()},set:function(t){this.value.setUTCDate(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hoursUTC",{get:function(){return this.value.getUTCHours()},set:function(t){this.value.setUTCHours(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minutesUTC",{get:function(){return this.value.getUTCMinutes()},set:function(t){this.value.setUTCMinutes(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondsUTC",{get:function(){return this.value.getUTCSeconds()},set:function(t){this.value.setUTCSeconds(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"millisecondsUTC",{get:function(){return this.value.getUTCMilliseconds()},set:function(t){this.value.setUTCMilliseconds(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return this.value.getTime()},set:function(t){this.value.setTime(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timezoneOffset",{get:function(){return this.value.getTimezoneOffset()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"day",{get:function(){return this.value.getDay()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayUTC",{get:function(){return this.value.getUTCDay()},enumerable:!0,configurable:!0}),e}(ASObject$1),proxyNamespace=internNamespace(0,"http://www.adobe.com/2006/actionscript/flash/proxy"),proxyPrefix="$"+proxyNamespace.mangledName,ASProxy=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){var t=this.dPrototype,i=e.prototype;defineNonEnumerableProperty(t,proxyPrefix+"getProperty",i.native_getProperty),defineNonEnumerableProperty(t,proxyPrefix+"setProperty",i.native_setProperty),defineNonEnumerableProperty(t,proxyPrefix+"callProperty",i.native_callProperty),defineNonEnumerableProperty(t,proxyPrefix+"hasProperty",i.native_hasProperty),defineNonEnumerableProperty(t,proxyPrefix+"deleteProperty",i.native_deleteProperty),defineNonEnumerableProperty(t,proxyPrefix+"getDescendants",i.native_getDescendants),defineNonEnumerableProperty(t,proxyPrefix+"nextNameIndex",i.native_nextNameIndex),defineNonEnumerableProperty(t,proxyPrefix+"nextName",i.native_nextName),defineNonEnumerableProperty(t,proxyPrefix+"nextValue",i.native_nextValue)},e.prototype.native_getProperty=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyGetPropertyError)},e.prototype.native_setProperty=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxySetPropertyError)},e.prototype.native_callProperty=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyCallPropertyError)},e.prototype.native_hasProperty=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyHasPropertyError)},e.prototype.native_deleteProperty=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyDeletePropertyError)},e.prototype.native_getDescendants=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyGetDescendantsError)},e.prototype.native_nextNameIndex=function(){this!==this.axClass.dPrototype&&this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyNextNameIndexError)},e.prototype.native_nextName=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyNextNameError)},e.prototype.native_nextValue=function(){this.sec.throwError("flash.errors.IllegalOperationError",Errors$1.ProxyNextValueError)},e.prototype.axGetProperty=function(t){var e,i="string"==typeof t.name?this.traits.getTrait(t.namespaces,t.name):null;if(i){var r=i.name.getMangledName();if("function"==typeof(e=this[r]))return this.axGetMethod(r)}else e=this[proxyPrefix+"getProperty"](this.sec.AXQName.FromMultiname(t));return e},e.prototype.axGetNumericProperty=function(t){return this[proxyPrefix+"getProperty"](+t+"")},e.prototype.axSetNumericProperty=function(t,e){this[proxyPrefix+"setProperty"](+t+"",e)},e.prototype.axSetProperty=function(e,i,r){("string"==typeof e.name?this.traits.getTrait(e.namespaces,e.name):null)?t.prototype.axSetProperty.call(this,e,i,r):this[proxyPrefix+"setProperty"](this.sec.AXQName.FromMultiname(e),i)},e.prototype.axCallProperty=function(e,i,r){if("string"==typeof e.name?this.traits.getTrait(e.namespaces,e.name):null)return t.prototype.axCallProperty.call(this,e,i,r);var n=[this.sec.AXQName.FromMultiname(e)].concat(i);return this[proxyPrefix+"callProperty"].apply(this,n)},e.prototype.axHasProperty=function(t){return this.axHasOwnProperty(t)},e.prototype.axHasPublicProperty=function(t){return rn$1.name=t,!!this.axHasPropertyInternal(rn$1)||this[proxyPrefix+"hasProperty"](t)},e.prototype.axHasOwnProperty=function(t){return!!("string"==typeof t.name?this.traits.getTrait(t.namespaces,t.name):null)||this[proxyPrefix+"hasProperty"](this.sec.AXQName.FromMultiname(t))},e.prototype.axDeleteProperty=function(t){var e="string"==typeof t.name?this.traits.getTrait(t.namespaces,t.name):null;return e?delete this[e.name.getMangledName()]:this[proxyPrefix+"deleteProperty"](this.sec.AXQName.FromMultiname(t))},e.prototype.axNextName=function(t){return this[proxyPrefix+"nextName"](t)},e.prototype.axNextValue=function(t){return this[proxyPrefix+"nextValue"](t)},e.prototype.axNextNameIndex=function(t){return this[proxyPrefix+"nextNameIndex"](t)},e}(ASObject$1),rn$1=new Multiname(null,0,17,[],null,null,!0),Dictionary=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i.map=new WeakMap,i.keys=null,i.weakKeys=!!e,e||(i.keys=[]),i.primitiveMap=Object.create(null),i}return __extends(e,t),e.makePrimitiveKey=function(t){if("string"==typeof t||"number"==typeof t)return t},e.prototype.toJSON=function(){return"Dictionary"},e.prototype.axGetProperty=function(i){if(this===this.axClass.dPrototype)return t.prototype.axGetProperty.call(this,i);var r=e.makePrimitiveKey(i.name);return void 0!==r?this.primitiveMap[r]:this.map.get(Object(i.name))},e.prototype.axSetProperty=function(i,r,n){if(this!==this.axClass.dPrototype){var o=e.makePrimitiveKey(i.name);void 0===o?(this.map.set(Object(i.name),r),!this.weakKeys&&this.keys.indexOf(i.name)<0&&this.keys.push(i.name)):this.primitiveMap[o]=r}else t.prototype.axSetProperty.call(this,i,r,n)},e.prototype.axHasPropertyInternal=function(i){if(this===this.axClass.dPrototype)return t.prototype.axHasProperty.call(this,i);var r=e.makePrimitiveKey(i.name);return void 0!==r?r in this.primitiveMap:this.map.has(Object(i.name))},e.prototype.axDeleteProperty=function(i){if(this===this.axClass.dPrototype)return t.prototype.axDeleteProperty.call(this,i);var r,n=e.makePrimitiveKey(i.name);return void 0!==n&&delete this.primitiveMap[n],this.map.delete(Object(i.name)),!this.weakKeys&&(r=this.keys.indexOf(i.name))>=0&&this.keys.splice(r,1),!0},e.prototype.axGetPublicProperty=function(i){if(this===this.axClass.dPrototype)return t.prototype.axGetPublicProperty.call(this,i);var r=e.makePrimitiveKey(i);return void 0!==r?this.primitiveMap[r]:this.map.get(Object(i))},e.prototype.axGetEnumerableKeys=function(){if(this===this.axClass.dPrototype)return t.prototype.axGetEnumerableKeys.call(this);var e=[];for(var i in this.primitiveMap)e.push(i);return this.weakKeys?e:this.keys?e.concat(this.keys):e.slice()},e.classInitializer=function(){addPrototypeFunctionAlias(this.dPrototype,"$BgtoJSON",e.prototype.toJSON)},e}(ASObject$1),AVMPlusFile=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.exists=function(){},e.read=function(){},e.write=function(){},e.readByteArray=function(){},e.writeByteArray=function(){},e}(ASObject$1);function initializeBuiltins(){builtinNativeClasses.Object=ASObject$1,builtinNativeClasses.Class=ASClass$1,builtinNativeClasses.Function=ASFunction$1,builtinNativeClasses.Boolean=ASBoolean$1,builtinNativeClasses["builtin.as$0.MethodClosure"]=ASMethodClosure,builtinNativeClasses.Number=ASNumber$1,builtinNativeClasses.int=ASInt,builtinNativeClasses.uint=ASUint,builtinNativeClasses.String=ASString$1,builtinNativeClasses.Array=ASArray$1,builtinNativeClasses["__AS3__.vec.Vector"]=Vector,builtinNativeClasses["__AS3__.vec.Vector$object"]=GenericVector,builtinNativeClasses["__AS3__.vec.Vector$int"]=Int32Vector,builtinNativeClasses["__AS3__.vec.Vector$uint"]=Uint32Vector,builtinNativeClasses["__AS3__.vec.Vector$double"]=Float64Vector,builtinNativeClasses.Namespace=ASNamespace,builtinNativeClasses.QName=ASQName,builtinNativeClasses.XML=ASXML,builtinNativeClasses.XMLList=ASXMLList,builtinNativeClasses["flash.xml.XMLNode"]=XMLNode$1,builtinNativeClasses["flash.xml.XMLDocument"]=XMLDocument$1,builtinNativeClasses["flash.xml.XMLParser"]=XMLParser$1,builtinNativeClasses["flash.xml.XMLTag"]=XMLTag,builtinNativeClasses["flash.xml.XMLNodeType"]=XMLNodeType$1,builtinNativeClasses.Math=ASMath,builtinNativeClasses.Date=ASDate,builtinNativeClasses.RegExp=ASRegExp,builtinNativeClasses.JSON=ASJSON,builtinNativeClasses["flash.utils.Proxy"]=ASProxy,builtinNativeClasses["flash.utils.Dictionary"]=Dictionary,builtinNativeClasses["flash.utils.ByteArray"]=ByteArray$1,builtinNativeClasses["avmplus.System"]=OriginalSystem,builtinNativeClasses["avmplus.File"]=AVMPlusFile,builtinNativeClasses.Error=ASError,builtinNativeClasses.DefinitionError=ASDefinitionError,builtinNativeClasses.EvalError=ASEvalError,builtinNativeClasses.RangeError=ASRangeError,builtinNativeClasses.ReferenceError=ASReferenceError,builtinNativeClasses.SecurityError=ASSecurityError,builtinNativeClasses.SyntaxError=ASSyntaxError,builtinNativeClasses.TypeError=ASTypeError,builtinNativeClasses.URIError=ASURIError,builtinNativeClasses.VerifyError=ASVerifyError,builtinNativeClasses.UninitializedError=ASUninitializedError,builtinNativeClasses.ArgumentError=ASArgumentError,builtinNativeClasses["flash.errors.IOError"]=ASIOError,builtinNativeClasses["flash.errors.EOFError"]=ASEOFError,builtinNativeClasses["flash.errors.MemoryError"]=ASMemoryError,builtinNativeClasses["flash.errors.IllegalOperationError"]=ASIllegalOperationError}function registerNativeClass(t,e,i,r){void 0===i&&(i=t),void 0===r&&(r=0),nativeClasses[t]=e,nativeClassLoaderNames.push({name:t,alias:i,nsType:r})}function registerNativeFunction(t,e){nativeFunctions[t]=e}registerNativeClass("__AS3__.vec.Vector$object",GenericVector,"ObjectVector",2),registerNativeClass("__AS3__.vec.Vector$int",Int32Vector,"Int32Vector",2),registerNativeClass("__AS3__.vec.Vector$uint",Uint32Vector,"Uint32Vector",2),registerNativeClass("__AS3__.vec.Vector$double",Float64Vector,"Float64Vector",2),registerNativeFunction("FlashUtilScript::getDefinitionByName",FlashUtilScript_getDefinitionByName),registerNativeFunction("FlashUtilScript::getTimer",FlashUtilScript_getTimer),registerNativeFunction("FlashUtilScript::navigateToURL",FlashNetScript_navigateToURL$1),registerNativeFunction("FlashNetScript::navigateToURL",FlashNetScript_navigateToURL$1),registerNativeFunction("FlashNetScript::sendToURL",FlashNetScript_sendToURL),registerNativeFunction("FlashUtilScript::escapeMultiByte",wrapJSGlobalFunction(jsGlobal.escape)),registerNativeFunction("FlashUtilScript::unescapeMultiByte",wrapJSGlobalFunction(jsGlobal.unescape)),registerNativeFunction("Toplevel::registerClassAlias",Toplevel_registerClassAlias),registerNativeFunction("Toplevel::getClassByAlias",Toplevel_getClassByAlias);var ClipboardService={setClipboard:function(t){notImplemented("setClipboard")}},IME=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"enabled",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"conversionMode",{get:function(){return"UNKNOWN"},set:function(t){},enumerable:!0,configurable:!0}),e.setCompositionString=function(t){},e.doConversion=function(){},e.compositionSelectionChanged=function(t,e){},e.compositionAbandoned=function(){},Object.defineProperty(e,"isSupported",{get:function(){return!1},enumerable:!0,configurable:!0}),e}(ASObject$1),System=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.classInitializer=function(){defineNonEnumerableProperty(this,"$Bgargv",this.sec.createArray([]))},Object.defineProperty(e,"ime",{get:function(){return null},enumerable:!0,configurable:!0}),e.setClipboard=function(t){t=axCoerceString$3(t),null!==ClipboardService?ClipboardService.setClipboard(t):warning("setClipboard is only available in the Firefox extension")},Object.defineProperty(e,"totalMemoryNumber",{get:function(){return 2097152},enumerable:!0,configurable:!0}),Object.defineProperty(e,"freeMemory",{get:function(){return 1048576},enumerable:!0,configurable:!0}),Object.defineProperty(e,"privateMemory",{get:function(){return 1048576},enumerable:!0,configurable:!0}),Object.defineProperty(e,"useCodePage",{get:function(){return this._useCodePage},set:function(t){this._useCodePage=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vmVersion",{get:function(){return"1.0 Shumway - Mozilla Research"},enumerable:!0,configurable:!0}),e.pause=function(){},e.resume=function(){},e.exit=function(t){},e.gc=function(){},e.pauseForGCIfCollectionImminent=function(t){},e.disposeXML=function(t){},Object.defineProperty(e,"swfVersion",{get:function(){return 19},enumerable:!0,configurable:!0}),Object.defineProperty(e,"apiVersion",{get:function(){return 26},enumerable:!0,configurable:!0}),e.getArgv=function(){return[]},e.getRunmode=function(){return"mixed"},e._useCodePage=!1,e}(ASObject$1),OriginalSystem=System;function initSystem(){initializeBuiltins()}var Stage$1=function(t){function e(i,r,n,o,s,a){void 0===r&&(r=550),void 0===n&&(n=400),void 0===o&&(o=null),void 0===s&&(s=30),void 0===a&&(a=!1);var l=t.call(this)||this;return l._frameRate=30,l._currentFps=0,l._time=0,l._debugtimer=0,l.SHOW_FRAME_RATE=!1,l.SHOW_FRAME_RATE=a,l._stageWidth=r,l._stageHeight=n,l._eventOnEnter=new Event(Event.ENTER_FRAME),l._eventFrameConstructed=new Event(Event.FRAME_CONSTRUCTED),l._eventExitFrame=new Event(Event.EXIT_FRAME),l._eventRender=new Event(Event.RENDER),l._events=[l._eventOnEnter,l._eventExitFrame],l._scaleMode=StageScaleMode.SHOW_ALL,l._align=StageAlign.TOP_LEFT,l._stage3Ds=[],AudioManager.setVolume(1),Graphics.get_material_for_color=function(t,i){void 0===i&&(i=1),0==t&&(t=1),16744704==t&&(i=1);var r={};if(e._useTextureAtlasForColors)return r=TextureAtlas.getTextureForColor(t,i),e._colorMaterials[r.bitmap.id]?(r.material=e._colorMaterials[r.bitmap.id],r):((n=new MethodMaterial(r.bitmap)).alphaBlending=!0,n.useColorTransform=!0,n.bothSides=!0,e._colorMaterials[r.bitmap.id]=n,r.material=n,r);var n,o=t+"_"+Math.round(100*i).toString();return e._colorMaterials[o]?(r.material=e._colorMaterials[o],r):((n=new MethodMaterial(t,i)).alphaBlending=!0,n.useColorTransform=!0,n.bothSides=!0,r.material=n,e._colorMaterials[o]=n,r)},Graphics.get_material_for_gradient=function(t){var i=TextureAtlas.getTextureForGradient(t),r=i.bitmap.id+t.type;if(e._textureMaterials[r])return i.material=e._textureMaterials[r],i;var n=new MethodMaterial(i.bitmap);return n.useColorTransform=!0,n.alphaBlending=!0,n.bothSides=!0,e._textureMaterials[r]=n,i.material=n,i},l._resizeCallbackDelegate=function(t){return l.resizeCallback(t)},l.eventMapping[Event.RESIZE]={adaptedType:"",addListener:l.initResizeListener,removeListener:l.removeResizeListener,callback:l._resizeCallbackDelegate},l._mouseLeaveCallbackDelegate=function(t){return l.mouseLeaveCallback(t)},l.eventMapping[Event.MOUSE_LEAVE]={adaptedType:"",addListener:l.initMouseLeaveListener,removeListener:l.removeMouseLeaveListener,callback:l._mouseLeaveCallbackDelegate},l.sec.flash.display.DisplayObject.axClass._activeStage=l,l._stage=l,l.initEninge(),l._resizeCallbackDelegate(null),l.adaptee.partition=new SceneGraphPartition(l.adaptee,!0),l._scene.root.addChild(l.adaptee),l._scene.renderer.view.backgroundColor=isNaN(o)?16777215:o,l._frameRate=s,l.SHOW_FRAME_RATE&&(l._fpsTextField=document.createElement("div"),l._fpsTextField.style.cssFloat="none",l._fpsTextField.style.backgroundColor="#000",l._fpsTextField.style.position="fixed",l._fpsTextField.style.top="5px",l._fpsTextField.style.width="100px",l._fpsTextField.style.height="20px",l._fpsTextField.style.right="5px",l._fpsTextField.style.textAlign="center",l._fpsTextField.style.color="#ffffff",l._fpsTextField.style.fontSize="16",l._fpsTextField.innerHTML="",document.body.appendChild(l._fpsTextField),setInterval((function(){return l.updateFPS()}),1e3)),i&&(l._mainSprite=new i,l.addChild(l._mainSprite),l.initListeners(),console.log("constructed Stage and create the entranceclass")),l._rendererStage.container.style.visibility="visible",l}return __extends(e,t),e.prototype.init=function(t){this._mainSprite=new t,this.addChild(this._mainSprite),this.initListeners(),this._resizeCallbackDelegate(null),this._rendererStage.container.style.visibility="visible"},Object.defineProperty(e.prototype,"view",{get:function(){return this._scene.renderer.view},enumerable:!0,configurable:!0}),e.prototype.updateFPS=function(){this._fpsTextField.innerText=this._currentFps.toFixed(2)+"/"+this._frameRate+" fps",this._currentFps=0},Object.defineProperty(e.prototype,"onlyMouseEnabled",{set:function(t){},enumerable:!0,configurable:!0}),e.prototype.initResizeListener=function(t,e){window.addEventListener("resize",e)},e.prototype.removeResizeListener=function(t,e){window.removeEventListener("resize",e)},e.prototype.resizeCallback=function(t){var e=window.innerWidth,i=window.innerHeight,r=0,n=0;switch(this.scaleMode){case StageScaleMode.NO_SCALE:this._projection.fieldOfView=360*Math.atan(window.innerHeight/1e3/2)/Math.PI;break;case StageScaleMode.SHOW_ALL:i=window.innerHeight,(e=this._stageWidth/this._stageHeight*i)>window.innerWidth&&(i=(e=window.innerWidth)*(this._stageHeight/this._stageWidth)),r=(window.innerWidth-e)/2,n=(window.innerHeight-i)/2,this._projection.fieldOfView=360*Math.atan(this._stageHeight/1e3/2)/Math.PI;break;case StageScaleMode.EXACT_FIT:case StageScaleMode.NO_BORDER:this._projection.fieldOfView=360*Math.atan(window.innerHeight/1e3/2)/Math.PI;break;default:console.log("Stage: only implemented StageScaleMode are NO_SCALE, SHOW_ALL")}switch(this.align){case StageAlign.TOP_LEFT:this._scene.renderer.view.y=0,this._scene.renderer.view.x=0;break;default:this._scene.renderer.view.y=0,this._scene.renderer.view.x=0,console.log("Stage: only implemented StageAlign is TOP_LEFT")}this._mainSprite&&(this._mainSprite.graphics.clear(),this._mainSprite.graphics.beginFill(16777215,0),this._mainSprite.graphics.drawRect(0,0,e,i),this._mainSprite.graphics.endFill()),this.updateSize(r,n,e,i),this.dispatchEvent(new this.sec.flash.events.Event(Event.RESIZE))},e.prototype.show=function(){},e.prototype.initMouseLeaveListener=function(t,e){window.addEventListener("mouseleave",e)},e.prototype.removeMouseLeaveListener=function(t,e){window.removeEventListener("mouseleave",e)},e.prototype.mouseLeaveCallback=function(t){this.dispatchEvent(new Event(Event.MOUSE_LEAVE))},e.prototype.initEninge=function(){this._scene=new Scene(new BasicPartition(new DisplayObjectContainer)),this._rendererStage=this._scene.view.stage,this._rendererStage.container.style.visibility="hidden",this._rendererStage.antiAlias=0,this._scene.renderer.renderableSorter=null,this._projection=new PerspectiveProjection,this._projection.coordinateSystem=CoordinateSystem.RIGHT_HANDED,this._projection.originX=-1,this._projection.originY=1;var t=new Camera;t.projection=this._projection,this._scene.camera=t,this._projection.fieldOfView=360*Math.atan(window.innerHeight/1e3/2)/Math.PI},e.prototype.updateSize=function(t,e,i,r){this._scene.view.x=t,this._scene.view.y=e,this._scene.view.width=i,this._scene.view.height=r,this._rendererStage.x=t,this._rendererStage.y=e,this._rendererStage.width=i,this._rendererStage.height=r,this._fpsTextField&&(this._fpsTextField.style.left=.5*window.innerWidth-100+"px")},e.prototype.initListeners=function(){console.log("init listeners"),window.addEventListener("resize",this._resizeCallbackDelegate),this._timer=new RequestAnimationFrame(this.onEnterFrame,this),this._timer.start(),this._resizeCallbackDelegate(null)},e.prototype.onEnterFrame=function(t){var e=Math.floor(1e3/this._frameRate);if(this._time+=Math.min(t,e),this._time>=e&&(this._time-=e,this._rendererStage.clear(),this.advanceFrame(this._events),this._scene.render(),this._currentFps++,this._debugtimer++,this._debugtimer%150==0)){var i={};this.debugDisplayGraph(i),console.log("SceneGraph frame :",this._debugtimer,i)}},e.prototype.render=function(){this._currentFps++,this._scene.render()},Object.defineProperty(e.prototype,"rendererStage",{get:function(){return this._rendererStage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseX",{get:function(){return this._scene.getLocalMouseX(this.adaptee)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseY",{get:function(){return this._scene.getLocalMouseY(this.adaptee)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessibilityImplementation",{set:function(t){console.log("textSnapshot not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowsFullScreen",{get:function(){return console.log("allowsFullScreen not implemented yet in flash/Stage"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowsFullScreenInteractive",{get:function(){return console.log("allowsFullScreenInteractive not implemented yet in flash/Stage"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"browserZoomFactor",{get:function(){return console.log("browserZoomFactor not implemented yet in flash/Stage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._scene.renderer.view.backgroundColor},set:function(t){this._scene.renderer.view.backgroundColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorCorrection",{get:function(){return console.log("colorCorrection not implemented yet in flash/Stage"),""},set:function(t){console.log("colorCorrection not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorCorrectionSupport",{get:function(){return console.log("colorCorrectionSupport not implemented yet in flash/Stage"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentsScaleFactor",{get:function(){return console.log("contentsScaleFactor not implemented yet in flash/Stage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayContextInfo",{get:function(){return console.log("displayContextInfo not implemented yet in flash/Stage"),""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayState",{get:function(){return console.log("displayState not implemented yet in flash/Stage"),""},set:function(t){console.log("displayState not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focus",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameRate",{get:function(){return this._frameRate},set:function(t){this._frameRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullScreenHeight",{get:function(){return console.log("fullScreenHeight not implemented yet in flash/Stage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullScreenSourceRect",{get:function(){return console.log("fullScreenSourceRect not implemented yet in flash/Stage"),null},set:function(t){console.log("fullScreenSourceRect not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullScreenWidth",{get:function(){return console.log("fullScreenWidth not implemented yet in flash/Stage"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseLock",{get:function(){return console.log("mouseLock not implemented yet in flash/Stage"),!1},set:function(t){console.log("mouseLock not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return""},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){this._scaleMode=t,this._resizeCallbackDelegate(null)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showDefaultContextMenu",{get:function(){return console.log("showDefaultContextMenu not implemented yet in flash/Stage"),!1},set:function(t){console.log("showDefaultContextMenu not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"softKeyboardRect",{get:function(){return console.log("softKeyboardRect not implemented yet in flash/Stage"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stage3Ds",{get:function(){return console.log("stage3Ds not implemented yet in flash/Stage"),this._stage3Ds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageFocusRect",{get:function(){return console.log("stageFocusRect not implemented yet in flash/Stage"),!1},set:function(t){console.log("stageFocusRect not implemented yet in flash/Stage")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageHeight",{get:function(){return this._stageHeight},set:function(t){this._stageHeight=t,this.resizeCallback()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageVideos",{get:function(){return console.log("stageVideos not implemented yet in flash/Stage"),[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageWidth",{get:function(){return this._stageWidth},set:function(t){this._stageWidth=t,this.resizeCallback()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabChildren",{get:function(){return console.log("tabChildren not implemented yet in flash/Stage"),!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSnapshot",{get:function(){return console.log("textSnapshot not implemented yet in flash/Stage"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wmodeGPU",{get:function(){return console.log("wmodeGPU not implemented yet in flash/Stage"),!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessibilityProperties",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheAsBitmap",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contextMenu",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusRect",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loaderInfo",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseChildren",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mouseEnabled",{get:function(){return!1},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numChildren",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 0},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opaqueBackground",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale9Grid",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleZ",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollRect",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabEnabled",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabIndex",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{set:function(t){},enumerable:!0,configurable:!0}),e.prototype.addChild=function(e){return t.prototype.addChild.call(this,e)},e.prototype.addChildAt=function(e,i){return t.prototype.addChildAt.call(this,e,i)},e.prototype.removeChildAt=function(e){return t.prototype.removeChildAt.call(this,e)},e.prototype.swapChildrenAt=function(e,i){return t.prototype.swapChildrenAt.call(this,e,i)},e.prototype.setChildIndex=function(t,e){return null},e.prototype.addEventListener=function(e,i,r,n,o){void 0===r&&(r=!1),void 0===n&&(n=0),void 0===o&&(o=!1),t.prototype.addEventListener.call(this,e,i,r=!1,n,o)},e.prototype.hasEventListener=function(e){return t.prototype.hasEventListener.call(this,e)},e.prototype.willTrigger=function(){return t.prototype.willTrigger.call(this)},e.prototype.dispatchEvent=function(e){return t.prototype.dispatchEvent.call(this,e)},e.prototype.invalidate=function(){console.log("invalidate not implemented yet in flash/Stage")},e.prototype.isFocusInaccessible=function(){return console.log("isFocusInaccessible not implemented yet in flash/Stage"),!1},e._colorMaterials={},e._textureMaterials={},e._useTextureAtlasForColors=!0,e}(DisplayObjectContainer$1),transposeTransform=new Uint32Array([0,4,8,12,1,5,9,13,2,6,10,14,3,7,11,15]),Matrix3D$1=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return e instanceof Matrix3D?i._adaptee=e:(i._adaptee=new Matrix3D,e&&e.length>=16?i.copyRawDataFrom(e,0,!1):i.identity()),i}return __extends(e,t),Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),e.interpolate=function(t,e,i){},Object.defineProperty(e.prototype,"rawData",{get:function(){var t=new this.sec.Float64Vector;return this.copyRawDataTo(t,0,!1),t},set:function(t){this.copyRawDataFrom(t,0,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return new this.sec.flash.geom.Vector3D(this._adaptee.position)},set:function(t){this.copyColumnFrom(3,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"determinant",{get:function(){return this._adaptee.determinant},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new this.sec.flash.geom.Matrix3D(this._adaptee.clone())},e.prototype.copyToMatrix3D=function(t){this._adaptee.copyTo(t.adaptee)},e.prototype.append=function(t){this._adaptee.append(t.adaptee)},e.prototype.prepend=function(t){this._adaptee.prepend(t.adaptee)},e.prototype.invert=function(){return this._adaptee.invert()},e.prototype.identity=function(){this._adaptee.identity()},e.prototype.decompose=function(t){void 0===t&&(t="eulerAngles"),this._adaptee.decompose(t),t=axCoerceString(t)},e.prototype.recompose=function(t,e){},e.prototype.appendTranslation=function(t,e,i){this._adaptee.appendTranslation(+t,+e,+i)},e.prototype.appendRotation=function(t,e,i){this._adaptee.appendRotation(+t,e.adaptee)},e.prototype.appendScale=function(t,e,i){this._adaptee.appendScale(+t,+e,+i)},e.prototype.prependTranslation=function(t,e,i){this._adaptee.prependTranslation(+t,+e,+i)},e.prototype.prependRotation=function(t,e,i){this._adaptee.prependRotation(+t,e.adaptee)},e.prototype.prependScale=function(t,e,i){this._adaptee.prependScale(+t,+e,+i)},e.prototype.transformVector=function(t){return new this.sec.flash.geom.Vector3D(this._adaptee.transformVector(t.adaptee))},e.prototype.deltaTransformVector=function(t){return new this.sec.flash.geom.Vector3D(this._adaptee.deltaTransformVector(t.adaptee))},e.prototype.transformVectors=function(t,e){for(var i=this._adaptee._rawData,r=i[0],n=i[4],o=i[8],s=i[12],a=i[1],l=i[5],h=i[9],c=i[13],u=i[2],p=i[6],d=i[10],f=i[14],_=0;_<t.length-2;_+=3){var g=t.axGetNumericProperty(_),m=t.axGetNumericProperty(_+1),y=t.axGetNumericProperty(_+2);e.push(r*g+n*m+o*y+s),e.push(a*g+l*m+h*y+c),e.push(u*g+p*m+d*y+f)}},e.prototype.transpose=function(){this._adaptee.transpose()},e.prototype.pointAt=function(t,e,i){},e.prototype.interpolateTo=function(t,e){},e.prototype.copyFrom=function(t){this._adaptee.copyFrom(t.adaptee)},e.prototype.copyRawDataTo=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),t=t,e>>>=0,i=!!i;var r=this._adaptee._rawData;if(i)for(var n=0,o=0|e;n<16;n++,o++)t.axSetNumericProperty(o,r[transposeTransform[n]]);else for(n=0,o=0|e;n<16;n++,o++)t.axSetNumericProperty(o,r[n])},e.prototype.copyRawDataFrom=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!1),t=t,e>>>=0,i=!!i;var r=this._adaptee._rawData;if(i)for(var n=0,o=0|e;n<16;n++,o++)r[transposeTransform[n]]=t.axGetNumericProperty(o)||0;else for(n=0,o=0|e;n<16;n++,o++)r[n]=t.axGetNumericProperty(o)||0},e.prototype.copyRowTo=function(t,e){this._adaptee.copyRowTo(t>>>0,e.adaptee)},e.prototype.copyColumnTo=function(t,e){this._adaptee.copyColumnTo(t>>>0,e.adaptee)},e.prototype.copyRowFrom=function(t,e){this._adaptee.copyRowFrom(t>>>0,e.adaptee)},e.prototype.copyColumnFrom=function(t,e){this._adaptee.copyColumnFrom(t>>>0,e.adaptee)},e.classInitializer=null,e}(ASObject$1),Vector3D$1=function(t){function e(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0);var o=t.call(this)||this;return o._adaptee=e instanceof Vector3D?e:new Vector3D(+e,+i,+r,+n),o}return __extends(e,t),e.classInitializer=function(){this.X_AXIS=Object.freeze(this.Create(1,0,0,0)),this.Y_AXIS=Object.freeze(this.Create(1,0,0,0)),this.Z_AXIS=Object.freeze(this.Create(1,0,0,0))},e.Create=function(t,e,i,r){var n=Object.create(this.tPrototype);return n.x=t,n.y=e,n.z=i,n.w=r,n},Object.defineProperty(e.prototype,"adaptee",{get:function(){return this._adaptee},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._adaptee._rawData[0]},set:function(t){this._adaptee._rawData[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._adaptee._rawData[1]},set:function(t){this._adaptee._rawData[1]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._adaptee._rawData[2]},set:function(t){this._adaptee._rawData[2]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"w",{get:function(){return this._adaptee._rawData[3]},set:function(t){this._adaptee._rawData[3]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._adaptee.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lengthSquared",{get:function(){return this._adaptee.lengthSquared},enumerable:!0,configurable:!0}),e.angleBetween=function(t,e){return Vector3D.angleBetween(t.adaptee,e.adaptee)},e.distance=function(t,e){return Vector3D.distance(t.adaptee,e.adaptee)},e.prototype.dotProduct=function(t){return this._adaptee.dotProduct(t.adaptee)},e.prototype.crossProduct=function(t){return new this.sec.flash.geom.Vector3D(this._adaptee.crossProduct(t.adaptee))},e.prototype.normalize=function(){return this._adaptee.normalize()},e.prototype.scaleBy=function(t){this._adaptee.scaleBy(+t)},e.prototype.incrementBy=function(t){this._adaptee.incrementBy(t.adaptee)},e.prototype.decrementBy=function(t){this._adaptee.decrementBy(t.adaptee)},e.prototype.add=function(t){return new this.sec.flash.geom.Vector3D(this._adaptee.add(t.adaptee))},e.prototype.subtract=function(t){return new this.sec.flash.geom.Vector3D(this._adaptee.subtract(t.adaptee))},e.prototype.negate=function(){this._adaptee.negate()},e.prototype.equals=function(t,e){return this._adaptee.equals(t.adaptee,e)},e.prototype.nearEquals=function(t,e,i){return this._adaptee.nearEquals(t.adaptee,e,i)},e.prototype.project=function(){this._adaptee.project()},e.prototype.copyFrom=function(t){this._adaptee.copyFrom(t.adaptee)},e.prototype.setTo=function(t,e,i){this._adaptee.setTo(t,e,i)},e.prototype.clone=function(){return new this.sec.flash.geom.Vector3D(this._adaptee.clone())},e.prototype.toString=function(){return"Vector3D("+this.x+", "+this.y+", "+this.z+")"},e}(ASObject$1),ApplicationDomain=function(t){function e(i){void 0===i&&(i=null);var r=t.call(this)||this;return null==i&&null!=e._currentDomain&&(i=e.getSystemDomain()),r._parentDomain=i,r._definitions={},r._font_definitions={},r._audio_definitions={},r}return __extends(e,t),e.getSystemDomain=function(){return null==e._systemDomain&&(e._systemDomain=new e),e._systemDomain},Object.defineProperty(e,"currentDomain",{get:function(){return null==e._systemDomain&&(e._systemDomain=new e),null==e._currentDomain&&(e._currentDomain=new e(e._systemDomain)),e._currentDomain},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"domainMemory",{get:function(){return console.log("domainMemory not implemented yet in flash/ApplicationDomain"),null},set:function(t){console.log("domainMemory not implemented yet in flash/ApplicationDomain")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"MIN_DOMAIN_MEMORY_LENGTH",{get:function(){return console.log("MIN_DOMAIN_MEMORY_LENGTH not implemented yet in flash/ApplicationDomain"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentDomain",{get:function(){return this._parentDomain},enumerable:!0,configurable:!0}),e.prototype.addDefinition=function(t,e){this._definitions[t]=e},e.prototype.addAudioDefinition=function(t,e){this._audio_definitions[t]=e},e.prototype.addFontDefinition=function(t,e){this._font_definitions[t]=e},e.prototype.getDefinition=function(t){if(this._definitions[t]){if(this._definitions[t].isAsset&&this._definitions[t].isAsset(SceneImage2D))return this._definitions[t];var e=this._definitions[t].adapter.clone();return e.adaptee.isAsset(MovieClip)&&(e.adaptee.currentFrameIndex=0),e}if(this._font_definitions[t])return this._font_definitions[t];if(this._audio_definitions[t]){var i=new Sound;return i.adaptee=this._audio_definitions[t],i}return null},e.prototype.getFontDefinition=function(t){return this._font_definitions[t]},e.prototype.getAwayJSAudio=function(t){return this._audio_definitions[t]},e.prototype.getAudioDefinition=function(t){var e=new Sound;return e.adaptee=this._audio_definitions[t],e},e.prototype.getQualifiedDefinitionNames=function(){var t=[];for(var e in this._definitions)this._definitions.hasOwnProperty(e)&&(t[t.length]=e);return t},e.prototype.hasDefinition=function(t){return this._definitions.hasOwnProperty(t)},e.prototype.hasFontDefinition=function(t){return this._font_definitions.hasOwnProperty(t)},e.prototype.hasAudioDefinition=function(t){return this._audio_definitions.hasOwnProperty(t)},e}(ASObject$1),System$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"freeMemory",{get:function(){return console.log("freeMemory not implemented yet in flash/System"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ime",{get:function(){return console.log("ime not implemented yet in flash/System"),null},enumerable:!0,configurable:!0}),Object.defineProperty(e,"privateMemory",{get:function(){return console.log("privateMemory not implemented yet in flash/System"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"processCPUUsage",{get:function(){return console.log("processCPUUsage not implemented yet in flash/System"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"totalMemory",{get:function(){return console.log("totalMemory not implemented yet in flash/System"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"totalMemoryNumber",{get:function(){return console.log("totalMemoryNumber not implemented yet in flash/System"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"useCodePage",{get:function(){return console.log("useCodePage not implemented yet in flash/System"),!1},set:function(t){console.log("useCodePage not implemented yet in flash/System")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vmVersion",{get:function(){return console.log("vmVersion not implemented yet in flash/System"),""},enumerable:!0,configurable:!0}),e.disposeXML=function(t){console.log("disposeXML not implemented yet in flash/System")},e.exit=function(t){console.log("exit not implemented yet in flash/System")},e.gc=function(){console.log("gc not implemented yet in flash/System")},e.pause=function(){console.log("pause not implemented yet in flash/System")},e.pauseForGCIfCollectionImminent=function(t){console.log("pauseForGCIfCollectionImminent not implemented yet in flash/System")},e.resume=function(){console.log("resume not implemented yet in flash/System")},e.setClipboard=function(t){console.log("setClipboard not implemented yet in flash/System")},e}(ASObject$1),TextFormat$2=function(t){function e(e,i,r,n,o,s,a,l,h,c,u,p,d){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===p&&(p=null),void 0===d&&(d=null);var f=t.call(this)||this;return f.adaptee=new TextFormat(e,i,r,n,o,s,a,l,h,c,u,p,d),f}return __extends(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return console.log("not implemented: TextFormat target"),null},set:function(t){console.log("not implemented: TextFormat target")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tabStops",{get:function(){return console.log("not implemented: TextFormat tabStops"),null},set:function(t){console.log("not implemented: TextFormat tabStops")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return console.log("not implemented: TextFormat display"),null},set:function(t){console.log("not implemented: TextFormat display")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bullet",{get:function(){return console.log("not implemented: TextFormat bullet"),null},set:function(t){console.log("not implemented: TextFormat bullet")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return console.log("not implemented: TextFormat url"),null},set:function(t){console.log("not implemented: TextFormat url")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this.adaptee.align},set:function(t){this.adaptee.align=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockIndent",{get:function(){return this.adaptee.blockIndent},set:function(t){this.adaptee.blockIndent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftMargin",{get:function(){return this.adaptee.leftMargin},set:function(t){this.adaptee.leftMargin=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightMargin",{get:function(){return this.adaptee.rightMargin},set:function(t){this.adaptee.rightMargin=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indent",{get:function(){return this.adaptee.indent},set:function(t){this.adaptee.indent=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.adaptee.color},set:function(t){this.adaptee.color=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kerning",{get:function(){return this.adaptee.kerning},set:function(t){this.adaptee.kerning=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leading",{get:function(){return this.adaptee.leading},set:function(t){this.adaptee.leading=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this.adaptee.letterSpacing},set:function(t){this.adaptee.letterSpacing=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.adaptee.size},set:function(t){this.adaptee.size=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{get:function(){return this.adaptee.bold},set:function(t){this.adaptee.bold=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"italic",{get:function(){return this.adaptee.italic},set:function(t){this.adaptee.italic=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"underline",{get:function(){return this.adaptee.underline},set:function(t){this.adaptee.underline=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font_name",{get:function(){return console.log("not implemented: TextFormat font_name"),null},set:function(t){console.log("not implemented: TextFormat font_name")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style_name",{get:function(){return console.log("not implemented: TextFormat style_name"),null},set:function(t){console.log("not implemented: TextFormat style_name")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return console.log("not implemented: TextFormat Font getter"),null},set:function(t){console.log("not implemented: TextFormat Font setter")},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return console.log("not implemented: textFOrmat.clone"),null},e}(ASObject$1),SoundChannel$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.axCallPublicProperty=function(t,e){return null},e.prototype.axGetPublicProperty=function(t){return null},e.prototype.axSetPublicProperty=function(t,e){return null},e.prototype.axHasPublicProperty=function(t){return null},e.prototype.axDeletePublicProperty=function(t){return null},e.prototype.axGetEnumerableKeys=function(){return[]},Object.defineProperty(e.prototype,"leftPeak",{get:function(){return console.log("leftPeak not implemented yet in flash/SoundChannel"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return console.log("position not implemented yet in flash/SoundChannel"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPeak",{get:function(){return console.log("rightPeak not implemented yet in flash/SoundChannel"),0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"soundTransform",{get:function(){return this._sndtranform},set:function(t){this._sound&&(this._sound.adaptee.volume=t.volume,this._sound.adaptee.pan=t.pan),this._sndtranform=t},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._sound?this._sound.stop():console.log("SoundChannel.stop: No sound exists")},e}(EventDispatcher$1),SoundTransform$1=function(t){function e(e,i){var r=t.call(this)||this;return r._vol=1,r._pan=.5,r}return __extends(e,t),e.prototype.axCallPublicProperty=function(t,e){return null},e.prototype.axGetPublicProperty=function(t){return null},e.prototype.axSetPublicProperty=function(t,e){return null},e.prototype.axHasPublicProperty=function(t){return null},e.prototype.axDeletePublicProperty=function(t){return null},e.prototype.axGetEnumerableKeys=function(){return[]},Object.defineProperty(e.prototype,"leftToLeft",{get:function(){return console.log("leftToLeft not implemented yet in flash/SoundTransform"),0},set:function(t){console.log("leftToLeft not implemented yet in flash/SoundTransform")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftToRight",{get:function(){return console.log("leftToRight not implemented yet in flash/SoundTransform"),0},set:function(t){console.log("leftToRight not implemented yet in flash/SoundTransform")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pan",{get:function(){return this._pan},set:function(t){this._pan=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightToLeft",{get:function(){return console.log("rightToLeft not implemented yet in flash/SoundTransform"),0},set:function(t){console.log("rightToLeft not implemented yet in flash/SoundTransform")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightToRight",{get:function(){return console.log("rightToRight not implemented yet in flash/SoundTransform"),0},set:function(t){console.log("rightToRight not implemented yet in flash/SoundTransform")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._vol},set:function(t){this._vol=t},enumerable:!0,configurable:!0}),e}(ASObject$1),SecurityDomain$1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ASObject$1),TextEvent$1=function(t){function e(e,i,r,n){var o=t.call(this,e,i,r)||this;return o._text=n,o}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.text)},e.prototype.toString=function(){return this.formatToString("TextEvent","type","bubbles","cancelable","text")},e.prototype.copyNativeData=function(t){},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.LINK="link",e.TEXT_INPUT="textInput",e}(Event$1),ErrorEvent$1=function(t){function e(e,i,r,n,o){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=""),void 0===o&&(o=0);var s=t.call(this,e,i,r,n)||this;return s.setID(o),s}return __extends(e,t),e.prototype.setID=function(t){this._id=t},Object.defineProperty(e.prototype,"errorID",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.text,this.errorID)},e.prototype.toString=function(){return this.formatToString("ErrorEvent","type","bubbles","cancelable","text","errorID")},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.ERROR="error",e}(TextEvent$1),IOErrorEvent$1=function(t){function e(e,i,r,n,o){return void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=""),void 0===o&&(o=0),t.call(this,e,i,r,n,o)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.text,this.errorID)},e.prototype.toString=function(){return this.formatToString("IOErrorEvent","type","bubbles","cancelable","text","errorID")},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.IO_ERROR="ioError",e.NETWORK_ERROR="networkError",e.DISK_ERROR="diskError",e.VERIFY_ERROR="verifyError",e}(ErrorEvent$1),FileLoadingService;function fscommand$1(t,e,i){e=axCoerceString$3(e),i=axCoerceString$3(i),console.log("FSCommand: "+e+"; "+i),"debugger"!==(e=e.toLowerCase())&&t.player.executeFSCommand(e,i)}var Security$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"exactSettings",{get:function(){return e._exactSettings},set:function(t){t=!!t,e._exactSettings=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"disableAVM1Loading",{get:function(){},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sandboxType",{get:function(){return e._sandboxType},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pageDomain",{get:function(){var t=FileLoadingService.resolveUrl("/").split("/");return t.pop(),t.pop()},enumerable:!0,configurable:!0}),e.allowDomain=function(){},e.allowInsecureDomain=function(){},e.loadPolicyFile=function(t){},e.showSettings=function(t){},e.duplicateSandboxBridgeInputArguments=function(t,e){},e.duplicateSandboxBridgeOutputArgument=function(t,e){},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.REMOTE="remote",e.LOCAL_WITH_FILE="localWithFile",e.LOCAL_WITH_NETWORK="localWithNetwork",e.LOCAL_TRUSTED="localTrusted",e.APPLICATION="application",e._exactSettings=!1,e._sandboxType="remote",e}(ASObject$1),Scene$1=function(t){function e(e,i,r,n){var o=t.call(this)||this;return o._name=axCoerceString$3(e),o._labels=i,o.offset=r,o._numFrames=0|n,o}return __extends(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labels",{get:function(){return this._labels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFrames",{get:function(){return this._numFrames},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this._labels.value.map((function(t){return t.clone()}));return new e(this._name,this.sec.createArrayUnsafe(t),this.offset,this._numFrames)},e.prototype.getLabelByName=function(t,e){e&&(t=t.toLowerCase());for(var i=this._labels.value,r=0;r<i.length;r++){var n=i[r];if(e?n.name.toLowerCase()===t:n.name===t)return n}return null},e.prototype.getLabelByFrame=function(t){for(var e=this._labels.value,i=0;i<e.length;i++){var r=e[i];if(r.frame===t)return r}return null},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),Keyboard=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"capsLock",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"numLock",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasVirtualKeyboard",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"physicalKeyboardType",{get:function(){},enumerable:!0,configurable:!0}),e.isAccessible=function(){},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),Point$2=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=t.call(this)||this;return r.x=+e,r.y=+i,r}return __extends(e,t),Object.defineProperty(e.prototype,"native_x",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"native_y",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!0,configurable:!0}),e.prototype.Point=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),e.interpolate=function(t,i,r){var n=1-r;return new e(t.x*r+i.x*n,t.y*r+i.y*n)},e.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return 0===i?Math.abs(r):0===r?Math.abs(i):Math.sqrt(i*i+r*r)},e.polar=function(t,i){return i=+i,new e((t=+t)*Math.cos(i),t*Math.sin(i))},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.offset=function(t,e){this.x+=+t,this.y+=+e},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.normalize=function(t){if(0!==this.x||0!==this.y){var e=+t/this.length;this.x*=e,this.y*=e}},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},e.prototype.setTo=function(t,e){this.x=+t,this.y=+e},e.prototype.toTwips=function(){return this.x=20*this.x|0,this.y=20*this.y|0,this},e.prototype.toPixels=function(){return this.x/=20,this.y/=20,this},e.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.toString=function(){return"(x="+this.x+", y="+this.y+")"},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),MouseEvent$2=function(t){function e(e,i,r,n,o,s,a,l,h,c,u){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===s&&(s=null),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===h&&(h=!1),void 0===c&&(c=!1),void 0===u&&(u=0);var p=t.call(this,e,i,r)||this;return p._localX=n,p._localY=o,p._relatedObject=s,p._ctrlKey=a,p._altKey=l,p._shiftKey=h,p._buttonDown=c,p._delta=u,p}return __extends(e,t),e.typeFromDOMType=function(t){switch(t){case"click":return e.CLICK;case"dblclick":return e.DOUBLE_CLICK;case"mousedown":return e.MOUSE_DOWN;case"mouseout":case"mouseover":case"mousemove":return e.MOUSE_MOVE;case"mouseup":return e.MOUSE_UP;default:notImplemented(t)}},e.prototype.fillFromAway=function(t){this.target=t.target,this.delta=t.delta,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey},Object.defineProperty(e.prototype,"localX",{get:function(){return this._localX/20|0},set:function(t){this._localX=20*t|0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localY",{get:function(){return this._localY/20|0},set:function(t){this._localY=20*t|0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageX",{get:function(){return isNaN(this.localX+this.localY)?Number.NaN:this._getGlobalPoint().x/20|0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageY",{get:function(){return isNaN(this.localX+this.localY)?Number.NaN:this._getGlobalPoint().y/20|0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementX",{get:function(){return this._movementX||0},set:function(t){this._movementX=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementY",{get:function(){return this._movementY||0},set:function(t){this._movementY=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delta",{get:function(){return this._delta},set:function(t){this._delta=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ctrlKey",{get:function(){return this._ctrlKey},set:function(t){this._ctrlKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altKey",{get:function(){return this._altKey},set:function(t){this._altKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shiftKey",{get:function(){return this._shiftKey},set:function(t){this._shiftKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttonDown",{get:function(){return this._buttonDown},set:function(t){this._buttonDown=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relatedObject",{get:function(){return this._relatedObject},set:function(t){this._relatedObject=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRelatedObjectInaccessible",{get:function(){return this._isRelatedObjectInaccessible},set:function(t){this._isRelatedObjectInaccessible=t},enumerable:!0,configurable:!0}),e.prototype.updateAfterEvent=function(){this.sec.player.requestRendering()},e.prototype._getGlobalPoint=function(){var t=this._position;(t||(t=this._position=new Point$2),this.target)?(t.setTo(this._localX,this._localY),this._target._getConcatenatedMatrix().transformPointInPlace(t)):t.setTo(0,0);return t},e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.localX,this.localY,this.relatedObject,this.ctrlKey,this.altKey,this.shiftKey,this.buttonDown,this.delta)},e.prototype.toString=function(){return this.formatToString("MouseEvent","type","bubbles","cancelable","eventPhase","localX","localY","relatedObject","ctrlKey","altKey","shiftKey","buttonDown","delta")},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.CLICK="click",e.DOUBLE_CLICK="doubleClick",e.MOUSE_DOWN="mouseDown",e.MOUSE_MOVE="mouseMove",e.MOUSE_OUT="mouseOut",e.MOUSE_OVER="mouseOver",e.MOUSE_UP="mouseUp",e.RELEASE_OUTSIDE="releaseOutside",e.MOUSE_WHEEL="mouseWheel",e.ROLL_OUT="rollOut",e.ROLL_OVER="rollOver",e.MIDDLE_CLICK="middleClick",e.MIDDLE_MOUSE_DOWN="middleMouseDown",e.MIDDLE_MOUSE_UP="middleMouseUp",e.RIGHT_CLICK="rightClick",e.RIGHT_MOUSE_DOWN="rightMouseDown",e.RIGHT_MOUSE_UP="rightMouseUp",e.CONTEXT_MENU="contextMenu",e}(Event$1),BitmapFilter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e._updateBlurBounds=function(t,i,r,n,o){void 0===o&&(o=!1);var s=e.blurFilterStepWidths[n-1];if(o){var a=s/4;i-=a,r-=a}var l=Math.ceil((i<1?1:i)*s),h=Math.ceil((r<1?1:r)*s);t.inflate(l,h)},e.prototype._updateFilterBounds=function(t){},e.prototype._serialize=function(t){t.writeInt(-1)},e.prototype.clone=function(){return null},e.classInitializer=null,e.EPS=1e-9,e.blurFilterStepWidths=[.5,1.05,1.35,1.55,1.75,1.9,2,2.1,2.2,2.3,2.5,3,3,3.5,3.5],e}(ASObject$1),GradientArrays=function(){function t(){}return t.sanitize=function(t,e,i){var r;isNullOrUndefined$1(t)||0===t.length?(this.colors=[],this.alphas=[],this.ratios=[]):isNullOrUndefined$1(i)?(this.colors=this.sanitizeColors(t),r=this.colors.length,this.ratios=this.initArray(r),isNullOrUndefined$1(e)?this.alphas=this.initArray(r):this.alphas=this.sanitizeAlphas(e,r,r,1)):0===i.length?(this.colors=[],this.alphas=[],this.ratios=[]):(r=Math.min(t.length,i.length,16),this.colors=this.sanitizeColors(t,r),this.ratios=this.sanitizeRatios(i,r),isNullOrUndefined$1(e)?this.alphas=this.initArray(r):this.alphas=this.sanitizeAlphas(e,r,r,1))},t.sanitizeColors=function(t,e){void 0===e&&(e=16);for(var i=[],r=0,n=Math.min(t.length,e);r<n;r++)i[r]=t[r]>>>0&16777215;return i},t.sanitizeAlphas=function(t,e,i,r){void 0===e&&(e=16),void 0===i&&(i=0),void 0===r&&(r=0);for(var n=[],o=0,s=Math.min(t.length,e);o<s;o++)n[o]=NumberUtilities.clamp(+t[o],0,1);for(;o<i;)n[o++]=r;return n},t.sanitizeRatios=function(t,e,i,r){void 0===e&&(e=16),void 0===i&&(i=0),void 0===r&&(r=0);for(var n=[],o=0,s=Math.min(t.length,e);o<s;o++)n[o]=NumberUtilities.clamp(+t[o],0,255);for(;o<i;)n[o++]=r;return n},t.initArray=function(t,e){void 0===e&&(e=0);for(var i=Array(t),r=0;r<t;r++)i[r]=e;return i},t}(),BitmapFilterType=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.INNER="inner",e.OUTER="outer",e.FULL="full",e}(ASObject$1),BevelFilter=function(t){function e(e,i,r,n,o,s,a,l,h,c,u,p){void 0===e&&(e=4),void 0===i&&(i=45),void 0===r&&(r=16777215),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=1),void 0===a&&(a=4),void 0===l&&(l=4),void 0===h&&(h=1),void 0===c&&(c=1),void 0===u&&(u="inner"),void 0===p&&(p=!1);var d=t.call(this)||this;return d.distance=e,d.angle=i,d.highlightColor=r,d.highlightAlpha=n,d.shadowColor=o,d.shadowAlpha=s,d.blurX=a,d.blurY=l,d.strength=h,d.quality=c,d.type=u,d.knockout=p,d}return __extends(e,t),e.FromUntyped=function(t){var i=t.colors[0]>>>8,r=(255&t.colors[0])/255,n=t.colors[1]>>>8,o=(255&t.colors[1])/255,s=BitmapFilterType.OUTER;t.onTop?s=BitmapFilterType.FULL:t.inner&&(s=BitmapFilterType.INNER);var a=180*t.angle/Math.PI;return new e(t.distance,a,i,r,n,o,t.blurX,t.blurY,t.strength,t.quality,s,t.knockout)},e.prototype._updateFilterBounds=function(t){if(this.type!==BitmapFilterType.INNER&&(BitmapFilter._updateBlurBounds(t,this._blurX,this._blurY,this._quality),0!==this._distance)){var e=this._angle*Math.PI/180;t.x+=Math.floor(Math.cos(e)*this._distance),t.y+=Math.floor(Math.sin(e)*this._distance),t.left>0&&(t.left=0),t.top>0&&(t.top=0)}},Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=+t%360},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightColor",{get:function(){return this._highlightColor},set:function(t){this._highlightColor=t>>>0&16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightAlpha",{get:function(){return this._highlightAlpha},set:function(t){this._highlightAlpha=NumberUtilities.clamp(+t,0,1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this._shadowColor=t>>>0&16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowAlpha",{get:function(){return this._shadowAlpha},set:function(t){this._shadowAlpha=NumberUtilities.clamp(+t,0,1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this._blurX},set:function(t){this._blurX=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._blurY},set:function(t){this._blurY=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"knockout",{get:function(){return this._knockout},set:function(t){this._knockout=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=NumberUtilities.clamp(0|t,0,15)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){null===(t=axCoerceString$3(t))?this.sec.throwError("TypeError",Errors$1.NullPointerError,"type"):t===BitmapFilterType.INNER||t===BitmapFilterType.OUTER?this._type=t:this._type=BitmapFilterType.FULL},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._distance,this._angle,this._highlightColor,this._highlightAlpha,this._shadowColor,this._shadowAlpha,this._blurX,this._blurY,this._strength,this._quality,this._type,this._knockout)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(BitmapFilter),BlurFilter=function(t){function e(e,i,r){void 0===e&&(e=4),void 0===i&&(i=4),void 0===r&&(r=1);var n=t.call(this)||this;return n.blurX=e,n.blurY=i,n.quality=r,n}return __extends(e,t),e.FromUntyped=function(t){return new e(t.blurX,t.blurY,t.quality)},e.prototype._updateFilterBounds=function(t){BitmapFilter._updateBlurBounds(t,this._blurX,this._blurY,this._quality,!0)},e.prototype._serialize=function(t){t.ensureAdditionalCapacity(16),t.writeIntUnsafe(1),t.writeFloatUnsafe(this._blurX),t.writeFloatUnsafe(this._blurY),t.writeIntUnsafe(this._quality)},Object.defineProperty(e.prototype,"blurX",{get:function(){return this._blurX},set:function(t){this._blurX=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._blurY},set:function(t){this._blurY=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=NumberUtilities.clamp(0|t,0,15)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._blurX,this._blurY,this._quality)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(BitmapFilter),ColorMatrixFilter=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return e?i.matrix=e:i._matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],i}return __extends(e,t),e.FromUntyped=function(t){var i=Object.create(e.axClass.tPrototype);return i._matrix=t.matrix,i},e.prototype._serialize=function(t){var e=this._matrix;t.ensureAdditionalCapacity(4*(e.length+1)),t.writeIntUnsafe(6);for(var i=0;i<e.length;i++)t.writeFloatUnsafe(e[i])},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.sec.createArrayUnsafe(this._matrix.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"matrix");for(var e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=t.value,r=0,n=Math.min(i.length,20);r<n;r++)e[r]=toNumber(i[r]);this._matrix=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.matrix)},e.classInitializer=null,e}(BitmapFilter),ConvolutionFilter=function(t){function e(e,i,r,n,o,s,a,l,h){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=!0),void 0===a&&(a=!0),void 0===l&&(l=0),void 0===h&&(h=0);var c=t.call(this)||this;return c.matrixX=e,c.matrixY=i,r?c.matrix=r:c._matrix=c._expandArray([],c._matrixX*c._matrixY),c.divisor=n,c.bias=o,c.preserveAlpha=s,c.clamp=a,c.color=l,c.alpha=h,c}return __extends(e,t),e.FromUntyped=function(t){return new e(t.matrixX,t.matrixY,t.matrix,t.divisor,t.bias,t.preserveAlpha,t.clamp,t.color>>>8,(255&t.color)/255)},e.prototype._expandArray=function(t,e,i){if(t)for(var r=t.length;r<e;)t[r++]=0;return t},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.sec.createArrayUnsafe(this._matrix.slice(0,this._matrixX*this._matrixY))},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"matrix");for(var e=t.value,i=this._matrixX*this._matrixY,r=Math.min(e.length,i),n=Array(r),o=0;o<r;o++)n[o]=toNumber(e[o]);this._expandArray(n,i),this._matrix=n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrixX",{get:function(){return this._matrixX},set:function(t){var e=0|NumberUtilities.clamp(+t,0,15);this._matrixX!==e&&(this._matrixX=e,this._expandArray(this._matrix,e*this._matrixY))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrixY",{get:function(){return this._matrixY},set:function(t){var e=0|NumberUtilities.clamp(+t,0,15);this._matrixY!==e&&(this._matrixY=e,this._expandArray(this._matrix,e*this._matrixX))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"divisor",{get:function(){return this._divisor},set:function(t){this._divisor=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(t){this._bias=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preserveAlpha",{get:function(){return this._preserveAlpha},set:function(t){this._preserveAlpha=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clamp",{get:function(){return this._clamp},set:function(t){this._clamp=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t>>>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=NumberUtilities.clamp(+t,0,1)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._matrixX,this._matrixY,this.matrix,this._divisor,this._bias,this._preserveAlpha,this._clamp,this._color,this._alpha)},e.classInitializer=null,e}(BitmapFilter),DisplacementMapFilter=function(t){function e(e,i,r,n,o,s,a,l,h){void 0===e&&(e=null),void 0===i&&(i=null),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a="wrap"),void 0===l&&(l=0),void 0===h&&(h=0);var c=t.call(this)||this;return c.mapBitmap=e,c.mapPoint=i,c.componentX=r,c.componentY=n,c.scaleX=o,c.scaleY=s,c.mode=a,c.color=l,c.alpha=h,c}return __extends(e,t),e.FromUntyped=function(t){return new e(t.mapBitmap,t.mapPoint,t.componentX,t.componentY,t.scaleX,t.scaleY,t.mode,t.color,t.alpha)},Object.defineProperty(e.prototype,"mapBitmap",{get:function(){return this._mapBitmap},set:function(t){this._mapBitmap=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapPoint",{get:function(){return this._mapPoint},set:function(t){this._mapPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentX",{get:function(){return this._componentX},set:function(t){this._componentX=t>>>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentY",{get:function(){return this._componentY},set:function(t){this._componentY=t>>>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=axCoerceString$3(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t>>>0&16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=+t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._mapBitmap,this._mapPoint,this._componentX,this._componentY,this._scaleX,this._scaleY,this._mode,this._color,this._alpha)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(BitmapFilter),DropShadowFilter=function(t){function e(e,i,r,n,o,s,a,l,h,c,u){void 0===e&&(e=4),void 0===i&&(i=45),void 0===r&&(r=0),void 0===n&&(n=1),void 0===o&&(o=4),void 0===s&&(s=4),void 0===a&&(a=1),void 0===l&&(l=1),void 0===h&&(h=!1),void 0===c&&(c=!1),void 0===u&&(u=!1);var p=t.call(this)||this;return p.distance=e,p.angle=i,p.color=r,p.alpha=n,p.blurX=o,p.blurY=s,p.strength=a,p.quality=l,p.inner=h,p.knockout=c,p.hideObject=u,p}return __extends(e,t),e.FromUntyped=function(t){var i=t.colors[0]>>>8,r=(255&t.colors[0])/255,n=180*t.angle/Math.PI,o=!t.compositeSource;return new e(t.distance,n,i,r,t.blurX,t.blurY,t.strength,t.quality,t.inner,t.knockout,o)},e.prototype._updateFilterBounds=function(t){if(!this.inner&&(BitmapFilter._updateBlurBounds(t,this._blurX,this._blurY,this._quality),0!==this._distance)){var e=this._angle*Math.PI/180;t.x+=Math.floor(Math.cos(e)*this._distance),t.y+=Math.floor(Math.sin(e)*this._distance),t.left>0&&(t.left=0),t.top>0&&(t.top=0)}},Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=+t%360},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t>>>0&16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=NumberUtilities.clamp(+t,0,1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this._blurX},set:function(t){this._blurX=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._blurY},set:function(t){this._blurY=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hideObject",{get:function(){return this._hideObject},set:function(t){this._hideObject=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inner",{get:function(){return this._inner},set:function(t){this._inner=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"knockout",{get:function(){return this._knockout},set:function(t){this._knockout=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=NumberUtilities.clamp(0|t,0,15)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._distance,this._angle,this._color,this._alpha,this._blurX,this._blurY,this._strength,this._quality,this._inner,this._knockout,this._hideObject)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(BitmapFilter),GlowFilter=function(t){function e(e,i,r,n,o,s,a,l){void 0===e&&(e=16711680),void 0===i&&(i=1),void 0===r&&(r=6),void 0===n&&(n=6),void 0===o&&(o=2),void 0===s&&(s=1),void 0===a&&(a=!1),void 0===l&&(l=!1);var h=t.call(this)||this;return h.color=e,h.alpha=i,h.blurX=r,h.blurY=n,h.strength=o,h.quality=s,h.inner=a,h.knockout=l,h}return __extends(e,t),e.FromUntyped=function(t){return new e(t.colors[0]>>>8,(255&t.colors[0])/255,t.blurX,t.blurY,t.strength,t.quality,t.inner,t.knockout)},e.prototype._updateFilterBounds=function(t){BitmapFilter._updateBlurBounds(t,this._blurX,this._blurY,this._quality)},Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t>>>0&16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha=NumberUtilities.clamp(+t,0,1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this._blurX},set:function(t){this._blurX=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._blurY},set:function(t){this._blurY=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inner",{get:function(){return this._inner},set:function(t){this._inner=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"knockout",{get:function(){return this._knockout},set:function(t){this._knockout=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=NumberUtilities.clamp(0|t,0,15)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._color,this._alpha,this._blurX,this._blurY,this._strength,this._quality,this._inner,this._knockout)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(BitmapFilter),GradientBevelFilter=function(t){function e(e,i,r,n,o,s,a,l,h,c,u){void 0===e&&(e=4),void 0===i&&(i=45),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=4),void 0===a&&(a=4),void 0===l&&(l=1),void 0===h&&(h=1),void 0===c&&(c="inner"),void 0===u&&(u=!1);var p=t.call(this)||this;return p.distance=e,p.angle=i,GradientArrays.sanitize(r?r.value:null,n?n.value:null,o?o.value:null),p._colors=GradientArrays.colors,p._alphas=GradientArrays.alphas,p._ratios=GradientArrays.ratios,p.blurX=s,p.blurY=a,p.strength=l,p.quality=h,p.type=c,p.knockout=u,p}return __extends(e,t),e.FromUntyped=function(t){for(var i=[],r=[],n=0;n<t.colors.length;n++){var o=t.colors[n];i.push(o>>>8),r.push(255&o)}var s=BitmapFilterType.OUTER;t.onTop?s=BitmapFilterType.FULL:t.inner&&(s=BitmapFilterType.INNER);var a=180*t.angle/Math.PI;return new e(t.distance,a,this.sec.createArrayUnsafe(i),this.sec.createArrayUnsafe(r),this.sec.createArrayUnsafe(t.ratios),t.blurX,t.blurY,t.strength,t.quality,s,t.knockout)},e.prototype._updateFilterBounds=function(t){if(this.type!==BitmapFilterType.INNER&&(BitmapFilter._updateBlurBounds(t,this._blurX,this._blurY,this._quality),0!==this._distance)){var e=this._angle*Math.PI/180;t.x+=Math.floor(Math.cos(e)*this._distance),t.y+=Math.floor(Math.sin(e)*this._distance),t.left>0&&(t.left=0),t.top>0&&(t.top=0)}},Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=+t%360},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colors",{get:function(){return this.sec.createArrayUnsafe(this._colors.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"colors"),this._colors=GradientArrays.sanitizeColors(t.value);var e=this._colors.length;this._alphas=GradientArrays.sanitizeAlphas(this._alphas,e,e),this._ratios=GradientArrays.sanitizeRatios(this._ratios,e,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphas",{get:function(){return this.sec.createArrayUnsafe(this._alphas.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"alphas"),GradientArrays.sanitize(this._colors,t.value,this._ratios),this._colors=GradientArrays.colors,this._alphas=GradientArrays.alphas,this._ratios=GradientArrays.ratios},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratios",{get:function(){return this.sec.createArrayUnsafe(this._ratios.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"ratios"),GradientArrays.sanitize(this._colors,this._alphas,t.value),this._colors=GradientArrays.colors,this._alphas=GradientArrays.alphas,this._ratios=GradientArrays.ratios},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this._blurX},set:function(t){this._blurX=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._blurY},set:function(t){this._blurY=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"knockout",{get:function(){return this._knockout},set:function(t){this._knockout=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=NumberUtilities.clamp(0|t,0,15)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){null===(t=axCoerceString$3(t))?this.sec.throwError("TypeError",Errors$1.NullPointerError,"type"):t===BitmapFilterType.INNER||t===BitmapFilterType.OUTER?this._type=t:this._type=BitmapFilterType.FULL},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._distance,this._angle,this.colors,this.alphas,this.ratios,this._blurX,this._blurY,this._strength,this._quality,this._type,this._knockout)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(BitmapFilter),GradientGlowFilter=function(t){function e(e,i,r,n,o,s,a,l,h,c,u){void 0===e&&(e=4),void 0===i&&(i=45),void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=4),void 0===a&&(a=4),void 0===l&&(l=1),void 0===h&&(h=1),void 0===c&&(c="inner"),void 0===u&&(u=!1);var p=t.call(this)||this;return p.distance=e,p.angle=i,GradientArrays.sanitize(r?r.value:null,n?n.value:null,o?o.value:null),p._colors=GradientArrays.colors,p._alphas=GradientArrays.alphas,p._ratios=GradientArrays.ratios,p.blurX=s,p.blurY=a,p.strength=l,p.quality=h,p.type=c,p.knockout=u,p}return __extends(e,t),e.FromUntyped=function(t){for(var i=[],r=[],n=0;n<t.colors.length;n++){var o=t.colors[n];i.push(o>>>8),r.push(255&o)}var s=BitmapFilterType.OUTER;t.onTop?s=BitmapFilterType.FULL:t.inner&&(s=BitmapFilterType.INNER);var a=180*t.angle/Math.PI;return new e(t.distance,a,this.sec.createArrayUnsafe(i),this.sec.createArrayUnsafe(r),this.sec.createArrayUnsafe(t.ratios),t.blurX,t.blurY,t.strength,t.quality,s,t.knockout)},e.prototype._updateFilterBounds=function(t){if(this.type!==BitmapFilterType.INNER&&(BitmapFilter._updateBlurBounds(t,this._blurX,this._blurY,this._quality),0!==this._distance)){var e=this._angle*Math.PI/180;t.x+=Math.floor(Math.cos(e)*this._distance),t.y+=Math.floor(Math.sin(e)*this._distance),t.left>0&&(t.left=0),t.top>0&&(t.top=0)}},Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=+t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=+t%360},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colors",{get:function(){return this.sec.createArrayUnsafe(this._colors.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"colors"),this._colors=GradientArrays.sanitizeColors(t.value);var e=this._colors.length;this._alphas=GradientArrays.sanitizeAlphas(this._alphas,e,e),this._ratios=GradientArrays.sanitizeRatios(this._ratios,e,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphas",{get:function(){return this.sec.createArrayUnsafe(this._alphas.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"alphas"),GradientArrays.sanitize(this._colors,t.value,this._ratios),this._colors=GradientArrays.colors,this._alphas=GradientArrays.alphas,this._ratios=GradientArrays.ratios},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratios",{get:function(){return this.sec.createArrayUnsafe(this._ratios.concat())},set:function(t){isNullOrUndefined$1(t)&&this.sec.throwError("TypeError",Errors$1.NullPointerError,"ratios"),GradientArrays.sanitize(this._colors,this._alphas,t.value),this._colors=GradientArrays.colors,this._alphas=GradientArrays.alphas,this._ratios=GradientArrays.ratios},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this._blurX},set:function(t){this._blurX=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this._blurY},set:function(t){this._blurY=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"knockout",{get:function(){return this._knockout},set:function(t){this._knockout=!!t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=NumberUtilities.clamp(0|t,0,15)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strength",{get:function(){return this._strength},set:function(t){this._strength=NumberUtilities.clamp(+t,0,255)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){null===(t=axCoerceString$3(t))?this.sec.throwError("TypeError",Errors$1.NullPointerError,"type"):t===BitmapFilterType.INNER||t===BitmapFilterType.OUTER?this._type=t:this._type=BitmapFilterType.FULL},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._distance,this._angle,this.colors,this.alphas,this.ratios,this._blurX,this._blurY,this._strength,this._quality,this._type,this._knockout)},e.classInitializer=null,e}(BitmapFilter),TouchscreenType=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.FINGER="finger",e.STYLUS="stylus",e.NONE="none",e}(ASObject$1),Capabilities$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"isEmbeddedInAcrobat",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasEmbeddedVideo",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasAudio",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"avHardwareDisable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasAccessibility",{get:function(){return e._hasAccessibility},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasAudioEncoder",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasMP3",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasPrinting",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasScreenBroadcast",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasScreenPlayback",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasStreamingAudio",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasStreamingVideo",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasVideoEncoder",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isDebugger",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"localFileReadDisable",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"language",{get:function(){return e._language},enumerable:!0,configurable:!0}),Object.defineProperty(e,"manufacturer",{get:function(){return e._manufacturer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"os",{get:function(){if(null===e._os){var t,i=window.navigator.userAgent;if(i.indexOf("Macintosh")>0)if(-1===i.indexOf("Mac OS X "))t="Mac OS 10.6";else{var r=i.split("Mac OS X ")[1];t=r.substr(0,r.indexOf(";"))}else t=i.indexOf("Windows")>0?"Windows XP":i.indexOf("Linux")>0?"Linux":/(iPad|iPhone|iPod|Android)/.test(i)?"iPhone3,1":"Generic OS";e._os=t}return e._os},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cpuArchitecture",{get:function(){return"x86"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"playerType",{get:function(){return e._playerType},enumerable:!0,configurable:!0}),Object.defineProperty(e,"serverString",{get:function(){return toKeyValueArray({OS:e.os}).map((function(t){return t[0]+"="+encodeURIComponent(t[1])})).join("&")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"version",{get:function(){return e._version},enumerable:!0,configurable:!0}),Object.defineProperty(e,"screenColor",{get:function(){return"color"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pixelAspectRatio",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"screenDPI",{get:function(){return e._screenDPI},enumerable:!0,configurable:!0}),Object.defineProperty(e,"screenResolutionX",{get:function(){return window.screen.width},enumerable:!0,configurable:!0}),Object.defineProperty(e,"screenResolutionY",{get:function(){return window.screen.height},enumerable:!0,configurable:!0}),Object.defineProperty(e,"touchscreenType",{get:function(){return TouchscreenType.NONE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasIME",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasTLS",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"maxLevelIDC",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"supports32BitProcesses",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"supports64BitProcesses",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"_internal",{get:function(){},enumerable:!0,configurable:!0}),e.hasMultiChannelAudio=function(t){return!1},e.classInitializer=null,e._hasAccessibility=!1,e._language="en",e._manufacturer="Mozilla Research",e._os=null,e._playerType="PlugIn",e._version="SHUMWAY 10,0,0,0",e._screenDPI=96,e}(ASObject$1),ExternalInterfaceService={enabled:!1,initJS:function(t){},registerCallback:function(t){},unregisterCallback:function(t){},eval:function(t){},call:function(t){},getId:function(){return null}},ExternalInterface$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ensureInitialized=function(){this.available||this.sec.throwError("Error",Errors$1.ExternalInterfaceNotAvailableError),this.initialized||(this.initialized=!0,ExternalInterfaceService.initJS(this._callIn))},e.call=function(t){this.ensureInitialized();var e="";if(arguments.length>1){for(var i=[],r=1;r<arguments.length;r++)i.push(this.convertToJSString(arguments[r]));e=i.join(",")}var n=this.$BgmarshallExceptions?'"<exception>" + e + "</exception>";':'"<undefined/>";',o="try {__flash__toXML("+t+"("+e+"));} catch (e) {"+n+"}",s=this._evalJS(o);return null==s?null:this.convertFromXML(this.convertToXML(s))},e.addCallback=function(t,e){if(this.ensureInitialized(),e){var i=this;this._addCallback(t,(function(t,r){var n,o=!0;if(r){for(var s=[],a=0;a<r.length;a++){var l=r[a];"object"==typeof l&&l?s.push(i.sec.createObjectFromJS(l,!0)):s.push(l)}r=s}else{var h=this.convertToXML(t),c=h.attribute("returntype");o=c&&"javascript"==c._value,r=[];for(a=0;a<h._children.length;a++){var u=h._children[a];r.push(this.convertFromXML(u))}}try{n=e.axApply(null,r)}catch(t){if(!this.$BgmarshallExceptions)throw t;n=t}return o?i.convertToJSString(n):i.convertToXMLString(n)}))}else this._removeCallback(t)},Object.defineProperty(e,"available",{get:function(){return ExternalInterfaceService.enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e,"objectID",{get:function(){return ExternalInterfaceService.getId()},enumerable:!0,configurable:!0}),e._addCallback=function(t,i){e.registeredCallbacks[t]=i},e._removeCallback=function(t){delete e.registeredCallbacks[t]},e._evalJS=function(t){return t=axCoerceString$3(t),ExternalInterfaceService.eval(t)},e._callIn=function(t,i){var r=e.registeredCallbacks[t];if(r)return r(t,i)},e._callOut=function(t){return t=axCoerceString$3(t),ExternalInterfaceService.call(t)},e.convertToXML=function(t){var e=this.sec.system.getClass(Multiname.FromSimpleName("XML")),i=e.ignoreWhitespace;e.ignoreWhitespace=!1;var r=e.Create(t);return e.ignoreWhitespace=i,r},e.convertToXMLString=function(t){switch(typeof t){case"boolean":return t?"<true/>":"<false/>";case"number":return"<number>"+t+"</number>";case"string":return"<string>"+t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;")+"</string>";case"object":if(null===t)return"<null/>";if(this.sec.AXDate.axIsInstanceOf(t))return"<date>"+t.time+"</date>";if(this.sec.AXError.axIsInstanceOf(t))return this.$BgmarshallExceptions?"<exception>"+t+"</exception>":"<null/>";var e=[];if(t.hasOwnProperty("$Bglength")){for(var i=t.$Bglength,r=0;r<i;r++){var n=this.convertToXMLString(t.axGetNumericProperty(r));e.push('<property id="'+r+'">'+n+"</property>")}return"<array>"+e.join("")+"</array>"}var o=t.axGetEnumerableKeys();for(r=0;r<o.length;r++){var s=o[r];n=this.convertToXMLString(t.axGetPublicProperty(s));e.push('<property id="'+s+'">'+n+"</property>")}return"<object>"+e.join("")+"</object>";default:return"<undefined/>"}},e.convertFromXML=function(t){switch(t._name.name){case"true":return!0;case"false":return!1;case"number":return Number(String(t.children()));case"string":return String(t.children());case"null":return null;case"date":return this.sec.AXDate.axConstruct([Number(String(t.children()))]);case"exception":if(this.$BgmarshallExceptions)throw this.sec.AXError.axConstruct([String(t.children())]);return;case"array":case"object":for(var e="object"===t._name.name?this.sec.createObject():this.sec.createArrayUnsafe([]),i=0;i<t._children.length;i++){var r=t._children[i];e.axSetPublicProperty(extractId(r),this.convertFromXML(r._children[0]))}return e;case"class":var n=Multiname.FromFQNString(String(t.children()),0);return this.sec.application.getClass(n);default:return}},e.convertToJSString=function(t){if("string"==typeof t)return'"'+t.split("\r").join("\\r").split("\n").join("\\n").split('"').join('\\"')+'"';if(this.sec.AXArray.axIsInstanceOf(t)){for(var e=[],i=t.value,r=0;r<i.length;r++)e.push(this.convertToJSString(i[r]));return"["+e.join(",")+"]"}if(this.sec.AXDate.axIsInstanceOf(t))return"new Date("+t.value+")";if(this.$BgmarshallExceptions&&this.sec.AXError.axIsInstanceOf(t))return'throw "'+t+'"';if("object"==typeof t&&null!==t){e=[];var n=t.axGetEnumerableKeys();for(r=0;r<n.length;r++){var o=n[r];e.push(o+":"+this.convertToJSString(t.axGetPublicProperty(o)))}return"({"+e.join(",")+"})"}return String(t)},e.classInitializer=null,e.initialized=!1,e.registeredCallbacks=Object.create(null),e}(ASObject$1);function extractId(t){for(var e=0;e<t._attributes.length;e++){var i=t._attributes[e];if("id"===i._name.name)return i._value}}var TimerEvent$1=function(t){function e(e,i,r){return t.call(this,e,i,r)||this}return __extends(e,t),e.prototype.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},e.prototype.toString=function(){return this.formatToString("TimerEvent","type","bubbles","cancelable","eventPhase")},e.prototype.updateAfterEvent=function(){this.sec.player.requestRendering()},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.TIMER="timer",e.TIMER_COMPLETE="timerComplete",e}(Event$1),Timer$1=function(t){function e(e,i){var r=t.call(this)||this;return r._delay=+e,r._repeatCount=0|i,r._iteration=0,r}return __extends(e,t),Object.defineProperty(e.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},set:function(t){((t=+t)<0||!isFinite(t))&&this.sec.throwError("RangeError",Errors$1.DelayRangeError),this._delay=t,this._running&&(this.stop(),this.start())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"repeatCount",{get:function(){return this._repeatCount},set:function(t){this._repeatCount=0|t,this._repeatCount&&this._running&&this._iteration>=this._repeatCount&&this.stop()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentCount",{get:function(){return this._iteration},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._running&&this.stop(),this._iteration=0},e.prototype.stop=function(){this._running=!1,clearInterval(this._interval)},e.prototype.start=function(){this._running||(this._running=!0,this._interval=setInterval(this._tick.bind(this),this._delay))},e.prototype._tick=function(){if(this._iteration++,this._running){if(e.dispatchingEnabled)try{this.dispatchEvent(new TimerEvent$1("timer",!0,!1))}catch(t){warning("caught error under Timer TIMER event: ",t)}if(0!==this._repeatCount&&this._iteration>=this._repeatCount){this.stop();try{this.dispatchEvent(new TimerEvent$1(TimerEvent$1.TIMER_COMPLETE,!1,!1))}catch(t){warning("caught error under Timer COMPLETE event: ",t)}}}},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.dispatchingEnabled=!0,e}(EventDispatcher$1),ProgressEvent$1=function(t){function e(e,i,r,n,o){void 0===i&&(i=!1),void 0===r&&(r=!1),void 0===n&&(n=0),void 0===o&&(o=0);var s=t.call(this,e,i,r)||this;return s._bytesLoaded=n,s._bytesTotal=o,s}return __extends(e,t),Object.defineProperty(e.prototype,"bytesLoaded",{get:function(){return this._bytesLoaded},set:function(t){this._bytesLoaded=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesTotal",{get:function(){return this._bytesTotal},set:function(t){this._bytesTotal=t},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._type,this._bubbles,this._cancelable,this._bytesLoaded,this._bytesTotal)},e.prototype.toString=function(){return this.formatToString("ProgressEvent","bubbles","cancelable","eventPhase","bytesLoaded","bytesTotal")},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e.PROGRESS="progress",e.SOCKET_DATA="socketData",e}(Event$1),SoundTransform$2=function(t){function e(e,i){void 0===e&&(e=1),void 0===i&&(i=0);var r=t.call(this)||this;return r.volume=+e,r.pan=+i,r}return __extends(e,t),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){t=+t,this._volume=t,this._updateTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftToLeft",{get:function(){return this._leftToLeft},set:function(t){t=+t,this._leftToLeft=t,this._updateTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftToRight",{get:function(){return this._leftToRight},set:function(t){t=+t,this._leftToRight=t,this._updateTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightToRight",{get:function(){return this._rightToRight},set:function(t){t=+t,this._rightToRight=t,this._updateTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightToLeft",{get:function(){return this._rightToLeft},set:function(t){t=+t,this._rightToLeft=t,this._updateTransform()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pan",{get:function(){return 0===this._leftToRight&&0===this._rightToLeft?1-this._leftToLeft*this._leftToLeft:0},set:function(t){this.leftToLeft=Math.sqrt(1-t),this.leftToRight=0,this.rightToRight=Math.sqrt(1+t),this.rightToLeft=0},enumerable:!0,configurable:!0}),e.prototype._updateTransform=function(){},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1),SoundMixer$1=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"bufferTime",{get:function(){return e._bufferTime},set:function(t){e._bufferTime=0|t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"soundTransform",{get:function(){return isNullOrUndefined$1(e._soundTransform)?new SoundTransform$2:new SoundTransform$2(e._soundTransform.volume,e._soundTransform.pan)},set:function(t){e._soundTransform=isNullOrUndefined$1(t)?new SoundTransform$2:t,e._updateAllSoundSources()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"audioPlaybackMode",{get:function(){},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e,"useSpeakerphoneForVoice",{get:function(){},set:function(t){},enumerable:!0,configurable:!0}),e.stopAll=function(){e._registeredSoundSources.forEach((function(t){t.stopSound()})),e._registeredSoundSources=[]},e.computeSpectrum=function(t,e,i){for(var r=new Float32Array(1024),n=0;n<1024;n++)r[n]=Math.random();t.writeRawBytes(r),t.position=0},e.areSoundsInaccessible=function(){},e._getMasterVolume=function(){return e._masterVolume},e._setMasterVolume=function(t){t=+t,e._masterVolume=t,e._updateAllSoundSources()},e._registerSoundSource=function(t){e._registeredSoundSources.push(t)},e._unregisterSoundSource=function(t){var i=e._registeredSoundSources.indexOf(t);i>=0&&e._registeredSoundSources.splice(i,1)},e._updateSoundSource=function(t){var i=t.soundTransform.volume;e._soundTransform&&(i*=e._soundTransform.volume),i*=e._getMasterVolume(),t.updateSoundLevels(i)},e._updateAllSoundSources=function(){e._registeredSoundSources.forEach(e._updateSoundSource)},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e._masterVolume=1,e._registeredSoundSources=[],e._bufferTime=0,e}(ASObject$1),TextSnapshot=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"charCount",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.findText=function(t,e,i){},e.prototype.getSelected=function(t,e){},e.prototype.getSelectedText=function(t){},e.prototype.getText=function(t,e,i){},e.prototype.getTextRunInfo=function(t,e){},e.prototype.hitTestTextNearPos=function(t,e,i){},e.prototype.setSelectColor=function(t){},e.prototype.setSelected=function(t,e,i){},e.classInitializer=null,e}(ASObject$1),URLVariables$1=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i._ignoreDecodingErrors=!1,e&&i.decode(e),i}return __extends(e,t),e.prototype.decode=function(t){for(var e=(t=axCoerceString$3(t)).split("&"),i=0;i<e.length;i++){var r=e[i],n=r.indexOf("=");n<0&&(this._ignoreDecodingErrors?n=r.length:this.sec.throwError("Error",Errors$1.DecodeParamError));var o=unescape(r.substring(0,n).split("+").join(" ")),s=unescape(r.substring(n+1).split("+").join(" ")),a=this.axGetPublicProperty(o);void 0===a?this.axSetPublicProperty(o,s):Array.isArray(a)?a.push(s):this.axSetPublicProperty(o,[a,s])}},e.prototype.toString=function(){for(var t=[],e=this.axGetEnumerableKeys(),i=0;i<e.length;i++){var r=e[i].split(" ").join("+"),n=this.axGetPublicProperty(r);if(r=escape(r).split(" ").join("+"),Array.isArray(n))for(var o=0;o<n.length;o++)t.push(r+"="+escape(n[o]));else t.push(r+"="+escape(n))}return t.join("&")},e.classInitializer=null,e.classSymbols=null,e.instanceSymbols=null,e}(ASObject$1);function M(t,e){registerNativeClass(t,e)}function initLink(){console.log("init link")}function initlazy(){Namespace.PUBLIC=internNamespace(0,"")}M("flash.display.Stage",Stage$1),M("flash.display.DisplayObject",DisplayObject$1),M("flash.display.InteractiveObject",InteractiveObject),M("flash.display.DisplayObjectContainer",DisplayObjectContainer$1),M("flash.display.Sprite",Sprite$1),M("flash.display.MovieClip",MovieClip$1),M("flash.display.Shape",Sprite$1),M("flash.display.Bitmap",Bitmap),M("flash.display.BitmapData",BitmapData),M("flash.display.Loader",Loader$1),M("flash.display.LoaderInfo",LoaderInfo$2),M("flash.display.Graphics",Graphics$1),M("flash.display.SimpleButton",SimpleButton$1),M("flash.display.Scene",Scene$1),M("flash.events.Event",Event),M("flash.ui.Keyboard",Keyboard),M("flash.events.KeyboardEvent",KeyboardEvent$1),M("flash.text.TextField",TextField$1),M("flash.filters.BevelFilter",BevelFilter),M("flash.filters.BitmapFilter",BitmapFilter),M("flash.filters.BlurFilter",BlurFilter),M("flash.filters.ColorMatrixFilter",ColorMatrixFilter),M("flash.filters.ConvolutionFilter",ConvolutionFilter),M("flash.filters.DisplacementMapFilter",DisplacementMapFilter),M("flash.filters.DropShadowFilter",DropShadowFilter),M("flash.filters.GlowFilter",GlowFilter),M("flash.filters.GradientBevelFilter",GradientBevelFilter),M("flash.filters.GradientGlowFilter",GradientGlowFilter),M("flash.geom.Point",Point$1),M("flash.geom.Rectangle",Rectangle$1),M("flash.geom.Matrix",Matrix$1),M("flash.geom.Matrix3D",Matrix3D$1),M("flash.geom.Vector3D",Vector3D$1),M("flash.geom.Transform",Transform$1),M("flash.geom.ColorTransform",ColorTransform$1),M("flash.events.EventDispatcher",EventDispatcher$1),M("flash.events.MouseEvent",MouseEvent$2),M("flash.events.ErrorEvent",ErrorEvent$1),M("flash.events.IOErrorEvent",IOErrorEvent$1),M("flash.events.TextEvent",TextEvent$1),M("flash.events.TimerEvent",TimerEvent$1),M("flash.events.ProgressEvent",ProgressEvent$1),M("flash.external.ExternalInterface",ExternalInterface$1),M("flash.text.TextFormat",TextFormat$2),M("flash.text.TextSnapshot",TextSnapshot),M("flash.media.Sound",Sound),M("flash.media.SoundChannel",SoundChannel$1),M("flash.media.SoundMixer",SoundMixer$1),M("flash.media.SoundTransform",SoundTransform$1),M("flash.net.URLRequest",URLRequest$1),M("flash.net.URLLoader",URLLoader$1),M("flash.net.SharedObject",SharedObject),M("flash.net.URLVariables",URLVariables$1),M("flash.system.Capabilities",Capabilities$1),M("flash.system.Security",Security$1),M("flash.system.System",System$1),M("flash.system.SecurityDomain",SecurityDomain$1),M("flash.system.ApplicationDomain",ApplicationDomain),M("flash.system.LoaderContext",LoaderContext$1),M("flash.utils.Timer",Timer$1),M("flash.xml.XMLNode",XMLNode$1),M("flash.xml.XMLDocument",XMLDocument$1),registerNativeFunction("flash.system.fscommand",fscommand$1);var EntryClass=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(Sprite$1);initSystem(),initLink(),initializeAXBasePrototype(),initlazy(),Function.prototype.axApply=Function.prototype.apply,Function.prototype.axCall=Function.prototype.call;var Player=function(){function t(){var t=this;this._time=0,this._debugtimer=0,this._renderStarted=!1,this._onLoadCompleteDelegate=function(e){return t.onLoadComplete(e)},this._onAssetCompleteDelegate=function(e){return t._onAssetComplete(e)}}return t.prototype.playSWF=function(t,e){var i=this;if(this._loader||this._parser)throw"Only playing of 1 SWF file is supported at the moment";createSecurityDomain(AVM2LoadLibrariesFlags.Builtin|AVM2LoadLibrariesFlags.Playerglobal).then((function(r){console.log("builtins are loaded fine, start parsing SWF"),i._sec=r,AXSecurityDomain.instance=r,i._eventOnEnter=new i._sec.flash.events.Event(Event.ENTER_FRAME),i._eventFrameConstructed=new i._sec.flash.events.Event(Event.FRAME_CONSTRUCTED),i._eventExitFrame=new i._sec.flash.events.Event(Event.EXIT_FRAME),i._eventRender=new i._sec.flash.events.Event(Event.RENDER),i._events=[i._eventOnEnter,i._eventExitFrame],i._stage=new i._sec.flash.display.Stage(null,window.innerWidth,window.innerHeight,16777215,30,!0),i._sec.flash.display.DisplayObject.axClass._activeStage=i._stage,i._parser=new SWFParser(new FlashSceneGraphFactory(r)),i._parser._iFileName=e,i._loader=new i._sec.flash.display.Loader(i._parser),i._loader.loaderInfo.url=e;var n=new i._sec.flash.system.LoaderContext(!1,new i._sec.flash.system.ApplicationDomain);ActiveLoaderContext.loaderContext=n,i._loader.loaderInfo.addEventListener(Event.COMPLETE,i._onLoadCompleteDelegate),i._loader.loaderInfo.addEventListener(AssetEvent.ASSET_COMPLETE,i._onAssetCompleteDelegate),t?i._loader.loadData(t,n):i._loader.load(new URLRequest$1(e),n),i._stage.rendererStage.container.style.visibility="hidden"}))},t.prototype._onAssetComplete=function(t){},t.prototype.onLoadComplete=function(t){console.log("loaded a SWFFile",this._parser.swfFile),this._stage.color=ColorUtils.f32_RGBA_To_f32_ARGB(this._parser.swfFile.backgroundColor),this._stage.frameRate=this._parser.swfFile.frameRate,this._stage.stageWidth=this._parser.swfFile.bounds.width/20,this._stage.stageHeight=this._parser.swfFile.bounds.height/20,this._stage.addChild(this._loader),this._timer=new RequestAnimationFrame(this.main_loop,this),this._timer.start()},t.prototype.main_loop=function(t){var e=Math.floor(1e3/this._stage.frameRate);this._time+=Math.min(t,e),(this._time>=e||!this._renderStarted)&&(this._time-=e,this._stage.dispatchStaticBroadCastEvent(Event.ENTER_FRAME),this._stage.advanceFrame(this._events),OrphanManager.updateOrphans(this._events),FrameScriptManager.execute_as3_constructors(),this._stage.dispatchQueuedEvents(),this._stage.dispatchStaticBroadCastEvent(Event.FRAME_CONSTRUCTED),FrameScriptManager.execute_queue(),this._stage.render(),this._renderStarted||(window.hidePokiProgressBar&&window.hidePokiProgressBar(),this._stage.rendererStage.container.style.visibility="visible"),this._renderStarted=!0)},t}(),PlayerAVM1=function(){function t(){var t=this;this._skipFrames=0,this.showAdOnFrame=-1,this._fontsLoadedCallback=null,this._stage=new AVMAwayStage(window.innerWidth/2,window.innerHeight/2,16777215,24,null,window.innerWidth/2,window.innerHeight/2,!1),this._stage.scene.mouseManager._stage=this._stage,this._stage.rendererStageContainer.style.visibility="hidden";var e=new LoaderInfo$1;this._avm1SceneGraphFactory=new AVM1SceneGraphFactory(new AVM1ContextImpl(e)),this._avm1SceneGraphFactory.avm1Context.sec=new SecurityDomain,this._avm1SceneGraphFactory.avm1Context.setStage(this._stage,document),AVM1Globals.tracelevel=TraceLevel.ALL,AVM1Globals._scenegraphFactory=this._avm1SceneGraphFactory,AssetLibrary.enableParser(SWFParser),this._onAssetCompleteDelegate=function(e){return t._onAssetComplete(e)},this._onLoadCompleteDelegate=function(e){return t.onLoadComplete(e)},this._onLoadErrorDelegate=function(e){return t._onLoadError(e)},this._onAssetCompleteFontsDelegate=function(e){return t._onAssetFontsComplete(e)},this._onLoadCompleteFontsDelegate=function(e){return t.onLoadFontsComplete(e)},this._onLoadErrorFontsDelegate=function(e){return t._onLoadFontsError(e)},window.addEventListener("resize",(function(e){return t._stage.resizeCallback(e)}))}return Object.defineProperty(t.prototype,"avm1SceneGraphFactory",{get:function(){return this._avm1SceneGraphFactory},enumerable:!0,configurable:!0}),t.prototype.preloadFonts=function(t,e){this._fontsLoadedCallback=e,this._parser||(this._parser=new SWFParser(this._avm1SceneGraphFactory),this._parser._iFileName=t),AssetLibrary.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteFontsDelegate),AssetLibrary.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteFontsDelegate),AssetLibrary.addEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorFontsDelegate),AssetLibrary.load(new URLRequest(t),null,null,this._parser)},t.prototype.playSWF=function(t,e,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),this._skipFrames=i,r&&(AVM1Button.buttonPokiSDKActions=r),n&&(AVM1MovieClip.pokiSDKonStopAction=n.action,AVM1MovieClip.pokiSDKonStopActionChildName=n.childName),AudioManager.setVolume(1),this._avm1SceneGraphFactory.avm1Context.executionProhibited=!1,this._parser&&this._parser.dispose(),this._parser=new SWFParser(this._avm1SceneGraphFactory),this._parser._iFileName=e,AssetLibrary.addEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),AssetLibrary.addEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),AssetLibrary.addEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate),AssetLibrary.loadData(t,null,null,this._parser)},t.prototype._onLoadFontsError=function(t){console.log("error preloading fonts",t),AssetLibrary.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteFontsDelegate),AssetLibrary.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteFontsDelegate),AssetLibrary.removeEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorFontsDelegate)},t.prototype._onAssetFontsComplete=function(t){var e=t.asset;e.isAsset(Font)&&(DefaultFontManager.deviceFont=e,console.log("font loaded",e))},t.prototype.onLoadFontsComplete=function(t){AssetLibrary.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteFontsDelegate),AssetLibrary.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteFontsDelegate),AssetLibrary.removeEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorFontsDelegate),this._fontsLoadedCallback&&this._fontsLoadedCallback()},t.prototype._onLoadError=function(t){},t.prototype._onAssetComplete=function(t){var e=t.asset;e.isAsset(MovieClip)&&e.isAVMScene&&(this._stage&&this._stage.getLayer(0).addChild(e),e.adapter.initAdapter(),this._skipFrames>0&&(e.currentFrameIndex=7))},t.prototype.onLoadComplete=function(t){console.log("loaded a SWFFile",this._parser.swfFile),this._stage.color=ColorUtils.f32_RGBA_To_f32_ARGB(this._parser.swfFile.backgroundColor),this._stage.frameRate=this._parser.swfFile.frameRate,MovieClipSoundStream.frameRate=this._parser.swfFile.frameRate,this._stage.stageWidth=this._parser.swfFile.bounds.width/20,this._stage.stageHeight=this._parser.swfFile.bounds.height/20,this._stage.scaleMode=StageScaleMode.SHOW_ALL,this._stage.align=StageAlign.TOP,this._stage&&this._stage.resizeCallback(),AssetLibrary.removeEventListener(AssetEvent.ASSET_COMPLETE,this._onAssetCompleteDelegate),AssetLibrary.removeEventListener(LoaderEvent.LOAD_COMPLETE,this._onLoadCompleteDelegate),AssetLibrary.removeEventListener(URLLoaderEvent.LOAD_ERROR,this._onLoadErrorDelegate),window.hidePokiProgressBar(),this._stage.rendererStageContainer.style.visibility="visible"},t}();console.debug("AwayJS - SWF-viewer - 0.3.124"),window.startAwayJSPlayer=function(t){if(!t||1!=t.length)throw"Error: At the moment the list of preloadedFiles should contain exactly 1 item, a object that has a 'data'-property that is a buffer of swf-bytes";(new Player).playSWF(t[0].data,t[0].path)}}();
